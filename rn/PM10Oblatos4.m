function [Y,Xf,Af] = PM10Oblatos4(X,~,~)
%PM10OBLATOS4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:21.
% 
% [Y] = PM10Oblatos4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.100381449508131;0.00618238021638331;117.647058823529;0.0560224089635854;0.00280033604032484;0.00462534690101758];
x1_step1_ymin = -1;

% Layer 1
b1 = [-0.63482554187992413;-0.32216636708372565;0.47070260532266234;-1.7363690711935074;-2.38144909379551;-1.1597343611139921;-6.5408666535770212;1.9849360086322048;-1.4494027964129197;1.448311557620233;-1.8376647404696935;1.1728061241430152];
IW1_1 = [0.13662701652082071 3.2428566178459213 -0.0015284025734000331 -0.61599535681531337 0.1162926984993288 0.02113136296020969 0.060309863218980533 -0.78621720886422219;0.65813259999278384 0.12759393855086648 0.6526498980021096 0.46777476546450025 -0.24160879960103684 1.4538052245831672 0.44655371337582672 0.12156510797514725;-1.1921207342137368 0.59533826817399726 -1.4058630594899002 4.9483782111695032 -1.3214871803186767 -2.1031325316185576 -2.0922440607268902 0.04211930596972719;0.12862012956615715 -0.8812804815751929 -0.62653690648946858 -0.45947457384733914 0.15686065920851122 0.72333823206130032 0.073512219040261242 -0.71342642203590889;-2.634086356452856 -1.1799284464602129 -0.33607642778336405 -0.94430166768739587 -0.54922820720633969 -2.7196788776583336 1.0803732098941905 1.1650688316127353;3.8313416273805676 -0.70495084474760239 1.5221755324574078 1.1944568472751271 -1.1059645350058926 -0.83583777215710464 -0.086447131193194651 0.48731611224603838;6.2201971694315459 2.5051063756679581 -1.2401725829259553 1.1266434875575664 0.45479266775879534 -0.76520083961083529 -0.23422059087938615 0.10259102179240011;-0.33885357872681338 -0.79880294870243418 1.5170738177440717 0.25790374177547565 0.13569597113607587 -1.1615987796963732 -0.16231518180778928 1.5916202879315002;2.8422935001484539 -0.23834094036706921 -3.0217068891120817 0.54135289064097103 -0.052570651226290191 0.36835864528291934 -0.12269373189367397 -0.84995871096339981;2.447239334842696 -0.29898542139504253 0.44198676611018284 1.081134082460403 -1.7408534521016337 0.92313998186744139 -0.35618484441017739 -0.48282629713269531;1.7243212555166891 0.94037776596401357 -2.700783757649261 2.3183030617651523 -1.8060052645475799 -2.2525537129058284 -0.81113888309032001 -1.7115100687531408;0.59160376339457843 0.48815113288394724 -3.468327999319158 0.23767050726944991 4.736467297264122 0.085858600778623104 -0.31256454484146357 -1.1898948519853794];

% Layer 2
b2 = [-8.832363316379249;-0.85130248752054394;-0.49907338089310249;0.418015773289935;-0.74700621394959921;1.8970421448888923;-1.7552177571567464;0.52277717803471246;-3.3486913325209078;0.79750262529225713;-0.79459169983031219;2.6634907441337226];
LW2_1 = [-4.835011183986154 -0.91460173843647552 -0.23882897605364178 -3.2555221802889305 -0.99352604093707186 -0.2819035849645653 -1.9640015622680627 -1.1784291260337703 0.38050873434598709 -1.0481847553356849 0.044504572473942849 0.30487725798401699;-1.2955911684533539 1.9614194139528278 -2.1126168674762589 -0.55001908426946033 -1.6286943065175017 3.2964055216685617 -0.41360311857324056 0.233700339760294 0.76127945118784068 -4.5233907236350754 0.84993284418601367 3.7159639495641845;-1.5459164251048125 -2.4656619545225253 0.12125950781990569 -2.5685400210594369 -1.1899735986143671 -0.99934790491075265 -1.0232187408599753 2.0688955102784359 1.2617882256086868 0.64587930766297363 0.044223513305243441 -1.1331878916947646;-0.1405252594493544 -1.8950447330260709 0.29206720426122351 1.6341279895553262 1.5389954038490461 0.94284098666154448 -0.92039376949642071 -1.7331401157626509 -0.088195229220383642 1.2379152717513722 -0.093702850866434304 0.33118446578415872;-0.89021879885553301 -0.28205974895655272 -0.027974295610360866 -2.232535072714827 -0.84716171406315866 0.45612089994162375 -0.76443036281650878 -1.4586953699175471 -1.7957089368822898 1.1049626776103327 -0.86356019316515731 -0.12605314813615459;0.16094675832124547 0.31593661342062868 -0.73812008827368258 1.7884792998939998 -0.70247063340849636 0.57638444821686041 0.72234193619812048 0.074467144023408371 -3.3797408776236395 2.8031994476901492 2.4233918784197188 -3.5240707855418369;4.7719767096406027 2.9590198704158532 -0.12899956074406671 1.6345859678563379 -1.1566080564804966 -0.72919572843968838 1.2171174071452502 2.2202173933015201 -0.79018561242608232 -0.52263558701019353 0.035661472894908564 0.9712817047440192;0.82415580921301779 -0.0079373891462309193 -0.028093959673254603 2.160580790163845 0.6297085824854165 -0.54900443562060108 0.71942393520713277 1.3822946639523268 1.6872256733937172 -1.2006283540718694 0.78550422146176369 0.088914604104734229;-0.24191711700413876 -1.5435327050654597 -0.022234704579603033 -1.8240121924646788 -0.90802412989597103 0.39370391465155907 -0.12108887887267716 -0.023220048194440106 2.0755412661962409 -1.4326256620725082 0.18130203621913274 0.53080750217840933;-0.28635681175282457 -2.7608109621681534 -0.28634372708006267 2.0524129383457481 -0.30315657326109652 6.6123871340347131 -4.7510309715112093 1.1383617692650667 2.7801839782444393 -1.8545538720152921 1.1125124503240231 -1.5390670521237717;0.20099225989382696 -0.34120619123062335 -0.61913329945124063 0.40981951829875846 1.825128707727663 2.3755143537782364 -1.9603292911147205 1.0131122734524327 -3.2470844005028909 2.0677351886277457 -0.90976421247336858 4.6450533577641586;0.38729825663534795 -4.1284028123649801 -1.996241661273519 -0.53125425910146595 0.76253869522143825 1.3592435802402372 1.7450587063764058 0.85013742890968769 -2.3791054163184455 -1.67027535995137 -1.4127513409364401 2.6843931359001485];

% Layer 3
b3 = -0.8651060805774875;
LW3_2 = [0.58318417387922827 0.14156465080583028 0.55571070077590179 0.43159533292831009 -1.1777241719775073 -0.15140525605345381 0.39420334625553027 -1.3452098218762316 -0.23041765099417916 0.12308354907682915 -0.24057904591703322 0.11830959643712601];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
