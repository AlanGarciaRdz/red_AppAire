function [Y,Xf,Af] = COSantaFe1(X,~,~)
%COSANTAFE1 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:04.
% 
% [Y] = COSantaFe1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;10.752688172043;0.00341273633199099;27.7777777777778;0.00632111251580278;0.294117647058824;0.448430493273543;166.666666666667;95.2380952380952];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.8468193879580215;0.75541234818197356;0.74465678199568042;-1.0641265260000758;-1.0215323760790831;0.99969520063366812;-0.14536872820536481;0.68913217748338695;-0.18172999393920836;-1.4319943681940408;-1.6736909224543468;1.0091651789457692;-0.80847736976397966;-0.64264576658854378;-1.2524425283219591];
IW1_1 = [0.284693940409949 1.1743771528414377 -0.504448892463365 0.09534146138187917 0.48315862516216651 1.0674286436124516 0.31217437789254032 0.31015666626766314 -0.44812292246211105 -0.1434972528745912 0.16762746257675784 -0.17853795851954435;0.19666780968090342 -1.5888909299327985 0.049941057242806092 2.0209558044117739 0.11737098922315652 -0.11288295965673736 0.01707744684116811 -0.2208286448122069 0.20091530149261186 0.064348429375901323 -0.041139448535388631 0.65968784626109778;-0.04922516746417812 -0.56129766196703557 -0.40340411726688447 -0.98465313420761458 0.19693504977802731 0.033265414045160903 -0.0081321071329703877 -1.5529550841262609 0.49450841721195676 2.2031214904505734 -0.30877885022389306 0.012564343619190937;0.51917163738858574 0.79727012045407109 0.92184248853996142 -0.36400873736283956 -0.76595513893671308 0.89410235811733496 0.46511656414602226 -0.43558011226917237 0.73019628834622075 -0.58660064944346291 -0.46288534694962347 0.63961584581263398;0.16094949763261349 -4.5539709650476814 -0.32474285435569072 -0.29002798976534583 -0.0098669246808614289 0.45867312944118521 0.19350868883336761 -0.058191967691378577 -0.11699520740471905 0.69562253626649639 0.45895604600113082 -0.3188600206068975;-0.044354743523313117 -0.41920518488238434 -0.033111527963889678 0.019088737020715438 -0.11726361212957011 -0.20760514368849406 -0.07624322069367867 -0.069493151140792603 0.093627163284589074 1.3940672721502454 0.034259407141254722 0.01310537981233682;-0.25352064637402671 0.26110626196629416 -0.43939097650390746 -1.4758839430362056 0.38552084614415927 1.2543650547258629 -0.73597804467050976 1.3907854577176681 1.3324418024253997 -1.4246196084382514 -1.1910614761737992 -0.10577893960104309;0.45423476195502316 0.56186752714011057 0.13771639493440918 -0.3147565283314353 0.31835033097991633 0.81357942775649583 0.89729194448695693 -0.54209525386921154 -0.71677603455410355 0.30847403822185621 -0.62403343873920392 -0.39039599135358849;-1.0886490157195272 -0.53180001018158651 -1.467791505386389 1.0070259477343919 0.020242917626350075 0.65990791650420988 0.44036177083122957 -0.28505447742258161 -0.63332196113291661 -0.6287050138899366 -1.4504565659760968 -1.4423763787329376;0.015443998289376423 -1.0247411834450775 -0.033323518525871815 -0.59951335219486146 -0.19795095901702109 -0.5123481699288126 -0.020163336809828829 -0.2853578577373112 0.050414966051128024 -0.45371000533269051 -0.2361421231364399 0.046490964725998458;0.33508637901036653 -0.14542033252109854 0.30249823186776681 -0.59513785249449058 -0.31298163910195903 -1.1642239202948645 0.12906005942469548 -0.22872712197630576 -0.26646802406808517 0.74275809734360287 -0.79187338009631991 0.12132801205371094;1.2091802406268413 1.4619751838425386 -0.23219589377565839 -0.66355566555848744 -0.67243944883546325 -0.54487271812637394 -0.048326582416867755 -0.061968711006537003 0.24034197944345423 -1.0616858511244696 -0.85505183260613105 -0.29772678808702446;-0.32149693577427979 -0.22626284106813491 -0.067504450805225338 0.73603734819196176 0.12651811261964138 -1.0016759660907986 0.14625018547827451 0.55397226967729651 -0.21934244973535277 1.3730753360358567 1.099159714392496 0.45089537537873209;0.043195382478075833 1.861670414574778 0.74055159871269338 0.62865623847743002 0.061025237946536137 -0.89128203657138227 -0.3818249788052373 0.2087362896026764 0.19558918032171718 1.1949714225739163 0.16681365931470843 0.082724341482657004;-0.6232226976179337 -0.30363251596790869 0.15247942880512205 -0.28391791607521549 0.35803585298566254 0.32817657667019984 -0.27871563346881911 -0.45153203705135991 0.4436168763506913 -0.78032154485331551 0.62344698515753361 -0.16247849462674382];

% Layer 2
b2 = [1.9043502316840484;1.3644725850231665;1.1608372555502016;-0.75278801561532804;0.57486288844125355;-0.59427187269603921;-0.169173438897575;-0.58931339189577014;0.42747351266368661;0.37850674259632017;-0.57432912064707609;1.2040907892578394;0.97144814680684355;1.497365414913824;-1.6628655215786032];
LW2_1 = [-0.11415228211641844 0.17371543277643631 0.953217559540943 -0.78849928603410058 0.34321609233774913 0.70792886249221509 1.4084266475568599 -0.20463808673231573 -0.50203106267004438 0.17370779385867927 0.1552344193628373 0.16787144981262109 0.64667421595416807 -0.82575799251995341 0.28230733010122816;-0.50432219668302591 -0.3637557132484307 0.23636366262157643 -0.27875177693079067 0.38409449229240339 -1.0538756372345537 -0.11422994884977672 -0.23673353383257761 -0.010878086190442261 -0.050433894779124647 0.18497807370860481 -0.14497761542608434 -0.93049316824926775 1.1482915014837147 -0.86744845260965142;0.19933190472949441 1.0735663023755029 0.65168745799823768 -0.23298123364662091 0.090397103669094536 0.52496880283395997 -0.69811343860848007 0.37999301785672535 0.014899134703103806 0.13035800420465751 -0.36957611615973918 -0.021161456199170942 -0.84806454482260585 0.43804364606182511 -0.45230417239596199;0.60090486321863212 0.067175955113899399 -0.058751032263985495 0.19659913914037883 0.33116132178960389 0.22044170704546667 0.037943940776194347 -0.10123720714430096 1.0288884786451344 0.92719314130709529 0.092900439310862171 0.48525699712385406 -0.8110674064503135 -0.13163015613413753 0.20265664325334681;-0.51957959227627393 -0.060926206555031309 -0.75989430482544407 -0.4905995716943985 0.67327213748061854 0.18171992117571481 0.38510060118589262 0.34962979560122598 -0.64004456762750894 0.62986295778321733 -0.41274860629199778 0.87524620548422738 0.58940690397318174 0.45718324467676497 0.35189982492129313;0.27769887134611526 -0.74242335639856305 -0.20262228409989277 -0.78083939918716072 0.48490554810280417 -0.46270394829683625 0.21602680241444677 0.12724507500252191 -0.27432143900237693 0.14087327303960434 0.01855147954701112 0.69744294494899328 -0.31667792892741464 0.18834988300415698 0.479545872951188;0.36025767394698188 0.046092498571303868 0.31522870313302048 -0.58250913853401864 0.8545267578946274 -0.88987889202455328 0.71185856673976988 -0.033991510638229513 0.73573921778530749 -0.13149069862253504 0.042286213495087314 0.066797588383785925 0.58469225715910023 -0.97986810212537045 -0.065889683133241783;0.13684583097027839 -0.032669679989021386 0.044109575465821144 -0.13815464244924353 -0.16282806684501755 0.71797715139481821 0.27149878172032227 -0.13671693301881385 -0.10785374922688552 -0.11811067635607901 0.014881171893225922 0.60999212788777968 -0.0048347605510662278 -0.35271454342913328 -0.22560208021209083;-0.15467344330630134 -0.02599351740119436 0.3039677411954182 0.65463551380833096 -0.31562884513291406 -0.52924089290365706 0.093691646555198863 -0.35197945641779443 -0.04515447319583589 0.45972206087266509 0.080398732280206442 -0.25312959789406375 0.46752329704627826 0.32257943912396331 -1.1509514337340725;-0.024629035277877555 0.97291812145364143 0.26389640480875248 -0.30810264659312253 -0.35878507644510882 -0.27267145377382462 0.35526707852892742 0.61093317653934376 -0.21001025328856193 0.80390425833426049 -1.074039843065052 0.87382201243874646 0.54196325912172683 -0.31897040828732609 -1.1405046708241378;-1.0124811272312084 0.99018153253310104 0.12720122463819947 0.49602617436274787 2.628866651712646 -0.42949724166528763 0.65827553171920528 -0.80771622239125218 0.29470253917715672 -0.24170735221264839 0.49233186327644374 1.1865217419333225 -0.44795647031181279 0.28450108328806073 0.50918856840590809;0.89176231131939676 0.65809293202862851 -0.43884460910439094 0.61421640216063722 0.11550578250387041 -0.079088797401733399 -0.30929238141664078 0.097933597049470772 0.052230945608686061 0.16750106687076305 0.31999859647592532 0.053845146167661548 -0.75070991938304366 -0.80322015576053141 -0.7357574569172487;1.4369336236240065 -1.1352069193611261 0.15469960860748763 0.70682486580214965 -2.5504170277777716 -0.80785816499206586 -0.62345954019712269 0.57924363461267969 0.25165126122542419 -0.43143150497020288 -0.021824982215741039 0.73851053547292034 0.63905154436307199 0.68780094926431312 -0.17288163086396402;0.01733622304492087 0.13165310099375693 -0.19817128904236991 0.42800109097269373 0.61958846026427972 0.069773665289153006 0.03001293496151642 -0.20488041591088185 -0.90222391677795932 -0.078479063657578493 0.84803098467696969 0.2300099704018424 0.019335648815027931 0.16422407159300631 -0.96598555776357065;-0.37395215559978495 -0.16972235981220909 1.05986122123224 -0.45033423270009043 -1.0504669653010963 -0.41367962055150292 -0.585311244460333 -0.31852321492983215 -0.44719930284317833 -1.4225786146430246 0.10262685496609927 0.20026535541107995 -0.40134344482662632 -0.71513683433469111 -0.91699761198574781];

% Layer 3
b3 = -1.1228640193639798;
LW3_2 = [-0.40550662587460662 0.80771071095150637 0.17567406588976417 -0.53076622826639497 -0.36250920757174809 -0.40716721895474506 0.19120335412945849 1.3634828316457976 -0.38772357713881611 -1.0647897778309061 -0.7937573441938266 0.35749730662086304 -0.77726331387765324 0.059637220410060351 -0.26912366390671399];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
