function [Y,Xf,Af] = COVallarta22(X,~,~)
%COVALLARTA22 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:24.
% 
% [Y] = COVallarta22(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206;0.201288244766506;0.281968137600451;0.290275761973875;0.304971027752364;0.100381449508131;0.172786177105832;0.171659085057077];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.5980341804028468;2.0121797492229549;-0.01385459809184629;0.071286441594537092;2.410712262849608;0.10185598040449061;2.7007546928872026;0.863413311097744;-0.32829590465264596;1.4004682169977316;-0.38116133269384755;-0.70042574883896147;-0.48426381902782023;0.50117023932504057];
IW1_1 = [1.4780720619246779 0.59801940120104913 0.060321253218501569 1.0921142040168037 0.34895905716960901 -3.0386117918463835 -2.0226963587973907 0.32426976697190579 -0.3900899711881059 1.9504120176555253 -0.58736731302747092 1.4049442228867035 -0.50585600264357011 1.350340559955562 0.44933381237001702;-0.021196977232376749 0.71569613800312615 1.5557183974652116 -1.6847144137734209 0.85840579978275589 0.9782243164436013 -0.033084851660754852 0.066970118818438118 0.88463679343829194 -0.041556738736877832 -0.30957333352469046 0.62066787344416474 -0.6515917158003649 0.35450596774495313 -0.0070920873177214312;0.30168959194354344 0.85085319452421604 1.2726067179861384 -1.025135299813732 1.1413492644085417 -2.7477365616348903 -3.2448349963854759 1.1457421619676766 -0.64767128584224332 -1.3522036146658813 -1.6362542249432028 -0.4981842662234372 2.0170404077632837 2.5253479858440615 2.0130588106072329;1.0706772501614668 0.025411260032838515 1.2584303301734698 -1.0857332249848299 0.27646182884352671 0.077934575076683971 0.19494261622101691 0.028646922327729325 0.40993298010080864 -0.27110803066116534 -0.22564532621923838 0.14948087604957824 -0.5274553279976929 0.34171765138467286 -0.23459466462723952;-3.691796814572514 0.011135720024370264 0.54154494634066574 -0.35730829758192589 1.1803370274085101 0.17001243273632691 -0.29366813091716498 0.29296738884531626 -0.18792994442324898 0.014507984745945834 0.19052411793095855 0.44113538473424141 -0.1834059314936804 0.2294428087761049 0.96242074219890483;4.017018419732266 0.47553587423948307 -0.32992116186640102 0.64832204762357037 2.1315509293591393 -2.212924154208133 0.19204463024521867 -0.79830795454881376 -0.55592745809830546 0.22482250982871643 -0.11285530688965056 -0.47414410009287561 0.084874810186811908 -1.2334736051256829 0.080440491012798848;-0.30157085745865436 0.36809411493719957 1.146183423440996 -1.6023847222002574 2.3213582303871538 2.5021236997345206 0.49372297037623381 1.0584462135452315 0.82010141766523303 -0.94873754068210858 0.032642477768299684 0.50165525579948334 -1.4484474226102537 0.044240364987254872 -1.2667306546266701;-0.9968753304208251 -0.0082355469292547424 0.9282168993498614 0.43283325175579107 -0.88895001874100821 0.34907453928563731 0.15408875769832286 0.1218202380406402 0.12795168089650982 -0.64974708113576563 0.62438927997611171 -0.073023622628496723 0.9149777595854216 -0.24688805954766332 0.058713050893962608;0.59375057578873625 0.98915196701734043 -1.0059499932873774 1.2310722924797048 -0.093029075667514463 -1.6317817012904869 -1.023488821191151 1.2688168293603712 0.49390457525009013 0.9139549215661269 0.059477043206716568 0.76960191181267701 -0.22921049359081738 1.3890368577137002 -0.26677783730536547;-0.4192215018607362 3.9662178065827223 -0.68707688998000249 0.89993302614949366 1.4970180768481831 1.8543788117269964 -0.025178818371892717 -0.10852010239009541 -0.91261717862467351 0.61755104574940767 0.0027186401834267612 -0.40131744300769934 -1.5438275336303584 -0.75983452648747474 1.1277432886770258;0.40595067086898284 1.1870345594187772 2.1241313879899284 -1.5948041639625452 1.5359043476216465 -0.85350656868298846 0.3435603288286006 0.19636102179538484 -0.57028714521051682 -0.88912153883493261 -0.39807747294545065 0.35725300143757294 -0.94609233318778707 0.28165225857795162 0.11099497706630232;0.49884774007403609 0.49086125698917726 1.222518604566845 -1.380094759610818 -1.4998198504445617 2.2224946285494394 0.47478680287189717 0.18896103916642659 -0.067531205208837763 -0.87737332657660616 -0.049095387412111322 -0.26168641474964727 1.386562411644471 0.56665584436703087 -1.112147480294075;-0.047360975955881679 1.2587380031518653 0.75633898960659063 0.16555722497381939 -0.51494772589920901 0.047001763620144021 0.14124016226827624 0.14972478068340958 0.31218093219029786 -0.10281349559343855 0.023965647763054945 -0.12567995046041469 0.31898327061772647 0.020883474518849723 0.05569531163698864;0.092747315019648613 3.2892702273741317 -0.056240546153055945 -0.11568041147039702 0.93441098853746918 -1.0877537773776975 -0.14678792958743694 0.13120942771461439 0.17294841582620329 0.09650086971950575 -0.16905601033280426 -0.049850776780464061 -0.1190379428765487 0.61703523091354218 0.02271135049748689];

% Layer 2
b2 = [2.5457105117960128;-2.1737493265333128;-0.70117263976477062;0.89176744267643482;-0.38906464340682934;0.91353826808486982;-0.3724120584128735;-1.1279161226616554;1.0618936205399248;0.63534084364516741;2.3489427797226288;-0.28501227485572034;-0.26576938548279838;-2.1870420461012436];
LW2_1 = [-1.2257008829606941 0.097725485850635521 -0.22115275693417505 -0.16752168158408687 0.30465307118253637 0.92708160549838925 -0.23013293216124867 -0.46870765896571531 -1.5890443322764298 0.022629859652953849 -0.081586929758441215 0.21800896152956228 -1.2946614305926964 0.18637271688522739;1.2640606009799615 -0.68373750240739006 0.70034111740283067 1.0739850154849835 1.7269625963267847 1.7576729825637742 0.55839003141703025 0.68420086929424584 -2.2492417908804132 -0.24736024323514397 -0.96862524269633044 -0.079484123803312878 0.095926427451948404 0.23631915768067507;-0.29048076942076562 1.1451813505808903 -0.46125647266840225 -0.92600332018101372 2.9038166141935604 3.0719879519529107 -0.70518807657387328 -0.0107744569598653 0.88491966697334368 -0.75579990588107626 -0.50888098426660611 1.3901387787499302 -1.6210118099198776 0.46923033194424479;-1.2538597461916363 -0.91493551931072981 2.4822753926520722 -1.7557554129372832 -1.3286546733609232 2.0318612752449448 -0.40961369217257382 2.497541572132929 1.1275418335284926 1.2698572376677855 -0.96993688062599026 0.9448718941361739 -0.45819292690381452 -0.25527637877492693;-1.2096948063449589 0.23861619624355609 0.20162257654237054 0.33633507705797083 1.2897482030439156 1.6459666088026645 0.099314998595347134 -1.8191319907377337 -0.37887234709180129 0.88587931953586374 0.81347886902234778 0.64815174164903389 0.33254367010346164 0.77639620844049095;0.16785936600768681 -0.5678746850641897 -0.34293241247938488 -0.087302681161809448 -0.50109591297538847 0.56588449180178346 -1.1021327627722455 2.016730852236003 -0.10776857065077818 0.36569173633425878 1.6641436167295833 -0.57218328555954467 0.18142549307357553 -0.98315330081778274;0.049506473205305615 0.857382658267692 -0.33295795330983341 -0.58312406988624832 2.1449247558768976 2.1416754071476913 -0.45506781799367407 -0.1846262784346881 0.44983970478723201 -0.45544469254455844 -0.4365033962597098 1.0448728792454476 -1.1899735118402688 0.33007845552215909;0.14609014229362804 -0.2074151387184853 1.1617215542596042 -2.433144679345987 -0.73293902615444284 0.85240170198559206 0.293918045134126 3.0353806277049711 -0.025881821985208574 0.1484717464035516 2.3612808025729675 -1.0310300044767033 -0.35380045020960299 -2.1237079732129569;-0.61540941521860282 0.51243902966677901 -1.2559605139861014 1.8519880388530225 0.52016503292298877 -0.98445438791231488 -0.51738879422274187 -2.9966052075036913 0.73561115483244832 -0.10754915494234281 -1.9026769912499018 1.1550642961011319 0.10413202901009913 1.7688194686786181;1.2363181785492867 2.0105507056882952 -0.98896075327585098 0.071087985647169838 -0.693003749818912 0.27012640230598006 -1.5014580257670544 0.21497700080606227 -0.60653698312043058 0.82014153551990399 0.25997909213533743 0.13457506022567745 -0.32369051355127482 -1.1678988785318338;1.1221417826984714 0.1943230240354164 -0.045250991322802761 -1.9630109951821575 1.2470650353164463 1.4637772252520123 0.29309576859455655 -1.0952559634094847 -0.19413719209473834 1.8846000728090508 -0.59877843336097847 1.5850100086171177 -0.24752564983005235 -3.3185529428449043;0.19829141774041387 -0.96887425367231106 -0.30856654093771341 1.1155330806187083 0.81425529570660171 -0.35926240258728848 -0.20261214690699636 -0.68882620814778239 0.55814094321504615 -0.78368887679787336 0.081504386372362389 -0.1005541518126028 1.6419418967152501 -3.2045667936178885;-0.003133805822347055 0.55969724616860517 0.083584840483618278 -0.51674297676232495 0.44880589855628605 -0.48916693293973201 0.70560365867613295 -2.1274359326573724 0.61695617746548848 -0.21263406347591668 -0.68422108145192573 0.73910176591990817 -0.22463368997062155 0.10041026051883384;1.0503609798469147 -0.12486346013372669 -2.2724149329682306 -0.054300199438676686 0.039650225661502142 -1.8681552114186653 0.99402330211618162 -2.1529093921864417 1.0590447507380987 0.63496471535257959 1.7052704257303404 0.50561707848568893 0.17315248905331673 -0.71167713838841218];

% Layer 3
b3 = 0.65011870218651102;
LW3_2 = [-0.97585219874177531 0.87138863522471222 1.439412758887322 -0.135082704041223 -0.18281910862265824 0.45024071029356932 -2.2893863781071424 1.2992788743337194 1.3708709974297155 0.19409062034834071 0.41690354449130368 -0.48053798132439451 0.63977890937403681 -0.2074275098112055];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
