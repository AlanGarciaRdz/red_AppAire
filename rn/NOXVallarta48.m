function [Y,Xf,Af] = NOXVallarta48(X,~,~)
%NOXVALLARTA48 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:30.
% 
% [Y] = NOXVallarta48(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.9083879028229387;0.40226583618158152;1.377706972248355;1.9355235253729728;0.13767628568295415;1.7978640860738493;-0.20263547363417286;-0.035405792495418753;-0.57421474239377712;-3.0406601678228031;1.0823297743330766;0.92886559494589005;-0.3161568935129615;-0.88451983526518874;-2.4315224841119418];
IW1_1 = [-1.3044693166279278 -0.57117820038063327 -1.0116232546404358 0.17084738727822485 0.89309130442866513 0.0017766889215625366 -0.1792991181709043 -0.65642436792354397 0.2382467359142976;-0.22127150064667314 -4.0509383221423452 -0.30554066810224628 0.5938779593075949 0.029030836012825967 -0.12619222561124754 -0.25116763535733189 1.6983096012279202 -0.048531590678580143;-0.50710048332543622 -1.0803963515046895 -0.18850728824751264 0.060972472211373328 -0.66739586299990861 -1.2619764959350384 1.4374915419060534 2.6291791196823975 -0.2449791656822646;-2.1347985354496739 -0.75572380372038539 -0.47335808871874657 0.30480142477934458 0.0089599351683913794 -0.63332318606280402 0.49613516849406109 -0.6091424684866571 -0.20133795922164124;-0.91987510947145823 0.60209857754292129 -1.3411953430768122 0.022496773338355799 -0.43603145844960278 -0.76478491329686349 0.40530917181209764 0.41791506754605462 -0.025655318532624354;-0.53396848946965458 -0.18366341559271604 0.32386697740774389 0.085164540404431277 -0.64411790704946703 -1.6696551674887545 1.3283435449741716 2.3663134234624352 -0.31157690712829766;1.1308772217917598 -2.8993791823434947 0.057341004966867365 0.30772756118364486 0.35051506941423832 -0.24181510713012633 -0.082260126720294882 -1.466557756486728 -0.26143271206709767;2.0591243250069993 -0.38459387893629654 0.37615024054015433 0.082880003876966452 -1.172473907204111 -0.040262304790624232 0.35736947724773444 0.59319856133096738 -0.090603269193577057;0.86525391924242978 0.12044685373017427 -2.4827760277015223 2.834020299543023 0.44566228302640887 0.64767628948189127 -0.73036522945444748 -2.9660473909324567 0.17954199031370968;0.27035135558451895 -1.2078485765896996 0.24256445603580226 -0.73086783227585983 -0.5959802020992766 0.64838067464484161 0.76903252023066793 -2.5953857514811971 0.21900875874069725;3.5743306756276749 1.9653724658300151 0.90854332614927535 -0.47900537187529874 4.0272851681723276 -0.8817667600780309 2.2869680938437367 0.58931569454563548 -0.68921528821442435;0.062513154336156757 1.5882630711885559 0.01481197839047025 -0.9900447049542016 0.38431219463608685 -0.040690842375882511 1.507439672255211 -0.1512346017445092 -0.16371855582231948;-0.36080135286874854 0.66131949437018656 0.63745457594114452 0.17201575725873763 0.052137964834471785 0.42752052135693935 0.028513571538358842 -1.9081013570256247 -0.11750916336561647;-1.3101448079278988 0.5535807476247594 0.30006263541514966 1.1325146627330724 -0.46742577947501279 0.044892345991676436 -0.19230249958507123 -0.11744267976184709 0.1295181955912964;-1.1280257897768242 -1.6604777503579551 -0.19726419012245305 -0.14160498336435154 -0.72549900889233765 0.18311226258501484 -0.32356055556537794 -0.38655230218395936 0.36277240640143182];

% Layer 2
b2 = [-1.0621064593310479;1.2230773642571888;0.50426763251352391;-1.5357506880974101;1.0080988052161932;0.7940563541400254;-0.42870670175158826;-0.63187965124859613;-1.334518212445124;-0.047814127605629086;0.3582033012192215;0.40675654284714924;-1.2994667943024119;-2.4210236709527728;-2.0451104422391668];
LW2_1 = [0.72987693541668608 -1.4523110593526216 0.20857937865923692 1.8293111243435296 -0.56856770285448532 -0.057260668844877627 -0.46254248604272552 0.21107812548022054 0.033005640106275325 -0.61778202374564439 -0.24834927004223237 0.18596301581369312 -0.41579623846041941 0.14263246992220385 -0.4635506580562051;-1.04705258885694 -0.29020103818519805 2.220168298570441 0.012753836356103719 0.45236794095063826 0.92337734140445249 0.33933241787798119 -0.029783255411176872 0.67383626494407645 1.2668125184606061 0.67797940771970688 -0.024194193781289161 -1.2797089603065714 0.47410992033493854 1.8506565740434695;-1.1887578702323267 -0.39665124753044256 -1.3098008543027344 2.2391072532883136 -0.91456028291212399 1.9481900153445055 -0.19396507506952829 0.84199701139303551 -0.98520364620468681 -0.44311214115359537 0.084162821253620568 -0.039666255255231764 1.0842109346715083 -0.46447625903030243 0.05249081338334903;-0.20138369450699198 0.45347059930953226 -0.47756134048842191 -0.293555614908589 -0.60043869220774371 0.60904305718789298 0.78624833582064646 -0.54601720095645534 -0.18246047534070589 0.66017979624227563 0.36814572419209846 -0.0030917359170856929 -0.12822334389723158 -0.90586001291404583 0.14612473181204272;-0.64030956866631084 -0.28485385445073452 -0.20969291365548348 -0.066882499841197096 -0.094762503260104575 -0.32466918850160109 0.41988539603866293 0.12199941408391791 0.13238388095232101 -0.10643826068597978 -0.16345378712444694 0.0087025038113683409 -0.15120938391618194 1.0860256690729206 -0.85528381517754559;0.097365558962776294 0.53740698506736695 -0.20907544286706381 0.16349089052014942 -0.85147459862529518 -0.28088665851959271 1.1613853790329782 -0.62652960347701592 0.44578572001403249 0.67375494129991798 -0.074679874901150287 -1.2920693261066127 -0.42288435018682952 0.46405326660577562 -2.1143988346287332;-0.25171243442610081 -0.042689603652745663 0.81671827584270595 -0.21841676179387084 -0.52163156280106815 -0.55535557122493084 0.025640909303313211 -0.35831518593481471 -0.27596903240067117 -0.0076117235454183857 0.058801594502026162 0.39941129407432996 -0.20973099057125727 -0.68186846231828346 0.22587420177518511;-0.90841741991708502 2.0520365490844674 -0.0106402425764155 -0.58375829808978374 0.056359792362214736 -0.51395228468133369 1.0245958639591295 -0.50700301329571129 -0.24571401356391764 0.88474350427487569 -0.055796716297499493 -0.010199350211039751 0.37626036004485952 -0.18342014891883163 0.8833851918370359;0.10160828336841533 1.4006183339038183 0.78055318712190214 -0.58780630265060274 0.85890591964585716 0.97957831698622144 0.82650126056181283 -0.659117687369974 -0.35640824535805787 0.13012391155204078 0.493628236881197 -0.4279494638532515 0.78525308879532818 0.088652334691329937 1.1464966854301428;0.47270081488066951 0.024087239580282555 0.10487835725572849 2.7193179944894785 -1.375550892822565 0.52211577761743666 -0.62258151094001202 1.0407341642881855 -0.84237062933686224 -1.1995349557259636 -0.27251442798041559 0.34579172322081625 0.76892164058002743 0.85549810416081673 0.0033279179791437241;0.0089284630974234419 0.34846519537083953 -0.046090517283757716 -0.079419433939233813 -0.78816704307430785 0.51600547538611619 0.04240647956667562 -0.40163708038891005 -0.11831737497446815 0.48616525670724414 0.065518603633424349 -0.0075479127989857321 -0.40286985162245609 -0.96208171431979517 0.39430608462853317;0.50601042188515255 -1.363707357430294 0.3809919015907447 0.71718067636295957 0.89700380861882556 -0.13530313836360425 0.78798179947798797 -0.00014608444922115452 -1.0259134421311897 0.5552063543666802 0.47948470386460018 -0.5907763830813233 0.68062205993131841 0.087559575635442949 -0.6547536674883605;-0.4787588416011801 -0.54064401038790355 -0.14413158668200249 -0.0069789840763629313 -0.81907105567213112 -0.22934496682572433 -0.20686146091179011 0.0001145772742590645 0.14765562224513726 0.59330327008105443 0.47906020118034626 -0.92099959799225217 -0.20909754434564939 0.34623449470103124 0.2982166327747906;0.12782543396370036 -0.19882029726474884 1.5480657891411984 -0.051711823732655725 0.15295829366905761 -0.76302526342834964 -0.36379867760070839 -0.13279468237585065 -0.34044363772564246 -0.52983166250833602 0.1779093844416704 0.54737890447456672 0.31474368539897679 -0.80037630542550853 0.59580597756244125;-1.438970005588593 -0.19030464496669086 -0.96275395742275194 0.9859920206928211 -1.5502483861487102 -0.77533274013497644 -2.7046775615231482 0.90480213604676851 0.72561237504809495 0.84551447274747438 0.33883495573811356 -0.8714919173246104 -1.7247309564875297 -1.6193104426472529 0.64776119658110887];

% Layer 3
b3 = 1.3003227549304885;
LW3_2 = [1.7735641044294717 -0.10809373200905502 -1.4731937067437455 1.650576944580852 1.2847444047914436 -0.3554067927136374 -2.4002474297966132 0.72023615153220144 0.52612586757750235 1.1876868164621917 1.8968459028224973 1.6333552778682263 -0.5243073559687691 1.3943835673713347 3.182329438952225];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
