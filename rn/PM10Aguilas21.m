function [Y,Xf,Af] = PM10Aguilas21(X,~,~)
%PM10AGUILAS21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:19:53.
% 
% [Y] = PM10Aguilas21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.698032812550923;2.0568599922452848;-0.9422172574863853;0.36672578951574047;-1.826841092785247;-3.8170159350677975;-3.6279413817655444;0.48186704452734541;-0.52022213635256453;0.10525738777822821;1.1680774287712352];
IW1_1 = [-0.23202205335773757 -0.32151845045619665 -1.3180460017090607 -1.1374039366100741 -0.48311916109764064 -1.1819296889373012 -0.3652471455725656 0.12206095071374636 -0.4409757187202944;-2.1730579814673394 0.46206455253994061 -0.44041812132460412 1.1942726419386145 1.3243661636783242 0.18089236350333374 0.19300384289897674 -0.38905090840804907 0.25272629774493377;0.63883753737068938 -0.75708667406522734 -0.010199151890015877 -0.56951111012581779 0.54910680296072478 1.1434551142234746 -1.2235613109566261 0.1008422808224981 -0.216722977807663;3.1676583504524625 -1.7757696193869263 2.4147930925013048 0.98054705362148331 -0.23542199170417724 0.36174638781155721 -2.7464076260159564 -0.75741417944210199 -0.55442490333863104;0.91185420343403989 0.9614334695276463 -0.37428614717109543 0.49864530083479475 0.1732272079618182 -0.80458828887869593 1.3444678265660261 -0.026073115048292128 0.16212834388340533;-0.36406209778668852 -0.45172213699917929 0.13690300473706538 -3.8796700051042827 -0.41435873504941517 -0.13153893265812841 0.10077198487262135 0.053449721106672808 0.20133687305995349;-0.084242535939462015 -0.15614894508497282 0.064772225958177554 -3.1016724432522844 -0.058788996960586933 -0.21268685863581957 0.17621377426531531 -0.036179202862407334 0.049470760545229892;1.5746638876804655 -0.57593070477246699 -0.14544024146214385 -1.170544320625404 -0.96248179011864776 2.9095073347883229 -1.5895219430606575 0.9014593835425756 -0.3833330938396764;-0.29494845041250634 0.17323309105671389 -0.21675017799380839 0.10278843404505385 -0.23565491186096907 -0.36752010340206537 0.27839164829836199 -0.0025119940079942359 0.026591196491386658;-1.3608835164906452 1.8468691934503878 -0.39586979358827806 0.014907637216895083 -0.35612690346851567 0.24231810310468702 -0.72695745077639595 -0.080258654774007621 -0.044987651468489147;1.7093149332432911 0.432828105577447 0.040081477321349687 -0.082302952272138047 1.0519354932876004 -0.13012245510756063 0.65334210097703671 -0.33748717290717989 -0.19958369729312];

% Layer 2
b2 = [0.37064751451399436;1.4643259247368021;1.3760641133805427;-0.64986678068373149;-0.67522228684885743;-1.0783844741209025;-2.6606593731610522;-0.606876600316263;1.8031794269681267;4.6708610359123321;-1.1944040876439721];
LW2_1 = [-1.3775885456647827 2.5059892129967767 1.3853945573467243 -0.64832538068525802 -0.1146907360532062 2.2381110929872912 -6.5489949027537087 1.1074589174453622 -2.5654585605477638 -1.3817635601370397 -3.1160326693231211;0.32521506514109894 1.7797296977880745 -0.87313061038920792 0.85800966963765868 1.0854544603883096 0.52047568674184352 2.5829192079115209 1.532502840914407 -1.7483332795933393 0.3377782295939914 0.12600770521865312;2.6373024177659699 1.6102091625583519 -1.0940318831281701 0.25676439835465942 2.8296299512377359 -3.4476616846814019 7.3821301264728394 1.1125776405657417 -0.030118079194412922 0.67170934181166619 -1.0612958492376932;-1.2823715951023895 -1.8003097005039006 0.75210613913536395 -0.9569239998430078 -0.98425957508634931 -0.29241462187377826 -2.8006133141794112 -1.5571574023519881 1.5833810930862227 -0.37540089875685662 -0.12063195961091652;-0.26471781944011519 -0.25791655706625444 -4.416834059712353 0.054416568381434771 2.2880124061999698 0.016472679303145974 1.1764135815706707 1.2924232185072557 -1.9764293628915806 -1.7688287892969052 2.3309631330493601;-0.72994853169952623 2.892672663389618 -4.5225306457758263 3.4269522355301056 0.12509008575368655 2.346185655007988 1.239856227153364 3.2215490432282974 -1.1375624543264695 3.6974461446153231 1.3689912064632526;-3.2074439311705101 -0.45879761848186029 -1.2713996846361926 -0.58545359568846278 -2.5586204531821259 1.031337461953945 -2.645031165937703 0.067807579649798083 3.0553457879472141 -1.6133866201128213 2.1768761993397323;-0.35352974008806465 -1.9169152310331399 -4.6757587650047086 -2.2218171043520756 -3.0026127895678161 0.31457945528682141 1.0667326606757332 -4.2952969489319326 -1.2583149938406444 -2.7320313403479535 -1.488015079716406;0.92758568375379713 0.31778872311139261 -0.99326055178348915 -0.041853428530724074 0.61600239380794586 -0.76536063958330514 2.398663898847476 0.16282297121411096 -2.2181806868284939 0.25504802806606841 -0.37927212943265087;4.0908659509665961 0.44569333429766533 0.50408633355711618 -0.079712174440324537 -2.1397076013166387 1.8425019913914915 2.8952682916660359 -0.61217926176539872 3.0205701286424649 -5.1984764356127817 1.7502333555431415;0.56707498607129248 0.93483298888567623 -0.91457678767550132 0.31405107089004469 0.31482240166255715 -1.4324607581924607 2.0187712590865083 0.98708704670024949 -1.3137932374113346 0.31047808221159218 -0.70888958443585282];

% Layer 3
b3 = 3.0919026172490329;
LW3_2 = [-0.064005732367479376 1.097873703037364 -0.19586141461114409 1.1873390390577081 0.13799413152673631 0.057685109166307438 -0.16928893810664031 0.081350357893800559 -3.5022123238427922 -0.56571843115821974 0.30735262678987413];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
