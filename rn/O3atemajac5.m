function [Y,Xf,Af] = O3atemajac5(X,~,~)
%O3ATEMAJAC5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:35.
% 
% [Y] = O3atemajac5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.201288244766506;4.04040404040404;166.666666666667;0.0561797752808989;0.00614628149969269;9.52380952380952];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.787331702760433;0.5473759103217587;-0.18483580099838651;4.4872352023969961;1.425161964349984;1.4069122003084071;2.7071673871084174;-6.4501685647116647;-0.17865402681042525;2.3097602192956801;0.31144714771467358;6.2399542485827579;-1.3585995201501779;-2.119067546899382;-2.6937755995951242];
  IW1_1 = [1.8757215889878136 1.7412146094461622 -0.73958095414549463 -1.854181863795165 -0.25525047377619975 -0.1202649111562264 -0.14621494402655655 -0.61255147993127368;0.52493182988464748 2.0146239723124153 0.85421801644170314 -0.91920872230809225 0.24298066037687396 0.05862691824697757 -0.021328626002354446 -0.07629366812730741;-1.8287934251955471 -0.1666740186509606 -0.25446585249685955 -0.60816778866369137 0.13340589243981721 0.58657050016695711 -0.041767975246513676 -0.80573098575344226;-0.92885198870991481 5.2322323317575119 0.71563157100721086 0.81282576515179872 -2.3118881911478391 -0.54055823437770434 -0.10057288663584109 0.90372267039581855;1.8307795415668229 -0.073908844857039774 4.2206811365365988 -4.6748965969751204 -1.0766047252896151 -4.7220748848956129 0.15384515308747976 1.1704317600529683;-2.0820850313048669 -0.33289654555578091 0.52372764332044552 -0.52658167289911317 0.1688255323000023 0.40804691145105071 -0.092622451928812979 -0.18088811001811339;-3.4388126438640017 0.63214253840435486 0.64249402350155649 0.77068821731225723 -0.5658974030258469 -0.56151647882408517 -0.10713484604030203 2.5640729375968294;-1.4781574341945847 -1.187409936530555 2.9248318650481213 2.3982795321986052 -1.8127705713060855 -0.77517696887477017 -0.46127348315254696 -6.8383997948110906;-0.20015605548872864 1.251007855325976 1.8146585097786501 -2.6473511416419364 0.39338452297437299 0.5660089452330398 0.081625026692510261 0.88976193424347094;3.1846871435171229 0.81219768599812991 1.2358058932657472 -0.64865820547482556 0.020045256318848112 0.090958579833735273 0.02848705085414031 0.14634171826357373;2.9718407339558772 -0.2356739892123175 -1.311067025799638 -1.184110131160548 1.1935220216400284 0.90402008105549747 0.11436780656965276 -0.87474136219159848;0.13088191463099647 -0.62538630728025291 -2.7125217404302524 0.69001937923758494 0.099596725872607039 0.85002272115004074 0.051965328394053822 6.6396549796036117;-1.9910207975448608 -2.0048285824897167 1.3926403396949441 0.63128078112974462 0.40576933759986433 4.7252908315401312 -0.45250037133856141 1.5383343368942763;-1.1139302270197224 0.2276708782865331 0.49977408013224661 -1.6325150395759542 0.65963603229127155 -0.21573785336733331 -0.080871933078231165 -0.13682587771447699;0.045804279561929881 -0.41547585483810962 -1.3836125309818283 0.082200990905852367 0.029520339750383179 1.6713072386860137 0.022373239046648799 0.15019693771019205];
  
  % Layer 2
  b2 = [2.1252712004705065;1.1850717217822404;-0.88151483537956865;-2.203738509328121;0.36184910322834396;-2.6370160561181208;-1.4444745710371309;-1.546772886869991;0.99513762461844135;-0.96591296921186875;-1.298994051207234;-3.0808927180682968;1.759674646041161;0.89042547978133668;-2.7312657905461379];
  LW2_1 = [-0.32532666186582615 0.022779132472207139 -1.2092998967692723 -0.14321433635834852 -0.07343049916384338 -1.8097028654206504 -0.29422573301986316 -0.10384813747045631 0.40301189282637651 0.50409374976978094 -0.41937184431514551 0.56802450101403412 -0.049071952993574863 -0.10182729060546965 -0.46204944957481403;-1.236058780066696 1.8980351588894253 -2.3185918740335647 -0.78156811777052126 -0.04765845298893532 2.498765125865138 -1.2504910658417872 -0.79658981751659164 -0.41359966905742618 -1.2207428962120748 -1.3106101590481942 0.097701347723497006 -0.3594412576333354 -0.73221955462756405 -1.1477629908455729;-0.23935734895481028 -1.4709706950126333 -0.19804005540978453 0.59236795647998408 0.1985962547085173 0.046849593815994947 -0.77767219523933628 0.087189341381247246 -0.20126919734662185 1.546878638617023 0.55290923778502421 0.17505993482303933 -0.031179444683627842 1.8978720232082049 -0.54868566110531536;0.45882341297381962 -0.85095843801427873 0.32301521879744388 0.03468340802266056 0.28984482357249114 0.38033982517471376 -1.7862075768186114 1.0491741530334493 -0.14523074359433683 -0.71401225910739363 2.5397315254494739 -0.9347010750919752 -0.31572109019812378 0.35608869396655818 0.21057308174128578;-0.10203460584044399 1.4087465429300536 -0.10157286870199717 0.17081495200683694 -0.36967911584455615 0.14918513485829799 2.0958008921200268 1.1481555053299575 -1.1528523216778546 0.61060481919851484 1.4806418476493657 0.4716166435221128 -0.34239998233287589 -0.96524216241528238 -0.57881509504371953;0.31758366040105929 0.20708671878981633 -1.1152804530426839 0.21154717661367378 -0.028116864233172518 0.66476741448940724 0.069496413154821413 -0.14802995717455378 0.83490305653534491 1.4482270059281643 1.181518219332196 -0.052948285411388407 -0.24908012414887037 0.044183050591476078 0.95972382854121341;1.6807038510785905 1.4846971165522 -2.4480830001222529 1.5935626139495045 -1.5232042867122528 -0.28553759098942866 0.15381073164575471 0.80500882843963695 -0.11476430641116124 0.84083599106958562 0.24665496315316629 -0.7224993557689301 0.8830617019192567 0.52674905032953845 0.49785071329690211;0.12947075493514515 -0.62415022378143192 0.89500439681641575 -0.49103490497778229 -0.12960674629514721 -0.64827143977610502 -0.58334266123813594 0.61870798078472533 -0.06483835871455372 3.1537731914490972 1.0098859722946043 -1.3671911221079482 -1.161264122499245 2.093960491296845 -0.12703400286183614;0.71985145102658454 -0.75355435021478923 1.2244767715943674 0.078949185677230999 0.1722100751978248 -1.2199800410407375 -2.9647615475567295 0.31130589645614348 -0.784764688105686 -2.9019741960896615 1.1387688096663353 -3.2575298545488849 0.37613381708458488 -0.64112208776597868 -1.868347884368631;0.43443572173171058 -2.1486409706076097 -0.29613128206649214 0.97261415143132746 0.12201338693157168 0.35610218170176172 -1.0555123992729059 -0.34670580445310351 -0.12736404116195221 1.403240923839612 0.76358655832837519 -1.1829728630970662 -0.12311032524463024 1.7971176090862784 -1.0128289479355936;-0.084913709558278427 0.13687931196626918 1.3050962676906663 0.091372904310002515 -0.087814361518005993 -0.71009009124829958 0.9258444399555843 -0.53678036400133566 -0.20530088992722312 0.81640499830890823 0.012864754662067785 -0.064978317000063943 0.087853257964423115 0.29263401552954083 0.9553483880073832;-0.32016018211104907 1.559491649816851 2.4563172023378881 0.47926717972848087 0.65438150215658075 2.6666771805957188 0.79525148499919096 -0.24969381921708905 -1.6026271976072568 -0.84718480472389768 -0.038293571272859143 0.20033701988570141 1.1150701891807688 -0.42399958169219409 1.1403037748251441;-0.047415724841845718 -1.171654265927379 1.9092522451704113 -0.17636120266888836 0.44455315445130467 -0.70237476366588414 -0.56198239640940451 -0.6525321714633846 0.15076823536457662 -0.56792536379926495 -0.081163221589381537 -0.64002599677076133 -0.50104934114081368 -0.90902420977497378 -0.082133605029109991;0.3655849461104051 -0.34459233178506499 -0.09923304949659803 0.196363398418746 0.11471345386590635 0.53950051465257642 -0.31381645277516845 0.56389707390010857 -0.18488470284291114 -0.9957146976538479 0.27524895749242861 -0.37228692682248149 -0.19319393856035261 -0.068701527389865097 -0.011607774482209289;-1.3553946432759798 3.1038858137851504 4.5103183985423883 1.1777491597947964 1.0843034225487644 1.6911003066022698 1.1270690571189823 0.066736575179596025 -2.6231993607450352 -0.88191801099818434 -1.3395149309485253 0.54601760468403615 3.0050147365837887 -1.1349005005158215 0.53217249063878214];
  
  % Layer 3
  b3 = -0.29791569054585065;
  LW3_2 = [1.4895907251018439 1.4339567563797466 1.3964871239466741 -1.151647795889609 -1.0405624554606188 0.6692848592177536 0.08682845628585599 0.56999321937938474 0.24149143052539249 -1.2081765377321469 1.7290106283934648 1.0627453893922749 -0.78816466561803555 1.8611077604772213 -0.48850442157599128];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 9.52380952380952;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
