function [Y,Xf,Af] = O3santafe1(X,~,~)
%O3SANTAFE1 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:49.
% 
% [Y] = O3santafe1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.172786177105832;4.16666666666667;10.752688172043];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.1757005426714473;-2.0343760956533421;1.0986054292318828;-1.4820945368810488;-1.1678605495466419;-1.3644508739415828;-0.46948818270112735;-0.25808052468660053;-0.72890855452944969;0.55079240060488222;1.0243806010279002;-0.29269180716223564;-2.6011657480876234;2.2724915756293909;2.6587806688673998];
  IW1_1 = [0.40567860349533458 -0.3262847743127727 -0.27736594814603804 -0.14890861713460093 -1.7360357057474407;1.2963568678980792 0.017960978870089191 1.3991568901175646 -1.0962319531787006 0.92981548769809996;-1.4080095182866073 -1.9588012104270838 0.98607791340589068 0.13169912587468927 1.5365865410683368;1.5608888340128722 -0.029872548635925047 -0.10933767497826538 0.72477614579670302 2.3062824064457526;1.1615063961655829 1.115684640947443 -0.0056249106839939278 0.72907916053256117 2.44639283408954;1.0097573217796059 0.24403034271329163 0.44404720031046313 0.16652603674809363 -2.1851167776680467;0.40525896570228725 -0.48281547833271599 -0.052496685492081099 -0.27151044588287332 0.68072874892475099;0.65332167656515505 1.6256732792864561 1.1376049927302367 -0.12519075795911005 0.95139967466908071;3.894803406449002 0.27863795775741701 1.0068748166455583 0.93357245053803239 0.32831310403287928;1.6089752869538874 -0.067636549670429216 -1.0308262659872911 -0.15883937699760753 0.34461482650734943;1.2205099838309381 0.64108342935637519 1.1534806981109269 0.28491103328356954 0.81486187025468004;4.9252622315388699 0.099948820030395832 0.37982715899944386 -0.13087348382813632 -1.5639964412198695;0.52394960841824534 -2.118723148485997 1.0944107390411961 -1.483756117680066 0.6700299418300717;1.1281190588447905 -0.39356669164693736 -1.0379865179458934 -0.16557946579962904 2.361019249358729;1.5564973845928127 -0.093423755235062078 1.3882730906459344 1.2934236573717888 -1.7833897412583033];
  
  % Layer 2
  b2 = [-1.8461292289281028;-1.8122759637377257;-1.385660343499157;0.52624762194924113;-0.78177205202535949;-0.46781969134936574;0.26150351471785405;0.54692153163940471;0.48385053655644528;0.58626868172427815;-0.77986056592693798;1.1140130449103498;-1.185373550672197;1.9568359376893625;-1.6883512329049206];
  LW2_1 = [0.10054373673502394 0.52912214342484698 -0.04191455361892741 0.31226958380081749 0.57274360642101563 0.40296922351207731 -0.62375060976816843 0.45510386634116085 0.40807793960582828 0.082506537891176235 -0.51900028106569451 -0.54992371605530155 -0.41878372191970048 -0.19833593309300915 0.25452389765381322;0.31137499447280881 0.44273406505520263 0.96986460356844761 -0.19742622514602715 0.10455873928239627 -0.75993646870403331 0.6285402793350483 0.92353707170471133 0.093224878312332254 -0.15841923277191361 -0.32162408591501257 1.0896050805215942 -0.88728844050364786 0.34903511889936539 0.84630883437137205;0.2354242766658621 0.53449644681046005 -0.81200187062327178 0.53503639600962183 0.41423490534959395 -0.65540303924195831 -0.084886989778743274 0.1780063698621181 -0.47378634080848281 -0.68872640241132665 -0.22870834476971433 -0.36971062762786555 0.34526997342393723 0.15021992360687939 -0.19751357265902297;-0.71101642484422167 -0.2224991064264612 0.57496829239737701 -0.024973888581551175 0.062579086935526176 0.57564764119608758 0.054051098124798663 0.084159766504324079 0.14302125347228523 -0.045073993200126734 0.44314155260552801 -0.7177580142985488 -0.42611928887772993 0.41478254114534757 -0.43435661613796084;0.96192260174235511 -0.38037669647514133 -0.14225048376255189 -0.28736568290803077 -0.85004018931087388 -0.13579115003718234 0.02285197888091825 0.22536060482717629 0.067788309336467123 0.18385092463969938 0.1534168354801419 -0.090100848313883708 0.44613945394516219 0.0066037553995325141 0.28294358141567344;0.16779005518690199 0.50760717745748085 0.28613178851042442 0.55178253641249042 -0.50433849926672403 0.29540722872710357 -0.31393054035309004 0.42771370965988958 0.30750478218566607 -0.1286220790173665 0.41660806311155618 -1.1365474864986749 0.50012297661003857 0.38183889183812159 0.82873127433019034;-1.1052659619959653 0.8287199426392351 -0.44549993811349464 0.2638522844147535 1.0496834117644316 -0.10144241589256801 0.29282707858249407 -0.16936825807740091 0.54518230753605801 -0.39762245965783222 -0.14712076351843209 0.51084746617942789 0.38208384296344577 0.53559035887585249 0.74007463939095297;-0.24043804446621247 -1.1241569808095824 -0.97866096267694103 -0.25731855269357773 -0.39738133066059489 0.64515994948879274 -1.0055033419062047 -0.64293061849164224 0.4741578966707562 -0.81142225252515621 0.021658474424786796 -0.97878619720968585 1.4500610558506621 0.43920505712422181 0.30645841142832758;0.79864109977269226 -0.76322936292132804 0.084255681265395482 0.22678143067907072 -0.026490508613190009 0.092345143067587301 -0.15081928093262148 -0.14189289208213399 0.23142577749883747 0.1882346324211738 -0.76483405147833927 1.2610947952052356 0.10402858328547818 -1.0803383699928468 0.4174242288690202;-0.18313073653920878 -0.076874596706621875 0.13342458583596689 0.41626628700944873 0.24717487010330724 0.2399219075351556 0.79333657859677753 -0.029793151788580864 -0.08736538901614728 0.46224736786999465 -0.38855737057273099 0.58430499733932462 0.34524302566145404 0.12311089710883411 0.94624177161188405;-0.86879060350452908 0.040791669970334885 -0.52875959996189958 1.6155835908669547 0.060810174687401172 -0.0091238073004152251 -0.58120229794495604 0.14277022918017884 0.67570663322234459 0.32694977087997323 -0.47290776110916904 0.7206209394532288 0.60119555260280222 0.42444485997519515 0.096333275706449062;1.2053538921511333 0.63823104586144741 0.10434957062096806 0.52243450308214756 -0.15653061340631 -0.0049665967567893848 -0.86743230245978165 0.30274323977060363 -0.10785681940977994 -0.017236384280686152 0.47501080982205368 -0.68592291707102737 0.4960806740367868 -0.17545712772605329 0.088895434622387137;-0.31176420429584834 0.22319411517369522 -0.47091654593094184 0.32486752725358237 0.17767429699206583 -0.58433600314228817 -0.63673686581969591 0.33503538884226947 0.1182587344358484 -0.63378782164070935 0.44939255657546723 0.082243932943978859 0.38771883301526494 0.66046070032161353 -0.48587396709757524;1.0121342827290289 -0.58955637799719063 0.13760291671121538 -0.17484524702508136 0.4128991805773416 -0.50877856854219616 -1.053957736103043 0.5169660730967961 -0.33802097041206713 0.42890552313371394 -0.50910843168377307 -0.93285464252588701 -0.025583120765850051 -0.46741770948419575 -0.80728163590631197;-1.4623929894795391 0.053981982756518263 0.59210536103749323 0.41706204382118794 -0.40474598858086464 -0.12149208049179253 -0.23251661168258092 -0.61713157194644741 -0.59471786999716103 -0.066605289533035739 -0.090862750813133442 0.91973085650944952 -0.308278483882236 0.053009400525885389 -0.47324207926832046];
  
  % Layer 3
  b3 = -0.21778213009910088;
  LW3_2 = [0.51481932547195997 -1.1136174150607825 0.66782149756500131 0.61844347058600602 1.4510662165876436 0.92880860725997216 1.679878980606929 -1.2387733287000884 0.39492497306878427 -0.76406742055383381 -1.3677347317699924 -1.3327319979922998 0.0058314519891597798 0.94570097282613597 0.36306691126528207];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.752688172043;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
