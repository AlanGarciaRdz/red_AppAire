function [Y,Xf,Af] = O3atemajac3(X,~,~)
%O3ATEMAJAC3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:35.
% 
% [Y] = O3atemajac3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.201288244766506;4.04040404040404;166.666666666667;0.0561797752808989;0.00614628149969269;9.52380952380952];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.6759461325731841;-2.2493968765149934;2.4181145098088086;-1.228278527391645;1.8389570254846506;-0.3871528941403205;2.7127029226073787;1.4007778741293273;0.33104394257546799;-0.37194247791134394;1.0788239991841024;-0.65013369287062839;-0.80091492326220515;-0.49544402857484049;0.86390030764071646];
  IW1_1 = [1.9157278394455806 -0.17670192296040935 -1.9276514506217439 0.51487205183435059 -0.12918441837093261 0.16107368494208452 -0.072135567877779319 -1.2751679960614277;0.30969017865401122 0.12129778206152356 0.20669373273231109 0.89192157904499547 -0.60787905800561093 -1.5576712754816082 -0.24815255890466736 0.7128301160694005;-0.7594703730764395 -0.56582503142855012 1.3159247044871547 -0.15712273888748537 1.1022022285715376 0.18206958382055763 0.44333154452170265 -0.70785658527622175;3.5283908892776674 -1.9144617757752955 0.56149124020986552 0.34532553463408849 0.70239379058409235 0.25437739781156199 -0.13669826972246213 1.3829639038540384;-0.37903865953304111 -0.28761664896541816 -0.82955566345440579 1.1663338761015232 -0.28141552936367037 -0.19759545211172017 -0.52877514658579305 1.9020045417322027;-0.22252864913153361 -0.75735928170037214 0.55895119629853784 0.55475455642976512 -0.8578478512160429 -0.16675994485385573 -0.44897667771089844 1.8711537531331106;0.48923733168894312 0.23651609127562151 0.63748099297735272 -1.2498915589125148 0.23478131833043717 0.43073520302080359 0.25090406701961721 2.3441615256605011;2.2557726284145607 0.91945306246671454 2.2553448247529357 -0.10693546135920143 0.21861855564653687 -0.026290432394554801 0.32768856310224476 1.5370179776511337;-3.0481326188114859 -1.0404304673114351 0.98711457007337566 -0.33644262729788754 -1.0890864799984104 -0.87631063465058578 -0.42828391997333615 1.9438155256424938;-0.25007466093888353 0.55992466262478346 -0.3802005796862411 -0.11349280534648708 -0.34207099669848218 0.13573968185272656 -0.037708335018059744 1.7569584196717725;2.2829962677685005 1.1069448298445761 -1.7489401492171146 2.8793752462567714 -0.97947025839835411 -1.1154105648745842 0.87598827137250457 -0.026626090398157887;-0.068566083961881158 -1.7452057003479109 -0.67387979056689562 1.1902570455455974 0.26997671765455866 0.68642084408597281 0.1841182478778905 1.8031017324968961;-0.25051980495293119 -0.49239682761287507 0.1662642303173883 -0.96547028288438286 0.58117492309400798 0.1340505285025004 0.41763419074369484 0.13026867096348185;-0.076380140458571597 -2.067563889708492 0.43931392655150697 -1.2353848529305509 -0.2357544294857708 0.59517181081248793 -0.035548850445697291 0.75816750482983852;3.1689139837425624 0.44115724847069365 -0.50831462930529347 0.17047116676237548 0.040991032371279219 0.19106531030074084 0.062867116243083332 -0.068958091604915103];
  
  % Layer 2
  b2 = [-2.0540738861437227;-1.3727174342100241;-1.7845015168804408;1.2010037805463569;-1.5625164926300148;-0.35374140706635204;0.46527811525593415;0.55112249901805233;0.22855890979972512;1.8200769664473817;-0.52675654237124003;0.12713944252520559;-2.1557023335969321;0.91413471906128096;1.8733023294292712];
  LW2_1 = [0.33404251729657947 0.60462492830509262 0.41501122090862241 -0.42251964889810262 -0.26727122843343143 -0.038464095115325905 -0.834873858608707 0.075457630765869629 0.17942025425566271 1.1480836453912051 -0.25195048248705476 -1.2631703500160398 -0.21624613999266487 -1.2591505216131973 0.78945193865744456;-0.18646059733144418 0.56122637439263123 0.34917111064672646 -0.25325933355430208 0.98073202751023203 -0.83697494657156257 0.5620361826644088 0.21586041989003396 -0.66486141919456743 -0.29194802882619236 0.11949918429444142 -1.1801982181454247 0.88556859223486883 -1.3397511443208596 -1.0908757840303085;0.46129187565777646 0.35842681787935876 0.26803073144788481 -0.58674263041377139 -0.77352936569679842 -0.21033719815031884 0.9196743671803187 -0.05165394547489497 0.73055474101608142 -0.28458356647475069 0.39477641994386875 1.5153528572729065 -0.92300171669354136 0.86116882445683951 1.2633619299881353;-1.5072558795669304 0.09538252616190869 0.91120935488826271 -0.2443049746286842 0.47103181448315934 -0.13637786713473965 -0.44119168067140418 1.3060070885800725 0.93494955765588539 1.4697473830679351 0.15071910635431399 2.1444464660115403 0.25635019147061844 -0.066141550891504919 -0.20700944484567091;0.1640358643353525 0.9656843925690074 1.9675773767340463 -1.1932060081730518 -0.023483763355173715 2.2681617789581048 -0.68172489386539881 0.41283427533648209 -0.83500599373511064 1.1692845330655603 -0.18408785913363818 -0.64633079238635505 0.67184318994274095 1.0113283891379403 0.39804068965406603;-0.63428345471872005 1.3395044343696794 0.10357598170125176 0.10425537459750894 0.16180862565453549 0.51563057083099662 0.65731511038643908 -0.17927729469548154 0.0035604113965792637 -1.1122501707984549 0.31829804512285181 0.48057346408778445 0.09216123369779454 0.64505247609460581 0.84733031318132546;0.8754979555632908 -0.31457137650571437 -0.22902249412570572 -0.21094812902677768 -0.0058959862143623453 1.4330167336549846 -0.31086473621381089 0.42247267642011266 -0.093388440512539375 0.7550826208723137 -0.14570669376387033 -0.92483877663836644 -0.07673429622053983 -0.49630736043360413 0.6529013617351741;0.29277934367505204 -0.31842741155569626 -0.24493389351900591 -0.33903679486220045 -0.29779322116195339 2.102657444940546 0.48480688186628601 0.2784355365211385 0.41741836924491588 -0.83464706768115315 0.50645729925718563 0.50158901971004477 -0.17366774106127644 1.0086245715068345 0.10661863721892922;-0.67359371717172811 -0.71092068880540038 0.45794941601553446 -0.60381226879002159 0.21714167051658875 -0.31403694530575782 0.83248695463420797 -0.51363194666231615 0.98352249886469578 0.81523021412366481 0.083389139243822893 0.50995847925627291 -0.24818952892557195 0.11673962425736092 -0.17153665950873745;1.4027468584991942 -1.257648404311869 0.65394556155259087 0.58231016929683077 0.48664223853112448 1.7037138045262232 0.55990406019124805 -0.028088793185684462 -0.10661278675399571 -0.20395958523459928 0.41857487535071891 -0.65562989446502595 0.74399343770629334 -1.1466549437592453 -1.1123138488132089;-0.51061573307868235 -0.71748987387259278 0.55996801539120855 -0.21078198223829273 -0.62186979218042671 0.00039223472440653995 -1.2093713874125924 -0.64181471915562294 -0.049243515046224609 1.2362841305729007 -0.22455493319256775 -0.58530133366895998 -0.82975189501681001 -0.032565025632685846 -0.54791407807023507;-1.4801716484912397 -0.55437005777267601 0.6655521016844369 -0.10586494845727554 -0.29675631865336166 -2.0468118674296698 -1.1186529709664053 0.98111821532312393 -0.075960932457166772 0.37106008011111613 -0.60227163722192811 0.26232046613169541 -0.57532794008019728 -0.3385343943530536 2.2798461253995566;-2.2345464798180692 1.4127000372662775 1.7617811417567513 0.029841036066570611 -0.45440253009443615 1.7373428145131469 -0.1996993604336493 -0.14058955495260539 -0.083634324248875486 -0.25892962530636132 -0.86633555606052659 -0.23310432322170133 -1.0619220742683557 0.82547238938081791 1.4397862198203746;-0.034811858108184601 -0.6575288333678444 0.039970069315256124 -0.26598455313991382 0.61509470170894387 0.42854761989323281 0.16951045934356465 0.27933524504972024 0.21172317220666381 0.38694392458007121 -0.036966233165578927 -0.50127667686672561 0.64682002830204155 -0.58605566444964896 -0.90882037277191785;0.2254811712300544 -0.56501506704281035 -0.4556560303239594 0.16748506898125676 -1.2229643055487216 -1.2797893270089016 0.30028158195713239 -0.6415628129669062 -0.42854420389444842 0.43228148733010224 -0.23477143760974009 0.44834809754868832 -0.34802718057657578 -0.40565677820654555 -0.79941487939785782];
  
  % Layer 3
  b3 = -2.2339879196517383;
  LW3_2 = [-0.91588047331697442 -1.0676193037612194 1.0039529101581548 0.12579114394011898 2.7041489625730577 2.504499902149512 1.5595279239322388 -1.5662501027249238 -0.76535422420117782 2.3124370960946732 1.3231189976072697 -0.66717886947943073 0.57247947277521405 2.1999940822124966 3.8613088069500678];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 9.52380952380952;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
