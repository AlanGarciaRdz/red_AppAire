function [Y,Xf,Af] = NOXOblatos5(X,~,~)
%NOXOBLATOS5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:31.
% 
% [Y] = NOXOblatos5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;-10;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.100381449508131;4.05679513184584;0.195790504160548;0.00618238021638331;117.647058823529;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [-0.10928308431424598;-0.25913578443153201;-2.9440908611856726;-0.56198834394343966;-3.4373735506607108;0.16868887069108734;1.2129984236055267;0.18238002532613468;-2.1895677164858651;-2.0843936168716728;-3.7456762496953031;2.4271341927628796];
IW1_1 = [-4.044084304604036 -0.19700554032935264 -0.15013572159258654 -2.687610765632559 -0.39862996680839663 -0.0076634436289996621 -1.1447378138366135 -0.93803765234907321;-2.0016810086241774 2.4140021851979085 1.0753719870818828 -0.49381638753147622 1.3187965975820977 0.28550931509841443 -0.48916752934628488 -0.069685399981971458;1.0715851803432601 3.5628476380920397 -0.30456337850499005 -1.320684038422709 -0.48623365731000268 -0.86606753676448212 -0.11599780395652851 0.35062610664927163;1.0304215592664914 0.5593777788920804 -0.27580637664610508 0.74994453668488281 -1.4178606683308532 0.035284132175026767 1.2316986378069312 -0.24811397525343371;3.5641009266273334 0.10912988378243209 0.48425788439660972 -1.2950006189684937 -1.9614094623295737 -0.38852210037685964 -0.93556429268780272 -0.53097073525281802;-1.8290141394134056 1.2157696610483479 0.25236729839807409 -0.66927927272311483 -2.5194423939226254 -1.3207047677719752 0.38823718951511255 0.73510867392547452;2.0050033756264538 1.6636110654381959 -2.693696878958669 4.3491003135047848 1.2634038522899604 -0.57833048268115339 0.0082579935031123226 -0.059197343609815892;-7.3933228082487945 -0.704499659377128 1.2032972021988622 -3.5335845077860184 2.9015616329515699 -0.57772537704025928 -0.16642634825034708 -0.23918758192177825;-1.5831682140629333 -0.73883742066489055 -0.92334356655476735 0.93934611780797261 -0.26582807889295645 -0.72350673484736006 0.76392777931803002 1.0481431156928416;-1.144940235613003 3.1503361457095247 -2.9422118707653708 1.0904485112363334 0.56125115073743848 1.1724079867557899 0.86227452799090798 0.34678302458897159;-0.3672768386909705 -5.4327670833782165 0.61632096517338175 -0.56155822161384517 -0.2190445809049833 0.39592263004174594 -0.14896299659659895 -0.33431149116553682;1.8517890008487792 -0.5584459852996867 2.0401203866305266 0.88749422627560248 1.1232201472562613 0.97460755173852953 -1.3199351642481676 -1.2023888593380057];

% Layer 2
b2 = [0.94461169935284728;-1.3312639190920896;-1.1046551120975174;0.71169190683136097;-0.8215382566068905;1.204083950117278;0.14951367907387544;1.1793549643201886;-1.0795378376205444;-0.87344485098248592;-2.0119014287080983;-2.0589661623993534];
LW2_1 = [0.5139965923596479 -0.35933364920955529 0.24442919458952433 0.025203977609831233 -0.36127654819762622 -0.23872827570666078 -0.13120929066886144 -1.0345485042733222 1.5485003957498342 -0.82135006411220335 1.0925939661997806 -0.14888540111774401;0.48048955164224794 1.8101093868832667 -1.149237568038757 0.3179455031399353 0.92689003695744443 0.67118251145663133 1.0655293427686332 1.0668470172025992 0.37163108309712156 -0.20107718505443117 0.61872908059885945 1.0003439169693282;0.752903613163588 -1.0003229198909085 0.0011856758742621917 0.68160037918339633 -0.61300419199279699 -0.73264295744061947 -0.41379446221622113 0.92039917692743223 0.52815330334292077 -0.94583990275811936 -1.0193268779961551 -0.43027966818779251;1.1867656007338607 -1.4850395192263739 -0.64816115183469447 -0.89548270727089552 0.54493579068235742 0.80528158706405861 0.32956344563793488 0.017856842617679114 0.077653452301946299 -0.58735271094106112 0.21668918821388727 0.63796989429457263;2.5347611810406878 -0.55350596174452482 0.83582977560281024 -1.126295854230617 -2.1318216858400936 -0.39574880362418596 0.83729869112225075 -2.3328210738198467 0.64478306422191045 0.50481114254722081 1.1219960623842362 -0.76385824154079085;-0.058441631806853682 -1.103087069803921 0.21865372134182595 -0.18941700592812577 -0.050377607845200276 1.1003685210208174 0.44069724645020347 -1.9804566489260533 -0.63655275247040299 0.9471673424528213 -0.87636216014045343 0.7581582680974297;-0.16895107575022686 0.55182299074417451 0.41588350924084277 -0.22761356027014421 -0.2502485325174913 -0.66493501085203255 0.098578134597785722 -0.071017264453649573 -1.162964016312134 1.6582119712596974 -1.4737150503390277 0.46582013885292167;-0.40452241789133808 -0.31900592834363145 -0.50735692706299351 1.1501251376890096 0.7323557343022038 0.30939729301349433 -0.73241226710808971 0.76903889833704409 -0.71031108783602659 -0.54798558935340347 0.15386842763196965 0.53652607469586355;-2.5098313787074278 -0.039509815544122806 -0.7230650127619993 -2.1564878125904867 2.3276915658310435 1.304910499045328 -0.30655307232778567 1.5031841375310961 0.63925306175042651 -0.75357994150587981 -1.4890794406560413 1.016978648391391;-1.0306393041990034 0.02818535106350252 0.89038381857759252 -1.1166736316433308 -0.53949932615862384 0.1865662395024934 -0.12525907108662684 0.24944478150168506 -0.09837702584253348 0.75397571894016802 0.12396161214029064 0.073580057193145573;-0.27719308920446711 -0.10606761266429485 -0.15508091400213028 0.17655247480182781 0.18918508397514266 0.37120635657466738 0.29324944149036664 0.3697604961387056 0.72644642247602587 0.23411594741589231 -1.8724651955854044 0.57302027245263021;-0.34226437321853276 -0.17702249297169537 -0.35284734046176741 -0.21568410163297594 0.1298734628907478 1.2951912492599105 -0.36622910106649276 1.5700013433632145 1.1710150984327647 -0.16916368193746775 -1.301577169644158 1.0378633016318703];

% Layer 3
b3 = -0.059103268401604639;
LW3_2 = [2.3386423955585176 0.30991736954832283 0.99914534001161259 -0.41926392994765732 -1.1115475174032845 0.99172528765633594 0.91114342904128565 -1.4923714140724089 -0.74678569220557789 -0.32919520442938954 -0.91857531959591432 0.95131207898758829];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
