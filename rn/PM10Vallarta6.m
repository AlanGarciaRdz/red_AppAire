function [Y,Xf,Af] = PM10Vallarta6(X,~,~)
%PM10VALLARTA6 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:45.
% 
% [Y] = PM10Vallarta6(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.12820512820513;0.00782778864970646;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.367735064131848;-1.8239979340958685;1.1517754891514749;-1.0392506565316424;0.076678062860004073;1.7240615237176879;0.043809781376099421;2.2695353671470038;-3.044509472589275;2.302990548157025;-2.5104777519761527;-3.708527121198578];
IW1_1 = [1.0910877421849601 -0.53229766859028527 0.10064202441022831 -0.26213749841042422 -0.38360203467970044 -0.35260659156514135 -0.12044428712636965 -0.15337731865449172;3.2680279659751714 -0.074279607160176508 -0.25610344843302774 -0.26504652247136218 1.163892726255592 1.2396465053967547 -0.2350173469835298 0.10466041602675556;-0.97565136144345632 -2.3290394803153531 0.78724123992298711 0.57843349756444085 -3.9701936228496337 -0.50280160815378927 2.7180232633148091 -1.0231876771605786;-0.67711732576724959 -1.042167891259745 0.037106612041218102 0.21726235635062646 -0.52527193368394076 2.5229097858775598 -0.096750681724026233 -1.2538587573941991;-0.89585404365436305 -0.33484707084056448 0.070802471833630046 1.6334075607969589 -2.1116752310109193 4.5181263696758718 -0.65307278877189023 -1.1287654530905971;1.9004283084319589 0.026212963883976401 -0.13728506376143434 -0.062690280274184634 0.66935480739312869 -0.10916467651083424 0.012407108062930043 0.38806389223297544;0.68638253034239005 0.30995087197911403 -0.0042666291082025529 0.15731527271924856 0.54173409194023647 -1.9184949203458699 0.19572254614831769 -0.084742710944065464;0.10156918123590344 2.4674858831722513 0.27684106246740614 -0.57247606856263356 -0.59844460836910385 3.4915611441317318 0.014642857664276202 -0.11303834864453075;8.0885115696430656 -0.80795921389751801 -1.0684687759685758 1.4985562591689021 1.965772887960721 3.347636528476948 -0.083625582703587997 0.51474948385511998;1.0562532268173634 -0.67986526654359203 -0.02901502407796025 -0.6812961603369091 -0.61916632604812782 -0.026660363422832511 1.5107669181793428 -0.18228642674299692;-2.5856199578644028 0.083823547339162086 -0.47549972532028484 0.60698071875643955 -1.4639534521633135 -0.12539978365740645 -0.29064285577525245 -0.95469619432143593;2.395456605756316 1.34212833872648 0.18081039241915936 -0.085539479156168802 -1.4129640031053667 -0.35920747775381723 0.16353667867865126 0.12430684111268799];

% Layer 2
b2 = [-2.0153866694429006;0.1443235499728095;-0.51436961463356579;1.1212506958043722;1.9235163184277284;0.27565378111570904;-1.6731418053168892;-0.58211855344107144;-0.012261295856340226;-0.47349255319397299;-0.17493426367284856;-0.12764978304309951];
LW2_1 = [4.652019553563167 -0.65262558890954314 0.3682784905686477 -5.0237131261504544 1.0599148375024645 0.81899288078100074 0.44597446778866956 -1.7682994393827669 -0.58293430130946233 -0.23538338872591558 0.79702142429920808 1.2277485642599255;0.25250976553004134 -2.0447167942318627 -2.8079887267207093 -0.38474359284508142 -0.14625709992906208 0.8632265526021462 -1.4952262662166296 0.90948479373766955 -0.74554814530815117 1.2555884762710547 -0.86132621832012102 -1.5495998265983002;1.9028523369175101 1.4958568626187545 0.64108842576992842 -1.5516820085585972 -0.21699791748697431 -2.3189592138422173 -0.98247904130138053 0.83693055948629136 -0.72406377437022063 -1.3437781725201408 -1.2434689370756331 -0.013006188841549471;0.0086376142807264682 -0.47348824469619255 -0.11181234492796413 -0.44059641135911598 0.35741674125320588 -2.1254617454744253 0.62196506981071364 0.71716779957780041 0.7372510470006558 -0.094402117995052576 -0.21253956563684362 -0.5412440055471488;2.0721109614350257 -2.0341719239205802 -0.52270894380636135 -1.1247273207438848 -0.28170022297836306 -0.06388743472886356 -0.038162983420074265 1.6344627692705989 0.28158055721896608 -0.3967205018901353 1.4497699650827673 2.6414149943071381;-1.1132180438313508 -4.5729412768469784 2.0440968935984989 -2.8343484956069145 -0.51301164050663428 0.17567234334634657 -3.0131729272511203 -2.9938485580635588 2.533519135728147 0.94982707993207027 -0.4470188369023968 1.809651688251503;-2.0509637848322169 -1.8450194553172412 1.6746568857640567 0.047432493167591863 0.64666206546524074 1.4832211943519182 2.8588771823776922 0.76170275031746093 -0.3172204205957726 -1.6288414236911317 -0.26277817248622953 0.1380272155516995;-1.7729928030106181 0.52490219739742516 -0.9744718158519845 1.2084933554730826 0.012984826722483918 2.9990536483707446 1.2733498006936728 0.10511330588929599 1.5880893554261959 -0.38287710838755262 0.7569890635639217 -0.56453591666456815;3.950314865311817 -1.4673766656839162 -1.1776161809568217 -2.141983509509584 -0.97474786111397982 2.7177429066400722 -1.2609224730509843 0.29316306745854182 -2.2300974263296385 -1.0604776221671859 1.3302644352021031 -0.12807893571640189;2.7931039612288973 3.0496610992737954 -0.55419492303644924 -2.8873351445013067 0.024015886304817904 0.29809702480196187 -1.5342700909931495 0.30619827571935154 -1.8120770404187636 0.38021551754389715 2.2121169118623514 0.47730348120720534;-0.19366628815961487 1.1168705193435633 3.147612983415204 0.88651828648706954 0.23719552123738608 -5.9560888978167315 0.42506837429111871 0.64263504215966527 -0.083778202378826827 1.8419524086723189 -1.1211906391959705 0.45352743902558462;-0.3236487353919737 -0.75166238256225149 -0.24682982602072537 -0.0043536133706981658 0.26626620677483759 -1.9673339367984612 0.58217042729257718 0.52525359516796011 0.85832965393837146 1.0700027903360361 -0.30366608623159602 -0.49478467218935629];

% Layer 3
b3 = -2.2556524591055513;
LW3_2 = [-0.10973167892793297 0.53535902095283094 -1.0282871655308681 1.9753741284710864 -0.31701147917346184 0.48250935984924403 0.26020517717579589 0.43097408368614099 -0.11727428639810626 0.39309421770732689 0.36056673982394083 -2.3387088794991095];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
