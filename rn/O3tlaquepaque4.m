function [Y,Xf,Af] = O3tlaquepaque4(X,~,~)
%O3TLAQUEPAQUE4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:51.
% 
% [Y] = O3tlaquepaque4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 13xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.171659085057077;3.03490136570561;14.7058823529412;15.3846153846154;10.752688172043;10.4712041884817;0.0212539851222104;29.8507462686567;0.0523560209424084;0.00624804748516089;14.7058823529412];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.0979823155987085;4.6631759135318847;-1.5069865010530674;-0.80350866954225886;0.19078899904463734;-0.89745322298402141;1.1407453595286272;0.30697541229403819;0.84124405912070566;-0.5187175129159558;-1.6434531544393747;-0.93871611935932342;1.1408090384565457;0.36869806380707848];
  IW1_1 = [0.46380601099419955 0.80147930026158642 -0.45813557367671864 -0.71363341041131279 0.29995689143432364 0.40473187584720893 0.72459265929624461 0.4525001474692365 2.0301563114984029 -1.3248499746368665 -2.1693495632736819 0.4164526584410953 -0.50814096263173458;-0.37958936368544671 0.12859252658721945 0.75559255366294154 -0.11892739365342567 0.7525491374708575 -0.26764645054172165 -0.39646657866657242 -0.0919911230497448 -0.54708338401242618 -0.57975104341759276 -0.16740266806882159 -0.22958304957140768 3.8240019296843046;0.55399966579600657 2.0165463850446765 -0.065378786857759552 -1.0312434322930251 0.011286189838824429 -0.75480278311505689 -0.39588762790916521 -0.89388216478509708 0.032073594240623934 -0.0017400135506137893 0.51473181423716063 -0.39034240036042889 0.58204645285876877;0.16244307975428457 0.40361787553522332 1.0493230091202708 -0.88855558119020162 0.62040266839735458 0.6396568609795874 -0.34531942807363986 -0.9993031091261233 0.29466841354987988 0.32395966650644537 -0.82282054902901458 -0.084082097500154412 0.98334890549652276;-2.606008768164084 0.16238791422987645 -0.54290308384560382 -0.91944654159298378 -0.11519628302730245 0.16004238742832583 0.36032833907457951 0.19451822110600991 0.41309234025157016 -0.44964137353904687 -0.0020579459716929156 -0.010503638724100395 0.86734868338144422;-0.26211197851442297 0.28090255806553566 0.51991280356900493 -0.46808350253239617 -0.28856634658259411 0.5007733758365821 -0.34940662517759369 1.4696575660943305 -0.82295529954187385 -0.79038220811930082 -0.40616509748043744 -0.59062143295072234 0.35562660954460434;-1.2247274997435285 -1.0538461622889912 0.29056448843067623 -0.98219439677956644 -0.32539005196847881 -0.45223377306315965 -0.15220476693589538 -0.81151112370541001 1.1119860983881211 0.85263513826047455 -0.68357307480420615 -0.69358279072360984 0.29724080961966004;-1.5721643887686865 0.080275846399652878 0.25695619746447845 1.9068688230671673 0.013362291700820414 -0.23910738268452864 -0.25470780202206805 -0.21291155655744495 0.0078168339541820099 -1.0403841224926551 -0.031997310979666169 -0.0085470924966353917 0.067782475707264075;-0.38870625148759708 0.04833937153272197 -0.36140842184853317 -0.93339511519568286 0.25078117845174736 -0.14743502657876312 0.55266114117519338 0.42845027602822189 -1.3502373422073672 0.49078885900722485 -3.0268544026291875 -0.60996559635682002 -0.75083004336290005;-0.56039848353652733 0.62401302632595879 -0.28677205352800761 -0.057674204541642245 -0.042460779883092908 -0.24808416646753262 -0.15227453122520654 -0.44029388234943823 -0.094537138078220354 -0.37716031175557219 0.19408201611408668 0.044811758516206376 -0.86983447026948024;-2.7994164056964546 -0.024765118665005456 -0.37484318678404721 -0.35332134035001911 0.13423358173520475 -0.015884704629812653 0.18817900869103699 -0.22593363004252315 0.27748453048970995 -0.40625702970512328 0.028992612028728104 0.098153980351454478 -0.13723904994886332;-0.72220703505191108 0.063088611444139506 0.17625955715393415 -1.1617320593413578 0.54672136591504061 -0.026329654251401324 0.15303923113195111 -0.36358035766135915 0.16765987813281658 0.20881904661374073 0.03621007682491599 0.052379233363269093 0.49785064980910104;0.25616018007097979 -0.0014593854223875699 0.20053746487402863 -0.67170474879107311 1.0575005197313996 -0.41033737747047638 -0.22787338266469864 -0.1814111580544874 -0.19673166739916997 -1.0081024137236851 -0.032212853038570535 -0.15942716833287451 0.17813011332009723;0.76217268869702703 2.9468257163977833 0.21139344304426802 -1.9214922577041276 -1.7978191479023 0.40464482739888424 -0.18372075596170179 0.23153905404681982 -0.024603913499085465 -1.3201912118428585 0.69827222728495741 -0.52479563145742358 3.3875992107491464];
  
  % Layer 2
  b2 = [-1.9724183429826923;1.6429181506176784;-1.658931740733818;-0.44514497320958074;0.3138549968260857;-1.0687895508904386;-0.40500834058992347;-0.24284471909337302;-0.69731690762069665;-1.0030346541870296;0.61067403382373397;1.2367174008814885;-1.9458118598476439;2.3076479266473995];
  LW2_1 = [0.4433735655074742 1.343864426009969 -0.1866357764271874 0.91733250268421052 1.5194567543905038 0.32947274984635372 1.177320546168042 1.7720898197182788 -0.71270658875186554 -0.41379244728914638 -0.52902655565924905 -0.29142910174621961 -0.47582655655351686 -0.082182211313073655;-0.92249438073859147 1.4905955763710179 -0.11289497802083739 0.18613623748946453 0.63799592132950544 1.8740018010891359 -0.13804645276866906 2.7094939911078821 -0.58113185242809362 -2.17232288515501 1.6900964952137043 0.18655707622163417 -0.57374758322183494 -0.039059733410681904;-0.026144974771921802 0.071115186726818561 0.33075712539019386 0.12266919573109152 -0.29503568104398503 -0.27542497796755011 0.15095018657673709 0.37015410250687575 -0.20086317846719051 1.4531387683313428 0.3852234577179055 0.096843735854933735 -0.40878252660157244 -0.24912742093135321;0.57864560267812115 0.67889703668662749 0.51985661947080863 0.16166251364819506 -1.0389582225095237 -0.2337270655904915 -0.34729043609090454 -0.31572008353981462 0.075856009643124861 -1.2041434697427655 1.2675318465955927 -0.82460460723097462 1.3316909137886135 -0.16812331861151675;0.7620072819719641 0.46318156593323356 0.61449262357294598 0.019443291947426715 -0.73143307573957894 0.36355041054227216 -0.40297402192172704 0.21791927469648401 -0.031208216133101381 -0.91033642200831522 0.57096299168410458 -0.74116522979796562 0.98269557916144301 -0.29769216267979953;1.0383466389989153 -0.033025024531913749 -0.67233480674141832 0.96426775039226031 2.2457078971458655 1.2587236619953643 0.6708029215694048 0.35709308945053975 -1.2597508273923148 2.0456263436220414 -0.22470324402920855 -1.4303729829171967 -1.1191204651857749 -0.058050664452816716;-0.083357283751732056 0.43077368179385267 0.46165419103300931 -0.84270028608460035 -0.21418007841338332 -0.74672761349517036 -0.33104488188802461 0.18871455605276069 -0.038776610771386 -0.31285627486277939 0.5936725463239475 -0.23495100776145783 -0.7525020657969983 -0.036800617939873513;0.19778092560246796 -0.11159077178948582 -0.48345470160914022 0.085178956944061412 0.74538874225765084 -0.0092315268254688151 -0.20591858780399883 -0.37470577020644563 0.079469167445561692 0.28598100605443871 -0.56818706154034293 -0.25079840255060992 -0.44258071463411819 0.51334347927758317;-0.18805191209471722 -0.70780861059582123 0.77844085145135977 -0.69608870201787409 -0.17797359799614923 -0.23488006513202217 -0.35936610849652123 0.50205170058950299 0.090799359586548625 -0.019942186247502866 -0.67579077550648792 1.2688952057841019 0.49531258279363544 -0.50483320346470162;0.24987730527155175 -0.30442652498057515 0.45186901745882202 -0.8501490592657418 -0.65969050533468876 0.8348976529153016 -0.20825395575992711 -0.015282884316494563 -0.5891949121908957 -0.69372348693822083 0.35657477723715358 1.2323693043195902 -0.45617814816609936 0.69123888731954064;0.134120919791898 -0.49767702458329766 -0.82594807512738089 0.76462020016282373 0.65972273586211794 0.25141627490437213 0.047895547886699745 -0.75851828165963142 0.18210088484945786 0.45266054636767716 -0.59299951081799729 0.2363254365226648 -0.66376605143675615 0.66955011929206976;0.51408233620494248 0.4319257147378589 0.45645119765382086 0.42480068255134146 -0.85146308281092997 -0.55004233867432628 -0.17293176995625698 -1.0546662523905659 0.079933582807670558 -0.10693336256176394 1.2731960536951223 -0.09107451314929188 0.024760210191801191 0.53009705280807362;-0.83931594871467163 -0.4897087362555918 -0.52946893573378673 0.26909662052627265 1.9647214564573547 -0.062392863029585965 0.40757648284867443 0.12490515755545092 0.76236154021877611 -0.50136035895453435 -1.3537932660321368 0.44185842724001101 -0.76438936182320938 -0.57542269927017176;-0.23301995407835288 2.0433578233624825 -1.8944459669187395 -0.57066057644299018 -1.8562158398856594 -0.63153442992378361 -1.7228886811667325 -0.95235111927039506 0.074877642567558841 1.3540036902094004 1.7446089866641803 1.2175272867276978 -0.26043061055658112 1.3575496750080585];
  
  % Layer 3
  b3 = -0.61113194959543926;
  LW3_2 = [0.63370063234122886 -0.37461566331513546 -0.95635642248648012 -1.9113836969796196 1.6540786150205014 -0.24942116222904409 0.84156706223382316 -1.0214348761807894 -0.3835082928304448 1.1795407463665815 0.815764199777544 0.57703496843546875 1.2526117074479224 1.0526229042066284];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 14.7058823529412;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
