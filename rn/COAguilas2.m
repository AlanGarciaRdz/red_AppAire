function [Y,Xf,Af] = COAguilas2(X,~,~)
%COAGUILAS2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:17.
% 
% [Y] = COAguilas2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.448430493273543;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125;0.281968137600451;0.304971027752364];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.2713002566348037;1.4262212944854396;2.1700943338861443;0.88824232880710452;-0.51563397291420643;-1.7009382327097378;1.9597164111554413;-0.24749180369103957;0.30004697339034792;-0.28245250973033831;-0.10075881370362863;0.91516447359746189;1.3185354005519729;2.2050781889103015;-3.2544795182149371];
IW1_1 = [0.030402276981659582 4.0801410747466047 -1.074451658900246 1.0944702771258841 -0.29642870546463962 0.0084936651214523266 -0.6500359787100165 0.0082076634513290753 0.04380027650477588 0.26812171839634397 0.32424075829709015 -0.14017016003971824;-1.2173064698937153 -0.33157435514137834 -0.82626856998305476 -0.39310313518618362 0.60108603539384176 0.55508330251928528 -0.8538392752769044 -0.47572673014652167 -0.084834612376560162 0.17450308019561031 0.21280165466167816 -0.98360790726141667;-1.2122438214424802 -1.0842169962556312 -0.19651073938207275 0.14680819658402813 0.039081069838212426 1.1778686326918186 -0.36480226153387008 -0.9084195093624241 0.42561361281181537 -0.8609898334112992 -0.25807267961056962 -0.12833652707286644;-0.070467532438849317 4.1671319409091057 -0.014990163080093476 0.21350730607824017 0.071380030590801405 -0.033507804467878287 0.024728547126268839 -0.07429064249712776 -0.19082210803467459 -0.3927554530245459 -0.6892506180530944 -0.2730507194586016;0.027953684924532381 1.1922014511029064 0.26268973199899426 0.48881854795914093 0.68834185711747553 0.7075262294826864 -0.71097094115043002 -1.4351848799059361 0.034271650596694063 0.59186605814705251 0.41414698002748984 0.17067306022734025;-0.037312992841438387 -2.036853697107881 0.028323578325522111 0.31941772413912051 -0.24694498775016266 0.12906581827458352 -0.46713401110513769 0.93068181453252508 0.47936806160788625 0.085321746007431559 0.17630185639651533 0.039859543239482528;-0.33705331439635927 -0.22813473162932402 1.8671618954486056 0.27161323682433802 0.3046322137109333 -0.027723325432408352 0.068027915815836781 -0.35115560862971729 0.168288848381803 -0.13366908959905527 -0.37301914262431873 0.083566324360411934;0.90581616553593369 0.047288328267924257 0.93504531300163052 -0.9550297731191334 0.13875351830161772 -0.37887382932473951 1.0178877449894213 -0.02471531818705229 -0.12789778962498144 -0.033874940574933954 0.50168970930910706 0.56303565983388437;-0.24397406556189144 0.26057919154985254 -1.2728888898782731 0.040067097439460055 -0.020709436890486346 -0.34086738165408342 -0.10757378819224674 0.68238980259950788 -0.02228534488869011 0.47233413586609979 -0.35770534710653362 -0.24463073234620364;1.6326991906483446 -0.38957589866370085 -0.0025491692793585393 0.65939837120978118 0.13262349386003272 0.016534633112261672 -0.77580568850326292 -0.049861731039132724 0.14800405948795636 0.094114033263695995 0.27409499551812216 -0.46051801515824153;-1.0227980068965938 -0.047623292736582744 1.1814774367735488 -1.2125534312880735 -0.547022233904774 0.59407697151128935 0.031909489089955501 0.96527459637148794 -0.11733934151123346 0.1317195407397849 -0.19253349637445805 0.23437360423140197;0.49081113164384083 0.19974265066158881 -0.14599649879688528 -0.27399891646634195 -0.23954219955475606 -0.54426650494780648 0.18394357126850944 -0.48070964050668441 -0.15085243240681695 0.37774385581949943 0.78597683270799645 0.24237916828253731;0.39359768435671605 0.25664315620758243 0.083949201165031462 -0.47165391615720759 -0.22587754948455371 0.30510417758426389 -0.061157363849853957 -0.16701226108481693 -0.28868798558076053 -0.45814653411700679 0.0127002194184897 0.018767083741531694;0.49809953074528901 1.7129627214934131 -0.56178067956183697 -0.025760065061084639 0.51515157152460245 0.31280257782911702 0.42479016648462825 -0.42224178858578265 -0.23435727276962873 0.31924757060450026 0.26523164411635075 -0.059680317720397953;-0.10958140397039023 -5.9755661921627929 1.0312146347371636 -0.42988850901669701 0.12427173698986228 0.026755499130008235 0.11378598973549367 -0.23233536012653064 0.11704620053099815 -0.14853923802987157 -0.11931406116369624 0.13702199103967949];

% Layer 2
b2 = [-1.6341132528071807;1.331762803155617;-1.2044043912077147;0.90111568591184521;0.40772385745222034;0.98174854306822434;-0.29122788807986516;-0.091953862512601653;0.14847701167108096;-0.020723327582425805;-0.80176285628912369;-1.2059359415387843;1.0806470306161111;0.71363834837155327;1.8191412606208739];
LW2_1 = [2.0118861275300417 -0.79936411054116052 -0.75410697447668229 0.040959705761165296 -0.6889398824428804 -0.74653001690265464 0.6506836814376119 0.28565836024780922 1.0703050909211071 0.61933445622037664 0.23266054665241134 -1.0003164629908528 -0.049561253595106998 0.031176978277765475 0.25378695520844374;-0.28168329339232434 0.37466477061344328 -0.25129136784146816 -0.13477291084290716 -0.27691921884311932 0.4865693836223961 0.58900712820740952 -0.7337704245435559 0.47984014988567714 -0.21428270928426191 0.83685959725292591 -0.51740263297414479 0.48488699711304389 -0.037341410298293271 0.46813179045900871;0.42077909718752082 0.52261053924163325 0.2342387872226597 0.5389885113431836 -1.0224377809077003 -1.1274232853633606 -0.48791895284017511 0.26003974018693965 0.32343477933478221 0.54465692226814544 -0.87946828411331723 0.30694789279836088 0.3081212793424456 0.55722839402259428 0.06485647511653049;-0.21507036955738176 0.36306238068477986 0.14510129460401422 0.26057899933631029 0.42207015862948177 0.19383307149048898 -0.45634551008840452 -0.66551989496473551 0.90756767103371971 -0.08919830771071223 0.64913197000724998 0.22613353958556384 -0.057247466209263562 1.6036044330112982 0.4767737422165535;0.12865997038473515 0.21725541632767684 -0.55902456033528514 -0.17197500638355687 0.62645358171324483 -0.57313262720823299 0.069242563721092915 0.32513175572401737 0.47831733241201402 -0.15265426629747081 0.029105127924155885 -0.062488759308401962 -0.74288670807824275 -0.81587123510732318 -0.92226757829014105;-2.3637683688658848 0.95589437899100649 -0.042028360793856669 0.14357469724567373 0.70388973010170364 0.90236853211063228 -1.0830756288687486 -0.024801033061126087 0.022818431756269224 -0.33865818255680002 0.65495557495614276 0.70818030826514067 0.17010894094292003 0.71902240394767647 -0.14800519899771394;0.32364786990727118 0.028435618516423233 -0.40074900968577504 0.40510700261669275 0.27604246284689615 -0.22841925620192374 -0.86728852907982756 0.39662233517291373 0.13579775948334402 -0.67637642636737427 0.21505739806218738 0.54055548820818389 -0.66963093984988098 0.41430509226424944 -0.45746350152010384;1.0623005182211549 -0.11972921040813832 -0.28863569039636189 -0.14126464861718985 -0.353746367174328 0.696856044543671 0.19588751138524452 0.26949523386188801 -0.91043089534400079 -0.21850980511531118 -0.28315538350827846 0.77526780976919185 -0.50324128677361779 -0.30166217867959466 0.2087255304069206;-0.14408725627211294 0.55245230751471675 0.56444472036112758 -0.19904412021476492 -0.70492656804855558 -0.33536804129540754 0.94773235518888321 -0.064453376195532666 0.70259072572141879 -0.98284678607714038 0.31016056234945671 -0.47399947366013873 0.43281872588325171 -0.033818724764118735 0.96297888158649336;0.21848396836093764 0.51014538206594795 -0.78830847184556607 -0.2460265042310687 0.39797925404717044 0.38056760418851959 1.1414802149369216 -0.029252073027698909 0.34722366557487766 0.32246446050401073 0.20549079111765345 0.14130242719526503 0.31825939710120804 -0.17158322387137132 -0.44400178405904894;0.12781744890547461 0.47867779984684483 -0.48353779905914673 0.45183618472291071 0.5577384002334802 -0.3624135579067328 -0.13158342217486452 0.083482953074327834 0.16698186445224145 0.29387804983433646 0.32328171776663167 -0.1408036764371077 0.3493047707504609 -0.67359462296147798 0.86574009209568914;1.8978138612218234 -1.2758004778989336 -0.51845842127785036 -1.9344873254242236 -0.5926021534773821 -1.735094662133891 0.77670511436392131 -0.48511033132131937 0.088802199470571261 0.37344011601361815 -0.41195091997300826 -0.84189758046981811 -0.12986675081075205 -1.6708469401548764 -2.7606623924999401;0.59842052031921666 0.066261672828405435 0.1458900353452165 -0.75861314743495534 -0.77143562637596563 -0.050503134632963007 0.43013002848262993 0.13282432595650387 -0.12241128955801962 -0.90341127124704157 -0.23838940766791222 -0.58483477728558564 -0.26173510501664615 0.51854582468478838 -0.22468022823811221;-0.719036044722828 -0.87240875110393423 -0.052107323498383221 0.56223546845781014 0.47270058808997728 -0.076997154406428403 0.2386736995074476 -0.12120820616872108 -0.3585114841075091 1.063524648677441 0.67368467218954986 0.82380121949556018 -1.0685461429328185 -0.75745508366504399 -0.25139749797002975;-0.47910193943392221 -0.40075071219835795 0.5540124372042744 0.67406593100462509 0.064361768799131025 -0.75285359173677147 -1.2523889670669028 1.2426762679881145 -0.96039282391366376 -0.21292191233545527 0.39121320594218301 0.11098638118381682 0.03985453187383331 -0.38465593481886573 0.74694270942401053];

% Layer 3
b3 = -0.88032375972284949;
LW3_2 = [-0.97562820255128546 -0.75650869628031781 0.12134815019209942 -1.4547830231705685 -0.67350153095956511 1.4108424160297548 0.15815679068895 -0.80629751543196326 0.72737458465716154 1.1415977301167246 -0.60330700457317499 2.5109680296239922 -0.64141260598058047 -0.55531945361210344 0.62350593279019495];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
