function [Y,Xf,Af] = COVallarta1(X,~,~)
%COVALLARTA1 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:18.
% 
% [Y] = COVallarta1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206;0.201288244766506;0.281968137600451;0.290275761973875;0.304971027752364;0.100381449508131;0.172786177105832;0.171659085057077];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.33851804167317151;-0.4641925137932541;-0.48412061289025776;-0.22998788333545131;1.6986033652199743;0.82891095235557199;-2.5343724425344303;0.089638590307848501;2.3997589677336189;-1.3838130758534897;-1.3716172669349926;4.1855749073435149];
IW1_1 = [1.4230366118760753 0.20900545304006546 0.6131652764120723 -1.0265608847252792 4.0266327980542957 -3.4594210148763187 0.094132732386372098 -1.8226260506004535 0.54773462606549095 0.11020160962122522 -0.16336492330898855 -0.26634764643917153 0.52520816909936974 0.065581917521547572 0.33056630378316032;-0.75346708446999633 -0.39234895282063087 0.69542331587447592 0.86861956112371297 -3.3707850435509443 1.8677232165100617 -0.17415826268389928 0.61368244625717683 0.10467787009948316 -0.51396825690535952 0.046916269921105307 0.34390794446155315 -0.89467868658185867 -0.30132973019781484 0.18362860487583713;0.79505350900254734 0.37513838441166464 0.16491615531549955 -1.116229172592752 0.58094966256631253 -0.39081946160134728 0.26997844399490956 -0.26428074046251887 -0.022858675602400187 0.73873864316530868 0.33363702375483284 -0.45861732238531311 0.56292438370559705 0.36000629192787476 -0.81544873159205578;0.14150655750596586 0.43178032080610468 -0.3903158566924495 0.50385593022702801 1.6196685686809391 0.44810321437016831 -0.25868721535475703 -0.0042211021452876326 -0.066451379414828857 -0.74479232629532477 -0.48543921181146538 0.0062165642408036591 -0.31921332309314382 0.062611575199429642 -0.68003394036125286;0.15996667201117987 5.9817398330816731 -0.046295287379098278 -0.46269091536807183 -0.81760772075822363 0.39589288667779821 0.25221763279892612 0.1455611917332626 -0.27298930870299681 -0.32797999461453148 -0.17906487590763803 0.059381820328741085 -0.033077624284948516 -0.15641630645174262 -0.10351798550167669;-0.0026536731764362428 -0.14595259581824477 2.0837188387200247 3.2041925032725196 -0.61817618608044855 1.7757109731150416 1.7354052664632649 0.39308214814977693 0.31114051359075562 3.0312970799952463 -0.47654770757929088 -2.1665802653690638 0.036181102788800171 -0.26936237444834354 -1.9304345446547064;-3.4726800394096435 -0.25774576186129777 -0.62301770807754453 0.1028168636252729 -1.4965602717405786 0.9115387590517855 0.064029731470507251 -0.26068005941611633 0.43554883676977274 0.49683819879468544 0.077669143518448489 0.24660664755042572 -1.8336954592983012 2.4451774398652306 -1.1356177767643887;-6.585977379102081 0.052014823787909018 1.9739176628871737 -3.5546121539650328 1.545952394156872 3.4686756145743338 0.14195912273075045 -0.618769758510747 0.555892976165967 0.2766465387699597 -0.44579782271385243 -0.75752140178076977 0.41658873929998469 1.3483433331191661 0.27199744004551879;0.38716309092813139 1.5318109262635857 0.97817398168121228 -0.62198450401448513 1.9307546698696916 -0.33098849878518338 -0.011083603488187297 -0.17671738540254614 0.40465477829241153 -0.55404191703949146 0.073361169902677187 -0.54287032599826957 0.85652547041603078 0.19126908884847132 -0.64489486310975752;-0.27597398508686932 -0.18435357613483103 0.34327366383378621 -0.49113278189619369 -0.3584775692553695 0.20645763673076936 0.11604975941996896 0.18009550541357863 -0.20292635329843969 -0.27196113404939726 0.09881372634936865 -0.29619614151126905 -0.41043559225284865 -0.27375034245653024 0.0485688260331575;-0.12164582267990035 -0.42184294624534524 -1.4187131662344428 -0.050725023695984195 -1.2500737089286817 -0.51761287665647371 0.32735107983670025 -0.046629821962282186 0.33864407598864998 1.0804016526243749 0.19992467783592638 -0.14017643543058497 -1.2390246621823655 1.3130384665646375 -0.50445796005295029;5.1853784513207906 -0.46130265847758056 -0.78704280263783233 1.2291808531121753 2.2749182148853762 -1.5682793106849031 0.10947544286235888 0.18322910833871131 0.72083227473832134 0.10882292864475301 0.063027156379145799 0.68707859094961687 -0.95294230943384528 -0.64299226682038668 0.28248241315879213];

% Layer 2
b2 = [1.4389688524555055;-2.7060058371074591;-3.2043534231574538;-4.1718316576456305;-1.2953570878305163;2.6308232839534553;1.8698193944511572;0.19429018716746077;0.15039065144240862;1.3529607512347539;-5.2455797655073289;-1.3761173204651063];
LW2_1 = [0.39561225659906984 -2.008552573501182 -0.5988067942487818 -1.9514296057691238 -1.5975828944194352 -1.6808645607298267 0.047986956511761034 -1.7401691093542482 -0.40518701560126258 -1.0610274581911312 -0.45103198217205137 -1.9974576283153156;1.1333252834149621 1.2794525503967535 -0.26214066219272825 -1.7106568282373937 0.11659794515085153 0.37889299727822401 0.80918261570919292 0.092304829827131701 0.4241088771825971 0.72077528722695783 -0.56652431911036794 0.36265093124869757;2.4506224844633855 1.70348034755272 0.63650292759922678 -1.1040185050898026 0.16700108791982457 -0.20558961379461363 1.1850291973267857 -0.76768990167212703 -0.58842178347633289 0.13147258183052118 -0.76346121435257674 -0.66840671280591335;-0.39533757382000978 -0.21669970557773544 -0.42232148903201772 0.63057216066186772 -0.12919309179617347 -3.3654849142348624 0.25816877751278883 1.9439206944399268 -0.17357451762792245 -1.9126757938348946 -0.33375694358494051 1.9242223805068575;-0.40093872871775077 -1.3109190054289641 -1.1042576876768802 -0.086939264301113164 -0.30871757760818586 -0.26596849465807293 -0.37214534646145037 -0.22526412897176387 0.61986339732229701 0.15695241362024562 0.83053792594254361 0.58356974642986992;-3.0790717953876334 2.3619900232470994 -0.098124143056876084 0.77524659434463739 0.83907943863915768 1.3510432832690313 -1.5467064265345747 -0.75356887400306949 0.82466576477346198 4.5837023541078095 -0.55560421398545756 1.0089466718560247;-0.1715951999382353 -1.9344408275203038 -0.50427958432994335 -1.9597712074758045 -1.1465668390117638 -0.2054119752586713 0.51273901466461302 -0.087938173497767724 0.37472561898443646 0.284618366223921 -0.84969728364664787 0.43240807458778396;1.6321992602951916 1.5953050110618689 1.4819036225151188 -0.59859891627251394 0.13274172145447322 0.1548932088729936 1.0317181088560425 -2.0645688174353918 -0.17160358041697887 2.4297243135714868 -1.2610572417182841 -0.79476314884531929;-1.6146445031514949 -2.3907983255714758 -1.9587902638775383 0.0087413701985413414 0.095660694347562206 0.29468363410316023 -1.3281975961505481 1.6150679576245652 0.30420679446375926 -0.98424549623696456 1.1364321792522636 0.69237231121888221;0.62984807731526127 1.6442409397293662 1.1682677940519004 -0.56097227074455169 0.38226472177166443 0.64486505335691968 0.29880956262883102 -0.17353372221350888 -0.48739634001201182 0.4138512913384636 -1.054601369542381 -0.96671735746692788;-0.71535672798061367 -1.0549832218077104 -0.94668779917984025 -0.9238697820879257 3.8406575324859897 -0.42021179912064316 0.071248961568519467 0.0066178393863708593 1.0722166049528377 -1.1566624556969909 0.55018990023650483 0.03953059936715482;-1.218221608411411 -2.5114428272052853 -1.3482924234951572 -2.3964897049367861 0.85877660415622192 -0.069577330665940809 0.53842987964406441 0.28455328897972831 1.674958139097205 -1.3995865048697487 -0.32331011322502207 0.92774200467288237];

% Layer 3
b3 = -1.9461628304288263;
LW3_2 = [0.21104216120985742 0.91969968988893025 -2.7976853813384195 0.45104227657394996 1.620461325736583 -0.13843109123760994 -0.43074759792816258 -0.68625825298993859 -0.64880902285186526 1.315666270267523 -0.53571099302142422 0.47466506796114111];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
