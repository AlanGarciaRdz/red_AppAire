function [Y,Xf,Af] = SOXMiravalle3(X,~,~)
%SOXMIRAVALLE3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:35.
% 
% [Y] = SOXMiravalle3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.0208986415882968;90.9090909090909;0.056980056980057;0.0063552589768033;166.666666666667;45.4545454545455;117.647058823529;29.8507462686567];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.4296076132774869;2.6504798234079061;2.3238190903751259;7.2488959932654335;-1.6866009526032861;-0.53899427763910723;2.3574080183503368;2.4967998644304132;-1.2863398378587381;2.9530539403171163;3.3009069599991405;0.088657126889766957;-1.94286255083384;-1.1230480232489628];
IW1_1 = [-0.29853630701547934 -0.065126450590457824 -0.29362847638522754 0.79122992089653743 -0.69603054685254628 0.050217458542373222 -0.05912974476824974 -0.057746803538882931 -0.2320999656097566 -0.28075344585822165;-4.8190367303035764 -0.28074489883234971 0.37843533637374038 -0.75238158133640665 0.38898384440826367 -0.47515384940509431 -2.4375738714759012 0.67518201685693979 2.5913945641558862 0.30281640148485933;-1.8118022596502585 -0.46242144684600445 1.3726539670398978 -0.065617789679125071 1.3694934432792416 0.16823214956506249 -0.35101522885663633 -0.81325176893501605 0.17275361921208796 1.5041525619319343;-7.098620782347524 -1.132395569820418 2.5887782435287856 -2.3496312211065353 4.0340026917791496 -2.0306206569469403 0.43459744461780758 2.1948046169329163 -1.5745488382218222 2.961895050296643;4.7865547356588349 -1.3579442507762827 0.073722539503922532 -2.6429884437970634 -0.81347125963662092 -1.3315646738799432 -0.55859274693940553 3.5720378327473954 2.3423658948179806 -1.4979905837562675;0.08727342577886199 -0.21743461554587115 0.97830054891580309 -0.1099251404306439 1.1028259633490536 0.10818816329462309 0.10995814771602211 0.13871946928306225 -0.40626593647064335 1.3454087151112986;-1.1676853425405351 -0.40077684538988467 0.72390596357936499 1.0517500651281551 0.30219955325736625 -0.028758854447595076 0.35064360558285279 0.2515616194374205 -0.78670614493923374 2.2241480989278273;-2.108380642328139 -3.6359306187333189 0.27178963048539967 5.6306446738163247 -1.3158548658477429 0.5775723393950275 -4.7792822635272243 1.7056494200296841 -2.9923731181932451 -0.96179158832728329;-9.5226288094967746 0.27066869437949881 -0.56440117522515065 -1.9945752384232411 -0.35876953079893703 -0.10878466995936788 0.097871368915847162 0.93198564053706212 0.70288334348007353 -0.46536558128670685;0.2383397120231559 1.1486916062179546 -1.1407582378760659 2.7456225099951657 0.079714539130399276 -0.011424199130091441 -1.0065824926604416 3.9901405806606194 -0.30151808763547849 -0.11463697822668335;3.3870682687019769 -2.0543177138686008 0.49143519450795287 1.9716362927655748 -0.88205130704820522 2.1039104841487144 -1.3092885709894522 -0.58619034974091133 -1.4381439124852549 -1.549031774975496;-0.37390533426828654 -0.28695621966528706 -4.102522060622257 3.1846718991868577 -3.4383673305335911 0.59477443813057884 -0.74172702007962366 1.2725975841194548 0.11640257567983461 -3.6142649741985511;-1.8442717318960993 -1.3432409949378108 0.27742555060727242 -0.31832332414541764 -0.18569319368008863 0.31414049384457865 0.64343543228448286 -3.3525862184702193 -1.0140156771569007 1.1811063546984335;-3.3320658477353695 0.27916746923893071 0.37967873211087583 -2.870483413080311 1.1713114412054215 -0.072783796652971189 -0.26483832100166677 0.71526013120540977 0.51365906966667552 1.3520049673874337];

% Layer 2
b2 = [1.7242688298353213;0.38107300616157125;-0.16526821215475301;-0.40246633237586338;-0.12931076882336834;-2.250390617209725;-0.74949796074550301;1.3533690680843935;-0.32631036858306622;1.0303741757767706;-6.8454562077017584;1.1524912909499729;0.68071385684627572;-3.3169552951759966];
LW2_1 = [-1.0979870098517173 0.71424185681181185 0.15774244649305941 0.090130517183867526 -0.023782528097553105 -1.3080494303138694 0.50029641216762322 0.064880446515881748 0.26441022710383888 0.080253527839648356 -1.2205403429854003 0.034408857744552081 -0.086430417246922298 0.10368843470915527;-0.56283676184325204 0.16168755489631953 0.34713312308723909 -2.1956739233652169 -0.31843041532013855 0.35003930437324116 -0.052934968404526661 0.077586706236328476 0.36699540712451773 -0.11991622688526536 0.58723881899935648 0.018327438236819052 -0.051991285478435907 -0.23768879549541849;-0.014612116202875015 -0.32174349634349342 -0.032119295276456204 0.56415437470417273 0.26553866504938867 0.88329995371245562 -0.85709357228313221 -0.024049000181911254 -0.17493355860210558 0.77217959074921716 0.18930296850008924 -0.33838041414305547 0.42400063458239279 -0.51306788380740942;-0.25424883469460785 0.27387157787450844 0.26434562617425211 -2.6182639323114367 -0.36013382106437647 0.29448217693761741 -0.037668225595001728 0.0361994140915054 -1.8010965301138104 -0.13947626878973396 0.057982327569369198 -0.07166858573949772 0.025097514474847399 0.12607438607986921;-0.24199109682877148 -0.260829707634121 -0.051569610961824219 0.51558874193245263 0.2111506878128733 0.73610833694391609 -0.80626496805981707 -0.033319285473151855 0.14726773720486597 0.70005679077520255 0.094479714326601932 -0.32555802925479849 0.43605184609945635 -0.59492919413046996;2.3610705096265203 0.83365769838095982 0.022815241220523683 -1.0987049630766244 0.62966616199501912 0.42582803828993615 -0.3300553482916091 0.013228613618787589 -0.57487743418609372 -0.66707464498352054 0.36254981936303315 -2.9773172737895162 0.47932119292089831 1.2901965734463001;-1.576298144249991 0.04556839804259577 0.63137315392148696 -2.0081289873915762 -0.32336000021952033 1.7643352905424641 -0.3753895296055475 0.33450741473292545 0.66878743421734466 -0.20214102668700798 1.3126540351624585 0.11349264002947911 -0.29301949457804277 -0.7444031314732964;-1.4053386519281661 -2.3442314098587271 -2.0305806268532529 -1.2244870784245594 1.5750671401088749 -0.046360873115770314 2.1300565841150587 -0.12302607343040733 4.6260299615059726 -0.46302804210222398 -0.30553317367670024 0.29543506777594813 -0.10608908622173219 1.5034928185470748;-0.40045269549054618 0.065200111419531331 0.23194878898347709 1.0638091023236067 -0.04370214994080994 -0.11503714388930204 -0.47427704819318234 -0.069855984548833086 1.8119405959446875 0.836899051315801 0.38776848904154954 -0.30155136976054719 0.43333243783088721 -0.43765442304422625;0.19704733796983603 -0.3285975262694853 -0.51042182134046932 -0.28179575852372407 0.25174614794922789 -0.061926087447939718 0.58873966180379023 0.049700927756054135 -0.31696485858252316 -0.88668221258983637 0.030112245326111106 0.34363659864927715 -0.44859229915008253 0.40096292883267037;4.3320920301272778 -1.6361239076278256 3.9759896019537084 1.779590973212656 -3.1032436046778979 7.3207026824314463 -0.92757328882091772 3.8806230817472191 -11.296073553554907 -2.7593967103958379 -3.6711777632755069 2.2503625151030784 -5.6954111652198582 8.921410942599854;0.86452705440976985 -0.38095958225485055 -0.50773106136835233 -0.19495284629177118 0.3307207225414564 0.070800920562553715 0.57553264193399212 0.073036638898126671 -1.7488456328534911 -0.96538766909250506 -0.73159114378694812 0.38206497119496596 -0.53819431420779196 0.54227785646473647;0.040185075274693657 -0.11552233484819235 -0.20642154591122394 -1.0015461533793077 0.031904470667179469 -0.10252757295300874 0.53622447374050286 0.04460686670091038 -0.18635138993380246 -0.77328621430321154 0.24108444828569209 0.30145914541698243 -0.40049691062932569 0.31638842998688155;0.35231014975005664 -0.69699247766804096 0.18389774700255465 1.7679341452552286 -0.62621259639073168 -0.32682647413325416 1.4273967452981942 -0.47354129052433064 -0.64426209600232698 -0.67293182301392529 0.048745138618739234 0.89580206707262577 -0.78828768483306833 1.0551462524708464];

% Layer 3
b3 = -0.40402094873395389;
LW3_2 = [0.91338228532686394 -2.288959883732308 -1.9646388842242077 1.4561297210973458 2.1316009438455903 0.3114654537628373 0.52664210535877531 0.13168666919942437 3.6951386107142161 -3.4891511519860918 1.0622137835927246 2.749118303624225 4.6775524291402819 -0.21876453460120407];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
