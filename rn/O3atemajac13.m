function [Y,Xf,Af] = O3atemajac13(X,~,~)
%O3ATEMAJAC13 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:36.
% 
% [Y] = O3atemajac13(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.201288244766506;4.04040404040404;166.666666666667;0.0561797752808989;0.00614628149969269;9.52380952380952];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.52334161397166934;-1.7624266629812915;-0.57965694930818623;-2.3021181439158656;0.2522270866273208;-0.55036986935627985;-1.2501274112953646;2.0361648924420748;-0.89307095489384436;1.5899454748218427;2.6291753865461578];
  IW1_1 = [0.15490373438110677 -1.9045849030051247 1.6121435118815783 -0.33963932710379208 0.40763329782488111 0.15866772490111755 -0.048945982401882249 -0.40385573522278301;-0.016942767039721585 -0.73294769622596168 1.2107346022653291 -0.55441513631306116 -0.095282395893010172 -0.68598100804926287 -0.77997081427738879 0.53099630823214161;0.5490694314431902 -0.6158574559318899 0.060168694593750842 0.021670855311674356 -0.022568576706884641 0.055607582207622464 -0.024196897231768568 -0.40131897796841093;1.5351505835774186 1.2760316434347212 0.35985996341060411 -3.0311530464005831 0.65176559296341774 2.8880648739242569 0.5522775925468556 -3.3565656729713962;0.26870152751447218 0.2927078911266196 -0.00094335631524820971 -0.0077632718315323607 0.004798508385201147 -0.0081134999622497136 0.014710784234718381 0.52325752017123328;-3.044041622462013 -0.096437339475080971 0.072960878455224323 0.15586171348818872 -0.12159491909506751 -0.58577016028642359 -0.0016875664070874143 0.80136439716185015;-0.76874967623990387 -0.016045675845011421 1.6910590862008286 -2.7954621190667321 -0.63767824564342657 -2.6606966468367719 -0.4720491971659509 0.99914229631281049;0.98924584713744945 -0.60727640649540771 0.8622861418420058 -0.41662066921073465 -0.16679620230680819 -0.01327446232663148 -0.061915877534938886 1.7831109561612655;-1.0411021553467796 -0.60317507492223088 -1.1602839171497941 0.16874106791019397 0.16865151856688054 0.84645898356820937 0.034716388620847402 1.1754508778171173;1.3261381729705308 0.25341779733222181 0.18516160463896694 0.088310795643569348 -0.12740894862614946 -0.30590387684811937 0.01049304874001945 0.14187204890616717;2.1544176109259183 0.90225321034131023 0.069191325574428655 0.040076126900679854 -0.97115852146828574 0.52275813706075247 -0.027974358534785599 0.56237213691358745];
  
  % Layer 2
  b2 = [-2.7249669384940622;4.9848731831159574;0.1596436103383454;2.419842180593363;-2.9006438450439678;-0.8638780156380016;-2.4316470210209644;-0.47989696267836202;2.8826359870212745;-1.2617639467150192;-1.7411888363764481];
  LW2_1 = [0.52334034213177361 0.43638979370823039 3.6974943030246235 0.44853140164807176 -1.1517278787621474 0.32074702108655512 0.11958711460526514 -3.4479306034843522 -3.4887578062664413 -1.0212918900362826 -1.0751004239103394;-5.9502260256097887 -3.5325391946043063 2.221178297998784 -0.18787575085965813 -0.24931856110431172 -1.4785614560098428 -1.0477664360657764 3.7928249713414179 -3.1433345609391843 -5.6969719366612779 -1.0550147837546859;1.6665584378869143 -1.2878115090490074 -1.0344497460264386 -0.74412359610391132 2.0236528098394428 -1.9629010656027686 0.1011790513122571 -1.5113111812846742 -0.29003010240040061 -2.4025420935333104 2.0783284626432739;0.97841531006241056 0.024036382764185654 -1.7082914568412053 -0.10172922074625958 -0.84118501431906911 -1.8125174264460864 0.13693405655427948 -0.76265348144697032 0.83707389018396328 -2.3982868016954964 0.99259883296638451;-0.36467379026966334 -0.40774597889344111 2.9874438304681257 0.12363081228378296 -1.3779686577286687 2.066750041788437 -0.14542148238482494 -0.39197341584325879 0.015028123601076582 -2.3630020819165098 1.754342768880728;-0.33137799155882319 1.6598244234194941 4.9316871848878092 -0.085116374760270674 -0.74578607205381064 3.0438264186343535 -0.36743627789148187 -1.1338038587931483 -0.20960462330373147 -2.4126252670905268 2.2410581164085599;2.5655263740461702 2.62031346609586 0.40135300224983428 0.74320738321964253 0.26787647587258456 1.7278203616000989 1.6731860053940739 -1.6664532668339525 2.9053418744893538 5.0256357267851293 -0.49650917053073318;0.63285993886069281 0.35140184952781772 1.2503335451376456 -0.5020282454990862 -4.0702150666523735 0.7774064165617256 -0.039977951424126801 0.067244154301480202 2.0429832970607227 3.522199761938666 -0.75985771426168658;0.60761817262785667 2.3515468102373838 -3.1846944453446828 0.54599294376622487 -3.7465970945169951 -0.89989777398323945 0.080649411028357515 -0.055582897042339097 1.8851767605829308 0.66165087229294284 0.50947825229283827;-1.8727282624015367 0.33517501225624513 1.1894870171285605 0.99263711383541287 -2.6811086104132289 1.7970365633299628 0.011291586709951541 1.5878560720462003 0.53184440954937995 1.9390737610419679 -1.9660965812220144;0.56628707218978225 -1.3770373189999936 1.7740360949437473 -0.50596548610740955 -3.6567113529809534 0.39918642678446836 0.14848274072364115 0.023971018753634735 1.9903708701392504 2.3547958038833889 -0.34689110123769962];
  
  % Layer 3
  b3 = -0.63261910372842345;
  LW3_2 = [-1.8859275374240458 -5.9080786189444172 -4.0979217243991695 3.5327579008118342 2.9739916608769033 -2.0565125737218715 -3.1554669801032724 1.9937342628931465 -1.7856212762350838 -3.8179883795133094 -1.9985663177269652];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 9.52380952380952;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
