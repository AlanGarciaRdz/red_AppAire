function [Y,Xf,Af] = PM10Miravalle14(X,~,~)
%PM10MIRAVALLE14 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:17.
% 
% [Y] = PM10Miravalle14(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [-4.0301893514142524;-1.234783406827926;-1.1122443945734455;0.29746230462091389;-2.4952159203064381;-0.13903823690141995;-2.274336119608686;-0.76256124874137976;-0.09940615550298415;1.9882394699871349;3.0444297304849428;0.98246846223049267;-1.9811719978616109;0.78767437858990852];
IW1_1 = [3.6281814026875141 -2.6611228012664108 -0.44080497237538319 -0.26628826624773083 -0.24166646932424518 0.54528508712633561;-0.92969238569869717 1.149561128793628 -0.634093953588867 -0.13892531389741503 -0.69198097387414204 0.21605763483034893;0.86019276314926307 0.76009461834188941 -0.073756691000214383 -0.2071280845979368 -1.4890739044394155 -1.1089864039213231;-2.1359686101892414 0.053831386362115458 -0.2869960868124784 0.49696132868465087 -1.4082381818753813 0.85230183348539124;2.3010678471956827 -1.0789736987913325 -0.37370541169408678 -0.84088945734898535 -2.0703968015802725 -0.65454773294396285;-0.92760057624328707 -0.21177038819442234 -0.35950935022929253 -0.23456774737390046 0.48468173581366858 -0.52431025964552314;1.9239959436565885 -1.6211627146979846 0.098721307153599613 1.8820067902742652 2.8953356475685132 0.65117917536130288;-0.43704483808304029 -0.63640699480493668 -0.77257599830148682 0.38105931350637329 0.68084420150413716 -0.70054889960628874;0.0064750082860493031 0.39676324437376559 -0.54900348032340807 -0.046368488037292599 0.20252255325240953 -0.98432486145876241;3.7060683145455249 0.51552967317372189 -1.2062641409705352 0.33784388149658018 0.16430961436193042 -1.0421600185171607;0.45822781469407442 2.8912646291950734 2.1756191667448581 -0.29282493768232465 3.9210579740016036 0.063119597267673008;2.932830058074924 -0.069423036303666141 -1.1355901523009064 -0.42374630741032443 -1.1659564949458874 0.18448355320434276;-1.4487986969326332 2.24164130030583 -0.31876625470274622 -0.08834671537020837 -0.37980618711497843 -0.61364829141242161;1.2788405439891533 1.463336921270296 -0.41999396860764043 -0.067015846591135464 -0.81659817421477843 0.61375580785439787];

% Layer 2
b2 = [-3.1177157071149102;-3.9990952467061556;-0.11581190017809594;1.598211844122762;2.9525964885435534;-4.7306222920490644;0.24494873290585117;0.59443922871480237;0.94716565938723607;0.52012772681800512;-1.4678216489874225;-0.59501387005386375;1.9909889422132543;1.774667290183936];
LW2_1 = [-0.75008209143526883 -3.1287097819686212 0.95884926501549628 -0.72093531926948762 0.084356680354940802 0.20043975641070444 -0.090924607075809877 1.2595757692212399 -1.9859855554547952 0.073588442751354621 -0.20700081001773885 0.16085593855741442 1.0602944236948608 -0.74645439941429104;2.8394058553446344 -2.6840852112409639 1.2376195496836795 1.8178369741139828 -1.0882234373088673 1.6118068330998687 0.34701717310966729 -1.2343349581962193 1.2276721787466292 0.64104084097246461 1.295309449509781 -0.27346605732213725 -0.13860305552775487 2.530251826541392;0.4141451523278864 0.044484891895954649 -0.15675523152321369 -0.011017173294165662 1.053189880634632 0.11031512882643715 0.31142193218792463 1.6745977631888056 -0.93730718931177104 -0.32410377844405119 0.29624063987297194 1.3015544427266366 0.32789146958647047 0.66664119982484193;0.96259512891039445 -1.426114035058818 2.3137685959862502 -0.78718719956199168 -0.19483791748817814 1.2104362209110058 0.20399731399954402 -0.21837121008929913 -1.2976441228886091 1.0465571998973244 0.73702681231849621 -1.508029177701196 1.3473834867815442 0.049797490102614514;0.18337581679139331 -4.24745245646029 2.1811516896132876 2.809602475486368 -0.866481425862068 -1.3728608685726391 -0.040557958491798475 2.9021116601970913 0.11292986744921155 -1.690339129320269 1.1527432470742649 1.9789642145602655 1.3702676917676411 1.5438171000907515;-0.90899852173800089 -1.9378384623915228 1.0798983350662112 0.46781118066338406 -1.9832805264459354 2.5413918567653768 -0.040505462186321298 -1.8017323576491637 -2.2232327841306012 2.7448442079402686 -0.20548607531399607 0.81356934286737614 0.47496839388505485 0.28786021466230877;-0.76778636383735244 0.019533896174041533 -2.0535580328353755 -0.93663306524881795 0.052370241749652019 0.0091726918268723798 -2.0549074827579918 0.50138025577936696 -0.37802678568399695 -0.043188347954268236 1.1421288583775795 2.1449645398146906 1.3277689842421756 0.43113825904766995;1.1676382388321487 -3.7707723669589428 1.4865903948672343 -0.15015697221621971 1.8803453944280177 -0.1451266450230716 0.46390822879517918 0.40866355305921376 2.9304615338135283 1.5792377245226594 -0.76853881106926636 -3.3709860096980946 2.2957965558479256 -0.81823147254280204;1.769300248794254 -1.1589136669910391 0.033704440868493613 0.12187537263839197 0.038656487049244403 -0.95819285485880012 -0.86953702880686734 -1.0475276099149662 -0.030885543264475259 1.0602482606052697 0.9345032164904612 0.034244787646736552 1.9258825892697378 -1.0124427070218855;-0.30848236395745954 0.28402442270399758 -0.75583006870394975 0.41903760806235718 -0.26035520858269962 -1.236598460706738 -0.26483034650875359 -2.1390333737985343 2.0566904453866792 0.1685543230584515 -0.22800411610815652 -0.66388736654036817 -0.079089828457454422 -0.94576097736009312;0.10978132221892363 0.059275512885758996 0.42775456589324712 -0.34052030221172663 -0.3660052333470098 0.12846703483907365 0.25381781939341341 -0.23613803347496795 0.93633712409571523 0.090208904877337862 -0.077978827198284029 -0.40518113903117031 -0.68086035538131795 -0.05909624164779502;1.8182026290894144 -0.58004772976560159 -0.19128191227432417 1.1677153908236844 0.60429164417169989 1.8170377160157785 2.4562450176757973 -1.2735636585476835 1.4917341388472813 1.1643826921911264 0.37467727738490764 -3.2649539942227652 -2.5817178629134641 1.9902814927750891;1.5623223239272139 2.6476243006479718 -2.0911040666202187 -0.62098529409109338 -0.14159170776373545 -3.5630443693990652 0.58455811236777422 1.1929520500887325 1.6719056460724593 -0.78014575346783144 0.11829120932832904 1.0963740576033929 -0.49271697730206909 -0.56225933313880427;0.17130429463031746 1.6489805904916695 0.70117134205443699 -0.59382788728049385 0.39913125046178988 -0.31970674221346562 0.23472345502557296 2.3338100333448222 -1.3049430725033293 -0.77023156881569266 0.0057033449145070456 -2.2009178780982723 -1.1189888592760371 1.0699446013931202];

% Layer 3
b3 = 1.3878886883629573;
LW3_2 = [0.23508258643914906 -0.18362827690428493 0.76446196781750275 -0.19759172244765161 -1.6154845292137476 0.17126657648546292 0.10434152043614821 -0.12690040857429313 0.25858280978147513 0.47687594071698897 0.73618013529854587 -0.0863021804990632 -0.23002246383211367 0.22508316691341082];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
