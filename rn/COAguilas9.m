function [Y,Xf,Af] = COAguilas9(X,~,~)
%COAGUILAS9 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:18.
% 
% [Y] = COAguilas9(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.448430493273543;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125;0.281968137600451;0.304971027752364];
x1_step1_ymin = -1;

% Layer 1
b1 = [-0.51346262012573174;-2.5372230698140186;1.2841026064974619;1.2007571181469785;1.0199355297761958;-0.54115477972805137;0.15177020933651217;2.3811508241179116;2.1383593397230025;-0.13022662524215142;1.0025031222792125;1.0917123445436343;0.68867089402057791;2.0431448650958788;1.5856722396850034];
IW1_1 = [0.63791836421913561 0.48501676406502015 0.26520263501435115 0.20096576703529465 -0.27659569694670183 0.16061501910188486 -0.38966364858692104 0.50849248476120212 0.8380659466334206 -0.12332687449131174 0.047090202569385634 -0.40508921189790792;0.12213072466523268 3.447535797460656 -0.63144865681733597 1.1685406736179313 0.36393359078248388 -0.4065491833977663 0.80991312199741328 -0.10559850937558005 0.19789903138171686 -0.13496677142092256 -0.18899527553703863 0.10456391166800555;-1.2585289032150948 -1.3314659707740248 -0.45507497238167022 -0.73015961811134156 -0.19104268674034341 -0.34867290505270659 0.58655609423000898 2.2667344039048349 1.5914379567455612 -0.65401058646776022 -0.23454152421590702 -0.063816756851673775;-0.39684569989954799 1.8335964621715872 0.39923792677839098 -0.28967615538968677 0.22295192035517755 -0.33715242145798147 0.63487755181239713 -0.60454615748475804 0.013645844076851221 0.57944009674980268 -0.071769327703078215 0.09073498141199246;-1.3360257527752244 0.30186737700084015 0.38790243937906005 -0.71769859114667189 0.16324659253339968 -0.45172013166155861 0.86374551741956695 0.56003892221563445 -0.2200486261702187 -0.065648211246852495 -0.11977996592834284 -0.33902592271595045;-0.018792559834387657 0.36676509975203914 -1.0409267026933617 -0.66718298777741347 -0.12156344936995159 0.28920697040514448 0.31414599425402689 0.4942328192385525 -0.521445557648053 0.21420319314208949 0.26767351110386661 -0.06565808953522409;1.1908817610396185 2.3451535765810143 0.96245208686840988 -0.43999665422994988 -0.56798595805740637 -0.34904629651713748 -0.24179290427190692 0.58525764722188234 0.88367753584700748 0.52120881344619208 0.40037393848812741 -0.21835535622487495;-2.3419512819015735 0.62781604281931003 -0.45769979405489902 0.11957106892623259 0.27302769168425112 0.75965240038935677 0.34381663431961046 2.7709624789463483 0.53103730149940731 0.79562627946713138 -0.0020866842770621459 0.1582371077244053;0.26582629698874261 0.60585131188897878 -0.35174676221434392 0.29146840956913084 -0.87175316333432074 0.95139800859058743 0.81602253135764324 -1.3360580407323257 0.17182345121933157 -0.02321874459751963 0.76997113052328481 0.20066900257774373;0.27120789704089043 -0.10500038232545704 0.068851182547193648 -0.21799647383913262 0.34658645139557936 0.067700758186057405 -0.16818610874104423 -0.77535810972340058 -0.67801360193811011 -0.098924146208917402 -0.24940388051074835 0.47122887793152163;0.57908299332796942 0.27878047671330908 -1.0914594006416594 1.0133638517099282 0.54766519982616291 -0.38967005997441445 0.82776611531217736 0.042917207090330173 -0.1348277207533157 -0.15200106313097997 -0.68109287844906075 0.56829596429317575;0.47514836365735491 -0.80115362184438088 -0.17957692486801025 -1.0668046205777748 -0.31057263140638969 -0.25210270590096445 -0.25065442977006119 0.04793932773911655 0.048338831444161311 -0.42972790441474679 -0.75363942152919372 -0.50810227553959819;-0.098465500133419037 -0.56633167931998663 1.7707549375603353 -2.1531793170181199 -0.071560561051890126 0.28106210106345381 1.4345373064521723 -0.38682498332763288 -0.47049275043641514 0.82978658607368372 1.3031352761621056 -1.0798901079423979;0.52109467462711501 0.17957980942152008 1.0267965342661838 0.42899697939743842 0.18966116980209766 -0.10376493810320775 -0.071578337242849899 -0.85175384521346131 0.13836456196719701 0.36473177769933701 0.25140917719374278 0.017405547785447742;-0.22147361172070568 0.32626676535905103 -1.2823028612404859 -0.88671865870184052 0.10632734655337552 -0.39646627485138886 -0.40643929902354103 -0.025413711774306638 -0.49642851616248895 -0.6405546505666152 -0.22312207396530198 -0.72391917393167293];

% Layer 2
b2 = [-1.6093550432177084;-1.6522806232791558;0.82647077950639392;0.69108633160238464;-0.41408236574200941;0.56397401686286441;0.191839976819422;-0.32020072755191187;0.095127604011058034;-0.44669115350956645;0.61450619723121769;0.96277112050034475;1.2603464203521664;-1.7318071639700774;1.9778478676439595];
LW2_1 = [0.99866399638843562 0.14880452972321839 -0.27553484419287655 0.19406266786510215 0.10965894587477237 0.86934773648468533 -0.18815842733005453 0.40124613578453949 -0.038958759275398339 0.11212240630764926 0.23053833324772274 0.14374534151896451 -0.17709115096594055 0.39643891351682187 0.23275743277490768;1.1765348074680493 1.4806774751071614 -0.5503902213421884 0.66426663558314536 0.29918035062329995 0.92530183453266135 1.4898612351933536 0.62785071804273485 0.0012871662335382505 -0.41353189275669577 0.13969331294829537 -0.93087574596611322 -0.49363741960888102 0.63744440929640866 -0.87744081342470925;0.23943559256415242 0.011790480538978361 0.5080100953935901 0.29088667143533842 0.93283633138841804 -0.41887248411172978 -1.0094023094842246 -1.2614923012962966 0.94968689467403189 -0.39451366182905317 1.6624928677903921 -0.79822488798910529 1.6985085310933177 1.5879064425035201 -0.93417143141733927;1.5900350281705995 -1.6114357629019609 0.54978555216823166 0.096455041873040659 1.3511648604625119 -1.5328436288154641 0.086914780061442889 0.55026092649565383 0.024148919902266221 2.021695014998341 0.9108433734964354 -0.09666041981660177 0.36925032949151371 0.52967390466640374 -0.27043256064656385;-0.50230436812223433 2.0028203470001329 0.11434458837825939 0.35785312023287236 -0.61423492648652622 0.37005363140546271 -0.58346772303184791 0.29024076077595984 -0.10073927788283475 -0.49386982373212407 -0.94170445192196084 -0.29381141176818598 -0.30238816692320186 0.06053479992211809 0.58981576696494886;-0.59811865882879567 -1.0926390192487259 0.49835742845163433 -0.16378969140042696 0.79828337016864193 0.71795352502228182 0.86166399573830477 0.35006708414789722 0.14751186414966808 -0.10245646995199315 0.62048111196712008 -0.089968061328578403 -0.68927741097889161 0.039678096099754159 0.098407817220872496;0.80229532468670917 -1.1859562069422864 -0.31407377642655671 1.4942136119467537 0.14749338581985683 0.29083574192943562 -0.90942751817968581 0.13649453834049297 0.56898324253582122 0.35479828901825017 -0.90931820323676982 0.4515988184109076 -0.1924908371814808 -2.152319445989467 0.86638074058290127;-0.48754141249892313 0.10011991641883794 1.392805730585003 -1.6270230468126625 -0.71622606750093243 1.5874801484273695 0.64484765236412001 -1.2846573199295406 0.0083681716582292565 -0.75757359830291604 -0.064069552106482644 -0.72152220776763165 0.067977894501357689 -0.65298858581356745 -0.63041825412273345;-1.6334853226139976 0.41774763456555486 -0.17632602862672628 1.4265886151865941 -0.75223462135864838 -0.50954401780759995 -0.43452654301304366 -0.13559961889464642 0.21067442797194821 -1.4920222646609822 -0.2588243642551914 0.82775901329689106 -0.3154947231624754 -0.60351497295256629 -0.27574302193707129;-0.43882625025331057 0.33933331225231655 0.18342488666967216 -0.043205019119114896 -0.48660035747800739 -0.11631721279707803 -0.40064169248564668 1.0668112982312976 -0.28301803973181616 0.82256854549942404 -1.8409205965519011 0.093362475192812808 -1.1131996696967386 0.92195132466199414 0.068667339619406839;0.013400795064000187 0.27884125234629842 -0.94901658802452604 -0.16240679263140378 -0.13101598820978749 0.56660557118637223 0.13455132540684456 -0.019104281578505369 -0.45298728484789269 0.039667731303911033 -0.44156597032441519 -0.34903945581034901 -0.43500264672390365 0.3922875272887838 0.19107611884243139;0.1709644040551952 0.60902139552070622 0.5609923390109488 0.2356362255581497 -0.63895416325749466 0.31784900651522696 0.32527118500142616 -0.5446090300576385 0.48004025544021484 -0.51525413323023495 0.9757867249519252 -0.44311959323687772 0.9266411753923729 -1.5035244597079755 0.47763530211621952;1.8232044045603037 -0.031772569765168839 0.014225810072744618 0.70168441686950644 1.4954984749443758 1.3061472686044948 0.42572934315339073 0.58382837696026202 0.14853184704879596 1.7643297826661271 0.013597288716763665 -0.16690597282808184 -0.4478771081806881 1.1471546689382563 0.53815213632720293;-0.0095668512717181735 -1.3887025680978904 0.97226314795269086 0.6809175102778301 0.035711491857700131 -0.80415676742496101 -0.087093081731933308 -0.12283763127021691 0.45353753038906797 0.054062162673690344 0.88327902917863732 -0.28308966305964922 0.50885269657225951 -0.21817232774013523 -0.14067150562543376;0.26334598559792777 0.86958334184912967 0.25034121091356354 -0.60465436195902222 1.3295547996942492 -0.12763254573106414 0.20400987755929395 -0.54285277622160022 -1.189743962952456 -0.30329168478118207 0.24379893837040226 0.43285520245200554 0.49270962099105819 0.11336029813063481 0.34808178825125252];

% Layer 3
b3 = -0.72569801196803974;
LW3_2 = [-1.1209115982681583 0.55722060894876968 -0.17726013609858901 2.1056083634947296 1.8681945532692095 0.71608381542608701 0.4853561583785817 -0.26677084169730764 -0.49644903027960874 0.45656859842474756 1.3874506986964596 0.73475872565325639 -1.5883448392950761 0.9094155535614834 0.55224299945346322];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
