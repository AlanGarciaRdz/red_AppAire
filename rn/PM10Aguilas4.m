function [Y,Xf,Af] = PM10Aguilas4(X,~,~)
%PM10AGUILAS4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:19:47.
% 
% [Y] = PM10Aguilas4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.015201695288573867;-1.7932501866136477;0.49998060564104291;2.5500733163659763;1.428580551670475;-1.3118678914290756;1.4763992428116728;1.4958493971308828;0.27754496382892119;2.1696296857400834;2.2253644100258279;2.5312840084628898;3.3498617527920431];
IW1_1 = [0.65595309797293655 1.0413712837201767 -0.58686867068659887 -0.23612606783488155 -0.71292422628633756 0.1010180817375938 -2.1360643621005631 -0.73277187051225789 -0.24496002825976074;-0.032274999710103322 0.70626195554555504 -0.82815070640582711 -1.1538146183414415 0.50190966967834039 0.15559827888705835 0.78948129519542798 -0.43682517363218704 -0.21748279331765369;-2.2005158199504717 0.9609001186537649 -0.031257288364298245 0.93013686876192259 -0.45181253961677148 0.095332876197782482 0.53233294021787636 -0.28493322950374522 -0.36129696880106171;0.026382218776750919 -1.796882870933264 0.4121840108974828 1.4771415913636281 -0.13601742544114853 0.26533958623609627 -0.33461719900946607 -0.2244827946475354 0.0015763136065260197;0.49321828294142062 0.25248909487376453 0.50906533306847701 -0.4735927473511834 -0.13892348655215864 0.31709509021093468 -0.61370167593342206 1.0629687885054244 -0.17167420428213698;0.30302937343082825 2.4453648820159031 -0.16500239423551896 -0.97527898022659609 -0.15074124352455454 -0.13677171287057888 -0.2630318602106328 0.26544692060528091 -0.010691023136836801;-0.17684055419291891 -0.3668761459940465 -0.018787553574479733 -1.4547862666171474 -0.65176978227707738 0.60053437867285997 -2.5759261980805781 -0.47084010344895783 -0.41131522891439137;0.020667123335357022 1.5595179854166306 -0.38716756611430786 2.0313601231141241 0.1594051659205406 -0.19569786710731146 0.39703625353894534 0.10692998778247824 -0.066920565959847036;1.1264244274242114 -2.7001404496863177 -0.44594248303838652 1.4646811438915868 0.86344489739808006 -0.22497997045730156 0.9893582761460169 0.019536844013850505 0.59510731443687193;-0.14927897614070398 2.7542640430988188 -1.0776871809770558 1.849252276494481 0.12366753583473139 -0.15114230972125803 -0.19874893580470937 -1.1430452128409185 0.55957085546580188;1.1281457196909757 -0.62360306081575156 0.51422490001237708 0.44729024788177407 0.51126777849913574 0.77830692357665388 -0.74661260121269157 0.26904094045769622 0.16673215270506916;-1.3853673679358205 -1.9505383686782924 0.66347381735078714 0.39760145297219779 -1.8561195720661472 2.4949766363446986 1.5978394785657599 -0.15745745050979143 -1.7129203369528869;-0.49175158974155958 -0.35936982895713759 1.309435491800329 0.29963494102016891 -0.68755803852083019 -0.38162903615590427 -0.75824105888413584 -0.57541838389901434 0.28801144927091704];

% Layer 2
b2 = [-1.8166582677267806;2.1621142229420918;-3.5002954650646365;0.43296751378612941;0.26635971240623796;0.068947685621811375;-2.0945179733835975;-0.18305946747511023;1.4594980274791582;-1.8804199142931668;-1.6050441523457979;-1.6535353503808421;1.9589942531838758];
LW2_1 = [-0.026694117193907213 0.29882984980995642 0.33257028880050526 0.45030829990680721 -0.75092883511399466 1.2578316478275384 0.11968018079138942 -2.911965019759355 0.34820059720900537 -0.43685218093442613 0.27305740255352662 0.098852945859603553 -0.22371511120550316;0.069418766347614305 -1.2429474670978062 -1.1330553845304823 1.8768103812964048 0.20905775227247175 2.0244589930612409 2.7136860342580671 -1.6415232186830591 -0.79587432887633758 0.99398328592125029 -1.5913429867800926 -1.4196105103250896 -1.5602303812851712;-0.49574802178655941 -0.29751489736683101 -3.4074048265874501 2.8462519438441967 -1.9804169642627802 4.0818388945771451 0.59915341807793787 2.7332954348059948 -0.92625778141513637 0.47466587238335306 -3.7398887060480259 0.078420445843620928 -3.0385647313180537;1.5224925064398855 -1.7934743090193499 -1.6823007703903505 1.5544544130285134 1.1961856656629606 1.9202141888379385 2.0514072832241075 -1.9445376045763201 -0.73601788189519524 1.019764106506476 -1.5384153710135382 -1.1252976518843028 1.2033017812718396;-0.068329992327066949 -0.23868534089106108 -0.11286699929727037 2.0992688986710988 0.64103114559739927 -0.3028307414918549 -0.20506029140696458 2.7760479576807144 -0.015148024602421296 0.48207310352487215 -0.020074185351108696 -0.023782840781194161 -0.04784745503869562;0.086314510512850245 0.89025196524813777 -0.15631456336088512 -0.1436514777638247 0.47018727909176078 -0.53860320367815961 -0.80932262297694058 3.1885833403766961 2.4277635974491094 0.52630189119114446 0.40349141609407913 -0.84759224764863572 -0.24880584478814077;0.24355573609342107 -0.71890794242046019 1.0868216335753453 -2.0056851185386018 -0.71254604770634866 -1.8072056324583861 1.281910684686727 -1.1142290256972383 1.3428831277309696 -0.64490066889844555 0.23753827639350489 0.22572144543719624 0.84648869555477591;0.64606769934389852 -1.5640824523239623 1.0490074251730845 -2.4062113209362912 0.98198277670705236 -3.1559264689012281 -0.79607484296307762 2.5799010738208374 0.6331228326572953 0.50182695255525545 -0.24326184437640908 -0.6499003804059118 -0.77012470860226512;0.099440858461151346 0.51428550225035219 -1.0759028328955875 -0.1917284952297463 -1.6934895694093155 0.71089338725499662 -0.12257239207477939 0.68316341469394104 0.64615941882022454 -0.60287438710401575 0.62602070792452458 1.8272974712773957 0.21493661669282421;0.0091395199069768205 -0.091799470033640251 0.14070177127392067 2.1196144857705548 -1.1984606945735203 0.69286819211620254 1.1059321062003002 0.18580318463772502 0.49068459936689074 -0.84654846355528812 0.47934498776986706 -0.1285216136989627 -0.6766962390201563;1.9259181279306883 2.3110575077090085 0.87153452596858927 -1.4013341230996956 -1.3714728854681884 -0.7828731009502512 0.78630769641530407 -0.10925186064122064 -3.0834086131829634 -1.5538011583485876 -0.11295256625784035 -0.51281359180863106 -0.021341195083518578;1.4432227823126651 2.0966943402016818 0.57431128352663641 0.76937195161658023 -1.1885327509734005 1.7320760248459581 -0.24041607603534426 -1.4098935311444574 -2.4057261171006585 -0.36461126239664587 0.015450526791165554 0.058430068119155971 0.33336331644976419;-0.37714814831772941 0.33621323854527646 0.72442516409313806 -1.8685644440635589 1.5913560184802553 0.0021173199821445821 -2.168990667723905 -0.67473581427809504 0.51371716375460097 1.4782507285751969 0.50547596275097695 0.50268693588528357 0.69535306196656221];

% Layer 3
b3 = 1.5053065903078666;
LW3_2 = [1.4259313546091044 -0.71859752625827145 2.5969664311598373 0.70390586565332036 1.7187367791486419 0.031911439132864539 0.27999573668355987 0.094782269509516431 0.045578708410832704 -0.66497659191805913 -0.075670902540310753 0.10269050415665171 -0.38777712594628794];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
