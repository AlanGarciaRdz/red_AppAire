function [Y,Xf,Af] = O3atemajac21(X,~,~)
%O3ATEMAJAC21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:37.
% 
% [Y] = O3atemajac21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.201288244766506;4.04040404040404;166.666666666667;0.0561797752808989;0.00614628149969269;9.52380952380952];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-4.151891517936992;-2.0645810111978231;-5.1881063789654478;-3.6253254480271564;-0.69160998099215254;1.2532986305348326;-0.29813302905480249;1.759711993975142;-1.535549647289733;-1.3103249972761242;-2.2098227159586723;-2.3732006548950237;-0.39865812547585855;-3.1059749022021732];
  IW1_1 = [0.26098469067803709 0.61973855559189472 -0.021319099001106706 -1.0534956108983584 -0.95185177141135968 0.45841666983121621 -0.040902012673796034 -2.6617513340476346;0.63072640845790018 0.51294500116632991 1.7698739950769227 0.15055774614255607 -0.51520801086443935 1.9226159905448936 -0.26401726293793309 -0.39597038662920808;0.3290087847125811 0.69186266684576037 -2.0482131383587299 0.023394165285884498 -0.51010081408522567 1.7564286494240517 0.28609217967141798 -1.9160612675274724;0.54186023603001821 0.25568873624253541 -0.76272793220728841 0.34791148064477295 -1.4324961410592929 2.2201682283314668 0.4308886680577711 -0.55547486607587182;1.0601011202643742 -2.780319724158808 0.76023195307923719 -0.047837554406912369 -0.0028937010686191506 0.13537141511351483 -0.10362439532189111 -0.51530556273343353;-0.88792447720216061 2.1069884327732096 -1.5447037205798813 -0.95682449576312345 2.1978375227021556 0.88159645765518646 -0.33873051304133439 -0.035878267492117991;2.871040639541838 0.16846664257026664 -0.8108911497520942 -0.28874740272714672 0.39178930901459158 0.69682936108354121 0.011762945277683569 -0.81554536161476843;1.9392676742205424 3.1198574718501217 -0.47658776650111101 0.42733913943624313 -0.4039967558502735 -0.0019711385607326694 -0.031817497826026414 0.80182413337122771;2.3466903256101883 0.69289263710604565 0.52809416411159438 0.051250321171742386 -0.083303574507595013 -0.11778993055115694 -0.030963186128923331 -0.067394187185994964;-0.34966747226647582 -1.717613731683449 -1.6618601237486548 0.14444939037469243 0.38911555857832986 0.30577798182001437 0.029960011770567393 -0.22136724978654593;-2.0478063721561952 3.1227538487084994 1.2979069116213271 -0.098519725175215345 0.12712758056469348 0.19125766358003493 -0.10457066697848877 -1.1831861711573035;0.25009510265948082 0.023839681253146169 -2.0725763043747203 0.11661407922760136 0.60594872958036017 -0.79775360806019013 0.1894826875896935 1.460863809407059;-0.50925354144386548 -0.86588642562101659 1.7806317353289374 0.64464021847213338 -1.0578548605971076 -0.63647444562322852 -0.46542927544238971 1.0830190546724501;0.55216752880059972 -0.025650039858065521 -0.76910308093741231 -0.96301076986282863 -0.56300583917583802 -0.30204709025843535 -0.18926691232854925 0.81558150753542968];
  
  % Layer 2
  b2 = [-0.30619270896988382;-2.8098778397859783;1.4318843910962267;0.4870386700072436;0.81513981303321714;0.40416793611204749;-0.48527620865568599;2.4376394481477437;-0.95868636874285129;1.8058755488776836;0.032218961014333747;2.745903197985085;1.7750482259566496;-2.4283561233828359];
  LW2_1 = [0.93530557957981109 -0.67425962519774019 -0.30230525982172973 0.15121125306351713 1.6267074491817333 -0.8202483943933907 -0.62902863670840869 1.4642638928473197 -0.931287859195158 0.82985232800963704 0.63490465898659687 -0.63971955574903316 -0.91312700542517544 -1.1435288224796434;-0.080897235270078999 -0.18302461043114415 -0.49340210255414546 -0.17923312288928375 -2.0348013736454442 3.0759937514563571 -0.067426030415120755 0.093110059668935763 0.92185593619480222 0.21977166854244809 0.58036986735936402 0.80935284705404142 1.68610777610814 -0.26439580202717705;-2.365341761884828 -0.6560585988452774 -1.6346776721985117 0.39247071915464937 1.0733665890817945 1.0688268634055853 0.69600044787161419 0.041712928194022392 -0.49605839836326948 0.65129323722165833 0.70565889100959855 -0.7095815711332496 -0.25931945717402344 -0.59865368215448189;-1.4433418665890929 0.79812455863750342 -1.5998593423184571 1.0178815250888231 -1.5668291713558757 -1.0911471831301403 0.65621160849669802 -0.3591552418749509 0.74777547678051448 0.38294745813661824 -1.3969170528470627 2.047032362972049 -0.68716828904918137 0.93579959966791937;-0.58691407130223283 0.83941090750739134 -0.25428633740015866 1.0199996930645958 -0.033131718140657317 -1.0587889549377385 0.72413032415975187 -0.45712587147829109 -1.2895326502120024 -0.98088107366870014 0.22365692377697788 -0.4686137401478061 -0.33978128960973397 -0.64639378030956152;-0.041977269341820493 -0.15826577943065828 -0.654333339854138 0.60437476825765712 -0.45816280012631572 0.33581012279254979 -0.27288630962819355 0.49501002912110076 1.0351004669513164 0.9942896946957005 0.45524488022348725 -0.33973561303739536 0.027366612553077201 0.37896638664272858;0.68120019217927463 -0.84352221671920313 0.42742013624917635 -1.8481240620016157 1.2659336864134012 0.084232828436412444 -1.6101383588210119 -0.0060841234570112382 -0.074111110287394574 -1.0592870693917209 0.77540955844305526 -0.24921413581782867 -0.64968837974606597 0.12908512949922352;1.987238534081456 -2.5355596974743055 -0.83583072096964794 0.090737498960007906 1.2158321858657564 2.4738541884937355 -3.5682076098962341 -1.0932922318289922 -0.73516757773501595 2.5576894321295915 2.1055714368330607 -0.48533754472951846 -0.16472869620072389 -1.8267454995530683;-0.88653690444740862 0.20001350217460623 0.61268627763062766 0.73379125673755241 1.4727579711543166 -0.08089585099376774 -0.29327844487062343 1.4753417087899494 -0.64614135614753176 -0.050251016577748095 0.033574254641104903 0.95466930532806549 -0.69615219549662588 0.039801873043904729;0.78220904450455575 -0.54097830995661556 -0.6422435156581634 -0.34026115595470463 -0.85328568621487111 0.17812322793939719 -3.238421392883541 -0.69584982955783548 0.68966907466544058 0.5127917165509347 0.5969250571560869 -1.0735537871978249 -2.4282156258174656 0.46073009449659569;-1.0544449680963517 0.31446874438176708 -0.32605333050296648 0.2586866681126847 -1.3507417613140822 -0.80625386961656742 0.38098196581070559 -0.47268447290341864 1.5259066349414352 1.043585198021836 -0.40438622727766899 -0.27910891902287915 -0.25982484877280954 1.2688355177538913;2.4232455964767521 0.06525694219577334 -2.3969471263112521 -0.33446717603160458 -2.9646866112879313 0.49451206701432215 -0.54999615781961997 -2.199912404733996 1.8692236721312647 1.707712265879245 0.56308424514860145 -0.77800593207967539 -1.3415701167525358 -0.54921708995501173;2.509139625893531 0.035621664974687828 3.3797114415524785 -1.918787631751588 -0.19470742220832052 -1.786569964868937 -0.85627966828103796 -0.92139760363688206 -1.5350297881840529 -1.5474568053155795 -0.832478777528884 -0.68812307821422181 -2.1953632697544054 -0.90013163315126898;-1.2702313462394879 1.1105106164092897 -1.8247422978631174 1.5685215570079394 -0.64798127851490028 0.98359541414028573 0.79994981812158783 0.16244364234050387 -0.1308240799865529 0.07869233928142319 -0.84776586440529944 1.1487825225536306 0.26280567514190267 -0.4261108946006566];
  
  % Layer 3
  b3 = -1.0316507803304162;
  LW3_2 = [-1.0429937238557452 -0.47390458374077538 0.53011160742471586 0.6277221004988941 0.43843861388717509 0.5726649442909042 0.2171160596618345 0.36639673908303377 -0.78425422086470453 -3.148498371555787 -1.0330711387075879 1.2142410041925857 -0.31229633251727595 -0.72906644880024296];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 9.52380952380952;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
