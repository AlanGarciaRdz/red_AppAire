function [Y,Xf,Af] = COMiravalle18(X,~,~)
%COMIRAVALLE18 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:47.
% 
% [Y] = COMiravalle18(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.4382903594955714;-1.4943296330846281;-0.21897220085526264;2.806646867952943;1.4489482966350855;-0.5597286570067791;-0.63408743828980996;-0.029174078492062945;-1.6931145579103701;-1.3989707822937505;-4.3796518593109681;3.3041421576221919;-3.4156735664393683;-3.082975526138692];
IW1_1 = [-0.1590021729749837 -5.7955296113638415 1.1004575041052536 -0.35212549491317191 0.1686993967033151 0.21045534955026474 0.11904046296458423 -0.19712595376840195;1.0125520536369665 -0.92031844435267107 -0.28176560945738049 -0.19461449319237054 -0.17958609037434112 0.1972332315925921 -0.11501595359120412 -0.16568809478407998;0.23824518449129026 0.43458847685837304 -1.0105748238922205 -2.1603306603863262 -3.2779226218326674 -2.9121530954407513 0.93671865298371837 -1.6310848947784793;-0.16982801756582638 0.22185147147198062 0.48434099928135954 -0.15780477152526273 0.82994043484696889 3.2935537645187267 1.7244622892073225 -0.071389108426878123;1.0905230690265093 -1.5522907175156364 -1.1829497803177966 2.8444908171398908 -0.74107074432388598 -1.2808969935729506 -0.039011142559952638 2.2511466959225945;0.74216849262002171 -0.50058378364286005 -0.2642586160473685 -0.53270316479425595 0.24021030160525822 -0.13810218547700753 0.26757433823156851 0.049511699309446405;-0.72586537378876625 0.83289655404962082 -0.0055552336174810799 0.36358216399540322 -0.72166304970252404 -0.42456338020303169 0.18068944754703387 -0.20708637440144628;-1.4094945519355935 -3.2084406561845378 -1.4866971656593062 0.12259147155476791 0.80318648919665436 0.15691634449906858 -0.20661207652378666 0.53496308265317638;-1.9520738883685185 -1.2363270552627621 0.25174801991788265 0.30311843753452361 -0.49489139725523357 1.0662020191321164 -0.70612046241524706 0.39365166367039978;-0.78389073186052882 -4.1845346061049247 -0.68835902585781916 0.75329847453236443 -1.6048035436213635 -1.5939059214809856 -0.23669767135396302 0.11949576868023498;0.49103486189657741 -2.347221796469714 0.93512422659027938 -0.53822724812355149 1.6509729141370857 -3.4806208470605458 1.0381577784204599 0.010214504085430065;3.8279256562397501 -0.035183352652668705 -0.042127044509503449 -0.12734127193734088 0.42906553364486599 -0.042306423782299901 -0.029117776942059217 -0.31100640589757622;0.10963040186051934 2.1310059089711402 2.6317843769335063 0.37518463296252669 0.32362641925895896 4.9530966580564328 -2.5801917391663363 -0.64797869303018196;1.7351774751513502 1.4977650426664584 0.033739274962049891 0.78560778940628351 -1.1095130186366053 -0.089264667292163119 0.45052240503795038 -0.17148107184192413];

% Layer 2
b2 = [-1.5373537989044943;-1.7856116890413183;-0.74355585574002614;1.7410822757634974;-2.9068204682593533;0.21028544146227574;0.79567642076931944;0.060038175689512266;-1.4464825334771021;-2.51798775090051;-0.42787123761641171;-0.13609874062703897;0.97113808396316348;-1.0656661890754764];
LW2_1 = [0.064406260729975184 2.4450713150633052 0.2750972584732132 -1.8234100032030804 0.10997187111285543 -1.2477925070228113 -3.1977546656993767 -1.4248783663677222 -0.95902218109995152 -1.1384305932728571 0.52542517659943744 -1.7405495810355323 0.097389462002789196 0.084424242036154951;0.12404452674968017 -1.5969755706225721 0.40377983895765623 -0.95932309676705607 0.42168079933464225 -0.59538608539967974 0.33284110917038773 -0.17968561367762645 -0.22430520884507477 0.37712676062792133 -1.444183950563046 -0.94285315615816212 0.042655765229253781 -0.041480692850524914;-0.018203537706538993 -1.4659750104091276 0.35595520821506654 -0.44040776322852448 0.47117157920106284 -0.93207449117049146 -0.80281934156343004 -0.052270559946394422 -0.75074652331530745 -0.26411698186859456 1.4509806734652544 -0.18390289525451126 -0.35592085336817497 -0.63022415594680736;-0.12909294209864972 -1.5710357714789243 0.044860227292637667 0.68985135443792112 -0.11465831948267388 0.91497485641749932 2.7548785565068767 1.3270951334522991 -0.85842544917690666 -0.32149832573315523 -0.27517882467413651 -0.60718143398128877 0.59714414970642093 -0.97121902510501901;0.10422151769758424 -1.4104592473819817 0.24826637134211205 -0.48425272036934791 0.4830077182941328 -0.48688962786692785 0.12606559238634213 -0.22692542772566465 -0.073040873536575388 -0.12037239010801951 0.10445966337675457 3.1106179498443289 -0.35180629686296155 0.1889671385764124;-0.15160788108936166 -1.5004860948769676 -0.3604906192455451 -1.7703527891194095 -0.29782569466220227 -0.62192815862395434 -0.67762715471277446 -0.77020807026324845 -0.13731517079495545 0.053626994814630166 0.25194701447241136 0.05128708122536256 0.036884758296232896 -1.0862906406608253;-0.561102026035322 -1.6219440197557156 -0.32892962179689678 -1.7518827156777532 -0.27269124008585816 -0.58735797012667423 -0.56051129747560458 -0.74661837605938797 -0.35597756034562117 0.19151106757039357 0.10049501607650045 -0.0034269598082146326 -0.15939052674948884 -0.45744583311730114;0.024795476486652025 0.15393151866154631 -0.15506061406477037 1.0327901849832564 -0.18534163484230817 0.84026377488250648 -0.34440322182825672 -0.11640887112896534 -0.27102753027723142 -0.45691623262405023 1.8076059972299345 0.47109147778670879 -0.15397756332618762 -0.6792572149723447;-0.77642250842453797 -0.39517647214451573 -1.4346192843091965 -1.2219451487799928 0.88097033922091117 1.2751122358430553 -0.038142493916885623 -2.2188564311411318 -2.2138328795659818 -3.89220271515316 -1.0666454431338868 -1.2453069361804896 -0.28486420439377574 1.3484984232808672;-1.3689544959893696 -0.36422854111485259 0.62626512748402763 -0.36310516378920976 0.15013499188285395 -0.28297933659704438 -1.8969595629640805 -1.0358976252377969 0.0011234668197088321 3.0862887424026653 -1.4972769722153347 -0.56922314621351722 0.87137134900765467 1.928990709563339;0.78027972002344026 0.2015595373357382 -0.028304802925604278 -0.92940654065780803 0.32003119747451786 0.099526785823061931 0.1899419346820175 -0.95098872738153406 0.07138433140596176 -0.51777150338786437 -0.33824968192755311 2.8346531212401187 -0.40703549306115372 0.79511383619976039;-0.44500485639590331 2.1431153731946946 0.2111657904760714 -0.87403837007862339 0.81926207025516595 -1.2453673859516303 0.64608760542929189 0.79585436794089759 -0.48837557852341895 -1.2732236079125681 -0.6057261103230106 -1.116884232830559 -0.38904985316091961 1.3916073791254688;-0.35294531865085926 -1.5686050556288804 -0.09393183651724081 0.28518458970322652 -0.416196210382902 -0.16471953844014309 -1.4712186817358675 -0.23156205725997553 -0.7665534117963978 2.419663544932023 -0.56416120250897606 0.30897129637480697 0.96515613860779403 -1.0816080828171208;-0.52177951752954843 1.2524440166806468 0.16735678617148153 -0.00049887607374579646 0.058970589180779208 0.21418037856643468 -1.1010686321690788 0.094300832687350705 0.4598186425516983 -1.3991589689976747 0.65291741120316749 0.89961449117821413 0.33561188202088693 1.4596075353580988];

% Layer 3
b3 = 0.43294488870526704;
LW3_2 = [1.0275790243374316 -1.1272525474546722 0.81299265913760643 2.063282595177359 -1.2212262439949801 -2.5541822158820162 2.6195357826609937 -1.1926599882489408 0.14568521206421886 2.3242076820414939 1.043989545873597 -1.5853938378001211 -3.371163294509476 -1.4063442693222465];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
