function [Y,Xf,Af] = PM10Miravalle4(X,~,~)
%PM10MIRAVALLE4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:15.
% 
% [Y] = PM10Miravalle4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [-5.5427986373908507;-0.3308575658539234;-0.30780160097322079;0.28704185791588155;-2.1582411079538635;-0.36810239702627889;-0.87412838463899123;-0.022371948497719819;-1.1056563006289712;-1.1034679664407396;0.61085537277098989;1.1441594364160792;-1.7373389587463626;3.6459903674179999;0.71900700465788581];
IW1_1 = [0.62394294378498427 0.25331435541657521 -3.2198891436226424 -0.13008626788495692 0.99882346159106761 0.23025503684055082;0.16821013379794839 -0.89452309299191279 -0.81091099455760529 -1.4224482186876837 0.02961931312471049 0.16234558504840962;0.24086821085206872 1.3369568254817474 -0.12687749269643431 0.075585879224279229 -0.022842744747876037 0.0095285924897665301;0.35911503866011563 0.73088815333698809 0.064821319278193359 -0.28252324383933741 -0.021354392608757728 0.066161518787581197;-1.4964716308248724 -0.32769109733652907 1.1346905622830261 0.16218319557447844 1.8957571383982736 -1.7431507005208726;0.034472178846346659 1.5479779214099301 0.080962149967417033 0.48639478579982193 0.79984440757483166 -0.11322745064298233;-1.0062511149079889 0.11959044617686164 -0.75663126073763387 0.73557883736136298 0.16133882691819126 -0.3045196188844197;0.4427340703251943 0.55660034042699669 -0.37937318916028145 0.12789535573640876 0.64302744122334465 -0.17103085277212432;-0.99639219968625925 0.39742902887186771 -1.1946021914568745 0.5943612716127088 -0.21253773842895335 -0.30138173920508404;-0.33373769925502211 -0.77597280943221514 -0.68092083045312213 -0.10918585734706016 0.017720018653738682 0.27718735093689595;-0.061041451497805252 -0.18442270406340425 0.59404355637768924 -0.26473628475497463 -0.28918794215193311 0.29873551006409221;1.2034494154683071 -1.0579979749124857 -2.4848981147029487 -1.6168531436744618 -5.5227246644598997 1.3428926019042819;1.7096786962286188 -0.16608439192717622 -0.97707048522737228 1.1362284420255708 1.4129661992211489 -0.092060389437827045;1.192144458531774 -1.0105524447629783 1.5102236526308159 -0.24241408775177586 -3.3787147275086604 -0.90411181543962771;0.048574720884770814 0.75817862785543888 0.48140756834738424 -0.18569921186808985 -0.5784813998115359 0.021413855012853894];

% Layer 2
b2 = [-109.28505608161522;48.066488972573396;-5.6827938367589175;-18.493814876339524;98.866821625670781;47.310845639891788;-109.520107532099;-33.586973201747483;18.154508554847236;158.41926478107311;-57.938511184247048;-2.2873509192180115;131.52263266478266;125.50991936882856;44.037015431163709];
LW2_1 = [-208.88241008790283 -12.850481840069847 125.98370586075822 88.072282009483871 0.93155099653924078 -84.403925019374199 28.423786295306027 -67.888692477815297 5.8686678777103367 -74.625779436606962 2.5932297891530052 -4.1162611193591232 -7.8958720280846437 -69.762694030269856 -166.29522783558357;41.498565153525121 10.061837290716516 47.777683985795989 60.427551721638117 2.6848493350563247 -71.596697686058121 125.04503744290992 86.251688451582879 -43.329664305831827 -32.000071089311383 119.40601938781421 31.193831037356588 -49.528042069489231 -114.03958141429413 -57.747389253476086;-0.29827582983523221 -1.0408770685245885 -4.5481409969821094 14.558359492524445 -4.4178403625076506 -0.25702627274115114 2.1401038506233117 -3.1805875150803069 4.0015453766256348 -3.4930226206739197 5.1821635176774352 -0.60663459799788311 1.3140770667277886 1.1739402226278985 -5.2457564544906647;3.6258009085988072 3.9439550465498496 54.253489512375197 -61.248949280265968 -21.48488771619828 -0.56237012128272401 -83.088001841343299 0.69690856526826117 84.125114178383271 -69.868567646312243 59.749775644560927 -1.2796235212689333 -1.5615275825021284 2.9998465165107362 -68.001623800885255;70.393291002270175 50.96970485637744 85.478378823939508 2.2506814337817431 17.291118079671019 -18.996294984675448 5.3729903782698578 -32.934546164022585 20.519633132470165 -3.9347393650854365 40.103247435742205 19.36945522047591 -5.3860920112251298 2.0789974410040646 10.011994208788987;23.689089489161429 -21.645667452999358 -10.444557407390297 16.028023399931975 -16.668163846924759 -35.484099433076139 -48.792044585681936 6.1133727201864314 29.674150739670768 -30.295468500936586 -15.765814821060577 -26.561553318302852 2.7788292085892103 -20.612550221490149 -46.474629055954679;33.159094751637227 16.415273436598845 -105.35157890235513 3.8996733823195262 -33.082268417877174 -10.738424214085246 -28.776558844364761 -39.708158824991585 -1.2299612623208169 -20.375069913377232 -22.71636622282616 5.8872836155523496 -38.770877145553534 69.470726382576473 33.918750353778144;-41.385427448127771 -5.4267397466891429 24.620678498452563 86.283875936353809 4.791955439730696 -36.053137040330455 30.135243762335733 -35.840699534203281 -9.1889090114690379 -20.716011206467524 3.7638987630936156 -1.0282120384047018 1.385950122067279 -1.4404954484759176 -56.514475092140245;20.838725049237478 -33.608189289458842 71.684466501513299 8.052878285855801 39.328035027360173 -93.972237057878488 -61.194329190467258 89.260265521039003 19.355844927172846 -146.16081004294864 2.6471679879122449 -45.828655288701178 -3.0213445605974791 -6.1432593985756352 -128.9248884325709;7.524527998035798 111.15986343421764 65.165065719107659 -8.8948356652656884 141.02885893829199 -8.3091582832224837 155.07620583575516 -16.408575917805461 -45.47911082144477 -43.912779528782536 57.03380444553401 6.9064905565389427 98.137404831001703 12.246056532421276 82.9378212538724;-14.89690034562074 1.0196933684604561 48.170961985200158 -101.08890424267531 11.260319256870662 -56.221647757111199 39.830064140388444 79.271933810478856 -61.862302420985401 79.936161057468539 -79.551852375273128 3.6057892597994723 -64.828796188446717 -7.2036345678858318 147.34844086170997;4.321272329351598 -0.83832965732676801 -2.988362179340025 11.775404529371986 -4.7527632392579324 -2.0922618068513636 3.1278409143891275 0.2392419321243314 2.4683416941669534 -3.0406535969729247 6.071831198796521 -1.1026783279499739 0.6166887282143434 1.6248892595393321 -3.3046165641907086;24.605160279130544 -95.492785185961537 13.728600119869041 143.16220453756378 113.81382857315076 -85.328531242404466 -36.275140309158402 -77.144196861575324 11.547164635745416 132.44285971858073 -145.99473619801617 -4.7687595053336489 -5.96464692030316 53.375441431389127 -23.662642106131582;39.592761864070894 -71.613866506024678 41.287496795225181 -75.750088278948027 27.008537568838104 122.49910441317407 -102.53758151670826 70.292700648440103 -45.363489891146649 64.878459849532149 86.912836785809219 25.139925736750818 -56.126316158606109 48.772225017939476 -115.45459846551975;103.37524014899955 34.764460345785068 -91.556947977129624 63.194097230362168 -22.191019253894019 -9.3706833327512626 -3.8661716722222135 -54.743332879240931 19.603797217323539 66.580172115122537 -13.229659260701444 21.388019139087678 110.01768795992815 5.4287918199177359 167.18800678542794];

% Layer 3
b3 = -0.88845036679520495;
LW3_2 = [-0.022465294116091796 0.014884642808170713 -0.37271496614342198 0.027409876631168412 0.0097183756473038091 0.040388207361223866 0.017229032468754735 -0.041778043306460844 -0.017573637611758314 -0.017365088010330824 -0.046624550984062041 0.42255797097554454 -0.0067672462978440092 -0.030358763712914703 0.009494764768380258];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
