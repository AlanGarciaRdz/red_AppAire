function [Y,Xf,Af] = COOblatos4(X,~,~)
%COOBLATOS4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:51.
% 
% [Y] = COOblatos4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.100381449508131;13.1578947368421;0.00618238021638331;0.0205761316872428;117.647058823529;0.0560224089635854;0.00600600600600601;0.158730158730159];
x1_step1_ymin = -1;

% Layer 1
b1 = [6.3817771615824839;3.7575400019723109;-0.51014416365896986;1.3176861545963472;3.721668410178868;0.081873501631878287;-3.579453629976221;0.43482072478338746;-2.1693470252284812;8.7299796309091846;-1.6568089006589828;-4.5287229123821549;2.8311964456061065;-3.5113685115971727];
IW1_1 = [-1.493397122024011 -2.4532257403064608 0.39254808952294901 2.0062703353468549 0.57210902467613356 3.2595584413902339 -2.6123163437056975 -1.6284527239506079 1.6573089913993506 0.19268290107920391;-4.7760356954789618 1.23496322497195 0.72542110730542331 -0.011161894396623734 0.096929755566241574 -0.41692785651236475 -1.160077021471948 -2.7710123720708135 -0.86385344964268362 -0.89131810688622648;0.59597176609261204 -0.58256715097525036 0.60877942120706618 0.48489681619075925 0.19481892531469444 -0.47349689679170237 -0.011063917407177905 -0.18225119013437674 -0.065260401687743275 0.13312479881596273;0.19616570966285174 6.6435079719587433 -2.8048757184524917 0.72377928312799134 -0.47006413821224641 -0.16686345278040268 -0.042437067687315713 0.59314022133201982 -0.27745690100099729 -0.2084853267894384;-0.079771479200168485 -5.0938047017567278 1.9416270650652918 -0.44660536268923146 -0.28221552654991849 0.16760552357853847 -0.11276176938507555 -0.21048939026793273 0.068803621036978971 -0.072127634851114397;-0.20815412832387101 0.11497276796166697 -0.82673491764378615 -0.35498501163224216 0.79967459313545974 0.8368739062875471 0.16319127326557106 0.5149260870060377 -0.57090377157846894 -0.23779188039114144;-0.3495423177624507 1.1117716031416354 -5.4597319127250676 -0.21125967861972939 2.1927346108845369 1.7584641856257666 0.28524955984934242 -2.5055869062037828 -0.56528654244933085 -0.157638548410551;0.020538287987172277 0.69850160114181992 -0.15339750753887263 -0.052797085763085991 -0.15994311620612284 0.19755988431072358 0.10233873338309281 -0.050814019935654028 -0.064861342189683868 -0.15813450867810172;-1.6889898252983897 1.3143679790703515 -2.0574112896682153 -1.1279465237415407 -0.56119528157207954 -0.82587280894428372 0.84172535151739813 -0.1437198177181776 0.76890096176257539 0.089010219283055206;14.745012994945734 -0.81436900618695318 -0.050319927649579752 -0.19561599576847311 -0.49610469841508892 -0.59847840222753135 -1.5330606841850798 -0.19543010699117308 0.25291143888787321 -0.030056529939572522;0.27672776191476184 0.30413946311789636 0.12517080051176108 0.99166403125542735 -2.2261636598557835 -1.3178559361150437 -0.25722729879057815 0.84531620416557862 0.48277371321862528 0.12063661042753712;-1.6249851614970856 2.2890067655259201 2.4707575201672336 0.23771227602219708 -7.2800508901627969 0.36141021399396395 0.69273192217252666 -0.5019237208745595 0.8583877941134368 -0.84071764395908799;0.26737083767474096 0.38108380596740876 0.38720325051542626 -0.00018111368899122703 0.92776656017170778 0.056177985179772294 1.2203663592900511 0.4608739429947375 -1.1936596130169119 -0.21016792116702027;-1.1586044045465027 -1.5431930900677211 -1.3871667306308548 0.38729002258002027 -0.44217617975461571 1.1350231481971929 0.0019933650521649447 -2.2653138515367695 -0.35816222403569759 0.051973293811587683];

% Layer 2
b2 = [5.5544317473442613;0.59855740939530233;5.1309415148954987;0.47703968316475642;2.8036427768128527;-1.4044924799071186;-3.3284976136325035;3.7460982480460419;-0.52073432139604692;4.1286401482348527;-4.0287288063061784;2.7482365318173003;0.1961245114967394;3.1987971539801552];
LW2_1 = [-0.80614377257421377 -0.71577399267580555 0.47482579801120073 -1.9249626475882073 -0.20119801540650417 -1.2431756864666081 0.060662916125334837 -1.8563157717418339 0.028349238403048871 1.4841946882709109 0.19106251213088318 0.73014163956504941 0.80978326098617759 1.7000206705641414;-0.92670730587993022 0.15549973733885808 -0.81864639643521864 1.1633405210181909 0.97142193029115442 -1.7679616813126218 0.86626358077080623 0.28197207086557191 0.096932293832432695 0.24208007003551452 0.81437348132479681 -0.29885253188556471 0.8942319495301474 0.4146707307425328;-2.2680446456238261 -0.23318037314877438 -2.107751083693405 -1.0343937194147608 -0.3399634311257097 1.2280626752155333 0.33404269907681594 -7.5338259340906797 0.12548481468097308 0.39401125671654824 1.3056552653985285 0.50395334358273469 0.68798176398643307 -2.1463873145884058;0.12795613860124044 -0.05457836866743819 -0.19186890074369078 0.27249179688588193 0.16960514182755101 -0.078475026166063735 0.012658241805845507 -0.26155718243303117 -0.1523248630691372 0.013873110413326959 -0.12118564600456684 0.094252291781511163 0.073071321576533246 0.040129930132938994;-1.0011868237597132 0.17263877620559365 3.1713670240151424 -1.3442595586546111 0.05048925220499427 0.71032785771658302 -0.22167470468832121 2.0994864572943355 0.43321076301790462 -0.15091345174715903 0.74461966912025357 -0.61326650710567987 -0.3027889755800699 0.059068791251000161;8.2498056230693653 -0.49657476353856111 2.1337521665704475 -0.31883173020069533 -0.92307730379674391 3.1150906323444829 0.22129966760402575 -8.0124302860196579 -0.95761265283646047 0.019753794508493183 2.3786774522127869 0.44750769047576239 0.0074219467249416766 1.3382343754226627;0.56672151336294152 -0.64367223725445522 0.26819177015838419 -0.48003252185957163 0.04208029367665897 -1.5075247201006385 0.62590694237906985 1.7505268710026169 -1.3903423803589068 -0.34878507717193519 -3.1448687792497942 1.0629240382740361 1.9984294973709054 1.4637062816858151;-1.8421947793146591 -0.0024863707654042906 0.0024066201934888828 0.084972924612627135 0.26288290518848728 1.2726846930376106 0.021542623965863969 -1.1936575113220922 0.30588231921777326 0.48674824946517292 0.82016342081369986 -0.19060826774487083 -0.9871865881487768 0.057183654806758299;0.49541025678841294 -0.55609373563394071 -1.448057201922861 0.097026517168107715 0.32022556305989669 -1.2883881814532312 0.70273272590865787 -0.64243421961335223 0.38658132295027009 0.67123356162748538 0.44440485908393013 0.64630094338528277 1.2533297042464902 1.2766944650703778;1.5575577337859876 -0.2015805147095899 6.2370540141764428 1.4732654621481116 -0.27903237233595457 0.69699476074948485 0.10133860571376346 -0.43882266780964396 -0.64470167642937715 2.0400109002612759 -0.3842728205620311 0.51703803180682117 -0.061704192630506999 -0.19668751105942142;0.69705964315845537 0.0081030930641324411 -1.4072241589400933 -0.0045931140579075144 -0.67732442756378419 -0.36100547468279226 0.31582539738853532 -0.8502230344957471 -0.031655424687513249 0.70144257401908294 -0.1529623504797889 0.34180466748923338 0.21738993363785966 -1.8499094580795223;-1.6772098755267206 -0.091068034852636592 -1.6445238276227994 -0.02491528561580127 0.24029783802716601 0.95491108342232178 0.099840428777715123 -1.2384116627220598 -0.0068141987582166245 0.53361452097377193 0.70066050277730507 -0.23673854441420006 -0.92622071907151982 0.28180022964110685;0.298331944963736 -0.27847531633188488 -4.6413830360183495 -0.50000583610961746 -0.98055071464088706 -0.6564065190913253 0.43071637574421989 -2.3239814586002452 -0.12208992381493457 0.74003317904378041 -0.24050486674555357 0.56083561987102681 0.43590374468011556 0.76850346042353213;1.017986826574238 0.59918846962505345 -0.6807307742639338 -1.6735342114290011 -2.1332667141613211 0.056515439739816389 0.022425091885392198 -4.529718812902364 0.36533727739258059 0.54165503893167011 0.54272209170665109 -0.091667202094696462 0.80028685156703472 -1.7529061478993953];

% Layer 3
b3 = -3.7550298805022901;
LW3_2 = [0.3218940620800439 0.41215480232142343 -0.52825219267902956 4.6577996537760633 0.80413563309062575 -0.20970255528563664 0.22343405367097344 3.0731398867731099 -0.4827376234271431 -0.40865078690742401 0.88040145959832128 -3.0243712263789537 0.90819008773602217 0.48031541500008135];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
