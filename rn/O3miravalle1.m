function [Y,Xf,Af] = O3miravalle1(X,~,~)
%O3MIRAVALLE1 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:41.
% 
% [Y] = O3miravalle1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.304971027752364;2.48447204968944;0.056980056980057;0.0063552589768033;15.3846153846154];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.8862022090565524;2.2691835596202803;-1.326957802104066;-0.14952721134291913;0.87832466422611721;2.0371475444755411;1.1715331605449284;0.63395395933694221;-0.82245687964470249;-1.4615730240447884;-0.79577682110580295;-2.4129528972223211];
  IW1_1 = [0.027972072362136956 2.0767017863076718 0.84905057031620002 -0.029230417789905462 -1.1086799648884103 -0.11563507586237841 -1.6318001294300934;-0.34231440774798266 0.21572778383022206 -0.48974015453803832 -1.1201403986460872 0.36018112524789386 0.1352757462504646 1.3935249310713926;0.13945399538169811 0.13198793274939608 -0.96537736420181941 0.067872616775767877 1.6814261689702255 -0.14105890801729568 0.13718119452244368;4.3193446178472703 -0.17206122259403966 -1.3011382170704 -1.1575643182310413 0.49856314088964915 -0.08013511550771317 -0.1016704439201959;-2.7375453255652662 0.11284230338253554 0.3395361983627484 -0.20021514480647654 0.54492803511443522 -0.040060475281494236 0.55807216327007392;-2.0186109315284138 -0.060917039691441667 0.84493925037857764 0.22051604298708508 0.023200354845001867 0.010942231091425307 0.1835500158561712;-0.078998447565174809 -0.27808148254729986 -0.36008248317145747 0.518449862493366 1.000629931036515 -0.041754993311687832 1.2251047225876466;0.23088963268275101 0.9003082089804556 0.72616790140196019 -1.0910327434170719 -2.3511125503757682 0.072168896496942858 0.81803932567769821;-1.3416138224382044 -1.299570540053534 0.22409283454563497 0.018256081003011224 -0.21792116202733061 0.18213805614834513 0.71315830276390202;-0.69402775299957187 -0.04538730081365272 -0.36791630737116993 -1.4443947809490025 0.56017860054508928 -0.029962048124233372 0.3702593919447269;-0.27682477032579944 -0.17387493947285934 -0.59175665419647927 -0.027279777335557143 1.036346899336632 -0.061493285759183898 -0.7032157243448367;0.4302556996513372 0.19231278652076345 0.08077407954939117 1.1011168065050154 -2.2514064428742477 2.8086813032180427 1.9253944370804412];
  
  % Layer 2
  b2 = [-0.27406152130829053;1.4794215466544638;-2.5909607706873574;-0.6271850024237563;0.39742804522457337;-0.50861608937007652;0.21268769577568661;-0.74102735396374486;0.4166731670411733;0.8248240355220865;1.0330478160351264;2.1712108681704074];
  LW2_1 = [-0.13123828081844247 0.69165160532340786 -0.06875166680854379 -1.4202408765823009 -0.31558357284561345 0.91699692108347286 0.26056569184763845 0.14929836677490069 0.2440568876116764 1.8875601988788833 0.040830900905139772 -0.96490203275961284;-0.15824108631737649 -0.60564667131214767 -0.58551605707677623 -0.45663724621146684 -0.44434292651368196 -0.022098261632016367 -0.17542894382199992 0.67712765664806218 -0.17580637185726969 -1.0316250673463654 2.2103610195686842 0.27144224837499692;-0.66483863914686536 -0.52763117266489612 1.0205660351389845 1.331362495162272 0.13949711928346267 0.48677309537308938 1.8516086956978355 0.0049806629802613966 -1.3160081464628517 -1.2132627112214354 -0.9624952760864165 0.6095357571177189;0.90903450153179255 1.112539453691024 0.066995637424941495 -0.30604535679743561 1.0788417188399269 -0.94445893393955793 -1.0433572438935284 -0.1942368367629547 -0.050051696232895397 -0.89924656824004745 -0.4950435896212339 -0.83726280406311793;0.46613585481253272 0.55835633177006383 -0.084935086735011434 -1.2855920267412302 -0.095761927523337814 0.60253332992657271 -0.11153603973885251 0.061861537227890527 0.25866314085572684 1.5872120177845266 0.16901068280116707 0.31626884573645381;-0.87299980582597414 0.022230603874611267 1.2577324454586458 0.47941775613528753 -0.36100165648979382 0.91876490894863028 1.6608927959284689 0.49973488719019676 -0.60061525685279327 -1.3630900707044431 -0.15388544848738261 2.0961659734694309;0.64039327256638401 1.0066386632890529 0.76017865981076638 -0.94773611817407188 0.3360112382255675 -1.6958851661430525 -0.98305753479898894 -0.635119683864378 -0.150150818101772 0.67267827543656078 -0.12291523488914188 0.34356612841872447;0.11087800785993102 -0.92444077896962773 1.1157564182274629 0.35415216391358756 0.77895933361690783 -0.96553932192415504 0.91066277228551484 1.3260346409035124 1.7096555004081586 -0.39366129598383992 0.70231696465967497 -0.10272336316701904;0.19563990704531911 1.070268057149254 0.083201491288236215 -0.12528218998310484 -0.1574156839876362 0.99402637460859467 1.0651422125446901 0.22429741115598312 0.76698037209086189 0.8459165602972315 -0.79862638932691576 -0.29184650701707482;0.77298064308767733 -0.38312646520250226 0.096826372275098563 0.29103200666663193 -1.4588947895896938 0.16068020216687345 0.53534677824627686 0.36620673007449345 -0.19858321213578617 0.035588457333922109 0.84977588104495205 0.86711528277562255;1.0603677698178902 -0.038471733939420855 0.20957105328343886 0.3768549653476756 -0.37638777553734315 -1.6018401071773494 1.1076577277728248 0.31872065932789378 -0.060323803818189255 0.26359796149314435 -0.46287756516508083 -0.36269927769522542;0.17652878316207288 0.64380358463069454 0.46225560391157178 -0.59055622875671943 0.046837399597445199 -0.23105662210137135 -1.4762113076649115 0.02972233407340133 0.11909471385981908 -1.8321493786412577 0.14351329730500625 0.15531199504366697];
  
  % Layer 3
  b3 = -0.87752706169981654;
  LW3_2 = [2.3768369429104723 1.0712240317343638 1.7548721189440784 1.2834887334220084 -2.7993453641273671 -2.288407657522487 0.16006855963903582 1.2551542587527149 0.38945484851920109 -0.62619741952460839 0.58784157754144761 -1.9410001071542617];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 15.3846153846154;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
