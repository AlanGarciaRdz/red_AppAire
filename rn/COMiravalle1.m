function [Y,Xf,Af] = COMiravalle1(X,~,~)
%COMIRAVALLE1 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:42.
% 
% [Y] = COMiravalle1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.83191666305086132;4.6714317169569899;1.1566984900001778;2.4467501602069022;0.075594688785511926;-1.3979095640251911;1.4376146874020301;1.4517632222267358;0.3026036218115768;2.5400531368208816;2.888502840066522;2.2226909379717568;0.077991564216191134;7.5822859525879736];
IW1_1 = [-0.13539821929971271 -1.8842310491036847 -0.35657771353803436 0.83634844858636992 -1.3404485151161067 -0.20610495203686766 -0.68668527827848969 -0.14048886125540511;-0.26872882263793557 6.7491292107973502 -0.36747438149728801 1.149664995095615 -1.5059892145363865 0.15427342759605853 -0.45103629811058765 -0.025102554741181345;-0.33673582928849288 0.21616495669117827 0.30223353968708 0.050322685533020065 1.069828812227797 -0.69578502945150855 -0.064226182383519959 0.92557071443009131;-0.55098462162980155 -0.38712147355434029 0.23142239302180379 1.3211062427680194 -0.9673628333681058 -1.6412242267165944 -0.69093154379264154 0.17392846621229244;-1.5896943589477579 1.9816474642217581 0.64963044768128653 0.56982312190360496 -1.2920433303354115 -2.8364518189449104 0.17113123710814415 0.74288255016996541;1.3501754126363341 0.24539942985603513 -1.9895955074601117 0.26476685784262527 0.71022157791076301 0.62531109070109547 0.86999548497017598 -0.53837240322928614;-0.94481211997417791 0.047518475246724541 -0.31732480028275417 0.089527876262701381 -0.39748453632983682 -2.9015497311806935 -0.56519960813051051 0.15362705826300407;0.27689102244312835 0.68847130771303466 1.1773049511309546 1.68832808408516 -0.84393915160352573 -1.1367594495999374 -1.1274413621143715 0.78367878455399576;0.074892861447353715 1.5204018030810393 0.74040101763118726 -0.65333016075449024 1.0648232173130447 -0.66496620811329654 0.73020360725588129 0.62128687834279106;1.3174332955160462 5.0448002174619333 -0.55550828129050878 -1.2973916619433361 1.6088031908491123 1.5506752631020784 0.99287412239556194 -0.6738450545539969;-0.77900259711199404 0.086444864749495406 2.7720545445568194 0.099734304783228783 -0.27051988817907019 0.21399771694429412 -0.54868429052033696 0.55899432282850592;0.34195538045490737 -0.21559255594731569 0.97614550793631505 0.81353135554387568 -0.49232790204261512 -1.3272860671570987 -0.3362444464712801 0.29207857436667312;-0.62460035408942771 -0.45868821221173828 -0.87731387865648769 0.13164004289064798 -0.13793114101960843 1.457334557150483 0.51198446533184838 -0.54295191841364154;10.622077174884026 0.83992473840189708 -0.99714005314968612 0.4801144168913728 0.32290932377609266 -0.20580894930327381 0.060781644474508706 -1.4091502721775597];

% Layer 2
b2 = [0.81532362140314574;1.6821849313133574;1.4095008785780598;-0.87101896145105107;1.5482201779840341;2.3463608986332263;-0.89831836402801812;-2.3988053206539179;1.6731784259096441;-1.1881817476253564;-2.5047770442897281;5.4460781782393068;1.3140349410286694;2.5181848246480945];
LW2_1 = [-0.2526222277137688 0.026290046414710399 1.5033997997910982 0.66962298661582587 -1.0708986632596333 0.9047512495974992 0.078355300257154162 0.45049306452303772 -0.72792699922373261 0.088067185789610508 -0.29786123496644623 -1.4599925231236894 0.99922179038776726 0.0061785388699033212;-1.8740218808850146 2.0935131431600493 -0.21909143239402507 -0.19683624290457757 -1.8731981232490096 0.95687024362479156 -0.58582994315647663 0.17988010408995744 -0.047029689952370682 -1.4385481743819553 0.61256493910978405 0.85929477814494271 0.14606854851784068 -0.59235004498024713;0.55872311214493364 -0.16758971889686763 1.1990270674222117 2.1595435584886822 -2.2979635946965078 0.99290485862415268 0.38653783815836895 1.4113032247824815 0.66710701990888543 -0.044283538806465461 1.2733878403719889 -4.0705594901161462 0.85633731367335308 -0.61042536399306213;-0.98804158630495698 -0.14988559322722339 0.80183661728957678 0.47133827235172787 0.95859361919968777 -0.16012203187344473 0.68516245547730859 -0.34726779839599642 -1.8685196332667098 0.19074852586122387 1.0541873896089795 -0.8159871326010697 -2.3308979628863642 0.0076914885668581123;-0.96301137139976534 -1.2724867837851348 0.051965152689412986 0.14931971943392774 0.041695639899511978 -1.5658775353637271 -0.43195483930751494 -1.5816967775063295 -0.45873229122483777 1.2543565035613096 -2.0555417275845267 -0.29362170739498739 -1.603388020029952 -0.39348274273535405;0.8720785503469316 -0.15836304009604288 0.27500673606779125 0.76979370913401735 0.37148048548608442 -0.47549014891227925 -0.47232139497390457 0.3490429044071075 0.59899529958551978 -0.31264104945974758 -0.90724033243111268 -1.4670455757154304 -0.46717327463673297 0.23531747700980557;2.4370822222516382 1.5335653038069845 -1.5675612725202486 -1.2064343710223571 -2.0136914689321328 -0.68170884268793697 1.7901004244859682 0.60389387462741784 3.7081392658911447 1.4149311840291936 0.18927756445499661 -0.92629144074869119 -0.61452863281252612 -0.053793336972612724;2.7411153057398798 -1.0008134537573827 -0.67750648068276931 0.67311098774784861 -0.98016442132755655 -1.0492815826246897 0.12610604656948343 2.1929707645181069 3.323280014553371 2.0121551483520266 -0.34766845973734678 -0.71612584031407167 2.8025420339644533 1.6445811224434119;-0.71762013121209189 -1.8762796734894551 -0.47767570878687726 0.054916212535190898 -0.41087200146979563 -2.3578526879243009 -0.43259679712698612 -1.7316853802923649 0.4288622128525702 2.0077884711886838 -2.2254169695927954 0.02853775209548385 -1.5537811292783765 -0.42921726521290493;-1.2966427668731066 -2.8463646455582845 0.023684889413052496 0.51136748090078399 2.5596588230006376 -0.021655083984655765 -1.3812519175870599 0.086714758419370486 -0.16739984243195319 2.1938600883432988 1.4725991947787185 1.1575364503954426 -1.6698306802108562 0.49220963860605255;-0.055691629225933056 -1.4150267066210578 0.017772635064466899 0.23378384304271344 1.6548112461527524 1.3393423006778022 -0.63820276729676317 0.70317538706761074 0.5121902205820037 -0.22802267200542747 1.4281377808724156 0.023183653743944252 1.4627291130685451 -0.23561140537802494;-2.8690839705160669 -0.56426376357791197 0.32610427295271516 3.1758769197107903 0.47315910083307955 0.3411423266624537 -2.8472433719720023 0.6096108486291032 -1.4124065866985376 -1.3186640736438231 -0.1617417523400643 -0.27601117165313144 0.340843363752656 0.23346618331598173;3.4324009290416462 -0.25456566767029409 0.75851007557522043 1.0643656117454037 0.085086222650388926 1.2975065979020988 -0.2342008394522351 -0.21264209726691471 0.88270125805464716 2.3796748684531304 0.12616921272190362 0.28361310872959189 0.40504381476335771 0.48937878006985747;-1.6435580358071662 1.7834857250671292 0.47231928401301093 2.2348565061554222 1.4853804369803141 -0.35249366158009587 0.13970859081424267 0.84520132584387997 1.763023243158151 1.2180677816101217 -0.11650406697735745 -0.70602360039569578 2.4249281717569762 1.2269254658767121];

% Layer 3
b3 = 1.0190241388949681;
LW3_2 = [-0.58549636707750685 0.18480544988103684 0.37445179094866177 0.25434030465979002 0.53609776767549944 -0.66156463026204859 -0.088619595926513112 0.16487983454960681 -0.37406319471993527 -0.21984302567426425 0.45828849675334871 -3.1499448005940844 2.456505366636375 -0.099913729894160322];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
