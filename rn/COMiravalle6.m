function [Y,Xf,Af] = COMiravalle6(X,~,~)
%COMIRAVALLE6 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:43.
% 
% [Y] = COMiravalle6(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [8.0878402750297447;3.846287265079908;-0.36360186707923736;1.7005440720835665;-0.28444544799073584;-2.1315395706575013;-2.2248960228295456;-1.6122756832987948;10.80710142097829;-0.82121990672534317;1.4791946927903015];
IW1_1 = [0.13110509954880009 8.7453618281887433 0.47494983841994043 0.47493133669706278 -0.34039802581911843 0.2463197954705707 0.087972232053119104 -0.34457101627100084;-1.152923026982714 -1.2945793206780518 1.2845638605843039 0.94660707601195093 -2.0320921140207813 5.1343693363533571 -4.073688622476153 3.9861110034076663;0.20670178752034454 -1.8860627781855799 -0.36158932749082628 -0.47130934035805666 -0.21419953312178391 -0.36766383154653343 0.054393528805420394 -0.25106086371596326;-0.36195011519486248 -2.9410730802501437 3.0667299687891192 0.66374256267623177 -7.884475808167581 -14.400093680014329 -2.1711952922326692 -2.3069455379899231;0.95044819847615869 -0.24194999668264691 0.20354058281070719 -0.3798923744933082 0.29539384929815743 -0.40372270485965045 -0.085399386989233092 0.15529348008295832;4.6341866931887985 0.71573554246588289 0.28816347267819831 1.6995796332957305 -0.03487938647725685 1.6741377712070908 0.28756375946694607 0.56428583491696094;-0.62865058416698327 3.3058194362900588 -0.73994356841589226 -0.84175281245925448 -2.3827142397951468 -2.9188429639912514 -0.48896421072467483 -0.64637476588108511;2.4586794772055818 0.24369253079354852 -3.3312162445737301 4.1514829492925642 -1.8253324170150904 -5.1915806400188611 -0.78199679111056575 -0.6230446886732528;16.111034755116389 0.54071384973119918 -0.14785378367711016 -0.037217774230412323 -0.48830773421472728 -0.7285505614833665 -0.46142984346914562 -0.062785060806506823;-0.44168328363756354 3.1047204559546939 -0.090198570776853226 0.90152703816567836 0.46888074935906476 1.3438133948314037 -0.012844180711314655 0.6532623886982557;0.19933505207410601 1.0489031152314672 0.34392053764167368 -0.016368045332673088 0.10430215347830965 -0.0026075542905138402 -0.11915217033699962 0.1770857550680463];

% Layer 2
b2 = [4.7872022368144629;-1.4530934638588513;-1.1834339821079527;-2.8339429766297917;1.7605689424069861;0.67816244276724291;0.69653425362034982;1.6556263785466618;2.8303298877929608;1.4321318776870926;-2.259004378520364];
LW2_1 = [-0.45916895870615726 -0.21133655557955003 -0.59091060228924097 -0.035218440228881383 -0.11703285987188383 -1.3400651935897905 0.69997041754839229 0.65730559579485293 -0.37021038434707532 -1.0048814776741719 -4.1231855566740201;0.83568352214703645 0.33430964239568312 -2.0398378376473536 -0.0089413108460580006 1.8179470248661596 1.0296824057125733 1.1454706526843219 -0.81540286321012545 0.29274390765146924 0.27290719341495767 1.6206286620329391;1.7773988641624034 0.18160571070899037 -0.9811708633773214 0.1600535333688011 -0.082994040018407891 0.65684659033381121 -0.42509927173880824 -0.5184968474567816 1.3651842211064145 0.39126366253272876 -3.3801358477435266;1.9106889582916091 -0.092578637538850261 -1.8526073446454869 0.016093146130149297 -0.2397539157615152 -1.7949627761252931 0.3128384541273494 0.10119617871885209 0.62331608718357323 -1.2746760823173147 -2.0837975605086125;2.3433936769772039 -0.59459518291220081 -5.8394996696501664 -0.40043651842837996 1.8265089589160561 -0.50514294934170623 0.96450233990371737 1.649450422263262 -0.43545677975987473 -2.3808789668712782 -5.5095278340383089;-2.6952538871353089 -0.13819601332436685 -1.4976179319761518 -0.26954840374336508 0.12601005209686272 -1.4388448463220713 0.44343573326346852 -0.1808560264098282 1.1437721460549559 -1.9264102495007931 -2.0896194286457974;-2.013790419797576 -0.29965812124450725 1.0157113883520743 -0.52618503638594472 -4.8926374639945518 2.2208289454732113 -0.038500196218981569 0.42229347758408448 2.35685123628337 -0.96533020641773837 5.7998273371494902;0.22292933789691549 -0.42696295237109233 -2.2016526724660914 0.31728330715419273 2.3744269561277238 -0.47110430460170521 0.62461061385155048 0.36607619641420514 -0.92084868834279909 -1.7831216338620619 1.5637568633620054;-1.4786192499457929 -0.34206082751634481 -1.3272392111948654 0.18840854154931264 1.3479229839371112 0.54289254073754256 0.43664600586822588 0.54665784715418397 -0.81348417014772878 0.74389624161287704 -0.50349685503479724;2.7824040907439813 0.35857025820428667 2.4363634636245779 -0.28976663585124174 0.8541806459624941 -1.0828545992835115 -1.842155415660728 1.2132484830579857 -1.3551428208473586 0.0069576964281380729 -2.7632996945239738;-1.2541107686400397 0.18720933976849777 -1.3333704592418816 0.046603916045642742 -0.42406137244462627 1.5887068892766167 0.73076319757076047 0.099685909386921304 -1.1424949378957532 -1.1867563781813366 0.60006953607400437];

% Layer 3
b3 = 3.9872356786701473;
LW3_2 = [0.3857401865350315 0.198680400454149 0.64867289904779091 -0.28857123179632244 0.21473850789380264 0.23224649314887175 -0.69598864976168351 0.22835777258979267 -0.2294036754507163 0.12435771914373718 4.0344275570444141];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
