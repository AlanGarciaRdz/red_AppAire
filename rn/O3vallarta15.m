function [Y,Xf,Af] = O3vallarta15(X,~,~)
%O3VALLARTA15 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:54.
% 
% [Y] = O3vallarta15(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.12820512820513;24.390243902439;0.02710027100271;0.141843971631206;10.4712041884817];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.996674528605026;-1.2335569716705366;-2.539681608793662;0.73187860849725284;-2.0154787524112807;-1.4363698110966909;2.4066885255948502;1.691917842557793;-1.7658536490557348;1.5783725676228613;-0.35906579667301392;-0.86341371931623612;-2.3214813794564799;-1.3125860324271723];
  IW1_1 = [0.5788438121682189 -0.42656296773783892 -0.97704819338735882 -0.18212710683363686 0.090825387755054277 1.2751682671342619 0.26683888802170391;-1.5048785535480802 -1.4538935498626784 0.22927147907020035 1.9193686455542391 0.64244065492955782 -0.18481165161712726 -1.3436497973428121;-0.22334591916460755 -0.60788436232904397 -0.1302115017730468 0.48104539969076776 0.74086619632616235 0.68430242172268507 -3.5864712629993716;-0.28513679915130552 -0.1604830776017466 -0.88332081978978338 0.38950425979107051 0.73845694258678007 0.56644114932266443 0.160850869480962;1.3438645957609197 0.6170831332107205 -0.82703113467855005 0.09994402055587312 -0.90929755795449696 0.0070372008561132814 -1.9106983801468267;1.4679045757328519 -0.10376749016964906 -0.089231976453295003 -0.64440689434129594 0.23248375704175009 -0.43111654399762661 -1.8728987053859532;0.89404326720187566 1.5277055633549161 2.3166390472060714 -2.2981488866217763 2.1820575139177572 -0.33148083538119499 -0.45234909170618753;-0.27041775777040089 -2.387498093692094 0.27661165770910595 -0.97625850358802879 1.4432689282590379 0.30400794635579748 0.45996528465955899;-0.2012686531122114 0.63948428811415725 -1.0173519478587318 0.11752961709839885 -0.74143543338395457 -0.022025448938527627 -1.4965756477911816;2.8705971162739496 0.60566212595490521 -1.2298443593209558 -0.38772978771545019 -1.1930238161842126 0.82829641305589841 1.2945502171568826;-0.14849718470335282 1.681676060712413 1.0549391790354095 -0.47618170531994797 -0.19234672690173618 -0.22167971920747126 0.65082155948299913;-1.6686103613623802 0.65481534442418365 -0.86682593873076119 -0.21854809333639733 -1.05892109598103 -0.048353595736820423 -1.393683582583408;-2.1286331586596008 0.69710907152380797 -0.8871980450112803 0.70579478013096175 -1.7970287774283489 0.03025350647246914 1.3418364913762859;-2.2994213194586361 1.4563363554070896 -1.0090749060287061 -0.0099261701484224998 1.5018007087040084 0.24805452716757406 1.689835675302692];
  
  % Layer 2
  b2 = [-1.928852791847204;-1.5025848687012111;0.55691102883831023;1.0173294835649811;-1.1007666233289313;-2.032925018861262;-0.11363022421734011;-1.149341775376663;0.36851844156846414;-0.077520461965826348;1.1775827096092712;0.83047207233190001;-2.3342954698447635;-2.1918962728248603];
  LW2_1 = [0.83437910398567672 -0.1359998025996389 0.20995971551670883 -0.50210495211540063 0.062554833242492849 -0.26559019720910781 -0.13069176137728841 -0.050185722469833285 -0.056880562084199664 0.023721930774855564 0.4364646991987165 -0.72240504504896974 0.83172436220254753 0.74786031454205093;0.53519047657447594 0.46923774938319579 -0.35333786497523034 0.26897075469159931 0.28831171144893342 0.41528418287488517 -0.37367274866856726 0.49982866853272678 -0.003233156788949261 0.51932752177055719 0.26703713724096867 0.28032867025727326 -0.32591168724021236 0.61619739941960905;0.017354878073343304 0.21941219281352495 0.029019758345373726 1.0538168923964937 -0.06369791931737194 1.3402602113748709 0.70756791419104703 1.0029807569268276 -0.27362490031909564 0.12223913299088313 1.0306895768903588 -0.49245707343045192 0.12572990116858104 -0.38549819129555918;-0.41127611191729507 -0.57811985948137368 0.53419423887933948 0.30442914106970409 1.0179113561064392 0.3500148916205662 -0.40651396839318582 -0.51266871744535181 -0.82050302811784959 -0.47530307903188884 -0.33600572338890544 -0.53482897758549286 0.55701298130200239 -0.067053118892848498;0.70931410666125438 0.78490852163746505 0.078617805606317814 -0.9114906990552849 -0.84936068241500218 -1.123640649149257 -0.50243589521079768 0.3724441932490718 1.3030885955343057 0.8525212236869798 0.54077384624012081 0.94411221984104854 -0.77392199597512368 0.81454235863564728;0.77614677509267915 -1.1930775349441396 -0.60451015647816864 -1.5027356626331567 -1.1285598870064228 -0.057603611947858541 0.21662573839425014 -0.29269983094246932 0.69241488813184948 -0.6507692599164504 0.2290230421358331 -0.068666121361812313 0.421753920363237 -1.2905497138923303;0.12013905877491199 -1.2802881664267851 0.7496998674414499 1.1760869071913544 -1.1465057651619424 1.0006815919678398 -0.45006716734663543 0.027754157360914994 0.5004834498758054 0.89109699620390515 1.5543493110501789 -0.56355926228787512 -0.011380653195481961 0.019951777238727309;0.24493940822987301 -0.58429290853369509 -0.56367252431201131 -0.35748324518007513 1.8067665424003565 -0.17488906602399698 0.25550083538069368 0.12832031698773855 0.15174820011721757 -0.14556871632602894 0.52075983774148427 -1.4587888091176211 0.27133673349484638 0.36469503719422797;0.22986638917176364 1.3125209379637137 0.089172508650748064 1.0792802304432465 -0.80781054730726531 1.482697645867155 -0.2781535030170651 -0.12852260721558986 1.2005533718805073 0.99352128910452819 1.0334982158489752 -0.65998005643972357 -0.82962040148880445 -0.10373629748005564;0.78721430790437041 -0.26687435532019554 -0.4879276766318188 0.29126897487189846 0.10120484186060887 -0.13425741697087284 -0.10443520985043696 1.0978748421921898 0.18407222235440171 -0.22437982264992207 2.1284564578345688 -0.09221214266055279 -0.15076302220631571 -0.67985038538923215;-0.17460339027154795 0.26387633056500787 0.30363909282528395 0.21101586267671416 1.2769622562400555 0.4020341952099788 -0.28054711966617235 -0.11996580818705267 -0.64656663415977411 -0.58733352192914423 0.12854613516563326 -0.70820087613499905 -0.28890985309781136 -0.11511971894773343;0.69265599830409341 -0.29211005090385089 0.32439077381546733 1.6292237352942969 0.36022244346316334 1.0348045923583207 -0.12202658839769409 -0.34465917330320378 0.21857902108309399 0.23574576064455527 -0.40868784647272466 0.055863983756989234 -1.0339708800793428 1.5645081318494831;-0.87813759033188921 1.3475111274790004 4.299229709122395 -3.6150649704023112 1.505877800305544 0.38821705010585084 1.1537266008356362 -0.40415966551577576 3.1724361942015271 -1.1218813326635242 -0.20324200280384769 -1.2682440178251431 -0.023349448415395255 0.67647593564670572;0.81124508899494741 0.6063005370796124 -1.2199719313177231 -1.4585140810721138 0.27870824379780618 0.1272399990204334 0.18667234720536294 -0.17910956470591941 0.13581136868122798 -0.86241308747862988 0.13935043116730811 1.5976613793275141 -0.30970128323581708 -0.21813375633261595];
  
  % Layer 3
  b3 = -0.63161205145417454;
  LW3_2 = [0.75948657255792751 0.83210952247396452 -1.2953941695889359 -2.6046216790048224 -1.1653515593125425 1.0617760812552097 0.69032329988965246 0.70602803761214772 -0.66502697157099355 -0.61936105385465856 2.108065988568244 0.4277094679748682 -1.5181190692507243 -1.0348747794166289];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.4712041884817;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
