function [Y,Xf,Af] = SOXVallarta21(X,~,~)
%SOXVALLARTA21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:30:08.
% 
% [Y] = SOXVallarta21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;10.4712041884817;0.00782778864970646;0.0208333333333333;24.390243902439;0.02710027100271;0.00630517023959647;90.9090909090909];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.0953008731414129;-3.2255547189897293;2.8010398065451412;2.9090086293853559;-0.77410844679497492;-1.4169350419475666;0.73138831407297833;-0.76915073583302274;0.35002900262437142;0.84756334241726572;-0.74793387627905183;2.9989131069902308;0.4404113296140163;3.8462838501805572];
IW1_1 = [0.0020582053761320565 0.7898919007966243 0.66839827244741168 0.28047310831366234 0.66215791646508715 0.48235333721165569 0.85882190026422756 0.95147285605947984 -0.39005754703336276 0.38856589756183479;1.6564821959248663 -0.077887638723522057 -3.8769773667498573 0.52909586642157347 -0.27320876937887251 0.0048257333790476808 0.67487405471373374 -0.98113914672822322 -0.058360493469806526 0.21225298414512972;1.0467215083063952 0.24464600408032602 0.82207242838612127 0.83930402431062856 -0.095839129035966572 0.81692965489182323 0.85526685884647558 2.850265863807075 0.076500469748104205 0.39083717297190612;-0.87985175399129767 0.091195741282329545 -0.76269209260660253 -0.27066289028498403 -0.052759162952557268 -0.72637023313102267 3.9748551259288694 -2.2701034252762846 0.098947451776800227 -0.47488309478674651;-0.42227374530799944 0.14424333166767797 0.4366511832766331 -0.25419586877561884 0.36381622313161949 -0.81716426970146028 -0.80492089697979952 -2.9126498460113983 -0.15545924770958036 0.40671511650365366;1.3852247648591107 -1.1222733135004563 -0.11488643278334512 0.3228295470604633 -0.31974603181486028 0.9141581688199768 0.68248224869004115 0.069697601972319695 -2.1114179864435059 1.0503419692714777;-0.19083594998659975 0.8540040767003777 0.62881376672054445 1.1816514632818882 -0.42093543296195957 0.55153389571479727 0.99681384419502306 -0.2403685932303061 0.44624997436345659 -0.46133633182102801;2.0948752904444223 -0.30454913335206046 0.39401226678548096 0.10773465552193454 -0.41712827454848644 -0.49387363638841331 0.15663522581076303 -0.48755739696847872 -0.02431384058496798 0.36667875575377357;0.21621159564280487 0.9106747560276387 0.98437243311514877 -0.83421210927425227 0.35941610664364854 -1.8894668895351803 -0.21446004833971438 -0.073824450846605091 0.4107458222309297 -0.11191088960365611;1.0209767379141408 0.25458897420998211 1.0471208008592781 -1.7917594004365436 -1.1686710516174257 2.0326435397613967 0.95545887029299637 -0.24884682394177751 -0.83818930938018865 0.74171074100985657;-1.4684229719636774 -0.11105004104062963 -3.8348852228761312 -0.10452965183374936 -0.17359716904484573 0.02491662986748517 -0.23268387799102963 1.7206629078270284 -0.19661852191171997 0.84851997421526648;1.1558422026489574 0.42609067479236057 -0.1030700327138903 0.035715211295306852 0.46005074545062125 0.086949749094546461 -1.7855341600453503 -1.7680432224621863 -0.77402879684068082 4.0649723158361448;4.1539559276697062 -0.21303621128416342 -0.23840821905453441 1.0122869645220698 -0.005086481196702991 -1.481952222682734 2.0332283074378412 -3.7923561711920595 0.44947417505716636 -1.1870732731361975;1.1626920811464256 -0.33620502714899048 -0.70963942408040448 0.86459319277431579 -0.31477926903354619 -0.065321059613668978 0.039589238922752901 1.9113571567576386 0.22480373335908072 0.17454272712054691];

% Layer 2
b2 = [0.75466627274926723;1.165765175552308;1.2653058743532732;1.0174823824343171;0.84033651412832233;0.46833989270447984;-1.6558362603459176;-0.33663464603708987;-0.77606268366277775;0.83151740056296419;-0.36525275911190463;-1.0926096563785992;-1.2827130964609723;-2.0232587551559975];
LW2_1 = [0.79523926832231018 -0.64964427818917336 0.33646545287299967 1.5027674401178415 -1.0235318408235072 0.68145140938105631 -0.043449519018764753 0.12078807342630463 -0.20064664651884986 0.23831463139086759 -0.23013925764214599 0.88172063280732405 1.0475804207044601 -0.37086747751641208;-0.35835353435114914 -0.76371950718488424 -0.30766518785584801 0.49742671010128303 1.1297081289346262 -0.068220511353655866 0.22517159397671244 0.70349027770053685 -0.019640860190846838 0.25535340189916078 0.45853263868111555 -0.94575963038291599 0.20379444335973371 -0.38550817946261839;-0.47893021487679138 0.8514985400331847 -0.19214809778732991 -1.1555268664351113 -0.083272244953890018 -0.18424957776749568 -0.0153270738525277 -0.42037231453284452 0.12945424434223077 -0.33542595990657459 -0.29737992918538597 -0.27193530802773552 -0.86145906365684499 -0.32030180364898547;-0.55783502516135031 0.15836071605937696 0.79129036306523104 0.095357316264182895 0.70469731937425406 0.18743356408360912 0.31995913905780277 -0.59348539878729611 0.82316299738216403 -0.85311278377110433 0.20607185560869803 0.69742487823584531 -0.94770030480905842 -0.059035186927016266;-0.19028452337374646 0.14779887210611301 -0.92795940446312974 0.35404740206348295 0.34803880754650107 -0.70257756088953405 -0.58784242623918437 -0.5942552236251446 -0.74091342493890311 -0.17857016356436975 -0.2726250518331611 0.017501323382563549 0.30123714568725746 -0.30432731298356325;-0.12251055050075665 -0.023224553430422852 -0.28141553164877564 0.61797831741291864 -0.64306706642762834 -0.5293375232389792 -0.68962244829243302 -0.16187047388488965 -0.43027677487176186 -0.49641565442735397 0.25013952713373688 1.5665840930377724 -0.6409230541934765 -0.15809284563759443;2.0038148374747986 -2.3359952242374722 1.4691209148689675 -2.0109587494246011 -1.9931467909734311 0.3358644565889598 0.090981260687073601 -0.70010496352470097 0.44059411801967124 1.9118631433599909 2.6101082264420477 -2.5982995486346714 3.1322584225192371 -1.6925372674988859;-0.21984412552958971 1.1900497195150115 -1.0200420081197243 -1.7321843580400411 0.80204768283669015 -0.45076420589614491 -0.019762136531622031 0.1544346536098562 0.47685657183988567 0.59665209707126088 -0.71606370125873964 -0.6185044739139387 -0.084739041905957879 1.2042837100176986;1.0456153484928079 -3.1126146309583156 -2.0815138513460418 -3.6259000437553874 -1.5220832047763773 -0.30771914485144963 1.5951536884168933 1.8361111247392881 0.9552924554811979 2.8826513602589947 3.3356375663822391 -3.3913196174419471 2.949750224608005 -2.126485357070877;0.19743534587690659 -0.24724078271068189 0.53878585119909583 0.39932334032450001 0.32528886299309445 -0.19609625794384447 -0.72468428723774225 -0.6862795961477669 0.440599484132636 -0.14120045797155528 -0.00474665561981497 0.89670799879029262 -0.31838334406046209 0.46894962358156972;-0.746173708603179 1.1720791842508709 -0.44043831415403706 -0.30345050637616416 0.52422025346906409 -1.2485718158997168 -0.72820818693196376 0.25076455260981395 -0.14983943097328181 0.33875116524196247 -0.57010664151172796 -0.96289090766477448 -0.21894425372961823 -0.03845785710416235;-0.41351004781301526 0.36765228652724624 0.93153801994984009 0.31981636565237842 -0.26192539302246531 -0.13829785875848311 -0.26045109308285874 0.37877105556833307 0.12931655149865762 0.13200677022839288 -0.24193962732538005 0.24295701976328762 -0.83125002086963695 -1.0323616380917562;-0.67456139272990856 -0.30268331857320663 -0.16130824087526976 0.27246791528960734 0.50734482214869703 0.078443072154926352 0.12340000409011945 0.29098162180687381 0.12749847561555941 0.28046146151756934 0.10890808777671954 -0.071265439565510569 0.35055230572514201 0.72918643690628471;0.21051675532370134 -0.2998425469684643 0.74086296193326984 -0.20020398095318695 -1.6135291032638068 -0.12403087210548913 -0.22226749167235846 -0.76972161779854198 -0.58822964868021299 -1.1580430740520877 0.60855171956291032 0.35726012162689802 -1.0384617272309036 0.35588256774128424];

% Layer 3
b3 = -0.29516689654127548;
LW3_2 = [-0.3775528152974586 0.32887856530526927 -0.84818021726486803 0.181907609247663 -0.3198536382984653 0.60791854605403717 -2.7294899946521261 0.45519328905668238 4.3524292509130911 0.16114442027742359 -0.17841905006562719 -1.1106089538859738 -1.8223540132789184 -0.31125039711677166];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
