function [Y,Xf,Af] = NOXAguilas2(X,~,~)
%NOXAGUILAS2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:10.
% 
% [Y] = NOXAguilas2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.448430493273543;5.42005420054201;17.8571428571429;0.00666000666000666;0.02;0.0561797752808989;0.00588581518540318;0.125;4.5045045045045;2.48447204968944];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.9868983611598252;1.7443890423306443;0.86684422992076871;0.67558902658610309;0.95638036330593812;-0.13534974231855887;0.43358339545098817;0.63929748678484999;2.3671325446189475;-2.2634949625393981;2.9011157665543736];
IW1_1 = [1.5614030715508707 1.2846578805724165 0.11420359459056741 1.9594426196227523 -0.24181209284146865 0.43614418795322429 -0.49205173957679865 0.5733414685901409 -0.064224875901241818 0.91218304585647847 -0.37981819745247453 -1.6925362938357775;0.12906596276289448 -0.19510734735828483 -0.17419771360925229 1.6883320503446537 -0.096483637699100386 -0.20345492964648976 -0.088030664197446415 -0.050791421961674223 0.068798970727335526 0.16962686903230101 0.1692486881554926 0.11479822371704773;0.1250609948118048 -1.9803523174988298 1.0083586209630571 -0.43683685480678131 0.76029270645404212 0.72361691293923158 0.045906729228382397 0.14811617132935448 0.0078919437438328896 0.18159227865696539 -0.22366019101871051 -0.39122149851528404;-0.21732065993755487 -0.8602977187868045 0.43296035056192878 -0.33597825494798927 0.35776850868895932 0.017222016516114724 -0.19863664205887274 0.058891740134964919 -0.13529634615256186 -0.14916229085624977 -0.08141268903071805 0.7320352310423025;-0.81185435203472811 0.071849192255869374 0.030490858715308367 1.4614650353195746 0.31413305435643391 0.42070423713119459 -0.39609626073225823 0.16672151993981926 -0.0059458094969882342 0.14638058280281438 -0.66964292335119924 0.21482039148740886;0.00076688374499685186 1.7267283256311545 -0.25478761157825491 1.3679562827988865 0.22515907655605535 1.1300559400720824 -0.41064427950638133 -0.028430256636728976 0.13275468229909429 0.53525973315356745 -0.064859211907924666 -0.27597940910056973;-0.084447649051634627 1.343862143143882 -0.41680592615570633 1.4090976869397256 -0.16785952063330778 0.52121292195318758 0.15935685534001598 -0.036728056519327999 0.15058915696315392 0.17721924706539371 -0.057510214343491149 -1.0089127105227309;0.13950109058210605 1.219026226628583 -1.2353469271483994 -1.5987840937370421 -0.66378849896158743 0.23063238109564971 0.62030766296662809 0.10019705009140192 0.20526908959817941 -0.3658866546167886 1.5988461336800459 -0.80161901420250292;-0.30260692580118376 7.802225419979683 -0.5421186248832297 0.021405233106480064 0.1078354998166782 -0.19526506271763089 0.21406238394053076 -0.2329613239637745 -0.25075809459741205 0.016818973641379659 -0.10017552899457706 0.0062817654381237525;-0.14805268678261946 -0.76014950421305383 1.0593947692691974 0.3518108305349808 0.10555414869352395 -0.139677085722545 -0.15499649184726005 -0.054413352101809261 -0.29337181071105606 -0.60023882843148491 -1.3233267006433895 0.87367928792157934;0.27201391608174497 0.65683798301168295 1.0502836423682502 -0.93472145171263976 1.4513095022947651 0.13512352848442721 -1.0075067382005436 0.58053542132861957 -0.14259229896848311 -0.21822318187161477 -0.21809752692956383 0.0057646336857676353];

% Layer 2
b2 = [0.3180006398784318;-2.2609265411397108;0.44572879140475963;0.16807903643461433;0.073331270100430071;0.3029281558302051;-0.95312829654001774;0.024941257360679467;0.47879196854911982;-0.59089560686230347;2.0855077672058511];
LW2_1 = [0.74423303702050991 1.8462017830358357 1.4850395549299924 -0.26273995321510951 0.82035762264707957 0.73626356748375754 -1.4498169890438957 -1.0802205170309329 -2.2941616332146721 0.26995900024279801 -2.152270124981452;-0.01898452157454051 0.80461175510283434 -1.217294710824335 -0.33307593343992459 -0.68209660731882948 -1.2831807659373029 0.16505985271814716 -1.0875510782461415 -1.2252229675717734 0.79416221263151743 0.91357265089063489;-0.0083304202579608383 -0.61859161161883458 -0.12183603208762422 -0.56317692611285697 0.67719061359354771 0.83624139760343152 0.98036585074314719 0.054094295392407732 0.01873312746588341 -1.1364109798022906 0.93881251438369284;-1.0974302861129916 0.86253762012223023 0.96894030565743505 0.029312591791984172 0.61820733234786973 0.21569634151286754 0.37913145249874219 0.86708969304558714 0.84756956725461385 0.27471196532274711 -0.60643337954592003;0.90470183379485092 1.2203747310084561 0.86050583859499474 -1.2931768689706364 0.67807733070395215 -0.65543392279649704 0.39804929151281532 1.2530943372122363 -0.15478398674170768 -0.31839523317300905 0.54181412807076135;-1.6587659801264394 1.3973425063860354 1.4962071383198594 -1.2347522611760215 0.92179302299232668 -0.055554493390002749 0.54703714579163099 -0.099880340558935812 -0.35406776964069475 -0.3284984340122602 -0.052031497038742651;-0.62552456893165664 -0.22944309963577986 -0.91924285377053827 0.11912190915785952 0.70678163494602642 0.17175704582515094 1.3728647102650717 -0.26544153614080701 -0.0023409626250053741 0.26402237566169839 0.023479715856201577;0.10611796425016293 -0.066794079665125447 -0.65708850569807342 0.85237979977393707 0.050440419920416937 -0.15084691690152188 1.3760522309839371 0.071718571790477803 -0.57267375920237329 0.85193488258178274 0.032944900084427964;0.51433105923019062 -1.0384628352151111 0.010055214384478581 0.26210524982690125 0.4490303363458612 -0.53660913854956316 -0.24375009627610167 0.47333652812525551 1.0196149694747954 -0.89510672174709005 0.44257078104367065;0.33443779237450427 -0.85658943232702489 1.6734173643260271 0.16679303078675534 -0.67344953281359332 -0.55137865391120156 1.2638519872616265 0.79266831229143564 2.4627930203239101 -1.1902852701340221 -0.19875385904736345;1.3846644400019854 0.028431659345615926 -0.24761606170325973 -0.50962800823885557 1.9666040308736341 -1.4513991589845687 -1.3632238563678536 1.5208247284159104 0.82827102108226525 1.0502317929347929 0.30695442519153993];

% Layer 3
b3 = -0.34448881831842765;
LW3_2 = [-0.42386441859510043 1.0768741214207567 -0.53489937399544762 1.6595658308661076 1.5389514701829095 -0.97938455981824779 -0.40621491420516015 1.0003960206172908 1.0041913554002573 -0.40508325803085338 -1.6421845152534218];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 5.42005420054201;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
