function [Y,Xf,Af] = O3santafe2(X,~,~)
%O3SANTAFE2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:49.
% 
% [Y] = O3santafe2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.172786177105832;4.16666666666667;10.752688172043];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.9980862251640026;-2.0530323398677712;2.2956454216877051;-0.88118763698281666;-1.1996934139740416;-0.52996796141763447;-0.39049514135950375;1.0524336893835446;0.98772828997483786;0.39077753451109465;1.9013538002718389;2.124013130968375;1.8554211603876853;2.8239555933521046];
  IW1_1 = [1.4186949810736689 -1.9204991724294467 -0.2350291778156568 0.51661352593987631 -0.004197627510178225;2.2615221014929707 -0.30419590427183274 0.66573893677989404 -0.085451822814320261 -1.9255423303145642;-1.7896146828911741 -1.465687378310488 0.52879521471692659 1.3804969807287457 1.1051690952653106;1.3325912837995142 1.0136865900274672 1.0018574573891068 -0.30028774011375214 2.600640504830682;1.9767610821493677 0.67679241107595645 0.35636372060394117 -1.9103537173835332 1.8987217215341672;-2.5811788022543549 0.14827679924581313 -0.85406781021261202 0.10558932530292911 -0.70773196195881394;-2.7881141608775 0.43530980083650644 -0.58625012389785502 -0.37573392891733359 1.1667207855272119;0.39983427174291558 -1.3633458256069786 -0.38154918506091534 -0.30695549158262114 -2.0294862997172016;0.29646455173743275 0.3969788178616499 0.17940689758776907 -0.073954434094575375 1.6203638300159064;0.010680964669753455 0.1823344224492352 -0.93466509112233365 -1.4050138771189207 2.3865724921850613;1.5349806201772809 0.98758258663481113 -0.026166939338498906 -0.65025548400503363 1.4190759049865362;0.8208063070514422 -1.2630118304024718 -1.2270107300299391 -0.13426867813810101 -0.67514916417679449;0.26634589268896253 -0.34853766849256185 0.81740680493569706 0.9901784568578359 1.5629109779558494;0.51073586736328391 0.87579211016513214 2.0081433462638514 1.9620413083669797 -2.7969136720882601];
  
  % Layer 2
  b2 = [-1.9703587941602954;-0.46693114595956409;1.011648904114107;-0.62051742522143216;-1.1561738624206821;-0.39764695407564116;-0.063400916838492263;0.37407054485390162;-0.9607128471854528;1.1557861273038772;-0.038381592325070463;0.72703653593252604;2.1148902878271216;-1.92952636555465];
  LW2_1 = [0.19767404385816201 -0.61959471385203901 0.66448128330980838 -1.6796779540776063 -0.32821957938506274 0.11495026444170321 0.40367863872957555 0.1345533746745356 0.78737429628556566 0.53266853460956853 0.1981264458857461 0.18160441037175021 -0.11755829457468639 -0.26201064554764075;0.048222529139491592 0.76755895770876792 -0.24275742154855867 0.2546369242825644 0.32467071723658247 0.33420464640078024 -1.1956185126213732 0.31506779894619269 -0.57505607503003098 -0.23496942468349327 -0.62148580560540345 1.0791579394406468 -0.78528156998369902 -1.8787974653715591;0.32157991164426486 0.50003151507946997 0.08372464635109457 -0.19734154933617964 0.83781066329880838 -0.53815269021510459 -1.1679063519288804 -0.51508988365689901 0.26388938505778176 0.36735226335988319 0.51300423717188015 0.35118263785771675 -0.44359146877610323 0.73348455954812208;0.1035943734553066 -2.0203409630069751 -0.21516758904130157 0.72143012870454881 -1.1192618051721772 -0.97031556681218623 0.77345660175066788 0.31918799029728367 -0.43886178498867745 -0.55018600532206519 -0.15197837664052766 -0.0014495157155667987 0.47689716693854628 -0.95622674925925055;-0.094254986912638811 0.15722634049963941 -1.9590366217901427 1.685733836734419 0.80536471827803402 -1.3396846221759044 1.8626313835454313 0.28740581394918635 1.1200435637276842 -0.05393762698850571 -0.20931500105204989 -0.41796999231318144 0.71745247735800333 0.14846218373729883;0.19142497309123399 -0.43776760851241381 -0.29015658919068366 -0.52813888943167375 0.53969812695366637 -0.14291906454938499 0.22224406835439992 -0.4964071878989873 -0.52208063712561459 -0.18326986782879093 0.95085474047586604 -0.43053584909501935 -0.47398067715518383 -0.15755887078246711;0.022756087528594843 0.34648548955075531 0.29959089531760236 0.83075106437085977 -0.54060152312125698 -0.71405891947158973 -1.5702000795578823 -0.5713650300476506 0.33580277456765878 0.56822371600527743 -1.1235220829006662 0.5596192457036917 -1.0956650849929548 -0.79089231768910084;0.069897863219560291 1.8226819593582746 0.29062030215234752 0.041390337653527287 0.49868682851264418 1.5553444871217714 -0.079521992468733912 0.26590846315007899 -0.46450056422857078 -0.3723576602301652 -0.35079319771527495 0.40226149718926507 -0.75633136784809718 -1.8404354197716941;-0.36367053609965988 0.23868342220219491 -0.71312612529772124 -0.39370169765783214 0.44077278619123245 -0.70945806418085211 -0.090900972516386416 -0.07174753855587343 -1.6776203969025236 -0.7754086596405082 0.059633124921702474 0.4407775601683529 0.22248691454693845 0.21623971733401626;1.0933760203448823 -0.28601311849961936 -0.59061470855039955 -2.2463976342179466 -0.02909007592899792 -0.014634463644209363 -3.1399861221904231 0.69359931682082709 -0.99394532223464693 -0.97961505178474262 0.48367511510969463 0.65733888840568611 -0.52427809446449514 -0.028242082242577512;0.047143773499511113 0.54100834641671869 -0.19430310071345663 -0.06617491328634989 0.50812125459667112 0.38116988675343388 0.29840721819214999 0.057240423542387397 -0.81287060890293328 -0.012526709480021461 0.20654330811165991 0.80119612890741432 -0.38715847320993152 -1.5411787293864498;-0.27100960713461658 -0.3159628942724324 0.57597666503457701 -0.030859695014669085 -0.7754041124925326 -0.5207426717747845 -0.50043655632999595 -0.37808273278086024 0.87498546904199137 0.87605833658271959 0.18742412860909918 0.042271457546081179 0.10252172380754057 -0.2068951667813724;0.11491279497256698 1.0853601054003914 0.36072296853679442 0.24384686772636327 -0.49576577719476583 -0.37233582427638079 0.30330362348398354 0.12519417426650603 -0.12770156474910271 0.45067179522294754 -1.285104035331132 0.19834659867167867 0.40812614644231232 -0.70091426932364576;-0.049127859807447161 -0.09952458447147304 0.78661238712693138 -0.54427147939591114 -0.69219035852409305 0.041966578264026472 -0.15709682612187759 -0.28975783581508052 0.82878318248392169 -0.12404344609324355 0.17976702240578113 0.26037752019394034 -0.23142175872428022 -1.2415924059243675];
  
  % Layer 3
  b3 = -0.25455479727771635;
  LW3_2 = [1.8925866141173913 0.74352670758005368 1.0965991509896846 1.3125300758741585 1.0845617306054256 1.7731824241909246 -0.9322401223149307 0.66237441327668933 1.5398871135907364 -0.88863973346992586 -1.3595518843728369 1.1731440814735679 0.84787905146415277 -0.76459049929841461];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.752688172043;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
