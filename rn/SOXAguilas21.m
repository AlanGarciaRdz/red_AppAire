function [Y,Xf,Af] = SOXAguilas21(X,~,~)
%SOXAGUILAS21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:21.
% 
% [Y] = SOXAguilas21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 13xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.448430493273543;14.4927536231884;11.7647058823529;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125;95.2380952380952;90.9090909090909];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.9176650216190529;-1.9645404391782824;0.51398094204150335;-0.57808178777879915;-0.39164610903308034;1.7902432861220408;-1.2725292227358451;-0.34352103399557338;-2.1517105444324351;-2.1386397890422693;-1.952114743473123;1.7233187359742428;2.0393746728007796];
IW1_1 = [0.0036095576829153608 0.0043306228582354776 -0.55444289796432966 -0.40186903627337744 -1.0029364654376365 -0.62342128972617361 -0.77762668763753806 -0.46366643272118169 -0.20122858971939095 -0.21100859071949532 -0.40883190545893405 0.51548177106576254 -0.54129337856004256;0.16771537150814819 0.12413215636142375 -0.43717943759251904 0.015556172838073382 -0.15333397825854481 0.54802436155022605 -0.082011617149341923 1.4848631294860952 0.622659515729869 -0.53927668006038254 -0.7296085234473435 -0.046586131694048551 -1.2917000631375393;-4.5366095045013983 0.25597690226308062 2.4164587474582717 -1.6580796846924772 0.3487628179163893 -1.4882069974570056 0.94627860821407705 0.0081726145030144859 1.3606482200552925 -0.43326016293095088 0.034172934831965998 0.50310712363398213 -0.51723587078792055;0.88411129259734578 0.7795200291139861 -0.28952458615165955 -0.28093691885708172 -0.16141688984478317 -0.95556355985726338 0.93404714293331215 1.357916522395183 -0.23613067735848708 -0.24345616469887499 -0.52616886683718067 0.71632805557463408 0.01974030331225636;-0.78761856159039745 -0.13538751909310881 -2.0166948083843677 2.5819357859010696 -0.47448341660674381 -1.8869582025789062 0.762258392947188 -0.098416669889282507 1.9479500923586353 0.068593457790818629 0.032795859338954694 1.4678192212991665 0.37027626852443934;-0.23270210744969508 -0.1803814435405135 -0.9591509090033643 0.71018611605305726 0.053848306650417656 -0.16412792727029596 0.34101828944926466 2.2686275066172357 0.48895354649103795 -0.067908848653149251 0.32562526384380885 0.29573594091453659 -0.092470749704474525;-0.07131414075203571 -0.24320690127014524 -1.3583001025510089 0.96527794425735758 0.022373186546530428 -0.1618638121621665 0.49235370067781414 -0.99178202353554168 0.52816341846122339 -0.061309009630614877 0.39922423159741383 0.35283128766644417 -0.089674210006369645;0.57699748566128262 -0.99028559239250047 -0.44166612348890261 0.89988411427828441 -0.27664961836814356 -1.0419549618987534 0.26054333636273275 1.7669528061476321 1.6560177435318806 0.53326984110513564 0.54243217396225996 -1.3772327923910455 0.24753974809880175;-3.701044338806311 0.21358104671782993 1.0295588672071239 -2.1683269887158758 -0.16127122661261808 1.3305892385158185 1.8763421649311225 -1.3054110512329622 1.6272412850603872 -0.51639230502966971 0.86950765207811542 -5.4654668464939702 1.3328783898438348;-1.041169256623802 2.8701442588828594 0.30120807917834963 -0.033843958116613171 0.16434288120906823 -1.8835705761234884 3.8395130916112734 0.25860532312373463 -0.18981292046274059 0.16311346708017854 -0.70452372973417454 -0.78995515011856987 0.84173314983391789;1.6437920953804817 -1.3915863778555806 -0.98270309272659317 -0.3256444146845196 0.093403988197189772 0.43549233987528796 1.161987881361167 -0.28306673587979719 -0.1131907138979816 -0.17357672645400296 -1.7821656186858787 0.54528000970400703 0.61299861311023884;0.54497269345021937 0.30867363344579724 0.36449791011745225 -0.4482612811060544 -0.15345699650829342 0.33758510396215513 0.0090392071187710282 0.49828192544882899 -0.75161426353624905 -0.0020233803630911873 -0.3708049544285974 -0.079494206912663526 0.12088086440185988;0.50046729739216023 0.031167450608357843 -1.5172149188085542 1.6206017525095526 -0.5725093535067477 2.6151831370493488 -0.47354682919581048 -1.0503691660876817 -1.2232645937239475 -0.097742758603454466 -0.16848227451718362 -0.38741931609025676 -0.54645633249498848];

% Layer 2
b2 = [-1.7467675039266815;-1.6567955181369332;-0.60057941138717541;-2.0987531849432388;0.72978282862889066;0.52073998284209377;-1.3429488026742753;0.12457085593707391;-0.20015585541024775;2.3288560217001724;0.032899789636589225;-1.2931705935069902;-1.8578403822386489];
LW2_1 = [0.016009631379210586 0.50558276524310997 0.32075039115447623 -0.27497099115293544 0.02914834667830855 -4.1046877257761807 2.6409401307531786 -0.3321876423426382 -0.18508098557718405 0.063863413273023764 -0.036638146144381024 -1.5843397175790661 0.20438123373928033;-0.13177766745902419 0.22510086044276581 -0.62778558950937169 0.99628508698319451 1.0426945562763104 1.1656771919535023 -0.20758336220942711 0.14601324574227428 0.32797176609037554 -0.6495172437413006 0.1838977785274454 -0.48306890837801364 -1.2316951422243732;1.4371024636575986 0.0677637394534715 -0.099283288555159541 -0.22680498604165769 -0.26066045291355422 -0.75464902779895959 0.68109300849659715 -0.80629416760988537 0.75983722531669717 -0.24120976291137317 0.38861822169842974 0.28838599940624454 0.0029023440987594957;-0.70022219457157253 -0.42071821418987165 0.69350782657830723 0.073603683444917994 1.1528695361230661 1.093028452740485 0.069071013445157634 -0.1330202833745982 -2.123086251436729 1.2723430212107925 -0.30184154035020411 -0.9932481103897749 -1.2294864699729819;-0.31345710087386081 -1.0476255226467182 0.60347801637241194 0.058690117086620724 0.059108207268190591 -0.64808208237687315 0.33972630363252654 -0.37416639241692651 0.75701337488417808 0.63550766988906682 -0.021600922627361491 0.084321019747160234 -0.23372759136219295;1.593046995356332 -1.7630049915308525 1.4349315704954555 -1.3124124621056221 -0.28104434080275975 1.6326823374839003 1.784122797373956 -2.145666828249249 0.082998528220338569 -0.58719877294913225 1.2270220082343068 1.0053606442235552 0.66471556915669727;-1.2917861651982423 2.4847334462666915 2.0555892952566732 -1.2981100315300096 1.5511661071609362 0.96798648097135009 0.53169760309352965 0.79234620526593891 -4.5846841050225509 4.1016336525018549 -0.13486315995541365 -2.1201632676356255 0.15345620713520614;0.26908643336369253 0.61174134485408038 0.035620678536625427 0.37340799433115285 -0.33822010793669605 0.30569765497440249 -0.10907703261274544 0.80081882536269033 -0.4915394144131161 -0.22788163635895622 -0.13951694821692967 -0.77404699789048625 0.60699063567396194;-0.30589723809104397 -0.43930518377012406 0.066433747784804764 -0.069825416940206469 0.19830917191119474 -0.74672172178524387 0.14272586215546412 -0.58838687687678148 0.6401275765933151 0.25246230806311115 0.079300989129197669 0.69439730762794083 -0.20524047384562971;1.5659879773180463 -1.1359584533401543 3.6396357834864217 0.86737692122601451 -2.4225796241376436 0.39511272017431132 -0.60865515756170829 1.3529834798518336 -2.0692286224819614 0.70452617246703564 1.1061982614648442 1.1335561707677519 0.706240662556192;0.94891248153701324 -0.80370513659872145 0.86391171917988607 -0.11407921406808628 -0.43530857077291951 -0.028850467560666379 -0.049858563281601105 -0.49856896233511344 -1.5860566645848657 0.76458403528853192 -1.1307929737304272 1.6992625225288005 2.5834629364756196;-0.60647337147390845 -0.56651042234826876 -0.28992986727025605 -0.42171750554046328 0.23678364605797753 0.59953585092441375 0.42802301045595686 0.1804216385240674 0.55869886168828164 -0.25495844485861052 0.15579308926151736 -0.058193031533427302 -0.9278698488234266;-0.74340760032538622 1.0851021057854473 -0.79677390827402084 0.8106212907988235 -0.50586052484364186 0.33367830977797164 -0.60305474772197776 0.26514250258544081 -0.31317725123792006 -0.66731252036258304 -0.29858054153333535 -0.013099272208865214 -0.17571630420751333];

% Layer 3
b3 = -0.31368924118527947;
LW3_2 = [-1.6650802420853958 -0.63825534580166288 0.15593997883236924 -2.213917886810699 0.22864202036320264 -0.49314028039328839 1.9827045516774255 -0.41703837661922166 -0.62888119012964561 -0.67956766333719565 -1.5046602522228125 -0.54956530264738335 1.1322763591776008];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
