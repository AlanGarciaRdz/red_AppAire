function [Y,Xf,Af] = O3oblatos20(X,~,~)
%O3OBLATOS20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:46.
% 
% [Y] = O3oblatos20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.100381449508131;117.647058823529;0.0560224089635854;13.1578947368421];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.0459147156105051;-0.48149924355385521;0.010447318146821399;1.9291642872844195;-3.2269063504571078;1.0672753251397196;-0.21777924155859746;-1.3081203640410333;-1.07539481130919;-3.3269599182609242];
  IW1_1 = [1.2929263747749891 -0.46666615921316973 -0.34686001875737943 0.19305388835547491 -0.16215208938988768 -0.31915502328787343;2.4833912939725544 0.13898482432508341 0.59992017543756027 0.35703918136271412 0.18090091808707015 -0.055188890948203048;1.7831235832221113 1.4790098736363928 -0.43737857420555409 -0.35940755924760992 -0.17356822429151075 0.4271354115124707;-2.9101502405515007 0.73018279485086912 -0.47628787454982779 0.68219053006416364 1.3824767368977857 -0.62549035123595587;-0.0019000075404119986 5.0498355740902445 0.096818698838631978 -0.10424370581110623 -0.2855325363751266 -0.7613047434547342;0.42998391109909839 -1.7241444083718926 -0.51699314632706395 0.88232766556703179 0.84216629999880432 0.85253169745693846;-1.0170875408590567 -1.3402294178874108 -0.040636232006570627 0.534975035939809 0.30474216424945255 -0.43854484098081842;-0.94773734627256179 -0.96839063496845823 0.2027094409147637 0.57336073943557508 1.3315903572771552 -0.25996021230065008;-1.7155674855971301 -0.12568557636927605 0.011716378079457638 0.97801052850377035 2.1987575427413342 0.54843245766705306;-0.16873382433733036 -1.0122521577141572 -1.8697349038570754 0.61040376163591492 0.9323004690598321 -1.4708932264151426];
  
  % Layer 2
  b2 = [2.5575255585190302;1.1604433248572938;1.8943216987475873;1.9905200917429537;-0.27718925213493656;-1.6764683960457782;-2.6711597479840989;-0.3289628829695696;1.9543972766964319;-2.2350607591971432];
  LW2_1 = [0.56610073821529583 0.74752892286970674 1.0496499650234474 -1.3609528010407435 1.5463782930635859 2.1760012746961932 -1.1745662300057842 0.4052730033806779 1.2141027437779881 -0.80713269844410196;0.26824742883391001 -0.96955037157744861 -0.9684407449178507 -0.0014265586663497506 0.55705543877830888 -0.4297316967094294 -1.7686684493481015 -0.47089059124545318 0.13687106160351226 0.36146884240836674;-3.8313867097008565 1.6720492369959528 -1.2447133163805628 -1.6877607870076177 1.924971644542161 -0.38132047694345794 1.6638507065200756 0.36641800604010649 -2.6176476434354083 -0.1692682064296091;-3.2010913023325451 1.5809823733842538 -1.6884667769808588 -1.2892598792811496 1.1831726301652101 -0.61032531943275825 0.76949617307087648 -0.25970033914738139 -1.1940717234614284 -0.023428263215465282;0.1152781845769448 0.29507423115315662 1.9952913515775355 0.45657242440576629 0.10190539883855619 1.0076746799054357 2.5219328208850373 2.0271013957906634 -1.0872554258930054 -1.3352725561099574;0.0027470317926904068 0.91695853483517842 1.8236310456293985 0.019226954634088411 0.29909529014906755 1.5610174780864468 2.4769373404611112 1.0068538733966039 -0.4083494784790398 -0.88046601189833662;1.4099119223152385 -0.23646065734251071 1.3989283552750162 -0.10360873169344116 1.3214306515083367 1.8297480151445975 0.53894677145318903 -2.073003895452183 1.8603429726258227 -0.38782159665547411;-0.82142548735256149 0.74365466011688486 0.81037582252729967 -0.14640594519668299 -0.41902739669238998 -0.85779918619244844 -0.40924509045464891 0.5124181979100555 1.3377648914454825 -0.47424990608831408;-0.81816679641102796 0.56504364426628384 -1.8876217974373901 -0.73558183867573845 0.52859132881920612 -0.50439671903568117 -1.2890062554100099 -0.74406394686889632 0.41151141996488899 0.57127624184397019;-0.26286666352389504 0.74661671879756786 1.7293324870853202 0.39822586402827193 -2.6781563266764441 -0.57728558221206439 1.4491767364057691 0.67463801359369113 0.47169414020381639 -0.51673933732896371];
  
  % Layer 3
  b3 = -2.144553245355667;
  LW3_2 = [-0.18632288223906865 2.7133399569008674 1.9984193860227164 -2.7137906708740731 1.0133543673068119 2.2189266733103725 -1.6151393480232559 0.50259937944885746 1.8836104980015305 0.83948279358001376];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 13.1578947368421;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
