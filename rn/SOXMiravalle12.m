function [Y,Xf,Af] = SOXMiravalle12(X,~,~)
%SOXMIRAVALLE12 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:36.
% 
% [Y] = SOXMiravalle12(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.0208986415882968;90.9090909090909;0.056980056980057;0.0063552589768033;166.666666666667;45.4545454545455;117.647058823529;29.8507462686567];
x1_step1_ymin = -1;

% Layer 1
b1 = [-4.4772067679485383;-1.4231508374337631;-1.042825062850754;2.1830235672862828;0.87614949468675551;-0.95792862739370033;0.7322346689133814;-0.80165967432621277;-2.2695200446704917;3.6668253385241623;-0.54958113045221946;-2.9746596952190822;-1.3371503189319338;2.3453870273319426;2.1969005437172275];
IW1_1 = [1.5007249047079441 -0.65185378548038164 1.7927507033472012 -0.13898586484156028 -3.6440111397868273 -1.4945968630037036 -1.4679766495904039 -1.2693566855949552 0.12663363802727817 1.252121672234916;0.80928000322956872 -0.43227942427171812 0.016702928376817187 0.8261880093904197 0.22163353163857136 0.44143243015280437 -0.20189684246123585 0.047330996917041263 0.64097692071366641 0.210802340958061;1.7807084559668158 2.4847734575085321 1.5865621750326582 1.9066817875347977 -2.4211405180578986 -0.29237349835913462 -1.0574788726180502 1.0169287916484069 -1.8524122057738224 1.3712305133419544;-8.9053668124216188 -0.14395692568989324 1.5592746622471541 0.091519346345202243 1.3481155134678597 -0.41573067775106937 -1.3847074024921324 1.1352139916960595 -0.69344646777647867 -0.048376797472244576;-1.6129712968757248 0.13962677084031694 -0.47771033135064001 1.2768139135147438 -0.94421933725907059 -0.044128944735530994 -0.16654835887434941 -0.84572339798446905 1.6739397047771849 0.23061590887839445;-0.65416120667479349 0.12260106083215326 -0.95013436775989668 1.653355694132469 -1.3023995991534725 -0.1854691934308326 0.14596990066856552 -1.0942637919025202 -0.44578068089872597 -0.19037239794843752;4.8834896226071214 -0.15363646468086772 0.36140883883430619 1.6120377796378129 1.1030435574020516 -0.039773997081135465 -0.027970903613862796 -0.43644479871464797 -0.10609215041083778 -0.29245749868262971;2.1586442161205905 0.37592699988196926 1.069091869189821 -0.52333537658499885 -1.2371495592904276 0.5055428280069908 0.37644600259150701 0.28883967209618627 -0.43139445636862056 0.17885603069253725;7.1075165515944105 0.14103295403017901 -1.1855376326607556 0.75543096170607471 -1.2602357511164377 -0.032613945391158042 -0.66914814434999059 1.3573905832465403 0.1741497914015866 -0.22814081299346922;-0.64893360009563472 0.27889910873102675 -0.11624999572079904 3.545646581018334 -0.4977034565685689 0.43661232711493031 -2.624773744854763 4.0375128705526206 0.11929741681135644 -2.1973909140914025;-0.54173025665994701 -0.15156318214836123 -0.53334966849110144 -3.2615142607241938 -0.51468302710105684 -0.33962785008180901 -0.61671101661533545 1.2771246207437166 -0.13727277428353324 1.1526228165887225;-1.2162997923452519 -0.25224438184550768 -2.2116766739247224 0.77758300227791011 -0.96557824874654807 0.32387733452438416 -0.48340917815552187 -1.6867753812203714 0.24094923540046223 0.50270247535337609;-0.89874946305597803 -0.14701594830144504 1.0999831464764347 -0.96846479894307469 1.4087030518915751 0.18365651168700009 0.16807828448641757 0.46639926369051971 0.29441054715474274 -0.25857728175063083;0.17680368099652047 0.21838757452169655 -0.69384634782179633 0.75249685484793816 0.19114146836897497 0.2878823874064661 0.020100676663751919 -0.067753661171152918 -1.0962849466086857 -1.0747772165073066;0.16224844251306458 -0.91574292038148286 0.18070845051923326 -0.61570043435725585 -1.1915523591990442 -0.02190287621999688 0.39010306400667266 -0.3579921120886424 -0.041575893216175663 -0.52803149778677738];

% Layer 2
b2 = [-2.3730394287211176;1.975293210348541;-1.5477547738103332;1.1786164643993344;0.0012853477280008185;2.7961672258632011;-1.4929976065988384;1.9546611582949824;1.0309179596547697;-0.51772325357725535;-0.96574317169184887;1.6448868968038188;0.41385943142806397;1.8628987117452469;-1.7172310672917712];
LW2_1 = [2.1570599338599101 1.2170195064518736 0.024145725975823443 0.050841578450909947 1.4267129066205126 4.2087989764077438 -0.17940392248481207 -0.23718297033999503 -1.6631793471492429 0.24066722547578456 2.6993167210010598 -2.6914302255031619 2.5186689856455948 -0.88296287214943603 -0.94873913475296234;-0.51524241276811955 0.047118958004324717 -0.44354100346013381 0.93856609565938209 -0.96635799143655465 -0.068630204056472799 -0.17047664789094669 -0.22172336701203771 0.5109408475679682 0.50138435044759988 -0.54276349924074818 -0.99884355037335537 -0.47451448343397917 -0.097836032860573102 0.14955011260648521;0.93679556532206043 1.314022287480815 -0.040450223971711254 0.87106671586625262 -0.36740289648754387 0.65532941496755415 0.046154296494000366 0.28604646275800494 0.11503969527643368 0.70705768457550189 -1.3675817501510059 -0.097713872519937045 -0.41784869781248535 -0.61665487370062855 0.17947373859128052;-0.67403929086148529 -1.466489194120099 1.3212286147132517 -0.58772216286256629 -0.38972307820932167 -1.2564673472534804 0.24596294360513812 -2.6223620696485739 -2.2174727999808499 -0.3270206724118242 0.49510834232873868 -0.072046903752220837 0.41300364092824499 -0.48099539650965817 0.45792139630510575;0.7891193954795972 1.2096765456093395 0.024825699402770358 0.57985330666247104 -0.13667840607608908 0.077658912741537967 -1.7840654147088297 -0.64881900747770871 -0.17415937390010858 -0.23714875257704043 -0.21501932691385542 -0.22477460451826634 0.24617978510893737 -0.86271440738609684 -0.015943609251900977;-2.0816929455906714 -2.8106235742793286 -1.2365737564549659 6.256336141622481 2.4461100735994186 -1.9390324954207119 1.6054749267800377 2.6408330682994072 7.1429536892503771 -4.8173902037547984 -0.068155269902565416 1.2739519338486665 -2.7416091883022182 2.6324460421843168 1.7047074670516631;-0.060630737553853169 1.8999346294469643 0.06193446398429326 0.41537294450109108 -2.3289874506680763 -2.6542010916833765 -1.1531225881009779 -0.058579488322286537 0.91459125532279306 -0.30305858179721534 0.5447078637247148 -0.086084230985928531 -0.97705723900876451 -1.9749707646732373 -1.3860485878905189;-0.64673507371846062 -1.4151193178020576 1.1911370292245493 3.8332906946565846 -0.34198691350605065 -1.1758994397590721 0.34345949453770236 -2.391062259807367 -2.1550758108435288 -0.29910129355746934 0.49273111613675641 -0.031622993567986049 0.41297636706165725 2.1690037191137028 1.293944093278006;-0.11507447911552635 -0.95797460443724991 -0.0064330600788712645 0.74504426785447486 0.74664234959467624 0.097183413075651356 0.48044643460810249 -0.35276739344688646 1.051482779447801 -0.75580311915415843 0.4303834316316964 0.43424940444862109 1.6383010529913951 1.0076395025901428 1.5626995909098573;-0.7526365443494718 -0.74119809249546242 0.15374202088549968 -1.4945513172039804 -0.28738473503722251 0.12990225085479645 0.30063866558759167 0.066162466323024888 -2.503079925015415 -0.37927541022869371 0.78139814725052126 0.2737781105255791 -0.36223099335272774 -0.57092286899776079 0.55064502226993572;-0.92438067179183392 -0.98747274059609869 -0.081016424189459493 -0.68666588137219442 -0.00092364774105260783 -0.029879950315335867 1.499993339915507 0.41533716314812574 -2.2493547394063769 0.1536933677272298 0.079935820993720291 0.26646936695806239 0.012440157075724668 0.10717014649007844 -0.26166693722717954;0.47393096937626888 -0.36469747512411438 -0.071834256593505313 0.87983105713220966 0.75211142031921052 0.21294830648561452 0.22932706581985501 -0.10411454431801542 0.93410693331631311 -0.80824411814347996 0.76842528165732682 -0.43535253457263057 0.55756520997715109 1.0971094286861547 1.4379179845618753;0.84671458718399117 0.81318061441690215 0.046655592608000881 -2.081180561118765 0.047821214116795456 0.087680709345004576 -1.5974319596810631 -0.42208689772451341 2.2336861098905452 -0.19696082180692809 -0.062640481415483104 -0.46929735424864294 0.055270434111404233 -0.69894536278716313 -1.5192578036350106;0.78885001118391374 0.12732842481385812 0.16881176454775512 -1.6337396929602721 1.6074436603610449 -0.99226597537553196 1.3784385155014471 0.8433739009363439 -0.38880943803793871 0.21864726315677571 0.97153277880774003 0.39761342303305497 -1.2596184136650703 0.48102449985376822 0.72375827600701048;-0.25821780136209721 -0.97944495567139911 -0.27912083678412786 0.40173340198093177 -0.15534224019416298 -0.16424675977070075 -1.4695879255166564 -0.56123056010415784 1.9886279007505085 -0.02013358721963808 -0.31491359399986391 0.21307084685729391 0.38508818979849818 -0.64889093888589344 -0.124235334887144];

% Layer 3
b3 = 0.86225597493577966;
LW3_2 = [0.62464919128555951 0.45739974527686011 -0.32919299312423572 -1.8169622340591436 1.1341074580344706 -4.0221299118644636 -0.96873902664004374 1.991438369447547 -0.9891878402507559 -0.10075683765854444 1.7390019497238274 2.2659888289483363 1.8812927875913861 0.059377102448374124 -0.97302646292610706];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
