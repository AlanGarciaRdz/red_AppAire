function [Y,Xf,Af] = NOXLasPintas21(X,~,~)
%NOXLASPINTAS21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:49.
% 
% [Y] = NOXLasPintas21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;3.96825396825397;18.6915887850467;0.0175284837861525;0.0546448087431694;0.00640204865556978;0.138888888888889];
x1_step1_ymin = -1;

% Layer 1
b1 = [4.1202838858623343;-1.8248197274170623;-0.44797184218237812;-1.2237552236956264;-1.1063300658259747;-0.15171961841189319;-0.60121366991327441;0.3868760154469445;0.24247351991310023;1.3792549997102046;-1.4776196061625215;-0.77467940106789768;-2.464984117476086;-1.8127325604710132];
IW1_1 = [-1.5036430498003548 0.15925096985561241 0.14537500166185824 0.66613485137737616 1.4316743136327172 1.6570009066215896 0.39934978148867611 0.98628933148869391;-0.33701090676694301 -0.3671548902396457 0.57053811245690389 -0.13031040939548896 0.79628314030804892 1.0759680060798051 -0.86896561629437774 0.51821599964912302;2.1521701901974875 0.83190978157292073 -0.49596790161852117 1.2891427469672117 -0.69479417228157869 1.7853522401935646 0.88521788633173448 0.19046476814690116;0.96341892171233745 -0.68759324803065958 -0.86184454492392248 0.53726639397390097 0.19701380204047769 0.95619239091970032 0.50928518129972244 0.42077194909793009;-0.98939939435022795 -1.7957593304928334 -0.19457879998195968 -1.3569737231460164 0.20577543426387868 -1.6082570965008087 0.53292809914990646 -0.53067996444916077;-4.6755372227301271 -0.31870044065357594 1.7657999219090086 1.3473899039529893 -1.5250837840079998 -0.21683270579330061 0.31491472137216903 -0.39513744995014471;1.8058916944293102 0.042033975903658961 -0.1905280902280404 0.79457551857078301 -1.401808238067709 0.63271139917361663 0.69677735325362011 -0.49576207019442242;-0.45432826245291053 4.3635479529391024 0.26771264562091868 -0.007840430719659397 0.0044537626053588308 -0.90598558114777827 -0.012029243140846248 0.20833260091928441;-0.33529876668123021 0.92855567165786357 1.1651666858930321 0.88132120174603568 -0.22470084516931588 0.7861655675695095 0.042881054774554464 0.23683876945803739;0.72089452773244556 0.96594834595948409 0.059287826544370946 0.49091734698052042 0.066748250264226469 1.4871581823816844 0.075578454938760253 -0.26819967548553209;0.40318791174552404 2.3420485356280003 1.238208148707141 0.40454835669221112 0.14245967869642148 -1.3323901605455306 0.047636624813003133 -0.030996936614899245;-0.70635429419777318 0.015635287636058755 0.22947618380864288 0.58805009693103405 0.7173702720324332 1.2539976205815631 0.24455416239345462 -0.090307892974330062;-1.0455772418158533 2.1018980544957233 -0.47351180163395451 -0.67506476692777007 -1.8337147420292501 0.75840284469783426 -0.099136076187125638 0.2524786280085477;-0.87702703843000851 1.2706500326264807 0.88095282489215321 0.6259507901868 -0.242876419730962 0.57372725240472822 0.26740404204798968 0.25873387213385191];

% Layer 2
b2 = [-1.7409262747692298;-1.5408427737424493;1.3601331842717661;-0.94184643330844131;-0.43581182168552668;-0.41510061049577818;0.27639697337516655;0.069271791815369799;0.19993013185404862;-0.63289385888080574;-1.0089818480747013;1.0965525773669162;1.4203198129835191;-1.8047627881452499];
LW2_1 = [0.3051471600133519 -0.0094865624140489033 -0.23868804541007344 -0.030674682267221344 0.52681737553201791 -1.2752725182509421 -0.18382634767496883 0.38992154577468707 0.069234147467693546 0.20516626721967099 -0.84095368100234091 0.1442035716452732 0.77979898989908192 -0.51386611600926602;-0.069042690578627802 -0.55336061424020389 -0.54318893442683502 -0.22419030511317442 -0.66943358775227013 0.98950562989148061 0.32163659574137615 -0.43949552708208683 0.37787870211314895 0.32752031069161075 -0.34338006897604256 0.58292200400980643 -0.32803845598936449 0.83014097713030788;-1.3250634766286664 0.23867955498831483 0.071170714265881035 0.20848021119531726 -0.16927604425687462 0.60362899564497263 0.4265111828331753 -0.98511055992607344 -0.34839054748690756 -0.24831393951852629 1.3630296341203925 0.026580259825483531 1.4353438580236004 -0.023890986067903283;1.1231885240924251 -0.58503230242140514 0.076008567186633735 0.63473652989491791 1.0256270537940977 -0.67479058731719133 0.0094450114435057821 -0.42738725701038194 0.15817468391381859 0.79338909194107221 0.28668528191711379 -0.4401506749102434 -0.01363810227974149 0.93187869544305468;1.7732928998611517 -0.10110652982803431 -0.3816616370060093 0.41495718761144046 -0.35538505576592011 -0.83110426391058922 0.36975900882807011 2.1874176623400619 0.023798004755796152 0.13155915192822515 0.44830633827535871 -0.30857819810397091 -0.036630647399236917 0.24495004495173911;0.64317950292934523 0.12537981581347879 -0.13283529863962526 -0.48765761353948045 0.18882675787002612 -1.1174365149972088 -0.19262154285855818 1.0315085592159012 0.087741933693365443 -0.63959390458809651 -0.59774164900189042 0.61545387229107917 0.67426374542834855 -0.42627991432620821;-0.87365965555435932 -0.51141579061090514 -0.94933122536300951 0.82330268655182426 0.39946458971425902 1.6243606521731071 1.0828707386782379 -1.0932182313385561 0.77296601653578767 0.62484468079212763 -0.18493145068282082 0.38512952789110738 -0.22632629475138547 0.49875641343561361;2.1286209480782592 0.19476990647766249 -0.25589417520141589 -0.65665843950265879 0.063684427454871725 -1.1110895352379004 0.25535093594668984 1.0228274966738216 -0.25504890687932341 -0.68717376389791673 0.82373510999649713 0.75238066784794078 0.78613429263002765 0.32100113299475724;0.71808109573921075 0.12975010373697382 0.48730221795980805 -0.010708116015360782 -0.93160033677635945 -1.1035380571189173 -1.3491081455940384 0.71476727533880113 -0.52203513535518353 -0.28174384581231665 -1.0013829470951721 0.19516001469188324 -0.53744256502219734 0.078867186775466627;-0.6778027078159391 -0.51255597895729643 0.61923762834753548 0.18816300733839136 -0.55924772304584192 -0.91037055280272161 -1.1655403315408885 1.5563551430813263 0.71029028542932449 -0.25397692386168452 -1.6865285120483831 0.87812365972688733 -0.13878401407414256 -0.70173250447412261;0.51081515632442109 0.36998008791445236 0.62289728596974647 -0.13941121511760018 -0.88003857196004154 0.43876074440984514 -0.5759009152742508 0.29953214683510698 -0.9262638921994355 0.73818605250949243 -0.5048515162716779 -0.065592903221576279 0.50944552000637089 0.66292867029815494;0.083837998156724824 -0.3785116913980307 0.71656914990001319 0.60954846164528564 0.45023721802856237 -0.85924899510594155 0.1695821428647678 -0.97423432608232696 0.23231737579483799 0.61286096372619736 0.4275248239022284 0.21079074583878396 -0.18314014056617642 -0.24126904183552406;-0.46957650281007784 0.098391465704438477 -0.74540725899851057 -0.54750490299406485 -0.0086882728016100461 -1.9092512901516303 0.12171562477482172 0.80844829789224315 0.14667070534672827 -0.95613961946905046 -0.10735474338624425 1.3092301775216193 0.9011480315768553 0.61170371328797091;0.085969085938831583 -0.10616398303398338 -1.2277781594650143 -0.31977885646808063 -0.84576578412465442 1.0475424474456492 2.0676523995531051 -0.37236747517218155 0.15945289137354374 -0.80771146695104445 0.15126723438157569 -0.40401789673120742 -0.6163739675527673 0.10237708284722945];

% Layer 3
b3 = -0.075411061019290071;
LW3_2 = [-0.83369455695508332 -0.7903671407018481 0.83400157394737495 0.87137142367204345 1.0871959239263334 2.2398508242997912 0.81272093537374468 -1.7602324826898703 1.9826133829146593 -1.140483343606054 0.7200670085051134 -0.13074480130947913 0.53543685754413051 2.2309849906111565];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
