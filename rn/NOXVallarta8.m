function [Y,Xf,Af] = NOXVallarta8(X,~,~)
%NOXVALLARTA8 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:26.
% 
% [Y] = NOXVallarta8(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.030077716828250223;2.7510240235797254;1.6422167728666281;-0.40058029706828591;2.9834739292739454;2.163221011231196;-0.12011625557242181;-2.1188226478287633;0.37613489714843229;-0.85011753605896356;0.1002526094581533;-0.26846990563094147;0.29053651243213124;2.6070709230506339;-1.8390056500971443];
IW1_1 = [-0.45869885902110646 1.9008175229164239 -0.93898343999501921 0.010988830239611808 1.922697304083349 1.3506633679264728 2.1601768097393093 0.67432264814011189 -0.30727301598952494;0.77570647519545388 1.6817120882643024 0.60961504678203315 -0.14720326760802338 -0.52686933380703038 -0.38467265289659736 -0.35136448899592576 -0.9296925718454514 -0.32657833920443885;-1.2258172314851947 -0.56347502468378852 2.009882780663411 -1.1232526080328824 -1.2311130917497819 0.29497515112913059 0.47423796052543093 -0.040109979288659579 -0.14916680906898941;1.0074061311994178 2.654848062695637 -0.62556165574046407 -0.14267965505130964 1.1734444380438922 -0.01459140768730683 0.33876196094318706 3.2121243345865249 -0.20926531526419634;-4.0783706650463554 0.25255204774036727 -0.59381237781297291 -0.18545303820761144 1.3605345462397171 -0.069298112135928347 0.65682416897334339 -1.7697777330233397 0.40295477919185346;0.87051217135229653 -2.6432107954587938 -0.23324394054524722 0.15731445383871021 0.32863850743866851 -0.48251904428033937 0.10737042668040366 -0.15927708964655765 0.1598203445569544;2.3448131155551093 -1.3775985438667773 0.5007669215646805 0.99837267754009229 0.072161673908621035 0.0756693507087247 1.2688960959509645 -0.79535088388734076 0.95449069935457076;0.22047196440256275 0.052569005983154005 -0.56503206574328535 -0.6659135095933979 1.4190037897507715 0.45410959871189643 -1.3057445113306041 0.82066164625310389 -2.827914302963372;1.9547686179033636 1.3993246343461039 -0.56227750417851086 0.046412427048934113 0.070914385737867069 -0.18572935150471023 0.85640243082599354 -0.4925535417940401 -0.032357521968893348;2.8054677624873405 -1.5210517426018 0.062418976252801274 0.16479133530061724 -0.21667901788339899 -0.10420198553736655 1.0245865284606674 -0.70781777839738502 0.52144434790043392;1.3394584375683887 -0.035133077598900476 -0.11938289003711594 -0.67353165641272916 0.34496773482104681 0.10885181434621527 -0.83406955035347252 -1.093522158626651 0.5965429444721887;0.313026147314101 -1.8604483309151809 -0.18294595620379731 0.47380462275774471 0.43582023276579596 -0.34871255197861739 -0.00072103580167845807 -0.23460347224808706 -0.10621278219494654;0.57288123843548777 -0.29398381802073859 0.2228203515423057 -0.44570865155211054 -0.078765826655113225 -0.38028933058796138 -1.1025179611388825 3.0346149835154392 0.33303506860951071;0.21533779417660961 1.8814028976035162 -0.49354141650111893 -0.56305709317205255 1.2980738686039375 0.50389618245991641 0.21357812516785032 -0.24347856524458836 0.92305562257654605;-2.5503777837063555 -2.0744297945698205 0.27277994044278381 -0.063399515282512212 -0.37695418926638519 1.630872487330238 0.43535730390298799 0.48003289610058414 0.55458482597981573];

% Layer 2
b2 = [2.0619958534824887;-1.887892690828332;-0.34095677533894581;-0.45645411930970237;0.24862275877906717;0.58593927827774117;-0.6990831957814887;0.56730771880534636;-0.34830051803323642;1.0438583811220064;-0.066287951838280568;-1.5365746535591946;-1.2007034694425998;-0.4455774721176336;-1.6475995357719155];
LW2_1 = [0.095753543296138471 0.95619135382407749 0.034000854358190641 1.2221933633226916 0.021509534048422881 -0.23754124621503434 0.3543086894750187 0.64010226077269106 -1.1228928328078678 0.075248181698467531 -0.25582712756165576 -0.5061339717139155 0.022706198178358422 0.51509232740937028 -1.3930517926050774;0.084330092377286947 -0.28062092594151289 -0.83529321586112737 0.59836850414347653 -0.41958895550882686 0.21345348453284241 0.35935195895588617 -1.3778003324792967 -0.38733423129469136 0.42913942981802145 -0.13553826812232961 -0.040465162813799457 -1.2355153425763001 0.50230203942411433 -0.15969406694006033;-0.087500759599077868 -0.00063044431384789296 0.91816943067574208 -0.17371402027176025 0.43601438041488999 0.31841169348238024 -0.62449977158347425 0.84020989943801294 0.55537189395671849 -0.35230896485072072 1.0030729818045667 -0.05383587558480709 -0.085759986871722066 -0.77673520947429819 -0.20527623129792566;0.13211183541076221 -0.84234118248721779 -0.88259568911908959 0.19828882194409667 -0.46904692284526484 0.024038999137025233 0.34416857356684805 -0.74742768574223539 -0.98682010223901651 0.67406000943722277 -0.55095458225142513 -0.47729261689240499 -0.78048590763042669 0.7981936722306916 -0.66323627945181374;0.33258322161352644 -0.36457593524037513 1.0414476740208212 1.1560114885136801 0.1498364205341273 -0.30473610554069253 0.3283098536403638 -1.2295577224359906 0.18965269119067157 -0.096105358140217922 -0.33690103203602934 1.2030456879174494 0.10764145688624686 -0.51809832482578311 -0.086553050621890532;-0.14760580002375756 0.92087735731037923 -0.8152485932542255 -0.54675535619761362 -0.45698897284532941 -0.33109236886347698 -0.074200099498085759 0.6225585320925181 0.17431282277372381 0.055554008118303175 0.6972818778010208 0.09720693643654027 0.23087966607462823 -0.53291643831642987 -0.83821742610186156;0.41621886432171779 0.02773401940137921 1.5081726210652291 0.51514482083996782 -0.56555787135121249 0.50607514867889181 0.12212079399581167 -0.77190944041464948 0.48930163532878235 0.48139805925588608 -0.29299774888591512 0.10526286113590316 0.033109104026191799 0.2357246429777683 0.25726033222562877;-0.15869985116185217 0.4918962961697379 -1.4886861922819163 -0.57912559265938834 -0.80471923796733213 -1.4375839343345649 0.65766891305149366 -1.2092406532906723 -0.19776964582499795 0.90640321984755756 -0.47490124050083932 -0.11406708959527438 0.46692097112115466 0.85808628667889519 1.3385296583256892;-0.056909902060894586 -1.0537232266758256 -0.48868419142109676 0.83758518472618304 -0.38308037271346784 1.3767320498777378 -1.1362977520733879 -0.11193257395227661 -1.6505386674921623 1.0027385738000045 0.34364073060566036 0.1011725119630712 -0.3898667724933943 -0.97324924006591773 -0.77884519839687094;0.28957898375298868 0.86865050291669998 0.72960376404920657 -0.68827976045031181 0.18731138113701931 0.83049820644125649 -1.2857396983005913 1.2387479607832439 -0.47596780156562718 2.1419054148357732 -0.51985775972939319 -3.3346428917585378 -0.510506342355321 0.62851050740699954 -0.85396257171058709;-0.35574542353765465 1.2057930115191953 -1.3846034543006032 -0.70831521902507477 0.27836372073553117 -0.31887354103265964 -0.33101837677310836 0.90482708216186503 -0.32806678178362875 -0.2026278190243464 0.085957659947373546 -0.40866185311457204 -0.040000653210412289 -0.016425907725531919 0.3187537870593517;-1.1279402051966891 -0.071514990496550371 -2.0483831901087042 0.61261391818506061 1.3632764070935588 -2.9050811849949731 -2.608003220669751 -0.30291935585546303 0.92568288583437597 2.5479389812059057 -0.074139636932074732 0.95398984336042647 -0.74857183691469931 0.48715623738107106 2.9770758478907973;0.056011981943288776 -0.060824440759167792 -0.91322028020581336 0.81423253264934414 -0.21131045312928548 0.067279162464038436 0.5008132066323544 -1.8357725424019276 -0.070035895495866557 0.16606573383751402 -0.47593761602869811 0.43962778810414027 -1.0596157047720831 0.3417895426296782 0.65815920978287978;-0.021023751421261921 1.1998366733210251 1.3972863403302347 0.88355981265775307 -0.85126123217871641 0.21693161763330307 1.2215462955254091 -2.0849903183559646 0.47471264671168367 -3.2593663993017041 0.41393625032024561 -0.10178114279530515 -0.31704039997963879 0.33665560918318904 -0.98139897424623745;-0.60538583737081053 0.30708447639517567 -1.4257113724633046 0.32712338388835704 1.5986178383085714 -0.3378945904352163 -0.45048965708898481 -0.23323107073100582 -1.3741189572128829 0.13874843657187924 0.51754453243636356 0.43164072883611931 -0.011207721229540044 -0.77106310935108191 -0.56319506722079393];

% Layer 3
b3 = 0.51978505751804183;
LW3_2 = [2.5850645655418649 -2.1717624085528717 1.6855269376462296 1.9817303233376868 0.52897428154568238 0.54655719948949466 1.6331555365303689 0.57722422209237123 -0.51434100616479461 -1.3994119956729902 1.8833181286851044 2.3773706591433523 1.30213087589597 -0.55243274623012517 0.54001899409986065];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
