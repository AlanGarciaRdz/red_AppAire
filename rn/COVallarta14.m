function [Y,Xf,Af] = COVallarta14(X,~,~)
%COVALLARTA14 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:22.
% 
% [Y] = COVallarta14(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206;0.201288244766506;0.281968137600451;0.290275761973875;0.304971027752364;0.100381449508131;0.172786177105832;0.171659085057077];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.07890439297809862;1.3960548029465416;-1.2142974018658035;0.73594118821043197;-0.6213029056608782;0.19751346816044876;-2.2995478265973195;-0.83776836792779774;-0.17602775107339891;-0.12093939825490466;-0.62611313795580326;-0.65600353550814905;-1.9435049835166025;-1.5688907564206134;-1.4796729288259163];
IW1_1 = [-0.031682868680910227 5.1605617521976583 -0.01350203236310344 -0.1014567381774035 1.9562888161770728 0.23041209149961395 -0.14915543450714197 0.053738401223769383 -0.036671386623413661 0.31279483143760206 -0.73999070517091936 0.26888423715083154 -0.2713213182539489 -0.063088852298660958 0.53975163173011098;0.41970073724843809 -0.65118215892047271 0.96187156809679886 0.068435162344572947 0.01620220697234348 -0.15705904647876046 0.19178987347453225 0.0073375648127026738 -0.7376716920150459 -0.018092073233199377 -0.24202789597283536 0.94481592074372256 -0.43472949514875653 -0.49415222916386425 -0.52721453474261804;0.37869347539418935 0.018798364782938417 -0.065361793768930865 0.77786291731805501 -0.18898016131472345 0.029926321151359635 0.21827088577748902 0.56467853812247448 0.062841223462996934 0.39108815671626007 0.58818339432186451 -0.4734701391751191 0.36751141754315053 -0.52901008716871234 0.39658340524327651;-2.4073103187449085 -0.64988082502046429 -0.40718831278833184 0.53026091842690293 -0.24463384525460935 0.025736892612408212 0.4401118980611432 -0.27456942562525199 -0.11156097775660362 -0.21056650900908508 -0.22656276572847114 -0.13283384361039058 -1.2008676525324087 -0.65425521961001643 -0.078582642867213184;0.09964271599872325 0.67998866945819192 -0.69427015512351298 0.23890784142070332 -0.42450597050667216 0.78185297218897887 0.46862156566886642 0.15841033758912293 -0.22001376051787269 1.0065245620653231 -0.45642766972458426 -0.20003401683052666 -1.2375669243578931 -0.51112517526794266 -0.68776327904066736;0.48713100804658904 0.25692932986738548 0.027253097557790842 -0.022929537873630366 -0.27107776449820098 1.1801680373572705 0.015080523580898647 -0.22112646374976655 -0.0016858203546691423 0.28061715959409178 0.155758324806757 0.15239566347633521 -0.13565092569935036 -0.047214956913213736 -0.021735784106910648;-0.043276150260677909 2.6478755954981259 -0.98278903111692462 0.76766706984132294 1.4184942298347814 -0.53987434807142132 0.37413693102911894 -0.45169732151612185 0.3956508247379335 -1.2867861456511582 0.52539536622292293 -0.85804120538728179 0.64648253465320571 -0.55604618775121517 0.062152888101897515;-0.32609935049008137 1.6694094295246409 -0.75131501008021973 0.9069932344614926 -0.61783325529576616 -0.66136707679206896 0.072172582653366124 -0.095205164154063673 -0.13391407222254562 0.013291179555015058 -0.28258979389121813 0.30477516826710549 0.82120367479324519 -1.3122797214635247 0.19226276995318475;-2.8345221937446134 1.6332856566644258 0.77406376439346403 -0.67984403589352083 1.8612105683754263 0.84523248797197348 -0.28688387753035982 -0.79631571779742338 0.42435072136756491 -0.33843789092866872 -0.80124170709933973 -0.4021338336242341 0.42404378440153506 0.14869712933676904 1.0309923233138008;-0.43587598711233838 1.594223979141645 0.24927971211529495 -0.37544840186026585 1.0215327253945299 0.17926275295071367 -0.036918702258645034 0.084082048032817977 -0.15016049836328538 0.16759416705678293 -0.32032673089383218 -0.0044375974752951484 -0.3632907187928836 0.42283219007620776 0.15177237195075477;-0.6498147848570982 -1.7811391321928225 -0.19315149164788487 0.28747644514859017 0.1144056060833499 0.074154377220435191 0.31141753822447876 -0.034505503615772676 -0.13374036023999308 0.10238644108583325 0.048844082911540625 -0.36722447540643421 -0.88579601502405747 0.027798034937401992 0.29176080881354527;1.3052599808239462 -1.455899461699268 0.25377588804957096 0.42831234424413051 0.46447023121160791 0.33666207873299664 -0.21428272398586193 -0.37916676155221202 -0.16344102688533346 -0.25977206113867107 0.82682657445421326 -0.20946955243788903 0.6424382452404569 -0.43876133359021352 -0.33069956642210074;-7.2977506669609351 0.11978438388810267 -0.18128326357083685 0.44369710677100366 0.15398957847094219 1.7144423328463425 0.06843043892982445 1.362594953845065 0.40111395331794453 -0.63031716406281735 -0.70689669658363818 0.78184764126084128 0.17918441371971125 -0.32052841199556803 -0.076089629543937942;-0.16918034181813005 -0.30916259742167684 -0.0030497347261864011 0.27390189746446891 0.30080517991046563 -0.35710669147108476 0.36297058782103353 -0.52673776100473102 0.24673367040672076 0.27645832295419465 0.34909596752841376 0.63708865350855404 0.43455518709170016 0.70683790612814967 -0.032386747813905277;-0.16728872485783453 0.24010127027627606 0.20837438779135795 -0.47424123566679177 -0.87256746581677735 -0.0065459321157391032 -0.2498200655670974 0.21796318592203068 -0.067455128728694982 0.008023437081154685 0.075197656843275784 0.2588783159416484 0.78981774537758442 0.24146075621975419 -0.3603605157010541];

% Layer 2
b2 = [-2.4347861265078143;-1.5760181463733849;-1.1069588240267176;0.52873107571575184;0.60388052692054084;-0.0058547439816293151;-0.39599842820228021;-0.48394097185751811;-0.035609512653622964;0.4890665335250246;0.78346481305717608;-1.2409182631784983;1.437076886627995;1.3391098650734095;-1.9572155131206097];
LW2_1 = [0.63732732728605157 0.51944838570709462 0.90467037230179059 1.9056322772144547 0.21927411699325047 -0.51375474620095207 -0.13843575696194677 -0.26172630884709996 0.89493765597465513 -1.2868106284214884 -0.027039692742188211 0.088875530058348154 -0.59272636581836724 0.98014248968774809 -0.44903880617904202;0.34796348305452723 0.094192932237444238 -0.21276130031924273 0.30210051071507116 -0.77613811891861995 -0.44725709624129723 -0.37692263491513794 -0.37997705364986012 0.66330755032645738 0.59080726790538174 0.49534365747828152 -0.066884110776937095 0.57696234443836902 0.12900228430977922 0.54948050731939646;0.50034129144405193 0.058805525920201399 -0.55970276835335908 0.55711821237495096 0.54163140825850553 -0.4598187828512717 0.12453014203237275 -0.43519102202660831 0.95733088956178425 -0.96243955756416832 0.30450164585085115 0.18050029528129158 1.3631520839930713 0.22185317716558836 1.3870520775330462;2.4361671569890513 0.293916547265615 0.28167881348477125 -0.58292911169090633 -0.19383673759772019 0.57533814969200947 0.21569679898056549 -0.69021664997247967 0.18079688355673007 0.98648725712197871 0.061213255531840316 0.88353748257658393 0.20008246234659557 0.76006210296917498 -0.44137358618261591;0.24084187313811212 -0.46310565315094981 -0.060498869747284578 -1.4778391840725165 0.60487739072230695 -0.31948356151573193 -0.80589114899133585 -0.046999954246217869 0.11904452503221405 -1.4982877698447061 -1.2561251811981953 1.85577719642477 1.3765053595777053 -0.35027618048455922 0.64547973805846004;1.9692492078431987 0.86512026371446726 -0.27943369654144801 2.6523213896330975 0.15251677569180688 0.39534477286110792 0.0015822902640712563 0.84290596890393643 -0.15311131193515515 1.4102971748145816 0.40116637826052559 -0.29517842088208246 -0.26244129901046304 -0.77723474780411317 -0.30667686785370801;0.52635612750350502 0.33667311338464012 0.31359122428249497 1.2007343331976148 -0.49209654897866051 -0.68056794657137354 0.0095305331608426715 0.44549685586580134 -0.2822208494244739 1.3180138729171711 0.93183914505710563 -1.476486541313426 -1.8538432382130425 -0.15921064739600493 0.04596855763172486;-0.75268510385014686 -0.21771840630505357 -0.065710487847728677 0.38724923058170646 -0.33646285163876 1.1861483331243836 0.047877113432941834 -0.1459001713346223 -0.34078954209875323 0.71858325099950582 0.24260076615791906 0.64980452803325894 0.70254777513175815 -0.24155326102863273 0.57329802085870063;1.4842492599313222 1.0870461859112317 -0.58977246422270979 -0.90087106514075033 -0.021156572959684261 -1.311673665754975 -3.215183642217422 -1.2856984460268428 0.36251850330614055 3.005965544610377 1.9028222665970842 0.86272070207496709 0.16155701079255091 0.3131593707591403 0.79590430656050548;-0.064095633515732386 0.55757143785577645 -0.69738699603738152 1.0780286893850062 0.53224659696575305 0.13894704117405837 0.022482265922985946 -1.2541703833570828 0.063968617830090613 -1.5081292419047296 2.0869223190711943 0.30162917372236331 0.058211407860131709 -0.26297481706917453 0.72881479261090365;-0.67892128760704229 -0.20075125267461674 -0.50056110460733172 1.0600616571876222 -0.65662967105174364 1.2510300360729796 0.092443770556978874 0.08111567625122279 -0.43639168731396993 0.7229178280996571 0.57213446268763812 -0.065714230021444262 -0.63268237748871603 0.12856473487634015 -0.10239963509355132;-1.3573534091803101 -0.72260358102085309 0.11272760293046694 0.15655042350165821 -0.11162322007266653 -0.15439746478181227 -0.9278654338580431 0.098870230314619195 0.63315384904706196 -0.27946065388593222 0.093692972493912244 0.61143122043802089 -0.24900827540171738 0.83985806160520826 0.15908728971606673;-0.10486205761231289 0.5068132710921196 -0.39705731165981628 0.015463013235618051 -0.17469212904895129 0.079891205836162937 0.20457916911388846 0.73659341910835874 -0.32736973906069411 -0.99518780656866734 -0.5837005453626366 1.2514608196034147 0.58265985150466215 0.069864258885812325 -0.51792246437125677;-0.037187710534257776 -0.17763409158384258 -0.55812611708027349 1.6789377288582168 0.51925367630577701 -0.12673011548964067 0.27268015149841224 1.034446908719544 0.40642983804864646 0.81462784310371017 0.53554085010585695 -0.27192925771373966 0.19580190589874252 -0.44905612560856695 0.2948160347588662;1.4414022185515756 -0.37074364325543657 -0.47631061495395621 -0.0073974347031568076 0.016980918854374236 -0.85763458079094912 -0.2430914965280592 0.4550011504193428 -0.31210638372438476 -0.40733576827640339 -0.40969787076702879 0.23560461986625283 -0.11286232009585537 0.74788606388051115 -0.13900228120041472];

% Layer 3
b3 = 0.0199106486919855;
LW3_2 = [1.7144194825245016 -1.0576815992014337 1.1595328579269402 1.2445560923884704 1.174384351211174 -1.473251024003928 1.5594558765876334 1.8288182075278792 -0.27075080107539928 1.2349201675578858 1.2298733055948285 -1.5307021124690563 0.93873826270680627 1.3168491694319857 1.5694788958360462];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
