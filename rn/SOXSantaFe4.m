function [Y,Xf,Af] = SOXSantaFe4(X,~,~)
%SOXSANTAFE4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:49.
% 
% [Y] = SOXSantaFe4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;10.752688172043;0.00341273633199099;27.7777777777778;0.00632111251580278;0.294117647058824;35.0877192982456;166.666666666667;95.2380952380952;62.5;117.647058823529;24.390243902439];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.5454605595197886;1.4521714220385302;-1.0906273882934119;-1.3158798392218709;1.7421066699475813;0.28426874246854533;-2.2936861365732581;-1.711144529786041;0.084641160036093746;0.86190848619366389;-1.9400432182682812;-1.4299406573996247;-2.4574503719129095;-2.4764410847577625];
IW1_1 = [-2.1455006149185198 -3.2177879361431376 -0.10566296961356664 1.8743246007771688 1.7151813846601536 0.6633300586582731 -0.46273312926975324 0.046612885023046717 1.0463729200450806 -0.72144741245493493 -0.31937200821858869 0.69218186094545697 -1.9637460886082336 0.19175171933212368 -1.7363225098076001;-0.24124982287364632 0.2894444939102348 -0.95756456181813032 -0.086174553132794929 0.66868766825090176 -0.99641805304744269 0.27835509717482854 0.10829081939219841 -0.64052145933959093 0.029855134751996987 -0.20847188545487857 -0.34057596238270788 -0.3147802542836774 -0.37596984376165637 -0.58073091230881346;0.21164957326827424 0.56799185633537019 0.82361170743347378 0.7593409089787182 -0.37991145843945889 0.011199930924775042 -0.29891929349808732 0.23825728663236964 1.6204660783230087 1.6933309230385809 -0.12673027889505437 0.42627284046222957 0.18771359115226657 -0.90188715198847291 0.10769562616907667;0.51525491515433486 0.91574714929772016 1.3537179957196641 -2.3971127122674534 -1.0547629641336467 -0.0687593240174416 -0.2459538815601926 -0.20177909562751886 -0.10357109525041555 0.38940106835475474 -0.051676997308299499 -2.1504162852095932 0.73434588303175907 0.27766788837756379 0.43449418719026622;-1.5623508134527502 0.12385726586299019 -1.6000886397632248 1.4666485450822397 1.3719194691319212 -0.40657687102348666 -1.2461316588933047 0.18874735428558373 0.4312859957221345 -2.8112348759766435 0.18583167766191688 3.1892762651191888 0.009455732675792243 -0.27191914528738903 -0.79383138714359192;0.42280400532305673 0.74476483583627928 0.33426618032990024 0.45084585665642674 0.021522744703078141 -0.33298028135415569 -1.3359127956794834 0.11173087735575575 0.83679350200184521 -2.6415506621372526 -0.020685311340254538 0.60955600829433176 0.067927368161865495 -0.34428272998488291 1.2010853496334426;0.92754029287808237 -0.29956622187682663 0.23460162370078189 0.45033703554891441 0.55484975804295966 0.25421745845032562 -0.062076549839330197 -0.0098710911594540075 -1.0737348496237533 -2.563492837302793 0.090906388358630727 -0.72530204689297206 0.29128844247406349 0.10801248943649656 0.93504518106239143;1.7482965242480164 -0.51236470638623943 -1.6018138643992808 -1.1426966792640818 -0.5146676999957811 -0.65808546666563006 1.7452248541785096 0.28594630979746344 0.92356599644533333 0.89446679133759899 -0.79618073704214631 1.7936066247518785 0.64586220004239514 -1.6163599788194003 0.52400128879682939;-3.1059571557093006 -0.31657470721845166 -0.33841325901433539 -0.22121282376927212 0.23939125896327368 -0.1911312212708744 -1.0414590678086297 0.032344408859287403 -1.3521896988133053 -0.72946970003155698 0.65013039262514061 -0.26977642314250039 0.061672975332597892 0.029706543541107397 -0.61800643210312256;0.39486655630290007 -0.23258024640174418 -0.12004252589418055 0.15256220127398962 -0.50702635649878347 -0.51284027244117036 -0.15998279406752072 -0.6552594748424081 -0.58824914632670977 0.012571578700991941 0.1231817626003138 -0.49776279637875265 -0.11237681182920897 -0.70079686785545348 -0.6044550152464413;0.72044463168973538 0.96065455917992226 -0.50423860255427577 0.41842934855735314 -1.2478893773193098 0.49992706749085625 1.0142550934096819 0.28485428489534487 -0.86897759066200497 1.9866342688483483 -1.26003937604183 1.4474917967526251 0.29879370776212966 -0.72392969388273742 -0.50955676255438664;-0.020598245662594911 0.30353702163317148 -0.92493310292298148 0.12293768918757667 0.2291024886270725 -0.19645397668256345 -0.18283339331343071 0.09381371546363948 -0.55639259503784977 0.79129548075757516 0.51782266176157621 0.55249426666336598 0.7173056143137907 -0.36622051353889906 -0.51565853932539862;-0.92434407554265308 0.27736336654907218 -0.092216282695414681 -0.20928282304363591 -0.34942143573619355 -1.5148773472248453 -0.041627413060856065 0.36792976708398151 -0.15509121086439484 0.60074815852026742 0.025006278312511052 1.304984233790941 -0.33984612177240608 -0.75535042981778222 -0.25315777477762702;-1.025698389200064 0.31675905036078555 -0.20879838234810444 -0.4752976995498821 -0.52267315078179111 -0.27301467427262355 0.13496536017726646 -0.0047987739542026363 1.1343188317289361 -2.6615874554809653 -0.023792558368876636 0.79285693711244709 -0.28365659656756431 -0.22977934613701592 -0.45082925357131864];

% Layer 2
b2 = [-1.7435246843912358;-1.5779326161445217;1.2994821401440366;0.71929914593147815;0.78557940478017985;-1.1481932204724452;0.41293634740023488;-0.51917969395429209;-0.19124502792906009;-0.49594408898407183;-1.0344863434502023;1.0747978808192784;-1.2438653479797059;2.3032495429571456];
LW2_1 = [0.84485173278296688 -0.58365736214143149 0.58629198261168558 -0.34377091967203033 0.15623157226086493 -0.17350535391621486 -0.02013532255099143 0.32778103699797939 -0.60553990774737554 -0.28710384606191486 -0.95466732395119114 0.053943273542616209 -1.1357331875499954 0.25474482196400067;0.70006215779936187 -0.42770139394991402 -0.03975878187362817 0.80395201368275582 -0.09871344288905036 0.30939060818140918 -0.027601292424548063 0.42394694451746784 0.27028576964140494 0.062855943303873757 -1.4269028724297015 0.053631694183772081 0.56502804396518891 -0.018775663349606515;-1.1172325085606845 1.1087141204160496 -0.23017714274863099 0.052462190946128702 -0.25862936460266012 -0.68768445235760689 0.2324091385530109 0.23354606303847586 -0.67060688879849173 0.34290950803226095 0.10395259596226376 -0.66386512953852694 0.49981501994739996 -0.31692874343574012;-0.97812522426053761 -0.051927869170633287 -0.15796325484490575 -0.044218271776544783 0.27925756464125856 0.04883488034953494 0.81599715046605281 -0.10809573607514256 -0.13623173055855281 0.43867218609520636 -0.16189565887556964 -0.20195859955449821 0.37068263353278197 0.50096075181110755;-0.36690054385274856 0.82133995438232943 -1.209216519507494 1.2214795029376524 0.25593130199809244 0.33033217260376646 0.040352477406053112 -0.075594169605467498 0.12412867153722232 -0.47947859402517945 -0.16532981417318768 0.32073175328947795 1.0453548661086176 0.057476575763695678;1.2088692428583909 -1.3112313522504535 0.61865979438464191 -0.073662525247556579 1.0774375516938719 -0.58578468310164455 -0.061602889298144579 -0.17006283253215371 0.11456449140480422 -0.35250336015883788 -1.3952686861524874 0.28123629465466032 -0.18151643682349913 0.17461476745933222;-0.76733607775688772 0.48568667818142619 1.4290039728228927 -1.5088518144157477 0.53999938565514449 0.34844567695696865 0.064404139094743934 -0.66824725447782041 0.23210397744134151 1.1723072282835261 -0.9537676220828829 -1.0628217440428886 -0.49731109783350969 -0.49630422748269587;0.7026673279575345 -0.29276154609431815 0.68367418219366283 0.044315333838900225 -0.49256250028786913 -0.72228798567404906 0.61403474292965787 0.40269487869593279 -0.23309055950775184 0.044469279753685642 -1.5364587602612669 0.2969799847532798 0.11840373912957745 0.65203960014709395;0.11745439661661017 -0.51733330091980101 -1.2079621470830628 0.23053502894249869 -1.6824202586838444 -2.1252661555394727 0.56202676555532638 0.77455173419530143 -0.64188578227133419 -0.60854912348020207 -1.0026161231671413 -0.29249383623132241 -0.09428479146324284 0.56275696340565584;-1.1144824125162265 -0.35146089569567429 -0.23384159683717537 0.19513541627399825 1.4744298606833353 -0.53946334034880372 0.78885200924654675 -0.097335738898581992 -0.76999528969583719 0.12312436168975768 -1.3559481738472048 -0.80391591621032243 0.66796875400401923 0.073370737384965426;0.087813543595097243 -0.10537267516229304 0.049893644620622173 -0.1584916404951203 -0.10362516720144516 -0.29389429002699136 0.23734796752164203 0.22733998901466476 -0.15651840951372767 -0.49583833721883108 -0.57796639682047057 0.90730577933813383 -0.59833640031945967 -1.2209872664700439;0.41373028108014404 -0.85761560832999228 -0.046472238250545639 0.26293069187894186 1.3220667395284889 -0.75658022189466478 0.37692115722741049 -0.29179176834745785 -0.34978540352628495 0.64875554642263 -1.0827422768551445 -0.38941437933926504 0.41867745163842185 0.36072899039725514;-0.32686473836324215 -0.33583310688804008 0.23964331176449633 -0.084794918615605966 0.27276929512793319 1.5459668792150578 -0.57645915042404805 -0.26608193744677849 -0.094479322054278059 0.65410935951591265 0.83280789432372293 0.1881197124881244 -0.59356762601401425 -0.41532201121524781;0.78356470157077818 0.80831335562689977 -0.71971213117233634 2.2560629732465034 0.17637204879571736 -0.51180825366594485 -0.094621934419880149 -4.266549118378256 -0.79673849073608727 0.29374706332226441 0.30335630801477176 -1.0410260964797737 -0.19867777988256774 -2.4289528723863913];

% Layer 3
b3 = 0.76299936212670239;
LW3_2 = [0.71647928629895641 0.58000005028304169 2.0660906008650533 1.791321356290815 0.53877989775677493 1.8001077325802441 -1.9660554014044203 -2.5073295074750388 1.024301263344408 -1.6112877491895059 0.67760146898237494 1.4835397463291733 0.65873669208633356 -2.2427959666909931];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
