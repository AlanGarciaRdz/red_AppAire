function [Y,Xf,Af] = COAtemajac4(X,~,~)
%COATEMAJAC4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:22.
% 
% [Y] = COAtemajac4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.201288244766506;9.52380952380952;0.00968992248062015;0.0210748155953635;166.666666666667;0.0561797752808989;0.00614628149969269;0.0213447171824973];
x1_step1_ymin = -1;

% Layer 1
b1 = [3.9932384002699708;4.2726996149195218;-2.031258288445664;2.4350339463328652;0.49112707923651017;-1.1240576002384413;2.6330219633593259;-1.4395836403294822;-1.3738076326783806;-1.2201561298378216;-1.008887675371346;1.4079338303739823;-3.5526320679136534;-2.5788765444055906;-1.2168459313139393];
IW1_1 = [-1.7173196377640387 -2.3179180628663327 -0.51465618153449288 -0.33026875527705624 0.30580903883144883 1.1889784781227719 -1.2639103925218849 -1.0949290930092914 0.74777168551834672 1.0003382352714194;0.11661571356671688 7.2274420399642851 -0.58480316179747538 -0.14556415496541353 0.18086795854438803 -0.29464539970458198 0.59377796613477907 0.021644130242510273 -0.053221493287742963 -0.15735127810975336;0.27855461016509131 -0.52760049364765715 0.49673022128541044 -0.66464138445141763 -1.7895542843769807 0.5234408499791815 -0.87279094680457003 -1.255330406549908 -1.0101410762546408 -0.16062437532238352;0.026015142738969411 2.1120483947250195 -0.41840072324693695 0.46393962506116898 -1.884628753271482 0.57734452572559625 -0.2170033362774387 -1.3247863235485213 -1.4733771774569868 0.15158222692760306;-0.33510692996931046 -0.63954987561988763 -0.57534913027464585 -0.97403387025186305 -0.043316471646527639 0.047633306924395685 1.1140444512676668 -0.10731635602081686 0.30821082549752099 0.92477773874757518;-0.82597515164320001 3.4318231428465098 -0.50776824250038199 0.19828614708105743 0.23850175610793331 0.092142091684741967 0.023116855412847043 -0.091435307319187822 0.22076514119151514 0.15468627503835677;-0.1253002043073006 0.44442208425782415 2.4292029769717156 -0.87694684334883377 -0.048272225103055739 -0.0090028323100476964 1.030209833347244 0.078302510090547728 0.22187039891373017 0.4167864180898726;-2.0848087484279456 0.66401207313134869 0.23536523943920146 1.1498107297079314 0.58808814439193913 -2.5454633379368072 0.34056713497755037 -0.29153246063281207 0.2048836075565712 1.10900188003321;-0.23640916134077952 2.6823228371889534 0.1766226363536039 -0.069486914634874747 0.2353931305244453 -0.20804542835438333 0.011782506121944729 -0.63310960374488734 0.12762406857246561 -0.45664999617740998;-1.9983119824611466 1.0893824962947192 0.27020289812503478 0.8946361009702446 -0.16688310012573948 0.67846992114462812 -0.4391397239659206 -1.1241690123977814 -0.5765293185893936 -0.3644216348650326;-0.40200748710389383 1.332659113722199 -1.8679909244658084 -1.1653295708028935 -0.36941627762880735 0.74645589568498505 0.8485938931234247 -0.44410147343341411 -0.16618245556251118 0.63481258155915221;0.71865890356031414 -0.90949306585989853 -0.31694199999783712 -0.43288623156131872 1.0339381778443952 -1.0644021815110392 1.0694433874106974 -0.35174568897471098 -0.52055942031615532 0.39814669485158927;-0.21092394706361559 3.7857528648642207 -1.1333014917070758 -0.24108026848269695 0.31713663455098245 0.34015934540940379 0.28244453325325436 -0.060356514356232863 -0.010503239630312536 -0.46256377748084615;-0.55121488182643985 -1.4047017033897855 -0.14467846142608862 -1.114393791153242 -0.22384669011128208 0.2655105902460404 0.092897710999406233 0.35910355827285662 0.90460709967501962 -1.1135441182586769;-0.26733394582687714 -1.3038523623835561 -0.4776584852359006 -0.67252758849832439 -0.70264454089263884 0.42602275147464874 0.27765501315022229 0.58590707540916109 -0.45777642424146897 -0.079486135518692796];

% Layer 2
b2 = [1.4795413964660371;-0.95704557729739248;0.052411941787309457;0.48484388959553781;1.1658988665007002;0.66268971705260138;-0.071858061862460687;-2.46217960850562;-0.50081634502356365;-0.38077163401449482;4.2897557609689834;0.823846546600014;-1.1287429582664448;0.35255224576105187;2.6295751492147703];
LW2_1 = [0.40630875573102321 -0.84062757348985617 -0.0020364346761240371 -0.35968901662869807 -0.17728184417413978 0.60928634158944805 -0.14182323861114787 -0.017292739118591867 -0.01406691284424515 -0.022895005260496724 -0.4176357529732137 0.089640757050789249 -0.26221268259784569 0.062525308716653724 0.83850612521227885;-0.88956328708688692 0.85499414551006603 -0.26489327121135386 0.26225523179267146 0.62975911841326049 -2.2628873673594416 -0.3927004642902015 -0.38107669962855045 2.5302283165171153 -0.71849706896106025 0.50932842629070241 -0.46104994857425413 -0.76434015420930168 -0.27453308729299292 -1.0237491166283585;-0.97896847709323576 0.066425359178272789 -0.025717394119703089 0.65027424274803836 0.10883408621222655 -0.5119954792054785 -0.16373206776876276 0.27383149124997325 0.88664933233920284 0.16307603046964009 0.66127946875156773 0.21690752823673146 -0.55656741132857779 0.31460861013467639 -0.72878946867425376;-0.82534459152614126 -0.66175441242348687 0.14364753370711539 0.281446883116931 -0.99465922983167454 -0.44216013908422769 0.14590836156830156 -0.11477686581131082 0.7244818878117586 -0.53617288501908045 0.61469405366363328 0.10206538652393095 -0.34999143773306041 -0.013879559927898905 0.15175593490744152;0.81796338241390687 1.5950477187825765 0.77520097158729773 -0.4772855704105996 0.42935486665039402 -1.4094745216451767 -1.4782821237972679 0.33820210812798684 1.1832162043385075 0.40173014403943386 0.076433000586426866 0.21420303307909755 0.81251735583205742 -0.57355121347928728 0.69131615622427112;-1.1839176011824577 0.79290296343979116 0.22211891255053087 0.27571248940372012 -0.24396595743125674 1.4639901325992022 0.32491899981142763 0.33168597185048759 -0.94452517377260636 0.52403983402675325 -0.62320659273279455 0.062092325498671941 -0.056786627395311769 -0.080794077477397197 0.98522893521644117;0.47274383599193492 -0.31432081949690699 -0.12378109230656524 -0.062123749895050359 0.28167769071547705 -0.17076083496330427 -0.57463369091133432 0.17256929942041105 1.477259176144226 0.054390883087653788 0.37233432823252838 0.19217085643622725 -0.91374304759917602 0.21117941101034543 0.1435676209629729;0.54341629616588893 0.12916918644862521 0.71465893355128296 -0.72232276611500412 1.2436100998895994 0.60722198041229769 0.31434737034223059 0.10192314349110836 1.4000805318631269 0.30909636568957921 -0.92747068353808548 0.35677701666088341 -0.64555135584231671 -0.93670166195078952 0.32123503840615508;-2.9292914234241967 -0.5102332020364011 -0.0034609292460969568 -0.098292811512062553 0.22311680229830269 -0.45893901023698952 -0.40259830358270521 0.4544808933843334 -0.93373094548996494 0.47372433020369681 2.0211475511038302 0.53187283833517673 -0.58994866559258807 0.49045071108156968 -0.42943942394276124;-1.3713798778608846 -0.28161096756536486 -0.61197975840409691 0.16140282334245976 -1.2862487354749723 0.37572973237065677 -0.18357095197916973 0.49185708080664392 1.1122438874103873 0.090552158278796785 0.86276422485540005 0.25316254189320958 -1.6499676453042909 0.82235020705139306 0.79050681940892387;-0.48931696220248311 0.33990282065038979 -1.6098086184185665 -1.1556352463049271 -1.4732590672588854 0.15439435384986588 -1.1980414911813178 -0.30924731430776653 -0.96702909677225557 -0.50308565710298025 1.3948002310712333 -0.45556741838149561 0.086098072155712371 1.0707978204382838 1.6388432724613673;0.66507341555484567 -1.2284988132435366 -0.077012450738915411 0.10010741999252878 -0.15201050383316858 0.36349476917042817 -0.11452840238629942 0.03314821190040803 -1.5675350534159269 0.24322754565518015 -0.13231993327256064 0.35914078651760567 0.87483900183348695 0.47433529233779181 -0.11963462234038923;-0.76041103305053359 -0.22703079011186905 -0.26283625637287233 -1.17875929585905 0.70641803236712275 0.95030364222689301 0.77195466526301926 0.20693327292254457 1.8707333827294919 0.73883401888708999 0.31482402579098301 0.15225158997087532 -1.4993829768821809 -0.24208830129019282 0.927690605084728;0.93850276432260848 0.36315536548360189 0.16096880179104528 -0.11750702141823917 0.035315521463157598 -0.26779098352579517 1.2615635564238099 -0.47004990757499476 1.3978776828577284 -0.31514383703840082 -0.5645615969459703 -0.67949868146273074 0.046413926755534615 -0.59695032528197745 -0.96352767821061092;1.9186026535390093 0.83216965507040785 0.30153353686926482 0.4493514988252974 -1.7057697719852067 0.22459888305198289 0.046929349857224051 0.94413758616517951 0.81862527510851957 0.30656438285131904 -1.0953254080766648 0.076321450550501019 -0.29863033979219744 0.44526997899769905 0.7648063296534181];

% Layer 3
b3 = -0.91370653740275565;
LW3_2 = [1.904376331249336 -0.75666216498718464 1.6410707726200386 -0.50588876299003871 0.1543990549923118 -1.2616739838316857 -1.7622259035813439 -1.7348177365320987 -0.71042967677275271 0.86054415501197712 -0.89525605626161009 -1.1816705109655441 0.71240495282206728 -0.48019446485288803 -0.52528743793881605];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.201288244766506;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
