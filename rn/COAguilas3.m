function [Y,Xf,Af] = COAguilas3(X,~,~)
%COAGUILAS3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:17.
% 
% [Y] = COAguilas3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.448430493273543;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125;0.281968137600451;0.304971027752364];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.93464576976126446;-2.9369538799275419;1.7426303546546849;1.2631194248238498;0.25201894825722143;-1.1857881555339094;0.86820428302501751;0.079769904531633337;0.060796575483392429;1.1695600935764159;-2.4790034597571831;2.7804260660188489;-1.2387112350151646;-1.9604915490851629;-2.5947030623816785];
IW1_1 = [-0.010760309376928611 2.5329625201633061 1.1532896318479986 0.22450519197636565 -0.55566104478858547 -0.1990879271354079 0.03288313180567478 0.55218435077318839 0.09322484599637712 0.033497029579939219 -0.58341290767881782 0.22744091153551591;-0.25884738517136452 3.4728187759730957 -0.24451716192356965 0.10952190968250408 -0.60121805783878768 -0.87090191813654383 0.19277861332747795 -0.14717129730570286 -0.0085670940321491973 0.028884443260037578 0.82063968371356899 -0.18806528373054665;-0.18580924320216646 -3.4043910002701017 0.44591760042624939 -1.0902985371948695 0.099828975382328711 -0.080988477065945932 0.57186228569833875 0.29624914016488912 -0.090788324729706021 0.019341291012399987 0.36635449343146137 -0.098017723964773734;0.096429571762935498 -0.64408993349200205 0.96955599470214626 -1.0917528967453671 0.15874304170834092 0.51621198244851307 0.21747905832273307 0.092060588562431406 0.055959824765741455 0.31031579553905642 0.18753143987093512 0.17035862038280969;-0.90254175795484604 -0.5765240842613083 -0.15306777765138802 -0.37174748164820659 0.43648635723119256 1.3754996857999133 -1.3230576568396639 2.7003476947944867 0.1939257462953605 0.5057956748530853 -0.28272208930630199 -0.73275964370099267;0.3078013239652006 -0.42570719473672031 -1.4160247884370933 -0.24267981862102819 0.26564276888904703 0.10892775137759399 0.28516796835971425 0.68524527080980124 -0.082650245538813907 0.181857057967449 0.05537964188980464 0.088904204735032882;-0.5333610380234779 1.9696415549392665 0.2780571771229462 -0.63993783336439714 -0.38043190633058016 0.97881133035915924 0.75349707596658433 0.24445808918283773 -0.070007540462644346 -0.041947864669302448 0.46115269869666531 -0.25488450426959558;0.34902220140585316 0.32205317638279157 0.25582402729258019 -0.75820401143223315 -0.92017073488863477 -0.77917845780139816 -1.3414952473706965 -0.082540451252665806 -0.0045633525994672533 -0.31099544404942303 1.1186729888330351 0.17622321958598189;0.37779849822265632 0.67576412721844836 0.13255351906636312 -0.13916418729919788 0.71999518657680395 -0.69409685366987528 0.16016023996661316 -1.7839258708243566 -0.2727754699800794 0.0026964919227154133 0.150764149518469 0.18206876240490097;-2.0262573464211049 0.29025009332540452 -1.9481613552667734 0.62781508611184444 0.73923243160983143 -0.083341541031617644 -0.11677140470477651 0.41675609019487225 -0.11015819079509979 0.099864399882542643 -0.7787730724601849 0.056934893835278402;0.035104386998369104 0.17326293114621338 -1.2780991093696492 -0.22722572005237926 -0.30435271568253458 0.19492415658410334 -1.2198807862760805 -0.98982415510871846 0.081657225536497013 -0.039647233674231105 -0.26563085215532883 -0.77523901636737624;0.40473746514095232 5.9680639296492508 -0.81189376368629174 0.64206610985346024 0.35135219452322253 -0.060820707638460238 -0.85419954744496662 -0.094857721036907858 -0.11652699942072103 0.14556407736274671 -0.28700541828984427 -0.59737833977334553;-1.5211853860270217 0.40214179778454823 0.48536640206588144 0.67981227699114055 0.99072233002268162 -0.007973819618031959 -0.061776454620425622 0.22770548704419363 -0.72604663268651437 -0.21491750815168681 -0.2365920901655279 0.02729623869189253;0.00051922321296846846 -0.52761452334621228 0.49748763389433609 0.028827972567484626 -2.9303808164592811 0.46747038227759852 1.7391200437036596 -0.84047752809683685 0.35255615309464722 -0.79890592902487145 0.088965451671530651 0.31920465432465894;-2.1022554501506701 0.056247247049366442 -1.7021848306433041 -0.2313826352756102 -0.64252413095486705 -0.61989382126959869 0.87807300086286444 -0.89816805642535469 -0.13067779481621092 -0.39004239486185066 0.19243655351206479 -0.1257019187320827];

% Layer 2
b2 = [0.80582550146313936;1.8815427955771169;-1.7567520333206039;-1.901025582863997;1.2624204045229466;1.5333628254212095;0.64766208233004974;-0.60685787127325774;0.98241161415167488;-2.3190563119268544;0.15378606233034636;-1.0961181736198569;0.1985807461281659;2.3985105018551076;-1.9274970359977059];
LW2_1 = [-0.77076386372219241 0.61909131174732956 -0.83848046165039369 0.22212878490523996 -0.85181008920517154 0.35909036114358583 0.18422112900777843 -0.03358557566164088 -0.072161479717124943 0.097069186836172452 -0.51743681944714248 0.48989406998241403 -1.1324133208809313 -0.037392065628444784 -0.52205311395522846;-0.66153581601487077 0.74291895401369312 -0.54959557887793364 0.45122169857298539 -0.012914668402807264 -1.1407616424814702 1.2765047679011894 -1.2874475734018995 0.39972730425207559 -0.76507573272226925 0.50892789782461423 0.8909309759720887 0.98988880080449804 0.9272674909928218 0.81140118137860084;0.74358147218572535 -0.29276365332928789 1.2986592556165679 -0.10908234102729672 0.5840194782397008 -0.29370806144435785 -0.72937312952457101 -0.85990511412572035 0.15329489951838407 -0.19729526283291055 0.62243569488033279 1.1208114574716501 0.11981453009783075 -0.11195897867239626 0.13804537668094166;-0.64517286612525737 -0.69745968270621539 0.091416539529226667 0.8244900780045844 -0.24435700332237326 -0.24194536047810802 1.170623146489582 -0.032667847064624063 1.072784113836045 -0.50249005286298964 -0.10122502974956284 0.96215639901824723 1.003810510662722 0.24672812917855769 -0.59961166731365079;-0.32204698696261547 0.69091844098736943 1.1206687401950444 1.2413072977758983 -0.48848728093685184 0.63428217954005173 1.0124369718269288 -0.5225554207814368 -0.47168132135736579 0.032745363245129465 -0.28423387858329585 -0.17026406115037684 0.22906372654250184 -0.43359579603742682 -0.21696893882155069;0.15653403853478362 0.21405899574236584 -0.51669447961240134 -0.24875901211752613 0.22939789419440204 0.10524770649080264 0.25603540692173976 0.46770324551711318 -0.66451987090896902 -0.22672738144862867 0.10909274224134011 -0.32698799622715546 0.76054748087793445 0.024261705387093151 0.57229798983050617;-0.35177881963747948 -2.3554148017050638 -0.4461052727786482 0.35043965143255718 -0.95613446498849886 -1.1498828505125551 -0.53856022239766388 -0.68876401937790677 -1.1709356355942047 -0.24226293497552037 -0.013962640015295767 -3.9373965363197794 -0.29351872776936344 -0.10451111619017056 -0.70123033132444856;0.19279336824048177 -0.25372912801410641 -0.6676823775631483 0.48927491671819329 -0.4285027941113313 0.79140793922448471 0.77369273818477236 1.2445180332404635 -1.1937927610582562 0.11502504512400477 -0.36830061105657214 0.25038826876385739 0.24719846249405178 0.16089360228100852 0.22541199758836891;-0.39345740942724028 -0.53304852029934657 -0.19408126986241647 0.42152825555747153 -0.32710309071541199 -0.68963129834242898 -0.98333580773476326 -0.12766713011710151 -1.2051984309380579 0.051264806833303998 -0.23549615225846293 -1.8704703095314776 -0.029386533281448843 0.29633799643113351 0.23757940216366899;-0.51097029164112895 0.061851839460487099 -0.09599397737169188 0.18769972918926198 -0.1802145190544128 -0.61612872058997281 -0.79482537539033637 -0.28657044948651461 -1.0019152334931229 0.13499189281099416 -0.053744874363258942 1.2475658025254772 0.098932986330246719 0.13120641168400662 0.36333467054232083;1.1563448256545577 -0.34652174346834785 1.3539694436887812 -0.61332076261081814 -0.30157572661645776 1.2697472403877486 -1.1132432456258989 -0.59576653278107461 -0.45732785545790666 0.92553841243560819 -0.08164155540655238 -1.0611911106710499 0.014703545672021777 -1.1499922457290805 -1.1553751101231193;-0.89507540570902944 -0.77497478963645872 -1.0695749851172565 -0.37932457808587611 -0.043160751120396912 2.2050927608948845 0.32945441897159422 0.61952048534769844 0.06183782060368237 -0.39585308679369174 0.74365401767182004 0.44962469016095974 0.057670817875826584 0.45942461065531853 0.80538400153667034;0.50835557907675188 0.15507412801802387 0.28464297494100033 -1.1817331996679437 0.22236134506811078 -0.29998322030384239 0.16337684556511722 0.072034417068772533 0.0031441098238551221 1.0747043875296296 0.028804885759570135 -0.31361390754583451 -0.10478668424676998 -0.26851202950221154 -0.33642591905816355;-0.12935089497831365 0.72518898168063439 -1.3248285226055281 -0.19253367682537054 -0.057416638419677285 -0.75155553631751415 -0.96725556710091898 -0.74091119576880871 0.61933758869718092 -0.99729817983671698 0.85286380521138938 -0.34254093202543201 -0.38154482035082882 0.76831777184775618 0.68171811565458318;-0.5046575879517381 -0.52088949140910989 -0.19082072456735583 -0.76401256039379273 0.99538083101226094 -0.49025529573080356 1.9150006820427736 -1.591347297424752 -0.56527919684216643 0.33267809353817523 0.12571770949610714 -0.045290953948288533 0.66633937398544107 -0.3957201763824828 0.45729451329659665];

% Layer 3
b3 = 0.67673930502658997;
LW3_2 = [-1.0912075547279458 0.56579358839295535 -1.0373994371132496 -0.7149737767442228 -0.41213246567022521 -1.4561065532986877 0.60792093633219035 0.57685385182380322 -1.1346742537037688 2.8067090219374382 0.30537970172175705 -1.5544066369571909 -0.71565538075493063 -0.40409394294934176 -0.51856192699627857];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
