function [Y,Xf,Af] = O3miravalle22(X,~,~)
%O3MIRAVALLE22 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:43.
% 
% [Y] = O3miravalle22(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.304971027752364;2.48447204968944;0.056980056980057;0.0063552589768033;15.3846153846154];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.7740592101052077;1.1452536148926904;-1.5530876774590969;1.1626077653651601;0.55068621980624344;-0.87511806197757269;-0.32077020340948237;0.079906582526371617;1.2039431440234973;-0.82936633490930367;-1.1722847250545521;1.9292064164826983;-2.8544766848289829;2.0870687358974869];
  IW1_1 = [-1.1665710051136968 0.032587305607769235 0.070369934909495419 0.64100079319818504 0.37114371269839053 0.62104969641335361 1.0684922657462439;-0.10562864610834938 -0.30056587065593721 1.0909413402805255 -1.4566946975799004 -0.46589330344065027 -0.49971673722093818 0.43329152635741641;2.5237568932769303 0.79358335720411732 -1.2121994150745519 0.3160438897496971 0.30027540184402135 -0.51996042551712196 0.76417122673093174;-1.0778256237770818 0.33131823049611991 -0.49204391775706297 -1.0319070957327938 -0.8203565266391516 0.81751133846107371 -0.26043179935686367;-1.237870908064896 1.0168013845557629 1.2013249532418075 -0.6129401679186911 -1.9764765568530094 -0.37327318107701946 -2.3742393014413241;1.266015363095256 -1.8070945497096689 0.47154781754116459 -0.54870824554687025 -0.14604736447922353 -0.21943416197214693 -0.56759928653964875;-2.3088224380715383 -1.7280987129888579 0.38116228125890594 0.8695536395479132 0.79297207147142379 -0.34695396989365063 -0.58505802409818508;2.2757743803776007 0.64302512404269319 0.22189929639236308 1.0252185800163338 0.85818108445815289 0.10391457027717543 -0.22313699842928184;-2.559904141716784 0.21769560256541048 -0.2092258868396728 -1.1255131161450651 1.443887380535517 0.056206363561293472 0.21905089872242076;-0.78673794541731901 -0.56416397448221378 0.29602972079834028 -1.508652823738426 0.79424312542352482 -0.28709141475944472 -0.62213554215016753;0.056615024408843757 1.3483609111518533 -0.53490102668542483 -0.57377068902417039 -0.19337376781646823 0.17150235107008543 -0.70123728594636014;0.34631181274842721 -0.30914334047051434 -1.1510395266482278 -0.34985174563419102 0.9490313952022239 -0.71784697292880306 -1.0145945050972014;-0.11497718228610496 0.58048111229600152 -0.66526713883055788 -1.3943091379089303 2.034944012142017 0.23346805181913421 -0.71367282126660447;1.1546752291660849 0.55500737470662864 -0.11857717970421808 0.78833259962239255 0.37281319958134868 -0.10366411628785971 1.2245995671534322];
  
  % Layer 2
  b2 = [-1.1623991795907207;1.1444262733174078;-0.9258338142260879;-1.0802960449966612;0.23798014938829687;0.6194842063539383;-0.055199609607478294;-0.25889702946624304;-0.49369318186996508;0.53085675473014415;-1.1450835057752551;-1.1257592977730198;1.2214789774335839;1.8964247330662194];
  LW2_1 = [-0.40732343521273878 -0.1764047588331584 -0.94116428109998995 0.0085625974113132525 0.13801673069455742 -1.0141282164076635 0.42102802577082071 -0.7922014774784274 1.0923846957048631 -0.13655119072517324 -0.6987565157702752 1.0888658689154489 -0.54584004629335725 1.4762322027007726;-0.4099496374963193 -0.33292096064156645 0.56420163388031708 0.63232180471017918 0.64615533222591748 -0.19399645309677177 0.60624837817764377 -0.084039975418705892 0.70556344295763274 -0.096363123135033438 0.97935625710971774 -0.61571632601041892 -0.38564974619572401 1.0696305902511478;0.33477540370613135 -0.011364180713833032 0.38514733812683621 -0.050052028491951242 0.025930773273327594 1.1614826746070572 -0.62092308748633962 -0.37612716187682166 -0.30257951139508177 -0.88605700815996913 -0.5962684258607629 0.65307188365977786 0.84182519793965682 0.36815033747480125;0.8685848779406482 0.47235229542640017 0.40903301012055787 0.058923089038933577 -0.34678108022666987 -0.37417564469571818 -0.3121648969869304 -0.25119424563905879 0.28042233268048117 -0.025778744487627452 -0.34146830761320429 -0.56401068389835396 0.57283217481127213 0.19485057735556555;-0.68894677586088282 -0.053369691862436577 0.12324749285502218 0.42717962901084294 -1.4616512996700386 -0.65077716841694566 0.6719269512488022 -1.52608525855555 0.82816593785821035 -0.24823858276196223 -0.37085713893912742 -0.5180739919685512 0.72757748183756377 -0.20311295526869427;-0.47375021820182944 0.20193879976426465 -1.3036126198783169 0.35707489802812203 -0.78422208593210097 -0.47313985472927805 0.28220045526747023 0.18390836130849025 -0.52760214896654978 0.089671382064008792 -0.051175910245144646 1.0826958403606417 0.97725126831109577 0.71699761917203653;-0.41131430899035432 -1.0515705893754617 1.0889910198760764 -0.52823942757903863 0.1375130779092654 -0.47242990872618257 0.32271440546397662 0.17285339336309882 0.078585797950201458 -0.97328717381155538 -0.70538212046684545 -0.028491663178436148 0.55580342953527928 0.55268649752235877;-0.11058489041204983 -0.11435917278525619 -0.29667677009610738 -0.26454678355205868 0.48189031293912438 -0.21389954891756824 0.52760306728112039 0.59561182723656991 -0.14658001886309241 -0.46887566165701783 0.4218699285259227 0.036105317993911951 -0.4838555519352658 -0.60148496212923086;-0.85549285623490801 1.1974276121129686 -0.27575619004659552 -0.34597449245422901 0.45390334198280907 0.81416318983133595 0.50552695067880782 -0.40286620508572896 1.0654306009124954 -0.54468051454090249 0.73749296638722917 0.38979336851098489 0.20280070147067997 -0.060142166255214846;0.69770118024851302 0.62628403894638818 -1.0579007706020471 0.45442841386839072 0.33716575893724443 1.4641727418265849 -0.40971136425061189 -0.25774837553701052 1.0781946879708943 -0.72419775956040922 -0.96764009503958437 0.29579361880697919 -0.12484528710834106 0.1811454457200444;0.42167942107292572 -0.73849074566768358 0.47455402504219024 -0.89208273526829163 -0.060465468866524638 -0.019646412036914983 0.76248592730846199 1.9057809859671992 0.8266742911717041 0.11006728900136251 -0.06307604739836678 0.46275252856429672 -0.33968602920399887 -0.42206375137545621;-0.32524376849284498 0.92618339263604588 0.0071544690900662098 0.24252305541174299 0.71447474613355844 -0.81987834790055814 0.13395522654016118 0.42470270048359154 0.41296255722352609 0.078713311519076429 0.19742859893511797 0.019057451929999573 -0.093684350547547784 -0.4008684667167321;0.64699343838455126 0.26444090683384275 -1.2689515618681508 -0.56625714922365011 -0.46203086729226572 -0.041410330369720673 0.50870750742029835 0.44885692912477149 -0.26591717797980108 -1.1999595739060545 -0.48076486060462004 -0.8529328384056919 -0.42237296820794246 -0.51833645310750753;0.98894057009940473 0.77805283434716799 -0.62667368991481887 0.13791647854151348 -0.19311919189942064 -0.51438452779604149 0.023728170066289845 1.442596385504836 0.38789296895987307 -0.30906625509706842 0.10466813313715648 -0.43214271193283799 -0.55367724352564784 0.35187819721019059];
  
  % Layer 3
  b3 = 0.95916248415732852;
  LW3_2 = [0.73530551976186187 0.72569223632155866 1.1205355072163816 -0.30048139470517898 0.22708026384864372 -0.59807513987972039 -0.99000895323878357 -0.60685169313461429 -0.5197068974144522 -0.95080955659625144 1.3365090099548764 0.70353487651405577 0.24947146568640088 -0.83563528380682839];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 15.3846153846154;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
