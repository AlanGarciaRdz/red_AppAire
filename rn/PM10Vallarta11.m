function [Y,Xf,Af] = PM10Vallarta11(X,~,~)
%PM10VALLARTA11 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:46.
% 
% [Y] = PM10Vallarta11(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.12820512820513;0.00782778864970646;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.3478389455636393;0.16756214281829201;-4.6733540326245171;-2.8930825260903243;2.4702518127714836;-1.8286575623218086;0.32511370438922937;-0.86835435896759772;0.93325198478011706;2.2871663899330783;2.6049426812328988;1.1512296801195914;1.380644323101534];
IW1_1 = [-1.5979211071306341 -1.4451646222113277 0.41416013843604293 -0.68993855738783838 -0.099889536657620778 -0.35569977477826864 0.99304716583003849 -0.24577597028483794;0.74754994213414117 0.14330451948771028 -0.28818914995031075 -0.51702274078297406 -0.21730711210844528 0.71516309354682084 0.01955355336972784 0.48920573694954017;5.6514124736786044 -0.534061353742599 -0.34399699890424695 0.89237915678731294 0.29307490339391923 0.47364484291340619 -0.0031086335812034703 -0.25404847670408065;-0.39889026846587278 3.0563577537547202 0.64890089401343154 -0.048357760720394022 -0.79131042535032869 1.686054967663366 -0.2187783519160118 -0.099965994130037303;-0.83351129030919113 0.48184432501417923 0.20721587415114501 -0.33088015569443507 0.35323792403270959 1.442619291219831 -0.18861872014721212 0.82585702551237883;0.5737103802335507 1.3580317073960726 0.11888533938304695 -0.089397361737904274 -0.909874816902707 -1.1749175352623986 -0.45369353009498181 -0.075987497067408857;0.64091691142766294 -0.70178700367696134 1.9540421591739736 -2.0989721070900638 -1.2425394065194511 -1.4184904598219046 0.96319645467043746 -1.0015384548354611;1.2032687412483714 -0.55732526497456691 -0.76641630448905151 0.40566648076744583 -1.418207378269702 1.3332761125248886 0.11698864525400991 0.12611274564250657;0.42163797088873656 -1.3412876223161443 0.044144113278689501 0.20476418709836797 1.1808583692288253 -0.93737354214406132 0.25062132499174233 0.25248353834156945;-0.50970301326858303 0.1996715115286572 -0.81661769396099471 1.3007450892095103 1.1574880281727176 2.0163495658412227 0.31323853264222351 -1.275242076780007;-0.75707645447219396 0.44544482673329849 -0.25754022727469972 0.21046805246410016 0.18061565196957588 0.38617205593179604 1.2164911935278753 0.67898597877935385;-1.5647586891879359 -0.063169885204431883 -0.13746505715834451 -0.17465575728330657 1.7576664231817574 1.958090125364645 0.35982722030455933 -0.073360705436956483;-0.89928539123961926 -0.85942518414103852 0.20794246364636745 0.3770786858602912 -1.7877245212705464 -0.55114980050063189 1.0651780271637907 1.9305253780605638];

% Layer 2
b2 = [-2.2523892380479267;-1.9392639918640036;-1.751651939389036;-0.17476204794128392;-1.0378432553464956;-0.046308419207178236;0.0087542375846583892;-0.55450270017296743;-1.2900234466312313;-2.6915805502727919;-1.0300137034292656;0.92433701901084242;-1.8192853102849607];
LW2_1 = [2.3491297990976903 0.99352502654037034 0.12740181092337144 -0.19355936460349576 2.0637619006447867 0.95088243018553531 -0.062104538986395001 -0.2922882783030718 1.9312526292316079 0.88279513175117275 0.80731813683568732 0.23414541332269356 -1.4977254044033015;0.25088474062388399 -1.2779695392172576 -0.19300189631507811 0.50367328614248597 -2.1231374805718484 -1.2977251078594785 1.4339418440866634 0.046783753385438609 -1.6393740162346002 -1.1683686678270697 -0.20880004515322578 -0.96399703470538967 0.5825464005629033;1.3110714100341567 -0.26158963976847804 -0.53688953525701266 0.059362776594690872 -0.036163022379462791 0.89476894537689855 -0.7492163194925312 -0.073083286714539855 0.95699356146877257 -0.66237770608863578 0.53978899510252876 0.64926120896544481 -0.18809738783510263;-1.4715941310894998 1.6623146668568922 -0.10148854036934653 -0.83268434371115208 -0.06132829823427767 0.78368956150580293 0.30422583693725819 -0.57332075001016125 0.98492571985895838 1.0780724354468165 -0.28998147245323241 -0.99491678552144625 0.25860596627679489;4.0315827254437009 2.3189093538563474 1.1940580958283926 0.75008359271449887 0.55271405262245876 0.53464223411693568 0.13631722459689249 -0.42703724653063518 1.6515167656040382 1.3597898702988382 -0.59086940186640691 -1.1086461033407318 -1.6291454603337603;0.12742727471766083 0.56953638213896862 -0.70408990635673474 -0.34882212507538957 -1.934419637349887 -0.26511990354420656 -1.2653736854959157 -0.81519035413615371 -1.2501224750497097 -0.4564014071716298 0.28172625209307933 -0.04619356866753533 0.052909086927493271;0.76468098529818729 -0.4329559538013017 0.71362847495359039 -0.90071566966265959 -1.2679675405576347 -1.795458844791193 0.20511914994869337 0.51494467041975367 -1.7238259437287013 -1.0425033731573576 0.026293133376422147 0.40925726455000605 -0.05294325368651287;-3.752218325102779 -0.17178952497635261 0.71924295572207309 0.35712227216109277 -0.71672431420375715 -3.1431733556431949 -0.13101945239653826 0.15073217737310166 1.6662284818142237 -0.87655514070326723 0.26754619696973181 -2.7914346790042686 -2.2175243099265987;0.42714026602505606 0.73197050485043502 0.64760067296435486 -0.38533987433926775 1.4058534073453959 -0.20373240104213958 0.59099249669990905 -0.59433018245129499 1.1505706458224776 0.68155015081539327 -0.90024871679677354 -1.2829661489415003 0.23733260941007966;-0.96068025990116124 -0.18829262540574035 0.13547545453741391 -1.1981416641304357 -0.53702967042757688 3.1677783030472288 0.92563962423392199 -0.19975610348913975 2.7805977123020944 -0.39374585772418713 1.753405716163559 0.80682430059593935 0.67329820211645031;-2.0613997575654128 -0.8306781846975555 3.4599813281166405 1.4210884362622884 -0.60985537193415407 1.3644983938769595 1.3100064170384802 1.3184088996867878 -1.0246275000784593 -1.3418562508999066 0.38770856794237885 -1.7927574071982768 1.175804751658563;0.56638722678441555 -0.48232607171493863 0.16651907779132988 1.1772384923131647 -1.4169725184992907 -1.5606180695314442 0.40248969114569322 0.90981021047542465 -0.80843298193820279 -1.0725723496004727 0.68185979323291379 -1.193843014350852 -1.0146851004496187;-1.0782261544179412 -0.29454665482557896 -0.62370386183761539 0.10611867585160592 0.2291821233570025 0.26027944087527044 0.25326183524099544 0.52963259376094929 -0.30335778687932752 0.17492553866507163 1.4960782014720022 0.91584999271931011 -0.08823028471669811];

% Layer 3
b3 = -0.77588899191697214;
LW3_2 = [-0.66018041836956853 -0.74656182730413967 -0.85931222888550185 -0.96579443806636001 0.37347206669486827 0.7532602734030327 -0.3708234106555125 0.23625347714341619 1.2359155384801335 0.28013453996922077 -0.25844299026713063 0.40122694389938135 1.0633477663814264];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
