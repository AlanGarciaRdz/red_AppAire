function [Y,Xf,Af] = SOXVallarta2(X,~,~)
%SOXVALLARTA2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:30:03.
% 
% [Y] = SOXVallarta2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;10.4712041884817;0.00782778864970646;0.0208333333333333;24.390243902439;0.02710027100271;0.00630517023959647;90.9090909090909];
x1_step1_ymin = -1;

% Layer 1
b1 = [-3.1502088802962813;1.1766284613339946;-1.9590105055539522;3.7397025956043755;-1.5041187404257301;0.018960411225307106;0.012709468573416677;0.033531763896648401;2.7179710660225029;-0.23661494414279247;-1.3604328820015752;1.939220256230048;-4.703678808681377;3.4093702283654479];
IW1_1 = [1.1927025584495681 0.17785495998638057 -1.0303295252348617 -0.32926519691956813 -0.2231747319586003 -0.06550056151981791 0.536943028911543 0.77325241105894127 -0.50960646579628754 -1.0138110410356524;0.83362974537575363 1.1339939105354928 -0.41559090987829916 0.5483321376262289 -0.055820940597080794 0.10906105040124173 -1.4420024973916354 -0.026390073347215964 -0.018767685295097564 1.8691278203786457;3.0970055046514586 1.7447254622148565 0.57086397340678097 -0.080877427429313142 1.6604148615005225 -0.19683550363254856 -0.73985617355442157 -0.17515112563606991 0.54398769739370578 0.66597441842355143;-3.6240016420939467 0.523292480580129 -0.65419306258736332 0.52987263936191953 0.54802393170305042 0.64700607241289598 -0.33513893787617549 1.5235870257693027 -0.0057704742703973211 1.1358144410223063;1.7061611127649594 -0.18193833779891516 -0.11686165944459237 0.95027823305517412 -1.0527435721761098 0.14540377228427109 0.65223283191476178 0.2517893329134967 0.41548464323167517 0.55576679622776382;-0.22269073048779212 1.9285861421849355 1.1345950657830091 3.169632110847568 -3.1083819599861635 2.4509759982234889 0.38513120584776678 2.4861594942921554 -1.1362184865617513 -3.1655276908477363;2.4333383442189276 -0.17849244041071446 2.4369895251468674 0.77362107687680992 -2.672677631925426 0.4834826774902663 -0.38002334386537284 1.7009998102378447 0.41509588657900404 0.0064659140444106554;2.2078185996137569 1.5272774394585815 0.89593024855507308 -1.868576531817465 3.2654628375908432 0.15301802519518559 -0.8761965260295238 -1.228052982605556 -0.67907747338376834 -1.6983505078207159;-0.016844028328375359 0.032238095267142261 2.9965983564648422 -0.014841201330825234 0.10615855111264767 0.1153704909192072 -0.60115151722690441 0.0044266694675518733 -0.073281934773287913 -0.11042419663379398;3.3493290713947852 -0.16027084860649557 -2.5207914553718695 0.18658115453819099 -1.1034721963390555 0.66335211002399974 1.379521168005994 1.0633747468335504 0.12340861048810416 0.70857824487615273;-2.3307686804750625 -0.1086313623863176 -0.071911396731337812 -0.1394902819808411 -1.0570965924308442 0.81559442362566592 -0.8505005383725055 -0.52398729678602562 0.30681572114938954 1.1102759822826127;-0.065754385278989788 0.19642512610860921 -1.1529614798225458 -1.1723109419423547 -0.66447829624256838 0.43294835330256426 -0.70608657922948159 0.49868877660524463 -0.44529817476887529 -0.4280831174391006;-1.5466089269738637 -0.26506179953919112 0.26094638760541755 -0.47708150493568047 -0.05078106633443312 -0.0025819654613786439 -1.8441095031742725 -0.82953790234541214 -0.034499544671286936 -0.60893592346863612;10.50361733524678 0.12868280022162981 -1.9123939491772317 -0.78105283604032638 0.35926489495305325 -1.7760915436023688 -1.8013952992038522 -1.3426663284638023 -0.14675761680890667 7.8202711346917129];

% Layer 2
b2 = [-1.6709867558501259;1.9470014555511914;1.4608380637289862;0.50751794729858724;0.7947019628243791;0.95393076592919412;-0.17040370285956669;-0.23408014238493158;-0.26026847385848817;-2.8567897956043113;-2.2146434723938837;1.3829641407313265;1.5085590690744097;1.8298529265057846];
LW2_1 = [0.50307577613715082 -0.23104745028599136 -0.11188679659220792 1.3840627132555527 -0.88464240334898314 0.037126799696248873 -0.095699094928295952 -0.066195191812200752 -1.611989102912452 -1.1027696383942871 0.40080203277138571 0.11215804929156242 0.48993062834881662 -0.48182759052406093;-0.35642690409011285 0.19098916888892656 -0.17875394676431777 -2.8154802544323614 -0.08182812903494685 0.32044183703616497 -0.021498820976233488 0.21620845305866299 0.89915272421025649 0.76890212345546272 -0.11810194486112857 -0.09336772321808319 -0.014197460272524373 1.0566409981171032;0.38437277741708953 0.25925803190977198 0.22409248552365563 -0.063427145615866085 0.30150411549429235 0.025321454011053807 -0.16344902843242273 0.077358314516357718 1.6529127717762337 1.4284867087404789 -0.38040084936150054 -0.53166768262163089 -0.50209551627141458 0.60249140854790639;-1.3751040533205876 -1.2986793451874588 0.049205799117470722 -0.1586387618157441 0.67192155530517261 0.44614760922204383 0.013019906469400513 -0.19114775466139622 0.80650295350682322 -0.92727814560957267 -0.59382756417428995 -0.032995003609044005 -2.8771799872219592 -0.13227801801782807;-1.1143136261813151 0.34397555813388297 0.072669953985966457 0.22905306507301021 -0.35624367742929758 0.3700176666093648 -0.011799056773305436 -0.47676628584812097 0.6667945898246036 -0.46185463583416581 -0.15183908456611389 0.024536864245857014 -0.31044066798609377 -0.43966943020905824;1.6250991442593015 0.40804061617751702 -1.1246585322583684 1.1055865206761213 -0.73050539959925542 0.080787596490846922 -0.54346183097963341 -1.6216411232903154 -0.40922225576092131 -1.405416201056817 0.52756089175105447 0.39237456269335286 -0.89438230666957863 1.2951482233617453;0.076870697292646437 -0.066688087755693487 0.0089386750335415897 1.721903868388283 0.3877585359317936 -0.50291531972948478 0.16663088495240697 -0.2541031275189653 -0.43713393453667493 -0.63868986882450707 -0.059252942786757322 -0.77368087190396284 0.077576424526012933 -1.2193278446192346;0.32087793008637178 -0.12224747067108742 -0.1036091341881866 0.23244455900770783 0.040190580244206048 0.85900411640582985 -0.89313893790002852 0.29424857331956356 -0.69213142700746422 0.59065471000270386 0.33848873429738552 0.040949555936035296 0.28285528767621537 1.5215337957631536;1.6222070795510641 0.15780256801012046 -0.12848573393586693 0.064189202532711737 0.63542948575339697 -0.37261974165166101 -0.064852693527714222 -0.19110031664034913 0.64886676485945938 -0.1138750270121925 -0.3588210942921834 -0.37138666337636816 -0.19395803238305487 -0.11888282978636301;1.2492710470484654 -1.816624165546316 -2.0451690839789283 3.8901136830619403 1.3171922959377966 -0.71765014302162267 6.5334380382690327 3.9322746342122739 -1.3890499091046584 4.899887663471783 -4.4021779391213922 -3.9105421375271416 3.2321887607141098 -7.1324638352976519;0.65034240482824124 -0.36939648998849495 -0.57879633446056766 0.81222041787883092 0.57220317383783981 0.15309310141408972 2.9842582723419033 0.81652970287171511 0.68204538989394525 1.8522992911381664 -2.4141852963771329 -1.3649819916480597 1.4960616392518828 -3.819744922064265;1.1404813130458389 0.18575643206520129 -0.8141253315907806 0.73237475707013266 -0.2524467907268706 -0.12949930994145914 -0.57461349344902479 -0.016428042338922647 -1.1072824590919894 -1.130693344203529 0.54939384472912411 -0.66886426052396541 -0.31784137239468924 1.4142570776090315;1.0207432532754424 -1.4208083079243834 0.48888525500814223 -1.0541139398688446 -0.95976206810551812 0.4663431283687513 0.19990370515832778 -0.31891786410552547 0.96417333532638039 -0.93746564981470648 -0.67238664495729072 0.60356210784176534 -3.0682396134617487 -0.2148192562735507;0.041456104885661274 -0.14572214526977831 0.0030843412996352602 0.084040499368657692 -0.38678901892656781 0.65934004942334246 -0.72134551488050513 0.15567379377622909 -1.1912667494084392 0.27999982711012639 0.53707963147516025 -0.0005331087495103401 0.76824038271789108 0.30231621403655878];

% Layer 3
b3 = 0.66229188480610213;
LW3_2 = [1.5046521260427765 2.3165332769542606 1.0200271772935376 -2.7523817462449238 -0.68795223478305523 0.16930015539583021 2.2072583795013805 0.37777715911499732 -1.7488482999335926 2.2744956232322906 -1.8238461899928058 -0.14337869322485472 0.94597235627498744 -0.46473758195576925];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
