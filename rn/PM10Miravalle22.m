function [Y,Xf,Af] = PM10Miravalle22(X,~,~)
%PM10MIRAVALLE22 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:20.
% 
% [Y] = PM10Miravalle22(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [6.7437147782472566;-0.8342079625047375;-0.92677791228069628;-1.5971316553882779;0.1812677007523249;-0.40258242531163185;-0.61660324184814597;1.4940514575754111;-1.7066577308572317;1.1810083273230731;-0.21432486661244707;0.20861328153187958];
IW1_1 = [-0.83175454833223428 0.1394659898612591 0.58172125858998103 4.7081929080826761 2.0899443762953274 -0.73052656373914959;-0.16560431361613556 -1.0346371107666634 -1.4698203757532837 -0.63553338524143632 -1.3286763707933409 -0.97394618523374765;0.77883349094197507 -0.41840492477065966 0.11157377885617513 -0.5034543785030795 -0.17658630481936713 -0.27730690404885622;0.18849217313246031 -0.34275194289587824 -1.088360503997575 0.40171925345526582 1.0324628772177626 -0.12844034287320166;0.20907384509082136 -1.4561446026187816 -0.14633807362017609 0.097319845178595821 0.71642255352680406 0.44283814061024618;-2.4690991710946704 -0.079349190240991213 -0.91888891885348822 0.55667874629486325 1.3409231765003291 -0.14568961736946162;0.21773090783463284 -1.1201124585587867 -0.10942216653364301 0.14346015602883525 0.31685200016587428 -0.79359796936585292;2.3897445914294178 0.64679510417199748 0.07775660507394562 0.94657475615592679 1.3938729378463039 0.43639243139624584;-1.3313591106723011 -0.32709038570199184 0.78352711316128565 -0.034314356466292967 1.3789605125537605 0.48607821118076633;0.2325990302529479 -1.7567735784041771 0.56362377264842489 0.08960107313325813 0.25691992679544989 0.37843949289793199;-0.68090113563351184 0.80091147278728214 1.6400559122032443 0.31917236627286855 0.59956293435333996 0.48922940150806166;0.52751545315659987 -0.17377252547280431 1.0591502277232048 -0.14304244616787148 -0.66816368030381645 -0.84663139458049796];

% Layer 2
b2 = [-1.20687150064497;3.9693060063282615;-2.2478153421795626;5.1610267454416165;1.8263266948591945;-0.45420528677612376;5.8372064876205272;0.48150420308345182;-1.8198308532495753;-0.28510559016463843;-1.3365374415219753;-2.7604286297753537];
LW2_1 = [-1.6956148696046789 0.66829016613807157 -4.0304942760287297 -4.2840749709300416 0.21972341552401137 -5.2854200458239671 1.7207402953774529 -4.2354111517522712 2.4866928480278601 0.97655430058732329 -1.4735736521508829 2.0317392605528282;-3.2837129770781543 -1.0226976185910237 2.200258087547919 -3.8560544537975718 -2.0223532516613272 -0.63739228966142136 1.6726868014766274 -0.31449895367928959 1.5878409890116694 2.1080322747898212 0.11879982350142838 -2.4324551650524695;1.876477503135497 -1.69003072551833 -3.4019663730742775 -2.2415814531664151 2.8363831785066793 0.51524126964100914 1.9238714430471591 -2.0376137372853305 0.72681583667476657 -1.4543191110197293 -0.9126790004282771 0.37182817661122691;-2.1279969851071798 -0.14770037786005524 0.91583956401810873 2.1932239644334963 -4.7029819826390247 0.71572765645339698 0.57928428191412751 -0.73080453201917595 -0.41006388901772128 5.2710861880682582 -0.8937748669203891 -1.0356575573493101;-2.1225957272595863 -1.2225377521891587 -1.2099452827848614 0.70813591654397567 -2.5419413545667373 -0.30075369886654357 0.47453142816777222 1.6134533432604232 3.108811552380828 -0.83909763442575613 -1.1721009279980716 -1.8612240971226834;1.8575726241919586 -1.0786721529637844 2.1384026436883019 -0.12386703115211672 -0.60674642192829775 0.93271189105829877 -0.0197954165107323 0.11587538950102708 -0.46175275763739321 0.65550596679812889 -1.0040704192936893 0.46016696864693984;-5.9402050692537802 -1.8281551135948915 1.9396739135466807 -0.93964708646911121 -0.76345550035640675 2.1125571395769085 -2.4127397611951227 -0.72255061398601927 1.1805194769459644 4.9116360973364275 -2.4658809934979375 -0.21240605444291463;-0.44769168527385739 2.7425633768838988 -6.1204876161905055 -0.44098186661407252 1.7003986976229346 7.0415296906425358 -2.9734995574195779 3.2560681849861708 2.4116281162170661 -1.2961137825740496 1.9209503662685163 1.3657290636859398;-4.6882338379134483 -0.7474995528616093 -5.9106500524645602 -2.0801822853071066 3.765960681446983 -0.39188359610000884 2.2452961494086843 -1.1212947182551749 -3.2983615228380589 -2.3634032675687697 -0.50776326100984337 0.90196269890773595;-2.3002393016211258 -0.2698003949643285 0.46637034382634213 3.954729150106052 0.89469636562516963 1.5916104935430591 0.087599015201573843 1.3402488860271176 -2.5887796271901786 -1.5181703985021626 -2.4517454575957411 1.0583199289386465;-4.8185571186875169 -0.18228507975085256 -5.1937653156870169 -1.8531240164039862 0.19377829531358132 -0.27394976215974176 -1.3910317029908612 1.1317630242185504 1.684460825008657 -0.79951446695596518 0.17271552029132736 1.2682507714177034;-2.9918722992957538 -1.8989899828998917 -1.9084380775777847 -3.7204942423730292 0.17690023249055425 3.8563466670940514 0.070685044510438111 -5.2949779044644005 3.179966011384578 -1.3707991005293547 0.61612114240267668 -2.8469477613784044];

% Layer 3
b3 = -0.24140191456933624;
LW3_2 = [-0.0066822068835453432 0.23538589339533703 0.19732077274466445 -0.53610340709707638 -0.10117754822999117 -0.40319760756038237 -0.094426143426509873 0.025255319463193322 -0.23844221329461779 0.14242387100423323 -0.19675634746669701 -0.095164188456829016];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
