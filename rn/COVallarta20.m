function [Y,Xf,Af] = COVallarta20(X,~,~)
%COVALLARTA20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:23.
% 
% [Y] = COVallarta20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206;0.201288244766506;0.281968137600451;0.290275761973875;0.304971027752364;0.100381449508131;0.172786177105832;0.171659085057077];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.9482634083314858;1.9684544383617946;-1.4417980430332795;2.2722795596886844;0.75530589823874494;1.5948320192800445;2.0699160765431075;-0.21906835547480985;-0.87338451604492195;-0.27362521494882192;0.2891881242706853;0.25452987885638317;1.6363246831282918;-0.96267868448529437;3.1650407521343453];
IW1_1 = [-0.55114091611532912 -0.41896492077677477 0.21529249603013631 0.086292624614333069 -1.0092531023476621 -0.70167289688486734 -5.0264985075204952e-05 0.1281871803916389 -0.55382837026345699 0.032739222449495384 -0.35755574449060096 -0.37389501170498785 -0.32840887399954238 -0.25429841345475279 -0.33473133328954624;-0.5913000862961687 0.41898041348027637 0.13727765109214379 -0.16247343652381324 2.0492434781604758 0.69027199217432644 -2.0664971197919151 -0.63340708987484406 1.5959212050405003 -0.57867451199382769 0.11158983122842508 0.10119086480179523 -0.0021777971784620563 -0.77692866855161025 0.7195235665912022;-0.81479066847599491 0.75624853854108365 -0.33188473096318205 1.0977215575498296 -0.68928516637817661 0.8162151734340195 -0.76864924869577045 0.073932062587070024 0.77172872795683556 0.21867194336624737 -0.36364958405566705 -0.14557535529833529 -1.3302783165440588 -0.26461558166251453 -0.88515535246872368;-0.19711634195620137 0.14653651847023363 -0.4324573986474079 0.43316219008548607 -0.97718563355487165 1.2181129734968106 0.090604567742039788 -0.14927597602892284 1.784943416799873 0.37458631643415341 0.6831569038427957 0.1328022141956107 -0.70738156383533246 0.085518101749054609 0.28682080825894729;-1.5102295753157962 -0.77038922917848551 -0.17223417917994555 0.020086452309758401 -0.68016718974385926 0.43840280035350182 -0.086584037242219108 0.097937471042145147 -0.34482588031276706 -0.60125801122793843 0.068178912026441732 0.41090336814376799 0.78859908616537844 -0.57245333310063273 0.92718057284372424;-1.206462381058985 -0.29091737973298759 0.54647603925388633 -0.54518900691983851 2.6629092025975396 0.47597670375572204 0.35013929089910506 0.59976602285453129 -1.3681370540323796 -0.4310479238499495 -0.70782580392842454 -0.11838944872672189 0.37810225642209 0.42829980197402506 0.27993639819845817;-1.766353984316448 -0.24455502463757817 0.38015667583349483 0.17063390574884443 -1.8482172944812885 1.0832545573540682 -0.13865823776679426 -0.36346856079109968 -0.045272642863518772 0.037678354097468378 0.51707694591941789 0.26622396863937198 0.64649928851772709 -0.90041964160531462 0.50526046934911828;-0.067632882444122647 -0.6817693088111253 -0.31956794054631738 0.34270663627010195 0.16281623403898737 0.75356618126051167 -0.52924626801736274 0.33763705054920862 0.061824847853574436 -0.47239144510967762 -0.41021723248193764 0.22179248090191217 0.4707269509359161 -1.0916711155580552 0.9316109450028055;0.61882035698567173 -0.4285711566929008 0.028309111010001442 -0.579556157224137 1.1634417160860229 -1.6414786024818524 0.8238645218700783 -0.48288003502382681 0.9181375299413469 0.51545652492322924 -0.26150337456751876 1.1052847081267776 0.84496817866985219 -0.14169512834990075 0.068777337321057577;-1.4400980945547437 -0.19416202148899897 -0.17484604303268436 -0.19957328142738154 -1.1265136161637914 -0.38395163679518562 0.03936555293473197 0.40459153473168585 0.0069548335864239169 -0.028299288666454859 0.091853838932177745 0.55978189337074202 0.20173555205357088 0.85957306978812964 0.35761981001257248;-0.22571887351343289 -4.1270405354160884 -0.088316914796271226 0.57565910242313734 -1.116765850961521 0.55528263873186579 -0.061754054952843605 -0.19642340091939967 0.81742909938318176 0.18157227933183379 -0.042155190693898718 -0.3222887600222773 -0.11637163401342084 0.59054856682080359 -0.31572934015958121;1.2392672891841747 1.035651584347997 -1.2078598175735284 1.7480439651738655 0.27357282139086558 -1.608431894793835 -0.72844816356017883 0.55114622883780473 0.30822009506833148 0.69990865447903006 -0.73725219348500026 0.23943406675431736 -0.8826880275546074 0.090105135841602679 0.20547996451599046;-0.083237781328057495 -1.7706651150485224 -0.24699891390599932 0.3782141745549234 0.10323371778310687 0.89908914925759453 0.23175230776778902 -0.23207766536807012 0.25204060917290916 0.014504345787731819 -0.088370346111749182 -0.26828323734704035 -0.75354519372170015 -0.32705723195234132 -0.92198506592915808;-0.6255435920108966 -1.3430352442523477 1.1263086622071532 0.47785121585300411 1.0487099460130676 1.2296752230345886 -0.26788192640912445 0.035649661412566147 -0.32333829338858538 -0.21235871124850142 -0.19784992122935607 -0.99520510020952835 -1.8040989794627689 -0.3347673190214453 -0.92841004490665924;2.3130214891753278 0.3759148163489045 -0.34224205000524732 0.33103982461233677 0.10416813078822793 -1.3569708696085307 -0.22218937446261017 0.48474086088688723 0.68059893108551051 0.17928559496726212 0.41475096778377479 0.39567909111458399 0.09633566459127664 0.47907433539153327 0.2736968547752141];

% Layer 2
b2 = [1.951324338787044;1.2747365037838274;-0.94507026675775796;-0.96921058207418942;-1.3734597322010156;-0.81098425264851837;-0.88679285689339649;-0.15860138754315103;0.30597240017862448;-0.56081728344779147;-0.61576768485986733;-0.77698537354033081;1.0300449862223304;1.4699820218566806;1.6776997750482052];
LW2_1 = [-0.1176874699367803 -0.74370781036587774 0.31675646188768203 0.490989567353672 -0.79268905716739757 0.72980791600763362 -1.1181725354693135 0.42067564648766209 -0.24447943725594984 -0.74700799576900512 -0.19567059112168084 -0.22770690520444301 0.24693990573984057 -0.24284060907478733 0.016633874114877004;-0.22649007398985513 -0.14475313479012991 -0.40924000521502141 -0.46512346340946903 -0.13021475974466212 -0.23379550959854267 0.48682143796408472 0.42668974810715948 0.19887912517824896 0.29961960014837147 1.6028920693877611 -0.087828953965159176 -0.5953933185794773 -0.16712903897903217 0.067361743612319724;0.74719495977563244 0.084097888453222414 2.614650297964447 0.70671211865612249 1.8254905659422718 2.5373138684915282 1.2897490001592042 1.2220467779351576 0.69754137657052573 3.0191539076389882 0.4946695633387051 -0.88288136907575565 -0.54069464010341783 -1.5703902089391015 -0.70608845114228058;0.19770426188634171 0.021804773429062625 -0.029678700550643089 -0.096515300283923564 0.0044406929865880712 -1.0112001300095015 0.60322951415765369 0.30075969907457517 1.0673894638401016 -0.085049323936999474 0.51883774768890834 0.026122066738624952 -0.10879625662180541 0.64556210967737948 0.22236327349699786;-0.43558933819264128 0.6165539625211226 -0.30666149505530804 -0.44371152925115359 0.33706741142648916 0.051638185458344976 0.057226404229581911 -0.31690540854400218 0.23246482805015789 0.15511731828083872 -0.77005819633673733 0.031032948641108241 0.093353262078647387 0.98861171142199622 -0.30018180345226547;0.073783804165069355 -0.040576228350521451 -0.44262794981411879 -0.4866179065648838 0.64528774741843042 -0.5539934462371956 0.28725511426888684 0.030840430431140119 1.4888464877163978 1.1881542131531662 -0.057321942885418115 0.22837633691377263 -0.4713818616599571 0.45721909243449171 -0.88392523296899128;-0.57383498933494259 0.70060926935345369 -0.14158094077285743 -0.73538737637192197 0.34471665488903236 -1.1691307273882305 -0.29337270162670204 0.10129363855239801 0.040621814588161193 0.86691537860879631 0.6004790902288456 -0.068016073858481241 0.41418656032121803 0.24676786641382226 0.48496340629643381;-0.46725647316467056 -0.1639371991586788 0.99056111324746199 0.021644381242923859 0.79283852013952993 0.052127060457703454 0.10621903851119818 -0.040421400109998382 0.37210289691617493 -0.79681845168222143 -1.3561579093787 -0.43842553464324024 -1.0204699358802187 -0.44873158036031852 0.68928136603609047;0.51804494341015472 0.4820348669743561 0.087372783166491691 0.10314051376628305 -0.15707409342915091 0.2065122401038561 1.1851755554891179 0.68910515841087483 -1.7338546474066268 1.0659072143882522 -0.033349585570325441 -0.30688591917759689 0.64888693062003733 -0.89167570944270991 -1.624216956245226;-0.28670717323155631 0.002371454300178065 0.41141167691326552 0.08880381824160509 0.29138179523589947 0.34062582792023999 0.867098252763147 -0.01292925276920176 -0.65253349799531002 -0.5225610597907443 0.37330144964710216 -0.09864476519313832 -0.36810987037192922 -0.54704486352906589 0.41655454188017266;-0.38549946463985552 -0.47616364369113129 0.51457281114390896 0.24763147065121102 -0.9961683138772881 0.49987580143505178 0.64162556521861458 0.44757900766907072 -0.91788444811596093 -0.63438756184192635 0.046863632459436588 -0.37869584243509768 0.42257219528551565 -0.67134375206939312 0.2725042897380448;-0.14626641869217932 -0.119504629546275 0.48892614189045946 -1.7630743008212963 1.3090274597417972 0.52302314331445798 -0.13317327179565241 -0.36228100303937544 0.44923894168867129 0.11660681087797875 1.1674484183609835 -0.24329460605605197 0.35685703955538145 0.87502482036352047 1.0792600252708293;-0.064178272414086426 -0.043502073071374325 0.4077184617834117 -0.95834842485619309 -0.62741452492552319 -1.8833374709531145 -0.50988254577199654 0.46748992329021533 0.43893823044107905 0.83082449438389716 -0.54601577610217522 -0.46268752434779831 -0.71303783420308919 0.82346215276487911 -0.84426850503168027;0.50517303193674534 0.40798959007638103 0.38203060825503565 -0.0045595433488609255 -0.3496534231592765 0.29081222374558235 -0.3098192964588582 -0.94203877369274058 0.47895539741113474 -0.0044302033301448634 0.86844863383297222 0.50432625042501389 0.31128737701265902 -0.52881740303148217 0.080329631105573965;0.29672802072615689 -0.84063484538218669 -0.3626975641929126 0.75066214417982224 0.57669098806835772 0.24064840385762434 0.045901264638313705 0.15977308181267377 -0.44004310724775042 -0.42339731375169504 -0.71130509436374356 0.28634109180963357 0.60343370307336275 -0.87559209907525037 -0.39999606137746435];

% Layer 3
b3 = 0.16370093655718662;
LW3_2 = [1.2840771637953605 -0.77871161740083961 -0.1290708076161764 -0.43652635080560565 -0.88822138148208707 1.1812097789065699 0.54382336922490759 -0.84080202781722546 -0.89429451052922826 1.8654436206658818 -1.3277767629725803 -0.22388351565012057 1.2862144231864678 -0.94233054061217103 0.73550888679063797];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
