function [Y,Xf,Af] = COSantaFe18(X,~,~)
%COSANTAFE18 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:09.
% 
% [Y] = COSantaFe18(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;10.752688172043;0.00341273633199099;27.7777777777778;0.00632111251580278;0.294117647058824;0.448430493273543;166.666666666667;95.2380952380952];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.4791120039247807;-2.3786452393833888;-1.2635189843075696;-2.2314521863296735;-0.74565243837331407;2.3907108142597258;0.62471958332383792;1.6560181591784393;0.71349773839153663;1.4827490678845716;0.035737772810062893;0.06093390261923734;-0.75131438239843162;-1.7168362222306741;2.5456390949397592];
IW1_1 = [1.2065231663377622 2.6219633909267057 -0.31506885019679898 -0.41876282637572182 -0.42825928668508406 -0.64114486049508657 1.18699249214575 -0.64472401642087696 0.68735871071040588 1.1223447950955801 0.30182047588862621 -0.34707292587426386;0.14140594816746915 0.73961765014690484 -0.27304435759284679 -0.43247513265142412 0.18206178571908707 -1.3816913194834113 1.8294384203302125 -0.39078619347235116 -0.33242261349791963 -1.1847678186096555 -0.25931731966533833 -0.031479689156758722;0.08511633005765866 4.1379945280125723 -0.84130912888965448 0.2081815894017143 -0.44983689156673928 -0.023531428644838703 0.66774833773243802 0.019308920860599033 0.2256821858498721 0.34774999883155516 -0.34768235426729477 0.11190184587977819;2.2197419569873649 -0.10504582779336835 -0.53944977417191198 -1.0114740942878802 0.30332723870887224 -0.18979748353810619 -0.81802343504767316 0.5254917582688502 0.041963574877459511 -0.022999224188142438 0.14864755323145032 0.0029704036961373907;1.5575294862256075 -0.67792657410998658 -0.29320468032648173 0.98412268782595869 0.22304856433976555 0.22569772196997295 0.42448454039987615 0.20774951873309649 0.84537885893692633 0.37157367090406096 0.0042856155445749333 0.46368985838574195;-3.2736300062186872 -0.65631038677548725 1.5028646146583531 -0.16060365936284327 -0.41099941917981575 -0.12654011212873978 0.066172048443432815 -0.48005312538102574 0.17355454339851015 -0.065858709153416448 0.044995721481685326 -1.3961810652691975;0.87647238764833646 -0.26400615216488688 0.48710078086703518 -0.30067232334164201 0.42258502254306057 0.069871165937722093 -0.86853508778744948 -0.32683125406706981 -0.036600905249071981 1.2252311014567123 -0.2723257544984089 -0.433976931815797;-0.62741667502987086 0.86298668987023963 0.8310148876915826 -0.42448631479612159 0.42680711246283748 -0.27337032369886816 0.95267245792560984 0.26132213929745957 -1.5433925630998404 1.5328943876406591 0.18313209432054986 0.342736486373723;-1.3739837715396119 0.39310612870350536 -0.86040599526848682 0.54650209985356801 -0.62925613354038379 0.38605711706054302 0.79939166947722895 0.26870335702659132 0.3582087134103456 0.25743958789406302 -0.11606267992816222 0.37754471082728286;0.3607285993690279 0.46686018499086546 1.749874501856749 0.49167327121568738 -0.21958628001243155 -0.5768611425746345 0.251522291795376 0.55306467835308348 -1.3788395524783996 -0.013400013358827406 0.50985902730798516 0.4595584013600571;-0.419901321079865 -1.6145761168787904 0.73901387549605424 -0.14211895901152913 0.24412260950763079 -0.01421525914095205 0.099423509440795879 -0.24725273233440692 -0.38297955596909905 0.50420369500556295 -0.13024304750733492 -0.74576565163133968;0.29733556621879392 -4.5188960860296223 -0.55820451124432346 -0.24445638034168074 -0.12596456830163394 -0.41330643190114008 0.6656344095499257 0.048270401911365696 -0.11654202311603158 0.14030412555195468 -0.29574867248795805 -0.0030775599089952477;-0.41907739034441305 -2.0081378724407282 0.53225949576701714 -0.76490448662399146 -1.3867077513553603 -0.6261777096536767 1.1494854962778494 -0.46776792038024523 0.1667774075781957 0.37512302785300389 -0.11947521119675274 0.71587432657419403;-1.66364148602793 2.0096689788407249 -0.22438188014743379 -0.37050783079638994 0.51228697687397029 0.72243660471169413 0.21520420042950184 0.26110931575326607 -0.47243047989489395 -1.0337331435635495 -0.1313725375965436 0.64034903888263006;-0.29765003364401971 -0.10703499679850745 -1.2242415101175468 1.0616709905619894 -0.54485848118016378 0.1780220810190917 -0.3061576019618687 0.1792392939952927 0.74453424100744803 2.271981175266292 0.45680232680154348 -0.081681097362031524];

% Layer 2
b2 = [-2.6760365339601013;1.5795074244127485;-1.7173005626733138;1.4049986589043049;0.73833386271723167;-0.92671065894634486;-0.16368818858037404;-0.6982141071460628;0.81734460371035045;2.4155697228301385;0.8539187749227467;0.91543318281174124;1.6657229745835109;1.3417699460782939;2.8957623144066282];
LW2_1 = [0.64857591669491288 -0.50056421162135789 -1.2150452472375819 0.76497049404918493 0.70456344268072191 -1.3456954361288238 0.55908879875407247 -0.871838717264936 -1.1033816290610325 0.82876637306137679 -1.0437805208112387 0.14591488811221864 1.003342737833919 0.63175753756027475 0.1514153810156571;-0.25741980457869745 0.84144136915642842 0.70727875798498052 0.51384542653694287 -0.22878255917241264 0.42922015217370768 0.93777553439977646 -0.53695042237208179 -0.26790964570136694 0.59686145024254911 0.044904692905705867 1.093466478206756 -0.26364959193840914 0.52391161666931563 0.37606129148375345;-0.077334579873609657 -0.13236177590785039 0.5307678008642478 -0.15249042446862129 0.55618519595524152 0.59911007669566851 -0.10059927874527372 -1.2263353395488448 -0.25066113090864045 -0.023651617546038187 -1.2413377318396253 0.74121733983043714 0.20390895351488766 -0.66540040936650613 0.291829722894622;-0.56955880779654822 1.4005332496350951 0.34912889689373644 0.15994699079902286 -0.65619965132857394 0.25543232708300001 0.63755446900313861 0.70875131813003245 0.47781111270095733 -0.3777406130583838 -3.0023609825741375 1.9606248761931828 -0.25288482976951876 -1.6365409640747317 0.26666462435776861;-0.21003881126870405 -0.63922260788550578 1.3975800453938674 0.12979799421697702 -0.4728475089008527 -0.091747541307479863 0.46104966494481758 0.14695102111534819 0.24015162083831276 0.11070187372422677 -0.33083977434821743 1.8098502469276398 -0.56950597189096286 0.13144815291360742 -1.0590092217417384;0.10788442472984924 -0.88948880684119391 1.695817182394399 -0.5932296426660868 -0.2769664953677366 -0.034169437637362882 0.62403852951285355 0.74652045039951453 -0.55132386162213376 0.49391944239751323 -0.42337912249544424 1.2369057434368607 -0.8572287303840147 0.14228794530436822 -0.069781242964021467;-0.32833640603702097 -0.64071888575942826 1.183808424209932 -1.2716189144661334 1.2355684338416797 -0.9106233565291233 -0.67505283855314158 -1.624654166047651 -2.1108903328620827 0.50119938590057289 -0.35104708280496461 0.025261553115873445 -0.57766115573204257 0.53208631569182396 0.98558408129688868;-0.071909234611920544 0.5809278784452665 -0.11938747911584811 0.42470766258317849 0.070949888087931845 0.49707842715173012 0.37749549988417919 0.22822916941283103 -0.29600273208000683 -0.12914891360783265 -0.29475123119070307 -1.2182659255701929 0.1029511448003041 0.26618471389571841 0.041351766286711299;0.065686026255319149 0.16988118141892072 -0.54032236336569239 -0.14439960036437013 -0.74384040588796907 -0.20502778713414133 0.013656950315854493 -0.31718419642907753 0.43207539746600643 0.15330719412496671 0.10912895633698762 0.82815286556944134 0.92480557828148924 -0.20016320981163352 0.59493222797465706;0.38701358780478468 0.51819622353144612 0.46381128917098879 -0.62350197690431541 -2.3825678126730909 -0.092920613931108814 0.23689883211076432 -0.75388092537612028 -1.1714163617943021 -0.040216060545307006 -1.6500147417553772 1.7149506560389154 2.3137763919588359 -0.019029385905952913 1.0172610253529879;1.2499579071154516 -1.1634580316743091 1.1142184527859036 -0.5750790956629922 -0.79940446338504501 0.009075237968583727 2.3478688076762313 1.4844200503581868 -0.3129259647817908 0.16032252737150568 0.16288886744761991 1.3673191496194779 -0.063501086272334251 0.30764208952488414 1.9022224530623399;1.2218920496480274 -1.2156084596815899 1.316390835493561 -0.98256063218864298 -0.48887991558890276 0.20910852322606996 1.1977357312883004 0.59121281805793835 -1.5261590135322805 0.51583356668004887 0.54252752396162651 1.4885628496552448 -0.059485238122591412 0.87323501230074341 1.8618842414733112;0.016960709215908948 1.0426404090276493 -0.00887147772449845 1.1402903506443687 0.1419253858083 -0.41663387248484135 1.2828407605506156 -0.74672764153785676 0.27349564450821712 0.6167080989362943 -0.47746281978929983 0.26093698756621392 -0.17373901063436784 0.20277110652930597 1.0367452977948972;0.43543328347155746 -0.49436982131516205 1.3188386817617381 0.096085296680353594 0.3662639412104331 1.992770382264978 0.34664170313303327 0.79060188351031035 0.045220270565661934 -0.038915857160631506 -0.18667854265480591 0.82702820072242411 -0.89879758801966625 0.50239936531634499 -0.63085394301677045;1.0686662050122042 -0.67838396807296786 0.31472746672272606 0.63216821810173951 -0.59279319186357393 -0.26100441576197764 0.51585913666009087 -0.45481144558150993 0.78449105320138324 0.14720028554811412 -0.78208425028242801 1.2896811406223174 -0.21991476836140125 0.6072362570832962 -0.78971952144777047];

% Layer 3
b3 = 0.25773709475621676;
LW3_2 = [-0.79868969177935467 -2.2185352995724466 -0.2581357920532788 2.2617564063313762 1.3325404958875198 -0.16048852260998397 0.26076669420925652 1.201419508318063 1.2438367929718959 -2.4768894404389745 2.7886988296640705 -1.6182900026007156 0.3404679914735606 -0.66352939107360687 -1.4976417847048806];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
