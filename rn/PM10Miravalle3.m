function [Y,Xf,Af] = PM10Miravalle3(X,~,~)
%PM10MIRAVALLE3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:15.
% 
% [Y] = PM10Miravalle3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.4352078453733688;0.95174532072822993;4.2193476445053468;2.2251806553744373;1.50313473882836;0.57603912047422323;-0.41139973341182062;0.035129900205588219;-0.93945216367661766;-0.28941855691803903;2.7748685051893514;0.73546811376407661;-2.1368378193791928];
IW1_1 = [6.8066828923687384 -5.336435527056155 2.4328320232943521 -1.0496754866710838 -1.0277366447250886 -1.7263517225581704;-0.28758859169889511 -1.3681225069810057 0.78979387391776046 0.11846882874419774 0.53036971789847775 0.94779701881981337;-0.61414978649504015 1.7165776581095125 3.8731413295791381 0.045702777850004463 -0.24336180678598388 -0.67732459684258495;-1.6989122178278224 2.82702436548285 1.609641088534381 0.036791761650379194 0.042917016568136332 -0.21492178302889373;4.807431005373215 -1.4201139087801116 -0.50676876153683137 -0.79863394160352164 -1.3172740073279228 -0.24586632175419507;-0.40828716307159013 1.4687620171131881 1.325547216426507 -0.2097699060949009 -0.98413445664938215 -1.1847009088110294;-1.3689408400849281 2.2202044152582499 2.1887135259715884 0.62463584158090268 -1.3807473394281131 -0.26640117717714207;-0.93757960559420994 -0.68742851581677245 0.0074462003918099899 0.24865606740595381 -0.84413138524995202 -0.29331931361633434;-0.087951496057805639 0.89721639002013243 -0.090737454175499194 0.23386971462336945 -0.22929768620674382 -1.0469311902121181;0.37908291220340867 -0.95948437146708565 -1.1758522672593603 1.3324652562540191 2.1548479790414006 0.56163838852658854;2.0886968463063855 1.5814617498707679 1.0748513729285232 -0.67845645005865274 -1.6224140000519611 -0.64184956091964762;-0.2634495907953428 -0.44051248408907318 -0.19565324595397585 -0.62715103365117664 -1.8720614151373529 -0.12216592213146721;-0.15235085979409618 0.1673248387519975 -1.3653004587755344 1.454370758358938 2.0691710117752247 -0.38219024939619528];

% Layer 2
b2 = [-0.11661296642994465;4.5122341229007583;3.5018841356373591;-0.2042673941758831;1.1563044494008543;-1.1666126836006072;4.5040023480161366;3.3407020282260862;4.2934308561322192;-0.39583132083662154;1.749607388321933;-7.1742003612543748;4.0241431983255369];
LW2_1 = [-0.5837392386961201 2.1635957069613063 -2.6557699388375187 1.7802762217315879 1.6463446285739332 -3.6131101934126901 5.3954503245280367 -1.2375225206386671 2.9260552068370167 0.7979488433461015 -1.2216035679601212 -1.906568901581239 -1.5707397056040071;0.15268444698619399 0.20652988996196053 0.62968938823838827 -1.6847926857326911 -0.030861724787419192 -1.8210283677293737 -0.68502387341033744 3.0474670719231831 1.6440660544139867 -3.2633376933371911 -1.5825136272096336 -4.5161333411989597 -1.0982414316513542;0.60686126370365912 -3.3412927876348792 -2.2445278578505263 0.89782203253804382 0.059856797811532358 -0.45342693385171101 -2.4227052682771673 5.687284549165958 -1.34237324946639 -4.375218501869778 -1.7855340819116443 -10.528386973123682 -3.1732978872729833;0.10994940945431447 -1.6508534075097565 -6.1457836895093827 2.895633803724734 -4.1258425368118949 5.8908554621961615 -1.1241881098546493 -0.19488673224668809 0.47080046661187147 0.26727449642509854 -0.33489909858356409 0.37033899526632175 -2.9472089830520871;0.1444361002506139 0.87818384273678918 -0.035487498993087244 -0.30929292531106212 -0.67223522446110573 -1.3169496556333571 -0.66801221737391503 0.79332974229693942 2.4646032473434083 -1.3744181944511404 -0.21939953913511948 -1.0507749138614302 -0.2393238417701648;0.45863751795588431 0.5221218963598816 1.0507770383816646 -2.2977969869386459 -2.8838511819949844 -3.1280531664200275 -0.057667980708474433 2.6341393094487118 2.4628099885792167 -2.2924051288898819 0.19320987909866169 1.0559878058242662 1.929975672118813;-0.35548949221777632 -1.7187042690438514 -2.431579198896388 -2.6491026783333309 -2.9501115770853885 -7.3242938392367503 0.87690956457598102 2.7223760380653959 8.7883930102347421 -1.4707403249515925 6.1569173813348383 0.56884181454226457 0.65240496961136651;-0.66289134169286412 1.7842023636117537 4.2885559115545027 -2.7801604270744842 0.60810198790105574 0.78322280314619164 -0.13841874574782381 1.6946972491661936 -0.68921442058990035 0.27278882622465905 -1.1343589467138189 -1.0552799937651325 -0.54672345325890692;-0.99416024293107996 0.44448576153074726 1.6336452221333055 -0.67751804646645586 -1.014141360879905 -3.5414863243467365 0.81631388015671857 6.0316712283650391 4.0049815727384628 0.72894679595303591 1.689983458572254 2.6897512987337961 -1.3227114364906456;0.17960102344024459 -0.30066368126021337 2.1002894044019995 -0.17421811819067165 1.0017491468778048 1.5202844501084214 1.8868699591515943 -2.8617772574604157 -3.891204469126039 -0.31275163806466016 -2.10016629862948 1.710301021880978 2.6525608457765686;-0.59147264342667238 2.841930830707267 1.9276701440258457 -3.6561893045054417 0.34366314064004233 2.4835281611443509 0.31642502983103443 0.61919546737764342 -0.075955705288199477 -0.37837204009709896 -3.4495391178010966 -0.53812408656012845 3.4086498242605385;-0.73402341769463597 0.13949804025868867 -1.3494902423702329 -0.18406337341033518 1.9601869864101733 0.77095657442124488 2.4243539661712328 -0.43240970095426173 -1.1196638803815921 4.880045595950695 2.5503377489191403 3.8399239588342104 -0.5798808899159601;0.10715760019769034 -3.1783636675693714 1.8068648371892462 -5.6478526285868087 7.311588509030905 1.5260004492510648 -2.0915230606142692 0.91044280933646027 -0.62888078177007078 0.10355319088098452 5.323795226369648 4.3215471373031908 2.2024464108789017];

% Layer 3
b3 = 4.9645549835455194;
LW3_2 = [-0.061471174245479515 0.23348369981073394 0.10120369294579468 -0.052137160717257665 -0.63055698003684624 0.12746507879497815 -0.044614183905669395 -6.1540126427127912 0.07254264415689135 -0.15892338065966616 -0.058408337308593496 -0.10944383979264184 -0.043327409306189536];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
