function [Y,Xf,Af] = O3vallarta19(X,~,~)
%O3VALLARTA19 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:55.
% 
% [Y] = O3vallarta19(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.12820512820513;24.390243902439;0.02710027100271;0.141843971631206;10.4712041884817];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-3.9135777200748652;1.3698613260761849;-2.3882160211864831;-0.87228772481067818;-0.69502193877644469;0.78021970194536305;-1.0091035572844758;-0.019278293961183232;0.65571552165798996;0.93006384012341481;-2.2741999061192013;-1.7375653286619055;2.9896728409689448;2.1940877221885762];
  IW1_1 = [-0.0012336702276556019 -5.8557706035805053 2.2854262451857497 -0.045973313837618157 0.75929219629976241 -2.644319665576063 -2.9666734482328212;-2.2041482773560999 0.40319107155227074 -0.083866172209635784 0.24087116282519877 -0.039179446508762185 0.40771162056126875 -0.63472008451855255;0.4926396739072505 0.47853108994499782 0.53689351622275727 -0.075095318911904282 -1.6671385361250939 -0.29919292172448553 -1.3675058154931852;-0.57433361489411539 -0.41195044154536686 0.28614585292529354 0.74774607172710617 -1.5392906838839382 0.47861546977976166 -2.3436062565415834;1.5457231346296147 -0.30631907404490488 0.10137638177496766 0.27317181288438264 -0.59100528900679272 0.075616322810434344 -2.4352480179208098;0.37832484324153159 -0.13208045966615009 -0.32841424952676668 -0.60829045079505795 -0.30491800442032008 -0.24222957150837429 2.4713229154842851;1.8755010898838325 0.52469146608986972 -0.30660838551151681 0.28668092142737661 -0.097961013884178133 0.34112045351689918 -0.60481051050568457;0.14119526250670647 0.36672602785616032 1.0461418273684573 -1.1509663926584912 -1.5996704536609079 -0.74963420632644406 1.7464848523565892;0.10462021856907669 -2.5824865904245531 1.76526934451558 1.6080516493339854 1.10073739452061 -0.29996836093682422 -1.1320417611125906;0.89638400443634969 0.39575451837590503 -0.7628440620505571 -1.0322367897515432 -0.62265805126723306 -0.85563142861189401 -1.1791181295898538;-1.6016324831932021 -0.98670421605905378 -0.90843595541050959 -0.73626176589804393 0.28488458124188087 -0.18825269875066758 -1.2139146017365752;-0.46308399012535689 -0.83548230441707272 0.62770993254298801 1.1511551762492271 0.98112064079590511 0.60509572869867922 0.94711306855454647;0.097677747817795618 -0.35449118833301818 -0.18886946162346949 0.23070826340527656 1.1088111518502741 0.12235090694321621 1.8111669323631918;2.1148410116236378 -0.9176239974223247 -1.2006086328069658 -0.032681060041367407 -1.2889208898724949 0.36951623835845571 0.60233902272796913];
  
  % Layer 2
  b2 = [-1.6243505153689903;-0.8259204351133248;-1.0613299443053641;-0.36065229701401441;-0.2481410746604204;0.95022282895901811;0.065479307775817175;-0.21211520902736505;-0.5177386517681708;0.78630519845003077;1.1926175370670293;0.88313123940506566;-0.65856201707783457;-2.8779771852735219];
  LW2_1 = [0.2478742009452336 -0.51981168973798553 0.65640187927397009 -0.57463104522247577 -0.091785314704748974 -0.34455569553985732 -0.067805045943235109 -0.3757439005007801 -0.70919680347557879 0.72769628376610784 -0.54140049493964726 -0.73498205853646048 -0.657953603359545 0.29920445048747246;-0.30555424722313757 0.66587724527939085 1.7453478527344906 -1.5277243933225193 0.27208592939112752 -2.530121451149407 2.9259834429558476 -0.67909254368355487 1.3543052910796098 1.0480328120160145 1.7694315705017469 0.020309451198373546 -1.2678257952193923 0.081146968327811902;0.47140529652359764 0.96639819973701291 1.471975691766549 -0.20114322956381903 -1.0541315819019503 -1.2400750104390226 0.33073409896945466 0.0074143596440705006 0.15528657894891262 -0.09012588810795126 0.81044358403788808 0.40013823581355434 0.024903976565795797 0.44057114280012988;0.62432701410736657 0.13770369173100844 1.3577717254353381 -0.73033120256903461 -0.81806627865685277 -1.6139334258150257 -0.14116333135518561 0.027832866889880431 0.42495752178394952 -0.12164560462650206 0.68020851715904174 0.096205882124395889 -0.98619114784972606 0.34485489939796066;0.86176879262613837 1.2624891579513786 -1.5731818167752847 -1.268167596349963 0.86949914278842322 1.0544469085833632 1.3782208209130593 -2.8019780205344964 -0.98320841894671973 0.99137897723510648 0.41200660304213937 -0.23961542344894346 0.76004591869267124 -0.09108868467960643;-0.61308228213804883 0.095041174724749003 -1.5177762813224127 0.93637613530560515 0.14206921957144042 1.7584175109302389 -0.18561381071427477 -0.1907626599294911 1.4411448459638423 0.10859726029481663 -0.61326966547910777 -0.4974109677983698 -2.5127860873014778 0.29433668876403779;0.4548983880446108 0.8622207877833219 -0.63463225644580568 -0.47281536543443553 0.36514593259292277 -1.0777362771199051 0.97823624945943477 0.20716209608868505 -0.030444445611120294 -0.43882293333875239 0.10298131691691195 -0.073891153703617457 -0.38929479986778931 -0.4691464621894863;0.34004152547577438 0.92526347105690931 0.31157629527044034 -0.56745246277712547 0.35360654588566587 -0.55943971423555494 -0.25598885027019352 -0.019339565027355864 -0.63834820502580292 -0.41143341747417972 -1.2128804803453872 0.025231577329813716 -0.51597682055231586 0.85190235846665563;-0.24793882940579973 -0.57652450759435891 0.27960953469223754 0.077325970508811098 -0.00542207654645133 0.68361293246293231 1.0140051376597541 0.15502056032728181 0.56265082742290673 0.81766588831074261 0.83863965510549676 0.39491425595169272 0.69123233415313445 0.24617145409426688;-0.50684539502436099 -0.55352056508946279 -0.35927491496261521 1.3415316765191583 0.34159337758951519 2.9496520437592317 -2.7478492841350572 -0.47293960445388517 1.6187256016579015 0.10759744380393638 -1.2427666767723788 -0.71631302906782912 0.41344106883028675 0.6310532550619331;-0.070735325647488911 0.18187712685685842 -1.2109275025318182 0.92900313411135371 -0.38335370967245308 0.82315947199457273 -0.57566937606637836 -0.22268765355283529 1.8226424083731014 1.0159116242260984 -1.1211726651319458 0.18084945849473555 -1.8074049206917899 1.1657389324476897;-0.025930355589698188 0.46834463765367912 -0.41308076462946963 0.34163243723846026 -0.08766669121399312 0.15963830895362097 -0.96045485901970262 -0.11504388614380519 0.80720217117211435 0.34824770319627812 -0.039333532790312091 0.83606141414706425 -0.46268736194319982 0.58521837749269734;-0.81353886102003714 0.053961609626574904 -1.2384371478411207 0.93631677973658212 0.24840602832868774 1.5961768746452905 -0.19119581430992855 0.17016482800592969 1.3140235525362773 1.0374069906877597 -0.095845440835870585 -0.39669107779235341 -1.170582250404818 0.047202547302135162;-0.2096440289430192 1.7006816931185265 -0.33853357565603681 0.4926407896894614 0.096743060329139013 0.3886573855405277 -0.92646772347844075 -0.068842550377634815 -0.14902574531736515 -0.52786439803794372 -0.08153708935597509 0.22796481688337925 0.51895250133153425 -0.65581784563143974];
  
  % Layer 3
  b3 = 1.4250946327360448;
  LW3_2 = [1.5046729031412036 -0.65022379120865026 1.8041313315462368 -0.99185374800303205 0.071624847277904663 -1.9579965922241276 0.79821493350370565 0.88953949651435971 1.4481656599984436 -1.0760585132263547 1.4018815264921101 1.0958920005577109 2.3041145628364741 2.1031795675259186];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.4712041884817;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
