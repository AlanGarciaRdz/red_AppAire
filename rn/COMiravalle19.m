function [Y,Xf,Af] = COMiravalle19(X,~,~)
%COMIRAVALLE19 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:48.
% 
% [Y] = COMiravalle19(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.0100151553303021;-2.0990458274959058;0.34608013364242646;0.90082628185007263;0.77035336384315822;-1.4607742982013288;-0.34639961800453045;-1.7335933018816339;0.051162208102675508;-1.3804593730991357;0.26029942759595004;-0.57014162373465349;1.7163611681955009;-2.103758478847602;-3.1615246041033256];
IW1_1 = [-1.3023785295907773 -0.020921613178723517 -0.77978135666721082 0.11599942203261321 -0.7186188443322501 0.23255280450198515 -0.46925130443010205 -0.72901289943219405;1.9955182285901283 0.3223939303076756 -0.037895405264522702 -0.041976914759871753 -0.069543437840016223 0.27244267273048922 -0.13083050245056496 0.56793003722918334;-1.7784364353560784 0.5764659138276883 -1.2770726731574269 -0.31144068030071248 -0.021225897154461319 -1.1523300626773429 0.30288308938163172 0.2327311332308194;-1.3916667619715311 -0.81899458986203733 0.74420004971770781 -0.36306163004387154 -0.75087409483387857 -1.2564438581332413 0.85413667670552074 -0.90158087057246494;-0.7851557528523968 0.34375146899228387 0.010960921611305366 -0.84971262248849744 1.3532503089885373 -1.5990161688781199 -0.15904287452198565 -0.78082906491132753;-0.38754582208911925 -0.71780025422871574 -1.5351064344477114 1.7100196177251183 -1.3438920751556882 -0.90292316146252105 0.025272716747916358 1.4454465897920283;0.21659353986256621 -2.7256933264977556 -0.50518260937481907 -0.19795290202200269 0.095481985236763309 0.1551504907682846 0.065757000306570348 0.070707471810847175;-4.0203657527902266 -2.9743825841837435 0.50438992811748129 0.30508425175848169 -0.350622781140215 -0.47774945318809092 -0.22509308869024516 0.41163945873858993;0.014393234157315374 -2.5111025085639853 -1.1345197334555781 1.0073561412442813 -0.017672659743966469 -0.59838397010721756 -0.013570312159731554 0.86506535004798146;-0.71125779059099326 -0.44204886911293662 0.53361101192218818 -0.77113032597776854 1.2345884366515605 -0.85483174963920028 -0.83374589555190515 0.70664742631128585;-0.23153241057328955 -4.9497986033684835 0.57762670301937891 -0.4877524870768758 0.088205005775737533 0.36675197911423119 -0.14029596198811453 -0.011547597882295622;0.27627007780104079 -0.47038185251778353 1.0053169365828616 -0.94598132044114747 0.68981098877971492 1.5167592674482087 0.77700271614789285 -0.78623772053850871;2.6862325635598174 -0.36756785454884167 -0.40958431800976108 0.43072312419777209 -0.67794116721518538 -0.52250445864652806 0.56967137536278378 -1.1244614267852724;-0.64132362832855339 -0.28549709353087654 0.39372742228933116 0.56714618457017341 0.14827404618064047 1.3745102343913023 -1.6098443114277046 0.21005891016986514;-3.1289967633603752 -0.23716611273777227 -0.17856296091096679 0.12807126604358154 -0.49405539937543202 -0.40438392378852928 0.027567974238976282 0.37816094806001177];

% Layer 2
b2 = [-1.7045187100612211;0.86640022565619779;-1.1916525084707255;0.7305087262031188;1.1703618365713975;-0.62859889480654707;-0.075648892716122212;-0.12882914640067111;-0.25904512723873724;-0.1422474485175427;-1.5214860886665098;-1.1430099733348178;0.74971110150664777;-0.8345307686581892;-1.7575065224552748];
LW2_1 = [0.040734792092675887 0.70581302882897468 1.8800222064207848 -0.12968340395295619 -0.3440473734604495 0.26789328391118022 -0.078276704962459101 0.047092301603452381 -0.18356896586879118 -0.70394688150159257 0.54696011777206155 -0.79643306599620967 -0.64619473359564295 -0.74498765019831947 -0.96701169362995687;-1.2998042484911523 0.10022698486371256 1.6114848081148085 -0.37883235796786247 -0.17369957738832081 -0.72068601389207809 -0.013984395182285265 -0.53120837929308562 0.18700840126416113 -0.33291393545054493 0.6409517123149544 0.34172542693995001 0.85435533694424826 -0.011348654169371027 -0.21529400677737648;0.34464438705325268 0.23204154635409763 -0.42434416788985896 0.2649907503978865 -0.69667749191121375 -0.0055312126651513166 -0.78368448691488202 0.21563020209084433 -0.59673854324260012 0.71059867078915251 -0.77729605689912962 -0.29550538305562846 0.61025340815267837 -0.32947830306504522 0.003399424082626841;-0.47522145393833887 0.41635918624815116 0.70210680745492471 -0.16159592598100739 -0.21882238178301675 0.47045057756708397 0.56443983826731536 -1.0438462754919819 0.30676031246924573 -0.17562001408727212 0.03036223674746567 0.11863589814962801 -0.096381699380398894 0.16532607369163693 0.30510003361036542;-0.068059542405610796 -0.27720110798587616 -0.14362343203768968 0.22345124157111479 0.53776813415231561 0.6270636713428136 0.96618365545382034 0.44779363409447404 0.29875945979652974 -0.42649958017152523 1.2549524977784761 0.0068036740678079424 0.081303829100114369 0.52687359514830612 -1.3834356681700311;0.23332322444686746 -0.37584749121236705 0.13044257208325447 0.28246402921718144 -0.018160965360275946 1.2689031467491789 -0.023284386253963046 -0.47126943105533692 0.47406623477627996 -0.37970889609359293 -0.3042630726351595 0.54879435603812532 -0.17710492724260099 -0.76022784018624412 0.028935123408755682;0.44142808707840953 -0.80386492766720952 1.3047960069395346 -0.11497376637366832 0.18274046921734122 -0.45174023364111288 0.010881744502576132 -0.53974060446044891 -0.54591824798658706 1.0857438103789008 -0.038449384399158758 0.096489254104053998 0.23927909878186535 -0.57339733063745923 -0.4917995556226506;-0.47045206491833291 -0.39694796627833834 0.33683037068906491 -0.31124994032388442 0.49018609192012907 -0.46575615732854753 -0.50584840652990359 0.67807037624894007 -0.1030562593266092 0.37444928427696672 -0.32022164924837898 0.13248548860990936 -0.55400117301910989 -0.89418303138097399 1.444618145667308;0.15599588689392874 0.39501420274800214 1.1315722972804327 -0.49539180550454387 -0.93873621306278243 -1.1109381176755975 -1.1857232069287433 -0.28906591333980508 -0.73385113674233049 -0.61110782452285084 0.29341685369853421 0.20263303939306346 -0.66658055733582733 -0.38431520902835581 0.36958179566873717;0.12584082963710261 -1.2144565660086926 0.42262267998417785 -0.39490403125859935 1.3050322296328831 1.3335213078134474 -0.12214773708314981 0.4267775831055009 0.31082725447681941 0.71688170387368488 0.29872206633739545 0.16082181806022347 0.60032882151126565 -0.0077413616320242875 0.91415499961256341;-0.47653630251392454 0.63172378672926854 0.87872047109448437 -0.2972139546717511 -0.53950460855065985 -0.45629596048492554 1.2926095537575935 0.77886970644530196 -0.22515120373370154 -0.53372152265747896 -1.5753866049338969 -0.25632046075225684 0.2013081194490243 -0.087717451562370763 -0.38614815967807292;-0.74014068647774822 0.43816931860443725 0.59249702139018456 -0.44495461004387205 -0.46767633335749514 0.45808174109278527 -0.3670983614467726 -0.30584827034446993 0.52420247820038879 0.41196868690220179 0.60349681072515182 0.1880770023799774 -0.10433897501250114 0.00066640361091360983 0.21244609727062899;0.44322872885761466 0.17419490177883257 -0.25475787958343243 0.14453515963361782 -0.40114070919999339 -0.35810604065082341 -0.32323528073607394 0.016907582352363865 -0.21445291610878234 -0.31742727280104832 -0.25215479537065011 0.28138944544997707 -0.55219379696370441 -0.19879256005543625 0.61811494566851899;0.35454914227431833 -0.037792573059364391 -0.48936391337656399 0.47831275005370411 0.59850896351098692 0.18633379010358897 -0.47109772770597452 0.95919350374339551 0.28025623777916125 0.51889244175642857 -0.60369061038473415 0.05342435127447108 -0.069248902363546375 -0.5187612291739776 0.043432721193567309;-0.26722052011050845 0.37569084710326972 -0.72514171148267137 0.28247601514336657 -0.17532852455571965 0.71740107797741237 0.060799579109244391 -0.012498438486082604 0.29388329638273386 0.65307382359110411 0.25737496136734389 0.425257765190314 -0.10560692237748802 -0.52595645377920341 0.583941365110485];

% Layer 3
b3 = 1.0480587436743971;
LW3_2 = [-0.32177377731263729 -0.8888913114729351 0.79179005860133733 -0.74139233266518767 1.0912438066260408 0.60169556211423703 0.86259373079867674 1.3202329624380842 0.33371761606903821 -0.59386263894185898 1.1699579550675971 0.22311018482586317 -1.693098705415772 -1.0099321424065886 0.30336322314508007];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
