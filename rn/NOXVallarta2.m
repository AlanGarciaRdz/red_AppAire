function [Y,Xf,Af] = NOXVallarta2(X,~,~)
%NOXVALLARTA2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:25.
% 
% [Y] = NOXVallarta2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [-4.3257001272531834;4.6629448271787695;0.97963109317460983;0.57347156843447267;-0.5922121311902333;0.85800360130212983;-0.25956720791690063;0.64657668508061983;-0.79854923729973371;2.7450628986733467;-0.39595186371098096;-0.87073039968204402;1.2925565350905512;3.1817574746639323];
IW1_1 = [2.2532479605624225 -2.5729154297331545 -3.13782533539201 4.9867639960770225 -2.0492550998999097 0.20247760957712413 -1.8849805834774356 -1.2345306335487352 0.77837100595848641;-0.82812708922331602 -0.049952788130294065 2.0521629056054218 0.68993461744848339 -0.34791062058600886 -0.69062689965585389 2.2602415268239167 1.3040621778642363 -0.69230765412244855;-0.62176562360675569 1.5762156174888335 0.090782509237439857 0.63402288944425 -0.20699849346583341 -0.16091456673686819 0.051883196394642346 1.3008374117508676 0.52423808710153774;-2.4241729535936587 -2.7687246128849634 0.99964533401753441 -2.5323224182704309 0.83947602142643685 0.25405842817500751 -0.13125525864017548 -0.44522562341990624 0.074218639412494139;0.57679251727545788 0.23891567310258219 -0.71074158205938531 1.3503479176708184 0.3952527794495877 0.84556666729936014 -0.27851641811048122 -1.3846471837426579 -0.15263021510021985;-1.8201212937625719 -1.1810492979984184 -1.1747697554319301 1.3196207226182657 -0.44869753650392202 -1.2949882334413676 1.311226227781106 -2.028114356675343 0.31631115872157595;0.44735476195604718 -0.27873431464178339 0.92325826155467838 -0.49462611463986006 0.10119092695189399 0.42226540927591139 -1.4541700650644238 1.1150403059393099 0.16859467178236814;-0.051124489316630717 -3.6264498493441502 0.16664897859228864 -0.80391557450774853 -0.37180983017897368 -0.5629599824075292 -0.25511659106158918 -1.2491214092194372 0.30291097851686988;-0.30429128653228776 -3.8660259108547241 0.089322996936942275 1.5569393571759971 -0.92589191043931429 0.33348408535024116 0.016363283441234479 0.1452156522146151 -0.26479873131875353;0.64188059615948889 -0.44443265965801737 -3.190561003749711 0.032599702049292315 1.8769294406393127 2.4233864562040832 -0.42185000227824521 2.2846668168082616 2.3382107472380582;0.51087381704736423 -0.51932611024959241 -0.47457780288894313 2.0934085331322945 0.6889309294404139 0.33793879073078392 -0.81552082868016584 -0.99177793890155919 -0.096514597325643159;-1.2982199596533046 -1.4762024341118936 -1.1490933493977762 0.97285471370025078 -0.25868298282868663 0.033191367112219511 -0.35908354489682509 0.61647650035299617 -0.72846635615727329;1.4223202764136313 0.28359685578716676 -1.165141511233462 -1.0551777503860418 0.47848058506956159 0.55804444929192476 -0.019784004130274022 0.78570912067663701 -0.10383968783511963;0.054410955842154281 5.4451398713610688 -0.54730073009166569 0.24985990793661791 0.83856594508576376 -0.075322801665909891 -0.15413787545453722 0.36609566197675325 0.070812990620100755];

% Layer 2
b2 = [-1.0602544991626832;-2.0636114554284188;-0.30520440562112494;-1.3441788692891357;0.86927974980123679;0.49605339697350848;2.7170077573487492;-0.62780998868623916;1.1530390916978446;0.26912728014305626;0.55521677117328083;-1.6503060513636456;-2.747365478361619;3.3609812277119873];
LW2_1 = [1.0135956003165278 0.077427757157654792 -0.14097073067539911 0.33545742609786172 0.18112328353857712 -0.22178362046139427 0.30184177952783836 0.20007804881414548 0.50557619275894483 0.16505733996097055 0.11299792170735434 0.12610328843990812 -1.0578565778740661 -1.5576662767319738;0.66078231254474551 0.80239331256020086 1.6457059858684668 1.4080323833144937 1.1097721876151456 0.49170952321839734 -1.1152621093105006 -0.4208663494533979 -0.20497333101721404 -0.09446496754137966 -0.58844081695961792 -0.39947336830515945 0.60129829171947546 -1.2406066131741176;-1.0213941126257262 -0.50139542651027491 1.8052431320925846 0.091914701585209993 0.48790606266342462 -0.90179876762973521 -0.56534880033918711 1.4210087798396527 1.6846468332157427 0.027557542443996122 -0.30136902620705863 0.49319491796558168 -0.66498395617688455 0.84701773828746896;-0.18580553069868394 -0.18260498714972551 -0.57147774516932892 -0.11150858803935741 0.13356936163873223 0.77147367933362632 -0.20635841390515783 0.66967225762266969 -0.88176817888151982 -0.15097959320659915 0.16858800933238349 0.10157085863527085 -0.21592766829642684 0.69948129075752608;0.79463309366002111 0.5110799377582379 -1.4392961007415945 -1.2676281932479425 -1.6708747554311152 -1.8863304230011664 -0.22954968060904124 0.4952819872257691 -0.42522337024285778 0.036500727106068415 1.7814367259560122 -0.15558551504765225 0.96217053455974266 0.90516714751039595;-0.60284763587370904 0.027208274122678431 -0.67562251360238734 0.26177676537948286 0.40099385776234631 0.90960119871597944 -0.15762437796023948 -1.5333384224991189 -0.37002761977728493 -0.032409388216200825 0.03323106062383302 -0.17885044913209849 0.40771968354606725 0.59581828734681597;0.77257121008152385 0.47101637934649199 -1.5569944760491898 -0.28315205972406926 1.2106695160922942 -1.7253615615872955 1.0647905043344639 -2.2940316814885642 -1.2789569877813813 -0.10969558570900606 -1.7328609849333805 -0.13982161923590725 -1.5597302790353904 -2.5676289799168375;-0.82540218045298297 -1.3215397960934341 1.0912680115450586 1.4602484030530323 2.6875791766391952 3.459932203548612 -0.52971933078648581 0.01825636342587901 -0.37464484482947624 1.2628259031820879 -1.0350943186850532 -1.6552336790486872 0.030135920803372872 0.94888844542015904;1.4815439664040722 0.16700966251608479 0.34834810047657061 0.43820469002742957 -1.0841394831484252 2.2233349966408564 -1.0911270744764934 1.7443227751555057 0.075284039016030618 -0.020165035013723513 1.7377463547640468 0.87679000429225473 1.8349745163692632 0.044413476720100299;-0.13145365311873181 -0.54578086536024151 -1.539704022599599 -1.0032531218359901 0.39102063412789301 2.0038004359452213 1.8292730457644326 0.45161669656466852 -0.046858791070511635 0.0034075482454003943 -0.8811160755744345 0.087925928130567405 -0.74063636741251715 0.81926533626393905;0.53958854322618743 0.085390693714245319 -0.95442110520234946 0.017876314316058631 0.069083284378343296 1.0550099814139839 0.17732936060825824 -0.47044000314922757 -0.39343435951386418 -0.045388321014111346 -0.43778276979504138 0.11222888617401541 -1.4330390501940189 1.2816805248053356;0.75706758072232816 1.5156606959537828 -0.47819841051574796 -1.0599586282874625 -1.4327746770871359 -0.56589685236062015 1.0507494000556064 0.41898460353221001 0.70433299895281598 -1.3291397263067888 0.53457077521651009 1.7567062345444071 -0.16226842722862436 -0.7992546114573047;-0.32400720821089218 0.24224868889790932 0.22160934081065756 0.12922106822813498 -0.17964609082104688 0.68214587403383575 0.62686153885055729 -0.68851513365581485 1.6434156927291312 0.11256432390439325 -0.47988211912764744 -0.094059276665519387 0.47008625340332255 1.4959217667189599;0.45957433696199945 0.25104927463692772 0.099241191368406936 -0.30015070717633263 1.1666629896683889 -2.2105047406899865 -1.697829269432545 1.5520531770759953 -2.0234027374653292 -0.28143518057954753 0.19119877575019767 -0.76943359331029049 -0.025501172203600292 -1.8316792936990809];

% Layer 3
b3 = -1.8382720338289444;
LW3_2 = [0.807771229519334 0.76746686069716252 0.49008467413135481 -1.4639790392099767 0.41446295259941879 1.3051923355908477 -1.0417852398778178 -0.76224800998976217 -0.90372175656260734 0.79544668489622661 0.94711581689573021 -0.73319290654962932 -2.3651881203916783 -1.3698037911315153];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
