function [Y,Xf,Af] = O3santafe18(X,~,~)
%O3SANTAFE18 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:50.
% 
% [Y] = O3santafe18(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.172786177105832;4.16666666666667;10.752688172043];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.9557445282966737;-7.2855496950949306;-3.2855328494455862;-2.2952856740398162;-1.4701176664137934;1.6379084631546377;-2.8888695700433322;1.9253933381001764;0.33524269405390456;-4.8119677045818703;3.0802001888057373;2.4176740904870226;-5.0540677684626836;-2.7533033385352392];
  IW1_1 = [-1.7598958635579105 1.028657443888797 -1.358522598754196 -2.0716966732427218 -0.66965375594495091;0.66950229376550763 0.50659620570818475 -1.0071423757132441 0.88515312655465994 -5.8934021492831183;0.48597242243752159 -6.0302646060760505 1.2446748517979553 -1.7505821510922419 0.5478997896350648;1.5275363494721039 0.38640264122669055 -0.18558149587401013 -1.0854437387059244 1.1181096702277766;2.0037303312530494 -0.18962450203284995 -0.43089225618217314 0.055265545610216169 0.50426771476690679;1.2001573746580387 2.9463599451608578 0.98629207700150801 0.10679804909501484 -2.7946264641017895;0.27656777786863146 -0.18576899273794009 -1.4963246468473534 -2.4302542128833582 1.911007581985432;3.3234728249511969 -0.7179933506029289 -0.24293566835327302 0.89199672301092425 -1.490427045622903;0.061354997216932938 4.9228153466284512 -0.7469245357393598 -1.4847447648750365 -0.25128914599918406;-0.50163025087011448 -0.88232428976412658 0.64415007586974049 -0.40657420261539201 -4.8825153216122752;0.6971274045729241 1.5063910533602094 1.072650913295734 1.220213489698369 -0.98823787717375056;0.99869186438882196 0.39904502962520333 -1.3591546566847805 -0.52126869068059944 -1.7834667942988276;-0.0033640423496670664 0.76784045380598998 0.35593551103468229 -0.46835906947405592 -4.562688697736613;-1.5379564962702739 -0.12942452146282679 -0.68164148461229723 -2.3125326117441332 1.2488272706694226];
  
  % Layer 2
  b2 = [-2.0929944300590839;1.51173350347072;-1.3411021162007442;-0.94259203949725079;-0.00026540675456345961;0.37311256321578462;-0.035150503315476284;-0.015254319316313434;0.13855206683421997;0.12981585314543084;-0.51108550488586568;1.2339458391346476;-1.2562499228866733;1.8511898207698314];
  LW2_1 = [-0.36218259441441208 -0.20119712490142977 0.13645298681688675 -0.71528550405051405 -1.0693599689417164 -0.25418248313940439 1.0186318874324354 -0.2398715115390872 0.027433031490396213 -1.534653264064709 1.1491398154651928 -0.94461491659493446 0.87186313973971774 0.047113752589363109;-0.30119852857250029 0.04156298406520751 -0.28075041532319184 1.2547378261983988 1.0007842614847882 -0.11642768254476575 -0.75319962663535256 0.9307449792564908 -0.23326427796874652 -0.47373596496733278 1.0158463855206317 -0.48585380853358751 1.1385680336388324 0.55534802667863137;0.34845279962110204 -0.9784943313290404 -0.46685691986712896 0.12647326653546742 0.11064469722575981 -0.54952560795894456 -0.99246414219583068 0.39671914160928501 0.48974529017641938 0.66560715924759739 0.073628348378154448 -0.72237072787521561 -0.33601798615506123 1.1091261692799659;0.24817000528703595 -0.32309770102720725 -0.88610961754363793 -0.24660233364993187 0.64166674189727901 -0.48026573060215988 -0.83056631329997488 0.74115223572361533 -0.50190000373273314 0.014145725487570246 0.13218258076036823 0.127831892995867 -0.62068682475272008 1.1215871171575489;1.1443144003843622 1.1652061284816084 0.62897449770379332 -1.3295645568389567 0.35610641880106048 -0.60683557858164627 0.39736801033088154 -0.33138252574881805 0.40942273057066397 0.49841158273518166 -0.22135014304743256 0.74795074311164089 1.3114125862890278 -0.44375466754700538;-0.45798489899571687 -0.65315124886414866 -0.011188267819959285 0.23686961621162611 -0.49327905773972319 0.48983530532216613 1.0001867198399683 -0.79992285187060419 -0.66365818484726624 -0.85627956273403338 -0.96091364730435624 0.67334452751292861 0.31345792972330855 -1.8071697201185575;0.97774478048187941 2.3431952266364444 0.60320054337306417 -0.98458740336510842 -0.67766310859707291 -0.87231249963740853 0.04847121945353848 -0.50064183136843576 -0.54079351729600211 -0.39021982078034628 1.6892702148362091 -0.53840299125358759 0.95475643345429562 -0.040192751157495599;0.045307708880013745 0.036103657767767583 -0.09679195072618349 1.1663209105029009 0.03820208157400945 1.1316321407866756 1.4243754941309508 0.91330228214602027 -0.49410468445774552 -1.9049350116886243 0.69304340485847504 -0.66004007299170531 1.5453950341208162 0.69359278260267154;0.41099823595791585 -0.47738083541236681 0.17640804883180636 1.6051150944274213 -0.31264803292446353 -0.57515897533281424 -0.24880683094082034 -0.19033446805807278 -0.2033455134293467 -0.38520127272850785 0.35798460580385189 0.16697297777995526 -1.8324614327358053 -0.2777717436011008;0.58947337797673838 0.25352920465614376 3.003923307489877 1.6115124323828722 0.050351246952321266 -1.0396553915774198 -0.15005990621194118 -0.54973457803805514 2.3266717268116284 -0.058882411700119097 0.73691281745385406 0.41443665606964636 2.0600530254860354 -0.71570867994545639;-0.77927511047442921 2.0179386751341579 -0.12545570249291882 -0.46572667591364675 -0.19691588826162715 1.1354315203475742 0.63705598314345369 -0.67231529386416011 0.01469453608191711 -0.99738400768798452 0.10730567314596834 -0.15001835694244148 0.60503785834894497 0.0031956889417649181;0.26096087364145293 1.096447661658599 0.54896217685692517 0.10951956393615236 7.5607585752252363e-05 -0.57580505641327762 0.11182658569018034 -0.37396945308351109 -0.003288526938295146 0.21439534235530477 0.20612715612384713 0.16085582484723068 0.64842330853429619 -0.23234218960775041;-0.130139903004105 -0.41859599131048941 0.84401296491279132 -0.13909134644349405 -0.91569082596316675 0.71002934628989312 1.0003342040972727 -0.6375602480051189 0.22857562719980645 -0.061251867769624768 0.21890719035112571 0.36096965135700254 0.16393227856387027 -0.56264390085260474;0.75361628583810925 0.15147206399500576 -0.94525857119341683 -0.43942430296731128 -1.5246262536637178 0.37503966373638004 -0.79873923286352377 0.73068383602010645 1.169448094552161 0.78246568136392514 0.017203935956060686 -0.42680115296393639 -0.80450551465428355 0.10498946205452814];
  
  % Layer 3
  b3 = -0.41346363733518515;
  LW3_2 = [-1.673217035906305 0.75611889695424472 1.6050746462134522 2.1780100191158391 2.9188239712196498 1.36734180552358 0.94136508201742797 0.41181325204075664 1.552600567389911 0.82940061807380072 1.4608550627102523 -3.4402294489482226 1.9536974528041742 -0.80877729657772468];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.752688172043;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
