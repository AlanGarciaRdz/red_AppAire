function [Y,Xf,Af] = O3miravalle24(X,~,~)
%O3MIRAVALLE24 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:44.
% 
% [Y] = O3miravalle24(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.304971027752364;2.48447204968944;0.056980056980057;0.0063552589768033;15.3846153846154];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.9560383021656509;0.8078301169896992;-1.7969429732496671;-1.0643528201702828;-1.9017523878745846;-1.1744609301050559;-0.16486223268323408;0.59540170683849092;0.63802047198538847;-0.68094848836444111;-1.623654161156268;-1.8313937047473343;-0.16768738539747127];
  IW1_1 = [1.7355153137620249 -1.1369673258842696 0.29568585677455361 1.0835198946859905 -0.74263850497499928 0.6049960834077599 1.2540308041430226;-0.10274184471113555 -0.83669095079829459 -0.94021497671213383 -0.29074881184932411 0.87051925482447801 -0.0904731988829168 0.083688318569825712;1.591875452498583 -0.09646828346840472 0.33265895415694441 -0.46022710537419154 -0.77876935051925777 -1.420103023079617 0.55452655531719641;-0.3393987116264694 1.1850235172581176 -0.87835568469307124 -1.2487597533759929 -0.36213947182725642 0.73772108472005882 -0.37591096718163708;2.7075722075226221 0.71517091672021427 -0.47558575895991284 0.067088243328233085 0.11872298020229728 0.89851958727116366 0.83229788699743101;0.24796950439569101 0.25875311908727699 0.010471037013943148 -1.1143864028036785 -0.087784866545571161 -0.47316417914445841 -1.3042701954147593;1.9799786540664843 1.0392281533615795 0.031553961879302164 1.3175365494221203 -0.24139004690329077 -0.20511558207306663 0.53205727387462742;-0.20453766231486104 -1.7024497494917448 1.198437990217746 0.80801913235948319 -0.013473241934765179 0.034659545898556424 0.67168141590894226;0.18323913714680312 -4.5199872367752754 0.59978960146275517 2.2258650607070156 -1.5915196439161152 0.75539568403253299 0.55297701779159292;-0.65820626080876532 -0.62486852099964818 0.082306070618122229 1.2747512460299737 -0.14982572298541846 0.462310173647137 1.2729624973240328;1.5521485906851589 -0.3278117116494268 0.33342651081882591 -0.62078443707008368 0.32736713222182701 0.11664621848294576 0.33269827704152921;-0.075224954115637455 2.8218212561976768 0.21127556254008872 -0.32761414893537666 -0.79337679570203445 -0.0025956743440179036 0.99316678994993757;-2.0843730458901168 0.14328492381673363 -0.18694140239772794 0.49700684308016113 0.018088436080671635 0.0017586779064023943 0.11970739825958707];
  
  % Layer 2
  b2 = [-1.7979201590123208;-1.9164528486163768;1.1538761495067509;1.0702481752713617;0.75255837269609793;0.31914587301599218;0.20985734403306816;-0.10532337940995114;0.64157245116147132;1.2839815626774482;-2.0139167626568875;1.4326240684648972;1.3384201530313502];
  LW2_1 = [0.14525864037072728 -0.52178147188118484 0.55710091728639288 0.29390542363735506 -0.67322592693542016 -0.00010559212948777104 -0.20993572693023344 0.42465201376948924 -0.065969995176895863 -0.89112628709636243 -0.18452768818296669 -0.82558679435668358 1.0500431091043072;1.1492175764692323 -0.90550864184397173 0.30308019804945302 1.6918134693235862 0.54943543797773342 -0.32493065210250976 0.37938613493343343 -0.33635036121770606 0.056730466354925138 0.1491302850860774 -0.30894361847809015 -1.7526085561773248 0.77246105831447087;-0.27852116096313767 0.25981811773322766 -0.51223230066656922 0.30385094103542826 -0.28562244110738205 -0.55504561933565744 -0.82184035372383768 0.016798398557325386 0.44754828060580121 -0.45813563242895455 -0.78013497211359373 -0.4084150000253654 -0.044436511551394643;-0.46000335746623444 0.80804589604464683 0.2412615572788718 0.36187357811182441 -0.15788149246143282 -0.92259265639959387 1.7312187312271408 0.18657391091769385 -1.0425356381368496 0.40498387885887654 -0.98554696559586397 2.926885565664997 0.66758023343423456;-0.97926631170596068 -0.37238301090972076 0.16389002532743754 0.59221213026142194 -0.37738430368832498 -0.7195019970468709 -0.62099324090461239 0.69552223305738259 -1.0769754265986862 0.080754762463098276 0.25097791592986884 -0.69072920318540831 0.81578656788021431;-0.87690967927963825 0.3862306555955578 0.24570861518402384 -0.24915411573808666 -0.27736521898071204 -1.0827534819364222 -0.95768441236692492 -0.28426392553399649 -0.8175235993156218 0.61080584042676489 -0.67232290247539428 -0.20057537339811432 -0.055743280381633578;-0.78926194502408575 -0.13594081663749844 -0.82692805557443538 0.43486301330295507 -1.1182250260283098 0.83661808706809504 0.63013746894399258 0.65052085790108338 -0.19466210743141626 0.80610552395544843 1.4732183598857764 0.23106760636274987 -0.75161469387864599;-0.82573513367736306 -0.37163968604270337 -0.52671304977411271 0.092616769776228319 -0.49105281259429856 0.54602716623658898 -0.15709019115933173 0.58758298714788371 0.11020861900521656 -0.046511337396204888 1.0936362369771551 0.29297089448811814 -0.073913614126544736;0.033466841266464022 -0.49146702618861438 1.0553801791764554 0.80607655912333132 0.61340355919956302 -0.16296618807640306 0.77337125370595916 0.63082477928486835 -0.45331232026325813 0.34062242249423752 -0.86696073744129154 -1.8290642702848732 1.2077247594842997;0.28721553396265515 0.36419216257001136 0.02037697650511517 0.23896940339191414 0.35462796353591802 0.22674951581318897 -0.4544532527309445 -1.0276764260360325 -0.21964322485559454 -0.53648540256171273 -0.12410027922305206 -0.37367516560052921 -0.77557717348031341;-0.19002730694192216 -0.79338218734309862 0.69774721495460912 -0.06219684101006695 1.1055934504963143 -1.0717974674952866 -1.0361675311774774 -0.42703256774673426 0.11298317963801266 0.33790007805200556 -1.3372863130438462 -0.49761351418036243 -0.7694179673744852;0.090921274682082248 0.36038067183009281 -0.18986840420776763 -0.41632139730855228 0.46031388894290215 -0.64662365529756727 0.12769136828426961 -0.55069405698609142 0.26573396898417867 -0.29341789030794341 -0.069254688628237804 0.90595507295028921 -0.085278315476223943;-0.020705832384665057 -0.77990260946589873 0.0621391300810962 1.2229513183477774 -0.28417521890304859 -0.019564645160523253 -0.16735613388747203 1.3314343439888667 -1.1998588394084491 -0.99093230372776719 0.5100259082279508 -0.6356674741324263 1.1626311858104994];
  
  % Layer 3
  b3 = 0.36197060192674951;
  LW3_2 = [1.7922178822663941 -1.6421900563493863 -0.51030186169410863 -0.22069922862172434 1.9491830968654429 -1.1438042288115433 1.3009074649238554 -1.7439972180747139 -0.65371509476482104 -0.19080944889828391 1.6004515620889423 1.0965903033839068 -1.2417601439543338];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 15.3846153846154;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
