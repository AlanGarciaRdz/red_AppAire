function [Y,Xf,Af] = O3atemajac16(X,~,~)
%O3ATEMAJAC16 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:36.
% 
% [Y] = O3atemajac16(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.201288244766506;4.04040404040404;166.666666666667;0.0561797752808989;0.00614628149969269;9.52380952380952];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.5296929179567711;-3.5970758307655974;0.050049770039553243;2.0994508153408971;-0.49886224036661347;-4.0218865364460745;-2.1891624926666164;0.33803194475828791;1.3655509159785688;1.1936360302830047;-3.3182340677208617];
  IW1_1 = [-0.20022163282652636 0.25048573161838494 0.62964708786890822 0.19239570030960867 -0.75494170930164306 0.042041972431413797 -0.2560173254060038 -0.030437031541192431;-0.01596296525534394 -3.9655728852284509 1.0753509741208236 -0.88701086020445441 0.17752021781638613 -0.99927189722436793 -0.17357392946092262 -0.16032700536859007;-0.074481819047724662 -0.70605022993082145 0.73803502201704785 -1.4516971214552319 -0.50888143545735742 -0.12901756300647743 -0.14060374044019797 1.3591287240059819;-0.08035182502154152 1.7564375198633495 0.58431087743596311 0.51508648665581547 -0.11231999662952416 -0.96737025122588172 0.066471496635087196 0.36992966923477605;0.14866775052772588 0.13551291619962236 0.42706221431512909 -1.7703136260668815 -0.18876678305161099 -0.31262277407438616 -0.094351025875512709 1.0459411593225163;-0.094806431708161706 1.3715233970292748 -0.046732011097554288 -2.7621874738295165 -0.52600996343583806 -1.9990619433430199 -0.063822372507683106 -1.1589566491172618;4.0762110057421488 0.105722029954792 -0.046027198859495605 -0.20401446733369019 0.20421115199283693 -0.45907536583721525 0.026107310167876839 0.52220583207438254;-2.4929824278762061 -0.56919640331355492 0.076005340890070397 0.2251272433400282 -0.20533002712494472 1.3769128474508467 -0.12190246711259779 -0.94185254881535152;1.6784037083122985 -0.72738718927322665 0.019967550284775329 -0.74028712024271892 0.27496623252813879 0.079721834985539461 0.13939802559280623 -0.97216749526374324;0.46596729048653335 -0.51511737923562972 -0.069697421361282832 -0.26594834740008894 0.32599257480328958 -0.54207741838403001 -0.54926288210441421 -0.99992526712022445;-6.4747650459675476 -0.085060554923539936 0.6615083157495647 0.77683933283163864 -0.54184524994040606 -0.83193459234463729 -0.16854218236451743 0.82655394604777932];
  
  % Layer 2
  b2 = [1.9242040498386357;0.3287443283843634;-0.86091016381330643;-4.2605890345384658;0.81409196518606253;2.2176742656222337;1.5723628798690605;-4.7590164065605549;1.1780186498976342;2.6128788142260699;1.2553481870114895];
  LW2_1 = [0.81042322858056726 0.79534372998684488 0.41881555297896883 0.71500709939788831 -0.051917697647068869 -0.66233910242454841 -1.3652462948125335 -0.88361906691994385 -0.32414430681046957 -1.3863748963388398 -0.34806616485066405;0.43295054822442297 1.6819651660499035 -2.3868792273101755 -1.7038975287566738 2.1219062166132621 0.53493021125434637 0.82149057311038964 1.3858280716623497 0.3585064763258784 0.17814038172501964 -0.018414681027485447;0.66025408821848897 4.7168601992691412 -0.69264657923612483 0.0138495612289603 1.4574146135881789 0.15288401775220573 -2.1729307874239394 -0.35024982814863215 3.2968358563859206 -1.3280623268851481 -2.0308918828444251;-2.4206448439228128 -3.7017219885527783 2.7803090898879255 1.8885161772447998 -2.6573891412132484 -0.45632328858337856 3.0124971185260105 3.0194711956697913 -0.32877163589918335 0.80448936260417925 0.52165860133096975;-0.57195112048556562 0.69303316800415993 -1.2844486987718817 -1.0225173182486853 0.80805301535257945 0.19724250035710378 1.2994292622537387 1.63852040866112 -1.1382414768090261 2.1830887424483101 0.32337673662843786;2.2228112288136996 1.0684944111174841 -1.1750637660709597 -3.5154441334305289 0.47352552071417869 0.90439916336480319 -2.8328382659448863 -2.6658101969173424 -0.36701479850462781 1.9826342054853001 -0.0012407972421729415;1.8459891069313374 -2.633317260835577 1.1348269601418512 -3.9203383451590619 -1.3014946416528377 -0.75797601335399201 -1.6094544690616484 -0.91327113278991401 1.7941639654568982 0.22979473310369217 2.178915710325608;-1.7129065335332276 -0.9463380998292088 1.2890240666380495 1.6391304664460076 -0.66549077098838016 -1.1285750884875403 -3.9846876135349292 1.9112446227967885 1.1860526611427928 -2.5151918346643587 0.59318035762433796;0.10495488981243392 -1.0347966831675384 1.6178068523046123 1.2253303994229126 -1.3136099591187647 -0.3722799495155425 -1.0400366726597439 -1.4135362229298412 -0.57890393748028923 -1.9845297156092128 -0.20974399098646165;1.7037864182404967 0.4239731762157381 -0.011760405053709786 -2.030241510882993 0.022291768663801507 -0.54464747506724409 1.7136644571983028 -0.95135465134311947 0.88295932483071904 1.0408224350918998 -0.19081095116312582;1.3229733361117868 0.716607030929299 -0.29382611955617666 0.054782828177301804 0.4563270167928441 -0.23496742787142721 -1.6714732701034769 -0.91603171554072793 0.013928261506068296 -0.15259491656630306 0.67579326207973167];
  
  % Layer 3
  b3 = -0.52362688698809756;
  LW3_2 = [2.5808253493407163 -1.0373067149925546 -0.15244255780440458 0.71665663286173409 -0.99578396935408742 1.9338783390881433 -0.75534816920240633 0.20431239985675914 -2.1214011589232524 -1.1177936132148274 -1.950439563772544];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 9.52380952380952;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
