function [Y,Xf,Af] = COSantaFe22(X,~,~)
%COSANTAFE22 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:10.
% 
% [Y] = COSantaFe22(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;10.752688172043;0.00341273633199099;27.7777777777778;0.00632111251580278;0.294117647058824;0.448430493273543;166.666666666667;95.2380952380952];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.1264249232844623;1.9829013588054625;0.9437282803122754;-2.4093540585085216;-0.69763581318318379;1.4390953710127334;1.833559002214499;0.1643232404953924;-0.9115861268376666;0.11105080158685793;0.083883133245427774;-1.1275127647678347;0.27476642888362268;2.3525250951759982;-1.3195280108327632];
IW1_1 = [1.2177166114000173 -0.42172930499995914 0.88241343609364686 0.12621420331362943 0.009217586181987189 -1.4622751588564318 0.8566802235184503 -0.76978830698148704 0.27058373855618989 -0.65918134658363181 0.28145024205871166 -0.78150448495470071;-0.24717762250566411 0.99044859084608494 -0.012722443580882764 0.75948430212728224 0.5687492397574645 -0.60680792722289767 0.45238854632358821 0.8236149348660412 0.81491110226711827 1.7726258149788447 -1.8379992992859702 -2.0118664710802641;0.26329815869698581 -0.67241947717462069 -0.71603183212728638 1.6828291943902463 -0.22274743964570284 0.37854393283451193 -0.39580161840394057 -0.097027973541992912 -0.67257632053523586 0.59747077641237112 -0.55376067824011266 0.71184233526235652;2.26372212684507 -0.27479418244090387 -1.4147647993042927 1.7085098946844592 -0.93851018823215582 0.041452768808004067 1.0289145320296418 -0.23519453854556238 -1.1177942433001016 -0.011785674471771597 1.3191309203643073 -0.89316692110124363;-1.2749232171420997 0.0018141812217005518 -0.32253809168273762 0.018659128919144632 -0.11957894898317509 -0.41403381204027523 0.11481640628874462 -0.041241381686836817 -0.22966523693810659 0.59820946477935344 -0.046898879852045813 -0.78793107802581475;-1.7151842664080859 -0.027579429632234947 -0.36372347782158093 0.33562640647438424 0.83209354198508367 0.43876659092006554 -0.18609205068261214 0.027128999074360682 -0.43646954185021858 0.56404709430481514 -0.4361957341405705 -0.26651822206016851;-0.8345812849854094 -1.2806772368557227 0.58410977720401736 -0.24186388997317115 0.78601238134238549 0.85557147694202207 -0.7161026773271888 0.20659819181924821 -0.23614431317564682 -0.46848238487482918 -0.23881970621843684 -0.048185397802113908;1.7505769439895045 -0.69538174270613484 0.62190505180548117 -0.021666311307878279 -0.064694376131820261 -0.056272476935224053 -1.2929308757326072 0.039927156068395857 0.015907773849478047 0.13030857779736357 -0.26134685940837393 -0.48936488297306813;0.051908615598358882 -1.9625159749514467 0.26254441396291656 -0.43850948318768507 -0.051331250229141076 -0.35103855470306022 -1.1538575789097836 -0.21342269201323061 -0.055043337559574329 1.4461073006915477 0.5376587395551693 -0.63048878469212566;0.39625024524554925 5.2061827044591187 0.39479599146407895 0.027311227795828185 -0.63299039934979007 -0.23751323791729739 0.11503090873226032 -0.30318433930423772 -0.40083442565043648 -0.34812185205899127 0.87246140834213437 -0.20375210530299487;-0.017847656765180072 -0.43654358966604079 1.211994802239434 -0.7508132951431552 -0.13857740005488287 0.016560972852110403 -0.21449610626346063 -0.22204490005848776 -0.01736734327427782 -0.32686035256618373 1.4643972876043219 0.6474796093713665;-3.5332612096913247 -0.65781068850854074 0.42624755528492764 0.42331571508240923 -0.58095594131956874 -0.36592172434644116 1.5077070365531036 -0.58356881544450367 0.14090639511073161 0.37533364717723661 0.64156759634090021 -0.077224124666302518;0.043066771276462398 -0.18702143795846654 -0.29037524045606272 0.13048319143783843 -0.14463219985952935 -0.31843912820983605 0.19939089305423183 -0.12013984990068914 -0.045557899985981878 0.8137414127733148 0.088016171054582787 -0.29853157414545156;-0.16347244132113115 1.1479394482914647 -0.70867486329561202 -0.64632069573419948 0.44190565402567494 0.98095778277311629 0.23528366683893925 0.2665148692168065 0.10471093837558393 1.931180039003906 0.32913917667360781 -0.18684370332607866;-0.32275730236501593 -0.3807463705569698 0.77201664977154127 -0.86077975890673841 0.13904295397152922 0.73408752494475182 0.17439111723669443 -0.1368792723435136 -1.1455716693640079 0.96937519417135198 0.57736434924989388 -0.39559024924670938];

% Layer 2
b2 = [-2.3045261887080706;1.6812078230053615;-2.1087083239415727;1.0521261474937345;0.62160097814648774;0.129953714662363;1.0276743327963445;-0.087902877771694032;0.25007193550336665;0.72184551192508328;1.0175291340002035;0.028938064101988528;0.81558144221018702;-0.98122727763213125;2.0719755650712433];
LW2_1 = [0.88016149942350297 0.016549520118986326 0.10126257647464276 -1.4491436819216879 0.19966293297616625 -0.89228485627590248 -0.83100475948136387 1.1261866043764963 0.86349339165826189 -0.72503275246081178 0.037418461351222079 -0.72083210305465084 -0.4979232311535664 0.25563782495086651 0.68168394127615506;-1.4257446119923323 -0.93766867827991141 0.23014259396986031 -1.0795854444217841 0.13024860251394554 0.38476467250199703 -1.1962810901538623 0.057637327077881155 0.4977364125383239 0.53592755308828333 0.014941074547896661 -0.40179825762003207 0.05041924201615304 -1.4406882367789142 -1.0081033036439324;0.45177968822200315 0.1152343379699379 -0.0087370509995098357 -1.1828613657940681 0.32597669099536186 -1.1557726730307194 0.24832058728651596 -0.24733575010555631 0.90882482048980939 -0.44871593070686178 -0.42268264536778266 -0.82173948635512251 -1.1445108554186048 0.2392461016110391 0.71592586928254287;0.3933805034732395 0.07151239260124348 -0.24320274874256387 -0.0081448533928276824 -0.21608281366529858 1.8389078214003289 0.26726967956799952 2.753314986368494 -0.54075796592786518 -0.54731501546147354 0.61410079758088287 0.51734942642564063 0.48597525345798076 -1.208308467593616 -0.39830736282540119;-0.3165442497616065 0.19218372776257353 0.50304361193781644 -1.3696159640491161 -0.27981730421031992 -0.10213082376929297 0.0086493156282025693 1.0184199486213952 0.28839848193467876 0.019310147014406143 -0.13626079873545555 -0.049396149373868076 0.25921004220074734 -0.84029655886279109 -0.49264396145590417;-1.3293807988896869 -0.6321384511100655 0.10112273555467778 -0.64972002466763135 -0.14966667614237647 -0.761443937097257 0.44890097474137008 -1.0496624049179433 0.35385555547056935 0.76264769903372875 -0.39280428510962073 -0.11587188769039614 1.3406099355438574 -0.85445166420014806 -0.44290010190410606;-0.4275258424565308 -0.52668407381923343 -0.055446496357182379 0.48325075889637997 -1.1424238439168515 0.83262140947398311 -1.4827893901374347 2.093826578124927 0.48845022430733259 0.077323644400040498 -0.51407141582328653 0.89650258392714322 -0.19754351815084173 -0.14017826841875272 -0.41994371467224184;0.85831332606916955 -1.498977658141974 0.33726337693274044 0.19654743459319879 -1.2513493965115892 -0.30951092359871069 0.072261558955588889 -0.15086950698623819 0.37839825624193169 0.45853451321824357 -0.5568223573328871 -0.55157303506285604 1.1091985268524138 0.51782779499809639 1.1423045757547328;1.0388810609205261 0.031308146711934673 0.21960600852131484 -0.68326202594791074 -0.502629695567128 0.55178350527529718 -1.1494536903230921 1.5887581810285272 -0.24587236718113753 -0.19902946117714718 0.12928103184349454 0.15826866726949096 -0.82392925010488649 0.75966481503175021 0.39268074256788627;0.059436031188201566 -0.096775865132990524 -0.2787647196546712 0.61363952372486652 0.39983932941771783 -0.084954991035331079 0.095631160760297734 -0.34392310926290703 1.1310568280098865 0.40525233063056937 -0.60687603062923667 -0.58412593863269213 -0.86485296775066811 0.44327492172967836 -0.69849916265517087;-0.096016320155279722 0.53141821427619995 1.2783325846398452 0.64364654177561131 0.63495079425480194 -1.7795703251141894 0.56686455199333896 0.32197178848206487 0.78600675677367049 -0.92140205127343366 0.41863335127460893 0.2069422365340802 1.4268668469797858 2.9169825145998591 -0.6576020441630146;0.058010148466412302 -0.096967630033848506 -0.091008829454893025 0.82078950854549093 0.50708525394174953 -0.070187220391691757 0.30021376243814857 0.61163231841493615 -0.29813875465432599 -0.96936485732189404 0.39547423550055683 0.45033495086293929 0.49846268458975396 -0.22340580158871379 -0.35830971245469012;0.85826244497503912 0.22793719468008145 -0.59973988037414772 0.79381082442441597 0.37001720626038992 1.2537506223236761 0.10132844620326474 1.1287834826397913 -0.071315903950918039 1.4717265393510297 -0.28366943115739923 0.34536245992581094 -1.1920320545359997 -0.60813028902125166 1.2096666077303277;-1.2250303660367099 -0.0034138384285945303 0.17717954398786495 0.089941282300336281 -0.15785314299289993 -0.87428754769178463 -0.46194935494409567 -2.4066874881965958 0.64898084479416773 -0.1952222149049827 -0.92498568024551908 -0.83986708322927417 -0.7835061517331694 0.36400555112034477 0.71227075278194107;0.73163012012002948 0.59456160627564925 -1.0995950830486116 -0.18795375147520468 -0.42596817100744738 1.4706845118518685 -0.35493988346052169 2.0910316537942037 -0.5494494495845379 -0.83565400817334579 0.16736929338287221 2.3466456444813266 -0.15872777668508242 -0.45101826526154637 0.26057806540674422];

% Layer 3
b3 = -0.66969723686000926;
LW3_2 = [1.5066057317333383 1.3725202112515547 -1.7005168145766609 1.1922614383989176 -0.94471225397243508 -1.4194599273316406 0.62069939134699836 0.33714876723024179 -1.0276693689386265 -0.41618625547824833 0.40462882926620142 -1.1815646716038242 -0.37700396548991533 1.3659390399569311 0.35448134302780554];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
