function [Y,Xf,Af] = O3lomadorada21(X,~,~)
%O3LOMADORADA21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:41.
% 
% [Y] = O3lomadorada21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.290275761973875;3.96825396825397;0.00572573718866304;62.5;17.6991150442478];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.362527472999612;1.1303805420553317;-0.78285000811860728;-1.5603126630567974;-0.40943909503041015;-1.2980032246071236;0.73812327542168565;-0.15646099275918429;1.4039074195373065;1.6725865753776845;2.459657796403695;2.0180266030515068];
  IW1_1 = [-2.4983181577155094 0.23815153146410825 0.73729542957069638 0.011745138448836682 0.088914055385044988 0.23465896218138443 -0.086989501558569007;-1.6053610268255705 -0.26764511967452292 -0.64838226956958811 0.44299610864709882 0.46338520210732881 0.011978434339326305 0.62713727210161307;1.336537726516942 -0.20822384742072408 0.59453448612629134 0.39222817592451287 -0.59459364205589516 0.19242242471294613 -0.31665627893658216;1.9538794936288546 0.47978593741736575 0.099271766623610036 2.0044815241421179 -1.6552098358499063 -0.58145481522136189 0.31443355111467247;-1.2775299798862452 0.35275840816766979 0.0078140716836666915 1.2930580761194792 0.36641763888189294 0.080380222975544466 0.93623689520905551;-0.95461704622672616 -3.2270902305597913 -0.77228436720690574 0.51343780766872193 0.44547668536063806 -0.17210390823274965 0.27413343074932961;2.2230126707657778 1.0311561731277388 0.21903441850598693 -1.1994512977820113 -0.26913540621447363 -0.35601167161119762 -0.097349400144763593;0.68200280457317708 0.81836905231799706 -0.040522125222273157 0.62779728998170781 0.86375234542378931 0.1716065965406916 -0.26197742719007866;-1.5862882518319192 0.5428228726951404 0.022155967337766418 0.4456882895226203 -0.90399492426270056 -1.0742953561900543 0.58242743424770438;1.7531331462211091 -1.0134313444348675 -0.89303876353081513 1.047974035973076 0.25507231056564234 0.59400304350499944 0.3895981472596281;0.24070535109800645 0.56488567850971261 0.37190844683994884 0.39944181407786383 0.96041617637454946 -0.65621169392573864 1.9740996489027025;0.70872318034140214 2.7972915483331469 0.34762634486204635 -1.2747324225547509 0.25917282638835559 0.59572051035135554 -0.5931749505177133];
  
  % Layer 2
  b2 = [1.4442188713400772;-1.7447339515650322;-0.89812055740457031;0.96966066742561108;1.0244384893338208;-0.31965797498973231;0.68196589308315858;-0.49312296653934451;0.06320522725913709;-1.7128941182287696;1.249222124090978;1.6664436159123297];
  LW2_1 = [1.156677165480557 -0.21854647374751934 0.30082106334061998 1.0785328420488964 -1.131475767748547 -0.71056948227368932 0.54972493913214793 0.36163461358790872 0.050486753844525945 0.9745398078362818 -0.60824158836459485 -0.9567555569264824;-0.5606500451044919 -0.89441524656905202 0.41871597386701076 1.082156931207632 0.65226743210732874 -0.27022584630765389 0.5721000152569039 -0.55042674721818163 -0.25704988737195739 0.68114952719925981 -0.4016636706732023 -0.90988162026758312;0.73487123615246741 0.26341180857178415 0.55725552957947933 -0.72269474898179065 -0.6832866260796433 0.69015999556513918 0.87831001186149005 -1.5852165280548038 -0.44407674555054566 0.37207963158509022 1.2611613986668921 0.084536347196396522;-1.2628123462947212 -0.606577346017244 0.94807113274837085 -0.67379143336792335 -0.17906424377799751 0.27242681148959269 -0.29162383550258053 0.86258921742210815 1.1981173998271515 0.25021798009618618 -0.024602121564853852 1.0377094752920097;-1.5467920268636584 0.92023235025421801 0.5934002442426396 0.43213159106566179 0.53000554478793616 0.71998638147545668 -0.74719459134902644 0.37730018353554479 -0.3998381509416119 -0.75771072261987393 0.44925394196077123 1.1529025487078977;-1.6197633090856274 -0.27475472585459454 1.4760041771559052 -0.87303492253336645 1.3169536566542235 2.2855269204749371 -0.01117816669588495 -0.76927210747396235 -0.42501454983175868 -1.1400149101375963 0.64337724353184167 -0.38540831103200551;-1.6400179185423682 -0.19398954039213087 0.84486844719308907 -1.0659273139342695 -0.63857730988623673 -1.3178331209235115 -0.21237295741401879 -0.71933553393074934 0.6229906083869392 0.47513093539150641 0.20758195681124472 0.91793189520298424;-1.3985788384953277 1.8888738085205572 0.56780080397619925 1.6570548016153375 0.35558689625746293 0.17280063239407242 0.95317698233952208 -0.66691353575284928 -0.77006038298410173 -1.2730987745440248 -0.29498507377308952 1.2965645398125931;1.7739488390257561 0.3329087961174394 0.12002252378646711 -1.0805494628477963 0.98557460378705508 0.12749353188685578 -1.0202667418752298 -0.38302549505101824 -0.063203144658693991 -0.094766535903513943 0.21773230827059217 -0.035414388342156863;-1.3937132778150845 -2.2824157439897195 0.3717256639129693 0.26538683418292874 0.87490317267898887 0.52058140742008263 -0.75979276661578743 0.68736742319485922 -0.12756666260789451 0.90459075280989854 0.16739773953208886 -0.29816051253612535;0.76156322862263615 2.1239053144008033 1.8225643213601745 -0.4103170559900059 0.28419637730209535 -1.2685898666758539 0.31890299974899045 0.98886832790294255 1.1981404956583543 0.011040820571448236 -0.54617099014998005 0.41990472610221652;0.44033788226075032 -0.73636647629327701 0.014578326595700554 -0.012720528918314974 -0.50543459333919094 -0.83474064502805512 0.69152960902234595 -0.17548487392653311 0.80297520400549283 0.52293794079908451 -0.12590319470202069 -0.35841169028880976];
  
  % Layer 3
  b3 = -1.4447996099713831;
  LW3_2 = [1.1880404836462337 0.80079793789428455 0.33224263472846827 -1.1137111163970794 1.519230383988188 0.53294394250352672 0.82838320886256533 -0.71807779069784616 -0.28412548991620223 -1.241536491777756 1.0365016072884232 -0.9515106004179501];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 17.6991150442478;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
