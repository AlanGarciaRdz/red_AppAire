function [Y,Xf,Af] = COMiravalle15(X,~,~)
%COMIRAVALLE15 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:46.
% 
% [Y] = COMiravalle15(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.9083150249543712;4.1467738751662759;0.74313909766271513;-0.58017942613279372;-0.88522026625531713;1.9822091465822387;0.51749853568137616;-2.3201096177424119;-0.53975761756046425;1.4115271219687717;-0.4327628952903087;0.84581948352990888;4.0000350746828932;0.63962038882387739;-2.1198919792153368];
IW1_1 = [-0.87284052044377414 -0.65586633186233911 1.5454340971021572 2.6225732982595846 0.35525569768842041 0.37421377978638326 1.1942458282283912 0.31795980228642984;-0.23909019525921085 -0.88500359831698427 1.2003971306122585 -0.32183160251443227 -1.1749599316040904 2.493755069735792 0.015815623453070596 2.3228391726701756;0.43586009347355426 -0.81501981103009036 0.39640516191848651 0.030901604792014675 0.1773670537327785 1.7832551017041356 0.30591282961262217 -0.33976167778965921;0.10147385960604209 2.5476414064913149 -0.35694535074188199 -0.0090023550538860381 -0.7696262438052045 -0.92649842804984017 0.84621838596896048 0.44810986018727617;0.7520244140023209 1.4942494251685809 -0.097589864153407702 0.022709248309677771 0.32674087199822799 0.33866714293081446 -0.080673940777373762 0.050955828334073611;-0.087849345448900246 -5.8782543851028439 -0.68872587459689172 0.049375431788893503 0.17625431345468398 0.025865773545742776 -0.20719709151818461 -0.28019565489295811;-0.78137962889574375 0.78755548120510122 0.82789342445403535 -0.059487841612921248 0.011154932475947307 0.89417077809117995 -0.13692308263767675 -0.38546700047241417;-1.071154907632802 1.3175170631494735 -0.53811271469108379 -0.69554552605924758 -0.1052028933799173 2.6031425810434898 0.61743291270038925 2.3979756873607889;-3.9380436744933442 -1.4092377485289544 1.2967878718367525 -0.69084656135095568 1.5554078708548196 1.6382510157047476 -0.71549849969969992 -1.6179724868928316;1.0343118471857251 -3.505047385479827 0.90584826839378729 -0.4740810193460126 -1.2472790141752672 2.0564327413784014 -0.60391577944100649 1.5104980176211336;-1.3667659490577035 -0.75193797731147327 0.35680246699623031 -0.78777380900116245 2.3016092517064055 4.5784623218110871 -1.3571212499606362 2.0981986806358224;1.0185951169274901 1.2569701776950939 0.39166754286092176 0.52077289169845542 -0.38789357550633191 -0.32829023379171351 0.11625413555635593 -0.80639635591561698;1.7455165828267338 -1.4086219499413957 0.55244017006019308 -0.63235563285040575 1.3386279990911931 -0.8376292043074014 0.17373745071075372 -0.15240676018534768;-0.52593118575553954 -0.25089338781094866 -1.0206975737018422 -0.083252400686495073 1.8045129272915472 0.43166546539936945 -1.5905635765658073 -0.82178357592501894;-1.3311086246616133 -0.72541350706781149 0.92645214979862278 0.82899437050398161 -3.0603518625072832 -2.1268233387778013 0.81241031039594469 -0.67802000723830202];

% Layer 2
b2 = [-3.0248560488040011;-0.87172293280346835;0.63501905403260828;-1.2998248086082149;1.2339907530654544;-0.3200902961993507;1.9756762511944035;-0.26226532064978564;0.15309855374491152;-0.63722233643641224;0.83092535892209141;0.88290993837929777;-1.1257985700620374;1.6568031820921414;-3.3536897181318199];
LW2_1 = [1.7235894562018275 0.44929122252689024 -1.0687801639216459 -0.29048353354644557 -6.5203297922924843 -1.0649531443758362 -0.2708210987867582 1.2191473363652578 1.0241400030297996 -0.83846934740393342 0.39957265611423409 -0.27193377202125329 -1.041454286427546 0.78252671658962891 0.3930119933520636;-0.45767542687062335 0.063788926942093149 0.38476077504672029 0.45554148961935176 0.0081651404608438713 0.55154990439588736 -0.048724277487043111 0.71000663214110871 -0.090028780307609163 -0.36899056965053711 -0.11647233999019874 -0.79173380584838382 -0.55641268288324786 -0.2678115446882845 -0.97671726942906933;0.16908082732839405 0.12711377275291696 -1.0669382070428544 1.3886866483546589 -0.79708016843908247 1.4728321160793394 1.47549906312919 -0.56637082626343094 -0.32777484160356102 0.33739846908835269 0.078464013148678138 -0.96557883791927035 0.66727743668106532 -0.53880009125390937 -0.99656113092020226;0.055067698842109158 -0.55342633968560839 -0.031654688139665071 1.1339674253526562 -0.32049125056896455 -1.9716852077905906 2.5186858266408048 -1.0807365741202124 -1.7344548191440936 0.021102105417932317 0.64227656736829342 0.45885521237056753 -1.8768346522355575 -0.36136278695165736 2.1796825958511548;-0.82766327204426893 -1.0216209892351844 1.5861111642414676 3.7217731839299888 -1.1406805909331976 1.8999299615538017 1.093068811244325 0.041716886836543829 0.10463818859003712 -0.22108590170285544 0.64379891681401125 0.31100302853857098 2.3297816915664264 -0.019889935734692984 1.6564614226740111;-0.3354868924131349 1.3682441756024544 -0.84535098170004253 0.26035124462663323 -1.9471268659315293 0.45864255001683396 -2.4050600408188969 1.4190210560797871 0.33936167379918064 -0.6063671543207656 0.062702462529164713 0.47493803296733383 -2.5842393960832912 0.73945465869381011 0.31979964800261917;-1.5713528990941232 0.93132514799037214 -0.62629978694235655 -0.20116066666227872 2.4692985071747193 0.68724273293711446 -1.2416714432450247 0.51033477978482156 -0.30395243179193832 -0.16444504901806614 0.29497653230058324 -0.21083006753650191 0.99636169155864185 0.55214997558223589 0.5039703240087251;0.67231152084386026 0.069608566272399683 0.93481027379638271 -1.2444672162381192 -0.093470641439134236 -0.7550715549958108 -0.87146663250185075 -0.089303343494521792 -0.35808135908995548 -0.2471672127917833 0.15937832909861371 0.57655378015017655 -0.12226030335976398 0.11747159061582993 0.15386914289050724;0.054181734428786599 0.96173765896617192 0.88446418000702032 -1.3980015245708448 0.15358383508378998 -0.54582453296307409 0.59831047519741654 -2.7132731950868685 -3.1893653706665166 -0.54962506789965215 0.23659090962762316 -0.74657402767496162 -1.1365307402155078 -0.14729350886872256 -0.28311394577816429;0.06775232129602525 3.1423871714391667 -1.946501686026207 -0.80307188534159124 1.3182328379003805 1.029826905843003 -0.34337064578213672 -0.83551531953152225 0.48201461024807635 -1.2497206755017287 0.35927875590803204 2.1791721899285497 -0.064693513060939845 -2.5499182390811814 -0.29998705270824921;0.9921359301958701 -0.35148194968902419 0.7157301641249143 -0.33839302911522728 -1.7985475201707233 -0.88430036755225794 1.317406224320772 0.79490169098343755 -0.82682674828119673 0.10270502926490087 -0.27007536335840193 -1.4282349023935659 -0.18025937097091663 0.107880933448133 0.035616424591103361;0.7554039064452146 -0.23313185648982054 -0.67027719037346178 0.73912215021578298 0.040457541340862942 -0.15999693903295364 0.94445427415066274 -0.17822238432594792 0.26950291004104243 0.38468973564136344 -0.20470370790604561 -0.042043568737288282 1.2599644506361161 -0.01068480560626334 0.62657464569719157;-0.77147391583248781 0.62720704340619582 -3.4649947846001448 -0.020623379135404352 -2.9095046160396554 1.0545551730067229 -1.6843859016100478 1.5018384397610156 1.0495926813934544 -0.34933719373502237 0.84140093662229787 0.089329637222536368 1.8847485938353006 -0.32373769908230343 0.32693167133008816;0.24756977584455536 0.147397423548566 -0.11758794109432151 -0.69660637254832958 -0.38042249972188408 -0.91358580139479129 -0.24410814237742873 -0.63323727971883192 0.055381802007213064 0.46713003958397903 0.20925815389502223 1.1088376944947835 -0.38358911476851654 0.43275081413646044 1.4510711592693031;1.9145294805118001 3.7469858558256868 -0.085004837646869974 0.33003373310794637 -1.4065918592695927 0.89491163307210353 0.14403239394490389 -0.14964434272919452 -0.62826405748890879 0.51610367855585959 -0.30478727094395636 -1.8289169416266311 3.5372803883676371 0.98404409475794963 0.80409807923516574];

% Layer 3
b3 = 1.7934914744961958;
LW3_2 = [0.51128247281826922 1.6498698586668541 0.76978894096103789 -0.20262963862025621 -1.049286182310269 -0.45862873774456581 -2.1414287542185049 0.75162253553633396 0.23103224822860616 -0.17139996893606432 -0.47096515654600263 0.83999034543567264 0.12846475523892451 1.0488805804339227 -0.17847654115603645];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
