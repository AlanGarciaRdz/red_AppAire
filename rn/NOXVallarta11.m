function [Y,Xf,Af] = NOXVallarta11(X,~,~)
%NOXVALLARTA11 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:27.
% 
% [Y] = NOXVallarta11(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.167789250704798;-0.50200399777961302;-8.6667598245363671;5.8583238726646307;0.40608639231539806;0.02202506192430316;0.65450376397027299;-2.366577305432529;0.44930931724709289;-1.7950386628199011;-6.2136295997805249;-4.0357481406849525;-1.6713437850395276;5.9926503787136793];
IW1_1 = [-1.0607252151781239 -0.87385029038373674 0.49657108759348473 -0.21088344631132858 -0.38695864740100377 0.094420409611045572 -0.27351878287740305 -0.36548589105739482 0.30287286140523373;1.0692790228450439 -2.0276248522947604 0.63285487237544358 -0.21313481466166295 -0.085988853292698175 0.10172653667187379 1.1553907155883476 1.7400065279774131 0.294794583275785;9.666763701584113 0.8330202192441416 -1.2742953524565594 1.1141162081592597 0.47207432202693034 -0.28373239200911399 1.2109532643565637 1.3085904480146815 0.14544530020015542;-3.1534030910057731 0.75729258441891856 -1.2939030517725574 2.9454788450172438 0.35943979542947141 0.61041101058538949 1.5237494896432222 -0.19131147961296183 0.41020350274228795;-0.22851978701134706 2.2886462550741262 0.041782107662262299 0.48142786809993965 0.12155587140651282 0.059521601061259907 0.85839024831532473 2.9429262158683285 0.041012812997757636;-0.22696350470505641 -2.6871491872137194 0.0188639890800456 -0.075421142294379628 -0.15400606965448269 -0.14780575699653473 -0.41092433853005894 -1.5855092269764328 0.023787257481609425;1.2020506740869392 0.28375497089577556 -0.19828320677697575 -0.041514153756017268 0.25946344843147462 -0.16337724255184768 0.30429219754287234 0.36862274011311896 -0.25794848898296996;0.75259683118219856 1.1537796803133575 -0.4473531002642771 -0.38533983815908213 -0.031217527708562433 0.011535078946597697 -0.71339873706869372 -1.1909062624791202 -0.024748676179852151;0.042962537364191943 -0.80497706176835793 0.10888255139270586 -0.10357132652970366 -0.11858006598405123 -0.10661163391011269 -0.15034032415008267 0.20289296816273222 0.061366419838733796;-4.2764758511743581 1.0996103388045577 -0.89003319680370174 -1.3384696439958486 1.329583460539759 4.4905027377608757 -1.6047482369453332 2.0847527438117872 -0.57708676891814936;-1.3542188437243052 0.75243654625368339 -6.6938499237548488 1.0698990321540718 0.21163286033803627 0.65383056214946333 0.54955925119285898 2.8682444668150113 0.1352660285169639;-2.3789734593706759 1.4067342363617432 -1.9501554585343075 3.1535924562780124 1.1298493484977095 1.2691934338491115 -0.461659144799342 0.57996539289430227 -4.7032595800958594;2.0672852226645952 -1.8110423339392727 0.18407442592103124 1.5716013216282259 5.1179087410029167 -0.57753515238286823 -5.5618102405274863 0.39050806939793314 0.029314894116307895;1.4872169527752812 -4.2658890883821021 1.4628986683328895 -0.18433737215502094 -1.3911986081766849 -1.8943698063612913 2.111915583492658 0.64623839170966457 -0.24228890372678127];

% Layer 2
b2 = [-3.1266595904590191;1.129922140929843;1.0575345944502548;-1.8779888825894675;1.8515926387988153;-0.61893915863986249;-1.6704477739748205;-1.2333565276184104;-0.82107814803964718;-2.1676769431944458;-1.4446707763403204;-2.2825963184010791;2.7604403325370321;-2.0052757069954521];
LW2_1 = [-3.6408792148888924 0.94649522892986193 -0.6476797176693041 -1.4363612933312357 -0.57860194094202022 0.09632111852852232 -4.3432061118203524 -1.2542157822118396 -1.359141121309299 -0.22522006035319905 -0.65811782482245818 -0.66170690566660317 0.35367566312532711 0.44154307352282068;-0.54066025988364308 0.0027201971623007151 2.8119255416072062 -1.3616357553888494 0.28674719598529214 1.4653857921093603 -1.2734307576272166 -0.38029111925372971 -0.52917530730282925 -0.16535991533713906 -0.085800209261995136 -0.39414781729352127 -0.80016185255327166 0.96832478204348149;-0.063670026201572971 0.23432653599118974 -0.42700580595045012 0.16397073835601711 2.0677057835432073 3.3435665760689925 0.44283514563086179 2.8927158606813688 -1.5258498480943263 -0.027200827226681823 1.0853652177059976 0.20961629557173633 0.27238834936644046 2.5328394255524262;-0.17832829431235109 0.87710582529871006 -0.76402585873030504 1.5684953371541541 0.85445364198971341 2.0901870259410891 -1.4765798404144967 0.4889747493574082 -4.5221571437744075 -0.035946609139025081 -1.2787669616254895 -1.5533706428240119 0.00059074771357363678 -1.5809647040179362;-0.95545455812438806 -0.41140416308234423 -0.50615763480656717 -0.77447121726195933 -1.3912966379162894 0.015533372009846245 -0.25801794197798239 -0.040721866519951258 -1.0483873728019468 2.9486834328871385 0.50992483121011434 -0.85740167124558686 0.34455224675870599 2.4316273152676646;-1.1555762037379236 0.18821369485029951 -0.49166202033539047 1.5136212658327322 -0.70815596465340502 -1.1639805429252832 -0.18110989532577743 -0.089181695235701297 2.1724273428656899 -0.16167995932760051 -0.89553710202673564 -0.19981187495622857 0.51553020017442663 -1.9885905611430084;-1.2561116898436382 -0.029717153714075323 0.41276976377017577 -0.73613044462306698 -1.1671566617082421 -0.64995668589747246 0.24942819375203293 0.43699256170632561 0.098662902902301411 0.70557673866900994 1.1725144723962835 -0.3158263662703491 0.025779682926848103 0.36782506862073644;0.61445767729130263 0.24840149603293785 -2.979260872607048 2.9167323965065695 0.72991178834407744 0.45543360547965256 -0.85305189509810952 -0.98459745773383089 -1.7284209016950005 1.2809706858474292 1.3767325032267592 -1.8136495095599037 0.30693321672825113 -0.88034312809284443;-0.85509785777254721 1.107047365426916 -1.52741406124725 -3.1962279932249937 3.3281220058335244 -1.9029266258917734 -6.0736629782979579 5.4931428460631686 -6.5803956013051996 -0.18543654678444565 0.55833040667106271 1.6406119233603675 0.24985227325658241 0.61633266687391697;-0.19629137688202719 0.71575224800769721 -2.6141883488351199 -0.72446760342617855 1.4131013663815946 2.1065353596086713 -0.64498457843982737 -0.69431383555178072 -2.9655504973903586 0.048465641095505448 -0.63549605305346291 0.56485004257788463 0.065936474874381298 0.2734169839352148;-0.41587316289002751 -0.076749717745993984 -0.12995400081527808 1.09109687332459 -0.45921743300469869 -1.499219305779294 0.8688717727274361 -0.4805304047860523 3.7856299118983565 -0.10776297868695864 0.19369259173316095 1.2545677989227799 -0.20984233852030734 0.32878980520996509;0.35165299767005048 -0.21126575343480247 -2.7037344062862552 1.4398075516639326 -0.2369233898016832 -1.5043772996791012 1.0384190996603591 0.35123635422291566 0.54669252130114199 0.02734446907981343 0.39113301145039248 0.61734840279123582 0.49912720420577833 0.082180024420636225;0.22883521642459512 0.2620568891601962 0.81739108657070447 -3.8861629903692498 -2.5053080756552433 -3.8587643676298025 0.15205122020076811 -2.6755148664155555 2.8001649560592434 0.08289428694241105 0.57615881951429015 0.1086026972483216 -0.43082139484655346 -0.24887320078316655;-1.1704090063359496 -0.24824361235733833 0.60772839988517635 -1.3836405359984345 -2.0549592676082815 -2.3589608144813461 -0.27701656536996416 -1.2026115995023119 0.90178999282717265 0.25976574476877845 -0.70538391450902349 -0.12197956898367668 -0.28789924217211371 -1.1767013271469815];

% Layer 3
b3 = 1.7171479357855854;
LW3_2 = [0.77623434720602003 -2.1630963823026019 -0.8020353955290328 2.0398560907952881 1.5698369375077164 -2.6317437402475452 4.3927460171763579 -0.5306426291201759 -0.3399943249682526 -1.421756040329808 2.944284318623883 -2.0093984930832218 -0.9017129000217381 -1.7186697838315739];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
