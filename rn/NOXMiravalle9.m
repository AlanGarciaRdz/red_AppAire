function [Y,Xf,Af] = NOXMiravalle9(X,~,~)
%NOXMIRAVALLE9 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:27.
% 
% [Y] = NOXMiravalle9(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;2.48447204968944;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206;5.12820512820513;4.16666666666667];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.8184384285551254;-1.9834257139855813;0.63792840484407831;-1.4247719904912015;1.1675104563983674;-0.049426292669098461;-0.71392536780708837;-0.11901437265247636;0.090816395554187607;-1.9847274453641073;1.9328046386690307;2.1336187518331986];
IW1_1 = [-2.6701879152402062 -0.037993594063352468 -0.40974105979511644 -0.16907934862886889 0.36912760911576314 -0.80500516616171558 0.42125964199060312 -0.77442547458269084 0.64190765775751168 0.047525761667934777;0.13345884423056584 0.60676909827354153 0.87517756884183329 1.1312467360303831 -0.72368724449813671 -0.88402174022279911 0.19320997548287655 -0.023577600951018594 0.617839973328004 0.027592076993788271;-0.062162276247864197 -2.6021821383626702 -0.21054458311476387 -0.78293150468916684 0.3967111800578057 0.13958386817264873 0.092315398180565139 0.11641710682941514 -0.10175733208799521 -0.33436585793014828;0.020345423686669768 -2.770047350570128 -0.1949884622377549 0.47368162670652147 0.2098987598630479 -0.41621390346815823 0.039841386107960661 -0.15199228792927044 0.26242544901224141 -0.049577688954805785;-0.48132657640675691 0.42422562351721216 0.71426070723451129 0.94429958389424062 -1.3408739650878179 0.65548657438437319 -0.20947037474597707 -0.062836457664622369 0.065958366931578916 0.81212365082705917;0.54236012491397345 -1.7061544007269132 0.73664633001610946 1.9583786868002282 -1.2769539110978965 -1.8790089976613387 -0.035994297607906241 -0.75586314063725446 -0.51187289507477607 0.64701779978887508;-0.24018773258897175 -1.2265110659306264 0.10212984040527148 -1.2875463250852144 1.5514174015754989 -0.56400135492087788 0.36973195072072379 -0.65933226627094199 -1.6066578210322757 0.099593338011337185;0.010518866607608993 0.38064662633766816 0.55428486705137836 1.3913276409599713 -0.016616532907534134 -0.24133463135486399 0.27286342952314818 -1.7552625320911448 0.18748464396459597 0.42987562374780114;1.6821279368428419 -1.8356754253509036 -0.5311841722735211 0.32911702020264133 -0.71726557864722407 -0.6369717022783572 -0.050607251394377613 0.47938438218202151 1.0451968890130459 -0.54618202538322924;-1.3192116967597427 -0.47502636071494081 -0.52494292923425556 1.160941883421146 -0.52929975832428022 -1.4780349095425496 -0.093283077801847622 -0.37836478731805195 0.042193549965102287 -0.1124102877140036;0.55348254932062868 -0.039265182421549284 0.43421878629070199 1.1393411071036517 1.4732936572888322 0.77513923273856056 0.17167898613875035 -0.24788689677512235 0.034174963716485256 0.46521459350880534;-0.31174067740946176 -0.11034618995341158 1.1041817622301218 -0.0082079213180382294 0.85083663486774774 2.71110743239046 0.1972582101423257 0.2349808786690149 -0.010375103219037556 0.42805348694334577];

% Layer 2
b2 = [-2.0521496434546256;1.3672843523580336;0.57211877660621524;-0.6409516755028144;0.74709391093590438;0.25180948645618895;0.47147673375809562;0.78728187707934605;-0.79247360469979988;2.0008796761958227;1.1084897490041357;2.8339198976898636];
LW2_1 = [0.014758949940563138 0.85443739930737961 -0.51572427217033634 1.2119571862373124 0.32087868664446895 -0.26252599049513903 0.20690238919051693 -0.58725736144249763 0.70807963709610444 0.71029244519122359 -0.70770013732395509 1.3428563162796505;-1.4096599986760081 0.67421893587905479 -0.30184139882156152 -0.25836182302939459 -0.60853940533991446 -1.0660767399630846 0.71594172832841652 0.34879418675661894 0.42291251618801984 0.041597143020517306 0.12900118408280983 -0.92589124914523946;0.38891880122455341 -0.32463616010517687 2.6389328238923184 -2.5685696252262105 0.61282085333501302 -0.95715866096533475 0.02249628722327985 -0.29583063485651817 0.73815186707405467 0.54914692165769752 0.94245397111269258 -1.0526254084028621;0.28603319373193947 -0.0042980167306986179 0.27647093011232443 -0.070791872401382405 0.62668279079391576 -1.5903104033965287 0.15115165621507204 -0.28904733888566886 0.098205506468099113 -1.1441210076331378 0.092405296015030489 -0.81672030364073178;0.1359578217960056 -0.62357045623005192 0.53902223655176396 -0.25019071340865884 -1.0565439200970508 -0.02104587972070858 -1.2872587803179265 0.52867574185752286 1.3561032334663881 0.64790514051887294 -0.36879554209585413 0.56380230546755883;0.073643420501315379 -1.0559851265618363 -0.16316505620078853 -0.52504239915578399 -0.2499425799665021 -1.3978071227544568 -0.35968364653519658 -0.24425869749167789 -1.3290682111836194 -0.2893435028161781 -0.079941479048068989 -0.23876724389537221;-0.57275092972436537 -0.28304304684243453 -0.42954098115324207 -0.35779484295437664 -1.502526677884322 -1.0475954583953269 0.077649907186583225 0.46208891012562325 0.33704879703789775 0.31758306152949972 -0.021261127558659866 -0.9817380283498498;1.34381411988559 -0.83761578039818252 0.10046804976766807 0.41057007351234542 0.42373605291795385 0.17747906343454331 -0.70544161304982034 -1.2748463665830285 -0.13868053238547784 0.014562271401989074 -0.16147419518674005 0.55311141751830128;-0.13720228382581867 -0.38173253279057134 0.55448184595097327 0.23183328086893085 1.5528277822950898 1.3012514224373701 0.10987416901938717 -0.51459309261524733 -0.63967554569144958 0.093156311813814285 0.058939231598130179 1.2949180459086795;1.7718813753096323 -1.2933186720285439 -0.20631153283470191 3.4363475666240304 0.27633457641882037 -0.055085170099894096 -0.17112189060100799 0.063871258283691182 0.30797362937984557 -0.92786868817362711 0.77495846330467621 -0.8862407324386784;1.0282113140652867 -0.10027246600229202 0.37079190839197984 0.80132104058698805 0.13026759190560908 0.15323095665565284 -0.93200535242180671 -0.5164907361930301 -0.10417731084774248 -0.37874799411256244 -0.04497012825790881 -0.095177572129182125;1.9398372052745876 -1.5356419447556011 -0.39105512619458316 1.1414257908660832 0.58088692766309924 0.90598179509448684 0.13591533514674586 -0.24679566547636442 0.56722903242404399 1.2889669571370086 0.87724189572235711 -1.2762614663058893];

% Layer 3
b3 = 0.90162769510138974;
LW3_2 = [0.86298075025621246 -0.3805294704847294 -2.1384139441700873 0.53234317448538682 0.21258308785928634 -0.38289959123060535 0.93151227307015461 1.6029556463757946 0.69540813072471686 -2.0566087766744454 -0.878273979566084 2.2965187321327005];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
