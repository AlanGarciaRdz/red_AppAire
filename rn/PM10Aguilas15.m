function [Y,Xf,Af] = PM10Aguilas15(X,~,~)
%PM10AGUILAS15 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:19:50.
% 
% [Y] = PM10Aguilas15(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.1064199580679395;-5.3137622890257443;2.2603266487564748;-2.0040196535455368;2.8535989404891962;0.12539167631909726;0.64191042799765596;0.68197059785588698;-0.42432320785337618;0.19541709719700689;2.1106218680807811;-0.3400928224968231;-0.49982067021570953];
IW1_1 = [-0.10773849606760978 0.053790351190433322 0.40483752190438982 0.89021934977171968 0.89779584977480231 -0.28589633203101761 -0.21176199705040782 -0.49285270549492122 0.12451004719522121;1.9174470215245691 -0.22283067866810757 0.52278743644230219 -1.7986516267218235 -0.067954063596141909 -2.5484960954801883 -1.1175857442472383 0.073415692105966809 -0.61886307746553149;0.086007915869227319 1.2520133226056223 0.24678479935766048 -0.46721259066889481 0.22965181533209253 2.2941645640652988 2.5729317988041758 0.029762746437590689 -0.4420690612908264;0.21143407998643818 -3.0772154921388055 -0.73518068622005606 1.0401944685351219 1.4659678718100884 -0.16753742182413356 -0.45093387790807477 0.1040384337799658 0.55633740635858608;-0.78571809043855345 -3.384263111351113 0.62300475059358851 -2.0108458949834356 -1.3555102907514247 -1.5001215777293631 -4.6487213315193205 -2.1236401916939585 0.14052577913982645;1.1032046335986274 0.69691658218113339 -0.42655663255744497 2.7103709693975322 -0.0052817845477638944 -1.6825133619023589 -2.2257074571554427 0.70551471598294679 -0.33725375000319996;-0.52583850392058651 1.1512511057590133 -0.56101222068330714 0.46350967731730097 0.59035167316637138 -0.36170897382621797 -0.21791330569941397 0.13996029357873327 -0.03176762086104877;1.0401512884113457 1.2079296634661465 0.19609364732786078 0.15121133350326793 0.091695768452717361 0.26341720338292135 -1.1128566779169857 -0.36320777354142569 0.19866809773424704;7.9046296991530776 0.77605963679289858 -1.0729236690635928 -1.096652658504444 -0.45258382576495443 -0.34445584203826507 -1.3789148768822814 -0.5955644663643167 -0.31039970806647926;-1.4384452191488639 0.81193891609675184 0.27210513428967548 0.75605896933181538 0.55302830974432815 -0.78056905599776905 -0.52931991738387119 -0.39477409632279037 0.10516268356379757;0.79047903507788675 -0.6464129518709848 -0.12604058336580959 2.2972157416212138 -0.46627428531145171 0.48330441921577932 0.37258177964319161 0.2490949919305768 -0.039821890198314343;0.64893738530092071 3.2003924209769581 1.0493321780986717 0.050097511021848416 -0.93859541860605777 -0.20200976790441322 -1.0803954316983044 -0.53043022412460517 0.11575851223121537;0.60223699178461854 0.50137732412407787 0.7528065580601333 3.2749011449396157 -1.8375994951414549 0.32321091251007322 -0.37482707251020003 -0.19865416539976849 -2.2763996172497039];

% Layer 2
b2 = [4.1139334328265083;0.11847429205003722;-0.22889109280640033;-0.68354506718525188;-4.0436956328742415;-1.6379497981058753;0.66257853817141776;4.3629460979814061;1.050450741325047;-0.16230238557995008;4.2757776827477665;2.0132751214733275;-2.8028444840498508];
LW2_1 = [0.80332223490228427 -1.1710835420810199 -0.54812706340047013 -0.52557027241881049 -1.0552458518458516 0.95970110773216744 -0.35902691424794347 -1.5100785118321012 0.43463771393444395 4.0233886416782001 -1.1292068024191766 1.0820598023245818 0.48972269297292481;-0.72100603319966849 0.097555824119560805 -0.45900734988918862 0.80979780100545673 1.0349777830153863 0.14857312609999079 2.8659269364078628 -0.063225333902478864 -1.5454115657646479 0.63187021184037362 0.77597910209593335 -0.54347188024801796 -1.3796083156877283;-2.028859889577785 3.9018409804923024 0.48039529693799388 0.16702135595390125 0.52606831784147234 0.42784416858577029 2.1253899268286829 0.034428229540695056 -2.6693870158008997 -0.20436491422214226 -1.4214907388526061 -1.1611567083083782 1.8210738901601597;-0.040103997945511484 0.22330917112062526 0.018328234134806887 0.38935036693216202 0.15263705542159364 -0.18072213015592745 -0.61056331933225694 -0.19671432070780537 -0.79505814150257359 -1.4460060254313361 -0.36731085290001075 0.63134330152946194 -0.22618359271538341;1.699829351574053 -1.532716385688484 0.49146317793027061 -1.8003502661177568 2.611295682217567 -0.13127366213186392 0.70458413987084823 -2.4062556924492058 0.76237802203056715 -1.0951928798780659 1.9677435784582078 -1.0056328159246466 -0.72251849791725198;-0.14308702565107984 1.5992684194819848 0.45474319139930619 -3.7287764096843929 0.2443923897975353 -0.69905870611160248 -3.7759650543449399 -1.2128734883066639 1.1735850255080591 -0.62826795931492563 -2.3727472904448574 0.27636553442511247 0.81442880521220129;-1.178267145270617 -0.91825065916251847 1.3020333318546156 1.1143629291561716 -0.37892349771396749 0.66044019018711331 -1.2996846549207237 1.4035999330346642 0.94611450404212671 1.5058925896917412 -0.67071507725813617 -1.4224344204923294 -0.58645774147931973;-0.93392446420350905 -0.11101669519127633 1.2494515312261176 0.34364516617543633 -2.731046352692903 -0.11184747801224593 0.95187017065913693 2.9994176673813873 0.75352274719979606 -0.46939846450303924 0.091964753468191412 -1.0036574650625623 -0.10160564082047402;0.089256132221882029 -2.5271723599041014 0.30540029953620118 0.56292634003165043 -0.67852442819973346 0.72637435958110164 -3.0465892323967334 -0.68321098421971671 2.3380678696444694 0.99663784160012525 -0.31190147044335881 -0.1594929423729306 -1.6017547478817873;0.34374192289557404 -0.068015294927194242 -0.12326684144118732 -0.78836270144796505 -0.47009662560685672 0.11222046669129249 1.6988458752993669 0.17312129592424105 1.006494318350228 1.1951469907786703 0.76269136718176267 -1.0204269784967928 -0.2605964722614964;0.59030377691832125 0.085527399502273213 0.44966387386645362 0.2991297106354785 -0.50360216942049274 0.14096413578749387 1.0995105269462457 1.2003414427159769 -0.0030597891441298437 3.1691636280251401 6.8899743591709974 -0.90108605688127386 0.054235843969288336;2.1269023618961098 -0.075872408618281706 -1.5133729535848579 -2.6332047548345741 0.57282818785455025 -0.47961625512978268 -3.8668082462629569 -1.4647474420453719 0.52385446945690117 -0.21215892377193862 0.55723833288408187 -0.24312788741621233 -0.52572187069072651;1.2247766170533672 -2.1622061528626726 -0.34147015839502387 2.5935376374563299 1.0520945236985002 0.73080581958184632 -1.1398284669704444 1.8005446781118997 0.34817107373207545 0.92564285046361761 0.57363256924290373 -3.8162806746025835 1.7701723591428866];

% Layer 3
b3 = -1.6626310773714676;
LW3_2 = [-0.072056923563803665 0.15321921031965163 0.13912165528092574 -0.73043394560613251 0.078450938357299368 0.091889781607621276 -0.4343221791152036 0.24291508689646729 0.30660057212205877 -0.46832559678518176 0.7055963381750513 -0.20379909835250906 0.055204103672049309];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
