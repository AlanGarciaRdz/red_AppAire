function [Y,Xf,Af] = NOXLomaDorada4(X,~,~)
%NOXLOMADORADA4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:23.
% 
% [Y] = NOXLomaDorada4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;4.5045045045045;14.7058823529412;0.00280033604032484;0.0179856115107914;0.0558659217877095];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.1352643524993824;-5.2217162317217349;2.5192559977700517;1.0070182689505229;1.8072478360912987;2.3705439312628958;0.53626804394204675;1.0051161441449366;1.3963834001790134;1.3743967085979159;-1.4201838317158071;-0.018526102831280158;1.2700389678055761;2.1669553992421804;1.8210720601147059];
IW1_1 = [-1.4798417951400107 -3.1508455573895309 0.144592307256936 -2.5792922271158036 -1.4688844204640161 1.7109805328460985 0.20221526837766596;6.8017982864208344 -0.2330752294031293 0.91881779029452804 0.071870517604047307 -0.057705601124545182 0.0080574230460532404 1.5587825476962989;-2.2730743766423718 0.68742457362709308 -2.2671006389483912 0.91444870724027827 -0.44244362313968971 1.4660147520192126 2.1984040526096438;-0.45948095994957167 -0.97888221250659224 -1.1615788032497498 -1.0117420629611633 1.3304615471863002 -0.28726171362357378 0.91321955381759357;-2.2983084181444835 0.47753497063402817 -0.39317200035332017 -1.8014216653926869 -1.6887089467062373 3.2013748952380578 -1.005942518775611;0.34608125708911353 4.7216008104085105 -0.49566675000581817 -0.43508648473902034 -0.35584233755111028 -0.053111467374032113 0.0366862414139104;0.18022164887297709 0.31639039204682018 -0.54942836996765165 -0.45261857098059871 0.883286339306386 0.22780501925878885 -0.6798540033981918;0.69949061683775082 1.1614708641009923 -0.96231459492322768 0.28335898935634268 -0.74423584878023485 1.8694425021198373 -1.0658247615099758;-0.56524407286051204 1.5059605305190011 0.51319280151446534 -0.01515749269542125 0.062583134207601865 -0.20243732912835313 -0.6860999307989627;-0.012432289810470057 -3.7681506501067306 -0.63723172880339529 -0.64689730145953339 1.0179066691809078 -0.18039743250015697 -0.42124538940152029;-1.9779709903514351 2.7059037815848228 -0.46605066708997328 -0.65853526930834538 -0.26578877533138145 0.082192093019754664 0.57945147403254049;0.9712685727055127 -0.37098176665399696 0.27060235284639134 -0.053489712139940367 -1.2947854091859734 -0.78094257966201341 0.76093030949196627;0.65779558898194745 1.0227857251491335 0.74300696276541078 0.4349726057333162 0.55680232598652946 -0.087971346221911342 0.2496098354271778;2.1806585947429387 -0.67981067027183117 0.073244042086462027 -0.21174215020320364 0.77473256401367707 -0.46051892658635779 2.1734784996219814;0.66313428853781331 -1.3411553812650769 -0.25170642789101438 -0.27663502225514647 -0.24032038674250836 -0.20620175589293729 -0.24461525390173736];

% Layer 2
b2 = [3.4828754357263096;1.8181755597918745;1.076843456136225;-0.86868114728883461;-2.3350575281008932;-0.80258391948109076;-0.91481529401177997;0.13034230748015824;0.75844811712474769;-1.0770228503305399;-2.5672175995952711;-2.7040447311649594;2.1440335795472194;-1.346892643668177;-1.4426279780539917];
LW2_1 = [0.99379135094049931 0.010544276534883299 -1.2561465652639845 -0.36429280035329409 -1.8574758247890815 -1.0398691668752447 0.11563879549434022 -0.48636026056410975 -0.69818335446506152 -0.84506348888754002 0.74143387401445493 0.16827248290657351 -0.91161613459564284 0.0044911823944113229 0.72647362465287757;-1.5852032338369557 -2.1877633557625171 0.59957828472436159 -0.57162819746769244 -0.088817803248414567 -0.51733956057119868 0.81213568890681931 -1.0653683750383616 -0.81896383562796271 -0.15059698085953444 -0.68267407417613324 0.81379695873780944 1.6180358329912108 -1.8923571578298173 0.8143895454590383;-2.1726038142429043 0.26343311714713935 0.46372247699870339 0.62060470146556479 1.5097809790352861 -0.61428840097493387 0.69538770232843883 -0.51873339972939181 0.39492053827391144 -0.47388257776414305 -0.60397175041415851 0.53834080927169314 -0.3335005247241718 -0.025542333853826198 0.19965784196197867;-0.76265048016535042 1.4199300885654909 -0.65740529091052924 0.91799901006440754 0.017483161206331088 0.60091808366329613 0.87581523795881333 0.98643360473862918 -0.85945101248528477 -1.0796488336409773 0.24317384817941542 0.3969568979201642 -0.11308135445267967 0.77361208924565694 -0.02121523262120812;-0.047419600008446111 0.65588566426319883 0.11893597076800996 -0.14320764311856854 -0.17787450856906706 1.8703196698583262 -0.68328061378130212 -0.5253220751060097 1.9845854025372036 -0.53082713631968936 0.1492198845382274 -0.0030831408508537536 1.2049474312149215 -0.92108433457966887 -1.0026294997823568;0.56063920070245876 0.64625252449128612 -0.26983569209080827 0.44690338927123746 -0.041732977459810056 -0.63014701433092979 -1.0945329897073752 0.28209462930414403 0.35035085990570081 -0.047195035066485765 0.82184922065215527 -0.62437229539900729 1.1928749739949829 -0.57725733734776097 0.31502622282659409;-0.91329659737620528 -0.41502538642486958 -1.9663106918048368 1.6342956942455078 1.2622777024736436 2.387591659826751 0.64133383597054483 -1.5222858058899973 0.60191005784865459 0.79527645632503552 -0.36636610484850057 0.18945867802952587 0.014970398005014526 -0.83383597240945728 -0.16985533411804804;0.76637751577797808 -0.79375036691130418 -1.7061044524137696 0.21986666315089473 -1.5396229714307834 1.6723346873625018 -0.016761239954102558 -0.20370377633886344 -0.49002619940559444 -1.2980890931784281 -0.067958535893527516 -0.23894386843288662 -0.60866121883450364 0.43203976700792679 -0.32287682528722972;-0.49445716944633367 0.060419497646291134 -0.040458390166192335 -0.22227063381554857 0.25344286155821688 0.91830966325352648 0.88590919096275689 0.23283934102349274 -1.2074477340451055 -1.0663975983964329 0.11551486948527287 0.48288968876161326 -0.20473281832216975 0.16481695463495338 -2.0528318956383202;-0.19264218154661841 -0.17371640479105027 -1.8231154323981118 0.84637707384772176 -2.6750578077484271 -0.076426859625381621 0.42143317009427816 0.67624661548534326 -0.39408330185268048 0.86183467216674359 0.40164042951408829 -0.91118437890022763 -0.17979819024997112 0.16581324880478071 -0.76261466741615125;-0.60347925469770458 -0.11556862236372897 0.94962946992818897 -2.3665931272172172 0.65456453680913629 1.2334897745094995 0.3753382606182154 1.6918472497250743 -1.3392080041184646 -0.91069824643494668 -0.58658989928757799 0.28158128137453137 0.17415737689664379 -0.44141948925143859 0.89968777251476828;-1.0175344346075865 -0.15565139370489126 0.90786092548176267 0.060912485238075867 0.61295334275611846 1.4348106240404594 -0.62509007725699817 0.78932225247921928 0.75897392181464518 1.1790215358457912 -0.57269660008904888 -0.51513367373881325 0.96039893040034197 0.26324474526211505 -0.36107819184929157;-0.32774077394699397 -0.56345170322918958 -0.35188238563597923 -0.23615366028050236 1.4468893605108397 -1.3911563200393879 0.50942669999855017 -0.66847032035353615 -0.89352437743762325 0.30730235058303457 -0.52724989434157066 0.44334197097116101 1.5957231062127522 -1.4216511554908071 0.16905776239689355;1.1467298193607247 -0.18187132056126729 -0.89396210150306676 0.43297884463927594 -0.40846656701555972 1.415750715615961 1.3986097545986944 -1.2186263514055804 0.087875857794684625 -1.794939699288288 0.19588842041320736 1.1681845746308757 -1.4018442111263449 -0.74795293335285218 0.15613324614936061;-0.14375048682988242 0.58425859260476232 -0.34582019619130006 0.37800748430649117 -1.2932769569232696 0.75847487606425201 -1.1755196892593076 -1.4097671857511977 0.77942333583512036 -1.2001739447323867 1.2690759257687159 -0.063661435426825674 -0.18344240289901653 1.3667038598162546 -0.34872612476797815];

% Layer 3
b3 = -1.6635702939099519;
LW3_2 = [-2.1150307207065864 0.83074678650824751 -1.0657182410751473 0.99922902977659156 1.4721065438343661 -0.8027222954522073 0.32009929217874294 0.82158569820468552 -2.0030745945842923 -1.7901875515581889 0.44640025870959649 -2.5556093152934838 -1.1039540861514285 -0.70896943866962958 -0.41460124537576337];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
