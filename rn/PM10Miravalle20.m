function [Y,Xf,Af] = PM10Miravalle20(X,~,~)
%PM10MIRAVALLE20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:19.
% 
% [Y] = PM10Miravalle20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.94514917109217;-5.7482104141466834;-0.73638126050277497;0.88949085200675626;0.4203937131780211;0.44577981011003959;1.5317159419143593;-0.18074843571590238;-0.67925188350525456;3.0362227667620214;-1.9521978008846399;-0.40904515563971949;-3.2486195287660014;4.3787747646235609];
IW1_1 = [-0.50780696780043644 0.061178413579859064 0.71394303774672196 2.4040923756724712 1.1277874935534344 -0.96524353193772405;3.5448817475728536 0.30292264031025418 -3.3487709048988656 -0.16407057007237993 -3.0226004173388903 0.13069206260886362;-0.43611507140990441 1.2146214612207706 -1.0430859591811767 1.391924938866004 0.30451821418250774 0.010814267549186296;-0.34021092443154499 1.0463599817993638 1.3588239646775282 0.41542998033726042 1.0725519497977232 -0.051819463060854228;-0.008136130857973739 0.15669509215921851 0.014725318065058231 -2.7006341016978515 -1.5510578410791354 1.3499501707596866;3.0426796115171895 0.05460926257181075 0.052726612004771634 -3.5244462803941694 -3.0797024324098055 1.0996409231967983;0.95912573802613077 -2.42950287471667 -0.94777776719827811 0.63521723673340358 0.88342774067458119 -0.57026232522276499;-0.36481277409302443 -0.70546970897755978 -0.53312778391442284 0.065358204721625901 0.82384732415189454 -0.59190880752972597;-0.82578941984579024 -0.55902632655546336 -0.69634358791818796 -0.043407221675704155 0.53561664246670249 0.34145081810843214;3.3000263383513944 0.25361545571019589 0.040705921791529862 2.8611076844977918 2.896345985647645 -0.10021712515410693;0.075468194363473046 -0.58092163620941917 0.44277416192495378 1.1661006831641552 0.46611746473736887 1.9508585334165043;-0.34801444312679158 -2.8606605710236899 -0.58209910853490221 -0.74192666871470614 -0.12778607178703896 0.28532851645833929;-8.344993318408763 0.553766292394552 -0.36053368765625715 1.5697892609420319 2.5746437486281448 0.78491982173803354;2.8918078301715973 0.12212542214972318 -0.69251765921291397 0.36296057264487175 -0.39498387287472037 4.0555857145008289];

% Layer 2
b2 = [1.9201707987710699;-3.9099839711756648;0.96366749411007657;0.45219330158048082;-1.0897983069294921;-0.65967692689371271;-0.13360397179178549;-1.3631487910161901;2.4461078654358772;-2.9751611128954392;0.78615131666232463;-0.48208796918914726;2.7844879886913789;2.1528043203447287];
LW2_1 = [0.16662603799119671 -0.15266628788144299 0.20757573370656626 0.34739839887195995 -1.9520618789253528 -0.0052530828970068708 -0.98949542208922558 -0.39898693502590171 1.8821267227384437 -0.073435733905227812 0.52734418255397564 -0.3524356909462007 1.4362618368028743 -0.3443772045512723;0.53526541545816664 -2.1301851293261755 0.67014141397981275 -3.4515831202265392 -0.62357575842263591 0.72016464224031551 1.5960106975949917 -0.14190538963209534 -2.1527193238686677 -0.059242314719473652 0.92286752787497794 -2.6049561357960385 2.139354342627525 -0.97298399315922701;0.66345807852968086 -0.083734705577863583 0.44071982568987705 -0.86695929538483218 0.017890409899997906 -0.0019081972415046222 -0.62022060905737375 0.06762064200497038 -0.77676377044535894 1.6902154010004251 0.29891372885394579 1.0313188889440159 0.66105806389348198 -0.98140892713279038;-3.1497088030663054 0.039238476935723667 0.72156155632359109 1.39517003942636 -0.88191223825524501 2.0477277272205447 1.6800683718987874 -1.7695978172875411 -0.063264670054903466 0.95270984369456269 -0.57241753819501351 2.2314429814711767 0.84825802788751159 0.32861270813506471;-1.485580991681823 2.1522664718840843 0.94913458972324793 -1.3463117909352154 1.4671786987312205 0.61392877289198 0.34862456577574441 1.0576921695104213 -3.7928406820278933 1.3319672482269969 -1.2271352813862808 1.0673845972561993 4.3091320057402562 -1.5398240561161733;0.72703469819673949 -2.2789082764680684 -2.133494089815545 -4.4058943200218339 1.0427974761304077 -1.2580813916460853 0.43792414696617254 2.0007659404206573 -2.5232344985858646 0.56315071612738909 1.0359019896158297 -3.7966373692869171 1.2380887209333413 -1.2443663540077257;-0.93946065646479993 -1.6328156070830351 -0.55133879594213275 1.4040102158780621 -1.0052668720402436 1.1478798121005482 1.8030059309171858 1.107263499859424 -0.72033495174066142 -3.2756200066275847 -1.5589401702524279 2.3448426030945209 5.3517672534036498 -1.3236817981679938;-2.0211977217053385 1.0141582553654969 -2.6331503262042006 1.4712794483554477 -0.8694255092637303 0.31971787182451755 -1.4300767898430691 3.0772318783379005 -1.6413208867725964 2.1458297176192906 2.030363415504052 -0.94435952185888827 1.1460258530039402 -0.37179490287427408;-0.67589370112763536 0.99438626063059121 -1.8923328233973968 0.22260140747107582 -1.7889846364413005 -0.57574932784185751 -1.9633553363093552 2.5918743073168677 1.3775280495542885 -0.65336615927353625 0.62076883757238721 -0.97474282732062667 -1.1352131439781403 -0.005790703003688568;-2.0995154218127565 0.38229198719837632 -0.045925600171776063 -1.3539739828650112 -0.89397822116250958 -0.095978668809790307 1.8589234523326801 -1.1788389527084733 1.7935650547608315 0.17126788016414488 -0.54393625641728094 -4.6147175107598475 0.41003802607365492 -0.54893480590043209;2.1656970093869257 1.7107897217390491 0.033068741151956099 0.71188927208026409 2.4577677278687657 -0.19843612302644664 0.02140519885112695 -2.8420849473348007 -0.37984480677180987 0.80270196518427028 -1.3836536225952329 1.8948968201318972 0.039109259060820897 -0.10584685426836905;-2.2129695360516681 -2.08752818839928 -0.90315871136216797 1.0556437703934465 1.3946530393395844 -0.5434906258701101 -2.9693581388092181 0.0028244873208796654 1.6300449165417317 -0.0026351457834964988 2.2671806238508179 -1.2524785047335398 2.7413943429648335 0.2208780061667644;2.0658875906917329 -0.74503355274333349 2.6869432485528235 -1.8921040513777363 0.56075745335687754 -0.67891608382220625 1.884233451539274 -4.3571319289867549 2.3951742784451029 -2.9502767160142152 -1.8883259826942749 0.63301927262582969 -1.3785548663502456 0.62277709310966012;-0.93373940923251408 -1.598684653590563 -0.21138072413953346 -0.17567306754061382 -1.7767226610152385 -1.3991902972988561 0.013360159778976878 -1.0539218639172194 -0.83437798744285729 -1.2853229672756847 0.53856488846097073 0.083135773743752583 -1.1161150902631829 0.418348549830173];

% Layer 3
b3 = -0.62814975344784574;
LW3_2 = [0.10823958678460509 0.16796661824874085 -0.14370571171676469 0.087417874797509482 -0.14668960492316388 0.075604831400319428 -0.082950136809063296 -1.0537928209424463 0.086943641336719751 -0.11497200639273943 0.12887809899734035 -0.031773610723052882 -0.9936606284836802 -0.37701426127411269];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
