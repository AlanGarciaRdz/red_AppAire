function [Y,Xf,Af] = COVallarta18(X,~,~)
%COVALLARTA18 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:23.
% 
% [Y] = COVallarta18(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206;0.201288244766506;0.281968137600451;0.290275761973875;0.304971027752364;0.100381449508131;0.172786177105832;0.171659085057077];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.5118393387584148;1.0811923051800554;1.5032766537564322;0.83065170535719612;-0.075758861974373842;1.290571190864527;0.9378193328837815;2.5150358407631805;-0.94251412038789906;1.2791104064484387;-2.3827443619071413;1.9458325823112153;-0.73060238532458932];
IW1_1 = [0.42757566965461158 -3.8766327444178934 0.35532707357015086 0.58087750721558629 0.65145379123312674 0.32731986356863019 0.098061074056589412 -0.14707123864008348 0.34039626860831113 -0.20802942776834721 -0.045635947621474979 -0.035997712487837022 -0.48916590949401823 -0.10652452494061612 0.39247349185000824;-0.58930838000070707 -0.39601234464519908 -1.768581457491311 1.3535227468527489 -1.0258767221249396 -1.18997656052349 -0.39765267808441074 -0.88242437773261062 1.7405188601033104 1.1533122070406214 0.22426627503903285 -0.050950668743642416 1.8224693594332417 -1.3633736293847702 -1.0187085610283053;1.7834176106000073 0.130525295227261 1.273085703308718 -0.11255097700661204 1.1871945011661014 0.93595603293343088 0.37742078593183787 0.58310472400526259 -0.72567204155512932 -0.31191322579781966 0.19196532309768541 0.097430577625221504 -0.79358565831998407 0.24828365916171269 -0.23532092575589397;-0.33199352885135675 1.2994752179322755 -0.1204405851340772 -0.098119827456433134 1.1699003910782753 -0.47908657899013946 -0.075159194067465712 0.4401813289962711 -0.40518712612445473 -0.37537869095373422 0.002499877853803574 -0.048041991127143538 -0.62802662383151286 0.20670498013061558 0.12508237210700246;-0.35209051263033064 -0.46171221091265691 0.031704799277852164 -0.48062679349962745 0.93127487507721118 -1.2382196034773796 -0.088967659906740423 0.5856911883995839 -0.15383971174103542 -0.73010717581632389 0.11570800847659257 -0.12131656893746134 -0.4688820745458443 0.76070332060986467 0.53822642077692717;0.022080142774165697 -0.42502069041617818 0.042020714321891819 -0.40953951043752351 1.675153212892627 -0.66015154505639362 -0.17213517283871721 0.63843927108070408 -0.34580384723980467 -0.47581579671735358 0.25818211676428465 -0.24015400177432406 -0.53531172235015057 0.684605515794805 0.3308036549949972;0.734334277520728 -1.3123614426658454 -0.2904351644847678 0.29234852342192613 -0.17462589535423967 0.88149782283954459 -0.1662389459198558 -0.061892043475994751 -0.17350700071901065 0.39685572809528202 0.6212394247889681 -0.25084206596837222 0.04783209226007426 -0.8429989895734934 -0.023744772193578078;0.25522835674527172 -3.7044509922287894 -0.30494453225412776 0.029154917948942767 2.7948116374337921 0.17471419022321202 -0.18197893001423454 -0.61007902073422049 0.21638351195274191 0.2366534229342287 -0.84392564935212888 -0.39268326720572649 -0.13710633408078127 -1.1638944041584565 0.82944987406425252;0.054555532397880024 4.7502237549262087 -0.11125559695520629 -0.48187729416827674 0.33035964729485551 -0.060675885312592631 -0.016066518925525238 0.1283320573635946 -0.51916002905403846 0.27393442343102686 0.19861750825613497 -0.10186005022851707 0.33652905578877607 -0.013213050127179049 -0.23797935693300121;-3.0141926343903145 -0.16509340291883084 0.018410480881681686 0.17030329827510957 -3.0844915936203225 0.16291541040893925 0.35973081619158226 0.055181783595711784 -0.25233098253815978 -0.41303916198413182 0.048056934701823845 0.18739735012337319 0.20907665955470606 -0.1173145754544215 0.52359341555792194;-1.2257831915555402 0.023557905792014392 0.79999356436227287 -0.13374064041201952 3.0491231609735263 0.02063708130530581 -0.5104617086186739 0.33384464372914413 0.084444998473577934 -0.40088517012654351 -0.82484760818678327 0.034542366930248598 -1.7968631597612461 -1.2305807081320153 -2.8383979509867885;0.012123373273133807 -1.4544477682552996 -0.64905383133274763 -0.15151054295599004 -0.88480659670909234 -0.35035673144865814 0.12198383729529336 0.21972670235100814 1.7591967840551421 0.38548714957965013 1.6007166581701726 -0.14101346964868047 1.6012106347102693 -1.4785180665131008 -1.1495715665530855;-13.891348048280756 0.10763870746845736 -0.5315375984694044 1.0866128795250971 -0.53150618029825125 1.9906200032821797 -0.21028154179730454 6.1501598423543928 -0.09510867207422169 -0.48383196013484414 -0.62505140872317211 1.4016236824141017 -0.91823001224076717 2.193674117505823 -0.71712101933423444];

% Layer 2
b2 = [2.1380271927004086;1.8147015807337221;-2.8908975179986545;-1.6673685660555932;0.81332930325035024;-0.80084837333126191;0.049007558308825916;0.2190124576772737;1.903167372058115;2.508774763060861;-1.7938847843413157;-1.6975150485576878;-2.7946264509915948];
LW2_1 = [0.035633641750508663 0.26260504617755626 0.67934677392357257 -0.57782737472827983 -0.42394972011120391 -0.26599445472499011 -0.19268597018863501 0.98861042133893207 -0.033622676752909635 0.17987552443384447 -0.23457723608616501 0.31527512283880921 -0.21824154835849721;-0.20874114067768731 -1.1740565450956113 -1.122219587616893 -1.6644914276969385 -1.0639340563686832 -0.18736462328177744 -1.6502873650443834 1.5927212122038703 -0.85704499627276953 0.081468913877897356 0.42579313019434822 0.15844416783463472 -0.077647745203961296;1.7834911071485102 0.98392471305577556 0.11615474775909311 0.63191380866126967 0.48603433240493632 3.2258370871002828 -1.4863877442007287 -0.094921094772182121 0.42287014862079547 -0.22537325338404715 0.095475063654556394 -0.56976713113115307 0.50847946623639817;-2.4950396003763 0.12497595592089183 -0.26493344990677425 1.362004608575174 -0.10004401166843954 -0.69787392017828842 0.24189065257558381 0.53454216753055905 -1.3825654690863607 -0.22628348484155947 -0.19451883025623709 0.15981119014105524 -0.052902381989734001;-0.52962904286804213 0.45895597366544078 0.43350189529285416 1.2976395218506149 -0.32084660892459094 0.025574541722921791 -0.37173235669332755 -0.72129144429675685 -1.5889478645113242 -0.44357177305550549 -0.58851360106671913 -0.0036377602267785086 -0.045321135861022502;-0.084717430582726405 0.058138203957780923 -0.52622451674158688 0.48986245104436887 -1.555347180668653 -0.64695775643331022 -0.59686789798751105 -1.8763718125426478 -1.5738925911495061 -1.0919428148999983 -0.20665209294281428 2.2663219372993484 -0.48675265758248598;-1.6196105364440663 0.41892630452113422 0.59790666148395544 1.3482925349289825 0.11628058329379944 -0.37904821703192726 -0.16871649254298204 -0.41293869287984297 -2.3124225302170838 0.39914597598625856 -0.69895570922570061 0.075657751122558639 -0.055323755562759619;-1.3004071373999584 0.58482389047727246 0.37610561453540908 -1.4476733602529428 1.4212373168326928 -0.59796369661418158 1.4404532494445705 0.6257414955651418 -0.4048723508813008 -0.69279194947143186 0.45769590458865089 -1.0157749662779483 0.086928512055217455;-1.0533512127129598 2.747622987758505 3.0623093452982326 -0.35344025230387066 -1.5895741499871756 2.350328696008412 -1.1062103487251329 -0.95549876635925746 -2.4437944522109483 0.59180070826300846 -0.397336468647355 0.22707664324170429 -0.4428276299465419;1.4572544623209003 1.0061935544893696 0.099473965348860022 0.30248180161362792 -1.1352367442310554 1.3744538138771889 -0.028758198851398672 -1.8270497089951221 -0.47293082778072759 1.1685682849772867 -0.27758658158154897 -0.53513105582421194 3.2173557812596352;0.38504072507174497 -0.50741539532650792 0.69711227001220277 -0.96170495344855345 -0.083194668450169706 0.096082016456751546 -0.57348458852605189 0.32958298153888044 0.73852574593944431 -1.4174637742835337 -0.15347763161159264 0.57375767374428477 -1.4421250631233888;0.75755706410019052 1.0411323595536377 0.037029903834788318 0.77963441796397759 0.75573256727555238 2.5826908836955322 -1.2124214901373045 0.34290331063438623 0.19978318878415796 -1.6275610947158581 0.09473902355336522 -0.25809850411668733 0.56337045895601956;0.28920470387066421 -1.2961894312502207 1.6301743677257683 -1.1233002307371411 -0.53526971006539348 -0.038775638921509509 -0.010190179380973607 0.33928813075115294 0.19663916965804706 0.61570177533768011 -0.17567232150064824 0.47127102666276782 0.60597688190084908];

% Layer 3
b3 = 0.95931121929286922;
LW3_2 = [0.43730347339024767 -0.24186636409975079 -1.1115113060735493 -0.28441229227772152 3.0680245445134076 0.10266991977154064 -1.9638701457255301 0.85860100400058981 -3.14788508029751 -0.86372492588717431 -2.8400615122567641 1.2145523407241392 1.2681376638952742];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
