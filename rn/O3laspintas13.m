function [Y,Xf,Af] = O3laspintas13(X,~,~)
%O3LASPINTAS13 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:47.
% 
% [Y] = O3laspintas13(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.241545893719807;4.5045045045045;0.00280033604032484;95.2380952380952;0.212765957446809;14.7058823529412];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.6718419280815389;-1.4535831757623314;-0.57694286320378363;-2.0353871166754542;-0.46418031551311867;0.85915226152085478;-0.45672717431177634;-1.7110849182857835;-2.0084953811815911;0.97029823202557364;0.41531267029290636;3.9538556718460525;0.99516386361736375];
  IW1_1 = [-0.55546736217833936 1.4031015457018439 -0.23685540380775599 -0.11949956595346009 -0.27439651762040562 0.26668099774268395 -0.16517971879536331 0.4646541105936321;3.2653437274661203 0.48483878527575486 0.46370644275818035 -0.61820367979587887 -2.289190111889821 0.55387566865004434 -0.58546705243907182 -1.5302069483171445;-3.0754520660561373 1.4455794820486292 0.88557862286408739 1.0215781860902426 1.3899732640926274 -1.4068135787213376 -0.97096870223325094 0.82971717610361306;1.6946339675761486 -3.6993744122469385 0.19261623725248614 0.031980319473271172 0.0056953528179735508 0.2090286332682906 0.29537806904061886 0.099043475457899197;0.8615759214554054 -0.088662888102810145 -1.2767856608663051 3.1014651864622604 -0.8508711715081263 0.25418565102472196 -0.95411138504651671 -2.304967561033739;1.0354619848902793 -1.8305739143633417 -2.7495109890405902 -1.7572145631092968 -0.62868999579348439 5.7394307814091423 -2.2475148913793355 -1.4979460741549797;-0.059110070398968283 -2.3023269066459346 0.15857220034487021 -0.022980356686552211 0.42265667485116964 0.026989210975514922 0.067261514512527182 0.66429372611110704;-0.66885043491114171 0.30155080748887997 -0.28305012143150632 0.029597339016606404 0.45419061664755739 0.31948352779029426 -0.3188237095674879 -0.72697084407013635;3.2414096351727792 -0.11209647124232885 0.33536125235395547 0.033559724287071283 0.50920984723481932 -0.18897260883051814 0.20221943905404244 0.59981266866206662;1.3306516845652425 0.30513352743344935 0.16378163880136731 0.090477686898955828 0.1084019905429785 -0.017840070187344095 0.18348426086005878 -0.29563409980557842;3.0029505268650829 0.25575896136239074 0.0049567115336846832 -0.056604800082583118 -0.63159320883259651 0.11020672960353557 0.086955329368173559 -1.1228955693963565;1.8249035224263148 -0.95114130159242927 3.2869273362238598 -1.4791035018142276 3.8573370304050809 -2.500831249638344 -0.14256665986847761 -1.7357072882170226;0.59565555818038851 -1.4957769232570726 0.94701346785486318 0.068692549770363931 -2.0012950785237535 -1.1439814479260877 2.0778855306710287 0.9558406791308196];
  
  % Layer 2
  b2 = [2.2018623432380338;-3.2467985489309452;0.49964699355504916;-1.2517978376943102;0.74583645281861699;2.5225465682855006;-0.80634938359314234;-0.28862995501831656;0.52949442082533815;2.7039104795716651;2.8363295113862286;1.9131731461624846;-2.4344402180969165];
  LW2_1 = [0.2565836872911324 -0.16815114199677564 0.21046005328434109 0.416637976361871 -0.62865820231443703 0.22185653935042415 -0.36873050105961958 -0.78684352973393235 -1.4802814167155265 -0.20323638023922672 -0.33517359156729959 0.97143638713718106 -0.35652556757427961;-0.94949769307657239 -0.3255951964596776 -0.026916996525764542 -1.6315114606339591 0.31966785047985835 0.17693775670421016 2.9514061044556752 0.10133783138805921 -0.37981159669652387 -2.3138226500348176 1.6336137251595533 0.23067950395855563 0.88678999614836296;-0.98960942801306861 0.006845039105520357 -0.32916459193108133 -0.04543558367619227 -0.1141765065575263 0.53397864934402473 -1.1234319555366161 0.81310826602779951 -0.36482604892932197 0.28659305800152773 -0.26291627222487607 -0.11789810774652353 -0.50182460686072872;0.57221969843261822 1.7402489437075721 0.77744734080976008 -2.7431507623125508 0.30707981745325535 -0.89968139397357716 3.1336846858837655 2.6685027800863899 -1.4318603346652095 1.5588419558480444 0.52704958160604476 -1.9528591309539536 0.18412431610641844;0.98104429406022442 -0.88488902095401578 0.2782735170463298 0.19324190423006418 -0.029480322617434458 -0.21203475917737954 -0.65195389453244112 -1.2828470446274867 0.34136687979699543 0.48536621152964554 1.4478247119327201 -0.12179679941268659 -0.47060616946168254;-1.2189916683079312 -0.69704655754484057 0.96665803847986476 -0.96413415353874365 0.15274829911571991 -0.07133888677291389 0.71004357034890853 0.99688537318463244 0.65838833609736236 -2.1200107243884601 1.1950607067775978 -0.20910267607116126 0.56033291606916857;0.75511177629857407 0.61590164513073908 0.52481023579447261 0.78167166573288371 0.5642535559082642 -0.053959524331376955 -2.3271627856542452 -1.536415012809965 0.68767070524140084 -2.6136011196320412 -0.31575380585012941 -0.71583719611660945 0.85157290833167032;-0.79407537166445652 0.22089449137802666 -1.3336974374428214 0.55609011070982683 -0.56998889471714109 0.30477348745325633 -0.11280188863932429 -0.020790461038718927 -1.1785566697932626 0.58596110222351538 -0.06883128824521631 -0.56040425002369454 -0.31475114889917694;-0.29444853755531575 0.90870168055131462 1.3552453130126176 0.17894186406163909 0.45870898271779864 -0.014907744973313992 -1.5862729608435082 0.8689713540858206 0.6185491442669796 -1.4911618443146182 0.39621136533491008 -0.10657112728216471 0.8954650154218623;2.2757339494464972 -1.1531706397196206 0.76399400619290103 0.5969000778859479 0.16469927282986918 -1.5644595779408621 -0.89329256067776497 -1.20745041283346 2.3951363739989997 -1.1230027232127544 2.6395502023319657 0.1914257762639644 -0.12254926913879693;1.0337075055805449 0.86653341939526174 -1.0866153640895935 0.5442320556793564 -0.22817826578174738 -0.49637271043441555 0.83974516795756382 0.30428497433476909 1.7709847325893908 1.2469071480254303 -1.0629948813415786 0.21991057210502216 -0.3265802285304355;0.1121416365062225 0.27216417368348211 1.2529596116322097 -0.079181799012139592 0.58824522028179804 -0.90595567855936188 1.4727802775812635 -0.067141634724316154 1.0454865019352952 -0.043793228682992902 2.1927459358978587 -1.1057695908527536 0.55799554103587146;-0.8994871581277406 0.10127646350318725 1.6610388890148569 -0.29867672634019887 0.34392376591756685 -0.20180306648312391 0.0053216576030721413 1.9800639182493294 1.1451120735187363 0.36533341678983333 -0.17311118806319736 1.2967175303377252 -0.71200360079121028];
  
  % Layer 3
  b3 = 0.4163067870237035;
  LW3_2 = [-0.47974909868266163 1.2204853371014088 -0.71289761319347111 0.42586993032189668 5.4905416542309995 -1.3542231522079864 0.54895027614094549 -0.95498978465891937 -0.89404191306209901 -3.0721993738655144 -0.98982376122298432 -0.60608583365219837 1.4645384477209336];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 14.7058823529412;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
