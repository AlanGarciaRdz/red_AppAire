function [Y,Xf,Af] = NOXMiravalle2(X,~,~)
%NOXMIRAVALLE2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:26.
% 
% [Y] = NOXMiravalle2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;2.48447204968944;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206;5.12820512820513;4.16666666666667];
x1_step1_ymin = -1;

% Layer 1
b1 = [-0.8642077416664341;2.5702128595165648;-0.13946655826962634;0.84554506282876241;1.3888189166504679;0.385555821883454;-1.4828009915380962;0.19303186125247421;1.4493439859983768;-0.93249582540794906;-1.354038063023463;-1.896944458438961;-1.7663659230157138;2.5183541184470855];
IW1_1 = [0.022744069445386539 -1.8183007995961769 -0.57752616648469479 0.47615086412446983 -0.3639244866642341 0.27169836806102776 -0.075690547482792234 -0.26943743973945211 0.0019913608557765063 -0.18223780623120386;-0.90375390348801155 0.026556056276169231 -0.49725535524181591 -0.033495545692549533 -0.41090058203483437 -0.40761488957570396 -0.32643409885706304 0.089222204597937324 1.8225973646687423 0.67810549011749943;0.59604966954332717 0.68515336299109586 0.42123182822084099 -0.25364748470018661 -1.6485109416029065 -0.51686690834642379 -0.77361550355899789 0.67569345767346967 -0.54096338045438408 -0.0048871834628063208;-0.49400250368917825 1.4782125820327265 -1.0448373607161883 -0.66866837851231731 -0.59770935272959824 1.5816417149983617 1.9563349971700283 -0.16641739187491694 -1.5521239266273796 -0.29522097280967297;-0.38940474579779216 -1.6382624793028198 -0.67833006022477182 0.25633596140565829 1.1274970458512643 1.3672134052344911 0.56480516648901014 0.47278574668920131 0.63931468653231993 -0.75385082906155054;-0.17160230389285241 -0.86512889714018704 -0.65947498690975781 0.2507958944549884 -1.3662912615438143 -0.37416738489843959 -0.3062186809496984 -0.12872854315788917 0.06208465133539337 1.1672001408712549;2.473961162041554 -0.35046340353858968 -0.74116887307595047 0.22800510082846442 -0.073230714073826586 -0.50896894952685856 1.0858003786970698 -0.21809597277524911 0.23469865250298999 0.042262105927415937;-1.3920360206390474 -0.63601938881691811 -0.46314928073003581 0.26798266526746956 -1.0864045101284336 1.8077591430331035 0.37778365965468752 -0.098130157052471592 -2.2723075820923078 0.19492384860667888;0.82631767182999782 -0.53071897844396121 -0.35108589985958827 0.47214063823426228 0.45651294119024033 0.93164692214523759 -0.43409786256030108 1.1194595735487729 -0.053799999440762851 0.3028168015328232;-0.02427247706360823 0.037630990535690606 -1.2364666459886391 -0.56567832087498038 0.27667211288529481 -0.27842281678699288 -0.1344225812052231 0.65079331988956413 -1.0658786267267362 0.74079284188472505;-1.3342064195369796 0.030469768420135851 -0.64474163331513645 0.20372522528003778 0.68782009089749574 0.35374739951823297 0.36769590754256981 -0.44606836245587961 0.50782647463013608 0.071734132998757874;-0.37566331801716485 -3.204864061190567 1.0166520257818574 -0.55623893465464869 -0.44933072802609714 -0.48629978652384731 -0.046315443199826285 -0.038266044204345491 -0.22076841016154533 -0.015136101684569478;-0.096031046672756956 1.9784470730023755 0.42364282575761109 0.30615823980555462 -1.7127879015641125 -0.44372469553379568 -0.54793353091349328 -0.27181883529042161 0.014858161193531843 0.069799999614807026;-0.35730901343660709 4.4065559433197112 -0.047494744641550513 0.9817792780663438 1.1866107356819022 0.42721330523413081 -0.07486973327922801 0.25449380936536181 -0.67544666391108887 -0.39221072302808263];

% Layer 2
b2 = [-1.2444265966442405;1.6057902366639174;-1.2298877386279352;1.1465405393510111;-0.26424047385677918;-0.71314630186984573;0.069214516785345376;0.27363173457007917;1.5695751359755412;1.3923304405830528;1.2812932178978558;-0.85256994649188178;-3.4728051349005997;-2.0490577029000576];
LW2_1 = [0.51648891299464839 -0.65352146501093278 0.98268171421000505 0.26405126650346716 -0.0039363509631005281 -0.58610325279924902 -0.37994504501232251 0.015755752526043172 -0.18679410703826457 0.033327435986003552 -0.052845322859698965 0.37826091938385553 -0.7959896501328112 0.38912039107594854;0.060922560171204183 1.2706478999729161 -0.18687103227599217 0.68237535559637341 -0.4589709841588252 -1.0270122456008979 1.1564442821965559 0.78194075687074616 -0.19983912613456734 0.30579640128032853 -0.76797324894612751 -0.34794018999332332 -0.33424360689361077 0.98600800604350514;0.31157298114504067 0.24812482729338986 0.33882639997770625 -1.9403673745181258 -0.053495777538393893 -0.96174609415346113 0.81848449518661925 -0.64809816507382534 -1.8601962879327718 1.1282172758853586 0.25402219159467632 -0.76644274502887211 -2.066162059976401 0.088181480701050821;-0.37055275446481889 -0.0093728985755443736 1.1195847186311429 -0.37786724135981903 0.31294854179109299 -0.46258540967670148 -0.12601030654192694 0.32234465389146516 0.30242721982833198 -0.45299465693084456 0.32997686400046944 0.16520714945813769 0.019296353899069821 -0.0048165729000669809;-0.64742095516710196 -0.13130571619398071 -0.79121537201747905 -0.72714149893394342 0.43352738396320722 0.29146916282197216 -0.71443155869131325 0.26348289745944775 0.43084791890225238 -0.41887957926358477 0.24609610165329682 0.19209829367928011 2.0335503655266458 0.1078486981402681;-0.94318607164362445 0.61053081034240231 0.25547655512466055 -0.70431323905287779 0.39132072949436919 0.018551229056130571 -0.030123605706466265 0.32570543246100059 -0.87411100160578814 -0.030523298882600997 -0.96214429382087197 -1.2131604854297089 0.50660849321491996 0.25052612925863516;1.2008809653203041 1.3382094276214032 -0.61927836550425908 0.74801548181533439 -0.018236810378623652 -0.85595545068844792 0.47963159132125166 -0.35683418411854273 -0.58938435785372434 1.0335500489456493 -1.7121383742471659 0.24729131499846629 -1.3537658784155093 -0.63877172317257214;-0.34745054442905232 0.49851573579810321 2.1248013858505894 -0.36575595002457367 -0.49570764141422285 0.17513279245592128 0.30866874350099316 0.5185807652341714 0.038679168360497451 0.31075282666787529 -0.87560686961618939 0.46339435340373503 -0.66208024993962733 0.64084078488220353;0.9289125701791987 -0.51059866374690777 -0.19372779751266694 0.12010742657125831 0.31987300145965636 -0.21558662147549235 0.090161742963891969 -0.14318550073936248 0.91402337526399657 0.038247655854047144 1.0616144727842791 1.5106580145803226 0.0009424565949548297 -0.67996695501165438;1.5494627630711626 -0.21894720540772719 -0.50261285466629779 0.60550437290665449 -0.48665195176805331 0.45547365899924569 -0.074934886714643781 -0.64331912007945291 -0.19364438812295612 0.79633568381932007 -0.3365305748493746 0.64861754929662274 -1.3060584090626661 -0.00071349570694234643;0.87503484375195117 -0.63385979676062043 0.88381283438584268 -0.30728733584679391 0.25060693495483882 -0.42237421407371833 -1.2028462147116481 0.22661755903433761 0.63241115609578125 -0.84614937179489702 -0.039686175819348218 -0.80395453068299172 -0.18221967461873576 -0.46117694071283483;-0.86833209801516842 0.28242981790528526 0.12357637407961841 0.36916799177951531 0.79643421963440908 -0.46014623836658886 0.66329473712186404 0.57518632956523918 -0.0034461396770580541 -0.35296976717149442 0.14889198752898902 -0.49500986923302537 1.3395813519425779 -0.44191613966295945;0.16637527192419493 -1.1683141896818456 0.62980156809423804 1.4162144856173196 -0.59243871012444815 -0.082333797482579268 -0.09148410202111254 -0.2425076590024566 0.5811407540589294 -0.57704282447337729 -0.35038291437458224 1.0839422149583451 -2.0232506827926189 1.3275470499014241;-0.86096194026960882 0.43271910364966759 0.037099260427591381 0.78608648397883973 0.92480488859357934 -0.57513058046447263 0.78990842852710785 0.68190391218530955 -0.2042197486541999 -0.26029007315669173 -0.10511593205175099 -0.77416818989158809 1.0007392312086525 -0.64321704556953974];

% Layer 3
b3 = 0.53336143981583917;
LW3_2 = [-0.69765828809654973 -1.0228093349698826 -0.29075578613933356 0.73205578903732127 -1.5162452160423261 1.8975743468286064 -1.4384620069775462 -0.20005701184587504 1.8183426050548592 -1.0505207511744019 -0.62328147188148719 -2.70771904995879 0.63749498837959573 1.7299606910876129];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
