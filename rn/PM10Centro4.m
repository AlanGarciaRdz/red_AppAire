function [Y,Xf,Af] = PM10Centro4(X,~,~)
%PM10CENTRO4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:02.
% 
% [Y] = PM10Centro4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.281968137600451;3.74531835205992;0.00773694390715667;45.4545454545455;0.00462534690101758];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.3404421874599377;1.0651219608390052;1.5436520873678676;-2.119016200884055;-1.1872818749650902;-0.83073216568952657;-2.3010520315121421;1.487586203220985;0.45658039136635847;-0.68629070707101603;2.5445451479733503;-2.7390972929238759;-4.9574210714589313];
IW1_1 = [-0.46161325238549167 0.59708842612048518 -1.3935088770459181 -0.66952692824492077 -1.1105222070960046 -0.14694898249411692 -1.2262634439864368;-1.0464423222818429 1.9131676861456479 0.72840299968145306 -0.63320139188245161 -0.19954098915861171 0.013837964855446194 0.39372611857309442;-1.0749830148717796 -0.3060849618254462 -1.0206839355097372 -0.43145179362430097 2.299684077284351 -1.9738266253477188 0.15852107980949934;-1.0178735207698639 2.9371506394969087 -0.45733825740548539 0.77495858022174913 1.1633377830418854 0.99506474478504536 2.6182332247883715;2.2061396473436878 -0.55771641184753917 -0.59321623828430137 0.35176073322007606 2.0688220424464081 -3.2840064700446043 -0.50781458065245944;0.013036538021895663 -3.3060681265045115 -0.27824342472828306 0.2781298097662479 -0.056034121964582975 -0.36279863035073967 0.46691560592489961;1.0524803189364207 -1.3442689577307074 0.089694973951261164 0.37320499452585543 -1.5448363563747891 0.42606663017058805 -0.77874536743623934;-1.8054334893045989 -0.19471783544953575 -0.30629368959713182 0.040129119487030927 0.50013693810876203 0.41415535907883 0.80491582128465855;-0.17433549558618994 0.85835362692083106 -0.58778883821555739 0.21964691151690824 -3.3924560152332823 1.6586548357595954 0.12803567865785156;-0.013722862836037002 0.32884677560874581 -1.4422039632927648 -0.040097945584287295 0.47194723808200462 0.52469273817339557 0.32341086756745541;2.7348895716457591 3.9676082503386594 -1.7046027099393788 0.11627970815584329 -0.17793900098609403 0.18963971313267092 -1.0779465304066509;-0.68067209674349594 4.95791822596117 0.26031253477064009 -1.1337586874639318 0.820520046075216 0.19250006108821416 0.28932358775373257;-0.94973706232856536 0.50907315086203808 0.35892548215778564 -0.41267106335268283 -2.5227686028110221 -2.4571634330894865 0.46737063626308928];

% Layer 2
b2 = [-1.9617457843705628;0.25569499171839472;0.7721497523278551;-2.1386898254279054;2.7956672465129349;-1.7554361519448274;-2.265249695215215;-0.23703518803037987;-0.1029501205034612;-2.7813653909739866;-1.9702520600629865;-2.2067026027337526;2.3259224161501542];
LW2_1 = [0.39778705000328868 -1.6543457987505628 0.52031705649949012 -1.2573599967121694 -3.9198233022384259 1.8442800927105827 -2.686014785204375 -0.015904866739353263 -2.7686500806048402 -0.24305574415823686 -1.465047277509774 -0.80292981757706938 4.7713250978508377;-2.1781878950762632 -1.891196941173287 -3.4701712422398869 3.1189496028911878 1.2141275902476041 1.2928171426498354 -1.7827091877323262 0.033392796614692563 1.8284766766509772 -2.1172517368533104 0.89880632386208337 -0.87838540702545576 -2.4940657691455628;-0.78074756620029984 3.4369519219111742 0.044239128621253739 0.20909397747587585 0.050576915867052541 0.62695150821416723 1.0087722286162879 -0.16036643046002777 -0.9450707563393832 0.60028549357401639 0.32716360758509827 1.4726346752945247 0.97683776787797594;-0.64221424598812082 1.6296789918232737 -0.3196121085230198 0.72265573298236285 -0.063252074774382966 -2.2903970797329132 -0.17697610901439997 0.0034891294462050526 -2.458546493764123 0.87271661245247323 0.38882909034416274 0.94217583522988235 0.19590487198516532;0.299744236762571 -2.4504754485560958 1.57845166992859 -2.1644624823205514 -0.37664013058363743 -3.2156137924157724 2.2037480312488413 2.0630911192158541 -0.52336886195783439 -0.5074059238838402 -1.6732650008785352 0.8874340484196227 1.3114605820339267;-2.1692946215010789 0.94247141284124736 -0.6558853439183292 2.057175781130216 -0.82065566208383256 -1.7177536858593392 1.6823855509191514 3.2136110385312882 0.36630576587671881 -0.93357907443363886 -0.01191973089496063 0.22733468892191044 1.9897816824762922;-1.6931755060860143 -0.29659534384726488 0.37934600801705032 1.2925593211774296 -5.5016524819574313 0.42966103161555885 0.93117352699068867 1.0597657968786875 -0.33615697251099919 -1.6148977588788385 0.81825714077307421 -0.32239940418238727 0.06185554676050653;0.22319061088742803 -1.7571456621352832 -1.4287396131588155 0.93082930570985012 -0.52858297681948174 1.6539888779735923 -1.6299716423375197 0.19156943345242711 -0.65774957621971808 0.16390997253551953 0.16281192732525313 -0.81629450776436541 -0.38489225928604148;1.0802722267521183 -2.1182319512143781 -0.087289645395520421 0.76088947471318469 1.28616942829092 -0.2230333052002898 -1.0192554814903816 -2.1455071747817338 2.0925510704207273 -0.41334909553362187 0.21301897941119877 0.10335569215728953 1.4619654004976854;-1.6551494858462523 1.0290152243668538 1.4432475777989358 -2.8012394478149765 1.1308612041920698 -1.3463812830020068 3.1076650885284924 -2.6062827115355671 -0.71640926707927743 6.3108546134778383 0.55213076256762761 -1.2420098964354112 4.7863887398245994;-2.9936209686757209 -1.6715289881374751 -0.50783356715399941 0.59504940840627041 -0.78224951957054933 0.025605114997193833 -0.91965985375338721 -1.721009385537136 1.8709069542495378 -0.1174878309381624 -0.2968219403280139 -1.9513668688156545 -0.8401234897187837;-1.7255686726856074 -0.13737348180898701 -0.58939488221489511 -0.7478293920612924 -3.8539816859178759 -1.3448685792091375 0.81034327124956329 4.571988159314949 -0.85063458423095895 -0.11437515464447252 -0.51859477872613458 -0.68393011832228057 -3.3043825691514579;1.109336061701234 0.8736548126603817 -0.00096496870949565328 0.83179306548396503 0.094215095064215923 2.2155754104265153 -0.49279192961613366 0.43744831006400348 -2.6090882435080669 0.046972925677010016 0.21728516169490802 -1.271568686077946 -0.84484749970154926];

% Layer 3
b3 = 2.2046529380111832;
LW3_2 = [-0.094271873726500408 -0.069952109080867686 0.18875737033643408 -0.25767622826328584 -0.32608155942258493 0.086155704874588415 -0.049945555915034474 0.068914236316782826 -0.13741387548440329 2.822074890675391 0.20258443900110748 -0.090927301963531951 0.19610034268345619];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
