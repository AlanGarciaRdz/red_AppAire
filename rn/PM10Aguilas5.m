function [Y,Xf,Af] = PM10Aguilas5(X,~,~)
%PM10AGUILAS5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:19:47.
% 
% [Y] = PM10Aguilas5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125];
x1_step1_ymin = -1;

% Layer 1
b1 = [-0.70477613999392485;-1.6697921717547717;-2.2756520452985396;-0.20655078609172392;1.5646395466658909;-1.1811443513443562;2.0585854598499322;-2.4565065649996032;-0.26255688259309234;1.4673526336307277;2.4288098600028269;-9.4216964507787413];
IW1_1 = [0.13255689073308741 2.1495184846969089 -0.0353409932339546 -1.2526936085507752 -0.24966599301689038 -0.094787160681704924 -0.0071753443327004455 0.056061102215289357 -0.11934055670943194;4.0724200514162083 -1.8210153604739527 0.29742999484294969 -3.6098526164314491 0.84482709851486382 0.90399593447636217 -1.5432120969234222 -0.090981761590704882 0.38489041893830528;1.235503612886319 -0.26708343420936997 0.47456879660187101 1.2352660940965883 -0.22827531314981703 -1.5083121472633658 -2.4911477549222085 0.52001579932264652 0.0935800415225604;-0.72644320578075627 1.0843923092262149 -0.046525057600064167 0.81642336732282716 -0.35830003601269961 -0.31042543586184101 -0.080494021423618611 -0.063867867945200385 -0.018484850244677564;-0.062715232671330001 -0.6390402061201067 -0.099654833921352937 3.0205380654428788 0.43283323745881086 -0.21113746671069741 -0.40560751706873499 0.58124433769840389 -0.061697418341123023;-0.26390285927158819 0.3498546273038286 0.1586792725890232 -1.1679796331525167 1.0399364373447619 0.16444133839493771 -0.13448542760465496 1.2808201591933481 0.020668035728312276;-0.65442690035661666 1.8854777638670672 -1.035246670484685 1.8119890093789139 -0.55989620152583841 -0.23193184745834344 0.8772633995724648 -1.5516704988519308 0.20974791329097375;-3.7429651367455783 -1.4471138753750197 -0.075438127241924002 0.96427039066493991 -1.4639564669031544 -0.29931763851057891 0.21024576655786603 0.15602577218950378 -0.43474321955056139;-1.4021133331664153 0.40895495503941975 0.42773727633478054 1.0560217624167145 -0.34936075464478844 -0.21167470538486291 -0.27480157140035283 -0.090875906667978942 0.071489948592532743;0.4489979306415896 -2.1077636035932965 -0.020706729169503564 0.76325981891048644 -0.2999571325855353 -0.040656310458550587 0.78418993568061046 -0.25752525564745016 -0.22299899975955678;2.4113260590333701 2.1628352719216926 -0.30615784064000084 2.9832440640802567 0.30779641371107735 -0.44207637683168893 3.0449217398309365 -0.20864830147184998 -0.25973155018822763;-0.24256681181338841 1.7631530182009614 -0.15636475358551497 -8.6956382250103204 -0.27405861378209201 -0.46864476047642228 -0.15413353319328618 0.052423487199309567 -0.060298479472650275];

% Layer 2
b2 = [-0.45766524626292066;-0.19471492788382241;-1.7764451819302878;0.64743473498645887;-1.1676773258799733;-0.69788735610121699;0.035883624292198595;7.1328589144688159;-0.14436323636902587;1.4282020598344625;3.9748620870123932;4.7536355763623774];
LW2_1 = [-2.9765192298283472 -0.65950527158586714 -0.1388339869083644 -0.66075237091096306 -0.65939516253780162 -0.46008054451923508 -0.92782873232917151 -0.18529927952766406 0.26108212087061228 0.67149221433046902 -0.048434935900869669 3.1341632581824665;-0.63154925550440966 -1.6921148841528553 2.3128701842993413 0.25304343323942052 1.1530671466141509 -1.8497344523581514 1.0995003873231946 -1.5750886946067297 -0.3429368326792222 -1.6346673295888894 -3.2901726475042303 0.25140552997420212;0.076074769152581212 0.51086530172118894 -1.0975065966408482 0.31874284301185368 1.8880103887715722 0.6223412856330276 1.1548197026106033 1.675857184287159 -1.1270113915595734 0.6175090304341837 1.1914483526803006 -0.86463430337735792;2.3254191034063485 -1.5649375649712678 -0.11393137572174711 -0.018243792379838558 -0.69536106465699143 -1.5072222066963987 -0.47176916189260687 0.26593213392150894 0.27102622840482321 -0.12836560099646072 1.7404174574106481 -0.9921602708177113;-0.16223863323414028 0.12294911430617114 -1.4053773091429245 -2.6101087705152608 -0.75547847701232462 0.81387062698536816 0.95863360691798305 1.6664506527641754 1.5810156092024912 -0.789824905754688 2.0439610099298444 -0.25742882560682689;-2.5972960962089693 -0.83104386385935258 0.041348876975937782 0.04270135457962887 -0.62904483477073658 -0.73864501721244802 -1.1387546398897672 -0.16226482070959805 -0.35145656034770101 0.62185351515869769 -0.0029568642187559682 1.9369650123182607;2.6335498064962235 -4.2363093367071976 0.87837521303444799 1.5358801370696962 -3.1112463452043446 -1.038780688120398 0.90992941907219693 0.33363641200448013 0.18903572160304022 -1.4326663267071698 0.47955893734011834 -0.42587856427327708;-2.321967608166482 -1.7657380614614193 -3.6926967800396873 -3.8053159836226813 1.403565507992564 -1.7055084105021834 -2.7389307824167766 2.0416429555026214 -1.841939810777514 -3.8022721636591723 -1.8701631203110005 0.033191723457169191;-0.94071395390420598 0.34831161673564431 2.4318636241421627 2.9858667334371818 -1.3199645712793802 -2.0344721600158167 -0.52891212477069283 1.3973097542638477 0.6555842006773015 -0.40732376843433327 0.34002909401263204 0.19407196639954949;0.24529934468681275 -1.6324740375329609 -0.81225915634969603 0.52496511462078266 -0.74796605523207271 -1.0121611602987637 -1.5507526427145804 -1.2647851747084542 -0.85236568793703293 -4.0503286035584711 -0.53385089825834708 -1.1235236404748421;2.4684949191300891 0.35267211631794504 1.79424130618305 -1.1212447478107186 0.66490319886045424 -0.44515577027942366 -0.44456110841602026 0.26719586095620973 -1.1061708376688844 -0.36280295788277311 1.1543739526406569 -0.41169097115218828;0.064119616457267936 -2.756418136140772 1.6288115003423911 -3.0107704035995155 -3.6894390107092709 0.4848220116913412 -1.268859040379271 -1.8541681117438835 3.9060201250008224 -4.3779871322817518 0.97417972294778588 -0.78343240472016928];

% Layer 3
b3 = 2.3701154088738847;
LW3_2 = [-0.72692367422129478 -0.0754389141383352 0.050418885896982395 0.078492734951389143 -0.078266847949614568 0.58265747118382805 -0.030746567696494548 -3.1455785983925661 0.10024350749422459 0.10779206711350664 -0.22518128362753012 -0.067321617710959514];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
