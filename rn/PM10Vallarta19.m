function [Y,Xf,Af] = PM10Vallarta19(X,~,~)
%PM10VALLARTA19 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:48.
% 
% [Y] = PM10Vallarta19(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.12820512820513;0.00782778864970646;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.8244218733240785;-0.529387390039189;1.9735483297378222;-2.5250700023581327;1.5573486308600175;0.18116549079950617;-0.31690665053052108;-2.0481846033932807;4.0659296309955844;2.5978583525459191;3.3434516139228219;-4.3741210029622417];
IW1_1 = [0.66388356998112485 -3.2030207520053549 0.60551146438804648 -0.47052237684528697 -0.59940135416438101 0.38782154737675445 -0.20283824417813215 0.13802252470782775;0.49300326070402795 -0.73028865847337299 -0.054336596037218417 -0.27374869445458333 0.38348400509861164 0.55407785577722712 -0.66492584821512413 -0.51186804295365362;-0.69496163190247284 -2.0243173299374329 -0.55964918643684358 0.41507249567636689 2.1631034696004763 -2.9410695035502781 -0.33017713448211078 0.30398325842639223;1.4346184247830644 -0.23656808937061607 -0.097898019513952383 -0.41715184072307404 -1.8790786862773898 0.94321003519256152 0.4168816872918758 -0.4181648527720494;0.31552448985944542 3.3840104775907589 -0.18485050562474917 0.30553600773827233 1.3592959216955975 0.55206464058971505 -0.15789331923307942 0.52375716596457733;0.7752698964468081 0.99692729317839601 -0.35305241241977142 0.40830772500668278 0.31372081760647097 -1.3479805068691757 0.11324484018514354 0.043935682562246316;0.88231033152145333 0.020983477634691869 0.17017086632032655 0.64170715077304341 0.48100394177316802 0.72758457180059755 -0.81436608662532095 0.10037779287274154;-1.6875810533726916 -1.8981667358223988 -0.23796789515352998 0.71239625686772357 0.98714902625960621 -0.74775830076378869 -0.62148157802320581 1.239554227511882;5.4948348001735994 -0.41694368489580041 -0.89434569666213126 -0.37020164009467821 0.79505069058742783 -1.3336731698606819 -0.21739348284709062 2.8961747279405481;1.459919955254148 -0.68481244779184902 -0.37111774745644976 3.9958587106576444 -1.6495758450499862 0.34481293450302197 0.73574302307393347 1.1137727701931108;3.3049035667270599 -0.067843161643420413 -0.31914167346181987 -0.4401422387838661 0.84410944601123983 -0.30122521444011635 -0.18005577645176687 2.5686646275362515;1.9325822039224123 -0.8832645868083322 0.10671761141183028 0.4673818600187129 -0.66674847669781567 -3.1586661007227455 -0.93298479676674229 0.29388248115228804];

% Layer 2
b2 = [-2.2732390115750407;-0.75377460539696972;1.5731774798258118;0.4607650591664173;-0.40151694543427308;2.0413527785183456;0.6427750552392586;-0.57871092899621079;1.2117341982701788;1.195145144200348;-1.7085487508506931;-0.86610264739527265];
LW2_1 = [2.4742886407802311 -0.71428077537908963 -1.6592650647503184 -2.1763237556755972 0.38550562345364803 -1.2546529883279702 -1.5225710985559726 0.67306102139235835 -0.33090811442864526 -0.30233335823091823 1.3953680477053445 -2.9287238725370002;0.76269622779717605 -0.58564807042741485 0.86457056521195674 0.73665228163718821 -0.22375827538561857 1.1716472822229735 1.320639477931409 -0.44534802988487654 0.89305171290647267 -0.20025866918306826 -1.1397613058499898 0.61690017233968464;-0.63560594359379896 -0.33444276931717459 0.69374391010880077 0.92814137970527755 0.48431496271130436 -0.90564034469154675 0.49478156950148877 0.98986925911025458 -1.1245051994861572 -0.1437091039480802 0.4441190810442428 1.738933273688728;0.21674858419696488 -1.5092326814098789 0.25339786238277406 1.0706914717649405 -2.1483778955308512 1.5008070195573331 0.011445144295620782 -0.14313990110138539 -0.70695000824316812 -0.9508786949713588 0.66018076668277936 0.37305756730753542;1.6285404886955754 0.95962881613812923 -0.56505695545204271 -0.19015942504260364 2.9314120567407529 1.2623008854318496 -0.56390422312099187 -0.34510962512004445 0.49933169852666737 0.17729609312266112 -0.78601707643503649 2.7975904705088399;-0.24888993024132683 0.10820810536215041 -0.63888619686790471 -0.4856081443978828 0.85196182282727284 -0.32649334115171869 2.4857627503370114 -0.97935374567313871 1.7411810594468964 0.20644222662117609 -0.92998779850599866 -1.248444369103326;1.4539638773938697 -1.0801084161231715 -0.76230050075631151 -0.24279028985104589 -1.3391704609798174 1.5115713472207071 1.5054683603345864 -1.0929619252920879 -0.95207185676891937 -0.75802785038033049 1.046035233449389 -2.2011021480800435;1.2384984580553502 -0.12343891990196711 1.7002437119430149 -0.18609201413442936 0.070375546849613432 1.4601742757664999 -0.57046445746798535 1.8664040038815723 -2.1642070194792051 -0.5386361459036314 -0.5111919604277555 1.3645482867148804;0.48606432329831878 0.092244136519097769 -0.62688985004514119 -1.2939809282068702 -0.82808054306831458 0.87350279893594851 -0.95053312821526958 -0.7795243222401298 0.62712900036479713 0.17686828803026416 0.13012543895996348 1.9973832235780256;0.20539285383268413 1.6820882069998087 0.31122558706181752 -0.71834494161182838 -0.79671825388055606 1.2816162059630234 -0.43441951062190881 0.27085559744147519 0.29186503372231837 0.057629699869067588 0.57343833361166918 0.36666028007207996;0.595784793394742 -0.57918593573887667 -0.22859026937336563 0.66593565643087327 -0.5123579057183536 0.2844322775048258 -2.0844052267883795 0.13765704773240492 -0.28556494647402719 -0.15401773304362479 -0.35948237200356098 1.1900900605222866;-1.0067682386400811 0.38468906973584388 0.35754674520766122 -1.2564775939818871 -1.6355979866330348 -1.2664326269501212 0.25739919468826816 -1.0527391756403039 -0.11337573252694036 0.36828494639022064 1.0286774964227401 -1.131687281267834];

% Layer 3
b3 = -0.08311568713182374;
LW3_2 = [0.077392788445278832 0.826290813479991 -1.3373189322615922 0.14085295610432305 0.3631375924753561 -0.74418272844272437 -0.7119735215146854 -0.18157038352848009 -1.1161062452691213 -0.30345879736993953 -1.3349413567254902 0.28943153601489502];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
