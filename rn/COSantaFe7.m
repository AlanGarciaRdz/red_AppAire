function [Y,Xf,Af] = COSantaFe7(X,~,~)
%COSANTAFE7 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:06.
% 
% [Y] = COSantaFe7(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;10.752688172043;0.00341273633199099;27.7777777777778;0.00632111251580278;0.294117647058824;0.448430493273543;166.666666666667;95.2380952380952];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.3739042492070501;1.979189418254552;-1.8650202083655221;-0.56412863472295594;-1.7916427799405621;-0.11607584697548112;0.92954133655654325;-0.59117323652382114;-0.037311277463751534;-0.69724005851716264;-1.2644664798163319;0.2686570695471423;-1.1775122198831183;4.4358353647861;1.8967838081543769];
IW1_1 = [-3.1088286594625134 -0.8227322448980201 0.64995392821762787 -0.57812811306373912 -1.4733956955552481 -0.30321543528268946 -1.3228240210246469 -0.24978359023862756 0.40964954564214634 0.62507968916725631 0.654417261829501 1.0435112174140346;-0.12603354845612405 2.4543415955060137 0.25271180708342533 0.10697184489457766 -0.099965421005658264 0.033379789049109064 -0.43702978941605042 0.030962773398027124 -0.050260798682793463 0.34896683703061804 -0.0052906471349867127 0.098450985689234924;1.9753772410687465 -0.18859816659313558 -1.2111303815084613 1.7942316329864492 1.2145977635788912 0.091569314326063647 0.084458683313082622 -0.083062538365240884 -0.60306819583205629 -0.35609408932599673 -0.012894417007716187 -1.1641239324270789;0.85519066820278111 0.20565053936959549 1.1353128720892249 0.067525252405405592 -0.22103222784689866 0.72522795050596101 -2.2654599477280746 0.37933674413789542 0.367033232891257 -0.05616735932237512 0.3788164227888805 0.57348128968905532;1.0185315154185643 -0.43144216721298723 -0.41718939945604439 -1.2362862955039167 0.166665494481363 0.30803834087541615 0.53253945199165509 0.04167471832669066 0.14020791857386838 -0.66374432182295107 -1.1307909425322069 1.5938923165485415;0.0086381037827006346 0.068279943872232532 -1.4017712816949148 -0.4941598541990439 0.20003544971902182 -0.3826276676650549 0.34624597165432008 -0.53626443881963504 0.62832524699673853 0.11746409099141945 0.081021462177706033 0.8003477588815352;-0.91810001514654738 0.92295929236564977 0.26848282144729652 0.9178506518816707 -0.93633662186849431 0.2353606455934163 -0.63500037132459941 0.49333589281515472 -0.35299074031966088 0.31425240690590389 0.36836007065570298 -0.75557930631947801;-0.19972511637554358 -2.7738902437044408 0.35784332216645565 -0.0064043040640290247 -0.54076474590364576 -0.43731273062603843 0.34425753266061565 -0.038052749059745664 -0.11681342504505884 0.5408773782811388 -0.19300724844492684 0.086185696037684834;-0.06407425564826949 -0.23433050166688277 -1.3515861003662133 0.57220669089452991 -0.44508221083820027 -0.73668890184692704 -0.20209794216116364 0.60586930691461072 0.060021468381992724 -0.39484474847170026 -0.088966616698488238 -0.91157889441793305;-1.8218433404009882 -0.039167375626995814 0.35263786738279584 -0.13316021876264159 0.43283557286596436 2.0006272741272544 -0.52646690181832634 0.29833953745050062 -0.48528116630214152 -1.1589006185551509 0.43577759789739379 -0.00036311808197424938;-0.17120074194850013 0.52690599941479399 -1.0988122066559898 -0.65749588960322569 0.12155770635379419 0.3633394868414756 0.18720019470213464 -0.73462668651855223 0.91731453335500301 0.31291634355483411 0.55285052609331142 -0.7257616641660859;0.53589369207118531 -2.8143787578408777 0.47223337251155845 -0.23834443668958888 -0.79807871661341445 0.024472154065728859 -0.051213858861778552 0.47842243585543037 -0.57542039803018263 -0.017739565680565179 0.07989718769445317 0.2267064003549662;-0.75182935844752374 -0.5629804945735557 0.90262129674217728 0.94160015458551061 -1.270515102037046 -1.3042790601838663 -0.26487542286069438 -0.064213619177037273 -0.76149599969389081 2.0833884725685423 -0.63902969062351278 -0.53561064881300513;0.46267948476317527 -0.23709185693071036 -0.21850004507502288 0.83243662936567586 -0.0095770748532748376 0.36965942026582133 -0.22716142951868099 0.3646213867542607 -0.32766506258707329 4.5140630271833553 0.085760252212594562 -0.56320642391077513;0.2162230871930276 -2.4496961442285174 -0.97569695380161103 -0.18519365154435194 -0.083628843408518186 0.20474757563043419 -0.86211687861971065 -0.080821222506583926 1.3838015141124025 -0.91874978034708832 0.33958299662719482 1.0779496904185817];

% Layer 2
b2 = [-0.80386777436029766;-1.5069579602032124;2.0034569643560989;-1.2482746566712513;-2.4480595811080672;0.38820419097540138;0.074263272663579752;-0.0090988065058916871;1.2557001074962266;-1.6283423533417811;-1.3931426146474202;-1.2733712813181028;-1.2915184399947861;-1.3914279608625624;-1.8999857548670227];
LW2_1 = [1.4226424814561331 0.68201941584366976 -0.51608369010527066 1.3344707073634039 0.93814043709083328 0.25027261121122291 -1.4440918600118997 0.33123002099980764 0.7415450626994472 -1.0958280241414955 -0.23606391925091999 -0.068958859351319582 0.21335730254627505 0.32625340471424424 0.24920891021517819;-0.72122876066045893 -1.4982780796848789 -0.83351850837371588 0.97424613557246353 -1.0868154849340068 -0.063702854668251943 -1.2414463522203079 0.84833964169984832 -0.95924636034119592 0.010444718731022644 -1.6713754743197367 -0.11469605629316279 0.41317042830251266 0.30068014716808672 0.026083821415220483;-0.93138530939433239 -2.1716494959398243 -0.84749726981973827 1.8105355751938546 -0.54297071886777171 0.3764640665052425 -2.0981144376960632 -0.56076973857596912 0.60515231101524203 2.0859277088081889 0.72941220252989003 -1.8044877732253664 2.5910514558882118 -1.5489887789790291 1.6657170261783458;0.40970372020207763 0.16554030391121094 1.0589485944806023 -1.4444494800479968 0.39530836487255622 1.0234209579013203 -1.2406536048491268 0.69060163244041983 0.29522364750986507 2.4106277781969769 0.29818906271982193 -1.3680924608544824 2.2769590049650645 -0.52069779533884308 1.6977501351450759;1.7488942511652881 0.22305743796649846 0.76174089632731989 -0.10002104899014524 0.74961482432116144 0.5003444248025225 0.54382629003452332 -0.31147278894737701 -0.34286843951908236 0.30626082153803669 0.16046692651765446 0.68659785390156469 0.087951909015779164 0.42215120385990446 -0.16337636084153453;-0.36108310115876036 1.6787120837488427 -0.16385687532600776 -0.80703029216410316 0.10472391055144692 -0.68879836655198867 -0.39190773003699231 -1.3037238279024423 0.2136705370937543 -0.35056532970160897 0.62726461598602268 0.60283584208947716 -0.25699116832298896 -0.27617577860020132 1.1177830848149737;0.54925785252414872 1.2313611966288434 -0.17196418241015149 0.82588001462295624 -0.7760641920027066 2.0049155874188456 -0.75685826166747638 -0.75250695524527678 0.74912045965188767 0.46262887193839697 -0.055129057666705596 0.37638663213228124 0.72832753114133109 3.1363554742886564 0.00011425374886045621;-1.6974775986031552 -0.34552591029444857 0.73229341507125245 -1.4096742308203063 -1.5635742703445321 -0.27261262159952149 0.67523857640869722 0.20433564235923565 0.15747110775993642 0.91780891702124279 0.20079119088226341 0.050308460388940712 -0.74323570493742508 -0.17276459454664955 -0.37507383973256953;-0.12631929503817904 0.65676938540113128 -0.93896986318020126 -0.33660655884779539 0.57132364615028053 0.43633777228728698 0.91885830259254497 -2.4684205773205803 1.6714964464705859 -0.23767320970548536 0.4314553038597132 -0.41519568657831668 -0.37323262771529203 0.39084026853024711 0.316894717962515;0.1113486793194394 0.051234365549687841 0.534930120705291 0.73959844600690972 0.46884940418276216 1.076352308294354 -0.034004777568880949 -3.1606859337381668 -1.3752091775686084 0.31082592033301387 0.16000940242146938 0.48395651287725883 1.077151860812102 0.58435343764795344 0.64325723714175553;0.64768894586559778 -0.51286315689393147 0.8224980016613832 0.78672099047745558 0.15298419731609531 1.0097685280263653 -0.56590027669347176 -2.1901405925489783 -0.96986743442649104 -0.32236149165206585 -0.14258215681899161 -0.095707605709390478 1.1140353262762857 0.31892302405525358 0.51666188434676374;0.89369249115367955 2.8797055166377512 2.0087825272058581 -0.67218438614991149 -0.48944713085655922 1.8500759285719546 -1.3930782535499209 -0.050341501595733744 -0.072009143105643936 0.59531573094565005 -0.1113867949242834 2.4741063669455556 -0.14503667031594686 -0.6345205943964416 -0.3761818068360453;-0.79332581200314389 0.54673150410895577 -0.7994644074668128 -1.6574608948338903 0.5833532589192939 0.89448637156304855 -0.58376203550165473 0.2184976325184608 -0.83392694782192378 1.5487216659402165 0.23676916282733532 -0.33803201315363984 1.5988298628430557 -0.05185019181061553 0.46854101804375003;-0.53405708625096338 -2.7766454304694137 -0.09006656147932976 0.5752190065964935 0.70833297841390119 1.4295183241086662 1.6523265780894911 -1.6288641187785857 -0.15881087111629849 0.42789371374258872 -0.06313071402392087 0.774893589419552 0.15107799243762646 0.89857710017070413 0.7586250785967954;1.0478539144692864 -0.41665237283858508 0.54268981916965542 -0.077274051443453701 0.029106505337509629 0.34343461060860159 0.33814306124312121 -0.59049603171802834 0.074592919867244867 0.15614458390055497 -0.098366634687636761 -0.17092639201279478 0.79760680099781389 -0.44014515138282889 0.11325821176656886];

% Layer 3
b3 = -1.2293697523722127;
LW3_2 = [0.65363825677105858 -0.81042871919909154 -0.47374488315012159 0.65430493112933119 1.4474521449395417 -1.8894174428201878 0.59934975112966093 0.54347765548865112 0.91408879908977669 2.0837501284512356 -2.5107271758802976 -0.10228439900521769 -0.75980358451478536 -1.2699368119859498 1.033939771411716];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
