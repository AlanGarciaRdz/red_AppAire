function [Y,Xf,Af] = COVallarta8(X,~,~)
%COVALLARTA8 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:20.
% 
% [Y] = COVallarta8(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206;0.201288244766506;0.281968137600451;0.290275761973875;0.304971027752364;0.100381449508131;0.172786177105832;0.171659085057077];
x1_step1_ymin = -1;

% Layer 1
b1 = [-3.0043113727980906;4.6351434572446344;1.8215914698727447;-0.69282198613563883;-1.6952023570739914;0.24267431354117025;0.094086089573910542;0.071235027033787396;-1.5398775503970636;-0.16158987979475445;2.4265349939542342;1.3706940294873349;-1.9034150598778714;4.0461502002526961];
IW1_1 = [-2.8464277765367303 -0.97174205305215722 0.036983967736530371 -0.52302012238842144 2.2611263136203048 -0.93890598765302269 -0.019091992415224954 -0.58111897772000498 -0.1940034313965677 0.09117819197909742 0.36828374883319975 -0.42739106621496781 0.10716027206205142 -0.073921553134018547 0.13202977735406185;-6.3863474049021134 -0.021431850246322916 0.61404657006370178 0.2575198123782792 -0.17974723797102227 4.5713793620533369 -0.060349480571604622 -0.017250885001635428 1.859325796346643 -0.43122846173774571 -0.0044769786150481439 0.10461418313284604 1.3897507619895653 0.51248588662942862 0.049236810454384619;-1.0777236882501453 0.60687552902725361 -0.4245397783884769 -0.25145627278768046 0.4177460020908712 0.84705344397200555 0.01426357865426605 0.14886059171482027 0.53667520639914557 -0.23579672886664826 -0.071934919814719722 0.18388469823345369 -0.27826398386013712 0.096614320618436542 0.1472353305784842;-0.26544231023026926 -0.53725004119310082 0.11207895902272752 0.45037003544112031 -1.0250799936012114 -1.6455928943658988 -0.10114913486353724 0.10059646128008556 0.41936022664063211 -0.011253768642252148 0.48495176686737212 0.39466587772751793 -0.073979035783225761 -0.63622528767993802 -0.36872824982740121;0.355038860708346 -0.54658263870063184 -0.64306831036886314 -1.2257895217721948 1.3800371560817049 0.088770132493620146 0.28695210163866464 -0.56846154135814131 1.039881178757468 0.51536109112267181 -0.29354155972057694 1.2473736619657714 -1.0702460325930991 0.35670992229315412 0.60071979900761074;1.0327660845733035 1.6556758033224541 -0.29153965388130804 -0.023262951911924776 1.5326008965603595 0.020730807732973651 0.071900533960099156 0.04728731156042746 0.11798800915394865 0.29645817007626513 0.11742597361109421 0.037113214716437068 -0.15058883355622144 0.16271576931895124 -0.14824700695448059;1.2652045074217486 -0.31592302080782325 0.29582797103485614 -1.3585393452279437 1.5727192170722724 1.1499023919025904 0.10682748392232701 -0.33022172538514494 0.19643365932317575 -0.0066989983436723686 0.076279710879412502 -0.34532488428620872 -0.032654797811782044 0.040807271689156287 0.76928929944674873;-0.90268695377509667 0.469927706371634 -1.830092763918904 2.3365378800375534 -0.15982084430650911 1.2880950820512205 -0.083494337668685178 0.6128892063230037 -0.71455820261987768 0.020683860524437589 -0.58837035420517014 1.2418499025830021 -1.6424362179790346 0.91061665070300812 -1.4413491967104941;0.75055526738792422 -1.7007671170621017 0.29923717358956492 -0.16393214945992279 -0.7852867411703659 -0.2220801895733332 0.05773215103397647 -0.11213661267665143 0.2486558407078838 -0.012658651178449404 0.52878058242814763 -0.0099311143286853337 -0.11981348261268493 -0.039103969247699016 -0.10057174743741094;0.5309714230655751 0.32132356179612542 -0.1853132954510871 -0.14853301823283926 0.030748789012687218 -0.63150292548011111 0.054234753578184421 0.20249069254304938 0.14051328427106163 0.23743041746629431 0.2087969084225994 0.11670702656923196 -0.1659947918194363 -0.023099915731193583 -0.2038100726450745;-0.025882883208269456 -1.1288147250689231 -0.42539529583137947 1.1609638809643927 0.99919771712431737 1.7039033447998329 -0.026831311788597309 -0.26890351895567166 -0.16796985133581971 -0.38805768557372294 -0.17199562889408485 -0.049455174836524292 -0.036136032549598004 0.54505135694786289 -0.22999823070820916;1.2316834673572525 -0.45871073341898677 -0.7708098896160589 1.1092799452461026 1.4462319405236299 -1.6262969754330781 -0.16877767457549675 -0.26292976895395676 -0.038082278537770173 -0.28983626295066472 0.31587650996017175 0.8480005009762529 0.10435372901769212 0.29606572337258741 -0.31068226520585807;1.3726063818523364 -0.41719275923684263 1.2625732156077587 -1.4196624289107478 -1.2881418303374157 -1.530387764272324 -0.024853279441125982 -0.45066690281135352 -0.23363854130195791 0.14295345982626201 0.25412664608263813 -0.34858849681488124 0.76839298251763788 -0.33917687436512783 0.45049458403978582;0.11219502310390393 1.2295943237195477 0.090656468370589355 0.20890425752450334 2.2803716059596146 -0.06569866412733244 0.044347153719801753 -0.18170216590096824 -0.36338439982270154 0.27309416154767985 -0.4203251851914831 -0.37974887241552419 0.57796876092638261 0.25493354095810483 0.076530582421327098];

% Layer 2
b2 = [2.2086772046026333;-3.3644871680482167;2.4880899539624326;2.9306574561808372;-0.85494131900648307;1.6618827358487125;-0.051879781450042094;0.71911950086023402;0.40486648153025118;-1.2175042852898696;-0.96137479855265573;1.0760053612192724;-1.3677775149577047;-1.03404296690659];
LW2_1 = [-0.60707019677295182 -1.0281319294610325 3.8555071456706851 -1.6355703931853276 0.24262460034247146 0.58896264285089706 -2.3171328627062295 -0.55180587917192647 0.29427103351265438 0.38376349481572913 -0.74266047495897636 -0.35303606358854916 0.52525992570048641 1.0393818857320942;0.84603961082702861 0.32085740019708464 2.1416703477601278 0.15369377478351609 -1.0360380937494607 -0.0057044119155123148 1.3039326415066181 0.76999476199959016 0.057476358276414286 -0.40012574298765213 0.37257587487860744 -0.14304758220330285 1.091496252720791 0.89217403412279739;-0.88987680706808103 0.44352156362211875 0.21586355128446524 -1.753342488962498 0.41823879068135672 3.0999011769365215 -2.0009066231252102 -1.0566769448929967 -2.04126641566228 2.5226647764064771 1.3968769009020146 0.90961363299420306 -0.085827397639594155 0.20010389576115201;-0.80701321347692445 -0.47682876386119716 1.2104978907561201 -0.78573443072963278 -3.2543685832447635 1.0164005718246412 -0.095180290874628065 0.27052223791625829 5.0289102832053025 -3.6287668910162947 -1.8246282454631415 0.16788684917588659 -0.93673920787632481 -0.39830853519164622;1.5022769954453044 3.2603966441206285 -1.2754744001072531 0.84990429530606881 0.37243628842871163 1.7718468142873314 0.95388273780161281 0.80355145034315045 -1.4049204798435748 -0.12602170257187775 0.72451356708519987 -1.0549968271727526 1.3394644923268548 -1.1577648405901548;0.4479684516899532 1.1550223413373728 0.18353492410250727 1.349527426563143 -0.18841190478430464 2.5580297646975891 1.1811701290095196 0.53390106886663724 -0.37507112162386114 -0.46069354151230274 1.4624349808712362 -1.3612407434826239 1.0259328600815707 -0.42544500554810849;-0.040863272407040692 0.1028579056984178 -0.41610254249031525 -0.16920027382136432 0.15921847614278423 -1.8648281703450706 0.013460048669289175 -0.045539638271885605 0.68503925102848173 1.8713226878881339 0.506643112283512 0.082674598361171234 0.056789655196039027 2.3084448871649812;-0.056936121863250394 0.21865029131070232 -0.56368471028142741 0.17478306404778651 -0.62892751023218907 -0.34812009407766353 0.69490054693217196 0.045261053097447032 -0.99941313657660635 1.6544783145771729 1.5113663990672055 -0.75275584104582516 0.6689437509545163 -1.5515350944425395;1.6382945183046571 1.1513447428234387 1.3067057551908661 1.5132101674068721 -0.45989522661446136 3.0210552894812222 -0.0042858710687283912 0.50466282270365004 -0.060645086134725634 0.13144876697465019 2.030386746472137 -1.4638365150861861 1.3484608012877064 0.13419275265851893;0.37292638058217953 -0.18882445900690473 0.51091707959504196 0.87765111506741611 0.70997876523868231 2.4023750690837615 -0.60308995565193957 0.083582258815939933 1.6734493380411337 -0.70605269497945689 0.51195765913689706 -0.70227187728027307 0.94035233920774286 3.6385242477377999;-4.9421087697913624 -2.3129512821908547 0.28656535331255389 0.040278862610970835 -0.33452906936803861 0.34717184295515907 0.020355203504459768 -0.5105650669983256 0.17077008895954646 3.1004577826417443 2.1444645957425923 -0.3464897959561124 1.4811862757341387 0.062907239962583766;-0.14573400013027546 -0.25128460424492721 0.23013832768981157 -0.4153219561618412 0.34773908680273719 0.69569271410927369 0.48518509525662779 0.6590559174864461 1.381131183465653 -1.7442197216861703 -0.53511686849425533 -0.21977297449182434 0.2464457581468362 -1.1681995723058967;0.038944825671905145 -0.14105128606597708 0.17231744795104154 0.42451879042774554 -0.094438130350730426 1.5898827504304229 -0.44590002345564961 -0.15204221117181099 0.81697515143401234 0.10597371860711299 0.70251531313581428 -0.42335236432626883 0.65772919181341993 1.9860042449052948;2.1105619360923797 0.15860285380836056 1.3524549247026745 0.095182408850603833 -0.14322574402596278 -0.57032861490901765 -0.30803720015549363 0.44979658191124777 -0.3977103416097022 0.44903084763414042 0.58893016889270766 -0.19282329419231067 0.60067668706214938 -0.014576630363678834];

% Layer 3
b3 = 0.82512540272997004;
LW3_2 = [2.2798521600463615 2.7534419785314914 -1.4430829549081434 -2.9073971498853797 -2.5898049339370601 -1.6596456049599815 -2.6014199071175903 0.95512581385263517 1.3672001492664481 1.2751365811631614 -0.49761420371607934 -1.7855233236702246 -2.2716922751392352 -1.8400188104105772];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
