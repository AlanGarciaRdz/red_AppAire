function [Y,Xf,Af] = O3oblatos21(X,~,~)
%O3OBLATOS21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:46.
% 
% [Y] = O3oblatos21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.100381449508131;117.647058823529;0.0560224089635854;13.1578947368421];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.0033771403578311;3.9967954643920947;-0.39741040352807977;-0.92243239798385779;-0.14030566946136649;2.0605403280077828;0.601117668201686;0.19500449893872077;-1.9167217838454795;-1.1643223486932086;-0.36736472059335701;-0.3703494008519474;1.8541782351542064];
  IW1_1 = [0.65166463074357395 -0.46567985729955919 0.50299272216420077 1.0599956852376713 1.5808135068568463 1.2520724181498184;-1.6307614584557297 0.46547553969689087 -0.21483052426602714 3.0313413010809804 -1.42629177537686 -1.3118287208641912;0.62490307417327762 -1.0563864761196997 0.94865444494605566 -0.71881262634714049 -0.46221385442674862 1.1916804104431853;-0.18119992422539311 -2.2674428791664685 0.19669784385745775 1.2639515658369271 1.4036405314261375 -0.48875104865264418;0.033872608128824144 0.92138028186951948 -0.68965370429751549 -0.051798934207225061 -0.91901730917885094 -0.4676854831282492;-2.513051465905936 0.44750921819550532 1.26705251033847 0.09285081299540543 -0.33748786512849294 0.32896193142076308;-2.0631987308799324 0.28054035452842763 0.14264902764898019 -0.4024566633183006 -1.0555874622052288 -1.3995163771804284;-0.53732255814307328 0.01316822269616786 1.3394438046209678 0.58211098587859833 -0.96577046273252221 -0.84301032899302464;-0.35316550812534386 1.5924725337253445 0.59065798555680793 1.5110802687356246 -0.83784084826029093 -1.1153239032582041;0.22238360881449787 1.4886513432354562 -0.81205067076666082 -0.63478928172608673 1.6500680472012379 -0.52310542948021799;1.8611939098216139 0.10939129567489439 1.5832462320501191 -0.17982746022944204 -1.116967619351048 -0.64326451821079311;-0.60531842362962596 -0.86714961733920926 0.14543946182452314 0.47920895599302782 -0.74351251201653623 -0.79380215375213858;4.3697679020478111 -0.26189519046274096 -0.19091278492352723 0.071383387533474521 0.79022030030197432 0.081349194883191672];
  
  % Layer 2
  b2 = [1.3685642616945319;0.83418502143835116;-1.1363758213589847;0.3744710877286217;-0.86171016129560152;-0.40671204624425383;0.39839522391532722;-0.08935748195890017;0.68143795985124811;-1.6309961234721926;-0.14596546053198362;1.7179719201183423;2.2230283509774957];
  LW2_1 = [-0.39845212655340334 -0.0086879063004289894 -0.43162989416320807 -0.25703800949528299 -0.93995625604133537 0.99522621132970301 0.31496553436420838 -0.33134986143908274 -0.15779081535548439 -0.043135506315288973 -0.24455529851582022 0.12045175537384308 -0.84693412653890188;0.3949289396215252 2.0058240798595861 0.54549861454722326 -0.73408271900725286 -2.5812495499814241 -0.843525077885379 -0.74867169450457971 0.63046721919108251 -0.663030888166384 -0.38385868499444498 0.61809412576092349 0.98375712550626693 -0.66147503221064241;-0.2974657566610891 -0.38786145081127626 -0.8375444862418403 -0.82536371376396422 0.41186737230121434 -0.71895923564186692 -0.66413300842812473 -0.58130410818155165 0.68486173243379911 -0.28664481195223657 -0.076067647843947039 -0.024911038011002168 0.49108182307806647;-0.46335797802008499 0.25553740656958956 -0.28543999113791318 1.5889754376728635 -1.2832302172824934 0.80483211007991295 0.71002914233496173 -2.1953786095577232 0.56188809113239624 -0.46551711839392035 1.2498947890098508 0.33184102376857566 0.34747068857851621;-0.43651203645033071 -2.6938087483290145 -0.80518023291871632 -0.097245316485721142 -0.76366189984463628 -1.2426278029657774 2.658499167549325 -1.007164359727722 0.27390251063258647 -0.12490898850072843 0.54590724603479668 -0.25884930725672828 -0.2940586294227967;1.0801239348457667 -0.13994966541904705 -0.55852875138821312 -0.90847805345159716 1.574740891892159 -0.72468411847003433 -1.3015087836151853 -0.19259837845011643 0.37130813680017771 -0.10891923289951509 -0.39241682567575348 -0.45335096544231079 0.57305968908526528;-0.57562949512482964 -0.67614269929979853 1.0878423469642375 0.14340024200149087 -0.023439337043842288 0.52091686701219098 0.28252417594575507 0.3401098635330464 0.028201839474490634 0.13904160066157678 1.0059973969218656 1.3310871119563361 -0.040920061390322018;-0.68438929037613716 0.3506497592901488 -0.18358810968287739 1.0988639884095421 -1.9206468675140267 0.28826658975470271 1.3518990080913225 -0.64798542620663491 -0.33590654079204318 -0.74429476140034934 0.89612156619116456 -1.1015614323644827 0.046514229942022048;-0.19277565507262956 2.4186995031386833 0.9266909897736012 0.27923623207423642 0.21134621371979109 1.2592589890241452 -2.4045849261724856 0.7334418332635545 0.12194921283572892 0.36101117223632267 -0.27692103753244873 0.31117503449714567 0.50966151302651164;0.15555869866499378 0.12728220229139467 0.80108964639465963 0.24320512355421919 -0.24220057991112415 -0.37769166444783364 0.48664327735906321 0.051941320319270588 0.92059088229895036 -0.87658625867570461 0.63296216572233732 0.71745042353749877 0.62833873627638503;1.5021521437202745 -1.0171305414844618 0.18012259157952937 -1.1305194898596429 1.6667667559722543 -1.2180461581897557 -0.034656085952185611 -0.94702448995492938 0.87168008895362192 -0.50130794169813464 -0.33070087357999789 0.32817063900916377 -0.40737769490330272;0.29835143901893513 0.12235330290359805 0.48740994127041443 -0.10969650852148106 -0.31018575572802654 1.1687368227185164 0.59264953584377089 -0.36883713920149741 -0.6950082451385784 1.0535398614675826 -0.44019018201215721 1.663047817159172 -0.70396590298184369;-0.47946638441607708 0.15676821716979342 0.77821211935101553 0.58489976075861816 1.1527342839337267 0.54567463492230073 0.033456086460955645 0.51796818658299137 -0.30095561445232405 0.48787518999892809 0.58998902647917784 0.049454595456146153 -1.8828207873719334];
  
  % Layer 3
  b3 = -1.0432564676823375;
  LW3_2 = [3.0201886865617515 0.36332931722765238 1.6165377627352442 -0.63059032847109175 0.86552950984698596 -0.95267134902060624 -0.64928391011748243 0.68591374928642812 1.1021833945218753 1.541922914811878 0.89728410814949999 -0.93469235218475011 0.83894971834296883];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 13.1578947368421;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
