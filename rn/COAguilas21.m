function [Y,Xf,Af] = COAguilas21(X,~,~)
%COAGUILAS21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:20.
% 
% [Y] = COAguilas21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.448430493273543;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125;0.281968137600451;0.304971027752364];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.24119851349442245;0.52058640637073395;-1.7785407068632473;-0.4392386511846666;0.3397886349530167;0.88670821979696846;-0.028238866111135213;0.61050899258476865;0.90589788673414573;-7.1262040653668937;-2.6105087402239664;1.159935237615769;-3.7533702053200297;-2.9951307366810962];
IW1_1 = [0.42169704771762956 -1.1443721608105899 -3.968355623147358 2.3065920412710303 -0.57220581524544234 -0.32639721860037096 -0.20976521963226799 1.0590827602950648 1.4055635838653417 -1.2546265703519697 3.3123283401414176 -1.7624599326880375;-0.049066140410884314 -0.2776792883180571 1.3651459907840626 -0.79172834646698709 -0.29602109916047326 -0.41255895725275171 0.88220347237842323 0.79140094728083243 0.53838869078075235 0.16058754855154075 1.4227081722649331 -0.60009646076863266;2.0679328667272876 -0.40614408007106406 1.2019695701008599 -0.97034934418818131 -0.071788292730873171 0.23947367675189607 0.44182969327234339 0.020187840112079039 0.035890891761453547 0.15753353947109569 0.54227326472295156 -0.17712862760915757;0.50021951802764264 2.2245377985057027 -0.16256029996914151 0.28486506127804784 0.10191788555328815 -0.031540862890712285 -1.4906998860815488 -0.89772870825018825 -0.05256613385029462 -0.10562837224787058 0.79415466261166801 -0.54765725096257734;1.3150558508215213 0.23377616986200886 -1.266204114179559 1.5071089598635714 0.52685953793213935 -0.12613298271926915 -0.71972729159510385 -0.88012558886361303 0.93136919374020499 -0.71941528524774434 0.20400009054363077 -0.17403608992003924;0.21568404680537931 0.37580774020894858 -0.59482671134107412 1.0493584505466749 0.28699829282791445 0.1396308938425693 0.29536633887339508 -0.37687810579785508 0.70472947809329001 -0.38371282630919201 -0.11580762221282552 -0.27440050202035826;-0.012422873563282933 -1.9955464353662884 -0.13184049360627778 0.015944984804509003 -0.12767057280209027 -0.064037258824054449 -0.12663135949145446 -0.28697675296773928 0.048126156862287557 -0.15022803675723978 0.015508043680455091 -0.18770398089313087;-0.30957621666302787 -0.72522274087881777 0.2485544588109655 -0.14408216752218089 -0.08077011275541901 0.05907353609958306 0.63427618373400663 -0.41900165836437775 0.0094928022691777858 0.058756079723870355 0.079620203796237785 -0.082682771239272812;-0.26826116565604197 0.3769842488548717 0.26500390890513859 -0.11518613496296301 -0.037103701817878074 0.018438784839588131 0.70427410199923146 -0.11588335925167859 -0.28342325445765076 0.16173242590471737 -0.25363936928174857 0.11682015112893168;-1.88256037792416 2.3340971573106994 -4.0628536528420174 -0.80936830703520457 -0.33429977489294282 0.72139446177307476 -0.54833272185541859 -0.069696074362680646 -1.0587712123813848 0.21076044943189004 -0.47154360997706424 0.32102626930476064;-3.069351813839782 0.78325743843562279 1.3054437132655445 -1.5001494569875655 -0.33561111047997322 -0.72283909383951306 0.61564169813195035 -0.49149224745077874 -0.40445260762647278 0.11396251650603394 -0.055656169933471257 -0.45457591696879412;0.043751519573186175 1.8670664016349152 -0.71936650241149847 0.7512807955639994 0.2124259039738394 -0.072136561900276411 -0.39467155657271918 0.95200926199972002 0.044748693618500528 -0.10293162223227452 -0.13890574749063264 0.08554132284874362;-0.50806304190223428 -1.0321858536495994 1.4714293879843883 -2.939913712449016 0.92595527947696932 -2.8210982178345976 -2.3784536736346538 0.38470621507583119 -1.6541161770984052 0.073267655161033313 1.6545969377172243 1.8671711462421601;0.25014915324339215 2.5314093685321963 -0.19593011248330616 -0.11269748160076698 0.11466691956153222 0.13897454513755009 0.15815694286575724 -1.8926405566634972 0.42457783963185391 -0.16467720405174693 0.019611220664610476 0.0040618805582562471];

% Layer 2
b2 = [5.5187986317373952;2.267119400232493;-2.0876790528801634;-0.9926615002047201;0.65497910177037832;1.8047665384399767;-1.9726245581406086;-1.1208527347596686;0.56959119315289686;-0.32059243389820091;-0.19146724000894427;-2.4386633657628223;-5.1719184469470632;-2.5459554779417979];
LW2_1 = [-0.69548442690177392 -0.29912587746384667 1.030216293699725 -1.7252501623372587 1.2800141531383276 -2.5969119750040206 -0.81112033467701639 4.5676725832318699 -5.5562579854557796 0.3257897757924535 2.1821374881909161 3.1595771975392575 0.13302120629399511 2.7140130944944425;0.68546290367822338 -0.96396284342835048 4.6437431462992791 0.45998677289184253 -1.2919471680213959 1.2510329774194404 -0.26417139502325421 -0.28541357277842228 3.0013395359257924 -1.3023340644733203 0.40399236833234131 -0.63183115566925141 0.66501515074218254 -0.53006167640789614;-0.13597507976282952 -1.674241141969981 3.279911817180758 -1.6231551741676571 0.041540516600438518 -1.5507000582654415 -0.090100941112695079 -3.6878738699685218 -2.0914316949407112 -0.74475786125053478 -1.7160384982273964 0.47686057729254694 -1.0147282230755228 0.27175745827856046;-0.052863735313646354 0.030726772861288817 0.86399917245226343 1.1024393345353549 0.46324230998153437 1.4823429278400335 0.32432299264643916 -2.0374497117755479 3.2370903535332292 -2.0128237210335009 2.1858840935490575 -3.0179366278366393 0.79479769472308903 -1.9702944632676855;-0.56403689522680733 -0.12382332981879392 0.34718947698005215 0.42523303934892398 1.8790712440570059 -2.6761225099952854 -1.560591932264088 1.8131135630634159 -1.6306871017672662 -0.42336015670342747 -0.13961883693327268 -0.32981625139070386 -0.15462719441370049 0.41312325938804711;0.75751458166684349 -0.22797426097355172 4.563319170926432 -0.0077391395760744615 -0.5477590136261884 0.54680782037448716 -0.08153241111398149 -0.81820335419756174 4.7697317053178905 -1.138019107474042 1.3164548441847634 -0.63025142174073356 -0.06909652638613957 -1.2780154019720418;-0.34622167572586354 1.1617025978866373 0.30839192023643863 -0.58657222193829406 0.71634883485215251 -0.87460960293673906 3.337645393529129 -0.32511470339256698 0.34414044439542435 -0.53748115716837686 0.58974887572106816 1.6273601232537074 0.49457970725515432 -1.0710304410599465;-0.41548950865929529 0.50409462061995147 -1.308241120794263 0.500246157301517 1.3144323652894188 -2.8732355539372083 0.12837376743153703 0.46629689127304264 -0.81052368018059096 -0.47768168277272055 -0.45304054680030009 0.24422334597661896 -0.52828009533353459 0.13885795572298465;-0.36131771069974561 0.53190609268290823 1.1008266546531347 -0.31660645416987537 -0.16973451284530891 -0.27217484472821835 4.3428268498870439 0.78017926720362341 -0.62863130519754473 -0.21478110361660577 -0.28708418795691881 2.1957111096856456 1.1719276418230475 2.097702117990722;-0.26274421362827549 0.80791338045842154 0.2749116802471645 -0.037762308034812238 1.4092930820968592 -3.7376702028882018 0.81501484552567971 -0.35668479568915074 -0.27269736411718692 0.45371422901852743 -0.48016238117024251 0.75640604186063432 -1.5690643371295787 -0.52293034240221103;-0.0059440929682313855 0.16943047179880757 0.72209675929210271 -1.0628822250461256 -0.36544692320412131 0.20395049631978346 2.2340925539990217 -5.7518459274897316 -0.33704529163881014 -0.9721728933787751 0.41133244026893162 -1.7780591350713548 -0.10244644037016501 0.82579247088829466;0.070741475160944756 -0.3804580960539477 -0.5221693840237337 0.81906473235055632 -0.097390754533847629 1.6544362100528562 -0.51256132454122538 -0.6768707702065071 2.1453898109540952 -1.6148338002290046 1.4289852296609664 -2.1146777758688344 0.98384027652162076 -1.6759077273144916;-0.40727253359531529 -0.4108250253911947 1.0870875870906052 -1.0281852240807676 2.0324576130174519 -3.419239787808988 -0.88908235069211461 -1.5021037004843587 -0.81040281679357806 0.42899457762023552 0.64342254260955811 0.52129770172702816 -5.7612275559869337 -0.263934795814733;-0.86083640588364041 3.0082503623477108 1.538397868049562 -0.82007100574502634 -0.30192053239166272 -3.0035135764476824 3.7387172407148692 -0.6523956569696463 -1.779983769565912 -2.9577258477604254 2.5118326480621369 1.4401999816997972 1.3556553604992336 -2.9731856021441194];

% Layer 3
b3 = -0.34796594860004543;
LW3_2 = [0.1834451010014041 0.58581809759811521 -0.59109302175807632 0.53690503627574715 -0.4791013337568365 -0.34592136481543517 0.75500124347304576 0.65365397131912373 -0.90352297421061889 -0.51459255897643164 0.9357794330115079 -0.82430052320082858 0.6528020340465901 -0.13456803509135457];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
