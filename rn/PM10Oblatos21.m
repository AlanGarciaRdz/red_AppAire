function [Y,Xf,Af] = PM10Oblatos21(X,~,~)
%PM10OBLATOS21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:25.
% 
% [Y] = PM10Oblatos21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.100381449508131;0.00618238021638331;117.647058823529;0.0560224089635854;0.00280033604032484;0.00462534690101758];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.3986458669805679;3.9122131493718046;1.154500244703583;-2.6711888109281952;2.2812599443824095;3.4782716592140344;0.68653214403722118;0.85330403376666897;1.2320654519031446;0.49180517879846869;1.319435339902203;2.4926505074335976;-0.4241433930406055;1.1326300766567696];
IW1_1 = [-0.32114445414293369 0.29681607953918204 0.39011259129865622 0.69026030653155912 -0.65604528934028594 -0.98372909267372255 2.5187166011386375 -1.4919934810250921;-0.1761639814967586 -0.23514407160537579 2.7940042262527705 0.58207626980160421 0.19929441744799448 -1.8520862233697495 0.83422185261718196 -0.96296067335586233;-2.3406853624183936 -0.36890300880891497 2.9883782063900828 3.7372330737628743 -4.3510344737996585 0.87468852620240023 -0.016677065161800928 -0.14185198870203863;1.2560230678768909 2.2183988913064652 0.19246536163088951 0.64950980427763627 -0.14758379907827163 -1.6957063418027611 -0.18138279394271814 -0.096056605229193043;-1.8747151713868699 0.2982707543611246 0.15600098201993329 -0.58166392457218841 0.31792146098812085 -0.12906876986785662 0.31730107214260173 0.1511567233721979;-5.2589506677534947 -0.36064409691731525 0.31515281601174977 0.099894179808856842 3.063900038950917 0.45476958730880868 0.46247756839192261 1.3224844043562936;-3.9538088428437028 -0.008197484271782126 -3.0421839175561578 -0.50477321482495674 4.7599588658032559 -0.16092953374114838 0.76222040700629456 0.82795689228001423;0.095972561938905104 1.2717993810941424 1.2230828473078459 0.43167792809475614 -0.95037186771665472 0.64330989657428617 -0.31934587681467647 0.72493981215347392;-0.26645631370130313 -0.36109292192019798 0.8973592189806463 -0.41000794525035378 0.14548079857258253 -1.0206699564783699 -0.19171880028988408 -0.2860505747391473;0.14520152243873477 3.2844411269203819 0.39870703053607398 0.51195381703282461 -0.095243954171909215 0.28099288719335191 -0.33609142733538133 0.6556823008486462;0.38605331961031808 0.57885562300698745 -1.8812040406470258 -2.544169853198925 4.7498437249846273 -0.66536733502629486 0.27159062566116382 0.47340399271584355;-0.67572080547525315 -0.26555648724302017 0.43205616193396479 3.3622700764468729 -1.6579306370320892 -0.076302962891500015 -0.44536739272024167 0.76272244163338054;-2.3090737884787096 0.068601274484471966 -0.92277168684275923 -0.036426702460633759 2.8104195467123114 -2.2388755916707672 0.851078514456858 0.44895903523598507;1.0693469666928472 -1.6206509738781794 -0.17558246947868969 0.21373844113506812 -1.5170469385158645 -0.69775265839059797 -0.063282670400256064 -0.3367823986169452];

% Layer 2
b2 = [2.3272501587230208;-1.3551076585686821;0.77846310808668906;-2.2840394370263102;-1.3951148981320027;1.1130240671773104;0.64364197280171498;-0.35876608018078615;-2.8313805874893938;0.19668983503884163;-1.3757167435202025;-1.6476502214693642;2.6317893584192316;-1.3075993817750371];
LW2_1 = [-1.5265158704113599 0.021453650403596564 -2.3383702101028589 0.90057153084733399 -0.98008881617991195 -1.4785014524265145 1.4624536048515957 0.2549232355175281 0.025574541688239021 0.12396569083244768 -0.012813061672514725 -0.37380122501877794 0.30727581953487121 0.29831823992013567;1.8496767856245482 -3.2247456663747589 2.1165996074896123 1.6513305954518365 -3.1955181027058486 -2.1679465019119242 2.1038725970786123 -3.0265769367260495 -0.9768778500034192 0.55203134386483543 2.4943544706962548 0.7004922520785889 -1.7519977252052572 2.4134137522321901;-0.21156578642462862 -0.033989822897344965 2.483898264175247 0.46151968221934792 0.2873276172629341 -1.4351548441767252 1.0746549765568068 -1.6829888479973578 1.737533365399986 3.0377103586708132 0.99799352093785465 0.62908094376539703 -1.3526294594224417 1.3678416192957561;1.214241070546169 -0.067686377962703534 -0.0070415108526020488 -1.3745875577453563 3.3002117227777852 -1.0112070630005807 -0.38917733011065447 -3.4781705915555987 0.013214087242377791 2.1123310110406748 0.41823130091602745 -0.53390855111393365 1.1517704860024398 -1.0862308276411428;0.64201843464143848 0.36822775682940673 1.1119179901841481 -0.019047878610904151 0.55146620665823731 -2.0862935202577022 1.482467709435956 1.3531455818465519 -0.3339852305932669 -0.016778323303866319 0.10545373424372154 -0.34842479384384212 -0.1744932093035983 -0.50530581486934001;0.46615368500777932 -0.37093748616101702 0.3026811693207474 -0.46800502699731494 -1.9264575545670815 1.2194013289932284 -0.63712436924931826 -1.0783030742339226 0.26894118104419795 1.2221353698381818 0.12982561841485155 -0.47968849516286927 0.29948940227378068 -0.14200017520265823;1.2642071246186575 -0.18259913089533064 2.2142847975838436 3.9420363771964677 0.41631185975884333 2.8440464622170407 -1.5068522078440085 0.84448191466914091 3.6987197658881379 -1.6678852779809092 0.94010886903845858 -3.53574903215062 0.8183558523161728 -2.0777443054390221;0.76850113255445363 -0.23617978163906161 0.19312743466909235 -0.25487053428069945 -0.8119718029444315 -0.67369944612679478 1.0267610898114996 -0.32903956694888109 0.59636423857804288 1.6496125640903501 -1.0164853591391214 -0.9841963409454616 0.40617697304234213 0.67352895016586734;0.2819433604490752 -0.090298202567889493 0.044549149752190501 -1.2695223160120785 4.2215221476640572 -1.6004909012290907 0.37367594386955233 -2.4185590612765466 0.72108475353836277 1.7014651813490329 0.098487473448891583 -0.44346157479182752 0.33462306077577336 -1.3564908998646175;0.22743331773826556 -0.74691859439918373 3.4933146588925048 -1.5035943184856913 -0.77955118458266182 -2.5504581266675999 2.8440949050128701 -1.2152327610373921 2.2421866746872872 1.8306801162931581 1.3797958021741688 1.1439021172923749 -2.0258094959564388 0.22179038979283233;-0.30056166881138258 0.1977748685103467 -0.089760510287886661 1.1316641427036029 2.0646933862246621 -0.065524614815037782 0.3555048863859715 3.290219062974518 -1.7104698013405164 -1.4428454141518261 0.26318078066166778 1.2190058409739604 0.45681098358760114 -0.37564798017920387;-0.70658641325245941 2.063849118886222 -0.55379778616774022 0.70669858112166695 -1.3247947907789794 -0.90404577228105265 -1.2178381999319674 2.8083229850258329 0.81402173636108444 0.78798982576390308 1.3265487887378706 3.577954068667093 -0.5811541826594856 -0.89616972313226417;0.41539195312061022 0.35321892885020312 0.19989309381647219 -0.67353092025426486 -2.4954517406461263 0.63438315245162025 -0.26622747485344644 -0.20825252478556402 -0.29994975864674478 0.018183039179963913 0.79374718557523116 -0.37991288574234844 -0.42518060448962358 -0.095752575407505369;-0.30804062613535099 -0.3446300984219286 -0.11796215076074966 -0.79284770291010487 3.7795381494499805 -0.40744222841517391 1.7350851476918911 0.0059156895363064593 2.6931002466524663 0.65744765522192183 -1.0672083537797339 0.73969430605961795 -0.9868457086546869 -0.066476957734988906];

% Layer 3
b3 = -0.61815628813566792;
LW3_2 = [0.11005226720457682 0.19789645679417117 0.58648369837024428 0.2123353695128207 0.25619325734793597 0.40238763826469398 -0.11326306679659763 -0.31977457175501861 -0.34217846101172394 -0.47327575465970567 -0.15118707910972939 0.027933183558186789 -0.78741174204331099 0.60889134424380109];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
