function [Y,Xf,Af] = O3miravalle15(X,~,~)
%O3MIRAVALLE15 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:43.
% 
% [Y] = O3miravalle15(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.304971027752364;2.48447204968944;0.056980056980057;0.0063552589768033;15.3846153846154];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-4.3044971579411726;0.97544839855227117;-1.0471298686277686;-0.074474626304157965;-1.1606713075707222;-1.3513733733986772;-3.7656861239735488;-2.0239744148695697;2.380763884756671;-4.3095035852536219;-1.8443624469323814;-2.8270395688068422];
  IW1_1 = [3.7234612035504888 1.2801816299940416 -1.1710446832683483 2.6251621999962604 1.5559860595385144 0.71693941716336695 0.21411182394509046;-0.072607473264786559 0.55891230182185547 0.14346274398454983 0.50511810915590694 -0.11846863482615007 -0.045004117392792704 -0.075557697398903445;0.73532547992924235 0.99693469427191095 0.037828377713108909 0.65042235530344994 -1.0716764861810735 -0.48970523133576349 0.1381872822140367;0.34698708981379744 2.8095616983548566 -0.12982156365785258 0.39293642290566072 -0.29767702977801758 -0.28804529475826252 -0.33398254710642999;0.46987981537051005 -0.74512298961456114 -0.79379721995664576 0.077822370955368564 -2.2836223557285722 -0.18147815613226584 -0.55854398824440987;2.5644680431923006 -0.047610820049530718 0.19159513576208667 0.1206216890226558 0.008380020226624648 -0.046504846619854254 -0.058849041061645735;-6.3168521803074205 -0.074680581237531782 -0.59976274291408216 0.31610678816747306 0.65759349464727268 0.044338365044642433 -0.16978112471564949;-0.41030786057366675 -2.3521017015661361 -0.41881825808059708 0.5767443299768541 0.55985253884192554 0.055614199206691341 0.28262818771359027;1.295155212839292 -4.0557150011595171 -0.40255689697180586 0.12982045937925291 1.9379237441301673 -0.13880823016595178 -0.56697417936496852;-1.8258689482924573 -0.20578639950917862 2.0481559093195281 -3.6177745926020859 -0.42650398587926869 -0.37995330283394368 -0.28659991843691085;0.33547845802591231 -0.60579238463402318 -0.12495391004774171 -0.86384932408843262 -1.8825347287716048 -0.19610520864221842 -1.0236689807924182;-1.1292603465411659 1.0216863859748153 -0.27653010934817701 2.3827378182885517 -0.77217550361678722 0.14809556726022144 -2.3034595611116977];
  
  % Layer 2
  b2 = [1.7575650441071884;1.7654204267641393;-3.0414140275901045;1.4858867422503022;0.41427670708385383;0.96027853591658963;0.17024829314068216;1.9279688459917945;1.4899522584136649;-0.43794152619851667;2.3748004800528606;1.4524587544216927];
  LW2_1 = [0.3243402482135106 -0.014951969113539638 0.075991973805055707 -0.97930220160112402 -0.48543960546077314 -1.6544736169625278 -0.3891691470170609 -0.46470517568393976 0.818389879960153 0.52011426451281595 0.013906562596062752 -0.43568648258424719;0.24111543823098172 0.65217812715968015 -0.82016715450972399 1.771027890543007 -1.320691366842667 0.7851169053023922 -0.50917858076277334 2.6169403933986004 1.258803575674986 -1.31976601453009 1.559413908648271 -0.15739006630662822;1.4493884533725847 1.4991191374284698 0.29274542407292442 -2.7964343266245621 0.16583365939251116 0.57417463491867349 0.1085129795200685 -0.32968656811812985 3.2474326645253417 0.43135493763349136 -0.3716132371610904 0.53771860685099282;-1.0909945490210902 1.0578548498181368 0.3104634021449989 0.18139518375347441 -0.4134389881710443 -0.91182414011607649 -0.29748906558032978 1.531085124448474 -0.88227248626227728 1.0347358783153182 0.49393806512638605 -1.3593609786086438;-0.41029279366348859 -1.5082589347295481 -0.51906989025921169 2.6752913828263982 -0.13718216551232071 -0.66404842548218335 -0.1341978294840043 -0.023166593731970355 0.93343205738939783 -0.060008619789431089 0.44326677251077695 0.19811543358547695;-0.39081657844119544 1.4817055946765294 -0.64555666186731786 0.90031141603550346 -0.88856751789307764 1.8958999614253673 1.2152491358863582 2.6126191589927705 0.24971941936289918 0.99296505522787271 2.3852492881564613 0.86835597328019842;-2.3157847333641564 -1.0277489329399394 0.49843216933471113 1.0354823528619177 -0.12000553677678673 0.14855648288160725 0.19602360531343735 0.11988952585976807 -3.2102717724956569 -0.24611310268677028 0.037892875763288605 -2.0021090623203102;0.78734819021054669 0.48188204574609511 -0.22111606968975159 -3.2211873594262559 -1.1479521985494829 -0.378141888458009 -0.40732075777530047 -0.74613830914668233 0.014786853176996906 -1.0681219231622849 1.0541862489095142 -0.27735677219353505;1.2034739191434032 -0.59350702473800809 -0.36155360194596103 -0.2876259992819501 -0.21394016620604495 -0.54166466442997996 -0.91467498980570316 -0.49187703123958326 -0.46991929701450408 -0.50010393206519899 -0.050125222677317338 -0.30869396739254218;-1.0664796297549384 -0.54880760211179391 0.33420866104800079 1.0229900789224995 -0.16386425653766123 0.30282385343814444 -0.10027439041557615 -1.930492061458069 -3.6932940873031561 -1.979958254824614 0.053076934935182327 0.22854133276517932;0.56580319002673496 -2.5333601926158127 -0.055172797749840352 -0.17212499241220491 -0.055142761079859555 0.23418335785911851 0.44064231390222869 -1.2322432552371307 1.9265787069139868 1.4104708368541279 0.42205919421634669 1.9746525289601708;-0.13816903230566674 2.9145483575535782 1.3566628302793928 -0.36687609185268827 0.039573124379657945 -0.39412478597953254 -0.69798538158878864 2.16370585064083 -1.2107729971300902 -1.3660831599476071 -0.22107698535856157 -1.2221964844499136];
  
  % Layer 3
  b3 = 0.91258561826973472;
  LW3_2 = [-0.8210640015562557 -1.1864259619837996 2.7528911914281369 -2.1445311888692768 2.9745949381842878 -1.2564711327247371 1.5563514711939206 1.6121217442515148 -3.9239197266657149 -1.5441810660391135 -0.69248267152098097 2.5600479476828792];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 15.3846153846154;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
