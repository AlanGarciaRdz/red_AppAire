function [Y,Xf,Af] = COVallarta24(X,~,~)
%COVALLARTA24 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:24.
% 
% [Y] = COVallarta24(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206;0.201288244766506;0.281968137600451;0.290275761973875;0.304971027752364;0.100381449508131;0.172786177105832;0.171659085057077];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.2827030782563669;1.5637570409268231;0.45617106512401417;1.1848161853551173;-0.72543558767620542;0.11391179555662242;0.65328841967513407;-0.0040889860536831857;0.28603119076955991;-0.093391075511745081;-1.8687556898547388;1.0291800953567947;-3.7231287697425866;1.0277440769609192];
IW1_1 = [0.62951719187362742 0.29696026685936133 0.90139463158285271 -0.83514984094475131 -1.4141106900088569 1.3252704372251092 -0.023151351144730985 -0.13860533074768056 -0.25194885410272111 0.39895701874484396 -0.057737859583264453 0.21245113049985193 -0.10225700915514439 -0.52315438379859713 0.29804490994353022;0.11171456420146522 0.64685790048808345 0.34232710903983998 -0.42009728041524314 0.6640243777500574 0.10198071113332913 0.12493698395731015 -0.36362862381967903 -0.38496134573940344 -0.52316290573791924 -0.43597508510592559 0.36173547279309015 0.91630800481188013 -0.21765170555888746 0.16983830497369626;-0.14492664347645251 -3.2257998732640094 0.23079033358338841 -0.44102720980703319 0.78300822184798147 -0.33078095014479658 -0.078694404358921111 0.32840948949777327 0.33552115615211936 -0.16056214281106621 0.270989293493271 0.08634085755863341 -0.8257524808656016 0.0705382289844039 0.61359396983606573;-1.2298150671503134 0.35584895487704488 -1.0970694938042205 -0.60688153952760882 0.27742354689671495 1.8014579312591885 0.012447939516803055 1.0045986608476802 0.12618722672941055 0.33350964643574765 -0.5504537021448116 0.049442171159348083 0.15328877829901538 1.3293534530014599 -0.099156491922222839;-0.11335356069893587 0.71573846428481835 -1.7508491496913745 -0.093892720331371082 0.61101465071432837 1.4852393470122416 -0.074871546208395631 0.07415838171460376 -0.037961575034362878 0.16313317962112006 0.36737451373116448 0.16419556353251022 -0.17084795625949137 0.85865898787045081 -0.24981704904054142;-0.67062588867636963 -0.10769254405538972 0.87438636429051342 1.0731504585695739 -0.66386333950079846 -0.26485393284530812 -3.0148826946031133 0.7396337869230788 -1.108063227003532 0.25136639417854428 0.68696637725580378 -0.32035856020727449 1.3133196617298613 -0.013064583386274586 -0.45744910669615663;1.6128487678766039 0.45208382438302791 -1.4743119013121475 0.69757722354522222 1.1719721192437322 -0.83334806821364926 0.42502466532445565 0.72767047780198046 0.14722499749654713 -1.4659694078668311 -0.3078947740378109 0.58266470972239348 1.8067965745169978 1.1670392140058876 -0.085040857955783339;-0.2422794390173576 -0.36065691815914408 1.4610547800723452 -0.30776498982013784 2.6758952690423925 -2.4192020285194218 0.37883679500751516 -1.1236272964265628 -0.5397993045853744 -0.36146986343316639 -0.48858509381631693 -0.15020795368487649 -1.0418084523553914 -0.99804585496227782 0.44232685739886446;0.24010669046254107 -2.0168697949437777 -1.0883867806056831 -0.94736336683359346 -1.3491778320233068 -0.21516008817107768 -0.43993484677633982 -0.32173590267492458 0.15189723672608504 0.7168574270146546 0.4433746370050422 -0.91028599241683128 -0.40563292583238808 -0.51753863883334283 0.079298178279204282;0.099532506921276798 1.5027480690035462 0.11887895935732753 0.55720001411010189 -0.35433761310469303 0.21218942354224565 0.31367582720870429 0.28275228570811939 -0.11943472611232728 -0.40542227037386569 -0.90054006813211129 0.66914479643536151 1.4357125108844031 -0.55067005070323394 1.2934258232776241;-0.19088305820287155 -3.4779437271479856 -0.076859903887652875 0.17804121810741319 1.3347295893240632 -1.2134073479751106 0.03628241430229965 -0.33328967581651442 -0.12803112340237022 -0.42659665626882703 0.29911090712923433 0.007337279807644639 -0.68073582749026107 -0.35001815493947896 0.25939657980821001;1.8802777500482311 -0.88809350750466698 1.7415657127436552 -0.73125962711941739 0.14686880727170126 0.45683153059357451 -0.17094531327248239 -0.42693586665153549 0.36090564117984136 0.75206927866716566 0.74692149528167706 0.21918673645893313 -1.366251641311909 0.95182937085492691 -0.79772906862131587;-4.7634143710439902 0.15083852823350269 -0.015199440462766028 0.27040815636496829 -1.8078470372605833 0.81144284564574121 -0.01928891438361896 1.3146164492872541 0.34669558309078308 -0.22518103930590308 -0.42409304320293806 0.56168018193810676 -1.2900429701329166 1.732035508055553 -0.7175642487240298;2.2534171914056156 0.14288457742866417 0.12789306007005602 0.54444726463932736 -0.34778049545822526 -0.97872006232986619 -0.099914519231745325 -0.74489093435383225 0.68470918636772005 -0.030981880024567053 0.64952821780369674 -0.46308570875060229 0.24035003927409473 -0.3102686322031698 -0.075350074427465746];

% Layer 2
b2 = [1.4187254007180143;2.0604303078370623;1.2260817759667464;0.59901331668845259;0.39400443733924467;-0.52132556761790783;0.63932320266455056;-0.12400809996368949;-0.043747841743794355;1.3242873368382835;0.78044693147056521;1.5678390339615307;1.6263972528832034;2.3497505032761161];
LW2_1 = [0.52925839941115693 0.18053854128330235 -1.8744179755840791 1.3134750117544993 -1.8147297908661379 -0.0017091425164029207 -0.2430273922048711 -0.67112036258351238 -0.4451919860647976 -0.87313896168613403 1.8639518096952361 0.4876425518300157 -0.12623177004244771 0.53373535082537926;-0.20261361941040773 0.25246348567881727 1.9965153528991264 -0.71247855302011609 -0.13338550871426283 1.2904391817784673 -0.11573673111617606 0.088909954410932995 0.85523171804961773 0.06913313416453766 0.22799116890031079 -0.018464671601528149 0.18878126849010241 -0.18868930603410447;-1.9682497180164025 0.3612336429998862 1.1746749933454872 -0.32874677852732531 -0.43321495929783627 -0.15264994516438424 -0.90300204366430481 -0.65391310143080361 0.64523681874474259 -0.17887699433980567 0.58659282833248039 0.40960946739822551 -1.079541909376788 -0.37306494384303235;1.7556093075139056 -0.12142311158161062 0.43549031434188223 2.156645261804977 -1.023844142245971 -0.36202094379628608 0.30546371441713527 0.52808719828612383 0.66702441625020259 -0.15747652184887376 -0.30630533150899558 -0.32577822021804692 0.32340721299069997 1.3054681893866873;-1.1471502562432043 0.80237757818398081 -0.98710011082720561 -0.1186665742587274 0.40859358902903192 -0.66034867093333927 -0.36091982554512791 -0.63687059447525862 -0.8201459853924763 -0.13954863773634557 1.1437899042507762 0.68899559335348126 -1.3170016589706248 -0.55179912241117834;0.34819313524778212 0.0072066393077129254 -0.36850091796005896 0.68237908901383681 -1.0691281862386732 -0.36581745521555709 0.42932443477153093 0.8198880161041453 -0.74393830349025181 0.97260755511702535 0.8784674450992177 1.6428529097626769 0.42936302172509155 -1.1886438727368001;-0.33806632467023162 -0.31013030210934767 -0.0021967892992756088 -0.13489817361420775 0.68101126508877285 -0.23953009290717209 -0.40937982791705124 0.11810287945335907 0.96573854697867445 1.4405404370099923 -0.42412090013704462 -0.30620339619768611 -0.85508432805845658 -0.1808920845557179;-0.69157442274852465 -0.27254268848851687 0.068124763805955085 -1.1711181982539527 0.31142343223928859 -0.23550396336123119 -0.43794766295585713 -0.21117146539315096 -0.38129701838978663 -1.0686619558985615 -0.25583735485564285 -0.99317260757869064 0.68941566274606958 -0.10152503505254717;0.83899946054820185 0.08981672736338242 0.32518273016480465 0.74999887252230812 -0.31187549146548099 -0.52460980453739214 0.013278324347482674 0.15545395456953423 1.3107939721243438 0.77913115729479943 -0.50528698729565935 -0.54535745941906433 -0.2378233320044025 0.35029497056234954;0.86330868418700735 -0.39992358823789953 -0.31115569427792278 -0.77114363589593871 -0.24284544868283175 -0.56227250045882926 0.48171894143657951 -0.097390029336749881 0.49711830856507833 -0.7335546963820575 -0.61517924046436512 0.44971363563933964 1.0192459192788401 0.015393106719334308;1.3031799011097107 0.18990185874092005 1.3562976649331786 0.79733882120137733 -0.33773811249809649 1.197207548843586 -0.59857458001472552 0.79936695049759399 -0.21532446402656916 1.1800834695127611 -0.44331388538316263 -0.057113583637574045 -0.28342022993363353 -1.4351459282155008;-0.3454620385126535 0.27505019334832193 0.028160007053893737 -0.77060716841015775 0.28400193293665871 0.32478382296992553 -0.82203357077366757 0.49563583365609837 0.56215343361930192 -0.77015750673421535 -0.14504832002148968 0.25645874861922763 -0.038560959010076647 -0.28356770738207476;-0.47109984023710216 -0.74233781009754973 -0.21469099250180296 -0.60887436588334976 0.74800655144388895 -0.56106364873187331 -0.79058147310907745 0.026210589147285038 -0.43862401892901975 0.47121878550169238 -1.2384254249093465 0.79822589948003331 -0.25332355715235 0.22149455948921756;-0.29413480250187735 -0.15892722606306439 1.3481046588841692 0.18530279421953486 -0.81163086012257435 -1.7291960612786261 1.5778093323579996 -0.6267347671882586 0.54574684809495411 -0.95036865248781033 1.6841298061975869 -0.26958377832033081 -0.41256801514313607 -0.94403748786481478];

% Layer 3
b3 = -0.64890367985215847;
LW3_2 = [-1.4582228750525155 0.12967548191392256 1.0976054353585625 0.58833725006879134 -0.42519606860527642 0.37110237494011522 1.1886816291407456 -0.2667680643502795 -0.95937992534257022 0.46395450002876082 -0.23630225090770027 0.20157824214354636 -0.51731912650426704 0.12168344640830134];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
