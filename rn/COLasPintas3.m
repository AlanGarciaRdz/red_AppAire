function [Y,Xf,Af] = COLasPintas3(X,~,~)
%COLASPINTAS3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:58.
% 
% [Y] = COLasPintas3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.241545893719807;14.7058823529412;0.0179856115107914;0.0558659217877095;0.00576368876080692;0.212765957446809];
x1_step1_ymin = -1;

% Layer 1
b1 = [-6.3285635772237354;-2.4083298034900631;-2.8124132640124402;1.1025974490312354;2.1736236947551024;-0.27308900900267197;-1.9012495816593231;-0.22181981757392671;0.72609679913182434;-2.1056332636634303;1.675386494583962;-7.7419801113666722;1.026969266362445;-1.3139842540949656];
IW1_1 = [6.0154399095072124 0.06422020358243398 1.0509361231892094 -0.17246840763241361 -1.2418477268020254 -2.5916790593311108 -0.51501862438057711 -0.0073111543471764337;0.019613395909813085 -3.1414827522260667 -0.7236621540428626 -0.021728403648013751 0.43778502106472894 0.57896734480070833 0.21991409069573487 -0.068566666405951437;1.6943215420307745 0.59948664493902393 -0.5913360117336246 -0.11353300288684642 0.51562987929055182 0.89195888135274892 0.095100383866916813 -0.16455431329656905;-2.0967942426731332 1.8106659744719693 -0.12586181539055905 -0.27293079976514578 1.0516215306175745 1.3208317312199114 -0.79130255495338087 -0.03480242948174643;-0.034114256808892657 -0.96105713026925677 1.9943137219553255 1.7987253901038922 0.33931276164318241 0.69812274144623476 -0.55758545113241909 -1.5099694204238576;-0.24032661877907588 -2.3709311858842232 1.1956528596882843 0.36919324115900692 -0.61349504163822577 0.15963984863866382 -0.41281347186198325 0.52183408608255721;0.63849288226279732 -0.30279486997689459 -1.1611798840082252 0.12778936420691892 1.1909091824931886 -0.29873557792528682 -0.24679819359907224 -0.29903614181848714;-0.46932037611269239 1.3906308762969322 1.6329878103959903 -0.58084718183719286 0.61130747922053064 0.34472184373785225 0.67830020852394524 -0.26066254551550422;1.3536819487815328 -0.50384523737129661 0.90525921647382745 0.1903463650183975 -0.17876963067505156 0.52958057896789745 0.4422398884049451 0.48604598397702942;0.32429772415391672 5.2170317811264137 -0.71936941805513621 -0.34646527460361842 0.071478195568783029 0.50249598625684355 -0.030990824841521995 0.35693554552379458;1.9068974721457894 -0.36494462220512502 -0.44631648700367627 -0.21909260890565196 1.4793789675130555 0.75449019312655086 0.59743090855687753 -0.038602407613910414;-10.413764437215072 -1.2945583229846311 -0.088696863641447576 0.047784341621879868 0.12237296491556003 0.79935141569346169 -0.19775805160083876 0.0011296983344470067;0.46779827566706922 -0.034296664642292356 0.79443270442036062 -0.28738948715313023 0.39987280377491063 0.60208146316283973 -0.12279830107187364 0.073970928237291261;0.010029736469571669 -0.5206774732380206 0.33386432484578221 -0.44393162815374665 -0.3931242314960991 -0.67491075563127256 0.0055493045546425885 -0.8175798198347205];

% Layer 2
b2 = [2.0535321875485253;3.2354875470640789;-0.87397312823195028;0.02720319226991201;-2.2630437775012076;-1.3048021289857197;0.54310251233601892;2.3773427535791125;1.5193860984908107;1.3338790155215272;2.5110862406016974;0.69131054722579888;-2.5199197479246669;1.0219238908239152];
LW2_1 = [-2.4439121627861549 -2.5333049634125753 -0.28487536101093075 0.38053795359005455 -0.26190535996160447 -0.35540840463022627 0.061203632991742606 2.749789423275192 -0.76709056584275426 -3.7435857979482567 0.38559753012931786 0.10488043457236328 -0.27563883984093568 -0.027245211415620585;0.051315159931029745 -0.20583081267713424 -0.71039685147780729 0.62119548184900353 -0.1061005517986373 0.15508858808860876 -0.76098438309977423 0.10441377648915291 0.75650071714592571 -0.24637725084956033 -1.4571715538532297 1.5874303474249492 1.3191380422634431 1.3766226554500309;1.2547265731036905 -0.34753600476549446 1.4108283384987954 1.1856976498363483 0.53817276794858282 -0.49906536843267496 -0.40688014443430004 -0.29074412027606639 0.015167572626453771 0.54050706432120954 0.27033952641840164 1.2121877595654655 -0.4386134213249796 0.30878332076043347;-2.5367310820176305 -1.6783349476305074 -1.7055779588273197 -1.3979767901367843 0.03934729146611244 0.49015809053011294 0.70420862019292607 0.6294572119951739 0.038476315144879911 -0.90440082081149009 0.21876967719429949 -0.4826147176004501 -1.2501650193382583 -0.14086069691076913;1.0380450788310311 -1.23284610775262 0.14437367347786961 1.4412499060931863 1.076111980230626 -0.75085545311059454 -0.9667492810258197 -0.67864180385805639 1.2323048383439801 0.55819410685100712 0.042492558945860376 2.4167367048227786 0.065559011611434875 0.75219097448950489;0.084316901746419898 -0.48259346204185932 0.090315537401386092 0.90016858289435719 -0.39438000566401754 -0.89939132632977259 1.4231610599534219 -0.36013304687694692 1.4419718588335602 0.28293143819916289 -0.49678241908392862 -0.74917693095056581 -2.0362488223318613 1.6766624900787666;-0.86852140070085426 -2.502878308187924 0.3048495465749711 0.61883701092521259 -0.098544751643806966 -0.24428627634340427 -0.041543931494455032 -0.92670686682549575 2.3223444116370309 -1.3326023565484013 0.31635852675825926 0.51295387187192831 -1.5589193776754895 1.3486115178068896;1.5020043724749947 -0.58626150966505752 -1.3964443029013005 -0.5098647102981374 -0.073688669809456708 2.8664518751307737 -0.23487035064264666 0.47746733896250571 -0.0019358941159356366 -1.388180125737482 -0.16472117647005832 -0.6513665084463881 0.30910300274206515 -2.4235072364853889;-1.3966544530404861 -1.590426039471911 2.5317056098334976 0.67423196861211709 -0.26917776860779735 0.02156131559896475 -2.9507500991106772 0.46790404281645992 0.013184219219458421 0.17244560376014048 -0.061571341369422862 5.3072737318700698 -0.40095648316712301 -0.39563969610807098;-0.3440661825672644 1.8227363126245133 -0.16658773316786318 -0.49145729958702938 -0.4450694495330455 2.1307097568838897 0.10104153730746315 0.20226981939554453 -0.55872095288802903 0.71668757979025521 0.24330504452129359 0.25310361689036653 1.4225189908923799 1.5332945007614867;0.03274686376923612 0.70445933124702687 0.017846740959270531 1.0225819668089775 -0.79314230901211025 0.72748980849886158 0.40202136477305589 0.54414013586250087 0.26430076106728295 -0.71193793383093673 -0.30715908998212071 -1.770034474766583 0.70392000322974635 -0.79023566109713084;-1.0002956939084777 1.1369976520711274 -0.60067340385348922 -0.11847789484178911 -0.4228013321322534 1.8311507743597246 0.27898738579706489 -0.18572257591312905 0.1658287353367468 1.0324935729310909 0.91909411858938361 0.46549204979007958 0.6617756189346633 2.1069185502763474;-0.63347260190349153 0.85464163595574605 -0.91096125018621876 -0.80833325251615462 0.56948525580531018 -0.44931779987797965 1.1592374907537362 1.0356705202827903 -1.5511107706639293 0.57700732351114803 0.26607184976624954 0.30171186661404048 0.18128258117844825 -2.5403351963546061;0.22710218368038462 -0.30041280589836444 -0.55301615987503039 -0.60204985589133231 0.76422693028587685 0.8950460418228332 -0.2954085493079176 0.66747752339838229 -0.3790266740242913 -0.71003416964045918 0.34264047600887959 -0.22357503389142744 -0.54981855146170755 -2.6868737487612995];

% Layer 3
b3 = 1.4560212683113027;
LW3_2 = [-1.5926996795465198 0.7516316616358274 -3.1107035454224938 -2.1295261915815891 0.43248524453088777 1.9395421529978685 0.21541464223719684 -0.62934002035474923 -0.16503344343566326 -0.95805566598137226 -1.959441521180433 1.0261385383538213 0.31210768049137017 2.6965636287648174];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
