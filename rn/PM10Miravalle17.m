function [Y,Xf,Af] = PM10Miravalle17(X,~,~)
%PM10MIRAVALLE17 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:18.
% 
% [Y] = PM10Miravalle17(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [-0.67699931179862416;-2.9496745071153554;1.6562293597924229;2.5220130071325824;-1.0079828298363913;2.1550757240844662;0.10701695510376992;0.050351084614219027;-0.31374603112817723;0.67443077386510331;2.9405447901258519;-1.2003391907309642;-1.7257640852902827;-0.98638169154836941];
IW1_1 = [0.59043160676301054 0.047404369604459491 0.33156004055203758 -0.76419547859907433 -0.95682970198406769 0.097993739828606485;1.4105880112423888 0.81745997179653584 0.69929606771828312 -1.349936029524877 -3.8361142023768782 -2.3539561796018313;-1.5325256727953178 1.2179564282412398 -0.70765166737962126 -1.0505358889031142 -2.7237361514618006 0.2296384116362232;0.031864591230980635 2.1620391773310801 0.58069359618733329 1.3430808958318976 2.0433045315052238 -0.53154101018396538;0.23536624591378041 0.32816465443750747 -0.18283919203820351 1.4188381761334616 -1.5047866629237665 0.23498803337468271;0.10915299141254634 -1.9620876948898889 1.2504489718687661 -0.54571523994781235 -0.89265228190226897 -0.55007609633162546;1.4241269634224882 -0.61766853509077435 0.54160247485847846 -1.0613503271452649 -0.40946575032203608 0.2167213202017228;0.4867131623278334 0.65399076818588342 0.72310206721141801 -0.12288600946587359 0.88118663967600397 0.64220924693271353;1.9112083198870953 -0.2807989854714269 0.62482582345510562 -0.20569827576856375 0.18224966962963829 0.97760021781800033;-0.42285484401492335 2.6470905273298553 1.81305674290607 -0.98148615634007896 -0.85154946844575141 -0.37534802309174747;1.5443999360966978 0.18121294644020147 -0.7898976837356303 -0.02914057434710669 -1.8531248542115086 3.6606488575504437;-0.38880395114272548 -1.091018977267876 0.33605364604541121 0.59026613155960928 0.77582982612819629 -0.47736746564718585;-1.4943053344281088 0.36725276968193704 0.34698229876951509 0.0040098681573023679 0.55039028378211396 0.34342486356621243;0.11649724288734378 -1.7857563700493282 -0.77015940827891061 1.0189450764573444 -0.67700593532752995 -0.12138665850418638];

% Layer 2
b2 = [-4.8269392416211989;-2.5347771745073922;-0.01978315260480927;8.4072999972452749;-11.053793287809803;-13.394865379208285;4.0931103365704464;-1.9988939933283547;1.9946270198827487;6.5521889134839455;-0.039078132640339207;5.9174354381201546;2.9785652563982259;-2.6161765845058143];
LW2_1 = [4.7244058648494276 3.3716684547236864 -8.9579097484910335 5.3874361411911753 -13.515508721548324 -0.80182720525870976 -7.1669677396696203 0.70826533610283848 0.68050202488854905 2.0647256592953704 10.78549419724469 -8.1719375826063967 13.378512146561532 3.2658959851133114;5.1784679386583887 -2.1489411655900135 2.1797623475170878 2.6574650401080437 1.0300111927827846 2.7746369765059486 0.57461330580056991 -0.38053602731998321 0.56917954874179566 0.66003389207394292 2.088370519848795 -1.3035416889804761 2.2111288831222637 -0.81569765343551515;4.1737434781495102 0.28167639079776713 -0.3999140397131295 3.2482943718425554 -2.5041819839922166 -0.26460046190304704 -1.304054586825095 -3.1903999245384975 2.3954574544053941 2.5175955251474993 1.5701965429604403 -1.2111457388504445 4.9423840512016017 3.845990428089292;12.134291526023608 -9.559424515778753 2.4599639178863026 -1.3243626015665713 -0.37986794118033229 0.91652729654030074 0.16272451519712441 -4.071475278576826 3.6466123160668094 -0.92566726609469252 0.69086729434049488 2.5544360353785249 8.2913561063800341 -2.5592937147376467;-2.0887235024191502 -3.2733782839482286 0.91900682303844938 1.2194053712591859 -4.6225666476630538 -2.2292520241631193 1.2002175545374321 -1.7380635192433074 0.97127197598833803 0.73805474787650027 -0.36644165011520513 -3.1575337883399492 -1.030000811257215 1.973665379992058;-10.686332783148272 1.8675345273665207 6.6396740295872307 5.3400989407460404 -3.1883405023923896 -2.9602674326327647 6.6025252668842782 -5.547344339946612 4.0855752331886475 -0.23705827569836377 1.9950938188188805 1.7864987766205016 1.3798217090703064 -2.4133013070418636;3.660181195062667 3.5061434332466921 1.4955394240402999 2.3036704416664535 -2.9734446608011469 0.27041025156530724 -5.342714489501426 -4.1812215466637728 4.0835411837809241 -0.29670574878546696 0.78283309523610478 4.1078932214459414 -0.43905312386410839 -1.8639244195603824;2.7753807837224316 -0.97776319125153499 -2.7728985955277934 2.8454236484447777 -0.73507939912906028 -3.6240920890937987 -1.0205692313746815 -2.4373243972173335 -1.0663880099565963 -0.41525740959093932 -3.6081397831120321 -3.3852181146785534 -3.5032048698125884 2.6212535460287429;7.5389156151403904 -0.40157611535481169 1.2272586482289725 1.6259863065006825 0.54368977880011604 2.6086359976332587 -3.5715008611764323 0.073754839475591707 2.5849488644804119 -0.65274966119230204 2.2749925918939096 2.6004923239694717 1.0377768774876972 -3.0742969666481987;-1.2874757692980174 2.6860727533300119 0.3859516959657705 0.46271783356903096 2.5654641953772765 1.6632711589197158 -0.58037939145188866 1.2790164018309182 0.075546039059710426 -0.76943064677667772 -1.5459552892763819 3.489916600005496 -0.50509073451805897 -2.2925529800482125;-6.5123000569628857 -3.6907725860329141 -0.8399115437820639 -4.8523603951693728 1.2885620238143298 1.6589661649388232 1.810332147488058 0.62478332121888835 1.0420877921208049 -0.4443223042850592 -1.4065599107706441 3.3794451498483031 -7.0495359208223682 4.8918475782080302;6.7632908557929214 -0.43480719753018865 -6.9102484113102856 0.56537932434759153 4.2193539171368171 -3.706325057154821 -3.7285974193463769 -4.8967884921143057 1.7017473167970083 -0.32528567692402383 0.64450500709490155 -4.3275623997513835 -3.9174843380195474 -2.1653979275484185;6.9212224850064104 7.6496365976199989 16.347805541642416 -0.95935399945694655 -1.9449764353164263 1.1346136091674444 -6.2857733302471752 1.9781961708017826 -4.4396621831672478 11.664234726723333 0.32016591481728401 -4.9199048547099995 -20.451082451526187 -9.1180455933656024;-12.89313538626592 4.3288105488899902 -0.10111639654687443 -3.6430443565809432 -2.6161502899522322 -0.56180867004821289 0.29933063875109395 4.0847492434928867 1.0715199555199209 1.985017063173558 1.9324424511591225 5.2613567963172834 -5.0552314331016541 0.78507220419522417];

% Layer 3
b3 = -0.75938125149899072;
LW3_2 = [-0.038179207666764858 0.096435429509483472 0.12814063769258241 -0.095102158040445153 0.069247106662143815 0.044857539371730197 -0.062128137530742492 -0.085471644161264751 -0.088775105240462476 0.12291804865506638 0.03916360222130965 -0.043107860175913559 -0.012843415043408232 0.035958084243707812];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
