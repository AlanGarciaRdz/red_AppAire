function [Y,Xf,Af] = O3laspintas21(X,~,~)
%O3LASPINTAS21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:48.
% 
% [Y] = O3laspintas21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.241545893719807;4.5045045045045;0.00280033604032484;95.2380952380952;0.212765957446809;14.7058823529412];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.455566107836312;2.2209168680357561;2.8275692855780026;1.7120029731031816;-1.9008287693271073;-1.5338109779301377;-3.0178093900804264;0.58012092239252988;1.4569162790468713;2.999157948508445;-0.60816957462277244;-2.022450775598053;4.2723430238046189];
  IW1_1 = [-0.032062002529876371 0.61522191694872375 0.85148432186543177 0.022482645933400006 -1.1392990743175475 0.56266865867358529 -0.073132981884821036 -0.050184844286631718;0.11575057188088572 0.14196713062817748 -0.30847576569494711 2.6832040299270328 0.19237439960022185 -0.28030371715915076 0.23430478088684201 -1.1758412165867154;-2.6835807577248532 0.68949477750102184 0.12197628955250195 2.7480869834026409 -0.18566950808606289 -3.3733909540788805 -1.4718757690796656 2.645612152247629;-1.113427505977086 1.5617829775389835 -0.34605845792848522 1.4525893134770562 -1.0652332294622004 0.22619157322662553 0.15396627910922611 0.26005095572233083;1.9072951258256803 0.38516066099439727 0.053013419239543419 0.045005519211917304 -0.45663292929049143 -0.30635901324294612 -0.078340914703480216 -0.33638084780804528;-0.64358071139653528 -3.2704614739787026 -0.39472932532434635 0.98726264106952777 0.48900609783983728 -0.19698734925106007 0.13752411499364414 0.65448524075248471;-0.25082109882621606 -0.30713219856459634 -1.4059717142940902 0.13443687793104306 -0.58091897914847479 -0.27301439250093534 0.22862553698473137 -1.306018739388749;-0.20365547501426531 2.1177673475872156 -0.057067737845452347 0.074202150779504608 -1.3640017424318729 0.3088404580361665 0.3640225730216633 -0.079328351178374557;-0.28115006433973827 0.46960228964568401 0.74967311799397474 0.43381272315408181 0.34664567152365933 0.28751396398267004 -0.072463677314307737 0.14564629170792442;-2.0099132769316386 2.4697153507998464 -1.5299877039623253 4.3446967171747959 0.28874142656240143 -0.88609299436894462 -1.4297571541974778 -1.2216933633136022;-2.173591373263422 -0.16226386220941511 -0.030671319148060972 -0.11164979418001272 0.0068110822017856537 -0.13069817110533191 -0.40000188703788547 -0.72213377946721646;-0.28305839357467355 0.39354832000692808 -1.7447937076433677 -0.081639892467689434 0.7086874732991133 0.49395842740325929 -0.15598243166349007 1.1579074990251617;3.8760407233730558 -0.021340584707131398 -0.46063008853786136 -0.17310773266486229 -0.34557246050327872 -0.065709842156666309 -0.094584022342199425 -0.17748366952575742];
  
  % Layer 2
  b2 = [-2.4337424889657697;-0.71034168085718286;1.3598467487634813;3.3698233664652419;-0.26846070719737886;0.070895625477155361;0.30152334249736046;-1.4871095270561416;-0.58907175298442072;0.78021195837340229;0.94750440229132105;2.1731835428614796;-2.2635348975997456];
  LW2_1 = [1.4716912654716592 0.73532889106463817 0.082194927226381012 -1.4056738372174764 -1.5384683226871076 -0.8091160281773413 -0.86200182071323062 0.50443493667243966 -1.5422902924243349 -0.19710072284976715 -1.5736570363243811 0.1282769592379398 -0.16713450194629054;0.018745675190656921 0.46503598828638204 1.3252987487752024 -0.88288187135175056 1.6108755051012922 0.45553895900207475 0.64391210646060859 0.092086703023849109 1.8266011551807917 -0.62474009319179802 -2.0850586380499254 0.90098173332255482 0.51334791628220444;-1.2230033857087184 -0.016249980747947923 -0.84793908249484795 1.4050205827097022 -1.8350703871652962 0.65152641846137271 0.89992760469053779 0.13910854895790128 0.58677706304227795 0.11883418614920779 -0.46720719297303553 0.73449156859853593 0.28400558187786729;0.68690618086269661 -1.010059507091088 -0.18622193852745977 -1.4850338807163377 1.9087033151711696 1.0392022556235228 1.5852235573409694 0.66971180620920834 2.3144564525508602 1.258148456501224 -2.0256589021236566 -2.8993328925268442 1.1237980424239564;-0.93966253889979723 -0.97820014141546996 0.29094661106117298 -0.20109089757196552 3.2321712411641497 0.24648125564732984 -0.01925927469289164 -0.95728596421654011 1.424163687712628 -0.54508837575028868 -0.67434183110142898 -0.016834101974795714 -1.5971733611408798;0.15080735371035375 -0.23681511049098891 0.18236805323453192 0.37641907109562672 -0.43954951505080841 1.8114474428678504 0.29851188507973941 -0.30643639767107839 0.082957489801509146 -0.47777074835891054 1.032251264401836 0.8934726723360763 1.5554310532313329;-0.39786554623133424 0.40585938379473008 -0.49399626122292584 0.85459484833674182 1.631182863391097 -1.8172743727354672 -1.0802793651382396 -0.5595893256543315 -1.2967194553271661 0.46163778733719452 -0.5303007874747625 0.73665256975114179 -0.53872480260683064;0.5870960076633287 1.2377687243950886 -0.16898039093912637 0.21261750189278977 -0.60524582493709256 0.27575876954501277 -1.7091076068296047 0.42514278622445173 -0.31038602012646677 -0.70899837467523563 -1.5258456547315173 0.90019863664513045 -0.75751020509815559;1.2808012547998551 1.1876228793205235 0.11998211472415843 -0.58754006044171359 -0.79229179408344586 0.16644835349464204 -1.1115161369908466 0.49239089431815997 -0.088814563128358948 -0.91786808159336397 -1.7562104004060424 0.2403093779039854 -1.7453323900410433;-0.67748033780344841 -0.39192007501438597 -0.071573682615466136 0.37991174607780692 1.2120214776373779 2.122715246431135 -0.042932455372755772 -0.09423904457668883 0.19879303995413469 0.43167905847339266 0.32180806456006933 -0.48178192314083729 0.57355917913760324;0.15600256168125687 0.70738561088691709 -0.71194993260220696 0.80485588512244632 -3.2907197302431999 0.29045883467312689 0.43217105888436047 0.83789329227116005 -1.0043251466319387 0.6157902699479163 0.036633798111709782 -1.1366163426585973 -0.46777254560390918;0.18346128281407897 -2.9047585793395316 -0.286874322002108 -0.86907010224840575 -0.28419675850709547 1.6072883520364338 1.057421485240412 2.197959476191151 -0.19752228093621232 1.1267630991157542 3.2854343660815566 -0.24642921795528425 1.6458405401718863;-0.95455500781727232 -0.57951524057146242 0.49472537111126286 1.5521378627428064 1.9312556708780424 -0.060378828487388785 0.54537639279083361 1.231683212207469 2.1683896309137838 -0.8110721451295877 0.3140322964550793 -0.74591095273405328 -1.3070943301447318];
  
  % Layer 3
  b3 = 0.53522817096485331;
  LW3_2 = [1.4379337626537514 0.70691681818099295 1.3024764790880878 -2.3467642803998889 -2.2095692860279024 -1.195226875256955 -0.72168228848942195 1.5221504385469391 -2.0464692800817725 0.77823908333381264 -2.308823809696936 0.33410781943710016 -0.61642125879064436];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 14.7058823529412;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
