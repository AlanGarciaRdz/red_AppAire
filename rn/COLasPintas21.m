function [Y,Xf,Af] = COLasPintas21(X,~,~)
%COLASPINTAS21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:03.
% 
% [Y] = COLasPintas21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.241545893719807;14.7058823529412;0.0179856115107914;0.0558659217877095;0.00576368876080692;0.212765957446809];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.7046481387171448;0.73028795676743319;-0.41614102354167148;4.1663327395350063;-0.6990909064364389;0.1138301138139531;0.16913329399329488;-0.46937447464646342;0.77344010045963363;0.5497856291982044;1.2668000468960494;1.9255028249308523;-2.4230930364289787];
IW1_1 = [-1.2746352070370073 -0.38762918001951718 0.30064214983182996 -0.31618330187010252 -1.7878987050391575 0.98662207362381527 -0.20670484797374028 0.33612822486611693;-0.37507041760380966 1.363887771133945 -0.38764803932001723 -0.86972902058654189 -0.23716005329887968 0.011366437288781939 0.078481404587987261 0.16375895955073569;-1.3120973485254002 0.67718932942406274 -0.026983820272970409 -0.38622151648245051 -0.41034971390056885 -0.57378173128427901 1.3074237188033651 -1.5029347831423754;-3.0837635780795205 -0.079733915955411488 0.27001500099042364 1.9928371274900436 2.0634733727198635 1.4096669416565646 -0.16205709860871048 -0.42741564811160576;-0.0072564934745144201 -3.139723865257364 0.12723532507508509 -0.35704802084633119 0.048679560825856387 -0.51105465867157707 -0.057494157602553192 -0.65102554284032788;1.6260449019095309 0.18205851174818297 0.5480444536385316 0.39152864069505039 -1.3894887398505698 -0.25359575556022496 -0.26199004840003071 0.65068886188795805;0.50422411854269034 -0.62651239025385819 -0.88819949801086806 -0.71690492721007881 1.4052242571149145 -0.67742055542832824 -0.01459903402094548 -0.090515819617079829;0.012725835305544123 -4.6879369874833436 0.33328962562298159 0.14539649360418924 0.014869437447644693 0.12676414972817998 -0.054506535372451481 -0.27096473731225684;0.20727483795925503 1.3561895777563675 0.44257259592039933 0.87628783302491176 0.30932726787451048 0.46735770445517555 -0.054026775196270041 -0.048498119998866079;0.012343049798832557 -0.93814912266526329 0.19741004618668118 0.18610221909002853 -0.10571495462848218 0.12272257665583997 0.090113662795028054 -0.1275500371574419;3.7678500886212194 -0.096705181781432156 -0.41686803302313524 -0.91237246396926441 -0.90575813797340865 -0.0084363912974235941 -0.11642828879336242 0.53965475585502876;0.83152069518492766 -0.69032662434331404 0.28632765721267472 0.80972144013532621 -1.5245546241649925 -2.2378850491296758 0.053422875221776085 -0.43470734933615812;-0.72158409545323543 0.49491312716447683 0.22366182806738355 -0.52941490003545755 -0.33713062299200242 2.0220596044013535 0.12301822726062914 0.68409208457098969];

% Layer 2
b2 = [1.6520650947360715;1.4782407467979453;-0.20047489127894422;-1.6541924824348542;-0.59993271367126244;1.5189532444316953;-1.0320153954333391;0.02413387461843694;0.49478345623118153;-0.083204666770500535;0.1424861990904672;-1.3611710985805008;2.4409468039103839];
LW2_1 = [-1.2752560617972901 0.47458458785467811 -0.36581333367044483 -0.64274383353522258 -1.7058565963349823 -0.80173869313492052 -1.067121693643087 1.4782290745630982 -0.93111099623294957 0.47420919283881252 0.29351396622263581 0.36458069509275848 0.46126111108901141;-1.2218392166165783 0.58453242276148909 1.332589556467594 0.56800328243571019 0.61891045059245742 2.7039082344260805 -0.22560061829244024 0.1707564524011693 1.5982226159038218 2.0614621149020969 0.27010482877938774 -0.58581800655138283 -0.50593754930119128;0.61848931743167135 -0.0048158127488038133 -1.506066443565047 -1.8767222317864198 -1.2709388131303745 -1.3903240251757472 0.86910196246578608 -0.99026495021511651 -1.8806212011894443 2.2262083875225538 -1.7934508998599932 0.023891602124896189 1.8107501956938863;0.96992055353638185 0.83426410407013307 -0.94045053490619568 -1.3252351771722723 0.70724558781974156 -1.4151353460941769 -0.38267819546832127 -1.3156541552621901 -1.4429474932804376 -0.13192031990145667 -0.30498674079370952 -0.74431612714768125 -0.45834840663011128;-0.93182441519344605 -0.90932404471027373 -0.99053203603748641 -1.1434413154974026 -1.5177531416462633 -0.25123196243447449 -0.85238102247926417 -0.44237417442912802 2.0624132618366859 1.4188611959507558 1.2677062558298784 1.1811370926243421 -0.12223006378778146;0.046394112432217069 0.56235644921539318 -0.10568788606429423 -0.2620989153903987 0.48736432602198909 -0.26256587469962667 -0.39143800253917588 0.71543746188538371 1.0493651360631269 0.57375530119789675 -0.63454456588610286 -0.52454852371059013 -0.5843420744724851;0.17882642051248163 -0.10235883830803334 0.17004413783771252 0.6712286385877787 0.96733067982212839 1.4374621347767402 -0.36763334366624451 -1.6810165826582517 0.69716537899675102 -0.21531122181656767 0.83483828734815724 -0.23546933330684569 -1.0454381857405524;1.263876191040546 -0.44188516905493491 0.13697168624391215 0.17643153245583462 0.62972976042746298 0.42835567077997894 1.0297677690076441 0.3089793198908441 -0.60796091003037966 1.3538710975763828 -0.19960843707811748 0.20978533257548426 -0.19184041056493542;0.1971515167300853 -1.2002948413591314 -0.47087535115276058 -0.51100713662896324 0.753855699739162 -0.18725676144511647 0.58276391438805952 -0.32640978091480821 1.2720406648889411 0.57445433083507913 -0.51471165447098344 0.097998188047070126 1.0158137017232882;0.38909195361374577 2.2278652376896693 0.098422494090562238 0.39368180949055448 -1.6171688971814882 -0.16680968252774589 0.23199347318324007 -0.30233993172965812 -0.81140903375195506 2.9011139207749497 0.58866021555843684 -0.64886788343786872 0.89693359423289321;0.56129449644140117 -0.24194657363848984 0.35144813386334151 0.30018742299773155 -0.44614717001774751 0.49244936824958241 0.90278664575333434 1.1237620651242524 -1.253266392462421 -0.97497551777424785 -0.0409680803472929 0.4139896919578816 -0.12203141544692959;-0.10052029439596741 -0.2490007402798205 -0.32182592603909904 0.24636278209239948 0.56548055697908428 0.49436001374335281 -0.70225866049675667 -1.1664505622746233 0.10474157448132393 1.397729157114731 0.70795763014998625 -0.82069400931464886 -0.2672055830992045;0.067618202986219997 0.17286764906578833 0.25399992102865365 -0.4640933999520257 0.067268426633877137 -0.65305370470665258 0.58512923145612017 1.5967824892092533 0.16572202033210512 -1.1716654973323861 -0.75369806248073146 0.64538994093503199 0.067310485200828274];

% Layer 3
b3 = 0.52179150935546248;
LW3_2 = [-2.1292353565157174 -1.0307217533288766 0.70930984568056155 -2.5500328199443354 0.121801256604707 -1.6383607651106398 -0.38453566902267133 1.101900361183509 -2.4402568481343412 -0.94454111857612388 -1.2685788222877572 1.8160336382319273 1.7117078454718966];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
