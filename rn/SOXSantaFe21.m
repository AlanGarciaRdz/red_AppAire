function [Y,Xf,Af] = SOXSantaFe21(X,~,~)
%SOXSANTAFE21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:52.
% 
% [Y] = SOXSantaFe21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;10.752688172043;0.00341273633199099;27.7777777777778;0.00632111251580278;0.294117647058824;35.0877192982456;166.666666666667;95.2380952380952;62.5;117.647058823529;24.390243902439];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.7364551715226828;-1.6026322266773423;-1.3775640411686574;-0.48000719956604232;0.48352066582513709;-0.41691450642826622;-2.2311002192775913;-0.51147726462525955;0.8581552254223922;2.1067791784477108;-1.2528122190948607;-1.6556096379742475;-2.3061198797358027;-1.6375638076044674];
IW1_1 = [-0.06016990628120001 -0.86521702270361089 0.46008681757423497 0.25749352886469346 -0.21819774412791484 -0.084529450351326002 0.37174622717556366 -0.20285307058204866 0.4829604058124819 1.0972102449531678 0.34665144751649801 0.28338644631675042 -0.51837976700599586 0.10777726500797431 0.51994399397114777;4.9943980596844781 0.29475762232635494 0.15665836908265157 -0.80605170542169491 0.29670931155830971 -0.79210634874469754 1.2935799254492475 -0.35093649544149491 0.0029855683599033372 -0.45608019414022943 1.160382317928381 2.2288943201692559 -0.37102967056159819 -0.96845824630691335 -0.92575367188550528;1.7685049145532636 -1.8470741345193524 -1.1048430896094152 -0.37983612055787541 0.60725227905836376 1.3535913102495178 0.70169964060074919 1.6344081867931688 -0.17159005577301079 1.7933366411797982 -0.44298919329602793 -0.45875989706526515 1.975040344601934 0.50698243271792665 -0.018466284308056698;2.2178384185559104 0.89937620741058055 1.3130824853704095 0.3942749023289423 1.0520078229873038 -0.28734949959249323 1.0062770201167053 0.87816684261197475 -1.2965080996862244 3.2310342003273798 -0.54939062562801722 -3.8185455261334731 0.58327200771523469 0.13138521543691312 1.5164034750833859;-0.18224189690368864 0.91249977233115265 1.5755861936688913 1.0748050897282819 1.8397770932001867 0.007981180418234049 0.53681159736886785 0.12748287196995631 -0.38956944747082611 -0.21387134462085697 -0.86485691386732566 -1.4309758661960605 -2.5948477233166174 -0.063187146814978501 1.4078527655386344;-2.4623223710746887 0.71454540779958353 0.63284663100102456 -1.0309093354346883 -0.71343653225008941 -0.33935386645999172 1.1967794990706171 -0.39939921503818115 0.64921476998597316 -0.50464108564710397 0.33853144607962088 0.88608493880378303 -0.14119966061315822 -0.024839067083581023 -2.3604112945919993;-0.23764382915561402 0.043279925174698655 -2.863586810773139 1.0536655508637633 0.80971099886588382 1.7428888138541636 2.1294228911219197 0.16914732670533814 -0.45999791036492954 -1.0497875361223303 0.34140496657113029 8.6465252294602077 -3.6449439498697291 -1.8465908039921759 -1.1400070251055061;3.3316658578042522 0.086805846846897655 0.031769429561642713 0.38809755282561281 2.0236553144440776 0.0052495633653830732 -0.33701807088508084 0.24357085066251438 -3.6192039535158709 1.4944034247972828 1.5788538470305453 2.8749298782053727 -1.6959341367907401 -0.086814754796672111 0.14496242742760465;-0.0077160793770362831 -0.45762236961756159 -0.20497946198690009 0.11775421200787058 0.80029554682561299 0.14621960265546957 -0.30974554373546925 0.13011230294702605 -0.029733970447322323 0.36124824563260055 -0.222644742197043 0.50866963620416883 1.1207168445448128 0.55190427556183652 -0.12345335191075206;-4.2063960247677237 0.43144813133062321 0.86318744677131853 -0.27953251726809719 0.25459476877667475 0.4636868099941695 0.26350760263166595 0.12151529794341548 0.28818100724125084 -0.25104801700928242 -1.3617413781706813 -2.3187591719975096 -0.9612739670273327 0.28939921103722366 2.397280948615331;0.33810271737155428 0.2522548832579809 -0.5176477475619008 -0.80639096221335516 1.183178323820038 0.19384443246383681 -0.091395719445703461 -0.10572424883063393 -0.36150625479191845 1.2085798356401822 1.5952206996029485 0.068393883230454491 1.2369847142001784 -1.4341573251056376 0.045848493706048536;-1.4016730420955794 0.18693371755832058 0.56092737512951374 -0.29926661712098235 0.76326503793954015 0.44928273721917 -1.9735602270948485 -0.012780061166971708 -0.16915453300926103 -4.9893929091433575 -0.19524366608178995 1.8142992607825525 1.9712020640947763 0.45314732046127265 1.6703980035180637;0.84171031173389921 -0.091820372548334958 -0.1505484680819909 0.24028659368685504 -0.31157279070972554 -0.27573532806569545 1.0564080900510029 -0.0054083856932277356 0.11091207469762204 -1.5151143408038292 0.090500215212973245 -0.94283771673044381 -1.0950609998433303 -0.27406040413283472 0.18697528871287122;-0.63303733920584582 0.064001630963761241 0.022848737534174775 0.01171722019834541 -0.098296087114524575 -0.39950026332734068 0.8034069137485893 -0.11570013996910812 0.004452992937602528 0.43320290776962173 0.34541158809697242 0.39049609865066048 -0.38805448672439735 -0.90944705883320853 0.3041154268470242];

% Layer 2
b2 = [1.8006570789009053;-1.3942078827617626;-1.672705149519117;0.93822673643402343;0.37426591017640842;-0.66784444801333409;0.72300712555824986;0.061266836102873125;-0.58581022992878207;-0.61282953477012636;-0.63275007408630946;-1.0027351015213481;0.72817010826513651;1.9085299670406004];
LW2_1 = [-0.32347980020046868 0.61609108986018779 -0.065258829467285881 -0.18198882576642342 0.25892227564658116 0.16199807532914912 -0.065666876075984051 0.24745415207498611 -0.56016431656651877 0.4748342948301319 -0.40534346626199291 1.2767300683229643 -1.2947447809355568 -0.54418426331958181;0.69885928503809303 0.26086077744944214 0.58418694537525884 -0.77315812650630344 0.15680647644905865 -0.43981979048307712 0.77966883600132164 -0.34740870442963917 -0.19606671240222859 -0.28314533931935876 -0.41278536472912758 0.68901468112708386 -0.19518597196762777 0.58964437144339232;1.2883923311983314 3.7237745378360265 0.35272134692026602 0.068225223014745512 0.89168551513519212 0.96115974473051313 0.90743178349647557 -1.2233552210814471 0.59526029739616326 -0.16524299210902926 0.61441961752129826 -0.96754755202289122 0.49409595861712263 0.60902299555559858;-0.69530596189950034 -0.95562154585132519 -0.72066550437711496 -0.16993514409302554 0.16953284501877214 0.03805349785052696 0.23046404128490164 -0.41675447539445321 -0.28775293327892754 -0.31680942633727188 0.21977490511528219 -0.33052135163236818 0.67372978667857475 -0.50421169253113762;-0.055629530281193967 1.5310213550239951 -2.462984284431414 0.80323531152244432 -0.66630373393552023 -1.6115560307449668 -3.2876801778537983 1.1641993664104329 -0.079643870703307348 2.964092719217613 0.64463058916079019 2.0773342639961547 0.23373686069559996 0.42511180319630987;0.90500600441633861 0.57898305008081097 0.091218938162587276 0.56577695377015247 0.63507973107971749 1.0614728467262211 0.77627356936824465 -0.060497127873232637 -0.11183858788388992 0.43015080055609789 0.27129376786658482 -0.6245991740201956 0.018438477837045789 -0.20621218934918484;-1.0046144744967505 0.35567273004962713 -0.13559520831495864 0.38716916406421797 0.12825918535541053 -0.039162992305890661 0.12530857117434341 0.15602502014742797 -0.14463434125279803 0.3317249543667915 0.14752440274856826 -0.47852347411806256 -1.0507667418912126 0.4041405154400507;-0.28428571962261329 -1.1048974849674011 1.6044963719586087 0.36240464981285048 0.6240730092460306 1.7904139427446859 3.1555884771469525 -1.3950798750857165 0.53370715902455246 -2.7736657363547619 -1.2353563342859832 -2.0982972307160854 0.037998747085640508 0.27480115260802107;-0.53647513216757003 0.34444518891070708 -2.158886837534737 -1.5106796078975993 0.23928363488172227 1.0917202797204126 -0.10805771321435077 0.89008664088173051 -1.3661381749510559 0.40183002330527107 -0.21407969495782364 -0.32076514586210919 -1.3662666721538159 0.32663707925492275;-0.66693854244489048 -0.1920753105326532 -1.508325374875761 -1.0373974687909229 -0.25140310929901694 -2.255705781732912 0.40023884161258577 1.4674134201005993 -0.90439165858620119 1.6071750753732892 -0.31497968343806565 1.1914321183176226 -1.1675341734910996 -0.44857979369316203;-0.55647739474416913 0.083295621779230999 -1.5811328725010825 -1.0724594332976476 -0.29893272282664168 -2.0766354792412911 -0.71652942122149288 1.4160421514961592 -0.72894835762300447 1.7732180166279929 -0.28060080586371816 1.317426239128149 -0.98491961081428714 0.42132768611004046;-0.47722556614051836 0.16185490264998367 0.099127244389076372 0.41111438443580317 0.61372134785247701 0.81891438967187313 0.59662805373522709 0.96997501928012297 -0.86197364416930744 -0.33120601090130269 0.048041365293654194 0.78526130637187996 0.048314538912997439 -0.86829329890293083;1.2314117244504776 0.99423057743010257 0.42473642180572541 -0.78716727351566929 1.3005504899617946 0.79080865636321762 1.3493593281810041 -1.7557181848053494 0.83088031223643632 -0.91878082199141131 1.1190514506190019 -0.91911111381224964 -0.26302240304397051 0.32017576412772142;-0.11748922181509569 -0.76070223594278774 -0.45030642492326878 0.15032168447238242 -0.49182728191548247 -1.0564045295343025 0.52528616677219575 0.42318205147096394 -1.0251442480798201 0.42477212974792072 -0.14284588512322346 0.39507866884709719 -0.82661309267391847 -0.2704885696985217];

% Layer 3
b3 = -0.91559391142797331;
LW3_2 = [-1.619651723750249 -0.27719618101199567 -1.7374796247101758 -0.30815547233817703 -3.2150057065126103 -1.0096487902495281 0.77546461703078429 -3.2564314956325959 2.4610518589869375 2.6862488654495507 -4.2333335131893222 -0.063026800436940256 1.1290138869209847 -1.622818358092128];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
