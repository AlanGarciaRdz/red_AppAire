function [Y,Xf,Af] = COLasPintas4(X,~,~)
%COLASPINTAS4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:58.
% 
% [Y] = COLasPintas4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.241545893719807;14.7058823529412;0.0179856115107914;0.0558659217877095;0.00576368876080692;0.212765957446809];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.10582990087881426;2.855937924344623;-2.7241720007157175;-3.4534171163695593;2.4975161338164105;1.7925415693626459;-0.4766935571632952;-1.0727100200320399;0.071412298684507478;-0.41149161475620416;-3.2807320525063011;1.2045469351226208;4.1652341276657836;2.6314536337048544;-2.8445343124336082];
IW1_1 = [0.17452309247090594 -0.067610751957245377 -1.0016666292541818 -2.2244722920441555 -1.8211569308382616 -2.2117312778980418 0.046230193135517919 1.1275124357037429;0.88366512570238809 1.7671803931662931 0.50923869909218333 0.22547381993665355 -1.2032803435748443 1.5294097077856605 -0.61803591581761697 0.49984270559265814;-1.6527484464431779 0.525392382839031 0.85538338449587381 -2.4175418683378234 -0.45649289530679787 1.8076496593445952 -1.1070352138701931 0.036261166814245002;4.2436599937357737 0.5502716484005844 0.71665006575645984 1.0953062014763577 -0.31176282257647386 -1.5819741226611193 -0.024441518282820238 0.0033660388607549829;-0.0064352068489654697 3.5437575303666646 0.35641589364416076 -0.54163798841716115 0.29834413808984039 0.14643525976953345 0.15989656369276053 0.40122527833431615;-0.44387920444107609 -1.4408493381559262 -0.36971446735262298 -0.94229350943971746 0.036029536152366905 -0.6650309856391452 0.39802379029748097 0.50647842925054154;0.04033031577931516 -1.7009052653850303 0.90987078476484617 -0.66182910589192079 -0.024620191693891503 1.1024680062097998 0.10367856619961024 0.063092991650944952;1.3627074037950107 1.0276672989890556 1.5921178355775494 0.12672322643606562 -0.44172692871496944 -0.21230171134882314 1.9115933118693598 1.1689006724152897;1.4338424538809273 0.90995655842807499 1.0570317928751398 0.045056087489982008 2.2021165709465294 3.4481117127267158 0.20043728828724289 0.19960396382040455;0.050229512670438271 -0.64477864401764773 -0.57451671415497185 0.21172830702747275 0.81887627999983414 2.216812752811065 0.12577716790700091 0.22506519535231681;-2.8332767694015115 -2.0815398412859287 -1.2462055548573181 0.41063949760061003 1.0270124777622829 -0.84403845301734337 0.17820500441746534 -0.63361093245023759;-1.2637213323059966 0.84580042874104555 0.44971355422566833 0.68407689079329292 1.5913519567479506 1.1313036507071963 0.19643460011591621 -0.18179067933464779;1.7029366513200943 0.60702906535111423 1.0073130737864309 -0.38222157825668202 -0.10448353793032396 0.56045551352857792 -0.31957759378326867 1.1589823908696062;4.4188837851695277 0.078090358665780221 -0.25003469834412811 -0.51234288030513631 1.2639065689813642 1.1046866933083976 0.059138836717536516 0.36749364019632957;-0.15821443804650301 3.6461313085932296 0.13835231339188073 -0.8620833106744511 -0.64428457260782601 -0.28056067865631013 -0.13422615644757005 0.24651983647085229];

% Layer 2
b2 = [-1.3564187060568837;-2.3811895620637094;-0.20251647567834374;0.73415975415832169;0.67793992263242597;-0.34145451762167911;0.90359752009631145;-2.4420749075806785;1.0946161602093754;-0.073858866472919296;-1.3946558565111671;-1.8112823307383543;-3.0859688416962778;2.7404758540305529;4.0618618487353926];
LW2_1 = [0.16176430805805309 1.0241270067234223 0.1593955204966486 1.2982856550286539 -0.61214998776693219 0.81133958453225807 -0.74193772707540362 -0.17682977625588475 4.1084778802244406 -0.99792277562477039 1.8359749706994388 2.6334578747271 -1.1236216028665009 -3.3721677054080792 -1.5127150471011448;-0.27362997696738378 -0.14684747534984369 -0.10437825458714059 0.32636704685712792 0.8578364139582878 2.1173425275718571 -0.55383294099109182 0.34390475348385563 -0.35462380761914541 0.014102300123197577 -0.022100238805377665 -0.80013139995381644 0.87995177927337709 -0.52047356761925789 0.18529022796985956;-0.18894782949104247 -0.0091179410897467891 -0.093304296682584914 0.36106812139709937 -0.0070935014812224372 0.058767722159009689 0.035146511257175175 -0.055464976237022151 0.073786320126869795 0.49697574446148668 -0.42781969705610878 0.34364645729496973 -0.24101304057805095 -0.51650377300426786 0.43700729668252203;0.87894112026693139 0.57622904808871067 0.039713883886778434 -0.99386126523901108 0.70678838221810236 1.0840740206075195 0.60973956650992722 0.18061988980486204 1.7284000583946311 0.78166416529802218 0.60970019596552205 -0.11772730715747912 0.35151707716583164 0.60401367992729804 0.2362031006895616;-1.1279130128655039 0.57786264781423236 -0.23789030513364043 0.2205855399167545 -0.0036401834067433217 1.2396640183157648 1.6582629481580649 -0.14733475936603121 0.11250026813842383 0.73887296359453747 0.8826760108472167 0.46471887035480625 0.93531163885638413 -0.18872101673437561 0.1134599392832943;-0.019120013329258764 -0.11045354994779129 -0.044423689920922889 0.59995277896166499 -0.49896903551645505 0.25016357148145701 -0.65830671253878714 -0.36746517232304604 0.20813075678730003 0.50547365208311446 -0.78818352387200352 0.28124189714363218 -0.52075448768770238 -0.36721884924898984 0.43089166772940529;-1.2299490589818092 -0.46858415288998007 -0.38509128694092254 -1.4787626832615883 1.5607762211591223 -0.24009116880947409 1.2941290893025825 0.5478784772510582 0.54994548922742992 -1.4655552796714451 -0.93262569972007103 -1.0583455047570627 2.4873525780617545 -0.93572812065213795 2.0019426230483561;-1.5528829284977483 -1.8283915242858324 -2.9285862835824026 2.8815954754356756 -1.1502185700771272 -0.21432750456048527 -2.171179501816118 -1.3057148984614086 2.8209832041125233 -1.4331610153497483 -0.82607015517494209 -3.3626694675820281 -0.82340797319008407 -2.318975937499403 0.22375859869147915;0.70572395396647258 -1.0126089461381202 0.72659977318769864 0.99490611857524791 -1.7422656099119975 -2.2214077004781405 0.77943241783155748 -1.3748652286422567 0.15815159545563431 0.47404471781312774 -0.50353687072602105 -0.2913965725656022 1.0215957148080044 -0.3565495121482723 -0.027864151432569265;-0.23309585514269235 0.1060679303532481 -0.0035384742520241505 -0.15032275214794971 0.96199704499690775 -1.1496465864475063 0.9281817440325566 0.019009125903588626 0.13827841984127009 -0.026604837651233216 -0.051387001233491436 0.53577923434425889 0.04506122501244391 -0.099456121662956365 0.21820457616358271;-1.0805008121401678 1.1176730912209545 -0.22003794438757554 1.0253432518311951 1.9461220238708501 0.4197121392768412 -1.9058680988831294 -0.20679918733690733 -0.55684111421600457 1.4596011358684615 1.1920226537546148 -0.12463284155441248 1.3725167351455465 0.41765319887942498 -0.3228693137492713;-0.11321085142544986 0.93256497923289594 0.23657879045135941 0.68437396033852671 -0.15788950303951269 -0.6712131127011669 -0.29620275800499313 -0.59208271964096304 2.3753907610313538 -0.020607649280913166 1.945566072152376 2.3072915278511141 0.15296212768786599 -0.84661040008727906 -0.79077585507980874;0.2412912015673567 -2.108377663481714 0.29414772794532529 0.26814056946552128 0.5062219074997607 -0.73709965455107218 -1.9195409064424216 -1.4270459178755841 1.6494176146450277 1.1469597889762928 -0.4737230022705719 0.070484447281916066 -1.3134585011353737 -0.46137022176199904 -0.91957037850029044;-0.034772830145950839 -0.84847233957240797 -0.026698024023430314 0.28188676130552576 0.41123803123792085 0.305429874636587 0.41146960445627145 0.2656599230815877 -2.3601204291597284 -0.34353977167108318 -1.4107135502308421 -2.0954876115910031 -0.01852600294277678 1.7690778325992633 0.99730358727922841;0.53270766743172882 0.5278344969799581 -0.37657935330705883 -1.7150025255281311 1.9555033450244346 0.51752387052703341 3.3319856436254591 -0.48215764119170229 1.6323601300568924 0.10328730666262909 1.5587148745592287 -3.0884445056058767 1.3968235177791899 0.96438705056743512 0.79119974639646184];

% Layer 3
b3 = 1.2757623671442786;
LW3_2 = [0.4159080828118778 -0.79632378326189235 2.1834248827024547 1.5085626855510541 -0.38384861689655642 -1.5688516569715578 0.21048015453800084 0.96705707560650223 -0.81779528693553172 -1.1216977687197232 -0.43976042964960077 0.63760554124819246 1.0790735303401651 0.86090310027321482 -1.7486526949642722];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
