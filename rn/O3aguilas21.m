function [Y,Xf,Af] = O3aguilas21(X,~,~)
%O3AGUILAS21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:34.
% 
% [Y] = O3aguilas21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.42005420054201;35.0877192982456;0.0561797752808989;0.00588581518540318;11.7647058823529];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.9078427274466196;-2.3219384560230312;-1.0178603921269747;-0.2680418625432216;-0.28586177775950095;0.91836254327533773;-0.8368829832320599;0.84387971641241954;-1.8965417465217913;-0.44921354027171778;-1.8310458048781857;-1.8968462386689278;2.2408324886884849;1.4388918613199118;2.1317379642463457];
  IW1_1 = [3.3606153709489375 0.011670198249371953 0.92377613127617031 -0.33190295002490555 0.11950637771102678 0.32190846927953937 0.54421251519890557;0.44320582884441051 0.3101350362835027 0.25277479751647208 -0.52014063639462249 -1.7263277236487937 2.232331307897307 1.4162461893325564;1.9728375764684607 -0.020338247446373518 0.20225392205099696 1.8052887310677652 -1.389423690334908 1.5125676636251584 -1.1214504013847293;1.5341837057121512 -1.4071415726693333 0.57150954941928334 0.1101856193654019 0.20083680764789005 -0.51706215111334453 2.2445687087732678;0.81247749074416165 2.9818022365500347 -1.0435947866461488 -1.0722400297029833 0.73311512735691731 -0.48333917636380369 -0.49741617055454218;-3.4004435003830951 0.13080316600084099 -0.089056510066685746 0.41521354157572743 0.09475484533108805 0.092217896254120413 -0.48700307237269719;0.55576588746463773 -1.7446220761075182 0.47967243400544496 0.02823607791718271 1.0604387311492394 0.71606242455162261 -2.4681480605847828;-0.5672745138609685 -1.5329992361440343 0.2415818226676571 -0.10674200454718577 0.9154441517724583 -0.10209927507855979 1.4069797258871564;0.077622043710987743 -1.1552809280421679 -1.2284277586329646 0.2126805981340297 0.58239887551304492 0.14571522834805761 -1.1212458516957593;0.86154416983195192 -1.6078507117082947 0.030450831969902916 -0.16766022217109905 0.57813483693713941 0.04705730824983137 0.21019300219447348;-0.33708310450421025 1.2654279467278053 -0.74011248152940534 0.20121130209955551 -1.1605097892176792 0.19847714628932742 -1.8542778952792272;-0.84043589897245841 -2.6311068600253713 0.50847892052873755 0.31883833711323883 0.26284220402157815 -0.27633761953736558 0.6598696980730463;1.3029942228071634 3.4077374498034021 0.48753755429899881 -0.84249991990611683 -1.1193955153130644 0.97440834781171393 -2.1728992477170235;-0.44225790251692143 -3.4079584847689035 0.6428836245237306 0.086990823195304628 0.13005598109496766 -0.075736927357717712 -0.20704332880211149;0.78568678837677841 -1.1340974236278718 -0.52561847219921864 -0.43212351057742859 -0.51833394410025069 -0.55222921052988061 -0.37450466141207195];
  
  % Layer 2
  b2 = [-3.7095700263027021;-1.0936391636021825;1.5541818075300915;-2.0790699322767092;1.2697612481187783;-0.5975136607605025;0.46215948507147386;0.34634863238145369;-0.34255453587099116;0.89274426511964233;-0.836838016643213;-1.2395473151089706;1.4069015548179762;-1.5649704393260111;-1.0950411955031178];
  LW2_1 = [0.24181125050542157 1.065858154491431 0.34468028032102282 -2.1322326077797977 2.9016520108621542 -0.76215230805718159 0.88367166232233585 0.73374646373197849 -1.9682435970612584 3.3526981659302177 -0.19597028689762952 1.8051739579304842 -1.9859744193311253 2.3145005472405757 -2.0427907464234636;0.31064845281089576 0.90515936333935665 -0.35782993702304378 -0.70382895243128185 0.77450677944939195 -1.3244538474364185 -0.21479296541756773 1.3044440834639126 0.37959377206308881 -1.2334584951439262 1.1503324805882604 0.60421959047083429 0.70323117775103461 0.66613402461507543 -0.031296495812325707;-0.32016273470220186 0.76437729122447773 -0.16261673896166665 -0.49985072410905546 -0.87962663602527535 0.876551943774871 -0.696078064947243 0.36319062456592699 0.11712467681286005 -0.17941584402832028 0.91354252200922337 -0.98733618681817648 0.72458987316665424 0.41889939749109867 -0.18554686949906166;-0.19237373983865827 -1.3489614898816416 -0.2671171718638593 0.57295491530178233 -0.0088846259430302825 -1.0123490707912508 0.37362022559318148 -0.92059862918235691 0.34085760995112996 0.012558751727973366 -1.148219590029923 -0.368893357866171 -0.34036734073938829 -0.19619664708179613 -1.604143899080269;0.46793738767063214 -1.0749747022395555 0.18305368278556422 1.0877206344627033 0.0069454269341494082 -0.34907808835362369 -0.41787252096512301 0.63324596362845775 0.72628767275555828 0.78668963981533291 0.28951229550075425 -0.016173352107180891 1.0360138404789627 1.3661091341482257 0.39013107823638593;0.11257542788761724 -0.52102739762386918 0.25437283099404379 -0.18618470591202005 1.7259243577042613 1.0640369869237227 2.0658208478080797 0.62855029930127271 -0.89678265869144413 -0.83621700118100828 -0.67901686058592281 0.40655078203792361 0.45482858919825697 1.018425789198097 0.25969132217855057;-0.14718904928915108 -0.12447533049763092 1.198541340721591 -0.63652319387031653 1.3343254470701917 -0.020017835378215769 -0.13553119342756137 0.8241116529239646 -1.0535858075824007 0.48356669414538395 0.5923252518925658 -0.21286195639063826 -0.73751727199405415 0.44369494450108332 -0.30164179363961457;0.01860916297294047 -0.33058143677055501 0.48636277334769146 -0.54237506309338868 -0.41874426180048224 0.46551821077999389 0.59953499461790971 -1.220047717247323 -0.55835515538262359 0.50260952028521377 -0.37222116086511126 -0.3972551775295754 -0.80029695406629764 0.82722320945871863 1.1631517604267301;-0.30948690350941704 0.43006616100326128 -0.076491830163825783 -0.66139114094831986 0.055769580128161758 0.89535344590537669 -0.029792021943759572 -1.6679769074531099 1.3764048973655743 0.56859016729560974 -1.5370765682923255 1.2348675039907173 -0.10349443573455006 1.4490318024786566 -0.45973393400192875;1.0285421040090239 -0.099344999879493051 -0.1626027231931301 -0.63594734664175212 -0.44037926133044969 -0.55063961733731159 -0.1726221332554162 0.22093149398523826 0.63213352692008384 -0.6761073184240316 0.058061334269080438 0.60698479553196294 -0.3070159682623132 0.69640636475343709 0.86289479872237229;-1.415973541930633 -0.1084928974891109 0.38721962077731809 0.64481008942724671 0.54187290139607625 0.55031077510913162 -0.63123017761275135 0.042931551169604003 1.2958493266752882 0.51930820892824137 -1.1658881785122113 -0.14788531266473293 -0.20037899061216768 0.78842605680694355 -0.86828704128911427;-0.10159953926978155 2.0094646345138885 -0.92234623978143737 -1.6730679939938669 -1.0117060052488143 -0.77630098095380751 -0.68902443199117092 -1.5745183219037264 1.8269136989221546 -0.7870105447061877 1.1652497511037552 0.58959576552224058 0.50888072148215235 0.35371045211536789 -0.34083362760758057;-0.34217547198837883 -0.99257797648942314 0.59916957081822131 0.50117709155087931 -0.7692237248833782 0.84254674335800317 1.8150036871729796 -1.1839877546532276 -1.1017314727439289 -0.37515512697131703 -0.78671858420234975 0.58764400980960996 0.77260498904431041 1.7325178114633646 0.045249745915386372;-1.0692890541303484 -0.017753016983985809 0.19142101062971811 1.6199100356981808 0.56980494922534319 1.1090516608919694 0.47535111467696667 -0.14055262322582029 1.4733676527009694 0.1504272135935012 -1.824121140603935 -0.37935501391783677 0.14635369332076847 0.05016048905078721 -0.2787936887609096;-0.21274616465993534 -0.74553902530297389 0.16517551529886584 -1.6810215727750986 1.2124998134949954 0.79232535087554823 0.7367785119585617 1.3223936353449361 -0.85124003818499194 1.3471977174106977 -0.15860244837009407 -0.60254549454271933 -1.245941031185801 -0.45179814067092972 -0.080718503077842368];
  
  % Layer 3
  b3 = 0.81557000425312021;
  LW3_2 = [1.6082069727161985 -0.8955780064306057 1.248373276564567 1.2353256618359356 -0.71825494195505946 -0.84188731068653422 0.53485142158841714 -1.5471055203673474 -0.5114636715482862 1.9168595598781981 -0.62804190473137633 0.44915158498090507 1.1032838145530466 0.58254314753996606 0.68246126566225263];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 11.7647058823529;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
