function [Y,Xf,Af] = PM10Miravalle15(X,~,~)
%PM10MIRAVALLE15 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:17.
% 
% [Y] = PM10Miravalle15(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [-6.1205274490640784;-1.5113284278125307;-0.28366752961862679;-0.97406585757181896;-0.43830072372565498;0.42955631888123552;0.15971112903520768;-0.046810488260666409;-4.7236604455908076;-0.39614471787459055;-2.7258201873467036];
IW1_1 = [1.5402997414993169 0.62122581641644792 -5.0113221144154387 0.001673587325173545 -0.42119846836461838 0.47539983999650381;0.9178282513960192 0.15808475539853981 0.50936955359255298 -0.8024561861961137 0.19526774970566374 -0.28395196658694166;1.7149287218681604 -0.16024009403798076 -0.03975216355773091 -0.12221502253983796 -0.73044576047637777 -0.078721697307003999;0.61037056613245955 0.46756916551028854 0.09108629334634448 -0.24533055336825196 -0.62698490708503329 0.024968591324356276;1.1144246803046942 -1.8454956747667606 0.022636920660915209 -0.86620009220320704 -0.82807448662669469 -0.038928982823605525;-0.045245644988151909 -1.0869881830598458 -0.2121153572208048 0.28557690399926944 0.059302816738532563 0.21463218267851886;-3.5675756090070161 -1.2821386022722467 1.3054634861090499 -0.53931301787008668 -0.51990813766957611 0.47856849592904838;-0.096823429878301157 -0.66902367404832763 -0.055598096152307139 0.21609724131513733 -0.49781869409784668 -0.14322244556032307;0.40683914849861497 0.50383213360377865 -4.9864960662000923 -0.039461249988968994 -0.62426499686099102 0.45454080520052254;0.34619415629254308 0.51700610787480838 0.1001042998801716 0.012702306846925051 -0.11153852294336035 -0.6061893833511609;0.28792560687694735 -3.6031838318313176 0.11203429222868028 1.3130868784267224 1.349858769204173 0.27634027690517882];

% Layer 2
b2 = [4.9663241385369359;-3.4611146650460998;3.0962904602054135;-2.3013548531635157;1.6172321898438176;-2.5210063693469591;1.2383607866374871;2.6653952298465851;-0.036245857273274472;2.7552019138091328;1.1183663478215438];
LW2_1 = [0.10257550182770599 -0.042461898013448775 -3.524116835186581 3.5116952915312343 -0.81771774686146215 3.0605735329414565 -0.1726703808983466 -0.752132650664049 -0.13955311613023713 1.1591135820260057 0.90192410866639328;-2.4031070010103268 2.0644856278389265 2.8960570872209535 0.17210047185630062 -0.63013742334982026 2.1353625684766255 -0.29424104702977422 -2.8326615396963764 2.7552508682279431 0.68844836108865592 0.7720468834548484;-0.34083055975081344 -0.48161498386262613 0.13405248127866093 -0.44478823021224057 -0.32661810531796609 -3.1115165788818242 0.94615241004565243 1.9152971478034957 0.099646523672947962 -2.1588856782457135 0.83876145565943161;0.56886932906518617 -0.36591398493173338 -0.96207683873715344 1.6004593016262945 0.74989009492750747 5.5354507866086244 0.38834708402893403 -3.2003572932904456 -0.076630869742839267 4.0534360808959846 -0.92922063987197123;0.24196999812502132 -0.815966580503799 -0.7740581996610244 2.8214171361695053 -0.20392387496403497 0.768562399025988 -0.77332909525968097 0.039888809875291885 0.060084302086114025 0.45318894365167228 0.40842453551544161;-2.4257964627186204 -1.5025202634689838 3.5666734083457601 2.4992595567348097 -3.8702373284359193 -0.45694525838932909 -0.69866647471310206 1.9730473172833942 0.82851890849850485 -3.3943188331407725 -1.3424759833983881;1.6222323611856433 -0.28298977457223989 0.57593619750483183 -1.9829222779734033 -1.1251652868941231 -1.3537489974291554 0.044106792323227069 -0.47452544336613778 -0.31168296295944259 -1.0005105396083425 0.11631871541762755;2.2555087432606369 1.5026926564529595 1.2429491153459051 -3.0864223345848143 0.32424220520506797 -1.4061871286556249 -0.9836809140396926 1.0771495001064113 -0.23560623513610895 -1.3027897177690873 0.28247497648136632;-0.65279178952791306 0.43810835480530674 2.1720571517182825 6.0176576074672656 -2.7439238794511094 -3.641766429622677 -0.66281661832657002 2.0333816135259597 0.51668065464497948 -3.0795045540517831 -4.8137259645749992;2.4889113496753246 -1.8599039581123979 -3.1949018132923657 1.0371159443852473 -0.094768561722033434 0.73799539265539704 -0.63886885876864274 1.3300811150273333 -2.5959135964454592 0.75082936200718786 -0.12892304418176295;1.4676953214701298 0.028424920858358398 0.75892317822098287 -1.8072655897174457 -0.87737492261964978 -0.52282710072986904 0.30200061292048586 -0.24745246958225692 -0.32025627683059338 -0.97215639725932079 -0.11880943679852336];

% Layer 3
b3 = 0.50160425534844677;
LW3_2 = [-1.3580861623809284 2.6992163636584592 2.9952515025626378 1.4082962654815083 -0.73232786340176315 0.086327640320143839 1.3037889107060943 0.64031140657211161 0.08126229666821902 1.8301024048730417 -2.1785151271227474];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
