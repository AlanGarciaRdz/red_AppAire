function [Y,Xf,Af] = NOXAguilas21(X,~,~)
%NOXAGUILAS21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:14.
% 
% [Y] = NOXAguilas21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.448430493273543;5.42005420054201;17.8571428571429;0.00666000666000666;0.02;0.0561797752808989;0.00588581518540318;0.125;4.5045045045045;2.48447204968944];
x1_step1_ymin = -1;

% Layer 1
b1 = [-4.2615541965522592;-6.1415657791037823;-1.0353877351522287;1.7774437508159402;0.2336666634232859;-0.44965949172926883;1.9012259580671669;0.13562830805025422;1.9004802007327057;2.0624272855427925];
IW1_1 = [0.12173236164059903 0.43430722769500274 -0.65769896222472946 0.77914015243619328 -3.0524586200425845 -0.57452124588462317 1.0943427346590777 -0.41316903476135036 -0.50538755715940209 -0.14660196360322436 -0.57525678992402018 0.37925579352322092;-1.1325203368101728 -0.47016831008293825 0.048926703294931831 -4.934693948262507 -1.1214029309699622 0.48219442562580711 0.39673547501677708 -0.21075128660100739 -0.41621322387710508 -0.25718468124212246 -0.048165284404414421 0.30545855709120562;0.32954834465054261 0.53264044886762174 -0.85563665301011704 1.4581292301345106 -0.24202696019850811 -0.19386480774499526 0.87302696525966705 -1.8410136419277416 -0.85428904167383513 0.14062734365983998 -0.67764225973947168 0.2200232125661617;0.83524974376034 -0.77568606573842325 0.63813308325399654 -0.33935068569298571 0.15406920760079573 0.83462209479332661 0.64366577070232489 4.0993130834132323 0.27262085877648018 0.29827890050566735 0.083244859915106384 -0.13858791726650557;2.4130820475216637 -0.37697934018685836 -0.14218781825202878 -0.63711686829499936 -0.94212766487446986 -0.25602765628264312 -0.32574312076958434 0.67528277466408115 0.41287037314737007 0.26619577839661118 0.63230631877902588 -0.13844183376586455;-0.16672774280815134 3.7028852316309395 0.032177323738723208 -0.065556629218921705 0.0051027992908298514 0.15105254658794851 0.32876573213915017 0.019449718469721673 -0.075852248811872192 0.18587167545778849 -0.38111820772700572 -0.14304846478117819;-1.1262769980106071 2.2369758669117501 0.030133327760673928 0.12322673624156986 0.32785486267861103 -0.23380472102212288 0.35959885211911818 -0.72297176168548405 -0.52313257607547536 0.21968920227233096 -0.77507860183083988 0.76896843507820856;-0.29135541569148876 5.3229261260577436 0.066638033793006812 -0.11717549790319291 0.0014794991116334091 0.070629631912905985 -0.096045621214206872 0.055265888886443758 -0.022013304266292756 -0.057126984316161401 -0.43231720859888095 -0.14578973704836207;0.061102936476813391 0.26953148137861471 -0.19710179819280876 1.3080335764180644 0.63788174033251022 -0.059646582031600434 0.55654932587582528 -0.54688211599250447 -0.4169875281067722 -0.14090699353556516 -0.68656355086281073 0.26224780668896142;0.69345429633251032 0.22310763587272534 0.096225964303569722 -0.196259313300373 2.4561285248025402 -0.7689910919959364 -0.27353044813733013 0.45645490943154354 0.49280949700450599 0.13442926446710163 -0.42531431630151872 -0.22153068124088304];

% Layer 2
b2 = [-1.76390464829343;-0.41097771855301668;-1.5472231803760226;-1.1570503829102181;0.46786798274435409;-1.2402851799654446;-0.79397844529727613;-1.3907532418484994;1.8959262320981654;2.7030464084297137];
LW2_1 = [0.21551750253873964 0.47846567260651135 0.91463381854259529 1.1770723407506065 -0.21656862219739276 0.40038856286505919 -1.2410949983879009 0.15659689797606927 -0.39312547984945401 1.2201639807659992;0.077876070551217244 0.38834032974242488 -1.1920421659307043 -1.3472415103987534 -0.2536999400806369 0.56341719551028557 0.45648199655302274 1.1694431224770734 -0.54555275408014137 -1.5317498393405071;1.0196341815025851 0.068639967667917842 0.29074688975410184 -0.25334418543369513 -0.67070938806589986 -0.6729381074055113 -0.71682595466248022 -1.2217233935169485 -0.80656244300957247 0.54633237509798782;3.7061755695494947 -0.68697200843639916 -1.6071233793118049 1.1527443208362256 -1.6536638976874964 -1.4500326599288358 0.38519553269245199 2.0582283672564743 -2.9761523825441807 -1.0510264407590511;-0.12437038460781731 -0.61150555199756618 1.3557892416241637 1.4015848784463274 0.37232565596693679 -1.126821610718066 -0.5194799370252996 -0.82057204296156472 0.58849116714669458 1.6533737440061431;-0.17983787920842326 0.29647231310282018 0.65872722197123101 -0.01657935698065488 -0.4217963281276671 -1.1984145746931614 -1.5298055496062246 1.7743353065070633 -0.11232780420766604 0.90809563895019907;0.18151663116919786 -1.4701515327644405 1.8840963288481498 -0.98686071715295531 -0.31956340198480077 -1.5943540160020957 0.078572184070922424 0.38409440023275454 -0.73106297734928338 0.24919692392065382;-0.42752664231223053 -0.73646116775941928 0.086149021829458911 -0.41456567752180012 -0.33912238324909616 -0.78348397254145918 0.63186423843427986 0.45994058546777483 0.0087097029054261782 -0.25084617913440405;0.23902390374974283 -0.14333417105138596 -0.9336731978340137 -0.23712013420403505 -1.4553209230004593 0.64278867217610869 0.30530358497892374 -0.84527054575899996 -0.2631324650326759 -0.080855099949419251;0.56209807318779914 -2.649457987462037 -1.135658906401136 -0.089938080318399033 -1.0073412171768794 0.9581920350539409 -0.17718366659067714 -1.6075659035815972 0.43142147534054126 -2.0237842199898086];

% Layer 3
b3 = -0.29458733033244644;
LW3_2 = [-1.8274918048288178 0.98036591362532088 0.61906173621176341 1.9158197532216985 1.0003469084977272 1.7125933626966612 -0.15614516489160951 0.1765430684112308 -0.61592282029394751 2.2710535481864698];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 5.42005420054201;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
