function [Y,Xf,Af] = NOXMiravalle1(X,~,~)
%NOXMIRAVALLE1 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:26.
% 
% [Y] = NOXMiravalle1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;2.48447204968944;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206;5.12820512820513;4.16666666666667];
x1_step1_ymin = -1;

% Layer 1
b1 = [-3.7870976442222917;-3.1918016248213887;1.1241628327903768;-1.517632548992043;1.0641968497822729;0.78871118453636202;0.8489043098815966;-1.7316828967183051;-2.5645532460110809;-1.2841768872167854;1.9649758580334253];
IW1_1 = [0.050290183446205117 1.1271537706688235 0.29533954578536553 -0.40974452560469371 -0.54168074669760291 1.0321967124316271 -2.2438185567414264 -1.0298602438232762 0.59115418069450842 0.92797851170838497;0.49152040125527557 1.3724421685673396 -0.22336641849861669 -0.59746268343016873 0.1170505430076493 0.45711510584630305 -1.7770207528707012 -0.27725150882698069 0.70070515474086259 1.2670207054630527;0.065506848404143586 -2.6689172561747156 -0.058863365351534039 -0.58190262752800492 0.15985681279526609 -1.2865184549679145 -0.2031739840836522 -0.37526476001504333 0.1894011604129848 0.10983655834153561;-0.12937756450848134 -1.1145849540294086 0.0059655262428989211 -0.0081748127187287849 -0.50818141861212962 -1.0421529749996088 0.21933291292209159 -1.1131702523516249 0.65920329080683238 0.91444694072267929;0.45818527479903853 -2.9507960741741863 -0.6669491947082351 0.22462149368477496 0.19801198889123264 -0.48892880338513989 -0.079062352466830771 -0.64172702630222156 -0.33424244485593252 -0.88668879893727592;0.52742630894393572 1.0903676169385355 0.64066770768310211 -0.3143033464628171 0.60847301918524832 -1.7233131334812064 0.2405631213479319 0.18249321776603464 -0.45371398809977809 -1.1297740332360275;0.1830895921838285 0.080957816246596787 1.7801886437802898 0.3999658312682417 -2.1153453083454958 -0.487748460392257 -0.33714717336077327 -0.80277383424103887 0.81859008741811401 -0.17956235297178397;-0.043076019081674868 -0.25429378745071379 -0.69535636255078914 -0.10477186819799982 0.098067239993718289 -0.19032860484398245 -0.016625809138949624 -0.059866631975069147 -1.1998682162003718 -0.13543240272054441;-0.15933597168747557 -5.9304648101885515 0.24344302973182044 -0.2137981086845874 -0.30867868596718423 -0.42263049444840123 -0.0089494834455215253 0.034312843742122644 0.3599433968432047 0.046809176236331268;-0.32219468543944663 -0.47974628385452106 -0.61413830987779494 -0.35289967820411366 -0.47181710037380614 -1.9069920465207397 -1.0562346359478187 0.86130878869783745 -0.048515748942221638 1.726048552471144;0.11632168213891567 0.12797497151246223 -0.58575302411847019 -0.30445053605152317 0.77475267433097583 0.65752203349197313 -0.57185087476562679 -0.44240330017826668 -0.73924198153346299 -0.66216934795869575];

% Layer 2
b2 = [1.7440596023972346;1.193882858686099;-1.4833983075046819;-0.74660622272365684;-0.043808457551076471;0.35835711240642776;-0.71913850003425517;0.40278473927524655;1.1791547806876297;-1.2557040684579179;2.3381699590940013];
LW2_1 = [-1.5494424959391861 -0.10126589988389467 0.99740497599163691 0.46393552548320555 -0.89820891536379865 -1.2292764888583347 0.44040077062497801 0.59608972173556662 -0.89002169710363888 0.67121035838452014 0.79790204610025817;-0.022659847360813869 -0.47098550749909796 0.69703256952617421 -0.4208769037630502 -0.81938025260227187 -0.084186217884375011 0.73377290506947657 -0.065547998586073117 -0.60546647503801798 0.23191069598909131 0.47339802626872995;0.44442162054729106 -2.3450341166091713 -1.4639309389557562 0.15713884847203652 -0.12326147269040755 2.2341335858701021 1.0237263332326498 0.061958017577718572 0.67622013249074742 1.9153978150657225 -0.49659274084657318;-0.56882397442543486 -0.51762530574519994 -0.8254208147031401 -0.20659048224034701 -0.68187734225528018 1.4811014404298142 0.93932038891263214 0.44189314071412206 0.61058123068037051 1.3828854015525889 -0.34898833153959352;2.4605929954733523 -0.38440439043829666 0.04480800434202907 -0.49439078207238391 0.58227900007668454 1.0750624414393148 -0.12533959014169646 -0.3012246581741404 0.5670929455889302 0.97704268086387258 0.70047501083677199;-0.21639745458781365 -1.3601526731282962 -0.68311501225264437 0.010135198177908256 -0.47155135456325109 -0.46344441148798809 -0.11321372886395652 0.74519814991370903 2.0669805533427272 -0.63065772605181691 -0.35019431662817807;-0.67162701007789094 -0.48080033403230038 -0.83091314363568902 0.58670153881579479 -1.1444513935428289 0.56913947560138245 -0.13541674495152523 1.5061203208227947 0.64194038405931042 -0.23371178311467569 0.1856627645902145;-0.5750273084020453 0.18439916285711072 0.43228612658812254 0.50392650416726514 -0.72106001593257929 -0.28073526008407812 0.40519971856853171 0.86709662612108229 -0.23332314747602195 -0.63253941190002094 -0.36967526302024528;0.43987753336628177 0.76231601331057086 0.80933556228301451 -0.71984291145449597 0.030490255999861687 0.19084202619130669 -0.12519603773731236 -0.96194348256280426 1.1472601083810141 -0.51804166856136502 0.79737450369062135;-0.75068275055047862 0.88378060050621721 0.67024915255508366 0.39955001454291533 0.032757016588533354 0.17700044132511994 0.44021574008441383 1.0208485093837341 -1.7552780581293896 0.0816948597536125 -0.28957249886091563;1.355787994886664 0.16236826879366589 0.87440807767099082 -1.2662936006278374 0.69638774985416774 -0.23934301237596203 0.13523296541079141 -0.70777686249396876 1.4778579666270866 0.13277742343898735 -0.14650756233111306];

% Layer 3
b3 = -0.66995270487195469;
LW3_2 = [1.9281756862568746 -2.0340764045908974 1.404238228227723 -1.9586442779826341 1.6066357658348971 -0.62697718119417212 -1.0646413245771928 1.6955563365605546 0.6224475807118327 -1.0855390171178774 -1.6839307108773516];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
