function [Y,Xf,Af] = SOXMiravalle1(X,~,~)
%SOXMIRAVALLE1 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:35.
% 
% [Y] = SOXMiravalle1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.0208986415882968;90.9090909090909;0.056980056980057;0.0063552589768033;166.666666666667;45.4545454545455;117.647058823529;29.8507462686567];
x1_step1_ymin = -1;

% Layer 1
b1 = [-3.8010459640293122;6.0663957875945549;-2.6974077136988543;-0.14666957814803769;-2.6312834518288963;1.6021042074753984;0.10940508006980389;0.31902377352397659;-3.2491666993990052;4.0085983516911181;-0.37559546693403156;3.4274873084534372];
IW1_1 = [0.74547341018139246 -2.9368013390117724 -0.093986577929715001 0.31537964047711237 1.2402859216275004 -0.69427192401842486 -0.14262875706608924 -1.0172062361703478 0.89151982458433154 -3.1269257578012684;-8.5678913645002144 -2.0651654562264259 -2.5620525696514633 2.858951116839894 -3.5248502812793592 1.2829728510089731 -1.7249101008714978 -2.9003909239757597 4.6518784003524791 0.39168681664793037;7.7314875326833334 0.36934731689641392 -0.068048010668194769 -1.0691960127700266 -0.96998003961402368 0.97191778774087523 0.45209828943710273 1.4926276883401985 1.0462322409963183 0.53756981924746716;-1.1209819075730671 -0.71040628559781727 -1.6419527622366004 -2.3581618600079226 -3.2643914594226735 -0.022038573454310807 -2.0385475738071834 2.1327075775728468 1.6190529756022871 -2.4338038839310601;7.4190711566518255 0.1718095481366885 0.92780073469531077 -5.3769022438053051 -3.2294705312297447 -0.66398783174573694 1.1082212397684494 -0.70642825937774645 3.3380439013426479 -0.034200256151471931;-4.8747166424213502 -0.25489087334098021 1.4162126305799698 -0.67868249862890828 2.267091502147228 -0.5877007862426048 0.32698370392047088 -1.4198960398569169 0.13310232269148803 -0.12690856287261271;0.80712413122282534 -3.3755242944670973 0.3495870667001858 1.6552552511918848 2.5358807140678499 -0.23494030241170802 0.0038171970017505732 -0.29446492936633578 0.039124436768967666 -0.3497366376336376;2.5475548098358436 -0.93406362171224155 -0.69302022326612267 -4.7302051990500278 0.91817337998692006 -0.27634300835747067 1.8114945189261973 -1.7747436781329378 2.3763429482426326 0.82025142587749889;-2.9478687519432611 0.25387370632853551 -0.98052718360075186 3.3969708222082544 -1.4784359343235347 1.7836298261917118 -2.4203845088654012 -0.68765528920406183 0.73406815493331057 -2.1615971417593816;-2.2975316984584193 1.8962514006999085 -1.2939859625391725 -0.061352522391764981 -2.174981039227486 -0.94706957028225003 1.0267162790255335 0.60342949860007955 2.7387611551702182 0.070977607817762967;-10.831231994758163 -0.96147574433273875 -3.0017295213645396 -0.85096132243115519 -5.5414672030406305 0.88398467521523993 -1.2505646491039886 6.8522546063723455 3.1565084288235439 -0.60540683186048228;2.0204114100212034 0.23532645955402154 0.97016324738585791 -0.36895286032969804 0.0034134038353262203 -0.36980475275928698 -1.5528484027437388 2.9360418449412178 0.23188841164761495 1.1125526592606882];

% Layer 2
b2 = [0.95174322068845074;1.7066997221993658;-4.269753126366977;0.83770237715792129;6.1209341942104274;2.0764355011891973;6.6223758876968173;7.1225283571704994;3.6723570338984226;-7.1854270654016243;-0.90104241110565164;1.3523994269712882];
LW2_1 = [0.40696040429570796 0.032740635890872401 -0.21466620023294949 0.38688426220068428 0.088995911291427449 0.19500219903767274 -0.5333777245378738 -0.15822718865656296 -0.72355279567043729 0.22465369148282729 0.37694347153176511 -1.0762018225947323;-1.2607610828141953 -0.042650680993972734 0.42524237184855201 0.71105141145720452 -2.1533297118663013 1.0129110430578456 0.55846784842366926 1.6006210753613379 2.3017275859192927 -0.26474739230147715 1.4532885151237656 2.6977210394066384;2.2147702704483669 0.86727762429995536 -1.1016878310303024 -2.1748944610991039 0.57372934452414104 -5.9144569825694528 -2.0105511222187871 0.54104625328006772 -1.4329493420683415 -0.325803765140951 -3.9980893551158516 1.9434728144208133;0.28652628562122961 -0.71150818996483489 -2.1335448030947526 -0.70949515821327314 1.8890192887348363 -1.5516630150356323 0.26618441368033485 -0.97777595684760543 0.35685803495397744 -0.21837834336239181 0.35541126837912435 -1.8843070479943176;-1.4929532248779869 0.71627961704154508 -0.81807640119224556 -2.0069522921823588 -1.7906422992623627 0.17627112955326968 2.6940413940837553 1.6158991496876538 1.101082705933357 -0.38508391848121132 -2.9181454544732759 0.15120500214959337;0.29480211575207693 -0.31172289189180458 -0.36129304938632195 0.4171210558384828 -0.23561253394654358 0.57483967093057542 -0.51523126665068353 0.030628588340001268 -0.81704728066744581 0.12629105773232191 1.6056189353213177 -0.72963811222809527;-1.4109622026797106 1.3288170641700265 3.5660903809195665 -0.5074560719399529 -1.7489991966359582 -0.23793304999537393 2.6212986351078182 1.5846574137544784 1.247836847963516 1.5554729222189787 -2.685811396124564 0.038202121633973851;-0.77527645609442664 2.6229741866920331 2.2368366074696011 -4.3878873294456886 0.5975858768585196 -0.34198628131514452 3.3035732205613715 0.41316884643390145 0.55397804763145331 3.2378820061615943 -0.27806822610912235 2.6536667569799475;-2.1062366982226903 -0.8706463259273397 1.1073245453223375 2.1789383395266544 -0.53426853712209399 5.9320775511611661 1.9043892624568695 -0.59322016347336559 1.3958399120481888 0.32279525361845801 3.2801311818706336 -2.1024353147345867;0.74588385574278815 -2.4826847057334382 -1.6476073395069777 4.1290597717713009 -0.58412138524801849 0.987082249986725 -3.1497626409742145 -0.39855745363820266 -0.52854882811270276 -3.0849517371965125 0.28261244706563954 -2.5127755206030948;-0.47359568868775714 -0.042354225556506503 0.30308719634224274 -0.46308974175756179 -0.18258157247869006 -0.17672977166257475 0.60136277264232119 0.2371205249278017 0.79681496244511663 -0.28376714604117587 -0.29785535777462219 1.2754537837305007;-0.67708390015285125 -1.1165157267298489 -0.25849399846772181 1.0756716480279442 -1.1009117485933444 -0.49498830584960879 -0.43617401356307461 1.2595771971498004 -0.1262957882658543 -0.41034632322695425 -0.050249607506292364 2.3534910903648276];

% Layer 3
b3 = 0.51934255591061995;
LW3_2 = [-1.1655775277405152 -0.10759518246587256 -2.9242774330007006 -0.080947767800483364 3.0896234799778814 0.30987597329749744 -3.1393399773969102 2.957527280380976 -2.932454919337756 4.3199197890976118 -0.84657708935920106 -0.07344563451212531];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
