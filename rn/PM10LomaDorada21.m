function [Y,Xf,Af] = PM10LomaDorada21(X,~,~)
%PM10LOMADORADA21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:13.
% 
% [Y] = PM10LomaDorada21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.290275761973875;3.96825396825397;0.00572573718866304;62.5;0.00462534690101758];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.9510855132416007;-5.0027613429513043;-1.2988391629856848;-3.3242546403302971;-6.9834878907781262;2.8781268695386051;5.1641802471410063;2.3878820042470323;-1.6696066325328909;-0.21056126453387919;4.161262588173698;-0.67912714447771882;0.58855789500756794];
IW1_1 = [-0.26608180178339402 -0.030847326019607203 -0.42574449318972712 -1.4251671781071471 0.10828199801161018 -0.14185604956576595 -2.3839206825036872;-0.077007819526409907 -5.9721302366591011 -2.4163006104469087 -1.9296652637881251 -0.12817944251881819 0.93477592023638034 0.78610917053506169;-0.77883474434377353 0.84696424840575846 3.2093282204875537 -1.2033930662455201 -4.0685375448875671 0.8427998041339706 -0.13130000156775459;1.9173472328164352 0.10783476485314676 -0.45733349251425959 0.051243652466189928 -0.45982250647115941 -0.50500345392490664 -0.47858274024981884;-1.0268008214631366 -0.17845811404395706 -5.5406068278547771 5.0130226512885772 0.64109844534235683 -6.6479177219443146 0.14426306341415107;-5.7883489446935297 0.70765453241348075 -1.0767250948839839 -1.854262058936031 -0.58536919670984144 0.052139193940770517 -1.8568347229736835;-9.8331146832346885 0.16658639575690409 6.6317337297314571 -5.3948922084539239 0.23546790996237657 9.3778396288535806 1.1641745205683909;-1.749860855437344 -0.47601547774064396 1.5796371901154536 -0.073888097511312131 0.51463513919402404 0.39492876451294306 0.83360900444292363;0.047231742695382523 -0.22039377638215721 -2.4312276930578882 0.067765620517472591 -3.0206841236998367 2.1136391783156783 1.9751397163977005;-0.39681617465671604 -0.19995678575334161 5.1251194468203209 -2.4807799610176984 -3.8097016447293339 1.1280725391756918 1.270773994904643;2.3579129969198642 -0.35471005671138217 -1.671782396334119 0.31205218557902281 1.1236012988760611 2.5672569706915458 0.51857375762658675;-1.2454387893808629 3.1349784593201631 0.19270668301004443 0.6541390920913529 0.61160518572728007 1.133160870827155 0.23045196373883756;-0.2985932182897359 -4.7289362684474163 -0.40960581355404074 0.028661139997510389 0.81090983218393131 1.3144169711115889 0.68271079407669022];

% Layer 2
b2 = [1.0283133083929508;0.95509356820449809;-1.4163565233338786;2.9962130887826621;-3.5194458160226452;0.56019402176432698;-0.7054870594583571;-0.45013243529190722;-1.3888513747464901;0.19967192223778807;0.29472140903810312;-2.3984169297702311;-3.6139627955896865];
LW2_1 = [-1.3865878320450133 -0.23567489809050016 -1.7967545424803244 3.7851080837652606 -1.5760854519714418 -1.8654086199227873 0.21041141599223584 0.82054777092506559 -1.9364241981040442 0.62225675208895592 -1.4635757754426719 -0.39663233078313387 0.39807683051903164;-0.87447652712784196 -2.1003830522974574 -1.1230916106964932 -0.4453896123739578 -1.5269525336608132 -0.75925036577693794 1.566652024727812 1.0887978599950816 -2.5412367218060372 -3.037907432292279 1.3549832044807117 1.5649693986817201 -1.2423817614405448;0.19816122994874302 -2.0481834054273089 -1.0284126344065758 1.4865418750462962 -1.2837572509138464 -1.2334063155360238 0.47928257584747674 0.41869509371839009 0.1879070321525016 -0.022258629383705063 -0.007721183282195232 -3.6976081132311642 1.6219777784307201;4.0325990240123302 -2.106517113102667 -1.1778096344877371 3.0248239756201367 -0.31152429081669308 0.30214412356367298 0.1066198955127137 -0.47010290680228428 1.9513974961615728 2.7455771532401276 -0.88984232895854731 1.6875648814681026 1.7524834301945271;-1.7939213442263389 0.825567119889143 2.3791595173346658 2.5212764662402511 -5.010177953561973 0.43246609591785373 -2.3217368497692417 3.2139367144816906 -2.1175877308602096 -0.79746504116157946 2.8711045174118 -0.052574943436526037 -1.201576541711096;0.51408100232409937 0.16522287384244908 1.2493377495908935 -1.5208066569638512 2.2623316751164895 0.31920788238440528 0.023953730106996966 -0.13517364597550596 -0.64104604393303632 -0.59177670773381164 1.309288461436259 0.076443932047673774 -0.87152209593186247;-0.63320347772196239 1.3521477390857517 -2.0233947353551933 -2.0606814523069463 1.6167207176903691 -0.32982088552202393 0.6982620216080232 0.3907279707566404 -0.26050998599359343 1.2821824683606395 -1.778186285121562 -2.5060173696479655 1.5732246975969713;-1.4957021275510711 3.737833912074898 0.29632250563329215 5.6234963714239594 -0.58555843113974027 0.69611455907519837 -2.2470112617989413 2.3103855731839986 2.0628615616390253 -4.2382604034521245 -0.91475198608456121 -0.26963720905815047 -4.0505371501571039;-1.3200413535919058 0.8498270028890712 3.3793630086983963 -2.0821299838162561 -1.6310243801687205 0.61910481142312457 -1.5933944029631602 -0.16627112862935284 -3.0074780522287381 2.8662176498123495 4.2546204117894435 2.3535381671715343 0.1245267805753858;0.50606741975971103 0.085431677356822763 -0.086037841911708421 -1.0216805144923737 -0.4273421900933681 1.6351408767546201 0.2449381519228227 -0.50842561886353776 0.1315511242345252 1.6646401921200815 -1.0406168117033214 0.31394440254026129 0.47558546705119681;-0.31582072403012323 0.15278518721788445 0.96984180001500231 -0.010586580214362887 0.73511071615255308 -0.9635522707939389 2.1769797839081564 -2.1083956800971384 -2.6574430922221293 -0.29921041285003575 -0.82674675115893947 6.2518306784812472 -6.7171712267122485;-1.2577273117429573 3.3618639777454047 0.29103511195769782 5.0386968148064026 -0.50604592650251712 0.032918987564728594 -0.12394313468204589 -0.48391794343867339 1.8677795961097776 -3.9915355200831861 0.79514462526663121 -0.47906582224532601 -3.6125440019894723;-1.6321898373881225 2.0049468383212115 0.54124363842810375 -1.1820010112370283 -0.83802025635382427 -0.71534067997434114 0.11105355014797923 1.1986222728544138 -0.38725199973908297 -0.97066569721604468 0.32813432771426043 -1.41340708297446 -2.3853993888052614];

% Layer 3
b3 = -0.29873219511757487;
LW3_2 = [-0.15942980155735034 0.056598059253345663 -0.095135070149834869 0.071091660912888585 0.12539560302922234 -0.20553219420484764 0.047926378949263798 2.9191718272009086 -0.03446487248924137 -0.16368954134948324 -0.056358873626337513 -3.0260268203363272 0.62207962043699261];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
