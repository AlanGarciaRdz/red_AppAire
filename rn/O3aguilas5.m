function [Y,Xf,Af] = O3aguilas5(X,~,~)
%O3AGUILAS5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:33.
% 
% [Y] = O3aguilas5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.42005420054201;35.0877192982456;0.0561797752808989;0.00588581518540318;11.7647058823529];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [3.0117514771680232;2.322880049971138;1.1773664600970803;0.32430702379233223;-0.66934523580462646;1.7698207944695887;-0.59581209865109397;0.73361014820296244;0.72189114213826178;1.168281450110876;-0.17579492629499888;-1.5892110160617636;2.6124390486498963;-2.0101657508443131];
  IW1_1 = [-0.81693527538466337 2.0042273040044383 0.17788814670660427 -2.0520246477900934 1.2659367662620549 1.3063456568906313 0.9071256708949943;0.01069557054343578 2.602825568736836 0.75033497651998549 0.042191504853500872 -0.2331780374626044 0.045538747406024288 1.7969795107699098;-0.30192745334031557 -0.075989528666974143 0.0064030315941391892 0.91767274696732637 0.25445463266955243 1.1929861007380445 0.29137155543396681;1.6744059670878513 2.5329502403072959 -1.7881079486835008 0.64343753562856398 -1.3296167659607971 -0.28273616177522304 -1.2634313701783795;1.1600137435890059 0.96282392537468386 -0.87480264990953815 0.34298059427767175 0.30375420832430844 -0.14365596351908291 -2.0095479367429134;0.84606962864936552 0.92594183671872865 1.9801886171950418 0.23204383429116499 0.53034718674840264 1.4180303592773957 1.8214769367115158;0.44480375844719905 -0.82860105618161883 -1.3183050205242008 -0.032994356629503896 -2.2307870881683214 1.2567038879152483 -2.7377369982122617;-2.2888416133936844 0.019065766371305644 0.025169214376491202 -0.10621189200494721 -0.12297517406865997 -0.14486029053627436 1.1790410184739875;-0.027182607634692085 0.8020619338989825 0.63334990829619764 0.27710559843510513 -0.1183098016790804 0.94425506519640079 -0.134936416573115;-0.37624340414066093 1.3454274263286718 -1.1599181492486386 -1.8874358168993735 2.3310777741643727 0.21831730024591064 0.64516793387119453;-1.2553417640565285 1.2899151651978777 -0.39794360546059637 0.29008532757804573 -0.93181017545137412 -0.00053889331814597347 1.6917277492686962;-1.9746227208876992 1.9950449941947574 -1.8104248353896693 -0.33721904255231133 0.47662883701894587 0.15643885047039185 1.1178639831112656;2.763104054998093 -0.34652858899665162 0.48167757803543243 0.22418887200407939 -0.097380994759513645 0.27868989929118898 1.8014413691509383;-1.6943256301564606 0.33734539619995418 0.22118183623104681 -0.31628551906360125 0.40400178690826555 -0.43678043241630637 1.5173325072194634];
  
  % Layer 2
  b2 = [-1.3830691709022305;1.7181474269954631;0.090607123180472648;-0.22674257467256545;0.80767887520479142;0.95269887315530999;-0.81003794157963394;0.71384517571773642;-0.87032981966847411;0.24977192602932907;1.8982173068194017;-1.8994542736580291;1.4789487332474029;-1.3974420756737913];
  LW2_1 = [1.2839721837777505 0.17869580121773102 0.47535193726636321 -0.85505508393426943 2.0070631196704816 -0.41336212745505418 0.16139326009979643 3.1101557518317366 0.23083705211261832 -1.5867160361420976 -0.23142536158362154 -0.41879857140223303 1.7836950207902009 0.59382903910330442;0.25455070883252184 -0.30778185440216005 -0.1632805879358398 0.304275684843681 -0.3207395001676942 -0.063050065835249247 -0.09803430496668826 -1.4266155928088078 -0.16338248239220496 0.42073205654085222 0.36418071694921972 -0.16116574714500598 0.066820187523412206 0.32796293224129375;-1.4875881140476894 -0.10481848561783391 0.65169373783415518 -0.65802583419175509 -0.0090105261649613185 0.41416321179309384 0.93569733726265414 0.86826056839556398 -0.30244414586124374 -1.2495557440604745 0.14789286126282669 0.4424070853467364 -1.4593193619861164 1.0014989326505224;-0.71929259274889623 -0.60755086655782842 -0.37693375831532405 0.65704638714316654 0.23109776007515015 -0.010157582947814577 0.35156270784168459 0.078631329772397007 0.28569857605470045 0.24234676216758289 0.31232911866983831 0.021919383563003859 -0.04710764806766124 0.46454076262619087;-0.21527700809168132 -0.48856048285596615 -0.53219404580851493 -0.69546389368431516 -0.46752202149979838 -0.039698632223992406 0.50936392885727988 -0.045973203444904215 0.61727412110778912 -0.010683090301598905 -0.23529305778574416 -0.25813697682454545 -0.78865499556050722 -0.76228486270558349;-0.15068961159088662 1.6581369567300055 0.92590068592770169 -0.019079888177640392 0.36593941090283832 -0.71395379424569161 -0.25383593500487045 -0.73091797520948387 -0.35436659718501373 -1.3479722672894254 -1.2829180503778639 0.16024357833472314 -0.41811707950580262 -0.49392852685927929;0.82572327940746404 -1.0826611578378595 0.067010910158532819 -0.80172695826238083 0.37107467528888843 0.43602084859410911 -0.11933597214024126 0.53299582115905209 -0.41357570088408591 -0.26017727541874408 1.1785855675062966 -0.27528089455515659 0.58845307161767435 -0.62949133872986496;0.0037869979475974383 -1.2229571011451694 -0.46901091878544393 0.41666869947857771 -0.54974401260411476 -0.0010296015797697129 0.40486942543364318 0.30398994522941458 0.76655394156815937 0.35053473763188669 -0.39224951957158538 -0.66867263005448851 -0.90891268147848192 -0.25287961788980018;-0.23100873152303855 -0.12101979376086754 -0.66181553631468415 1.6052804588079985 0.068200482150770708 0.54562298915171148 0.29517728368413015 1.1395082542375925 0.81802286469912411 -0.07619544890908915 -0.19103246003902927 0.72029997813289681 -0.30132100534036271 1.7312248454437449;1.0824343247565147 -0.82570433281300315 0.57525206730408052 1.1550042881850986 -0.24057991791142097 1.0939140047987894 -0.5504814563462791 -1.7420444813859537 -1.6738745498903385 -0.74002450665766673 -0.0031011861736901514 -0.079691134986348722 -0.8753920495107278 0.67888191555834465;0.69597244072716669 1.4030789974109521 -0.48955680305930366 -1.1861327188270536 -1.070493890154685 -1.078236700683429 1.0001334752774966 -0.15253493825796705 1.4831154649223415 -0.34119248190020768 -0.96959271546788561 2.7266893695581373 -0.51566065220463275 -1.6667968066888863;0.64555162209466188 0.50348506949012095 0.53238520101824827 -0.078484922878907043 0.12185500187697093 0.34457241494256158 -0.96440709172157846 1.6965482696687004 0.48579109745090515 -1.5603505671915079 -0.14003804281696169 -0.57958689406885233 0.45533084926505668 1.038483053473706;0.40155482097590794 0.69695628135530141 0.26605390114467253 -0.92415776290240559 0.52826200528712686 -0.77884981518885266 0.10418340295560977 0.67462358261476441 -1.0889128185134216 0.012441696211603917 1.296808785907515 -0.27220071192306994 0.73579999453758682 -0.57713035342020957;-0.58129008103852786 2.1403277327018291 0.56270457671851415 0.081929301758418976 -1.4254868481296106 -0.40000937308772011 -0.46290769856270825 -1.7652136708685493 0.20822962802485115 0.065092166420893452 0.18202100149814882 -1.5259638306387124 -2.3760833546605231 0.61694822327707044];
  
  % Layer 3
  b3 = -1.1412779862436022;
  LW3_2 = [0.68515564183883426 2.154490107100099 0.81711738484334906 -1.4237834061021504 1.4506186460358097 -0.74643791781129643 -1.2168577042396524 -0.72539118477571829 0.596295216447013 0.42952633241430405 -0.58413622578685642 1.9093776826553948 0.47232890487943957 -1.0921123840587115];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 11.7647058823529;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
