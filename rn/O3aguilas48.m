function [Y,Xf,Af] = O3aguilas48(X,~,~)
%O3AGUILAS48 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:35.
% 
% [Y] = O3aguilas48(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.42005420054201;35.0877192982456;0.0561797752808989;0.00588581518540318;11.7647058823529];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [8.0657820126946174;-3.2736618282205856;3.1394833585917308;1.3174815740092842;-1.2359180764858528;-0.92272797264406747;-2.2577895254662499;0.74061402614390548;1.3483645828047368;-1.1396023209553818;-15.400354439620724;-0.095630488467679214;-0.80139826687797222];
  IW1_1 = [-0.25611015990398234 -1.2807209556582184 4.094860756430025 0.89938746103932421 -2.0042181441818712 -0.16574871660031865 3.9429271789119458;-0.39875402676058475 0.065950171502037025 -3.9338340592795533 2.6163765561268475 1.7649593311280112 -2.9613143359443632 0.019705344628152256;-1.9444696808450166 3.0287634964570822 -0.24343275822170873 0.15754183431115412 -0.31494915067081358 -0.34998077307596126 -0.052225834870703945;-2.3567294062835407 -0.20087910916792687 0.063109893392732389 -0.37680714469103321 0.11099985158721938 -0.19287037563466508 0.35780077169038876;-0.27443063043495014 -2.3232961262677927 -0.48608275892471053 -0.58468445289707605 0.84120052424520275 0.1609345710610276 -1.4369669184008587;1.4310822342474732 -0.13041642580258639 -0.1226117462521801 0.089525042905624685 0.18433089031574462 0.016991220361613001 -0.055590314712162428;-0.28010455787135224 -0.57069284472646253 -0.17294005130567011 0.83316308357755564 0.71986457407019899 -0.68681500853606425 -0.62394681568234467;-0.18227380352899114 3.0295720442108149 -1.0968430263832756 0.48423485076762074 -1.8941311044628832 -0.10360471415885464 -0.523277156271722;1.9892170311148631 -0.79534948065429112 0.79245318275042209 -0.061094620069466921 -1.6936978900952815 -0.13993914570006197 0.7698379045862449;0.15951889379170509 -1.3445517376122724 -0.74488954412680208 -0.43181274686376553 0.39650591203856639 0.14937514094511678 -2.3053706042446813;-1.0259299481722395 3.8675283950916861 0.33116967149951959 -17.393160849540312 -0.077512024018942666 -0.22207505923217713 0.93052393704861269;-1.1010482514294095 -0.30929681139433163 0.15609321926273803 -0.094882823770370939 -0.20845443087959237 -0.095349513447500672 0.081005481751573558;0.063223182885229184 4.8507158359953992 -1.416294395265854 0.40400528661308127 0.26599895524079425 -0.12454611308330585 -0.58917431901914363];
  
  % Layer 2
  b2 = [0.52089847850877169;3.7317267629415678;3.5009590179659869;-4.0373615293963478;-1.3023324484750771;3.0979488172910927;-1.5919603539958493;-1.939670345396995;2.6518683259307734;0.83758696038655844;3.1505175636459137;3.1053705396083515;1.0516002070363231];
  LW2_1 = [-0.052395136645351295 0.22295255192638583 -0.26906444596003676 -0.62263337085712878 0.028999732405685378 -0.08403108653512989 -1.3302316212269427 -0.38338358488796598 -0.47170858228280416 -0.2014215508857583 -0.025392047740481569 1.9807041737617235 0.29729630674156626;0.037555431765488347 -0.51959902953913806 -0.72558371894894891 -3.3810111085074457 0.31110057954697878 -2.2813140656109812 2.352316236966713 0.19910816962454028 0.61696713389191615 0.099937591744667653 -0.018434698406143906 -2.1126647514787269 -0.089237963999847403;-0.07020538364206251 -0.046310868486173162 -0.94996231351799609 -2.1184986890660831 -4.4784086884099104 -4.2780513223351662 0.4562885168977871 -0.3844032754748451 -0.21631643090063224 2.0571626159158192 -0.37628358232594883 -1.2049032569106091 0.78249948565977434;0.66595494995015814 -0.4020750528755318 0.19756919781542234 -1.8147477461443533 4.104232536113722 1.9351012420797038 1.0842988555096746 -0.3574635896622439 -2.6409823042064033 1.0867603391962093 0.8744307230170526 -0.67362577210326824 0.021124763591909419;0.95164318493629763 0.90904113491981497 0.95100221702072874 0.4339962038437844 4.9242138779130729 1.1812437334099173 0.80168145674903579 -2.45466130126501 0.90749445935389039 -2.7529172353476974 0.053998975332969226 -0.24239369160448371 4.0611257076547087;0.14094239248122081 1.2476295500062191 0.12800270558005758 1.8137721225481847 1.3808307430439186 6.1549869581810244 -2.6782030621798594 0.040849722460949221 -0.96193674599794809 -0.10581403730489855 -0.85736144572784567 2.6521516168333763 2.8593467853983814;0.42078068314270617 0.30636542351657375 1.1000678915810522 0.28282357699878746 4.1601580829736839 -0.08262613615934708 1.4466271025869468 0.065344497294284459 0.010042039400347978 -2.6882643131345851 0.33824429151475721 -0.81792858436546356 -1.3172461051608093;-0.32208925315920711 -1.019276113431077 -1.8320433337102136 1.3212534299025673 -1.2419700326566643 -1.0617079149081357 1.6286491825449561 0.48598984799589956 0.82939523576141916 -0.55840780385522892 0.84390259041954008 0.072422757652579689 -4.3682654163995736;0.07355513705191663 -0.45950132949075778 -0.80038193496170884 -3.7851163567756387 1.1547147097576147 -5.7122867430530331 -2.3769556149521791 0.08921504484208434 -0.10653014046174107 -1.8169543451580121 -0.071204022526081795 4.4997514064964852 0.091497744247940577;-0.34620420512300387 -0.75308734123667609 -0.17033010473119378 0.95960143905937101 -3.0673189391474525 1.0816613211620174 0.16782594115501229 0.84035140817579201 -0.42706266707566359 0.88254481179455568 -0.27368144984560583 2.1400364213156093 1.1292627927741341;-0.75496814047864558 -1.4395669502323647 -11.349359553321523 -0.65396053967025158 2.0987255876144184 -5.1517909759480522 -5.3148802128856314 -3.0407646530350627 3.7119774836844317 -0.35769417006812032 -0.4706152269682411 1.9882677302648046 4.8553091565189757;0.49490595053575431 -0.080383738069373573 -0.44473579680537895 -0.32631698186131308 -1.78759911521043 0.64173514573449597 -2.0009165116635845 0.31067600867528944 -0.6065107394603324 -0.55103343996471854 -0.68778321943332055 1.5056900579368611 0.88841990967233031;0.097303533394541286 0.13375993995213814 -1.5501284862083846 -1.6481736954616801 0.6210426017686751 -3.6876077525426543 -0.91307224034147016 1.7357526361544311 -0.77625519534311826 -0.94324207015911932 -0.1213695649376158 -0.92780196771474532 -1.8910664423487527];
  
  % Layer 3
  b3 = 2.2125453590290061;
  LW3_2 = [-1.2547554157075609 -0.61039389457726057 1.3409992810108957 0.40625731821031147 0.57398166332180556 0.86493622922814328 0.93107453653685612 0.64584725184825698 -0.36531539473939173 0.52702313505542808 0.061797692646808469 -2.9586407300279136 0.73878164591451878];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 11.7647058823529;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
