function [Y,Xf,Af] = COMiravalle17(X,~,~)
%COMIRAVALLE17 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:47.
% 
% [Y] = COMiravalle17(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [3.9449921462312578;1.3973509522063154;0.65624187413391799;1.4734163621787033;-0.96810286749277574;0.89198673877033952;0.52998795431972079;-0.74588437240850491;1.8506698942745512;-2.7697492759605882;-0.59346608020224989;-0.48134521517408752;1.1697524777856187;-2.5982105022464332;4.9895531240928053];
IW1_1 = [-2.8583993654726565 0.4801156091654224 0.19302293474831195 -0.84306737569711587 -1.752245325098136 0.79820893984526153 1.7903363808219874 -0.58200307439052357;-1.0116277659559305 0.52391195157724779 -1.0567421429794845 -1.1890506637813811 2.9740478941249848 -2.2751488392226533 -0.15775249186802784 0.61382595405569917;-1.0333873381496907 -2.0532743514811664 -0.044284179127138092 0.70438011671720602 0.019044276645935453 0.27886448842536915 -0.60196441119574084 0.40522538765703436;-1.1725297161172807 0.10596820056212718 -0.056993966078239554 -0.27479149438217132 -0.10197336607871169 -0.18207794470264183 -0.097555818175777395 0.61275740807678558;1.80709609854029 -0.39665761071624239 -0.11375678916237075 -0.49038971730070974 0.54746317951538914 0.89854984789446379 -1.1823025664705697 0.38804705829733238;0.67800216798687529 -2.4238665939029076 1.8178266228088553 1.9164791048853984 -2.000881835885131 2.3256706807959726 0.50578490279649535 -0.79603004359852503;0.24094554950586372 -0.67096505111768645 1.0704737343851054 -0.88622712936216463 0.61568022108297016 1.658592536741432 0.10961801752664541 -0.33919306850628361;0.7052490470006535 2.4944502071820733 -1.7172195293097787 1.0677510294742623 -0.5558131432009179 -1.2040700422473258 1.4884815927954695 0.31564808073406908;-0.096989558174987361 -4.6835219645003328 -0.19297619835809543 -0.18535930955248714 -0.17547356273706283 -0.43954404145002479 0.0058181490729113522 0.099066616976305713;-0.33727535878945486 5.1881172393547006 -1.2684255307218111 -0.088710737897943731 -0.11621606226020501 0.57858399147135842 -0.32601186839467827 0.31884681681850147;-1.7786762374110936 -2.8729590810121866 0.69441631278537652 -0.98434131815151882 0.064264034957703969 -0.81924815596784317 -0.2627112313323523 0.5806890352024805;1.0151181179576572 -1.7677144039950303 -0.2753799866832396 -0.043533650779608621 1.9006674682238269 4.7378264589074108 0.016675642884110737 1.0227114812768285;-0.75865614590450925 1.9681985274872513 3.4690178198022719 -1.2639236708809944 -0.29396731188063274 0.45931901040644724 -0.37342932849847549 -1.9654491922813477;-3.523826591224553 -0.50980282984508007 0.90467531344335383 -1.1329378721704815 0.25235965867447047 1.787393008507647 0.49007101274468234 -0.22380272030802195;4.6328698219116085 0.031808732410803967 2.4868221119065854 -0.28665610680281794 0.8583010031180659 2.4353492784663291 0.38081075221417654 -0.330772307871945];

% Layer 2
b2 = [-1.8903980451244751;0.26776798008609415;0.87030632962942511;0.23728674771708985;0.15289214386089209;0.19697295086877675;0.57807438535085898;-0.78938760853156786;-0.82830214141701564;-0.55848702625478919;0.72447711190500685;2.7240843138654265;-2.1157151765671762;-1.6423298056546234;-2.2876389129006069];
LW2_1 = [0.69551768110700951 0.26190712598735411 0.51309575093499182 -1.9977467045145585 -0.22174026863629831 0.063522042307293552 0.54151181511475555 0.46393986861320835 0.10796344683448367 -0.36270459109023623 0.62359063867060371 -0.26839677290938319 0.032192241197311913 -0.14187745789602102 1.0969951700755864;-0.42945357506667742 -0.18002660520660524 -0.53516361314862082 -0.62277974207769982 -0.31165693796773186 -0.026099427537594876 -0.38647786751302243 -0.24223607103333686 0.12237287825171506 1.1227721058705622 0.10918927310568576 0.11237641935241746 -0.44057391979378574 -0.15076491119416432 -0.051199028094166169;-0.33162214669407297 0.23084115393624033 0.13767006074829657 -0.94895641674864439 -0.5781971750603806 0.047534819889007887 1.0897407248497708 -0.29731057248700204 -1.4059267261308601 0.039077262597731005 -0.78057841196468924 -0.4698609172057554 -0.011323710729152534 -0.69339843118596145 0.76606683092184136;0.34734062712922859 0.56031474812976279 1.3867245414982061 0.62738268366004979 0.64889074182390027 0.401451750432128 1.2356296765853128 0.63961472586481261 -0.51057786724885978 -1.1760635255891643 -0.4876912360522519 -0.3976571957135594 0.39347902185396844 0.54565223368838867 -0.40513394198406261;-0.27037674303053183 -0.27987606792929232 -0.65138298010715212 -1.1340613071977594 -0.63155417653815682 -0.36123512300364563 0.0030666584347140077 0.01917183175620002 -0.21365922232491055 -0.52679225708870336 -0.091769968674548535 -0.032813523622702859 -0.24586829398082133 -0.93310268387926487 -0.75193706590533937;-0.48879252581346117 0.58684493413934558 0.82598253547042544 1.5118629730111373 0.6993824258336393 0.55643485321063657 0.41033206891548418 -0.046405401679296514 -0.10827378429506997 0.2457069385741471 -0.04784006879989032 -0.0059096198591080049 0.27044855507120258 0.97871412999200147 0.38021934421602172;-0.010827563717265929 -2.4749926580547652 0.28181249203083619 0.17940986065591741 2.2864854104051697 -1.0860087039654185 -0.68877826550538646 -0.79650835708438961 0.72399718893771481 1.3873590179060629 -0.41430660330850777 -1.3997311784956126 -0.76130708149401138 0.072740760458205711 0.61920803398784496;-0.037626678736516303 2.2327817656338178 -0.12393531392989178 -0.14971521206887545 -2.207893683916748 0.98687426426571034 0.74450510636475531 0.68814184481343788 -0.73947420694734156 -1.3375453006428317 0.36785803443971959 1.3652398108647656 0.81507685529209639 -0.26734621530024266 -0.45149145487229925;-0.54890255190251358 0.020697168309325022 -0.18970650506166586 1.9089009365972267 -0.078596118694006734 -0.07721468645639587 0.16752457543378824 -0.2718211031086753 -0.6308201906655595 -0.93699584259207858 -0.88173262377729911 0.040643404918727123 0.11615241200159682 -0.23930013375460876 -0.6411709230263446;1.3587266302237087 -0.14567343601778271 1.2073291188058337 0.85371156689378602 1.448140014350014 -0.54176645687176195 1.2540099276832326 1.3560475219361905 -2.7753386780991343 -0.64821964674300969 -0.098513167442144542 -0.70937938099833087 0.26249580454137195 -0.70976784093643275 -1.0148974495161711;0.69367778118765722 -0.1857803754907712 -0.61797961382885602 -1.1529446803537593 -1.4760455166476354 0.20295870322603102 3.8072779697885584 0.64399595166462065 -0.80372522154960813 -0.59043959582747352 0.51800740275307511 0.056573670979705004 -0.42045807376623084 -4.3547305163395631 1.1252959618430445;2.1918082884754018 0.2028329856078091 -0.067625233810202107 -1.1216468118487581 -0.02627265324383897 -0.22706908796612066 -0.57613962819367381 -0.82721883659725381 -0.396868024289596 -0.78420688014447792 0.55181386620619322 0.23426812605791517 0.5045515830755225 0.71295030987470898 -1.3511796082544458;-2.2656045657753245 -1.9451961176224544 1.1637124063001778 -1.4438200987604342 -0.39459252623115992 0.52955773593918254 -0.66530018413896819 -0.33115843876101858 0.65714926264096418 1.0879578702365289 -0.10276926670755748 -1.7067508643186289 0.92582352537804735 -1.4208557404051698 1.6091029217240282;-0.55053402033850563 -1.4724671049833897 1.5508728568675181 -2.2137597914569476 0.4156765622425237 -1.5346307244864876 -0.67901771570118785 1.3006540710224506 1.8539393970907423 1.8717160745125097 -1.107861832989101 1.1529615607034267 0.94508908677692605 0.77872443554756166 -0.95235257850869781;-0.91983721785451933 0.21032619476895303 -0.55513540968366126 -0.58210854318285765 2.4368171379694981 0.081288934558899531 0.59334312257636035 0.7418000667060356 -0.018119198166402003 -0.22173404969304486 -0.041930695351216782 0.059005430623045217 -0.32361340338927985 0.97771460226717488 -0.27994485293454147];

% Layer 3
b3 = 0.3527263882044005;
LW3_2 = [-0.64903624726670428 -1.6150664800000822 0.48003680265010851 -1.1289531298766056 1.46322852624672 1.3774101384079642 -1.1686153540141075 -1.2234226848686443 -0.75394644863319082 0.23042363013732264 -0.26030653035670681 -0.69343549526786596 0.17236124406942135 3.3730764419272012 -2.7564103019523891];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
