function [Y,Xf,Af] = PM10Miravalle24(X,~,~)
%PM10MIRAVALLE24 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:20.
% 
% [Y] = PM10Miravalle24(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.5772224864060724;-0.51736303196703015;-0.06029513724058852;0.030444700314436933;0.31411305660843986;-0.94704783716714469;0.11717946609232197;0.51375162492643855;-0.48107252229559655;2.7285051747946429;-1.4466131306079821;0.12534117152356308;1.9599283368733926];
IW1_1 = [1.158775586319007 1.0124099127917794 -0.68115002165079108 -1.0264920803738586 -1.7089324507032411 1.5372928989560697;2.0117197958094284 -0.095654038687137427 0.19292770668796227 -1.8172717902657367 -0.91137941697378633 0.20632872034347319;-0.021053245871868378 2.348992005884166 -0.11447087860119882 -0.65756194569744808 -0.76567994452855903 0.16584206161677659;0.65410109603248556 -0.20581301350642731 0.041166571936158781 -0.18332503057500479 0.86728667012631877 0.0039183695006986177;-0.92593965431473002 -1.4277065144942884 -1.5666081410063895 0.88383006932717012 -0.89757011383804319 0.64734508488806108;-0.8296891897604135 0.35666556212765849 -0.5114677633435637 0.37139090133748753 -1.8782877950026071 0.43660069005233137;0.76401989761976041 -0.19075210676789575 0.52656438881513457 1.0452464670363395 1.321464587919646 -0.2188799149015174;-0.40452173338258807 0.23811322492986414 0.24855629250780689 0.33896539403031439 -0.071758750615117065 -0.032527202439021616;-0.7043505447884979 0.11406323609901539 0.043183140801112595 0.20285261498388013 0.84695059785918614 0.37331924079193046;1.1944774409668109 1.4131531623483458 0.28127789454367152 0.13577905583562447 1.9588526962673776 0.015365705782568821;-1.6148484136561989 -0.94720512232515131 0.37861940903947716 -0.49226490383105559 -0.27555110684353812 -0.016337229531691987;0.01444928826975389 0.35811654272271398 0.090669289842198547 -0.17178377635763403 -0.20440128710762218 -0.22028634335931291;3.3427005223616555 0.3572467590491854 -0.46325054131079318 0.80408816712168796 -0.59541088862522085 -0.34595501644266302];

% Layer 2
b2 = [69.138204902954271;-8.3078633533818387;-4.3830163944886413;66.740328889501626;-4.9125199529546917;-1.2784401694648397;43.386548659858093;30.334291882351579;3.3566761147470352;106.82589570175402;120.20531898672243;-51.528373422936454;-16.164131548369767];
LW2_1 = [14.034427537210259 -50.004747687437231 9.2854019479190999 44.203708601443005 -118.39839333642361 71.927385317426172 127.58912940344973 -13.818224365754681 -4.13090677828996 110.84110126929663 101.3240519123203 22.396354872572125 -70.116370967881252;3.1472002936757466 3.9351684396533968 -3.2826562139329054 10.318555644894927 0.71095468532487016 1.6001504263629147 -3.7586466370195368 17.434673191237778 0.07781464846679588 4.366115778669311 2.6312369667429931 0.86408857005449302 -0.26356615096309993;-10.63756142912589 -81.034330946934205 -26.655150516080674 -226.42009793846205 -11.126936585276232 -54.675387308732887 73.843914239354234 -260.13780272095556 -4.8024898853747624 -56.489245876009029 0.58858851455156369 -55.707038405291925 110.55855872587719;13.118174864110692 -23.064253593953403 36.50093015922188 -6.7122358430489113 -11.955910294243616 -152.43431023019093 46.955343933890362 -49.763060944177781 29.215512851088736 -51.398185769387169 156.95471839853693 -18.157034580361213 5.7802119421110341;-2.7777786523022368 3.6992765892004607 0.24435786557675088 27.049791726091225 0.87088615630133237 0.26194309987689801 -10.664915170903548 43.400190296422437 -5.7438274684798962 -11.710826220226558 -17.9178259365702 -11.13192251433729 -12.721668297633657;-2.0084400391253991 -8.450425596384882 -2.8432200576908144 38.279915801246624 7.9330600807371914 11.90511204668528 -23.748788603876012 15.039848496097864 -20.529168918568548 -5.491226636600536 1.6699407672571083 9.803926316713568 1.0522987099345229;-41.242415926937362 123.78629102085439 32.133810480310565 80.207136121821236 -13.276462567693189 -55.891158048510917 -78.754014543455938 195.33286689094831 64.76041098258014 -6.3404047333191533 60.309098806692241 -211.32063893431271 165.22788888132408;0.18690919410131815 -1.1330668039235225 -0.87095631159414222 -1.4369660355746599 1.2962186223434973 0.093415830961351712 1.5054262760996211 -5.0068216894574711 0.55392366178310681 -35.300935207199167 -8.5917449049916623 4.9691858840797245 -3.2384639249014255;-2.8624786509079554 -2.5491185911315353 0.726776864411249 -7.4813591297161999 0.73435125311418925 -4.3743811869443068 1.2667080704159328 -9.4937940570676442 -1.7084804140962628 -8.725436551831999 -6.0249044108984986 -2.2768888857527574 -0.4242241460588248;65.196273194756728 85.085544346450746 47.363018175138841 82.651777525220339 -24.922201147963921 68.989926137548338 -84.534208609540926 139.51424592766713 94.707861845979522 42.260443671490492 -104.40103008696684 10.357222261001912 -46.196306067582796;-44.040006850024213 -13.84235697127675 22.683293956496819 -104.83207593094204 -33.191245863941695 -113.94219330345183 -4.384051802228055 -156.54120469450152 -22.82847009895157 -76.721484433511208 -1.3581466648397857 -152.15645242077906 -18.934363856545367;-39.995108221317452 -43.123393537524223 -35.445494853395694 -10.367075630871858 95.617822213866646 -78.014939364922185 -24.317126892415853 20.088384669841965 -212.99601954971959 -38.82486833959873 -31.675628783433481 78.636808474723495 -36.506993889030788;3.4052162551049596 1.7595655989415329 -7.1008990729998791 29.116041416866491 6.4525331275876709 11.295364893542768 -3.8827100639695136 26.834673521441509 16.811419881365527 6.9684762131997937 3.9065947077135847 50.222965951596599 6.5837189213258585];

% Layer 3
b3 = -0.71376926751069514;
LW3_2 = [0.017588610586531581 0.13146433069644306 -0.021129734614978423 -0.005183506923414273 -0.05108803488315343 0.034314641104800557 0.04513531086915501 -0.12372906681924872 0.095733669471329455 -0.015013704918739107 -0.017409037599549239 0.020677615519942402 0.056399652689120158];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
