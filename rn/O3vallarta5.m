function [Y,Xf,Af] = O3vallarta5(X,~,~)
%O3VALLARTA5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:54.
% 
% [Y] = O3vallarta5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.12820512820513;24.390243902439;0.02710027100271;0.141843971631206;10.4712041884817];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.76279328228451881;2.5699914237722647;-2.8479284428409071;-3.1142364794749358;0.70087196793272533;-1.3403427061408808;4.6064191443343301;0.24633598797785106;0.038478109510068421;-0.16876975590939619;-1.706048474820848;0.56463232920627537];
  IW1_1 = [-1.8217108011831411 0.1140166860064302 -1.5707462860161012 -0.072283676058474522 -0.74869584010125589 0.90038554201679866 2.0278924572318737;0.62996988520673802 -0.7395883251438099 0.16168156412277437 0.80629590278534391 -0.22996789304401602 -0.31090026612444255 2.1449936112479149;3.0775892793709789 0.52883673076500815 -1.2139310417650193 -2.2338614023260455 -1.8594122117539287 0.073763802649765481 -1.3334149480862276;0.70747761929607389 1.3973330542521862 1.8332614304929116 -2.4820974338822386 0.52076975723989527 0.72903273115277867 0.080077559603129483;-1.6708828168881469 0.38205051210943242 -0.42516214213628206 -1.1187048446102541 0.086046539624259261 0.30982485158128581 2.400273756834133;-2.4675675443658367 0.3055581399663318 -0.17180935185155949 -0.58180351645914508 -0.49525045885607433 0.17361557269239389 -0.2002860604585277;-0.9573939827648783 7.0243380115366332 1.9083737709015309 5.9900564421684104 3.2032270756150663 1.1691383334714509 0.22679010576862624;-0.3687757403615563 -1.1391667171981863 1.0741722178578266 -0.025149098590316693 1.3643139153548907 -0.15366168266057437 0.31842183756069586;-0.26860793989772425 -2.102695825376522 0.80815734493440217 1.6045668469158363 1.2047844084567008 -0.17030204188303541 -0.83191038011674601;1.9220929748621602 1.9498942500561247 -0.063140355725973124 0.023433437298325491 -0.14259963116081778 -0.1257289749651925 0.72224357731550248;-0.37943703988562671 -0.92378144245440907 -0.41414637184901049 -1.2663558311133785 -0.78008385767679123 -0.59356928811994236 1.8747617994045889;-1.5029091168052926 1.4084128328986634 1.0266024010021533 0.1764093845270433 2.8818609775269604 0.53679064120407449 -1.3409252980093789];
  
  % Layer 2
  b2 = [-2.7916471804861884;0.047533995988705877;0.22033842721532393;-3.8944734080115118;0.49780297648249183;-0.1122888989888389;-4.3311071704699398;-1.7948251540498816;-1.1323847014757635;0.19528243276384627;-1.2338396123640283;1.4849056226156359];
  LW2_1 = [0.068215025842236029 0.060698537501837124 -0.19239571747865569 -0.51977033741591594 0.43695821921534866 -0.26820363202142039 0.28485172536246212 0.061058506056094738 -0.21373793039182412 -1.7209790368045264 0.22919552062713425 0.17645514053821221;-0.1212593330567297 -1.6373411608015671 0.015091316416638701 -0.016059574263582788 0.17990699004473437 -1.577118891774195 0.20247253646434263 -1.5623871618314367 1.4248724010398943 -0.25937436411854276 0.25723112808279752 -0.020314956646971291;-1.3558037868100841 0.79966563540704294 -0.39980934686836644 1.8280029676030283 1.3566781351153736 1.907374795989867 -1.2079479190609197 -1.0014028012635632 -2.4223921569844951 -0.69083963016805694 -0.60291806160592731 0.27809914528291108;-0.31521414668833952 -5.9390857448461976 0.058809902467640861 -0.67436887515280153 -4.8873565412007229 1.4453239569296461 -0.23935359267070327 -0.75270077659613421 2.1218597602730638 -1.5410532564253616 1.1422773377873152 0.094765376648604349;-0.36211394651758433 -2.3522676854727189 -1.5918291691705722 0.56091595511425585 1.1141019407835513 -0.078797210961351699 0.025805037874426832 -4.1640834599359673 2.7111664873351775 -0.40855669989307736 1.3528738672650573 -0.64903639631657861;-0.6324586772713906 -0.58644704101289835 0.25606002858070182 -2.3756539069266829 0.20606898895973091 -0.099881677805333913 -0.33395944836251823 -1.3741992885809884 1.2411312540245736 2.4933666727848904 -0.41643039530051212 -0.30833187735221113;-0.91031950253944771 0.24689330004595991 1.1233318180013105 0.51645330784450039 0.50359551848312667 -1.3320549682847385 -1.1192276730181685 -1.4335311616656432 -1.4839121214367583 -0.66548194252183557 0.37051777337512681 1.4920971489683865;0.047106667116733586 1.4420827938584582 1.0016724277214688 -1.4746587192367038 -0.41178101946663093 -0.41506271078882739 -0.43008948126421487 1.1538971556164135 -1.4286917798195837 1.4206097752092663 -2.1116331309839897 0.088016703808383265;-0.51634005160004004 -1.3113749267199444 -0.73890378044965122 2.9298864486605165 0.93022287795655778 4.4360476198631593 -1.1829141919572248 -0.50306664677888158 -0.66377908929452634 6.5707845190408509 -1.1872450196245725 0.27346950362278644;0.52143383093589235 -1.7609137331339397 1.1843560383240852 0.023963812489491476 -0.80222671128513123 -1.50747247654584 0.62719175511182512 1.8128112123506954 3.7471716556699599 -0.3612659896858792 4.2535657472229538 0.63366524868135599;-0.059061253445022381 -1.4283168374066275 0.80214918736132468 2.1088431218707777 -0.17492361397688444 -0.44286362854069516 0.18750164290471211 0.65974450664716588 -1.5094005778343076 -0.21989126790165564 -1.8608242540995286 -0.50003443089875133;-0.63682103553256375 0.50021691930412127 -1.374777828588694 -1.0170141105348318 0.98374828661100666 2.4959768079065578 -0.82532599947791474 -1.6252923594027189 1.2226159791058906 -0.54592834229418252 -0.19874577132608146 0.38492691410510638];
  
  % Layer 3
  b3 = -1.2895359873226073;
  LW3_2 = [1.7117412215792169 -0.80552117665559364 -0.3415683984786862 -1.7481555388177392 -0.70802226300236892 0.76029554149256795 0.33028007819358862 -0.41713276096095342 0.12768386845910668 -0.19460928503607847 0.37851579764538712 0.38052436309890658];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.4712041884817;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
