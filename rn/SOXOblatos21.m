function [Y,Xf,Af] = SOXOblatos21(X,~,~)
%SOXOBLATOS21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:43.
% 
% [Y] = SOXOblatos21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 11xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.100381449508131;13.1578947368421;0.00618238021638331;0.0205761316872428;117.647058823529;0.0560224089635854;0.00600600600600601;0.158730158730159;95.2380952380952];
x1_step1_ymin = -1;

% Layer 1
b1 = [3.0280312973386221;0.25890642881179854;1.5476972802592375;-2.4297596001364523;1.7726764157433583;-0.49020585341050532;0.43080051378897682;-1.589580027459828;0.47332419422248445;0.007893990782400084;-3.399421013667228;1.0873244456921458];
IW1_1 = [1.4731171011239628 -0.54445893959171521 -0.85256169215596123 0.33759396524623381 2.6544400909824786 -0.064956317108845141 1.5424866324508817 -3.6501425906777198 -0.32586763579415778 -0.20276168201674943 0.44201335616235521;-0.84763587631031523 1.5830475104240369 2.0369684218541431 1.5188264841450612 -2.0356916298954517 1.9751780372975922 -1.0967420189280164 -2.1785880212132045 0.010539106703001365 0.24710781578108737 -1.9751841558873862;-0.92371199199237897 -0.26210658774861301 -0.92331004079920875 -0.019205691731772077 1.5795782442300175 -1.1252358167537058 0.029956165361932165 0.17950101716142466 0.045663087046727301 0.3506580269974216 1.4406727929432157;5.7977303195373873 0.71445509887822933 0.90007710797350549 0.36541719144306939 -2.8537299033989956 0.37332691141987445 -2.1936656424704197 0.81966134348822839 -0.42488713150996854 0.072036158540991907 3.3078897408814347;-1.5651092035114493 0.3883878226566298 2.1071840305463416 0.23697891845551664 0.044956015005648685 1.2389755273906993 -0.73437989005225635 -0.58841674497359076 -0.04672735960007332 -0.20090729857474196 -0.54525766923558339;-2.5012130534685415 -1.8292791037419582 1.2747280962061749 -1.272740065940474 -2.8939253834086802 -2.1479270092899498 -1.4338292401600732 1.4316657320898429 0.5724729621115594 -0.74356170375583019 7.3883520404860308;0.48638961055503277 0.097888901541712078 2.4326808695171227 2.6950558699771618 -2.0352242964724128 1.5714449936937338 1.0550765261559243 -1.8087173105847161 -0.17625290278474837 0.74137035460616496 -2.4292778260277164;-2.0289279730400249 -0.38812860400324961 0.64158011309986618 -1.0327001105076219 1.2764650385888332 -0.14579160790213702 -0.32271858754229243 -0.47273503393927113 0.40301541083236941 0.72638251126946174 0.86656493971313897;0.8529968147272976 0.013895344063093576 1.5778420650876754 -3.0983376896151076 -0.42493362635910664 -1.3811017998523241 0.52045044834370702 -0.40263685561704587 0.053997348612353273 -1.4963208141404329 1.5644692150583672;-1.528115628739646 -0.39886831619636381 -0.68673919418296947 1.6875387701630105 0.84127446720122601 -0.11023721084112027 0.053824975912743732 0.82587210775775122 2.7275334040571959 1.9675079087396656 1.0080550344110739;-0.088352311865210711 0.15732251162639044 -1.9062977240518619 -1.0968242154349965 0.32154715219917557 0.25337942644022055 -0.57164818093892844 0.11331339594577958 0.062558015017089783 -0.03639934735884446 0.32767662603793335;0.45049068772139783 0.071581632617394531 0.319126014804054 0.49810990253045329 -0.20981335530272344 -0.6761657682900104 0.87158924394653481 -1.8100650789080521 0.42161606055754547 -1.1297258687827125 -2.5179057456973992];

% Layer 2
b2 = [1.3110028860219916;1.8304809028817639;-1.7839099361441577;-1.4984195678371024;-0.61453556708851376;-1.6684568975086866;2.1065625746869152;0.20566839467045811;-0.95584583748607621;-1.3978838118341126;-2.4787142921387173;-2.0186982060224659];
LW2_1 = [0.10064756590416887 -1.5213722546369619 -1.4416730071641619 -1.4925621796439281 -0.46552985010087727 -0.49658681347191697 -0.19234127525603081 -0.1160590650238275 -0.99421847051861401 0.22132313013794119 1.0009598658440191 1.0467486054216786;-0.88034671597717407 -0.04985154787411774 0.55096777930947538 0.19799302396547458 0.82115684221349039 -0.2735526996484785 -0.36331521178650367 -0.18602195866052576 0.22464871530466049 0.3323633373403756 -1.1688308354533823 -0.49605603774100981;0.073464980408996308 0.088912496426999568 -1.1630152462443784 -0.87498322351973745 -1.2250378683989511 -0.054528547400039151 -1.0689259812266005 0.064651880080718788 -0.30258306222259174 -0.14657147655410033 0.0012035433289435049 -0.48532812525377611;0.20704758877072246 0.87200263519423704 -0.15029754623626568 0.74389566060741186 0.28129758991291021 0.64851294737272114 0.17276338255650273 0.055993992037293779 0.59238090513543828 0.98790565639443806 0.033386957970701001 -0.91089603466382441;0.063902409928916423 -0.24879092170934269 0.56943352484992937 0.33953795559943167 0.86015728491478416 0.48595212636047153 0.079607957608350016 0.1021076937204002 -0.9176387368632416 0.58599086435505621 0.76099552203447163 -0.11418074320109635;-0.84019223686433431 0.33933062800161656 0.60117608876112472 -0.62518625705518172 -0.233812784446149 0.19606477926365701 0.62395905273374985 2.2937905430166277 -0.51438052917493726 -1.0511804387073518 2.6292297331392995 1.3495121678551181;5.6055434518597682 -4.515882658691627 1.5554384926054814 -7.0273598847242917 3.064123186881035 -7.8510366952161972 -3.4259120723804304 -1.8200231148705301 -2.7587946494622386 -2.7319508081872219 -1.7090881482192821 2.0807832063630576;0.30658127874633861 -0.62274475102983895 -0.50485572473760632 -0.32910826057886816 0.31492832047690533 -0.047921268712997477 -0.021792549198389209 -0.69034523462145903 -0.6049561204947892 0.49653143191080451 -0.69939515241366756 0.28597196287782989;-0.45186949734697884 0.24239584228247402 0.74256625735023751 0.038790014903522019 0.37360787456837224 0.17079515778230078 0.33726726424174125 -0.29533566475571682 0.16260942076478138 0.24644483476826168 -1.7117101493099762 -0.6666848659756599;-0.72471031437040745 -0.071024359142876969 -0.011540749467842188 -0.54195393881206411 -2.0241620818136119 -0.69314324463276056 -0.11726386753059104 -1.5675713682480892 0.39282988926624113 -0.54129786152556769 1.9476406072597658 0.15315138752866775;-0.71002261381512399 0.064320340464112891 -1.612631989066188 -1.6083387688412323 0.71039536586440455 0.067480616107273392 0.022886620671068732 0.9340301609086844 -0.32057554688693157 -0.68507240953026716 1.4129166784547043 -1.3649627393803234;0.20870202715132388 -0.24314114744304957 0.51537292416370173 0.45913026271637158 -0.22198928856076 -0.2789297427543892 -0.43359500669483864 0.37091380939090174 -0.22757029544245522 -0.076845133793044682 -0.65622677621669123 0.12638154996108372];

% Layer 3
b3 = 0.42222708040096796;
LW3_2 = [-0.11118737263858518 0.4091126693409709 -0.19259957069546116 -0.60002534874842528 0.02803223195862746 1.9519574706660321 -1.0376158781459643 0.23830400429618362 -0.080557823084670785 0.096218254811131596 -0.23340073703401082 -0.19463510393642144];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
