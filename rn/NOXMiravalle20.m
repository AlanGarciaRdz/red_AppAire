function [Y,Xf,Af] = NOXMiravalle20(X,~,~)
%NOXMIRAVALLE20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:29.
% 
% [Y] = NOXMiravalle20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;2.48447204968944;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206;5.12820512820513;4.16666666666667];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.7397876369244827;-1.4090039875389517;0.035083053803672624;-1.037440924890989;-0.58137127186178073;-0.65749214709220427;-0.59793545622294264;-0.29053182847745473;-0.031854700171790609;-0.13228366355978655;-1.4490559701514403;-0.37467350543929978;2.6692582317955251;-0.67818510733089876];
IW1_1 = [0.786914974593106 -0.94508570863768071 0.11499927267997853 -1.6792902496914626 -0.57036634445486023 -0.27342298160726286 0.0037171819716951167 -0.10690756593918577 0.11807121103863595 -0.062129504216530983;0.54346751001096238 -0.76850249687550132 0.88077128231056845 0.76283326322647826 0.28689728408606208 0.12443339431021123 0.15324701627525483 -0.80506668355407285 0.49006017165054239 0.35928042642840186;-1.5371530175732382 2.2700800841417315 0.27984206462820244 0.15816006805367946 -0.28736333908953138 0.63148891107068461 0.078076682063050476 0.14313363640844326 0.27383525907350054 0.038439943329668685;0.3873937548344103 -1.0310574655186644 -0.57565185091123539 -0.55883740132501136 -2.2685172020930504 -0.36926065312566031 -0.47996625417679617 0.03986365679256286 1.1853199598067372 0.33216388525114715;1.8535361936037418 0.14717852578137355 -0.40352764811592157 0.68564507918092865 -0.068574891312569219 0.52815824054722171 -0.36033359938709741 0.16423956066197484 -0.010177738596556352 -0.30178999644441079;-1.1965582557652763 -0.85361523122447847 -0.56081880638679238 -1.2319053769027879 -0.34007511023843978 0.30867945289830145 0.0051731497261212215 -0.45080910078849906 -0.36542723595002669 0.30328401425046259;0.077855511558652765 0.09098208432373453 0.52366816043068676 0.50223128669195238 0.94151165201165765 -1.3952844072067818 -0.68411099945720166 -0.19215768517887108 0.18997357310550386 0.067991397551102187;-0.15822429801306345 1.5276196101273776 -0.20391577469207925 -0.38812776517935171 -0.5537846500467406 -1.8804533366951508 0.38338145216462516 -0.30609711821755647 -1.0178973199150114 0.90783925799228271;0.48384479675855713 -0.46130225567523958 0.52269013429675926 0.64610262027691412 0.79399850950183393 1.2849992608248697 -0.4537683581846908 0.2392613910518909 0.60724047954149241 -0.57692530328220915;-0.17679379977229337 -3.7048137628928584 -0.51137847030468719 -0.32559567619274765 -0.089049408160974716 -0.83985530006759335 0.26316880538283699 -0.16418605943336773 -0.31263682988736896 0.26922117148709018;-0.25786858688804276 -0.089368485611152598 -0.92250156850485177 0.9530909517024696 -0.93210622423457434 0.24013380332008794 0.1716123310647546 0.24890361654069265 -0.042810691392433098 -0.79517105982442071;-0.72116761841611388 -1.7824389750052592 -0.13251129163499778 0.94637430703113212 -1.0968917415438539 -0.42421560170596312 0.30791883794413144 0.10820866872294532 0.28173131652031491 -0.14445205648309387;-1.3069202100295549 -0.32568272325758818 0.61587045727024048 0.29200806337745877 0.21134995495492778 -0.26791032143261406 0.59126411806394064 0.38579071337755777 -0.026806576446943481 -0.23842545899873782;-0.32518142686152207 1.0488632453291815 0.37422801724035371 -0.79548984598231942 2.2009471450737177 -0.098997944905703211 -0.33912196760666236 -0.022267497454769677 -0.55449433602743781 -0.33511298214789259];

% Layer 2
b2 = [-1.6269399572121854;-1.3283613170569319;-0.55400105555906243;0.54838874025935691;0.40735326707275682;0.29657162558333916;0.34820301708342949;-0.32422233571901099;-0.31594107920230735;0.085528391499159653;0.67542888380012056;-0.71666645095880011;-1.4046691607601023;-1.7412005697439645];
LW2_1 = [0.53856094674697352 0.20028421158556706 0.18797539516345821 -0.18906403377320616 -0.1855051423357581 -0.12037549671178825 0.04411448764079326 -0.59208892373271049 0.1857358394523467 0.26858500978053323 0.032423223791484788 -0.99160790692655876 -1.0477083019530902 -0.09726995675761331;-0.042974737396150264 0.1012622332118957 0.2389708035822416 0.0057766307124887959 0.47534062796927234 0.32690250901076562 0.45057119243060922 -0.15257433201983681 0.11099488726086262 0.67676770919035678 -0.22427471210760924 -0.870973795564568 -0.50136448854324644 -1.004745092735212;1.8803043203102801 -0.43350338504518249 -0.37061107234524132 -0.48318630515387812 -0.81912844256804385 -0.31409014955377096 0.34125373924614899 -0.60976952167985421 -0.019593401981920697 -0.23894264247573688 -0.23377329809970043 -0.54279334694578962 0.72345002774398748 -0.31788859460925184;-0.87162146614792213 0.71503093091028747 0.57154577769349624 0.97362907846289237 0.99427336383202869 0.77407930985923679 -0.48997738862298085 0.90407136374110952 0.23074746192352666 0.50977599172690602 0.24695823333711031 0.10746256627839137 0.29438239410336198 0.51132051589461924;-0.074469711361806662 0.53927429045904351 -0.043155945874324309 -1.1751588087278333 0.0099063205909251488 0.54405426520188915 0.69297431506136908 0.41199342791804328 0.62639934777319095 0.36069592510394255 0.57957660654232945 -0.69804556641209692 1.2229096749369419 -0.17232364532824282;0.13621865502107872 0.22790469871963887 -0.082672060392830482 -0.87133596538619351 -1.2731986595181037 -0.23602473351410316 -0.56545984155085294 -0.12755690784271567 0.65677946899278972 -0.27310050509412764 0.12610332977979913 0.13908338896009975 -0.52326621336433898 -0.16157472721473229;-1.1811734347639979 -0.33515253015575175 -0.34512037597225775 -0.80948750000802849 -0.56745696311546234 -0.13250795018138406 0.68258199381080809 -0.14511963252000912 0.37639077731101817 0.62370565461548333 0.16069931838991172 1.5867964164232218 -0.48091847916023184 0.78097795524561597;-0.079691186823810767 0.19672369824656757 0.043292677525687703 1.1003940004070585 -0.26090868759449293 -0.83462779462116221 -0.59668046513758544 0.78059502235597122 0.71525725339157931 1.405301590833071 0.2004782928248601 -0.36650730312595586 -1.2159561457699397 0.58977504818554494;-0.63773291597440118 0.077691135993563212 -0.48424501900608818 -0.083559827212413937 0.83353336960090485 -0.073879951160748414 0.75987780998596455 0.002264435614492718 -0.46985115915156905 -0.20456521426321742 -0.12103933956163028 0.28614809942063718 0.29317074952426303 0.024116516681028977;0.94732451112677529 0.01503223997530485 0.37069215468117905 -1.5709591828558407 -0.18669319681429117 0.44391729577797961 -0.34319292409022079 0.37101479495293888 0.71369572831651862 0.2502696121993479 0.77314751732027853 -0.40620152470143961 1.1703655903710091 -0.0042513018970931488;0.26493447761294087 0.24415407037042594 -1.0880057407594859 -0.93181096147570597 -0.93339618080407505 -0.32657438555855778 -0.30652905293525373 0.29784414043021562 1.6739880497596953 -0.13621220935674952 -0.074713953163854013 -1.3131773950130352 0.071717168773414774 -0.59434940216594301;-1.106224786085749 -1.1971539789594554 -0.28680827575313678 0.7722932342946871 0.099463251261392396 0.021650575513972297 -0.0334445203336564 1.581879902173579 0.66195771328920361 -1.3172088841809728 0.91805073524426839 -0.95164904426536878 -0.073836854670281768 0.59441922984408024;-0.3515127480317124 -0.50526430939627431 -0.90300759449380563 -0.2329275780807174 -0.20636603228939399 0.84309404937988641 0.45143456440154439 1.2243757549824552 1.0268257884144183 -1.383497320168376 1.1482285960262359 -1.1156388910352937 0.6348013997444234 0.071580798347946228;-0.41374982833232304 0.83366590496715598 -0.29964904479923821 0.38919489563454113 -0.19060951142524901 0.48696823494569735 -0.58690406726702338 0.50143553475599123 0.82307439373246638 0.22486754340989548 -0.087506062021597983 0.57102161015394026 -0.06634340004087641 -0.17185818525375859];

% Layer 3
b3 = -0.30388934513957061;
LW3_2 = [0.25372734221319532 0.85032296592904355 0.96312387788108567 0.92590888433554686 1.0432276540473941 1.1224820789099588 -0.22488773161028952 -1.2444920855017916 1.1537545779796712 -0.98830799796255331 -0.58429239030171887 0.70000442100217375 -0.86176011443019507 0.40750354876948419];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
