function [Y,Xf,Af] = O3aguilas16(X,~,~)
%O3AGUILAS16 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:34.
% 
% [Y] = O3aguilas16(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.42005420054201;35.0877192982456;0.0561797752808989;0.00588581518540318;11.7647058823529];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.6539142330157048;-1.787766164338519;1.9411611064164309;-1.8979781670854587;0.76022115111714017;-1.2428109432603507;-1.6158068746650731;0.052960064591402158;-0.91803930820684188;0.02460255383458948;-1.0178848805613614;-1.8773147991061767;1.8102217414601978;-1.7313685670888199;1.1306424918440683];
  IW1_1 = [-0.35462572437297363 -0.23616330031016206 -0.18385255812112175 -1.0660064758913221 0.99091002407159223 1.2331356784840508 0.89067713766165879;0.60322415558948506 1.6127289939091245 -1.0393925657177265 -0.14947254092280399 1.5531082718167539 -0.41042848962971984 -1.3813020194587795;-1.3854268936255478 0.73150880419552344 -1.1180528989396841 -0.52463482888509283 0.49330622261036261 0.5507608175705333 1.3756643659389827;0.2755413251221478 1.4213026681989702 -0.46885909821422506 -0.22889439518174404 -0.35809842141338155 -0.20791906675192795 -1.7535453143685267;-1.0029885854721592 0.35099708047235129 -1.1775769771183657 -0.56238127143713945 -0.2562173372923226 0.40107103040816217 -0.6105404690728593;2.326155738605328 0.13008045046720576 0.26689525536741182 0.10712451626126968 0.38932505387296279 -0.021950903505532287 0.140436499507786;2.6341254617783019 0.015515413703104752 0.24878560231726177 -0.11515197854124545 -0.65747167211621416 0.25319522497660096 0.65336620488020802;-0.65144556807242915 2.081123809036014 -0.51448065666368181 -0.12111571264908422 0.10084749873899516 -0.098298997200805122 -0.83077753269544796;-0.48633850262014178 2.1021068254866937 -1.2798507727765593 0.66808643721954952 0.54887860542570333 0.034636343510578101 -0.89579706292388539;1.9930686635011206 0.39890028588680038 -0.8274650438756781 0.48168113940870483 -0.68240434327978894 0.40088457387582538 -0.82401371900175457;0.48261650024368963 0.036077569676864145 -1.211970250919324 -1.5009935908799421 -1.1439263801130948 -0.02264953518014062 1.3170826778221989;-2.150951295856709 -0.43456664404799622 1.0743311829770537 0.06847842706126521 -0.89172988504811912 1.647996760879783 -0.61468053734415318;0.61551598138277208 3.1098326802946095 1.8767299509668327 -0.18782813010066365 -0.42330219374359634 -0.13953134448978566 1.3482468734353115;-1.1612614052371486 -0.5603992600858364 2.0773889563397097 0.15152548379296343 -0.83261193564078861 1.2978013310369416 -1.9086738983628688;-0.25130957288535927 2.480466890147397 0.85111205475991758 -0.17070819254844696 -0.23445340807556597 0.064887452868686663 0.98086512360655009];
  
  % Layer 2
  b2 = [1.4116546889185584;-0.86823857793617065;1.2274091951513797;0.94191425496842174;-0.042954376816702139;-1.0071357679108688;-0.056326186131370477;0.40333908518063749;-0.48085643310983417;-0.46639914857950382;-0.95898556059660511;-1.2026209680268829;-1.8639478905105074;1.8182584939120134;0.99252915358686944];
  LW2_1 = [-0.38365602422624101 0.22612532202619795 0.19422341894078582 -0.44701692036725477 -0.54551862312413857 -0.42547182771297865 -0.13338130107962262 0.69089520574674845 -1.6463312858461314 0.88343433180329645 -0.42567635346649507 0.078876365830519449 1.0045167332958949 -0.29750953424439519 0.92458159696742603;0.86000300668316776 0.089115521439591741 -0.62947591368550881 -0.40026499661122383 0.76771744670942554 -0.70683289969778407 -0.76275851673810358 -0.79929471067346769 0.9144562546871553 0.11916894040019524 0.28714406197227155 0.44092664905710116 0.22014496895308319 -0.096983850657391749 0.39022021715157051;-0.37088766194714484 -0.20167573313485429 0.86112511406497139 -1.2877193241666833 0.1009950778992192 -0.042650814977285498 0.26518013475367047 -0.07834496804926 -0.16832558522067922 1.6933580066921898 -0.84356908368788242 -0.64612832701911882 -0.30327421318124514 -0.45576681227393301 0.4359214791035973;0.04703390831949919 -0.071890718916258423 -0.85169347739542101 0.061681683310430072 -0.64700867143523755 -1.0385369330831886 -0.16620971049068484 -0.045859637759798406 0.56194070683066866 -0.43004261599825816 0.057524765012981427 -0.24837809099623412 -0.81409835347824988 0.92564937392616475 -0.2838916107463571;0.88224072757604433 0.24609211003280365 1.5128471017843255 -0.71754381678549017 1.0357047729820326 0.092461380102152282 -0.16378827517935002 0.56509969983615849 0.046956755044414239 0.23572398634813149 -1.4345658795807705 -0.14114460329767456 0.64825509052860175 -0.90936581962680463 0.60501415359587618;1.0325153608681084 0.34093379731896961 -0.022716479695245675 -0.26523775362818414 0.099829379127901657 0.02109098856482261 0.4458824146420528 -0.19909577611723317 -0.39968000802998205 0.21836661376720087 -0.015001484590968743 0.57964725760178526 1.3145885294832136 -1.2302367862139238 -0.12852974480941698;-0.184335190683871 1.2810506511052921 0.1111566722414274 1.8584671637534247 -0.43518083727475043 0.22099794157802438 0.2443676611054405 0.40153328903889896 -0.2665940008001515 -1.6854285428736973 0.740158710891201 1.0674918835063814 -0.45437629360210374 -0.39612821756464334 -1.5603465291281069;-0.54040667744844451 -0.44494338022368007 -0.34878044010815984 -0.45780339189729891 1.0115913300731485 -0.85602730414523298 -0.15079196451083188 0.98179423621527906 -0.53903010175508626 0.17386056158956703 -0.51840886878776871 0.065194347655143828 1.6719128778656132 -0.14959782142025477 -0.61399735357785012;-0.23936307094488379 0.4960556196185521 0.44547989027654594 1.2620745048777451 -0.299695661854461 0.73248266099292314 -0.13160504472513956 -1.0562381338196531 0.42163500874575827 0.041515229649384484 0.25584259454998648 0.45269126736742099 -0.52380119232945566 -0.4091655658542005 -0.9544184462649199;0.050655207869692347 0.57201356466070241 -0.1594533413117307 1.2040276735249125 0.68262696175005921 0.62262778777902617 -0.19053045656821654 -1.2209335625890727 1.2498336728166881 -0.92813713581913693 0.70830701053297862 0.70583490168284768 -0.70360482813368186 -0.22410415350131646 -1.1774728682696254;-0.91274334975986615 0.62211170183838282 0.44488264738372646 -0.05628018901814253 -0.50461632323028671 0.14711596044628622 0.0062726453867896978 0.85557180133984934 -1.3680495420759946 0.047684303249493173 -0.15554811281942527 -0.30405346562480362 -0.82966528106076476 0.19663121399198177 -0.60615739825833326;-0.75451840687339389 -0.61287519961149095 -0.41789671060063843 -0.63228665116014937 -0.38621076404492932 0.43018431315442007 0.17696583444150238 0.52026275283425638 0.79464503163414468 -0.10947744812613079 0.34708415898992401 -0.22297702862085175 -1.2500758243590668 0.034680817316290524 -0.7436691091467682;-1.114489557476791 0.24283074282485814 -0.073747538513763894 -1.2611846081591902 0.26448680030447902 0.063112172693640403 -0.073185143076845427 1.842590150104807 -1.291297960192771 -0.13312832134864494 -0.063579535253739036 0.47600886309218499 -0.62418433209927582 -0.20921026256125919 -1.4821733464551645;0.39288128680406165 0.44995119810679651 0.011362399438472674 0.99405903011444274 -0.21743344818909177 -0.026953017371596829 1.3302466856303437 -0.93531076549267012 -0.74670300914213539 -0.23295828163251522 -0.71299537425070481 1.5472252877792183 0.89579326432833994 -0.76843226870515158 -1.6222108870721403;0.23805352120685339 -0.55004415073970159 0.16291909536871083 -1.5856755045071094 -1.0773265379989208 -0.038001271055477778 -0.7934211010017036 -0.67543605869361367 -0.18900415446665814 1.3138162363872972 -0.44327077587586078 0.38948872124695277 -0.053941897989645785 -0.83322261974501077 1.7928124666271112];
  
  % Layer 3
  b3 = -0.17947457128495148;
  LW3_2 = [-0.87436012945982899 -0.61086360844895748 -0.49818959751124592 1.002844227206936 -0.47242471283555626 0.75458932665367051 0.77662064819021359 -0.62901335775827361 1.1740066179834254 -1.4510841206170573 -1.0097646534843321 -1.6788586891717381 0.69725422684084704 -0.34805446332552964 0.66040931340194331];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 11.7647058823529;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
