function [Y,Xf,Af] = O3vallarta23(X,~,~)
%O3VALLARTA23 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:55.
% 
% [Y] = O3vallarta23(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.12820512820513;24.390243902439;0.02710027100271;0.141843971631206;10.4712041884817];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [5.9912938179489714;-0.061645058079674159;-1.1947789131110942;0.16680116839968812;-1.6452573109741644;0.2419190779916717;0.50593881478441682;0.50672617151824195;0.43180687850384186;-0.49137997204685657;-2.6192856067599557;0.58087608068482999;3.0807705451039835];
  IW1_1 = [-0.27003847381571666 -3.9913032811761444 2.5671550235537901 -0.83443189472581125 2.1125315821992019 -1.5856323484055095 1.3587650005449141;1.7383990014679531 -1.384287817282309 1.1997551929023498 0.075719624025764487 -1.952725061428485 -1.5063183085075991 0.64435103212672795;0.66031697964640967 -0.29924059766641048 -0.34728949770362733 -0.69124239205035576 -0.61686731517245352 -0.32952846078920128 0.31797924569665542;-0.68319992130254514 -1.3856633811815078 -1.1878936178142139 0.19690138480960073 1.0961326869309227 -3.7386756454613397 0.90177111039841007;1.929928175942659 -0.017923760570303045 0.15287948857017947 -0.76404461168703275 0.40432382633270786 -0.011490060473556244 -0.30025726183667262;1.3281553442784408 0.19475632042009092 2.1892557977255018 -1.4806440844005624 1.2348991645436886 -0.85482283824273542 -1.8975870265337089;0.6156090213564468 0.57961360693725095 -1.3067479271936666 1.7370691319070184 -0.65198084672474366 1.3712493852687875 1.8917575414215118;0.13406341117363896 -0.23414986009393282 -0.24644164996581594 0.11829219714499327 3.2847894896448748 -0.2650296313508736 -0.39247669550323788;0.71124473852917169 -0.33700766060102438 0.21975163634516906 -0.5912080302881606 -0.89147922980314664 -0.04473691733084114 1.3428173192918642;-1.0908903205368639 0.011735355430922641 -0.5579946982921079 0.20108628757029784 -0.39897568737864508 -0.14689461334355045 -0.16652025752405497;2.8737829999657891 1.7278683228023686 -1.8150208880545526 0.027773042915326243 1.3655418632023861 0.066403857555905665 0.4258377649195636;-0.27403172783900692 3.0195460482902692 -0.54302063812564971 -0.26592144490784642 -2.4457310809028816 0.034606576919980078 0.1226925934047594;0.26830245570418487 3.7657890868830144 -1.2468016348041993 2.0761129637835714 -0.82768066943548202 -0.27989202412654951 -1.1943359242033273];
  
  % Layer 2
  b2 = [-1.0560545193018172;2.6214204001904413;1.2454144756840553;0.71530769282276074;-1.2673530025506452;-0.95471293187786266;0.28729026077636577;-2.4384114239105861;1.0573375314345503;-3.0968353783159883;0.68836178587050201;-0.44529289622638019;2.3957725600586244];
  LW2_1 = [0.88451625811012857 0.16219378928717779 -0.049218903407473952 -0.11268855965887589 0.97138795447034432 0.048870764745953359 0.4615642193325164 -0.74976361728501106 -0.46835653466509325 0.646746253020546 -0.043236804629080569 -0.69498518740257298 0.59249966416481958;-1.2712140968453824 -1.0666555611986706 0.68118888457941473 -0.9682864623944123 1.0526500215762953 0.18369112804413754 -4.0759747629700369 0.62293269081107205 -1.4045062265312889 -2.2230569785305851 -0.36773899035050067 1.3855353234638055 -0.33406548706555705;-0.32222899960109419 0.12315411771849075 2.82357794308898 -0.50447761494718313 0.74179424470915423 -0.91508331582974989 -0.064342307133437748 1.3451493828392178 -0.44712441866035046 -2.0733359582701945 -2.0119171351705361 0.27686916445417448 0.30321095863996839;0.49946451095715561 0.35576788151758265 -1.0119749072423365 0.17310555789051543 0.34229431486089024 0.031608495922488392 0.48697241049871487 -0.44842594312717965 1.1457435858959117 -0.024137477497090484 -0.5326827137402772 0.7162328838131351 -1.8400047906206192;-0.53897028619529441 -0.13569442158807971 -0.64137606444233974 0.53462423242799983 -0.10253590359448816 0.3650653082829402 -0.14694172130495919 0.56946254728468626 -1.095359538645055 -1.8382054171697231 1.3709166736396128 -0.9774843916582665 -0.66119461472481089;0.17209651723641867 -0.081958734992430976 -0.41500415328926149 -0.22176670097670043 0.71333359408090946 0.17538757570052868 0.43642950852443252 0.49026190284567278 -0.19597041555725686 1.8547677303974621 -0.11734019978524768 -0.35780752955239997 1.2878803892331232;-0.45023169265349711 -0.18992078111891289 1.7724034914834002 -0.083069169487054617 -0.61662206088259097 -0.25903343079623375 -0.29734684143017187 0.0090491860252045423 -0.86605210748864925 -1.7276234631963414 0.40877979960921762 -0.45530977382550336 0.75070209042525404;-1.2511464801593031 -0.2544682490391158 -0.81830822153237437 2.2705196405562185 -0.11896761973237586 0.41700329854459145 3.0950554995849981 3.5946620612144424 -0.13028741284717105 -0.32733456554664092 -0.66157830549891117 2.1912371693442263 -0.13918613999614976;0.57978367818732635 0.43923166137341385 -1.6921811572819654 0.21932460942143728 -0.0050951305524470133 0.60131944705838547 0.35405608995253102 0.26735149225673216 0.43226767051647624 1.9396628383896766 -1.2026876446919754 1.2770991315644245 0.16131183136956173;-0.946939675157776 0.38131779702196772 0.90286687263034349 -0.58112853420842614 1.0022512763903364 1.3659287035248677 0.16664139683018542 1.9014598567151955 -0.55124306124113009 -1.1915040636349012 -1.4482999529015039 1.4680713275193427 -0.93991477828474024;1.6309391220031213 -0.4976785779968278 -0.67689024411476706 0.60984372154100364 -1.9722226018269358 -0.074300794849114532 -0.32491148100747436 -2.5994667956775905 0.78761859658067435 0.55700702797487867 1.9432706327892593 -2.1093432034577364 1.0704928471974979;0.9841614365894511 0.17594619269281736 -0.89212301430521435 -0.052032245295164536 -1.263500209878899 -0.30346125765383064 -0.11456300951966786 0.069723950747712732 0.42544179132612825 0.77112278574126447 -1.2078306730705215 0.54302344575368722 2.0722465362032927;0.66081611974044707 -0.24383225922859064 2.4124828587399021 -1.2111246743715667 -0.57357320476229245 0.9129740603289519 -0.52715132232533002 -0.041429279328254909 -1.6720050323013282 1.3285474289822701 0.074239357618828786 -0.90003214798102171 0.6183856388385609];
  
  % Layer 3
  b3 = 0.58190130129632944;
  LW3_2 = [-0.97971282182174002 -0.63334362876653094 -0.18139664675724176 0.86930935707881263 1.0959602568406606 0.83714017279806541 0.83498117605376576 0.46713142201435792 -1.0493607572152264 3.1732907843762819 0.97705723152926793 0.66003374145718319 2.9989148275959807];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.4712041884817;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
