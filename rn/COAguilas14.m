function [Y,Xf,Af] = COAguilas14(X,~,~)
%COAGUILAS14 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:19.
% 
% [Y] = COAguilas14(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.448430493273543;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125;0.281968137600451;0.304971027752364];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.3747878581339741;-1.629758040078565;-0.876514642975877;-2.3164040275511977;-2.3880117746330463;0.037590885140550548;0.10096653444856492;-2.241055161863172;-1.2728248371685655;-1.7712366044808288;-1.0941748931025659;-1.152088882001125;1.9675523924131713;-0.47567953045377576];
IW1_1 = [-0.084855631230455184 -0.4587942530596324 0.41374095680475459 -0.41680215018097877 -0.98336191674371587 0.10569285018341858 -0.54650032381804836 1.4736163807974121 -0.47021852504540113 -0.36469664019209735 -0.26394125986670453 -0.20988205574004773;0.92829805273772192 1.947274338079992 -0.69004228940012458 0.21212100433604225 0.027681290922340906 -0.19317689289165174 -0.20866599089277588 -0.4547265679934232 0.050481178243794077 0.037211143115423923 0.22373327731785853 0.21084442477372761;0.51705886098808151 -0.7039449722922233 0.59121513249017998 -0.80955513435462867 0.12925309781389585 0.46598349480469292 1.0995103505803718 -0.41102917248910559 0.065978646329570956 -0.51142624790879065 0.35602303969769056 -0.48834144051350198;-0.27751065145499831 0.62238385510980798 2.1768480548612845 -0.36947567349661492 0.36668453023582126 0.77122649339347316 -1.8801024420934016 -2.3716142945528875 -0.36353380859972723 -0.23764611000397176 0.26889042464650253 -0.68252400720489503;0.55870525924638603 -0.28273625249603113 -1.0162239618544244 -1.6604673954011619 -0.29961593059886232 -0.30840774481482891 -0.07034139022448406 0.0653805332257337 0.15779363066403007 0.22818578687815999 0.17664176935020723 0.39704748871533813;-0.15705907399507607 0.75916795440715212 -0.81034549207037887 0.85913679362062745 -0.5971626255479795 0.15841187007383095 0.39172646863399496 2.110966493463172 0.24594933319932599 0.17616714803936492 -0.51259588760284358 -0.47967997462547729;0.56080881231590296 -2.6058959137732218 1.0563618774971137 0.123448221755806 -0.80189299468350617 -1.1546115789338995 1.8186573346762098 0.33606181113802347 0.64358233206353022 -1.0587145889332512 0.281241100480773 -0.77428894532248571;1.4562505979771869 0.90823385737878315 0.11391699830805016 -0.25517935330939512 -0.14202771371555489 -0.12214746702159798 -1.1095062307839598 -0.051567281538119826 0.25282976022261505 0.25587168072005662 0.28711978452133463 0.03822909425460301;1.1552522254810811 -1.3701789720345132 1.3902054254468474 -0.51833389619128012 0.22482614640420301 0.23815074928878643 -1.0635125480481018 0.50759655950312532 0.065275248255144983 -0.27958194126052244 -0.056122794269552662 -0.36018047598409209;-0.69963256423194919 -2.8879128532883751 1.5676320539636652 -0.64619462888983514 -1.7745007192015709 -0.028393826254106858 1.2714220173734689 -1.2627928778029343 -0.15866412251123771 0.31703880927535366 -0.43688013998361247 -1.1179630066009738;-0.29260767450047653 3.9365781861270435 -0.34335868557557248 -0.038550819444409676 0.11060015628041511 -0.16007865287228282 0.3031127444244357 0.40510307925114497 0.090672955759825466 0.068936922566759096 0.45114709914875673 0.32328289300423463;0.20703032104959856 -0.40700262793597214 -1.391032085963285 0.40760513322871894 -0.095619610306763012 -1.4232145768355731 0.47506036271728136 -0.97852017887550113 0.44291997415353568 -0.24025652654178464 -0.10874491408185197 -0.50268903699053791;-0.11207283730986412 0.41863816925452535 -0.46834733886103275 1.3636906165972273 0.1997553598917059 -0.43188982011507876 -0.89549862343885789 0.94387988233416242 0.70413952737609731 0.46355513328151549 0.0043873168735341084 -0.09281994195894297;0.32600131691976009 -2.0309596332832869 -1.5041092178287041 1.06195991401196 0.58251004705429033 0.28500718037892142 0.86696692687550103 1.4876483729063068 0.25963871410190587 -0.61294133402761808 0.37074288348268314 -0.33308623510607605];

% Layer 2
b2 = [-1.7124959153618444;1.4607581100416311;-1.4501814022218771;0.95411839903296858;-0.42402697720159482;-0.89272218046103347;0.41907104704776593;1.3153334573974931;0.93355753634473526;1.0261544921927817;1.2086280266197784;-1.1565173351806906;-1.306674516661446;1.1141317192323672];
LW2_1 = [0.63130754101090969 0.7103925932144648 0.32174840822294432 -0.54554841204587157 0.45406932029009606 0.27870652477542979 -0.48596511896854988 -0.90583996126950783 -0.21830006542028485 -1.1546238660068475 -1.3437014777389753 0.059142804037739451 0.079353606321158038 0.60403014910500186;-0.37117000842961845 0.033647067407381777 -1.7167647281233438 0.76516043240941756 1.3694744872804463 0.16647721254285425 1.2173068051557987 -0.55783978963762848 -0.31696625853151561 -0.91204668757082741 -0.61923432907887987 -0.89415925083631997 -0.17844937594978338 1.335404193369514;0.11201867460382151 0.83762504989341768 0.15371681429515976 -0.65383957004548121 1.3711476218602363 0.29722365003419926 -0.42502435543642775 -2.6599040158886491 -0.77359243387120868 -1.2649086524917701 -0.35851944136679204 -0.79321338759169369 -0.11686045730132939 1.2207643382722924;-0.069769235276101557 -0.10840920559101697 1.1291172941054819 0.26201469687809942 -0.25719041225030409 0.60182551368967685 -0.80733739240071078 -1.1906908254235693 -0.048816866732957764 -0.71057611916577657 0.50162625390441407 0.25568455888941377 -0.0080121191322197211 -0.64990101466803196;1.208396081798274 -0.0080547783717771423 -0.54645582227861622 0.31203763942257662 0.99116789584701248 -0.20379220961039507 0.81693480729913881 -0.29590740317064845 -0.0098047462606850305 -1.183074167527763 -1.0893570314974657 -0.81387385431906289 -0.026462129775243471 0.44001271586506535;-0.31209755340354278 1.0609338110567774 0.51565877887721201 -0.3865204942516493 -0.62774373959142793 -0.26987596662811331 0.40359967388353335 0.61210464166479595 -0.99374243202187285 2.0774453796213734 -0.36986419912470936 -0.44547591472511483 -0.36068429936598262 -0.21524830471040723;1.3265457489618626 -1.8490694023963359 -1.3715797162705614 0.99533099636537214 0.46642879310223023 1.4493096219522277 0.073329101292735732 -2.4136174063568379 -1.3311762298327834 0.37425937040698926 0.42607420061243462 -0.61846300987880021 1.7232632891190154 1.3258025175378789;1.5536582267906298 -0.58075505736056654 0.35868819402536817 0.30647459268429139 -1.5387115708272607 -1.4678918993634786 -0.21043484808747917 0.82506219280884274 -1.9247504483813991 1.8451586768646557 -1.5403065371961051 1.0011758675057749 1.2476738344399871 -0.68044321728762192;1.1821076924380731 3.8335821322168955 -2.3050520774389875 1.1429858043224317 0.60260849332742727 1.951305253001828 2.8127727384953962 -2.9929615849164533 -0.12522521458958158 -0.98088128251366868 -3.4105739435439761 -1.076027111254964 -0.43129845097255648 -1.2819244724016994;0.45111194710334862 0.088430511340210766 0.22937406851110087 0.33464296805787203 0.87772970375388604 -0.16759716681528808 0.21349034434012026 -0.20827871956752769 0.25685735084914413 -0.78648579331663337 -1.4755400150759599 -0.60706240789832155 -0.37652161088446517 0.18301403732072366;0.17356946866741585 -0.3431083736575139 -0.51128987294494099 0.69241097035433086 1.6754810899825514 -0.1095677919224263 -0.32262046649005915 -1.0646936231927691 0.11382064789653704 -0.71792014614594957 -0.40636840582335598 0.0022926076497609901 -0.048912309801231832 0.67093776359979251;-0.67893291562738889 0.35494484298458573 0.34133311199136723 -0.60348120898401558 -0.19506260358400862 0.55326186015940937 -0.53910100013446594 0.19124588803105125 -0.48547846571316966 -0.43039134990109984 0.44176132315499506 -0.41805524801888211 -0.65451236808578117 0.52262726239310708;-0.58076210591298094 -0.72618269589458306 -0.55021900997466378 -0.64272954438501761 -0.64659266438841179 -0.085369030083875586 -0.14924561874912232 0.13716487983606956 -0.78679451674352152 -0.45970856501767876 1.6596814047130741 0.14450460297069304 -1.5180144334466317 -0.020551920439797498;0.11036374184963905 -0.39672573535161609 0.45287841933245959 0.61683168559521917 -0.074660066057414362 0.21345710931359421 -0.33930964893436827 -0.33054111451452678 -0.81451240222702015 -0.07469278118757626 0.25601591709314336 -0.15445096916336887 -0.33025731269771913 -0.022146057160982779];

% Layer 3
b3 = -0.16743117332899879;
LW3_2 = [-0.46895029187813797 -1.1801297793730068 0.28770912741108334 0.60403014006205935 1.9235065580799398 0.40674813732799769 2.0909337547859423 1.2155306759498303 -3.5530487472770313 -1.5394157439821223 0.53332899634056563 0.49573379733219713 -0.90272866656609096 -0.74843890777537658];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
