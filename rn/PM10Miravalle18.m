function [Y,Xf,Af] = PM10Miravalle18(X,~,~)
%PM10MIRAVALLE18 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:19.
% 
% [Y] = PM10Miravalle18(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.8161351009044984;3.6896565083500188;1.9354949046461212;-0.28217065891816123;0.54311651042465525;-0.013594919214905153;0.07707836860124534;-4.2242040726391945;1.0950828364294598;3.2885476047525937];
IW1_1 = [1.3358791672005135 0.061669161197820399 1.1385603496729892 -2.1486221507887739 0.34706422471473525 -0.40784970719631147;1.4334107250099544 -0.28267407219931617 0.19211496257961189 -0.37590243263395112 -2.3392632722472992 3.6724502613466115;4.2712009866105021 -0.25756419287244486 -0.86246650452021956 -1.2074744532911386 -0.68823617803351655 -0.11516833965617745;3.5334147739065855 1.6892986697202959 2.9634262740750357 -0.038478890844654383 -2.7055594790044646 -1.6474742482060083;0.77418688373231881 -0.64496932721359745 -1.8103247305031052 0.41789245783073464 -1.8329664489159125 4.2816006152527253;-4.373174583563963 -1.9077391515178086 -1.6459913817681733 -0.51528631407961445 4.2183069337907213 -0.068321188377030884;0.51590928826236004 0.45863744874930429 -0.0088513201073496996 0.78349743795088533 1.0871971813179888 -0.13879814514977706;-2.7009127259522856 1.1671595207740901 0.21392018099008955 0.014759751492999639 2.8202070281870166 0.26266950837981395;1.8799304596276827 0.14386550275680909 -0.06436609390484456 0.53895445357094052 0.96782390198190948 -0.13316956672749375;0.041224906728225132 3.3082779143518382 0.84826169078897495 -0.45079416034858788 -0.39146932607700929 -0.62701277599675442];

% Layer 2
b2 = [-0.547895555998277;-3.2460487076781144;2.8064192595881705;-1.8251579978781212;-0.30110067069717505;3.0177123644005035;2.9724996916481503;-4.3129640083393932;3.7041964164609706;3.0737480936330837];
LW2_1 = [0.70168441775345347 3.272877323998137 -0.1288352386882789 8.7711629216806788 -1.0840641583147124 8.4983306826836866 5.8556244775371225 6.2581340256685607 0.52362761688562687 -1.0800526084790971;0.9032389915050778 -0.6468907550872911 -0.60686500241295094 2.1032995133969266 0.06925341196497542 1.5586028161753356 2.2501132837972735 3.9518659697127849 3.1677861691825262 2.1931696444986488;2.1828900792907655 -0.53563249186252815 0.035287255449365118 -1.9104617377534718 -0.63364963554798093 -1.0045969945801001 3.1363845342628109 1.4677043595413823 -1.1782386879766027 -0.50889618379917867;4.9445109191355705 0.94607567981599483 -1.5910329699994166 0.82072172305778091 0.11561623758417343 1.1580357412747719 -1.562254816978178 -6.8329835317575593 2.5547813353025854 -1.0044406320586035;-0.35288455580406197 0.078034493833151447 -0.99925868305108767 1.5363032788006528 0.34366451416444826 1.1351251533508282 0.15869925251697156 -2.4165594838648232 1.7879428214256428 -2.2337395235835293;-0.94527469903364436 2.5261283875466276 -0.74404834994516833 6.4750056696569311 -2.1011993559958801 -0.28806824878917897 -1.3875454810208896 3.3343271870257825 -8.2423014027723926 -0.2383710700633824;-1.1123213807792387 -2.1017021040890138 4.1449950204642825 1.3762770396757205 4.9191026646013976 -1.7367207721531845 0.52549854942978236 0.95728598314136459 0.048738876988298346 -0.69152839967926383;-3.3880702388562147 4.0325882478300707 0.86003891533958632 -0.16162585090263434 -1.2063725991140368 0.12563078988084997 -1.8601247979023301 3.208623260443217 1.7681908141560294 -1.4800562628390952;4.9029986689399889 0.65568995233036553 -1.1891067399168513 0.05807017410065491 0.13560875344256162 -0.14937261286242104 -2.3901459199622148 0.13307936500677542 2.6147760004873351 0.91035700038277367;-7.4274773357463957 0.74817568280483471 -2.2157045072304729 5.8442180404085384 -1.0632963799517976 -3.2081757752011129 -0.67694584506650657 2.9533629322652337 1.9556472361275499 1.6146480829510301];

% Layer 3
b3 = -0.55788533976334675;
LW3_2 = [-0.11406878533863195 0.24471184260818199 0.10903669104168751 -0.1588921052914207 0.14197594295380847 0.063133413688911288 -0.035983045622703373 0.14391949440093418 0.26248620028679825 -0.088715411951067996];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
