function [Y,Xf,Af] = PM10Miravalle48(X,~,~)
%PM10MIRAVALLE48 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:20.
% 
% [Y] = PM10Miravalle48(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.2687034435971163;0.88212668790207449;-0.92273217823992948;-2.3235577625409416;-0.66567677858413798;3.8115227428201868;0.55619709759320135;0.75918751235629012;-0.85425745586493163;3.5186139346286889;5.7102052106322638;2.7133410217722909];
IW1_1 = [-3.5441686492016888 0.64892169276689993 -1.5308348936995044 -0.12463748177982269 0.59448017035475553 -0.26057374741082545;0.71779992455383879 0.2264817164368777 -0.30722976256978857 0.61706569381612209 -0.26633612906099918 0.023372555244090865;0.46858588699733023 -1.9821994935584752 -0.91876831858750008 0.18690066197873953 0.6782412538623368 -0.11086386208793342;0.53709083143554337 -0.9895322715806012 -0.16309054962230032 -0.072732828811471459 -0.26876963039828905 0.021833754888217059;0.43418017747603377 -3.1308235834054789 0.053439256655793903 0.11022139427171476 1.0589258400005011 -0.050692629641948574;6.1745965714017075 -0.16182862125502018 -1.5368803039805983 0.069084934969855336 0.034363111124658979 0.081004610557401865;-0.78555280392417215 0.29634656565248746 1.1611678757121733 0.46743450841770823 -0.25458864816614929 -0.66349646682899932;0.91554731296402381 -1.3130923308831703 0.15330764048948317 -1.0809766143943744 -2.5404170596076652 0.058063839846301396;-1.7653893363106081 0.02205393771863411 0.13928978510041146 -1.0314286685094951 -1.1176450263512046 -0.1419208008408856;2.3779259810526532 -0.75195806163113077 0.88450017870216768 -2.1178093004868965 -2.1769883638400076 0.49499978202607253;2.1903877062270221 0.67308348030254461 -0.62731181552286586 -0.70135671171159142 -1.2632734693182917 6.280600785774948;0.25718013524146738 -2.9468652703176104 -1.1398690197754746 0.24169338329669635 -1.0737312538284445 -0.013814301557984909];

% Layer 2
b2 = [5.1661195048522526;9.62931257824002;0.044359213185471869;-0.047400837968144871;-4.3654293648960598;5.1349853649485535;5.7546853322911158;-1.8815724983522089;0.10265584325139521;-8.663473433039357;3.7791165355682095;-0.81637751797437952];
LW2_1 = [-0.969854134840892 1.1174100271951948 -3.2451526522068375 -0.8930025963269006 3.0267712757746636 0.9069310971600022 -2.2501178125401609 -0.51844735126536445 0.024949783025077277 0.76495654553735992 0.55498795578592608 -7.7215936711473905;2.7264694648349557 1.7023619898419029 -4.9176211638448502 1.0504649717618502 5.128835872775614 -4.2703061080045188 -2.2222471494475831 -1.4469675410641349 2.3637062331097889 -6.3181311060013146 -0.86640604720400627 1.2056518423874256;0.56166012789085829 1.8211823748266405 -0.09824851406157932 -1.8454511866434085 1.2937569800110005 -2.0643609134850402 0.29708938992631478 -1.5201571535186125 0.54949606632477743 -0.56196183526644172 -0.018535976313070274 1.0626329338219864;-0.096122964724684706 2.700380403710108 -0.35059091561367223 1.904629265471423 1.8899507348871116 0.62039206515566714 -0.30765780384236929 -0.06792052074817366 3.3429127747156722 -0.41384405299315952 -0.46796373933903812 1.6874216543291107;1.5907600643447739 -2.5862182138334213 -2.3999841140957954 -2.1187834962209502 2.011650017171815 -0.82103934492035502 1.3633189433500845 -4.8125522431862109 -3.5184853274306573 3.0907660719331602 4.1740712795133454 0.17138251822151035;2.7014582757811381 -0.36329405457740799 -2.4296104608948119 0.79967375019681963 3.4080433215324155 -0.15089175866740256 0.94473111998250248 -0.23788092864120183 -0.88971842640128473 -0.25671110566317135 -3.4137301848082786 -1.2323448554418859;-5.7666027895448941 -2.3843752457232315 -1.4782450791179969 -2.6114966297925157 -0.7522480525426154 0.87555116544822098 -1.2605150510217242 0.35129846363577899 1.9158931887151724 -1.2844830624704242 -3.0193607851914037 0.12745817351815075;-1.2476780836866568 0.54400273614348471 1.6018496080244085 1.6724369644774213 -4.1420904015710232 -0.68027944975278398 -0.30849961332067838 2.5928442127917357 -2.3274292567997441 -2.2221819526291697 1.2894277275523274 -0.86301877045045849;-4.2615683481662625 -0.97654590032598154 3.3029499293575619 1.1554221638676678 -3.1067496181026142 -1.4546828905193159 -0.71955301219714851 -1.1720884206928717 0.59965155255455926 1.826815862664797 2.4111139742405161 1.2023666687846883;6.4044968779173734 1.5984875948350126 1.2924761391332766 1.2427969422417504 -0.90761018066508592 -0.094268016158110465 0.59683694032887913 -0.87411781580592074 -3.335847989711167 -1.6034309436673513 0.031407490113140091 0.33744643165990551;-1.2032747673162549 -3.1526549907583115 0.046773813783513307 0.81127327865639165 -0.43869251425287592 3.2953126194474143 3.2183591930481059 2.1043345050151947 -5.1973012574900075 -1.4812475490713652 -4.0013632535133397 1.7662945589567849;-3.4175273012715146 -3.2685069562640963 0.16482957433517739 -1.8442850221645037 -0.0161257073019756 -0.40606153719244725 1.2110851060334396 -3.7092687334170491 -1.1015930523421122 0.91723627541924257 0.75715961881490079 -0.095967052163016722];

% Layer 3
b3 = -0.97889483345623529;
LW3_2 = [-0.036435429232650737 0.0714324619471053 -0.49794685367357433 -0.14737572064618287 0.013230584004570913 0.20307487747883921 -0.06774566610681193 -0.30885834852315625 0.14329953476397303 -0.094860826347618055 0.029128907488353797 -0.093588981727337109];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
