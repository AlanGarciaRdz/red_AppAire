function [Y,Xf,Af] = PM10SantaFe2(X,~,~)
%PM10SANTAFE2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:32.
% 
% [Y] = PM10SantaFe2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;0.00341273633199099;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.3318761766753044;3.2564626453443939;4.1822753290145416;2.3544576422139798;0.51696552129088502;0.4083361215754317;-1.9574057619786644;0.83866745723789959;0.37960938157695184;4.5098486651194003;-2.1552722935857731;-0.95613052138737875];
IW1_1 = [-0.50986687041956535 -0.48895830705065524 -0.61006899206583443 -3.2676856677220281 2.98521296497649 -0.02151910475944166;0.56239069790463636 -1.0686541682975061 0.15878216833840234 0.5009068525741589 -1.0351343924221095 3.7242234054746133;-4.5000987697654695 -0.090426164627329331 0.6133456827139312 -0.66535022915722175 -0.41271340956437186 0.15734135857322687;-2.4494601347270977 -0.97218629904846621 -1.1137677452137196 2.038418598105685 -2.7945157464358314 -0.079566363909086349;-0.77566688849735599 -1.6970299385779575 1.0613571828528037 -1.1476189497337288 -1.9103683442505379 0.038054156235268199;0.52960608751959093 -1.1395135722626841 0.070415098532229742 0.40657620299050079 0.39857364227450537 -0.19791206561610053;-3.3816557353466683 -0.24086673410238976 0.86306618645735766 -0.05741634632003443 -1.5856907959271958 0.27557805251905459;0.16526621076741399 1.4165326431944265 0.095569140811123748 0.11246703867020889 -0.20427905347414482 0.015233144567726998;-6.4250739842270024 -0.024980578483078858 -0.47075509088023193 0.057301440642160285 4.059342786695388 0.97766668276543311;3.8622075181545905 -1.2793942815333585 0.21591775838543556 0.80409142565152203 -1.3494182289177146 3.2798772459117811;-0.045443223502229096 2.3449762256579518 0.64105553864260711 -0.74952300089946355 0.683499991693305 -0.10185522302063073;0.004134547057340357 1.0467510979225891 -0.093810383835299785 0.16421796352685936 0.19922661531572025 -0.10101019025830807];

% Layer 2
b2 = [-1.2853102440036432;-0.3554901138860021;0.34608615122615904;1.578953598903865;0.62890495990118167;-0.17302054531920957;-0.71870765845469697;-0.9743046684502974;0.41492006939963727;1.1810068187430687;1.7008806685303455;-2.1251031636035003];
LW2_1 = [-0.41035194371696976 0.085305662938926718 0.10804804751592954 -0.5579095170071412 0.10566960508309897 0.53026993264814404 -0.74824371046981319 0.62611655307386482 -0.35764586912885865 -1.4768330391074771 0.64028619026563716 -0.98232891264841893;-0.011655231165980683 -0.073161923645340646 0.36563531825273526 0.056362366427869667 -1.4443525010843634 0.024883143155671944 1.2420359136785033 -0.64083995040336683 -0.17509863017166477 0.053428549416277456 -0.60422282687376017 0.76633794214656648;0.32108205789680094 -0.23687687210075076 0.64121939316396814 0.63806955502914708 -0.41074881811912251 -0.43800964160048661 0.59205675167903826 -0.56210138288633427 0.54832452570255197 1.5091485578381634 -0.38112335090000504 0.55078063441017033;-0.26082648320962804 0.68238566951946922 -1.6549416482811197 1.1209073453860823 -0.9045375726081466 -1.2095733675259748 -0.043419699602978569 -1.0871361145790535 -0.062041145438184515 -0.94203553920476724 0.2256131703807065 -0.76151130940871703;-1.356327504674427 -1.9223232277000351 -0.75466139026468126 -1.3920775359996924 0.63834660280874589 0.12178547118335403 0.33601402352820442 -1.6544030374929204 -0.56187640638601988 -0.04185392751150746 1.0073151213468903 -0.31261599045176769;0.059043974497981357 -1.3070675377234025 -0.59361333116256654 0.36140751774213703 -0.01783602287861941 -0.65863587088519693 0.11268855358954037 -1.286220955885097 0.31512698424066288 -0.57927951472969696 1.0021997344503917 0.98383200077087052;0.036919729092296995 0.58956818791500487 0.32505083719891514 1.3087207060777482 -1.363701356354045 -0.98315221322028268 0.48773284607724554 -1.6458937023543303 -0.023061692459292384 0.49992551364516952 -0.02851455785940565 -0.67921338211281357;-0.01426696104191307 2.2292485423869906 -0.96231640152639841 0.080871042763624446 -0.47086847079791133 1.2848628260028039 1.529989019127298 1.2311985365652476 -0.13107245847180388 -0.7876839995614775 -0.35950311507955174 -0.01003408139160928;-0.27422259150687234 -0.61229309463704462 1.2206329020186568 0.28733616729431383 -2.4949238770667281 -0.24021239372225139 -0.53297239413586472 1.9717794382252813 0.54552796939440196 -0.12292593546322486 0.66944645861017826 -0.24159678741225379;-0.39108833719760616 -1.0497994137196829 -0.48954976178293774 0.47108085354273871 1.1587374513409068 0.16851197958244873 0.61104867461926815 1.003315256488345 -0.29685187364657517 -1.3338380867884267 1.4777787319434528 -1.404022099314165;0.47396061088522262 -1.5256994881404842 0.1732427093321085 0.49247298855236649 -1.9353002493806031 1.4211305121121827 -0.57463523726049504 2.3510324137425487 -0.016162962976863572 1.6545973840490216 -0.40134887665828806 0.56406359524940874;0.5594241689074444 -1.6487128066295751 -0.27136898629492623 -0.7969758716664519 0.80153161769925374 0.47179489146997727 -0.61875880237176617 0.67394552436771293 0.4732305136338078 -2.3057354866739344 1.44720189903773 -0.12166730459578522];

% Layer 3
b3 = -1.3256009277634064;
LW3_2 = [2.1268938305914924 -0.55833719411070293 2.8800558461764623 0.78223784786180794 1.1920619498883338 1.1123555919625616 -1.0777865703176432 0.59059685299658526 -0.37098152008636809 -0.4371950184579908 0.40988472018497779 -2.0718749113143367];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
