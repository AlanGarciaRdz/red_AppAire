function [Y,Xf,Af] = O3vallarta13(X,~,~)
%O3VALLARTA13 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:54.
% 
% [Y] = O3vallarta13(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.12820512820513;24.390243902439;0.02710027100271;0.141843971631206;10.4712041884817];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.3251601165530724;1.2359239651014147;2.2280779814554408;-2.0657354489356727;-0.91239730124492646;0.73908602465667161;1.1742013637820032;-0.1724827768093426;0.12866147241109749;2.7195490214488722;1.0097772014669042;0.91395701309883237;0.51191357356708622;-2.4872543221424932;1.0146738466842822];
  IW1_1 = [-0.27030127544903343 0.23313486635369457 0.89343380928223093 0.63073988681764293 -1.5965769763113711 -0.73385644632149638 -1.0008458926853196;-0.44791519801188329 1.8613327868232366 0.0031904379018550082 -0.20446931476999158 -0.27987633125377653 0.20123222235013993 -0.095672214962772367;0.053818387815581806 2.5994748797539815 0.8474500089708471 -0.39150608308751272 -0.99735260590284625 0.92715980911111739 0.52919430794510391;0.87304818464269329 1.8651945606402818 -0.38493659090716181 -0.65468808520221167 -0.2922791010666731 0.053674039585412447 -1.5863038965809959;0.76985955657527294 0.68928132442697598 0.49987588616082734 0.46061234097146625 -0.19115848644608205 -1.0300580202684932 1.3527488135873238;-0.81192615205219687 1.2583229716928004 0.41702774491596634 1.1473912429737119 -0.1938772950186772 0.19436435914509376 0.47828136766767848;-0.31336234714187727 2.2903989644356479 -0.47873890743032249 -1.3718458447969519 -1.4590886219863068 0.00072501532011799621 1.5667784509972797;1.5386407006555165 0.0049314043985708008 -0.04580064867980764 -0.48639354087994024 -1.2638576532702364 -0.17321777500025975 0.43536086778569372;2.2659510781961076 0.64539501869739535 0.41291613201523597 0.34260879653353771 0.38027212767448987 -0.032397152502668378 1.5181129277340601;1.9955985911457548 -0.29259931343229156 -0.56451045230980679 -0.6068564635404109 0.84646969745963008 0.48181545291660921 1.6746266295179113;1.1852719268192209 2.6132435129854379 -1.2281329630978703 0.68833747024654723 0.68415300950424829 -0.59779508913007817 -1.6976469880703036;-1.2751179614087989 0.032883450314409354 -0.59657017776319077 0.071453112507533861 -0.29873228989709233 -0.40560272911816064 2.7773156953389737;0.32309630001810941 1.6151764025677235 1.1261437436653998 0.16331747137255812 0.59773652199387584 -0.076993067727518696 -0.074972707511972769;-1.4409172904188545 -0.45314286962938288 -0.88091630662388754 0.65850279099884523 -0.70917577212348282 0.67866091650185334 -1.2020363718952105;0.47250942531860768 0.31553728303931172 0.4145464135504448 -1.3664052441840435 1.6455756374760324 0.25482301726711643 -1.1939094082114754];
  
  % Layer 2
  b2 = [1.6818706933488736;-1.3145693222861627;-0.38048440054985444;-1.0696164100438295;-0.7811577459966168;-0.75946987243520658;0.86592875395467794;0.51347067554100245;0.38197299408072083;0.49966369927383242;0.082307904267820073;1.3616120522279516;-2.0034418568247152;-1.3551311391165406;1.3412819639244371];
  LW2_1 = [0.11236423685519614 0.30485816108103403 -0.2032512059496154 1.1017600763763198 0.47923633362419427 0.029565127820368353 0.12957768279171883 -1.1576807660819675 -0.4901938750143337 0.7097762367600523 -0.61842930279582375 0.89895244322762835 -0.41383749282008597 0.53066192989128114 0.61440872156883608;0.49170182665652806 0.27151705037045537 -0.24147061052840774 -0.98918148432738906 0.24982985340296943 -0.11178739625721133 1.2867524611596377 -0.47954605112406629 1.1280736850672521 0.053253406778800694 -0.31361228360442478 -1.4665305490767462 -0.0015474773148544882 0.18758868690084257 -0.32652041501825191;1.5174088350203554 1.2561514797462452 0.66273963921886125 0.44343121911938155 -0.37455555675493218 1.5186963270408078 -1.1749361895903887 1.1206903883895958 0.14134007107733632 -0.56168362656575588 -1.2935797893699079 0.27029995425636744 -1.3717333924982424 0.035780637787315557 0.085755675801607645;0.882910231043186 -0.74099161149694814 -0.35845064177038943 0.14087870764678409 0.49792219216305839 -0.46044071655500424 0.89478787178691799 -0.89228886764558446 1.2545211144416744 0.62704826961185967 -0.039519393111785817 -1.3745923148274313 -0.37603802111012435 0.63431543360911757 -0.98541017633745664;0.4105675559232535 -0.39294901046843717 -0.46048002645572939 -0.2708922358054352 -0.010471258890320845 -0.9348045270405142 0.43841607830336643 -0.20787459340766437 -0.045376334743618602 0.65502895405365735 0.74530658487580725 -0.13367812251456121 1.0520898807903334 -0.031556967857337699 -1.1623075200572566;0.41000017624546314 0.22309547368325333 0.16568508273007043 -0.66646725827153541 0.13263165272111191 1.2675418793241771 0.29194395991720684 -0.28203579276105201 -0.64584031260898955 -1.0063655616493801 0.034799969530324833 -0.29631051030164257 -1.1786632404532187 -0.47858189128511763 0.1149431875251979;0.14642316393334665 -0.13349244101853114 0.81994686372098347 0.22546269120208767 -0.075882181168468815 -0.74398921185066047 0.087833189815590726 0.14861901628069299 0.088770759051177886 0.64521575062232417 -0.16750736234087488 -0.92754182304957955 -0.25739947375147471 0.052748204084287681 -0.043075538362917117;0.89040535542804966 1.1653138398025034 -0.98730611850210437 0.75020258382917782 0.68188728687530265 0.41512083583536924 -0.19789524514045242 0.88910239547845804 -0.11576138706527953 0.97255977341961797 0.25214811774981599 -0.59611127881373671 1.1095120249301695 0.51573725492905953 -0.36564872132802601;0.32038360873728894 -0.30603985956991286 0.26961422269889357 -0.3248197485224783 -0.31234208634817417 -0.34218368817942979 1.0308932527973844 1.3934613693201201 -0.39989921485319058 0.860110019776957 -0.028101500924589479 -1.7857059960922224 -0.23772962177810161 0.27403559857701593 0.67256529727997316;0.5695075890928033 -1.2476903130615078 1.4877206660907956 0.033825593378636228 -0.44429346169724038 0.61331454890566772 0.56593266981011281 -0.49549126691235001 0.1610601413253131 1.1715721139188495 -0.013112996777376595 -0.71752391428954021 0.293514487541504 0.64163360937921399 0.57846548880643489;0.12111465203758416 -0.3652220277989161 -0.10623754515436497 -0.62940475082889058 0.49131345481735111 -0.28331761862559923 -0.25009688279741416 0.250349030237355 0.66327168069495435 -1.4830585202106288 0.58810516565465409 -1.3615493759632138 -0.22321980586004905 -0.3012006197414257 -0.85635469052157631;0.6413980206200991 0.79818059303812727 0.69505849252835905 -1.0906244746787439 -0.075132178646506786 0.51090604825846542 -0.90002461770727682 0.85222258603255652 0.90184180598641028 0.71437210183137478 0.16098649570907095 1.61423935962714 -0.082210902958612858 -0.5150442900147717 -0.97118853233207758;-1.0639193654377599 0.24341758721368503 -1.0823326759439811 1.1318025486931611 -0.52740154642372938 -0.71032931454649206 0.36373224188055137 -1.4449396684987408 1.0652372352142931 -0.15138812397552434 1.7582275864277543 -0.14719918062046433 -1.0294277725272531 0.45450515252438384 0.54862150029350587;0.66184041627150147 0.26678718814111019 0.49962611458380279 -0.86629644522361238 0.11763134339671931 1.1059495996103408 0.33321311895316963 -0.52198036494455702 -0.42254366437666835 -0.73494649387744959 -0.39418678146284697 -0.021977939475066981 -1.1217443227213946 -0.76594419707499872 -0.22108825774235275;0.12449847186176777 -0.032449232387811652 0.93981163414682323 -0.72052752004015352 0.0097971960433702061 0.20830314215099699 -0.71213980565448165 0.75880717825189992 0.92556603934548454 0.81216759959273699 0.27495684740279319 1.8489519430762946 0.088885445485464176 -0.37759396877819762 -0.26342320178238665];
  
  % Layer 3
  b3 = -0.80417126882192913;
  LW3_2 = [-1.3813814656251151 -0.99774435043307697 -0.76925036229208876 1.6827098495789985 -1.1684637785027796 -0.82586560289772581 2.1210728877458798 0.64029933510873827 -1.0293185521927353 -0.75229739813782548 -1.4291204164418079 1.3668064671717521 -0.42722496599451781 1.5390174570370907 -1.2882847396520551];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.4712041884817;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
