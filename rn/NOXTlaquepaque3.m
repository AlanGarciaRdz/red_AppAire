function [Y,Xf,Af] = NOXTlaquepaque3(X,~,~)
%NOXTLAQUEPAQUE3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:16.
% 
% [Y] = NOXTlaquepaque3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;3.03490136570561;19.6078431372549;0.0212539851222104;0.0523560209424084;0.00632111251580278;0.294117647058824];
x1_step1_ymin = -1;

% Layer 1
b1 = [7.1711526480590022;2.4657218071320308;0.95822632722122192;0.21773183840464919;2.5758895307275242;1.1753081922983608;-0.63023068732613075;-3.2669632518442162;0.22489754906779424;1.8050816975973381;-2.4884631245754925;0.22164481061838387;1.6002433041796305;-3.4604048270332539];
IW1_1 = [-7.1778842875026152 1.3078267545636788 0.02577195888845496 -0.75320235508129041 0.66162300442660593 0.72128135218208766 0.18247935358320022 -0.41645714136519313;-0.036272632949228091 -2.8839424047271418 -0.9512155761665203 -0.65749377474639692 2.169188253859633 -0.15310809271457226 0.27206628496702573 0.59329858394209045;-1.5679709657865661 -2.7592804922342977 0.12152233661643366 0.6702424211893272 -0.015066890422923052 0.79717407315911759 0.055360940791438461 0.042851303845941394;0.12527067799345298 -3.2372478939115945 -0.33815756796604701 -1.8256243187190917 0.220607652042873 3.3511048037346507 0.06524332658897658 0.1633139965046784;-1.4361018101385972 -1.253786415764039 0.77984014451786232 -0.99297974291348001 -1.1699834574153725 1.2802462035856492 0.030572336331230979 0.54705655754346827;-2.7895859039756981 2.7822072644610873 -0.66631947722434937 0.9439003992390731 -0.54863260151796145 -0.53242072605006452 -0.42715399098590068 1.1371154716040717;0.74265109323592138 -1.0864149618575172 1.6141171711626827 1.9100766914990455 0.78651189279222244 -2.3079026806789922 0.19284881145155866 -1.3579080194246063;-0.64515903723259205 -3.6148141935861227 -0.29595083934883187 -0.37362559766563613 0.15134670667436706 -1.6806435270550359 0.06045985690541248 0.090189655429331411;-0.13008781969861316 -1.7868670868288665 0.46048052356800973 0.29279141901382205 0.019034210158648708 1.9375998425093879 -0.11837473868147981 -0.16280680930581901;-0.6439116070936266 2.2250764529810305 0.58643805808722105 0.97691410781416488 1.1481820783641539 1.9284037349208556 0.12377113884561339 -0.87061036364299893;-0.83428939833279958 1.5784818310532747 1.0139487097711801 -0.037126825837531699 0.42286208840989958 2.2004977261979977 0.21019353558614468 -0.38801222040601158;-2.4225534328194449 -0.51941568577327613 0.28945263018697759 -0.12022367320752939 -0.36428058414337278 -1.1470765037690291 0.10859710935649113 -1.211263576088913;2.0583640474317697 -0.61378926267108502 -1.5772782663591831 0.56410279847604894 0.010668642008510802 -1.8025386616629591 -0.058066471463923755 0.74596391351689662;-3.2099073463531154 0.10786602954935924 -1.5183961276681908 0.87610923057138423 0.1441879548296516 -0.40005957582549168 -0.02471264567440868 1.4513954736283465];

% Layer 2
b2 = [-3.5745552440633745;-0.50107553699748264;-2.3624156416251858;0.79124777426912096;1.1890240641217134;-1.0013335691858249;-1.6591222572584003;-1.1892362909215077;0.43473275637230996;0.87367707683671503;-2.4029652712647609;-1.5674354984922898;1.2517208818793206;2.0185914435265349];
LW2_1 = [1.3579628243353934 -2.1054683362702744 -2.5791328819622272 0.80288116787992703 1.2596586155810059 -0.17313923165630335 0.57287477064080294 2.0451434759061509 0.085268677412444704 -0.67110052215773119 0.30869953960889152 -0.63561901171767876 2.1304350869807358 1.4550201518286876;-1.3466083269556051 0.92606660465185542 0.32378262972703076 0.31915278562884547 -0.10256737809317149 1.2347733172711517 -0.67917488551857896 0.98844733723775968 -0.65683908381785439 -0.77124966023451114 -2.0128322615122016 -0.0085981636001050583 -0.48524689881445066 -1.0045405494872344;-0.74454766277944451 -0.21720230084658165 1.7130618259864867 -1.000442312248599 -2.3228394620135342 -0.057546101459936438 -0.38474637617969232 -0.1743527276732767 -1.5078110010350885 0.15275732371375414 -1.3725350407707135 -0.3649135429948166 -3.4328686096427283 0.45485892095727654;-0.28910516247482265 1.0250460554486294 0.77103664143131589 -1.2089017270684395 0.26017833936408596 0.92657995598377396 0.51831908180246233 0.30166750518820939 1.1127373598882371 0.080336319196271821 -0.93881266100203364 -0.26438443157179142 -0.18697302162878218 -0.42202233536000855;0.61211831006764195 0.631000966810213 0.15307387813449982 -0.64887994775358915 0.50171846418577959 0.25514896430330186 0.44692726327591159 -1.3579105899619917 1.3463472705516986 -1.1998372071539429 -0.47986933168559276 0.018528983254249388 0.098292570439891355 1.4412796358890054;0.83978580717603479 -0.77591552161842103 0.10356629020662814 0.16600614313507572 -0.94952675747130222 0.14924141562104198 -0.94966277769056062 0.56314076762157794 -1.3207468325830078 0.5259605966199703 1.2428983886947431 -0.092519318864239822 0.28006286253153584 -0.10397792614611555;1.9002701917371994 0.55784063709744403 -0.10388280973346235 0.19711844108921373 0.60771575440415859 -0.18760771492759379 -0.75490664013254127 -0.011995412477474203 -0.59019179113230069 0.77203874352157409 -0.41457069574447047 -0.68242360185482964 0.60649597390262666 -0.12986005846806908;-1.470944112765838 1.2630345543632784 0.10724602946862191 1.1385005408680744 -0.094917509178032808 -0.047464886512498264 0.50219714376778379 1.4761840596544631 -1.3270075900328471 1.2566541962507205 0.024797202371508859 -0.53305541953212621 -0.63990562381494132 0.79202365352285031;-2.5054740868863479 0.058268459402109389 -0.33590112280439671 0.11146615620591649 -0.28359547392876772 -0.32515840091922882 0.50045062727453793 -0.076894947826518373 0.29058670344875737 0.72986910467437904 0.27761645752033803 0.49053222959888854 -0.13711970520932765 -0.96124158037748753;0.98086705137331176 0.12516194436625694 0.3625382570757133 0.52985671926131306 0.04207407982259611 -0.34802566855098616 -1.1362800298192153 0.5183119105371955 -1.0638097937982713 0.76862008176173469 -0.035375409687623385 -1.0093584967996683 0.93264344812486344 0.22951405038312517;0.1953890239054539 3.0776306132393381 0.47440179715515624 -0.80507315621886788 -0.25521068759844495 0.3348967480552692 -0.14169618594243957 0.25499324437855797 -1.5460799990214003 -2.2403534506098519 2.3797568060911671 0.7302776028016762 1.2865101248785999 1.5631791913222726;-0.081287521497222681 -0.77146220123297182 0.60376798262093501 1.1419898265087234 0.50768044054432782 0.36969170323318068 -0.039931105327183553 -1.6497238283654523 -1.6915660873533906 0.54146476656994724 -0.3600654311943341 0.26987202392582471 0.26167711749214495 0.9839163482275779;1.2838445562291902 0.32551125192486752 -0.21985881850021183 -0.90830733778229589 -0.35640131014989967 -0.50017135664817036 -0.19392633312488741 1.3343946654937917 1.5919449894520332 0.048627037803470705 1.3228143614474339 -0.59425214392059622 0.25141667796369743 0.36595502719931705;1.0308345770222502 -0.010474331865501521 0.17571197875819325 -0.89222247522947773 -1.1282110996370724 0.14500319483856663 -1.2736036128600714 -0.70398681011021491 0.21008670438197 -1.4862952243729504 -0.72367721159863052 -0.2536759491919553 0.52386402661826215 -0.092795178435921472];

% Layer 3
b3 = 1.4654515923065541;
LW3_2 = [2.5351562235885172 -0.36664654016134851 1.1455678094682105 0.38111975435180134 -0.89621932478355992 -0.60912274364450048 -1.6802551884821662 -1.2862496881504017 -1.2192848489197727 1.3897556690416906 -0.49906979850917949 -0.75555369529596539 -0.8272383248107239 -1.1425686899029952];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
