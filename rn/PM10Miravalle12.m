function [Y,Xf,Af] = PM10Miravalle12(X,~,~)
%PM10MIRAVALLE12 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:17.
% 
% [Y] = PM10Miravalle12(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.5870085413958419;0.49813119121919797;1.9559317266309164;-2.2765233788710022;-2.0570779731352054;-1.4546056821490314;-0.39883085696333476;0.62324259106727553;-0.19566727517003546;-1.2568162462659453;-1.7473014134335449;-3.6313011588350057;-1.7405518771377682;-2.6600739969160809];
IW1_1 = [-0.32209016155987302 2.1946775157383476 -0.31306768583382166 0.18315626696832063 -0.1336784694858815 0.041151634203685623;-0.68831334951414402 0.1244198970870215 -0.19346348042131201 2.0333650342359739 2.344355786402883 0.13246172932970768;-1.4112696215206739 -1.4410770910572916 -0.41057743521823653 0.90248033369681591 -0.31005888894874545 -0.010839470082440331;2.4509662721879448 0.31210918198174764 0.53258906306736653 1.6341569343682312 0.057896820880382741 0.56902730827187098;1.2859322989127366 -0.24058727582967976 -3.289055731573356 1.6445670479566894 0.51482119579331376 1.0596180142022609;1.7331739608467527 -1.7919857173719109 0.67137824537289348 0.18571784941563346 0.9698041503560908 -0.83640218917818432;1.2683845197356309 0.67112045544710142 -0.43698504255723042 0.2808683951739977 0.28312206078713009 0.6069108557229691;0.81381578365942919 -0.29818750597121618 -1.3881123297336926 -0.96281826365365608 -2.1520547671298953 2.4622077190811784;-0.76863901775280241 0.3705240729851747 0.56811401617291779 -0.4414362176112977 -1.1161280910001825 -1.0090882871016671;-2.0108164614784068 0.87081069039915748 0.16935073947175153 0.82473105924930068 1.2380898257596837 -0.0587557717401095;-0.90077870062613019 -0.99870994404561753 -1.8103604767819133 -0.15964809339291514 -2.7000210537604055 1.2748205867490257;-3.5702357390556991 -0.25312017724769836 0.89651217360878055 -2.3237181659498942 -2.0586434944492615 0.061760082745659584;-0.90168030778711994 1.4096077608552693 0.44401371330227268 0.63385042466259256 -0.63561901425887746 0.87568880581296016;-1.0417066921123377 2.1042272290380541 0.61489108202788156 -1.8099193546245491 -1.6382242682041941 0.017005255499606603];

% Layer 2
b2 = [1.1832802125664041;2.3177515842247778;0.013018568899850536;-1.7897362524286065;-1.8007651197699595;-2.0535631421149101;-0.59513144283041508;0.11548540284516776;-0.26618459209232131;-1.198465499980123;-1.6714544281160428;-1.5657584342806246;3.5585559323398437;-0.64927232053452955];
LW2_1 = [-0.67248568846619705 0.032783537750866135 -0.86188201830271871 0.60644400146440203 0.395003515373408 -1.9011887568625119 0.59879608456811539 0.068846125914403491 1.0172453374948738 0.1871590794611116 -0.047592682134384029 0.083798285432525293 -0.17311247421414461 -0.31792244667701175;-0.40996851724670091 0.029845323565352883 -0.77322371209881102 0.39852369523103448 -0.030908885678272796 -0.39494712833900963 -0.49539768020097757 -0.17641136736015364 -1.4132709759102515 0.94842366012377355 0.67797130315317289 -0.34641154401992602 -0.22563593232422233 -0.090238976224478101;1.1987665494798736 0.34919180367357489 0.24262768370016372 -0.71269781781059827 0.001445936493153957 2.1489844272014995 -0.59720098045851633 0.054884912989124991 -0.78823624971813777 1.813679871157837 0.8465496179179175 1.9185023981286176 -1.3520978816213229 -0.80716708893590705;1.3205036052237258 0.3782168841132813 0.15907913995828216 -0.93955016893727517 -0.033286410629637969 0.069679850231563381 1.6501043521678531 0.11285423500926474 2.0785462776286128 -1.8698404068145118 -0.76730005110885269 -0.47400980171843243 1.4522264574759589 0.49311531426080857;-0.063016667521394704 2.0668060598748981 0.61927498483780397 1.7985519642699836 0.14668069778554993 -1.2892524270934795 -1.4442934133780185 1.0778474347243339 0.43913920810329843 1.6346125071100439 1.0257558031765057 -0.27609617570073941 -0.4949174719663309 2.0058569000785784;-1.6966022328360812 3.2977734375185235 2.2354960120723022 -1.927961178989904 -0.94939117723585753 -0.84893217365348439 3.3136355730677622 -0.062511124470216312 2.3343940034060795 0.17926981204324036 -0.018084460434932295 0.28839489808108765 -0.25036016418453633 -1.6217386517095838;0.14723294006056661 0.94432025555952503 1.2757151035727754 -0.42439789875517708 -0.52951140167079602 1.3689832536651758 0.40457036816209069 -0.27290697453196733 0.022914753752612926 -1.2160979530996905 -0.82987565750050984 1.4089408003592845 0.13728033314838278 -1.0801791760197073;0.041072131927870598 -1.3995901935237123 -0.46942648788903985 0.21122639124093287 0.975884773395713 -1.1363084626902433 -0.39648785023926786 -0.99086980622717047 -1.0620275322244581 -1.045038135387899 -0.51522538816457031 -0.61395657964090833 2.0138132511356583 -1.3748229716752545;-1.1313688249857285 -0.47238746821724875 0.57316921802199194 1.4182370224844598 -1.4881312624359277 -0.49207277259292342 -0.60671882510463859 1.1205878143325607 0.86387007654723458 -0.23839223888523711 -1.223478157311626 -2.364910490943914 0.11234603904609716 -0.13758871406577405;0.66719353829917216 -0.9818918138987941 -1.2092972930093657 0.42226976528231602 -0.15496758122419024 -1.5319283219092257 0.099949756871230477 0.82169730800494134 -0.50655847973231227 1.1784325001554852 0.60810334051216064 -2.2120113992718848 -0.37591090327024024 1.4814599043363081;-1.0406708010298054 0.30833473566154934 2.1437936934291981 0.69349091309406552 1.1156180411616499 -0.12953302170257994 -1.2209175993789152 -0.96135659488300185 1.3376605777619772 -1.26935302306422 -1.1018636704517366 -1.0139176219170385 0.52357911187183082 -0.53576982657606043;-1.1382288328473089 3.7973157396555339 -2.5434834131551192 0.41410803170914356 -0.39225249445481075 -3.622962548705027 -0.34569994720733782 -0.6873679843887156 0.68626825260210722 0.49766280694075393 0.38931883419472629 0.33914422459331472 -2.0811312662224064 2.3871145214495582;0.57787818767165477 -4.2965822692663043 2.2395281463016565 1.6893381442212818 0.36853829134673333 1.9152226385702851 0.58029153033901371 -1.4962725461041138 -0.70552625918751577 -1.0859848353131822 -0.56585339461672568 -2.1600611036717905 1.0320508994186868 -0.60597714652647028;-0.98999580789101438 -0.36400818861274259 0.63934194305961423 1.5202651533719105 -1.5996897448461991 -0.56142407028425234 -0.71847523021803872 1.0787214102805427 0.82323740201393403 -0.21916411568452743 -1.3470249503205889 -2.5223408363738131 0.097371154170933283 -0.13198884875830699];

% Layer 3
b3 = -0.37150949891728952;
LW3_2 = [-0.30008484866752733 -0.54935759263212725 -0.32920916401877426 -0.23136211936584761 -0.26928762567246234 0.22353275163150729 -0.37399384444241579 0.20922616066706148 0.9898589488496411 -0.28027218448062052 -0.12246919793461679 0.10463846064624102 -0.29748746968297846 -0.8919083632858118];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
