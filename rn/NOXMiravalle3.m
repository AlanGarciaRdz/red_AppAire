function [Y,Xf,Af] = NOXMiravalle3(X,~,~)
%NOXMIRAVALLE3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:26.
% 
% [Y] = NOXMiravalle3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;2.48447204968944;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206;5.12820512820513;4.16666666666667];
x1_step1_ymin = -1;

% Layer 1
b1 = [-3.9834928882796041;1.4398443881463938;3.0469677813449452;-1.4667866582424582;-0.83671712178780722;0.0043688150459961512;-0.14390162764796519;0.93383251562656244;0.56824765506265951;0.1164323193151548;-0.89282835365673019;-0.18848557050520537;-0.28379960896880946;2.707810719565289;-0.66914471578011214];
IW1_1 = [-0.91002059210452768 3.1049643511884368 0.20777916575405619 -0.53590180429115686 -2.5771121581093093 -1.7902621587678003 -0.36701502354300064 -0.320338833084514 0.43124752080379791 -1.1403898717170093;-1.0782205869985457 1.9888762348764772 -0.063149924276857727 -0.20129293600054896 -0.22604289118942633 -0.51222253722065836 -0.18254720654580756 0.34495579709578827 -0.33856567191169434 -0.19014173057185263;-1.5943566443373347 1.0291650858050301 -0.014284153206348852 1.2691073093880689 -0.22477702173862324 -0.19347430776845476 -0.75135335403003178 1.1076976530155451 -1.1009566074436801 -0.91848182654411759;1.1573496887086729 3.8735784845354115 0.97131120809538896 0.79819820131007546 0.19093601617196412 1.3885744009589438 -0.089607293021285311 0.16712980849430242 -0.70368333217319179 0.18825565528676289;0.21226104793945777 1.7236260405860098 -0.25951601734053836 -1.3522782192089347 -0.42973460409111958 -0.65318709054780388 -0.096102444431756473 0.057301270390636795 -0.070667085502189711 -0.072348958331314453;0.3027758693135072 1.2759998228240055 -0.55094629743038026 -0.79876048585751513 1.0500454755247528 -0.0067224121315648108 0.16272033277043368 -0.5436571974907678 -0.045603559944638224 0.52782836311449288;-0.42608656078594098 -0.58676985245081947 0.21465783547068351 1.1342808443346752 0.55930980163654365 1.4063968393449917 0.16469209930729684 -0.083875515397671074 -0.51166091473033348 0.061929718864862163;-0.68593286382287055 0.19412319935375524 0.83753137674720546 -0.63299675152538437 -0.063211321463191111 0.99198003583455974 0.47741398384413952 -0.2203149290485969 1.1546804334740126 0.1973090130805841;0.012726114352749071 1.1149945331747011 0.26111685255761891 -0.22801801647360245 -0.13565946632700404 -0.31042647078272906 -0.0120643839930227 0.094308236301407 0.13630037247025842 0.15632025115073986;1.0888333520237763 0.27397571936022413 -0.88992917045761721 -0.58615880582570534 0.96172613084172642 1.9688099608010876 1.614395859411633 -0.11951134538176539 0.80839209176012461 -0.537994392997035;0.21584363621511157 -2.5120523504459449 -0.77873239119894089 0.66821619956980771 -0.20560692300965375 0.25715047923270068 -0.20583730588025947 0.23588088915138627 -0.58562046292079972 -0.30873703979670908;-0.86145042843901043 -1.4260256333351382 1.3441049783502983 1.5658086875393888 -0.25751321481706846 0.39591047930999612 -0.79981799359186923 -0.030526966093494066 -0.70929668453517036 0.10593007655795389;-0.78843181646062666 -0.25640356376665818 0.15534178414768138 1.3702014992532545 0.4211190650404717 -0.917421618745075 0.094794259865779606 0.34684348632805445 -0.55829003287411327 0.31181936276653272;-0.28656883325874466 -3.8057031913699797 0.84305312429678136 0.043960752727222212 -0.31413981788972023 0.48926057770931963 0.13474034091209369 -0.20943853454857317 0.58278036727498728 -0.37146353726126158;-3.3573483106147837 1.365464747196621 1.4042451718116853 0.55608017375694851 -1.1133965338209122 0.75006391182227916 -2.4687466921452477 0.12674978644234572 -0.14874243688818278 1.3079952312328591];

% Layer 2
b2 = [-1.8654681724974571;3.8934542685463613;-1.7047061188227901;1.7016638959163726;0.69193206510743088;1.5016719471410309;0.36412892048801593;1.6902021209723563;-0.96710454257419942;-1.7081561224167043;-0.18654068096164958;-1.3016847095962008;1.3330501127758059;1.5760326970631611;-2.290396713688422];
LW2_1 = [-0.39645281514091296 -1.8443435391364655 0.79944647912530631 0.0024623575047011126 0.77088071490076682 0.69929858553388491 0.16953500622514681 -0.4079466297353313 1.9552861744203363 -0.12508036069103173 0.74741896810458164 0.078708444796934257 0.89210980750670199 0.11275912389874071 0.011512449614767602;1.9297644745353693 -0.32548140265820141 0.053228380780048538 -2.8574744887103893 -1.1055759381734089 0.99736690051549426 0.61995343399875902 0.23330150333573052 -0.088940406072992015 1.4950995583047153 0.89819470438847171 -0.97880273396901407 -1.0910156131392006 -1.5824471694620565 1.1482109173260122;0.91880171893319773 -0.9641235336997257 -2.0389904940893331 -0.052351036193471839 0.31838148808719474 -0.47303553658581771 -1.0767941791107918 0.33474006936665113 -1.0420019862432133 -0.75626150509255696 -3.4617483631571679 0.16243573959766849 1.0800226935736332 -0.21809344403180861 0.069180601323120441;0.47624521542325415 1.1595894986068651 -0.21143087821306439 -1.4834686675950022 0.095806051671764841 -0.98975269926305054 0.9006539221365446 -0.80292463313416018 -0.85304515277497217 -0.20609763864320765 -1.070056127036273 -0.92936091088302597 -0.35947395802101945 -0.90801593292009652 -0.37259647737801044;0.27932507940540519 0.15736535302426519 0.98858924636356671 -2.1681668944440955 -0.023538683101472099 0.3128163776207003 -0.70927564356862871 -0.032350533209675875 -0.55677691594654466 1.2650088029591042 0.17994229625103508 0.64652887360428468 -0.014527852591740026 1.282083151635951 -1.1398927761994722;-0.84710775619188494 0.62063611831250531 -1.0695446856225637 0.11878309664828227 -0.39679918348168919 0.12278637858926424 -1.0692549071136366 0.2777148475734359 -2.0140595770826977 0.46498400304300913 -0.63332461053524325 -0.15245681657173277 0.55091248210362653 0.79382247134654582 0.46860695797363844;0.11755972329871775 0.64084683169606982 0.63946512344595785 0.76977251795925261 2.199800569811968 0.31413215565359631 1.8431310419318705 -1.3644875885628631 1.3667976020640096 0.53150153640651787 -1.4776182288903996 -0.12614415654197944 -1.1626935197223764 1.2465889364533087 0.33752538062613596;-0.67683876483737937 1.8967879362983791 1.146790747870041 0.97865888233249443 -1.3989396689647382 0.14219808462652977 -1.3711182491972436 -0.32924826278862374 -1.4858746033464163 0.090166257937352307 3.1090494061007634 -0.12042294414429602 -1.4865848517901046 -0.44727431287253538 -0.26227783297137119;-1.2036650950300549 -1.3096586998594286 0.47963534389997237 1.469928181968583 1.5800881392307953 -0.38291628681400158 -0.93802683179157431 0.26671737649175326 -1.2019654916913667 0.074828473932691209 1.9115766375259704 0.12260065327489786 1.0472700511916366 -0.8680647121328896 0.23516141970666271;-1.1019006517304248 0.4503743663370906 -1.0387113984161562 -0.21401235514612221 0.70619396747060881 0.43260997565103632 -0.6656600125182669 1.2705910133538649 -0.54891617242646373 -0.078119421936572481 1.7157433071727104 0.25036192298805426 0.47741922005012294 -0.84711995772706494 -0.060333074843468198;0.70146739438890215 -2.4884447571453947 0.93284955686137661 0.2920036927971853 0.2915275146140982 0.42787318061692897 0.2918433363500369 -0.77192211447198633 3.6763851027074299 0.083714756899796849 1.1997251076048694 -0.52596575705323945 1.0066419215396838 -0.15355349400432836 -0.54696911310370355;1.3748504883681798 -0.28781587363760908 -0.28909969351069359 0.36777660177451793 3.7728882885099893 -3.2015274105019969 3.601991666792864 2.0418801369464976 -0.32180152429467135 -0.79242159685992364 1.2966877502709775 0.14112193502183173 -0.63189274345572799 -1.072918080020445 -0.19583959395251674;-0.31530354346793082 -1.0633200260733233 1.5464220998976352 -0.071420986223142996 -0.1116379499808674 -0.60043119223190444 0.26868234159820353 -1.4893910537145556 -0.62657898971979731 0.30207220433906862 -2.1871862299977609 -0.099020121898927949 -0.044186730934912745 -0.41181014538298588 0.33555062263046698;0.010766885123770883 -0.48231285391802436 -0.80827065622973682 0.78994280359795588 -2.2573919847013637 -0.40741085501656821 -1.8584368551648738 1.2398503656532571 -2.3225423753279211 -0.51220166891536933 1.1993268473199927 -0.095761181368217166 1.0293298833242706 -1.9375294297788404 -0.19186843342159909;-0.008487549579730469 -2.8032801350018213 1.5293135668271596 -0.17020549448287028 1.0965771877796191 0.35241823144605167 -1.4327639837901363 0.66594671390909077 0.93094371812915633 -0.69944313382246792 0.96447835145034 0.057571080498779681 0.09722130895186909 -0.45429384243359144 -0.27928065793649021];

% Layer 3
b3 = -0.39446260020047275;
LW3_2 = [-3.0995057856022386 -1.9225374879555734 -1.4051534532116055 1.2772571205967089 -0.16434871200507403 0.69665129100333634 -2.5940353036284853 -1.3358599763210341 -1.3230056993421986 1.429879098116601 0.54542165189353575 2.6750600666205839 0.70799015751960603 -2.5814161971567011 0.90175258389490087];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
