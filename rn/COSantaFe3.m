function [Y,Xf,Af] = COSantaFe3(X,~,~)
%COSANTAFE3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:05.
% 
% [Y] = COSantaFe3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;10.752688172043;0.00341273633199099;27.7777777777778;0.00632111251580278;0.294117647058824;0.448430493273543;166.666666666667;95.2380952380952];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.7262081855249471;-0.89949930831875136;0.4465809346455375;-0.50547137679699794;0.017838489113557086;0.071753840397170462;0.78432697691380793;-0.56481378793745063;0.83773390120300795;2.6808779745891087;-0.36975375939432059;-1.4547858934863656];
IW1_1 = [-0.24732186537308271 0.50112552461023985 0.42199649253575322 -0.24422941128130976 0.24886111362981242 0.37105356963205954 -0.25708771477718495 -0.39625305636033636 0.21333582432453604 1.7267489621633085 -0.17432568303418008 -0.013675283489502655;0.12674619405047113 -3.5123919979048224 0.29081661741651588 0.34384676280171778 -0.092859834614505962 -0.17411921591555365 -0.017646419433867362 -0.073942149220582287 0.27373247391268113 0.36525415508196524 0.16402848024171987 0.04472939681892403;-0.80378020830829022 0.021817922874135691 0.13519884202256713 0.034758766055446845 -0.43002971946762775 -0.5532579539250978 -0.7520185126268315 -0.088525615470378863 0.4233338443268706 0.025375239103563586 -0.33176249176881395 -0.092456224344902679;0.081211590254241892 -4.9265194396273975 0.40212942042805044 0.36715563758192865 -0.06893066561569984 -0.19810811679720822 -0.054241102402572718 -0.083037575621044704 0.35124716478108553 0.53192841472422325 0.17284643528314311 0.035187550110938243;0.084083927195926028 -0.5045048506457479 0.48284689117464191 -0.53020681046159879 0.11541597701401278 0.30336362880002538 0.12345912850427239 -0.13933430561241603 0.047465744569949786 -0.43259324932778942 -0.11089807672118321 0.025852343263457086;1.0003050659107442 0.60205068436299614 -0.053443304407160323 -0.14883705040896072 0.46668086949947701 0.61283637294829407 0.87399539257894487 0.10499883494409351 -0.30790110423111799 -0.017339117299614598 0.25965519407948207 -0.024213068196718389;0.34639399523156428 2.0617235002070289 -1.1635157087456627 1.2984942830739776 -0.71207377336429289 -0.28853124138774278 0.31451748585594236 -0.063746717992688787 0.096595690559790684 -0.27883597360874801 0.24191423065594131 0.15939339167294955;1.92463550454898 -1.0460752726997136 1.1648569833280404 -0.88067836326524873 0.48613625124132648 0.4636490890771886 0.20610923691593172 0.010286887529186824 -0.62288942151441795 -0.80854759346055372 -0.40787986574425056 0.17944653503306235;3.1217870200637114 1.9130094261392327 0.28722040203766014 -0.58231796026439475 -0.81982578682958451 0.011083544141667873 0.33106729606487911 0.0041232093910374456 -1.1549624492174171 -0.293755395287145 0.070239058061052254 0.074030975422133313;-0.0004013121221729584 0.43926366642506165 0.11125283712414731 1.1270104322760597 0.45504489163710865 -0.34031151163015116 -0.64312889914468385 1.4706923805344601 -0.026687243419901141 0.31591171583819089 -0.3596460102071134 -0.0092448935689663468;-0.42942837650869636 1.3398519442747689 -0.19349632750926118 0.24972958278035506 -0.038461135675998868 0.037954862963041666 -0.10342270827772318 -0.086075441252222509 0.19599581527556401 -0.38489674998710477 0.0019056986582320174 0.0092412053123171554;-0.22849151443616408 -0.89907618539750611 -0.055761948428208627 -0.23724154886708859 0.21558350172353696 -0.13426978130133732 -0.10258363323385782 0.22675341408155458 -0.3077416271081449 0.63988760978787773 -0.058756567039733941 -0.089127402681554752];

% Layer 2
b2 = [-0.70292677956937244;-3.2029929706737077;1.3228704712414239;1.283753617933634;2.4620303190816935;-0.80415289114400823;0.75951556477014359;-1.4821350273989535;1.0303396791958761;0.7212632700264372;-2.6789094827302118;-0.65794222508055733];
LW2_1 = [-0.35726300147157647 -0.93539341053634062 -0.95950160010569863 -0.40673190292093642 -2.2865353344673718 -0.82110573740536208 -2.2518279962857646 -0.0005644261142064913 0.42530242986798239 -0.12395623561071301 -0.17551911999825684 -0.88074578200950437;-1.2272314727926936 -3.6169646873639745 -1.8583443479488904 2.0532002683104973 2.0494556691624508 -0.58391971520756591 1.1980977977014622 -0.67849894654218279 -0.089304109101118856 2.1957289457325349 0.17819941071384082 -0.93738062984845072;-0.11042503296304587 1.1629050474315865 0.27459450991343315 0.91723142969951466 -0.84557107848355439 0.67576476966183852 -0.70346395160792652 0.10084760337829632 0.46228656743925312 0.44444278248238744 1.4369378892018119 -0.3007428053123461;0.10075841260565566 -1.5246714132853869 1.7424569969084274 0.24021589466732288 -1.1616407947278025 2.2551357133931762 -0.60969053156699227 0.29349563878463469 0.7906896745250328 0.37760839263790041 2.5664529773849094 -0.035801066364597463;0.20215455692441822 2.2031880942946915 -0.39267447009160894 -1.1929687484305505 -1.7887627264693229 0.17644469131652257 0.17282674969175119 1.0944254554834614 -0.62301152008176353 0.90746523232600973 0.42558499392621013 -0.92939019469367889;0.71335659853044775 0.97898666190334116 0.32980925929616667 -0.072882314669344847 -0.084737818099363427 0.46516050093725192 0.73426653913194528 0.10465089879839481 -0.069574565976059488 0.87664654571997858 -0.9826393686624223 -0.39727150641974324;-0.19251714068811854 2.1823672214364431 0.50731754599584167 -2.3363001873921569 1.5025306107263585 -0.37563729918683225 0.6132041956602392 -0.43391459636346674 -0.7104621577675897 -0.38894011947671048 -2.1271649053578274 0.64456467283858776;1.0306554921077911 -0.4893243716191536 -0.31088538860078629 -1.7100412681121571 3.0526666016556168 -0.28446101354982839 1.5658226013039669 -0.54539877247502799 -3.4125779760937078 0.60810033334026681 1.2680769475624778 1.1824429467413515;-0.43090855883158385 -0.66680814061179827 1.8468205688270041 0.55351416880416193 1.9176554058920319 0.065196103593748139 0.046238920873548681 -0.74578634989630121 -0.68459071897555057 -0.58371504776270344 -2.7924355299448345 1.1101989237922028;-1.1997504628783646 -0.71781143542666681 0.76942633852674058 1.4239028021418942 0.5632504614240581 0.47811066667350571 0.69410910544507876 -0.44120216015666847 0.27730735831576836 1.9807386748336491 -0.71640638736485096 1.6556235570323197;-2.2698049789088022 -3.0987449362013795 1.1194829157046553 3.1584481470060113 3.6922364582034346 0.22223239857373128 -0.0016534278909505935 0.28331542729598369 0.017607739378988768 -0.49960040323779892 3.8137237488645135 -0.85339029700704805;-1.4248551035624979 -0.88809366163965298 2.0127431713182311 0.063500930627287788 0.8303388053133518 1.16774410822417 -0.012716687761427949 -0.33833372867657724 -0.13460995485341262 0.27836598043428545 1.4862480273115639 1.575639510779711];

% Layer 3
b3 = 1.3533260202258384;
LW3_2 = [0.92447431787569623 0.71295230006179544 -2.918780734469252 -3.197505764568827 -2.031298091423964 2.1277350280034635 -3.8991039397629699 0.12700460658739429 1.6051308926985446 -1.3959771175171973 -4.178587515277675 1.3015948754103239];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
