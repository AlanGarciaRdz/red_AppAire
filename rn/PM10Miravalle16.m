function [Y,Xf,Af] = PM10Miravalle16(X,~,~)
%PM10MIRAVALLE16 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:18.
% 
% [Y] = PM10Miravalle16(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.59828461476801542;-1.9755812903038814;2.6407083246420773;-0.52870353512926282;1.0702127886720305;1.1794445110820626;-0.085140304371480513;0.45525729533373149;-0.67663672051640034;-1.7098002808981307;-1.0534992477175227;-0.90669195215303178;2.2578779578812593;-0.52772705017820243;3.2986630731047457];
IW1_1 = [-1.0593432589756384 -0.56680702749077716 0.049646070009854527 0.19529912711789041 -1.5667926341918919 -0.039562252812231392;0.32226925023115294 -1.7440484653556234 -2.5368002256511528 0.78644982550812881 0.68705723225812887 0.1476856650318048;0.42562183115083485 -2.9677231107226798 -0.21650333255016604 -1.1694319501589705 -2.2254144622949026 -0.80518076739660638;0.91065885513261224 0.15305883411110011 0.21119950175224489 0.57006133319005414 0.66569747519711386 -1.4753940397440082;0.29746943992092795 -0.69063869864300198 -3.6070295269573962 0.74191354112183983 -4.0388600738347185 0.7485380565199764;-1.0676432126090378 -1.5612064613138183 1.5284145068615036 1.2740081112579553 3.4873161805610216 0.21643234779486026;1.1243108573516785 0.0068005259319765974 1.7190756657645196 -0.67535063289930342 -1.0659444105255536 -0.41346524028612763;-0.31584936847620432 -1.5831666868014092 2.5833568150697594 0.57774798169655239 3.3703240840644537 -2.0869030151737196;-0.75589759839564419 -1.1105900171639598 -1.0553801815328832 -0.44521279115475104 -0.65320435868065518 0.41026044528357652;-0.9169596890649836 0.7736590620499294 -1.4019322856404803 -2.4022961042031046 0.30462045688234923 1.8935300081017177;-2.9466092044252368 -0.2242204553662461 -0.099597226316873608 1.4645696543375439 -0.66606175422056701 0.055390101580074444;-0.52497381306064017 -0.20391272277338141 -1.0740688014408499 -0.049009335421207945 -0.33758076102838885 1.067273036522663;-0.13439721088629114 5.3487649315464898 -0.032136220795099417 1.0546063156761274 1.6334982859101326 -1.4125524144237158;-1.3156530145050918 -0.21208368359731294 0.10545510297141031 -0.93504275510923363 -1.3310670181761695 -0.25712616882470701;2.9428858721835804 -0.24399502376370996 -0.61892381070646718 0.26376578407769741 -3.0725107301539616 -0.17102438820891205];

% Layer 2
b2 = [-0.62634163534686438;-4.0248925915079532;-0.84786422318372756;0.1199299605919783;-1.5572793441385375;1.0141744090795248;1.1557202507185849;0.47279117697795087;0.051848979989285331;-1.8394150111037033;1.7386793893803549;3.5580838010377978;1.2370227143784081;3.0016052420722437;-0.083579968160857915];
LW2_1 = [-0.47069764971505135 1.3438702120848047 -0.34610300391469856 1.1880496865132588 -1.0177938115854179 -1.0193659376759756 0.019277500920474047 -0.21790206304440973 -1.5942851325486447 -0.47742888662319954 1.9145188974553191 0.30672577870237017 1.0901220496242994 -0.099663644300173895 -0.72641911587206831;0.098959907397702315 -0.92487887232002053 1.5423760066791838 -0.20326478640720236 -0.33601743917057009 -1.7842195006986805 0.15517360625362056 1.0012113634292927 0.6002256870686189 -1.2918412801684722 -1.1277247303769471 0.67045290688964676 -0.26369654353201855 0.9449724725156381 0.98126926978117035;0.84600909478555308 -0.52222914720486424 -1.1290673061267131 -0.31441100951684403 -0.78244136508362028 -0.11678419089502098 0.22382414169537804 1.557769092437139 0.36258212465053441 -0.25862346744948089 1.1101344500517869 2.1397095153944479 -0.84946854459074705 -0.911335746918297 -1.1458962950098703;0.67984451518572242 -0.25994476992085508 0.024283592093921266 -0.016087755171712778 1.0603358577615785 -0.36169429154959931 0.50703819720734933 0.57064093870599097 0.76828301723096415 -0.37724449560661916 -0.42051427681195452 0.83327607554104677 -0.68700127462959615 -1.1897551003042381 -0.89454149449067533;0.57796655308278855 1.6387698335560288 1.7660105134138979 1.3275692047452881 -1.5527866628015345 0.33779678840146332 1.2096181397813131 -0.24785504148720724 1.0176198110384875 -0.50464480209454421 -0.84446185476012348 1.129996212168429 0.34673215525054946 0.33972561386295991 -1.6015573472740579;-1.1834045039209464 -1.3086204561854013 0.060688661554508194 1.692215994816773 0.25775861348577017 0.74904390659905773 -0.72673279506028832 -0.77340170183218715 -2.0755634978136417 -0.70861218281170202 0.061350656909881056 1.7172581875478614 0.088887764022520036 1.0957075399752483 0.71692009018696479;-0.18088529021462196 2.1561487925706921 -0.18256987422838097 -0.37536748286593735 1.9751886480165324 -2.0128007639626095 -1.5901090529891815 -0.050119844107756113 -1.91791524405922 -0.62492068420278757 1.462617527199894 -3.2819568005767694 1.0114368542891845 -1.6695130759213597 -0.81740427281841121;-1.170273891584191 0.68203926000829052 -1.249370590717187 -0.43862768305392941 0.23943575730193653 -0.21191719226318287 0.55720622349501869 0.72281092776610456 1.0909792202653732 0.43784095550860341 0.66375026516248037 -0.1415864986461017 -0.43076829079542844 -0.60775855766898068 0.74532002565551725;-1.0673142297589495 0.19108528822801155 -0.92438666069921172 -0.36349736783824327 0.32327216057398744 0.19730895460577555 0.5731172974556924 0.41086825277068756 -0.51003313366716851 0.41516288215577796 0.059855342159162411 0.31785919209663377 -0.048497738102334965 0.7146173327258607 0.41777658159032649;-2.5892098057602566 -0.0025521413389649698 -0.25476706379887554 -1.1293077943152618 -0.65199395801256843 -0.13939319533476968 -0.92906945836774935 -0.079362122139017555 0.4459055876413961 0.092332234923322126 0.91124980890889251 -0.13057571941232643 -0.018488937654499039 2.0582121848462722 -0.15558435919504154;0.85544627256188877 0.77015265848547876 -0.82010635134820342 0.516501593624351 -0.44221168137682165 -0.59925991502341036 0.33825773769671386 -0.12925107963719148 -0.42146784910808932 0.055778164208091084 -0.74818104818066722 0.49028967908950694 -0.30598986380857041 1.0705880197917126 -1.4974659242381285;0.07793184267614657 -0.21515873862235063 -1.0127109629604554 -0.050184920279437273 0.93202017947295424 0.38281247334371171 0.65829993895338701 0.056831279927490277 0.16797585415220981 -0.36810813407784376 0.66434939698928308 -0.067765878709896948 0.30791135655230756 -0.21097006510554703 -1.2687361835262649;-0.7860788569680569 -0.011500162905971298 -1.4280053542416811 -0.91162667343176085 -1.5316379194959051 1.451225481778047 -1.2355827090245801 -1.4927265783154626 1.1065145686730871 1.9432663907586716 -0.059815608674741283 -3.6468730401555876 0.031872683031414911 0.51642153313334282 1.4092347107853791;-0.76736075175349927 -1.6598123479430034 -0.52458750548573341 -0.99781963590970191 1.8106286716648747 -0.4957281747961948 -1.0265000437105971 0.35875305797785945 -1.2299131006656838 0.24563647544667411 0.92181363108368275 -0.52856331209690666 -0.34409121319638808 -0.18868153655655062 -0.97321786593003501;-2.2699862887561006 -0.18555359408932515 0.53282770276420011 -0.99835215073500327 0.45322411930711454 -1.1700707076387284 1.4992520185088485 0.8601543125300799 2.5656358492267364 0.24358685901345145 1.2025168731029607 -0.46355209979531498 -0.06176671371203997 -0.44237885818137668 -0.45437498104071844];

% Layer 3
b3 = 1.7075088622459411;
LW3_2 = [0.12790685103884969 0.45784404067245082 0.24199560556568778 0.27751991623770444 2.1991032166263982 -0.21925396011332096 0.061117748043231106 -0.26187514792065503 0.34496915429529335 0.90035422439961699 -0.42458207438331169 -1.5785931149368879 0.14490974379963029 2.1861116085884862 -0.49541479718839776];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
