function [Y,Xf,Af] = O3aguilas1(X,~,~)
%O3AGUILAS1 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:32.
% 
% [Y] = O3aguilas1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.42005420054201;35.0877192982456;0.0561797752808989;0.00588581518540318;11.7647058823529];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.8791166164139133;1.2148589206919416;-1.3836139130663692;-2.0898483073031957;0.52403135316884009;-0.055280020366724261;-0.83388293561869009;0.57806293320521129;0.57222956732301733;0.19285050942274781;0.94418625323893202;1.977170523023535;-2.2445472744858974;-2.2047423791951783;1.1577318603159263];
  IW1_1 = [-0.16939285494328374 -0.35133289315153027 -1.0994632511797615 0.41138121818076706 -1.120657436502053 -1.2210527379233884 -0.75316644756159812;-1.3750668061959714 -0.38991583946135949 0.1715324205336049 -0.87856982820512641 -0.34923431755364082 -0.067335498306626024 -1.091073175919052;2.0585905573084222 0.77792365043322631 0.75674410845749529 -0.11903558881098142 -0.2072697366219749 0.079111686018744243 -2.2019611833936885;1.6226780715813791 0.42390543664576913 -1.2139802604837477 -0.49949853566805291 1.4157249541776515 -0.56576117570351636 0.31270752979590155;-0.72705041950971738 0.097122666458259427 -0.020056311773125925 0.43128953603699427 0.27496149997192598 0.28648624880898521 -1.8117583283682448;4.1423684001865118 -0.19531143210671259 -0.42684232256286092 -0.6634452882871239 0.049171089974031371 -0.24569912054360851 -0.76410412724536192;2.4068444378461593 -0.86834210203770679 1.2405129521910385 0.56218879967004987 0.043210935240356296 0.32114609715954778 1.0357911464163316;0.10839571222393107 -0.70322020761025439 1.3228736335856222 -1.1185803457998951 -1.5121471682096159 1.0828791238152751 -0.18467106948351628;-1.0838338540107288 -0.90254826130197841 0.98045380371759139 -0.2882975736996547 1.167224556994976 0.18050426041869849 -1.0992981913266415;1.0137893787750811 -0.42878377760362352 -0.63882794553865641 0.42423975969549899 -0.39208508687608606 0.052099899439653929 -1.8809332963280856;2.2514430683063336 -0.76750264160107429 0.35111090363343112 -0.34805726976508045 0.10722637800619554 0.22550240392488724 1.5081773210618479;0.33938603475921297 -0.062518284523833942 0.086094645701317737 0.045504683884285579 0.016093135016901572 0.048050350268643814 1.9908135436587826;1.3834508596823012 -0.89158499146618342 -1.7904492206550759 -0.17317273050867749 -0.017717658304457352 -0.40388394211101741 0.19251024241271428;-1.1885031216233286 -0.11091633865109565 0.12437829309884818 0.41369542902610296 0.82962387019165862 -0.60376385477945882 0.51375776632682035;0.27769737192137772 1.8380886961010288 -1.2514367572950291 1.0722429851904374 -0.58085816916933375 -0.33630301218729758 -0.12400969602640821];
  
  % Layer 2
  b2 = [-1.8363095288209459;-1.5964307191860423;1.1613343051564922;-1.1105535561590469;-1.1376631073066708;-1.0685398453213737;0.0026707745259230836;-0.16776701216644968;0.25548168822577921;-0.46529748098708384;-0.84714820782425393;-1.0809584751980152;-1.1621829985326595;-1.1373093775438194;1.7363672596617525];
  LW2_1 = [0.0068642055254409806 0.40741028446593125 -0.18193920320611404 -0.15416241579539827 1.418536847229865 -0.22644924028468827 0.35073147499653923 0.25052988071018539 -0.75192810654588893 -0.19423969524980511 -0.10468985971786199 0.08910424443221629 0.23928347062833175 -0.14022118105243866 0.057989154172532018;-0.022645768043044669 -0.85926263762340682 0.34882157381091383 -0.61233605561315596 -0.23994583919850121 0.35481253943276125 -0.29364040826822346 0.14150221828128387 0.75164683267779142 -0.28409018423576748 -0.44994074128106953 -0.95276302677839075 0.070730462905237934 -0.051602393834217365 -0.45858141769285526;-0.34185672177220666 0.81432481721732619 -0.03152596950835955 0.83548804886686445 -0.38118174318961034 0.6401582578948537 0.043548867621789028 1.1974767218386966 -0.089366593317574322 0.025689489487537728 -0.22716072798206685 0.022260838862832005 -0.0086348503216571726 -0.41264613587429916 0.20675257438452443;0.61025770552690584 -0.77794840420155364 0.36426247099962711 -0.20246307518461962 -0.96320489782772667 0.91041352955442612 -0.37138970565233598 0.026807933872142874 0.0018011239651550409 0.51939414160892194 0.21675989627661038 -0.0031177601965677385 -0.59680001469984312 -0.055866513475684609 0.22752757081809039;0.11349548433348558 0.34207219034931236 -0.51166943389025876 -0.23968630963759155 -0.20658973917165191 -0.61665195432659992 -0.61371652036244562 -0.36078056700897843 -0.85888453068668791 -0.20804492187220217 -0.3957474750886279 0.43602078508055747 0.20214365231172632 0.62518013033506081 0.11549767662204835;-0.024187915591235579 -0.34026039452716955 0.24295349491129847 -1.3885580900441457 -0.59414417940475395 0.41886295505159887 -0.66960119362806969 -0.84475872871307667 0.89828902282630285 -1.1624937845288925 1.0004771873320735 -0.35854135001068543 0.031889536156354592 0.8811478683598587 0.41919299711178737;-0.57368376060441983 -0.041689830179347367 -0.12942805959235665 -0.15326976469993173 1.0359515678129205 -0.235066376117336 -0.0065356389244360727 0.14373997782448159 0.31794305220135705 0.21368597485386173 0.40977219123805425 0.089485366536887767 0.21408654087759446 -0.6243979545448255 -0.54002845457547;0.65757533751217256 -0.2599551317986169 0.64944052763499338 0.82881610296286168 -0.099505033922222264 -0.48846935546427722 -0.69767214583866433 -0.14033047976283652 1.0741256603624147 -0.33258798922773136 -0.062318020228844355 0.90849487219801173 -0.91221193508418696 0.21775929340495964 0.82039831101147109;0.61929584187358833 -0.32240545558334927 0.31710760070389643 0.29472524195212202 -0.029394019614262142 0.42651818190447854 0.5232948219060749 -0.77209708491153706 0.69258969594936104 0.69165022083696892 -0.74751656654728993 0.74094860071785074 0.52563111459821077 -0.48247646891660328 0.40369336773365866;-0.1334224010612646 0.52476686147857843 -0.48534302897407838 -0.1981538560364714 -1.0425816449808174 -0.48791015756807021 0.12074086336609988 0.47600720523279727 0.16914446053984653 0.02504038935724532 1.0490800703067469 -0.80333154632819659 -0.12474198027245076 -0.12645640243270051 -0.27157835141541237;-0.58590127934073188 0.052771305164146055 -0.27342598556050957 -0.14986942241881898 -0.73285797961363908 -0.85195344885835433 0.30510198658489668 0.10327698768907441 0.44402770688880733 -0.3256176148189775 -0.03057691883913137 1.0541035711101272 0.20034124810385617 0.54776690113693549 0.36813196515403046;-0.087506129284510945 -0.67166479729091744 0.40238785876003397 -0.3169643441523402 -0.75790396586131048 0.78119006013033965 -0.6890683801104408 -0.018452947230618365 0.28686543933856334 1.0320417342834263 0.37805222121915638 -0.49820025630148462 -0.33319661878689139 0.57930903761170871 0.30336702097938778;-0.46224520250942569 -0.71974945971947379 0.11248553074053971 0.51469259069162476 0.039372487570269246 -0.46321567652422774 -0.77515923117262142 -0.090580066388985359 0.12985470345877559 -1.091273902644937 -0.020381793780349124 0.093543662116749068 -0.58991992264930548 -0.28018811720097142 0.34674358071041356;-0.12303354429256777 0.4665975160571717 0.78030859307708256 -0.14456758093121458 0.4443052299281719 -0.33882427915577951 -0.75470018986463905 0.2105475452675877 0.2314377382258539 -0.34005708617715213 -0.29143955654416193 -0.82416977772364852 0.26460520232842127 0.24408157478867204 -0.07546718566868732;0.42457300875115855 1.1798378106944463 0.51893219342321517 -0.18911159845288178 0.80737648822397701 0.16715100036297473 0.86920199046779589 -0.5460810111634723 -1.169232594797625 -0.296793446414226 -0.34979223178355573 -0.10811572099888903 -0.15718566223526487 0.11608916626629659 -0.09474545906732576];
  
  % Layer 3
  b3 = 0.32801172495340686;
  LW3_2 = [-0.84724464819730017 -1.0182570128212673 0.38374222789963969 1.1251930463477267 0.7110411128189168 1.7109465727659658 0.41975902896176437 -0.24541485007685451 -0.51308332004866486 -0.71175176738006396 0.52991467648248169 -1.2850888523545902 -0.71785240573554809 0.27447890035290001 -1.4383113728256549];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 11.7647058823529;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
