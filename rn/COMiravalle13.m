function [Y,Xf,Af] = COMiravalle13(X,~,~)
%COMIRAVALLE13 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:46.
% 
% [Y] = COMiravalle13(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.333459129339027;-0.82813623792008184;-0.77214701593777879;-1.3895433025168336;-0.15567911202136167;-0.024834275020927127;-0.57896303033831653;-0.35124456349833022;1.4789534072463251;1.1608111404973465;0.24794602911206884;-1.1468638396179296;-2.0603536608374982;0.55698922019914932;1.7103204754312262];
IW1_1 = [-0.89735912357702885 0.32949656891865575 0.53724772718228231 0.72842542724637549 0.37532314559817909 0.20857085156529326 1.3576020345668396 -0.24525475105489009;0.37613831386295071 -0.6827386780496989 0.35493076218884906 -0.39488955248911417 -0.37816494056670102 0.99506791203085954 -1.0021734533188889 0.15888516744737752;0.63204599969789554 -0.96711748551680654 -0.2048413588492356 -0.18143024592647883 -0.17529006327900068 2.0243735623884427 0.2287586695778569 -0.22161682870404514;0.050683494832056232 1.7974463697282637 -0.068711690514561025 0.368313506969007 -0.56849312571801558 0.11843591231411779 -0.070722390750972697 0.11326919187311893;0.95155894532552987 0.033697084122172802 -1.3918109788243653 0.30079752536048709 -1.2408312654809017 -0.42501308678399335 -0.93980300958065544 0.1258615145013689;0.94537701845360866 1.6621925914006457 -0.1677757629709799 -0.15429936553340384 -0.44988899066734711 -2.7485449300860751 0.11082992011988442 1.397015037335142;-0.36447820242415702 -1.1367045264527889 -0.72419448720454571 -0.041045247752964885 -0.10668935697468793 1.5597769909833936 0.33781076929067266 0.15717007320540141;-1.0246273855710732 -1.5190711072292964 0.022573522713426442 -1.3543081205715586 0.92835572773252961 0.74701270812071352 0.74373936011728792 0.32155635357981416;-0.95506897101827215 -3.1023337411372371 -0.23942781489797285 -1.175978936832115 0.48410296623433485 -0.64457177083606032 -0.68364072619253802 -0.8275406148107316;-0.18815781095325429 -4.3026683481013066 -0.46936901492459043 -0.073335497947666084 -0.27138266477574224 0.11871008091455568 -0.15048012360783625 -0.037810813240480662;0.88683010472601376 1.1763594984858388 -1.2745704922051762 0.15460189786517661 2.0250027069753438 1.1311326028126527 0.1993843845189609 -0.5025726192510106;-0.81229609381758716 -1.0419952873405338 1.0393521540514084 -0.094687994379705528 1.4491427048131902 0.4679613916956753 0.79280160730525939 -0.080788690475923075;-2.1475348018187761 -0.66325629734671887 0.40438488314761156 -0.29015470495877227 -0.65980167438823711 0.79375086848833931 -0.010600413631580902 0.1549646816757505;-0.073424730103847008 0.34860992262597984 0.17115226548804097 0.091183638428263061 -0.45183358885034186 2.6896887233705375 -0.56011378623528552 -0.11934731296218838;-0.51132322500835914 -0.72951710414248072 -0.33764419217096797 0.39201742605366308 -0.33097658084100434 -2.4245931706210131 0.52462362192567169 -0.071436566795606393];

% Layer 2
b2 = [-1.197394210861922;-2.8744128253398675;-2.0716706016553816;-1.323490284848881;-1.112201240228488;-1.68922104187586;0.42513341632760365;0.74994388188395789;-0.089841153121086412;0.020553205004838999;0.94382372667626779;0.8175406157050511;1.3270678792355266;2.4551486246955676;-0.74547308346421493];
LW2_1 = [1.0389342559412542 1.5336723987365242 -0.33334828833385793 0.58064600212961781 -0.25906898527546396 1.165867922410341 0.26110649165664995 0.17127277504601945 0.61469076256028765 0.35455265362203253 0.22209835925700244 0.1051619558075671 -0.15841187762672571 0.46919334509085342 0.53855447852338467;0.48863823799596645 0.79529560305813762 0.46674918858609693 -0.59243460022888395 -0.29495256921983293 0.50120935685005685 0.564448881677583 -0.66123796231943033 0.47889797429320891 -3.0148402023855554 0.47441754191414814 0.068274204678311218 1.7241202919912471 0.22956167417241616 0.20940799944106986;1.8325246786729557 0.96778332038494219 0.91998738848137607 0.35407997619814202 0.80683077385755952 1.189072176508122 -1.8141737019979001 0.74836499968084036 -0.80224857546221229 0.72279263168428187 0.21573733521834712 0.46565137550967711 0.84285930726537095 1.3295524149648088 1.2321844774550841;0.18502135826575467 0.97202945021059095 0.72022708103004551 0.26749725867173479 0.36871637503902527 -0.76944980894431703 -0.090440068313463545 0.17174215923006383 -0.30335639467621167 0.60758621115157685 0.55772175091355336 -0.068927582836322887 1.1963729827055054 -1.5735022283946043 -0.0052884945972301034;-1.2056222618055241 0.3028727600119972 -0.34908279767948597 -0.98640742928070757 -0.90476941378485931 0.016454208542488389 1.7299729626716618 -0.73975725222133082 0.82164881414094604 -0.4326621574725204 -0.65821916202071284 0.68814465935146618 -0.27357903165886455 0.69124267625918656 2.1783084762687679;1.4688396593475368 1.1029960935314189 -0.49898747719823117 1.1725342311671958 -0.16928088264619245 -0.62710731290835531 0.65946439499105036 -0.22885514073844729 0.90245315147119776 -1.4496283732361042 0.9568653882240008 0.88879307237609073 2.069411697260803 -0.49217217224395704 -1.1103336139627529;-0.68332349366625489 -1.0703005276844477 -0.29612369705265812 0.066911286539325002 -0.12305703948523143 -0.020121401547652983 -0.40947745397427066 -0.36396032258037037 1.0381060613730959 -0.27883950635545218 1.0632660549057138 -0.46297413848607938 2.607541738886717 -0.60043600685190179 -0.7671188798627635;-0.77209149568274649 -1.5196349710818802 -0.65327305973208327 -0.95713227122641542 -1.829025512490662 0.67929828143264448 -0.13901412406210464 -0.65086550770986806 -0.14230644190628983 1.6667514492806592 -1.0345807576861512 -1.1866108595411606 -1.4911323179436637 1.6320764139375612 -1.221678120883559;0.92257377664891915 0.34209832234388271 0.35367242272063665 0.89404400418578744 -0.18738659718160766 0.87672123790929513 -0.61623035353887368 -0.55134500442791379 0.47221930886849084 -0.80778708931990617 -1.9790143352474445 -1.0086762244229541 0.11671841066536626 -0.32547940036056033 -0.88835864414171251;0.077406108603644136 -0.17449757823035145 0.63883753158559275 0.13466593176190053 0.20996207551523155 -1.238595375639179 0.66159657489230961 -0.4503459184062143 -1.3568437317837032 -0.25584382065425521 0.027117883505864207 -0.25197753856756416 -0.4131989998869931 0.66362074398480064 -0.72717265641200901;0.11503710372886081 0.8864077687925731 -0.69030618105862462 -1.8562322304983825 -0.70881630075109259 -0.67629237449667967 -1.184115491576222 -0.13123508829331554 0.82058387148073586 -0.42726366615395334 -0.35036762968270363 0.65390874548476163 -0.010267871982618235 0.56703675279825994 -0.18491529534674178;-0.18111878455291891 -0.29647177145663905 0.82418261783494673 -0.29954476416589026 0.094854878551440244 -0.27464324985001098 -1.0852771817129716 0.30177300754182007 -0.50072964939558939 -0.14550639862536491 0.016617386871994627 -0.52370666685975398 1.1351408233692408 -0.95394193415132633 0.7029612325345489;0.27442933587610585 -1.0084161099966427 0.44763324989739406 0.42827406890004283 0.61874034752463003 -1.5341994402118511 -0.93405791132624039 0.12344475701072606 -0.29399580033072847 0.067330296675611925 0.52513216777835592 -0.34259431087336262 0.26853757560307329 -0.022261680648255591 -0.86504503178798675;0.33906200316444562 0.51750299151441992 -1.3261704604425488 3.169050757497768 0.11441396375223128 -0.62073317376216486 1.1521751656378791 0.56048925482466916 0.71888407794834774 0.15567181999550395 0.91270494667191948 0.61996022696645603 -0.25801422802300761 0.79233892322040633 0.80288157526627846;-0.51283339422692176 -0.34898488676439493 -1.0985666558456244 -0.28377088536967721 -0.28597395513688761 -0.027985637726646733 1.2325581275298056 -0.46677256634023306 0.94847095937316384 -0.24301903797591493 -0.087568645239019 0.38262843226169502 -0.28498981356022357 0.52181002112865116 -0.36939452524231031];

% Layer 3
b3 = 0.81883628157333399;
LW3_2 = [-1.0250900770778364 3.8698319379313992 0.54784789599984318 -0.94532274356702861 0.27175636508933976 -2.4617565950855758 0.37011207384543482 -1.2300022827876798 -0.48051391392487103 -0.19210045916173513 0.19167333742657136 -0.68655856908367363 -1.1913593137101326 0.6201056141105683 -0.83204104647175714];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
