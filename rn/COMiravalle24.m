function [Y,Xf,Af] = COMiravalle24(X,~,~)
%COMIRAVALLE24 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:50.
% 
% [Y] = COMiravalle24(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.8869247708086343;-0.72931158194849788;0.94715752532109232;0.27777163514272807;-0.92790274261779293;-0.33791053371082019;0.26788154164350481;-0.51820530985175706;-0.27490802635393524;-0.4178166087671259;0.95521120257238024;1.8466546136938002;-0.79356898984911217;-0.75961945215816717;2.6878401169315103];
IW1_1 = [-0.86615381040789374 0.61972713062976792 -1.0511863967445174 -0.014320173327493616 -0.91043411999815738 0.68379262037022226 0.89544382564778002 -0.60351282304798004;-0.18354012319607349 0.92307150449106623 0.91471379961491528 0.70791387956736285 0.16019848434701608 -0.58953928217944107 -0.20598831962448522 -0.093676842496779988;-0.62039700089311012 -0.0060533022992348348 0.74473738932785538 0.35691734300903361 -1.1395097590037222 -1.8965618670048541 -0.66503291616121685 0.10511317791422767;-0.047064319597247509 0.17564104001834208 -1.4523870066012707 -0.36706809569769028 0.85517362805599351 0.39892462309987914 -0.24222778179745039 -0.44296055754257224;0.13590183685485041 -2.6976659310923501 0.24939789092922995 0.036348736938512871 -0.054025399518170002 -0.22945709685654186 -0.017813328464689054 0.2104117331714937;2.7474152292381064 -1.69899961817968 -0.1872642687060766 -0.21679616231951351 -0.66234761297644895 2.0290268984590942 1.0096705812906464 -0.83800146003844911;-0.41258902539773668 -1.9571215446562464 -0.9474866487069965 0.20811751380650517 -0.52391503681895535 -1.4857779635962907 0.099280082841734077 0.029192917845514477;-0.72481041111122502 1.6356584777032923 1.2208481917285912 -0.25872937761578629 -0.058478054179063745 -0.2620447741032168 0.35249233095353733 -0.32352405782265697;-0.81346259274956056 -0.41103553435942008 0.32672864727348011 -0.18821139361262973 1.0444741722597333 0.81146016214501349 -0.039100017239754564 0.087361610928316263;-1.6884382979588557 -0.86631275824861764 -0.88897142880022817 -0.20975591378856703 1.1551495859242942 1.3270398146847959 0.068478625552972752 -0.27371430811384845;-0.2307781720576447 -0.084159052683951296 -1.9242095390685559 0.54830357825011022 0.57787645395594089 2.0405979328879114 -0.31714740363661509 -2.1345955825189264;0.98840740508312197 -0.12754370438042678 -0.018740302202985032 -0.050379693916651473 -1.0882206520560189 1.002747636183678 1.577422759736768 -0.32681094573504549;-0.36676550834809651 0.82455867633230417 0.29685657960291661 -0.087428596460968955 0.51184557476945658 1.9706665562096288 -0.53488503005425414 -0.30406189557201846;-0.0065564517104115903 -0.0051425429512860638 1.3213150223303265 0.48243662696653394 -0.15451633418832669 0.8115924461508135 -0.030793364244813194 -0.37818908108258614;1.9810359324220348 -0.4869295692511989 -0.22381391007597565 0.34833062022589018 -1.3337811663916319 -3.690225023774703 0.79174971591138121 -0.45652962244143602];

% Layer 2
b2 = [-2.7578236063900912;-1.3607609788055615;-0.849384566981642;1.1540605412427616;-1.4132235528667207;0.021714279915012347;-0.36544111576430871;0.57547814787579199;-0.26976136354012298;-0.72317678413866993;0.58842701790194596;0.21568594780220096;-0.78160899356277513;0.91378423797621799;-1.3491102276984257];
LW2_1 = [-0.81765926306364622 1.3283535040384107 0.22660159454086246 0.34421093061488439 -0.44102885545540405 0.19119441475128038 -0.55653986126296706 -1.6465968799093673 -1.0657635543650523 -0.46663014346750109 -0.81505827564789235 1.8566680801975259 -0.92597887846315408 0.083363943990238887 -0.95468926100015505;0.22542721870890514 0.39662270772948205 -0.041627519388270195 -0.458134390062097 0.12983845753379514 -0.7294721124000344 0.63882748548556012 -0.45418017183612236 0.38348567927334232 0.39903547424696245 -0.64311147462890306 0.29254191532622431 0.72492477375745601 -0.46232416450427438 -0.54919916741956687;-0.96915691120922765 0.46151955958085389 -0.41857566804922286 -0.49390924715739187 1.1569945272909499 -0.22255196114551468 1.2367251345346362 -0.63338950652491366 -0.4898785970489532 0.24350926195121891 0.78823204867202756 1.1725580104192128 0.21113018497294062 0.23108384975268792 -0.79022916619505112;0.14858254456716102 1.0344094761924236 0.12562757887064857 0.1139030414672824 -0.32586350239359269 -0.15398425590047099 -0.51157665732397639 -0.066648908384547498 0.68575775746038625 -0.30572249296347304 -0.025785962949983192 0.19124138759592546 -0.15900195628155223 -0.39166542486328992 0.43043101315945503;2.9551341820221437 -0.24895032489225472 -0.83839004848776755 -0.46776366984632617 -0.43448195724639321 -0.27652201018488598 -0.67160922869390527 -0.58200083392571533 -1.6441435227610199 0.91314419776992162 -0.50536524516037229 -3.4289450100889955 1.0967837484822476 0.88446870597246907 0.58311670977865604;-0.41012498437483996 0.43202778159241317 -0.43483530510495183 0.3648196664948582 0.28309683260919488 1.0056613211705712 -0.2513184511910348 0.81898824304204565 0.081916215742982371 0.18550668138020682 -1.1715208856575337 -0.45681430205110823 0.52851492784401632 -0.17930152948151165 -0.53906467887820952;-0.29396523345303005 1.0072830402093988 -0.45577853408555163 -0.9187508726452408 -3.0400332229966791 -0.29122697246975737 -0.08559614842127343 0.41652656548379619 -0.77107413130260438 -0.23446803073538255 0.44483881542583648 0.12461087571067096 -0.618296346777366 -1.1954108440936264 -0.76728452258463919;0.52335817349837077 0.31350084020203517 -0.34884811519599546 -0.89114590542878047 0.2074959572388308 0.011591204190711571 0.47959910068552053 -0.086433764751771391 -0.53770399732625573 0.066237849121596373 0.33728671220486944 -0.28179481510447324 0.25171580745692784 -0.16704400327597449 -0.31043988678613432;-0.64437708220108592 0.682699922192466 -1.1017319724402461 2.3441178623157337 -0.44753761852718588 0.65795770034933887 0.18812041946594987 0.068870147966613005 1.8604043986587786 -0.10702220206306075 -0.90004372235929686 -0.40013300784548644 1.1452174653865357 -0.84861763822080505 0.83874917800328397;-0.71823504434540675 -0.51114710586251144 0.3882196300198113 -0.77408228260762846 0.30246934013478133 -0.66117057171301508 -1.2561428744585996 -1.3367953896438582 -0.98925824537816509 0.16120366594455471 -0.56982885241487335 0.66203808719164181 -0.33838106247488631 -0.36799839335382611 0.75737555305562643;-0.44996230375555901 -0.13673958493805716 -0.24416042677224856 0.27127044274641809 -3.5343520221209324 -0.10903479372166203 0.37110579269352617 0.46293583282000295 -0.61382196623393959 -0.26291044546382319 -1.483163683193196 0.033291369459214522 -0.79774333134232178 0.27371650657837815 -0.99856708487533885;0.19185413902953855 0.44742280301415827 -0.47073993824720262 -0.59271626368785646 0.78192906197360346 -0.32695548809800051 -0.15799403395631115 -1.0020963330507282 -0.66126135042374901 -0.3761435055994149 -0.089067959434262267 0.47847489066489329 0.32874598343469819 -0.14134556992578176 0.3232827131181234;-1.0869355123161888 0.97736571117640758 -1.9268888502232446 0.228164376392365 0.13755922212368443 1.1747871198236957 -0.42886926807624887 0.82283863317598838 -0.31524245748227375 -0.06360689120499341 -0.03987160533813279 0.60483044214660009 0.12049387781810532 1.0544585354924805 -0.13374684842074602;0.47679273488660684 0.60319624785479953 0.4778346597501702 0.16224785852875057 -1.9812710420444246 -0.23166904752091377 0.95088767932530027 -0.75426488165207839 0.37885874022871813 0.36157766058543295 -0.47402343315525458 0.49999564295659599 -1.2256573473999988 0.51261246953423567 0.48415137033148703;-0.42900636151890753 -0.28041732483201315 0.31059295220826816 0.61276084986581025 0.32144801405240864 0.89333556041093154 0.0026404202168140711 0.12530560847295641 -0.74160810386620923 1.3239968272901248 0.19545615229831614 -0.20677585015220262 0.38001049112908675 0.82191584187964994 -0.64734921403975532];

% Layer 3
b3 = 0.22762095364517659;
LW3_2 = [-1.0859818928661358 0.23608672996374791 -0.73441565889158489 -2.3354333959685087 0.31983559551565244 1.9696452135745175 -1.8689462662610286 -1.8661533662583603 -0.32330683202215832 -0.86190130762548367 1.9339675077842906 1.3054177546539751 -0.46473049331653515 0.64861996449556036 -0.8184705261178733];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
