function [Y,Xf,Af] = PM10Aguilas13(X,~,~)
%PM10AGUILAS13 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:19:50.
% 
% [Y] = PM10Aguilas13(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125];
x1_step1_ymin = -1;

% Layer 1
b1 = [-3.0402249959318124;2.7331646825400466;1.6711000972573906;0.15451252851608541;-1.1504154088986083;-3.8430305993688156;-3.0193457771105767;0.59222853585542679;-1.085313180050365;0.23320212726339451;0.35212896000713434;-2.6008739126204929;-0.47464063312694671;-1.4818058413826682;-1.9095443783788573];
IW1_1 = [1.9129058994256454 1.447574693649982 -0.65198972656643694 -0.86916605381291123 -1.5020328699981189 0.85650799068654748 -1.1614817010207583 0.45561710115523335 1.1108561496758393;-2.1252686514501087 -0.41043474768114352 -0.62095313000710251 1.3007860387984995 0.92614905977603801 -1.1911260340875345 1.6772334900006995 1.0831713962996199 -0.26296889468975654;-0.36968555271377773 -0.37382494983096998 1.9643302219056045 0.22903179784358588 0.24247788648072394 -1.0906710095463994 -0.4347393064338283 0.60843249078099748 -0.13133274958851965;0.30057799124394152 0.029928191690498377 -0.23317263083447659 1.8179687015300838 -0.61530214130634242 -0.56648038633674802 -0.29864921310057607 0.0089260563500709409 -0.029990474839165865;1.1123603600622274 1.0428614170348911 0.55042436383940874 0.21496912307323812 0.717172149634275 0.59112391507877871 1.2982888527863201 -0.063454456771120618 -0.24620154776506153;0.46883991648850554 0.3324708344021714 0.18865344701754944 -0.26224497422640558 -1.1263381291687218 -3.0951165314282361 0.0067250319690437751 -0.013716213765379565 -0.023681783599082573;-1.2107372868856012 -0.017267003904805567 0.12570121009572344 -2.8407003310411376 -0.21592271291934653 0.41242135674737312 -0.056073243916133143 -0.024388913512607302 -0.042655201753683349;-1.0382225583396509 -0.26476823228425295 0.94175761355321264 0.34023157011828581 -0.83172024564086433 -1.1025705412153328 -1.7426027939439954 -0.31052734989843067 0.23363613957659771;2.2296160527226108 0.51439339576783416 -0.27750153230960167 -0.51842819651857108 0.8656463454531339 -0.044682860245057396 -0.095783968677203429 -0.042832395371081432 0.033937978728412352;0.38642108441856704 -1.5756169759790133 0.23719140685085538 -0.34061958531715109 0.15458825662650091 -1.4040015927366818 -0.49293772383634615 -0.10740398069079586 0.075036888603019755;-0.068584573041634567 0.93123123507847194 -0.81905675004715406 1.2275000228157527 -0.90724029172892684 -0.22890984576342394 -1.6930924402672429 -0.67312283841044473 0.12346801059314993;1.448358057682392 -1.744674862190158 -0.023843341487738465 -0.24194856098666284 -0.58543103146990227 0.1300783281189638 -0.6044566571343295 -0.13080212635062902 -0.15406232214854806;2.5083047827810114 0.36941531519883414 -0.31388300515669809 -1.8068401794562556 0.4353887462996508 -0.76668782884131603 -0.080709542081875377 -0.27904705614130343 -0.24383338009853789;-0.22450358495600278 0.48580004049746539 -0.40526179614673236 0.74066345043832704 0.10078237446972624 -0.032788326714678989 0.39649391085748703 0.95307924284869894 -0.0044406093818363211;-0.49434267434926016 1.035090632972208 -0.95418381978761346 0.43984106667960504 -0.88289516478742391 -1.2798677351729071 -1.1709580702978737 -0.32883729768359504 0.016176897357403713];

% Layer 2
b2 = [2.9304104410466922;-1.8366157646179295;-1.1512691766005052;0.97393487018716973;-0.65097862206879364;0.71723811165762386;1.3720059780896721;1.0205691794761724;-1.1525463104001283;0.97526190608425223;-0.25013413472923707;-1.0665624028453482;1.276834717943331;3.63180028769378;0.1276790083229363];
LW2_1 = [0.74740736151143072 -0.046097407706287646 0.65816255171061522 0.5357213558691124 -0.64647953363626365 -0.84237178064708784 1.0602566685167165 -0.17061736006799066 0.63600251970543165 -1.8856932416121384 -0.27041808755409963 0.65604446728157162 0.14285285038653944 -1.1108639923976196 0.78641358018408392;0.79722073396605364 -1.4473081172384201 0.58222419292679939 0.85739452938040117 -0.72612948692694312 0.37203637931266809 0.22295503815912476 0.092184121922634116 3.499013446036324 0.52412161051872486 -0.90252458045803063 -1.6680987382704284 -0.63970240145837853 0.48547045090419821 1.4571819630701537;1.3230956849165874 0.75062801873097307 -0.093481095192932906 0.41941475235750375 0.8387876680417794 -0.21088176416865712 0.45845608830630025 -1.1647399733683215 -0.60516853075778554 0.4146653265489782 0.34672674737381071 0.35645737871633359 -0.044001002452138754 1.0037122427154375 -0.93958695135871417;0.58600984006737744 0.019591173266083169 0.22803140244860254 -1.0885132329049654 -0.98002440877748265 1.1007963670753078 -0.90706007882394935 0.18535047789792192 1.0576712028523036 0.8660415674476194 -1.0888924688185788 0.80371184603801116 -0.23396209342087487 -0.094270063897210155 0.31131531234976773;0.29904759021709409 -0.59717551003480251 -0.65771310382022774 0.3888042944910492 0.33535150882324838 0.26711968909845002 -0.071445959293640948 1.520262511553168 0.92163772854774373 -0.76102616194714112 0.52640059754037327 0.09836059559160093 2.8949493674936209 2.2370568818197119 0.38330565544149287;-0.04754528896769674 0.0084107628168400388 0.40106388903392298 1.4563992520596518 -0.55546553660520925 -0.34057737788121095 1.5633027896462872 -1.2007505448146107 -0.2815725515766645 0.29617776882162911 0.63781054261535808 0.18503031978937021 0.075775541195867255 -0.40285722450887629 -0.63578692251246871;2.2489640670286541 1.2351348754254516 0.48981948744145565 -0.25516367252697741 1.2649005004865286 -1.3898587811404783 0.81722805871750359 -0.84407186581052596 -1.4612068559764895 1.5055652087442633 -0.43519722520763415 0.32649290379101359 0.44812529589866434 -0.34761767810757904 0.4287850731053266;0.71741034860048236 0.42811070124633432 -0.37714476214943693 1.4020490527213307 1.5738276832412932 -0.32376957620720015 -0.9527067335902335 -0.10078369535239595 -1.3872905491042897 1.7930092491481062 -0.0042734015902548272 -0.11618118701703488 -0.66080116931959387 0.28354712810703803 -0.13552580029530584;1.2012285782700689 -0.13834189243744904 -0.87696193804137101 -3.544272447784544 0.31291853438763317 0.87664569998222852 -2.8853472285571424 0.98879448479196774 0.30871934525894568 1.5652384923104046 0.58200467966906744 -0.45932767681619358 -1.4830380567224775 -0.084047324608324342 -0.26720113111095067;-0.069760549884084255 1.2881927052380613 -0.041715745902310856 0.42785445168785469 0.51213944108169018 -0.053522076506873573 1.6232062661126849 -1.5112187164546085 -0.091286575236847023 1.093663169453478 0.65502742962355309 0.56399104983029125 -1.054978054848092 -1.2541911506237962 -0.26111046547905842;-1.0014321025681914 0.70962129760295545 -0.47817886782660363 1.2838649747707909 0.64121298200957166 -0.70549938734489792 -2.3335714487423718 1.4808729462885144 -0.090224554180184172 -0.38903549021963363 -0.75892721172314881 0.005048564467380898 0.026912716481665523 0.70057724262532517 0.46763282917595023;-0.45516583929492122 0.0032239771130939156 0.26301248192499715 0.3718768292923566 0.79060139369817495 -0.9454789518008786 0.80101865521556881 -0.50068229652345042 -0.88192919006656345 -1.0813817346088845 0.86744067979863138 -0.11200193428591075 0.044617006464376066 -0.095599717975053039 0.10203366565493177;0.985398045476093 -0.32832537875795686 -0.1751602879017381 -1.6522397634651766 0.89147614768728278 0.13713214464224713 -0.03670752102112626 0.026115563904302742 0.29056216484087866 0.25889442044382815 -0.70986524654839556 -0.16575679089084611 -1.5249049387395779 -0.96258993249110414 1.2498552029814347;0.13449246048943023 -0.58247473919219162 -0.71287249929097618 0.90252707107750663 0.37118957559647947 -1.4338532142017246 2.5294062252378016 0.93392177118538 -0.052000517000524875 -1.18643241026631 -1.2390981275556383 -0.43188879111403439 1.1366420337253342 -1.009918831560723 0.91739665749490096;-0.69850248861679465 -0.54125123289301003 -1.3391729893482101 -0.11678476526854464 -1.3730882553646238 -1.5733350278192486 -0.91725095256547484 1.5129055441811687 1.2671203545892842 -0.076076448600816859 -1.0449350975672547 -1.6488693358647351 -0.97482174020407053 1.5428660540691559 1.2061847548078268];

% Layer 3
b3 = 0.19126372974812594;
LW3_2 = [-0.69039114996771556 0.45877418391213859 0.9019696497266948 -0.34462149840582745 -0.55971382006819914 0.75092719077838321 -0.23093614861903028 -0.26173312311405422 0.097143426456532261 -0.55919780036177347 0.40551290134165502 -0.44782850182970996 0.32485762652297306 0.5694989852830511 -0.21761786364457253];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
