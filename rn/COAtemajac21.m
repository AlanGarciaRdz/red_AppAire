function [Y,Xf,Af] = COAtemajac21(X,~,~)
%COATEMAJAC21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:27.
% 
% [Y] = COAtemajac21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.201288244766506;9.52380952380952;0.00968992248062015;0.0210748155953635;166.666666666667;0.0561797752808989;0.00614628149969269;0.0213447171824973];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.8484453637559395;-2.1686458318648341;0.8873209607953304;-1.3309989716937864;-0.39130889195369201;-1.113544723995606;1.4966073639346789;-0.54063785899712236;-1.2713402411774186;1.0322265497214043;-1.7173065475902376;-1.2267884487687146;0.63248242295036916;-1.6336118125380137;1.8610926299979855];
IW1_1 = [-1.3830503646040018 0.66970457569514674 -1.1778008152884865 1.4185937052978974 -0.63003758620662498 -0.064373226241321052 -0.21082853927144235 0.68534180575327897 0.12310989058221011 0.011493621361528185;0.45554229170957994 -0.47964333713902807 1.1550943398963944 -0.67120596341600358 0.53609445756308161 -1.4696944446500875 0.014798534357394394 -1.2938127175557048 -1.6309052385036868 -0.81579706494583326;-1.2263561876770113 -0.25210661073004142 -0.24749746203524967 0.72298968668962893 -0.026182102773010162 0.11532763119239281 -0.35674504657861522 0.82591917604896425 0.14051069521775178 0.42108947283655673;0.80680028993966135 0.81828077289700774 -1.2374157394643346 0.11479881187435295 0.94720666444242951 -0.016462406053216 0.20012681630429849 1.228347811924789 0.59847108146669525 0.19580999819526654;-0.0048426235564632721 1.2820531244841085 -1.2063029426500489 -1.1010255550467916 1.0973346620543931 -0.42700423296354939 0.22783351261406712 1.0363220140473581 0.41427021700819339 -0.16385421026151445;0.7002009181204687 -1.0796054109214286 0.44188970794163851 -0.18283157349737469 0.83130461494814478 -0.31104078959442083 -0.42229972116401632 -0.57130466527167101 0.60852784682737704 -0.51007267806110412;4.2640314398045174 -0.21858000351218909 0.54283037266528555 -1.0242437740705337 -0.7987430757702646 0.28264546851564337 -0.25086526397526826 0.5018339322259181 0.22654097746575752 0.36184230909333465;-0.27106277074445756 -0.96537081685180526 -0.20982099588124323 -0.45124155994734277 -0.75926282225840636 0.37717884758889214 -0.079495711497152399 -0.53382538904403531 -0.2594087851333754 -0.83387487800855098;0.74350062785573978 0.83692615161515305 0.28453241716861949 -0.32208965312249677 -1.181729470784346 0.82864166973444142 0.40644996698057012 0.94779589547684628 0.1649204552263871 -1.0538360677766325;-0.05570809073686183 -0.55294234483028604 0.39800254812420782 0.085023072996018675 0.42318821701274151 -0.42194425819552062 0.45807376436164937 0.95016674913017996 0.23031260705693035 0.17291397243373799;0.20965836650035802 -1.8842133948729007 -0.58012299672063228 1.4882622228134867 -1.6140514197671081 0.17065552317646834 -0.46286888359723183 0.15343947895670285 -1.0223076965956863 0.82566874187000416;0.27973767875185868 1.0260092240172232 0.37331582918625089 -0.80148487874650132 -0.044816463298609499 -0.55076385310713483 0.50153435302578209 -0.22708541860891596 -0.2108231243733108 0.051003816045112949;0.37731916682567973 6.1953662779065297 -0.065449108383818802 0.26226315537286798 -0.032226073870577097 -0.028252558017969734 -0.08224999728132891 -0.29067754804942919 0.11984855679820766 0.35869515837126198;0.17891451157441485 -0.83805732918345099 0.083439960979398417 -0.22870336176838993 -1.5183238374728814 1.238202686474678 0.11513607060507677 -1.2903112393752687 0.05292547281018397 -0.30580416774606939;0.22478052865818343 -0.12569274718167442 -0.59728418506997583 -0.077428745181200492 -0.47107566035741238 0.93568492609800091 -0.13992749702296731 0.7613296339702772 0.11548914869642707 -0.47220296316516974];

% Layer 2
b2 = [1.4294558364200696;1.2239771064292355;2.8904025217936526;0.77428493669431842;1.0524497349749264;-1.6058778903973197;-0.4531136757624788;1.011756179823637;-0.66306376072520412;-0.3478812441593947;-1.0104489845129214;-1.403508300941249;-0.97716965163589453;0.96603646084231309;-1.9414252084637422];
LW2_1 = [0.014729747001855529 -0.213306694128164 0.011765020838009118 -1.0991182503402568 0.3450415606832512 1.4326463439544928 0.11764508299237511 -1.2533005912294923 0.37365428510431486 0.050070290957003966 0.046925501820341831 -0.93137658025095493 -1.509031357470181 -0.094143538991548731 -0.17535993875115663;-0.43733067777880047 -0.22231273731738027 0.61604285060402264 -0.026586557042556476 0.37927569606559786 0.78652437966524213 0.030665219881905119 -0.70406844731517426 0.19520803035911125 -0.47636425407546562 0.11227308571846481 -0.018353792855228021 -0.5960921841800173 0.1947270382036306 -0.3090362326252567;-0.35702193123258474 1.781799048125315 3.2918960371400914 0.1616946222710374 0.55421163208519908 0.087858780723102048 1.0391558767492022 -0.21109805926813788 2.579316625243897 -0.64899689352844592 -0.26504169195173605 0.93682399477449996 -0.49283752886395071 -0.57777731578857516 1.4552974340030909;-0.73352045022230827 0.41856240787022997 0.6627890188819382 0.14229310327165834 -0.19456271380042206 0.5647507697340064 -0.19187950226560643 0.24586125958346017 -0.15375177471295037 -0.19971659832593575 -0.10742028742159573 0.63058149560140753 -0.88834831884554211 -0.23152891483607613 0.89373721110193882;-0.8437811696386478 -0.46152375531849182 -0.72828317074405591 -0.23719947396967958 -0.10312000837010672 0.23797684058424146 -0.053274002497285117 0.80643641494057761 0.25906156147265852 0.19878023697497144 -0.73557630767220161 0.57776272779331328 1.060449310333323 0.061836460121009101 0.5548132217530779;0.40830319561337219 0.1793650945959212 0.89111198354033117 0.61356483348725066 -0.21542054865828791 -0.21130530226833166 -0.80360449471996442 1.3222824932119195 -0.56435929325405321 0.72291109634411177 -0.86144151019375181 -0.29129602208957728 -0.37532732394001317 0.67035912012339349 -1.7773898527897602;-0.11192799275568624 0.10929374618650142 0.30957649567898082 0.46210868491746709 1.5043199710895703 -0.7888870814888681 0.17902625000188307 0.26886865373600166 -0.45087524965757053 -0.025801408146850703 0.43652864193126795 0.31431583614850056 -0.23602790511801894 0.5180417363562142 -0.89059946773129739;-0.16520416280877845 -0.56330326587017021 0.77942582772463898 0.64905991295648091 0.073972254177775018 0.52998433658207811 1.5509312168935527 2.9306208787989902 -1.4455353706542085 1.6082513700243311 -0.49693967853835003 -0.71758408301396437 -0.71333091913146374 -0.47356466510695511 1.019400621843094;-0.33761347053726232 0.28775063791304711 0.36630533784661595 0.22063843965920912 0.66938539262508456 -0.31719578573908536 0.027181737936789532 0.27118693221784368 -0.21219208496328776 -0.11710626242609211 0.36429843801591183 0.17995130888669986 -0.46844220809985426 0.16503653463461396 0.39050015818575995;0.047981570159151853 0.76194560039277004 -0.96330264712959401 -0.74369968572559808 0.49244428963157494 -0.11352198741415129 0.097762003368988604 -0.10402454118514215 -0.3996015556874557 1.0402330377162501 -0.051484049537001683 -0.50316530067177201 0.21580916936493788 -0.12692036533945056 1.0251843860897529;-0.51477703158257626 -0.31904743230815946 0.53974720973963564 -0.58425989053002747 -1.1211024276929564 0.7848599561112487 -0.11560620814739046 -0.55873178065152118 0.15867070279626569 -0.18165026019960664 -0.28705780472069975 0.1507657118746632 -0.32546505835816575 -0.083229508420071679 0.82402709836959831;-1.1547500567954747 0.14314147952595899 -0.087426993696673991 0.82648391234130036 0.059494312332078823 -0.36264889502045083 0.13922120943201027 -0.12361806458365468 0.25191971880623953 0.98418892292635729 0.22290059544714855 -0.35507801886485801 -1.2250518372911945 0.18175414876009152 -0.18445233835809444;-1.4970468007438444 0.28402627353238691 -0.81093337056420312 -0.22403394236338073 -0.1718519940920491 -1.04941589711391 0.098655402236092662 0.068891387458110853 -1.3141952887029702 1.4724853453113322 -0.72513115873940237 -0.46102051963165858 -0.13194109161167744 0.079848043179258893 -0.16820847084004581;0.89320933124992519 0.096697012517709111 -0.61148827428352237 1.3999541141572711 0.65229265474062692 -1.0078939204427053 -0.033035804710219212 0.75112493585304796 -0.034703927097160477 0.16725255791254101 0.022845398490412873 0.59045003225638992 0.39871235642089015 -0.055571750544657295 -0.026072908069405272;-0.3786805657502787 1.2723050963632754 0.68926901136139196 -0.68196555813308823 0.53778402124058544 -0.13599788339391808 -0.72663868794999997 -1.0660833053486567 0.84036232677208123 0.016959011924415138 -0.6895060914144826 0.78039734549764095 0.76288274908285647 0.76439015571989344 -0.89368673402873655];

% Layer 3
b3 = 1.231901986501527;
LW3_2 = [0.6146894564195482 -0.83313851003395134 -1.9111060295843882 0.99297104906548495 -0.35196343431972282 0.27772933898438606 0.9972663688748642 -1.8183375194619453 -2.494927431074871 -0.58238571755197344 -2.1958307365740533 0.71552992106127355 -0.28830367612817476 -1.4253395922991938 -1.7581895382525126];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.201288244766506;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
