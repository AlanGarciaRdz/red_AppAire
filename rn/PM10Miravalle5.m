function [Y,Xf,Af] = PM10Miravalle5(X,~,~)
%PM10MIRAVALLE5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:15.
% 
% [Y] = PM10Miravalle5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.8739281551371347;1.111161364171499;2.443660564066815;3.3077917289014778;2.4094067900780334;0.16095646202317188;-1.327757150394117;4.3811810470079662;3.2291052718043529;-2.587269250894547;-4.887412997677516;-4.2145917110561806;0.23161281448751025];
IW1_1 = [-0.64253647578217898 -2.4718193197503493 1.9605063868590005 0.272461726996376 1.1713090088099143 0.28898397673336979;-0.77557735260971505 0.51537517620113515 -0.77808444222325734 0.09593621934265445 0.56272594273755649 0.62058591759282344;-0.76534634125424794 -0.31847024883471176 2.6595001181249978 0.41090432429109336 1.3072817738945408 -0.31660442364722374;0.9882394742023316 0.31833413189859938 0.25811864429420089 -1.8419649083141172 -2.7100856006815373 4.3661032869920238;-4.4352529253007793 -0.63714747511559999 -2.0764413021767587 0.90697915151701847 -1.5615478029266419 0.57078457004931127;0.018527696858144115 2.2455563178487821 0.20761910898631425 -0.11134460542627724 -0.15745151701812124 -0.25487100238020227;-0.93604894840024255 0.8884029944837365 -0.95840002288346093 1.8150950859003503 1.2077561637340568 -0.39085705361183137;7.0294278420178227 -0.12196508986253174 0.029579203321790232 -0.3191488344302566 0.35435800469773104 -0.57801450336109894;1.6665750556592105 2.0258428213514534 -0.53372738660107288 -0.78583338312967699 6.1043203077220056 0.72624117110019515;1.4790744359415608 -1.0521985223998562 -1.3489214871367738 -1.0404893208735206 1.4013038463951464 0.13565745744362429;-0.4573121735015967 -0.96397790906071734 -4.9115492266249383 0.42064815788357163 -0.95581761784786101 0.91381138842424514;-0.47465677734069101 -6.4423633873753658 1.0057157045649041 0.033883265647246995 0.079905794190107363 -0.107203469110616;1.0486598226100701 0.98490714492330167 1.1390514875351823 0.067520548791257989 -1.5610559356944138 0.81372711487867244];

% Layer 2
b2 = [-5.431107065420794;-0.91443543781388881;4.6528616996271985;3.1197478213990655;-5.3542206232190059;-4.8310989095346759;-0.023405965770064457;5.4161299655599207;-2.397762423825633;-2.4495555257236403;-7.4955387398077455;0.87137486598218294;-0.39695287041194188];
LW2_1 = [2.2876718636969735 -2.3708315974756013 2.351865648556585 0.9147940793764594 -0.30368431965869935 -3.2785083938864101 -0.39230732259802459 -1.3398621391393584 1.4732030407079761 1.7488343244886098 -0.10928742734331491 -1.5339839093240195 0.12888999299301321;0.87506992344367307 2.0835731314290071 4.6656134010076737 2.2157541027446519 -5.0704851221721299 1.7285359336364459 -1.7911486725959551 -3.6866112138633689 -0.89937322384221541 -1.0206327219848303 -2.7515794514908181 -1.8873590783736036 4.1378002761512329;-0.81413797937932619 4.4787505827841327 0.57982751651372688 0.15399929586582903 -0.38303356820261591 -2.6539913909479611 0.19546322914686068 -5.6098550121339708 -2.1982846047589426 -1.1687435849424355 -1.6850738203882518 0.73222143195526068 0.37818350402113221;1.4903402143961981 5.4055155120796492 -4.1461538349598319 2.2131247716124012 0.8492777330992618 -1.9774963340339669 7.7098983733322628 3.4111135872260467 2.446039049581926 3.6967662594806048 7.203671340291085 1.678645458995202 -1.1393524064431639;-1.4204538433403819 2.8500129246782659 -2.7537433773895175 0.21897872883126271 0.74206596231524191 -2.0729110206612047 -3.1360677434382533 -3.3438328151077377 1.287144636874173 -3.2017681881635158 -3.4507682602788603 -2.4435256417415969 -0.67050503894129354;-0.70951265378164075 -2.5829819396107525 1.2152818528488893 -0.42493297094738436 1.8729402889375844 0.21202929721452832 -1.7604550521136857 2.8810872744622955 -0.90814092058934126 -1.4637478551822347 1.1173676254740026 -0.81320590329630926 -1.8731174523436998;5.9535976935691854 -1.5205872146977544 -5.2274689727340604 -3.1366461674747641 -4.1594608263278356 -0.22243360886281452 -2.5162299236230501 -0.70173627699613217 -2.6750860725219985 0.026789592976195029 -1.2698418477450168 -1.953887771634115 1.2353038756744497;-0.83721383310672881 -2.0258273675397143 -3.1173770568356911 -1.7410802034787423 1.8080618066973193 -6.5110594323698541 2.6060937150966299 1.1464649458866192 4.960399817713121 -0.77023478390757494 0.6286817813334824 2.1917731568049996 -0.06678249842272356;2.747082577000771 0.9826790397074433 2.5618031791673888 0.47031207234944333 3.2057800485350554 2.5068538057689587 2.2830423101941166 0.22865239828687076 -4.8579784610195285 1.6714244546927024 1.694882991691067 0.64742661025537307 -2.8944441828069571;-1.0542646188561753 1.1673205617795859 -0.080214758240471917 0.66009490956833972 -1.08769862973964 -2.2317850789969165 0.97123522082324343 -0.12194153568176652 0.72799538113169548 -0.13657071321735487 -2.6662574006207289 -0.60547792196964412 -0.19601569181434203;5.531533138541441 0.18414192693945938 -3.9086303503862641 0.91012547488847806 2.6327311410783181 6.835264445688785 -1.6373130730719789 1.9140102837163757 3.7670596236092115 -1.9657145028666769 1.1446241793411833 1.3042641725627688 -0.83477985806127375;4.7657218195624411 -1.7344931014630371 -1.2785496006719992 -0.55985789429685384 -6.6450963936234206 -0.58346137378840712 4.8491821327801681 -1.3315247037799804 0.29828358906541219 1.7545236090932805 -1.7555272642653312 0.52178469071283584 -2.3838660052011789;1.5054372432709651 -1.7690716086962477 -4.5438427234212773 0.73192100345594246 1.163543010283224 2.6651620244602383 -0.17014002220979146 -2.8006705365318028 2.3903473581795787 -0.72323276960042304 -2.3483377205287512 0.27144053380745936 -2.1222701023083808];

% Layer 3
b3 = -0.53802423862903914;
LW3_2 = [0.11470750002053305 0.02929435068921862 -0.22667480420224648 0.048302862605224692 0.062521573819186993 0.13948790769971842 -0.085206925196877406 -0.056509727695689738 0.052198317117906186 0.080936254689609563 0.036087437530840649 -0.034299533834614003 -0.089285659227662642];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
