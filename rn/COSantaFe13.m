function [Y,Xf,Af] = COSantaFe13(X,~,~)
%COSANTAFE13 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:08.
% 
% [Y] = COSantaFe13(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;10.752688172043;0.00341273633199099;27.7777777777778;0.00632111251580278;0.294117647058824;0.448430493273543;166.666666666667;95.2380952380952];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.8260657889845839;-0.5736577127937933;-4.58407345620311;1.0486444779599398;1.5200337890287072;-2.8701958261306313;-1.9830853316201762;-3.0308541145705785;-2.5199877858329325;-1.5443519734737179;1.6688117895794681;2.2668403372421677;2.9850271361347676];
IW1_1 = [1.0489294144178791 -0.68798124728818966 0.73470465174577892 -0.67619796323922632 0.24651184644676538 -0.1757411141241815 0.64909699653745989 0.41298796697631796 -2.3966332713115577 0.98277101262284261 -0.50680150540677382 -0.57175005931393186;0.91969298188876047 1.4773095670348353 -0.76352888518715145 1.1963241911970641 -0.51011002019648233 -0.60687135176717821 -0.69869941030521487 -0.83215871558041576 1.3139707227386865 1.4227280347393876 -0.03689496336321578 -0.4680137777794508;0.56673319492457896 0.26797361993026975 -0.080634194000323109 -0.10394001808296273 -0.16921601488106131 -0.57243771307855829 0.50912866297731374 -0.26681273573336955 0.8503623395077643 -4.5804496775371604 -0.024539011930929677 -0.25246665700240645;-2.7600443617371151 0.12955945880928357 2.1948010697917755 -0.11870805455604441 0.68058942511135945 0.92942416875424538 -0.43489369718266074 0.11386337028268979 -0.24633562761858427 -1.769547252164982 0.11086980425841775 1.0381033174137673;0.44225767701735219 2.830318912029218 -1.3293628715103665 1.6615814376854889 -0.64350021850694794 -0.27255673324526875 -0.7311277297790697 -0.36571816969892973 0.66723727997594806 -0.52294044018432817 0.27350298105756671 0.1491822959057407;0.78639755947463119 -0.92877711235914007 -1.1218918764010775 0.31014385297560132 0.85395469677921609 0.5641240531683529 -2.4251579052010497 -0.33543606281345301 -0.86768670357138789 -0.81435859831566526 0.40534203612469238 -0.028634308258182566;0.8453341247809768 -0.54175956902762912 0.43459879640363835 0.23503299093446661 0.1037421883514241 0.40141139180873336 -1.886401617865163 0.22066086061964835 -0.36905601967834362 -0.57609876645672953 0.22018692029529499 0.89501158514025125;-0.022972121677865373 4.6197163195857183 -0.47270727609108021 -0.045642714297582113 0.17817008957846606 0.012420631860988809 0.016803540295558715 0.043627565041848719 -0.15539671527889939 -0.070286300444397792 0.034911977072797716 0.023918444239010676;0.58763554314141986 -0.075386014365574613 1.5858549887148852 0.23340852652487759 1.239585940391813 0.51113300569595199 0.083395181701673135 0.5561655790695389 0.33457541717465555 0.48372755896172204 -0.25554723367733445 -3.797817869024517;2.2273243278601633 -0.99207285404721768 1.8364993292146261 -0.76324303891354817 0.69675177413833622 0.57830042714511676 -1.1945722796418152 0.24940661916575074 -0.89308071019601443 -0.25113851809717014 0.25777480987470686 0.23699542676956287;-2.0194921802956287 -3.0864638617345159 0.92550131451461071 -0.90614853974752552 -0.9029689557445848 0.29778852553494339 -1.170800921564024 -0.062310132901248996 1.2352276845498975 0.29130289805000353 -0.067613882249559623 1.2836966543705068;0.35241583972026519 0.67529123331811602 0.57015328478062899 -0.54512646696941758 -0.4967252901842944 -0.2821797035257943 2.0650973124215555 0.28337411645191501 0.55706375073885817 0.26089695886183167 -0.13368129614640406 0.11499897508951751;1.293620642043062 -1.6614977223370981 0.20105668354063122 0.32165812838323771 0.0015975054283372814 -0.23479180896092061 0.97737921901680014 0.17315323624762172 -0.029661897452529052 0.092564997214468092 -0.23907391303275616 -0.19026383099737082];

% Layer 2
b2 = [-3.1098797149654351;-1.5368967032471352;2.4383546637339513;-1.7662966624834524;-0.58526425814789806;-0.280491520610818;-0.5123072640178632;-0.012553037034600062;0.46020296496970808;1.5806230879194059;1.9265179823624747;-1.4769939940978996;3.2722932099520752];
LW2_1 = [0.32835770750752202 -0.5415052060624086 1.9917654256668644 -0.29992385245758507 0.51562839071571176 3.0499946808183451 -1.7606048167754003 -0.13870818753622768 -0.054656089083607404 -1.8193527451574032 1.5242988215131372 4.1760935011008211 1.4619968335859492;0.42291559525396116 -0.18452892266732879 0.41431534904746675 -1.0332842337110066 0.24145415239677559 -0.29032477356496228 3.2379510297885177 0.31128413736438582 0.93924433117826567 -1.2568493535801164 -1.1482090791449961 0.17477253321656003 -0.36691659962232775;-0.13275298385751902 0.62557777948974691 1.1022143535583233 -0.55528952439319912 0.00064039067339268646 -0.62361423794148851 0.4711646759773423 -0.44783290746609883 -1.5357023907028078 -0.24668962040091758 -1.5442273795702643 0.7266581245431154 1.0599919848088397;-0.13360352231574768 0.17762903693988336 0.27425813221276113 -0.54643868997850376 -0.061479330388706795 -0.51510875694640312 -0.80537452324995773 0.657707293427227 -1.2486663186140123 1.2394286274747506 -0.16372272551306241 -1.5298362876827003 0.23444833624052547;0.04493054187013483 -0.069883697572537012 -0.50678105081759495 0.31239030931786993 -0.094428128210679599 0.10671817646632033 -0.095495620895921507 0.15733710818593274 0.77637403821765749 0.66490848532953029 1.2853049340188991 -0.67493951537165464 -1.5250575246810849;0.087169738677643993 -0.0063257985102162378 0.27109385659389312 0.33779903041746245 0.15104735822855136 0.18603543277098755 -0.85012764116701223 -1.6659569476449023 -0.94210335991577421 0.46946408880275692 -0.27042737274317102 0.64975067556527932 -0.70924012913754553;-0.04640095552543759 0.753206291932498 -0.22409054388277633 0.43395186855884205 0.10162962101986277 1.0561855242028477 -0.42736524921773916 -1.1833908610349899 0.40187271952430564 1.0993203453020577 1.2999525696738727 1.1529090809115041 -2.7496867424183713;0.81440929653012517 -1.2210682534164692 2.637767931258328 0.4078712649860779 0.022093212957271402 -0.11069295951178876 1.7638195380897603 0.68376345489513646 0.79761192390769164 -1.7466206062476717 0.26429143321918791 -0.45732573940574039 -0.32963625842707794;0.066829096353326053 0.93488461278807589 1.0156353787133998 1.3402611113362841 -0.2110465166356866 1.6684072226849807 -1.6617969315521637 1.3478135974521261 1.5265392622868441 1.1019457740115917 -0.99020138856247042 3.4361450879450794 -2.3545345655710235;0.059373588379163011 -0.79622252653994063 -0.016456093555413824 0.082289321797910348 -0.30297685613084607 -0.74564955432949176 0.30623282535822965 -0.19188143044964459 -0.52744726368351369 -1.5043911926879925 -1.0470015352689515 -0.77051204316554933 0.47324292586791517;-0.26345077275572215 -0.29536541618675755 1.2120929112291565 0.54689008430384356 -1.2944087801693527 0.77120164444166039 0.071693055390683186 -0.67497607427463069 -0.82619920520930523 -0.60267870864222095 -0.72169897991998544 1.7448726602742528 -0.71218482661297688;-0.15107311461030906 0.017281654887784888 -0.23610760328485789 -0.28893217548577166 0.29117607270140888 -0.61739039861329648 -0.66836673666202251 1.0960871706512731 -0.36624483688420462 0.75946769073260989 0.18422022045438707 -1.3503220141945329 0.43808708140886682;0.66172655685426984 0.25437275012347654 0.093668058631486487 0.13105006011798062 -0.37557385673674781 0.6347443289731296 1.9481484192118321 -1.089288695057099 -0.40592444177240855 -0.65865144586471303 -0.48270369487636972 1.3587326140026494 -0.16240723583680089];

% Layer 3
b3 = -1.3511980072331984;
LW3_2 = [-0.19957771188209217 -1.2566071077977197 -1.6667986852746339 1.5257591569518283 -2.7770787108061943 -1.372172237358003 1.4773723102167517 -2.4882275595224495 -0.33050615117177401 1.9781852459157991 -0.35842110279351092 -2.9797190362890023 -4.6355324895220278];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
