function [Y,Xf,Af] = COTlaquepaque21(X,~,~)
%COTLAQUEPAQUE21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:16.
% 
% [Y] = COTlaquepaque21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.171659085057077;14.7058823529412;0.0212539851222104;29.8507462686567;0.0523560209424084;0.00624804748516089;0.185185185185185;0.448430493273543];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.6141666547307045;-2.424737218556607;-2.0328853156034943;-2.1010437492196816;-0.10213882005680035;-1.1260732307353716;0.065543168572594762;1.4316624737547277;1.111011643449634;3.6690342537333764;-0.828640720999403;-1.5772613429087787;-1.9669104737530339;0.88587973979254508;4.7891181126246636];
IW1_1 = [0.23470829573416496 2.6246688599625774 0.35328092158841712 0.4165951327155768 0.61945259688007348 -1.9207473947494498 -0.086961815220569907 0.061644229519117431 0.26068886805295038 -0.57607408268771887;0.82940408202153271 -0.60466220460277731 -1.4749514803667048 -0.51614252370283975 0.24289046801827668 0.97859336032189659 0.69708301093030489 -0.61878578317917465 0.090381621817401836 -0.53087484786128081;1.0936045591248373 -0.83771308387321708 -0.93846674328330848 -0.984261427916859 -0.067633161120027485 0.79486655901173453 0.30620151005798446 -0.073038457902009066 -0.063229743711543565 0.007618282877650818;1.0569137142975045 -0.52266654882838925 -0.66566314809171689 -1.736998505633883 -0.18352706144829495 -0.17110049363387397 -1.272808431369264 0.0097424471073141762 -0.2163215388610138 -0.18291744251065081;-0.22969354722910612 0.47512895811716299 0.84388263687061471 -0.31329809178563905 -0.42344899848969753 -1.7237499462258521 -2.0365960097025417 0.27456751408397845 -0.19211835090235693 -0.13945426075372036;0.31764932504082732 1.146218642466561 1.6957301244426202 -0.74346782323804195 0.6252555355650703 -3.0500176622762853 -0.014810985997674258 -0.049111804411149491 0.018483649945786218 -0.30008810481344139;0.30022280401544515 1.6691210679313835 -0.37725561106742017 0.3941339286039105 0.080959585667750369 -0.0026091876494251393 0.2550450716182513 0.15987352516728284 0.054481327835327199 -0.13232375694975454;-2.3668721972466438 -0.26659051325093935 -0.022823486196265636 -0.4654122877630697 0.13514216624401015 -0.67620150442477345 0.16947410929832124 -0.2630623711386153 -0.067119652927114595 -0.081343782443825882;2.8684288270640765 0.48443723547900186 -0.24495171012513872 0.41301454222158557 0.23377613035882613 0.18303198901712564 1.0335672683538157 0.39606621781738338 -0.12398177671644742 -0.7653732411279317;1.3245151842477791 0.48097926136342839 0.22041281067679733 0.17483082170250133 0.10447236256665299 0.049446550408558734 0.19067028337742695 0.049653724284380966 0.09038306293895336 2.4482104157592848;0.29465815466342365 -1.2402500338282807 -0.44205948681557949 -0.17226518264809124 0.32307949199360864 -0.2692207859933532 0.30811960655931991 -0.0018124607229086276 0.017591690743351488 -0.42251678918910524;-0.59727630859885317 -0.56204329684898868 1.0832289257010734 -0.14300234462648401 0.53140475754521943 -1.2091261001931342 0.27696360375002915 -0.23709473772881104 0.12637364728539588 -0.28462519311294815;-1.1168307026485058 -1.6850192978485881 -0.66745398451234017 1.0324527789682891 -0.66535812004225336 -0.47762631058112337 0.36457460191785546 0.24184143482080261 0.431125280930032 0.30063844403693135;1.5223785794719698 -0.67378221712709119 -0.12903282644812855 0.3021418081839507 -0.1448378520771294 -0.98928207774959132 -0.56580993014635461 0.24412794391226963 -0.2913950211370851 0.19864525188875709;0.74499884185379339 0.37779957857245217 1.2596911650567457 0.91531719008264933 -0.69137595633569149 2.1425412054018622 -2.4559858097283693 -0.93349985796073864 0.70844571307074033 0.052586334125835577];

% Layer 2
b2 = [-1.0518214419557457;0.035975048337585205;0.77037219369882459;-1.3844812999468126;-0.19280413509281635;-1.318366578822759;-0.28383217126914012;-0.0030557306214656216;-2.0990957518051316;-1.8637064811529569;-0.31949375497753407;-0.89725071389560607;1.7266447138070784;-2.7806642012339777;-0.29448005976380104];
LW2_1 = [0.74794782109437707 1.0106806802599411 -0.29613095745376922 0.1267655148476293 0.058939716099032827 -0.37056806223720884 0.93497225524256922 0.5181151265720908 0.21084753107964999 -0.76308307967286149 -2.0143479185926809 -0.77870014159799816 -1.2869706584244791 -0.17088878371409283 -0.19089876153247784;-0.21533198936283138 1.1162202341473142 -0.92347241456578111 0.23421038508270778 0.13339454314295257 -0.45112682109162278 1.8881231851544575 -0.42860398964766844 -0.16360286189988754 0.75872357164368676 -1.4192232896507522 1.9235519658187064 -0.093536599728385017 -0.019861732988354329 -0.30728142791250973;2.4485015409538819 -1.6801112475543585 1.4588116807999174 -1.3235850493334504 0.77212057197466677 -0.93144162657197527 -2.8615287241612539 0.051251518434570632 -0.064679055459144666 -0.4481969905286094 1.7280570256260497 0.034886385667738287 -1.5930221856156905 1.8301489928348382 0.19980877338895583;-0.31484498355160434 -0.20796431391503273 0.49748965440809445 0.030878383340196151 0.5680042903262702 0.66873321108819139 2.5988672117764096 1.4514302051639825 0.13434482418282034 -0.55456804896734435 -0.74384947941016899 0.063874428037083278 -0.39710413289017832 -0.82893293291151349 0.50628866157657826;0.26074875821759591 1.3275265077748495 -0.061958628610473854 -0.83536343457342299 0.3579180280821071 -0.26958058597730461 -0.52357594302513433 0.17214516401775481 -0.13416379905050335 0.49038635806036657 0.20561385980993982 -0.56011881175344103 -0.71516648968373397 -0.18259476083894069 0.16673671724484251;0.13074287926667144 0.35184712666342094 -1.0101213742430517 -0.037354778016922559 -0.65764470992535595 0.14715400533919931 -2.9509210283310021 -0.57684107561942277 -0.38980680024722791 0.59637123906187972 0.29569001874809492 -1.1748935915503933 0.46835168887364242 1.3602744434346494 -0.68395317672067568;-1.1309522218066832 0.22075987918189086 -2.3779019218165125 1.2693476932669809 0.096925198964214004 -0.7031019622210235 0.84644835851684863 0.83784821880799376 -0.84156768003695959 3.1507393837052264 0.22192757040597663 0.82169393137246849 0.12007343583716915 -1.9002208607198092 -0.4129360611323511;0.0035419649886470755 1.0462014278421918 0.17647698159171679 0.34499147001845487 0.14367503699580847 0.10470902874273967 1.3985604377736065 0.89689712544266609 -0.94845794232006597 0.22500691205418433 0.54684628854381068 -0.35459733978614699 0.56417318869237498 0.33914975275775483 -0.57355546235935539;-0.65086378353734098 -0.27481748227804564 -1.4086471902344306 0.68426699608696706 -1.0703394461202562 0.55950541169173507 -0.10718327717555867 1.0634490915016976 -0.30678627181442253 0.36572401834848711 0.4463966165323372 -1.229727199953933 -0.0027281966935046639 -0.49620352886754709 -0.1321363386091795;-0.13837367539281747 1.8639963501457917 0.18592669656482649 0.99633031832432151 0.00068577922955874449 1.4147149383390836 -0.23502861406850895 -1.5317348740269161 -4.5684043111993864 0.12186036124066396 0.62063809006107973 -0.9067219365879482 1.1712507084504358 -1.4579431357367234 -0.022445710979561821;0.078103024485309272 -2.011645624526055 0.91336347639769755 0.43134663192121603 0.5041194211359461 0.39317738190721807 -0.47782727094196692 -0.45468798544503752 0.39566941612623502 -1.2253405959026558 0.26140247747967815 0.21011242296828803 0.66287653952387593 -0.062148468141371246 0.10732218471432753;-1.9184793907383622 -0.52512795893363062 -0.30789848518182755 -0.40678173564454606 -0.64933082854886848 -1.0694447815463517 -1.2015174728713176 1.3657388116460925 1.2516049985137685 0.42228608494482966 -1.063625434675415 0.43015178635556139 -1.1526596346605731 -1.9309879860630268 0.73917498434258677;-0.2100445122737262 -1.1505272253136807 -0.30036795847163655 0.58394347814821468 -0.58488844283317964 -0.22848622631963275 0.92813870690956413 -0.19087391692338332 0.58238843714449573 -0.11474015756067504 -1.3633262745718977 1.8766848394006133 0.30501135661759698 0.26942400080434886 0.056053921234638114;-0.68461888487482825 1.7330514635430978 -1.4947900868036141 0.77139771144662139 -1.0283001544258676 0.99763304260065433 3.2657447724740916 1.9775423407049442 -1.0901120618607196 1.9352238252906084 0.19103081947004549 1.2641341299497673 0.65312105784669261 0.15348393653135511 0.03514876468545907;-0.13441296537013259 1.9532410688699264 -0.98214739915889426 -0.58831743067889974 0.16612670549646541 -0.58152627789086064 1.1558609549337862 -0.59586169061455407 -0.55410544074231993 0.057239220308915782 -0.7255867037317415 -0.080878327989040183 -0.82701577050613484 0.3731380374784859 -0.4320946122402658];

% Layer 3
b3 = 2.3492411667633371;
LW3_2 = [-0.96681924655051721 -1.3344267741071063 -1.6055623926140363 1.3899752681793234 -1.4125230467303658 0.82978529142718116 0.78708743168265005 -0.83144818070184756 -1.0103196510874739 1.3046214909672207 -0.72997903409338449 -0.17750624603079959 -0.89210043712331455 0.64858466983960983 1.4058909237870951];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
