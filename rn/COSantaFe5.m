function [Y,Xf,Af] = COSantaFe5(X,~,~)
%COSANTAFE5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:06.
% 
% [Y] = COSantaFe5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;10.752688172043;0.00341273633199099;27.7777777777778;0.00632111251580278;0.294117647058824;0.448430493273543;166.666666666667;95.2380952380952];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.66199871805449007;-3.6994426197490915;-0.77999701500764185;0.213082331237295;-0.33193232915673404;-2.1299910315691348;-0.89099847756041051;0.61490704512182315;-2.1193855215410751;-0.84431414274475303;0.44337324309614845;0.51717335678435861;-1.9566367658752253;-1.2336060346107411;-0.7352749424904077];
IW1_1 = [0.16694248096234415 2.6971536461092773 0.16842328353436606 -0.36681038491828682 0.070643688726872003 0.11793392677770999 -0.090011542015305618 -0.022434189922683211 -0.05398513040562157 -0.35456396778231825 -0.0075551504099512857 -0.062877736024898268;1.7355756540468867 0.64105308472761791 -0.79535583145911104 -0.22288943329647234 1.24257696989975 -0.56503705920902059 0.85257737630716601 -0.7744068307370956 0.75045357724553652 -1.6435176971775949 1.5246104093163602 -0.58443077104219021;0.67643521484255287 -2.1434618010260911 2.9182923277818347 -0.89823622879109555 -0.82087174583592537 -1.1955142199582769 -0.03578737393449026 -0.58146639740918249 0.35542187575364059 0.28382001008473279 -1.3751739410987325 -0.74270483433043466;0.56953917477312277 0.984812336956705 0.10092828162839587 -0.41234806128851026 -0.064045838894334156 0.1004762096018403 0.087122027698126797 -0.08623459881434177 0.093506676821034126 -0.40184140924850492 0.027965686513596856 0.04945754878417135;-0.13743019491073191 -1.7929939938094521 1.6470043629338376 -0.079614494587629453 -1.0570718241651227 -1.0560413536464301 -0.42118998037550853 0.23573592418663411 0.35147580693831842 1.1194077203037236 -0.50416782692551698 -0.41587690400549482;0.26708916380806541 -3.7352627250134578 0.13626248962591586 0.17167956836471132 0.084873316556439093 -0.31110375534736695 0.57948418563232518 -0.016006136845404615 -0.160477317783076 0.19179032514150102 -0.14439953625332352 -0.12248175505875511;-0.30237942960766839 2.1601113682679713 0.58297949377406133 0.08129269285803957 -0.50744437904258133 -0.0091116220592708068 -0.66039999972782992 0.16789536785066253 0.62139266889575795 0.34560665952642333 0.67826520303939908 0.084858878129415394;-0.5875710514802045 0.76363899420976444 -0.39583809963793787 0.39449385396062508 -0.36758318363162917 0.30260976208799023 -0.0098384423316421436 0.25421196056881973 0.44311324933366958 0.45262107167442089 0.70718085381130735 0.12744507109664724;0.54799571091401911 -0.31114814894027842 0.48504207652176379 -0.44132118058205161 -0.020763438464808541 -0.12564101702092276 0.37869758461014752 -0.045991480341653339 0.51721039138387814 -2.6767925749219676 0.16698458789961992 0.017035889313038607;-2.484438844316661 -0.46284833008275084 -2.1539374211173792 -1.501361922100076 -0.26853455527816494 0.39543298053008546 0.17019766339545481 0.86337910881256474 0.97495623552092603 0.46407786439545873 0.34862065452089114 1.2366303460528392;0.5633851501562972 -0.90656695020599531 -0.38570342869651181 0.31051843760827963 -0.17006686109527647 0.02401564366082648 0.53101020011592948 0.020600015136564846 0.79752217989614516 -1.134457629844039 0.52887473224102521 0.046551224550253512;0.46117674077384518 -2.3253032126369573 -0.18448456672453215 -0.016979703706203421 0.26742930668903192 0.088758801324357359 0.11630065694244049 0.030896623861053608 0.45489600793561363 1.7523668117185986 -0.035186840861273092 0.027414031105424706;-2.3850056597070126 -1.1455397852449043 0.36492768606725845 0.28708295522680194 -0.26276960889358714 -0.0088883531259294109 -0.11500042594636414 -0.13009055596907135 0.054832740565213547 -0.66994502605147654 -0.062346135166258282 0.076416026282752625;-2.3047618358012412 2.7578100661446445 -0.75001388961870075 0.12653245164400823 -0.032115179824266149 0.13301695902030605 -0.94093173370400074 -0.045561510296605767 -0.28884481954750119 0.22380956267277136 0.024403743962739789 0.1904958075287892;-0.327728512209637 0.56546112352382583 1.688858636446005 -0.71034660031861996 -0.57140704993795055 -0.38834067902962055 -2.5006666228295797 -1.3899669572621214 0.40248688867169202 2.2363613261383026 -1.2269267152588086 0.54515874041700985];

% Layer 2
b2 = [-4.3416486022566616;-0.98249754460202021;1.3944312150838725;-0.63987018433430876;0.86668483386010065;-0.82599930038271518;-0.35027796269889339;1.8281308484971808;0.52182733208179366;-0.80073257651405239;-1.1624665846611628;-0.82808565105081289;-0.80661195522703244;1.475839625331798;-0.15911220489001196];
LW2_1 = [6.1622503930843902 3.2270472344770766 -0.12582013015144469 0.24189152178394382 -0.17818676320510771 1.1429188255147456 -0.93879422238844557 1.1376463900318989 0.43681717607077802 -0.1157808606727191 -0.92123178052840615 -1.1785142615110813 0.43787774276647196 -0.88211968123904061 0.20086112644623899;-0.031423031811207459 -0.10792509746270379 -0.26996012210823933 3.3912823715060867 -0.39484824877332914 1.6713528671412494 -0.38789622467998208 -0.42819637083494277 0.14247051153886794 -0.31886927893100486 -0.73472438603783718 0.68800886798479266 2.0300920057743617 -0.32470474727283904 -0.20826118883275191;0.5464803606614318 -0.07719486925054056 0.60170913388372582 -0.43853162440468135 -0.21484487900089946 -2.3679648125013841 -0.50761662825436138 0.37913583766577469 -0.87737143079838953 0.70046951333935104 0.25190981549554858 -1.1838479508840987 -1.6539559680399474 -0.45669993115404234 -0.23627380781569765;0.31199407676667457 -0.95068840119818832 -0.3071450997116888 -0.55101860207477815 0.28367618700783476 -0.85900626448323114 1.2540867085386196 -1.6073711329499429 -0.14111797251767305 0.23294052771252111 0.31295688945415429 0.46543773396721011 0.61441733564937417 0.63230141453598288 0.080990653012702502;1.4897970363940523 -0.21240642277685068 0.60479221091637192 0.4175403385142552 -0.36828119021623823 -1.3652700833053406 -1.2120527634037086 1.1013351869941517 0.67795738701559216 -0.27173904889379435 -0.34300803936005958 -0.46028559336140701 0.10330528463442377 -2.2930786013853535 -0.1243688324880439;1.2919532736329047 0.16316748529417455 -0.64501209559280714 1.31725493228859 -0.62589297362201168 0.67955185703899945 0.64935587427805586 0.21668324880575546 -0.66544709398536628 -0.74060046790461409 0.20976073279354987 1.2268228521795372 0.60374219021655573 -0.36669387820559296 -0.31773459951785638;-4.1314661765049348 0.4399901511486089 -1.8037828600083377 4.5784641038754206 0.6732491013599794 -1.3689640913489898 0.25821498442368057 0.72112428824604546 0.071799801422475898 -0.12923814220939858 -1.7185746707403444 -0.093902742728382269 0.045273365330715923 0.10982586512711248 1.0588110371232025;4.3897926641461495 -1.8719797736751675 0.87334971399805472 -3.0446295880984842 -0.5477480188898507 1.1802374842759185 -0.17947956075843341 1.6667182502711795 0.24078255359503234 0.61426554297478708 0.72642724263197234 0.53801697621547673 -0.74725471844516089 -0.4005804912838829 0.14787275786231169;2.0149031230644034 -0.81394876766121416 2.6868912201231745 -1.7299652814794655 -2.8912553461542787 -3.5501623382685086 0.68779920751240797 0.72074437020342375 -0.69061885793528688 -1.2242985987084654 -0.65540650691250613 -0.56018407257213121 -0.38301969717247453 -0.16481007985760299 0.24879152827234877;0.54895979685098995 0.34446110073539815 0.46990921473099956 -1.4561951337120458 -0.3742078729819055 -0.42057113887590108 -0.60394395081306729 -0.34693183469152056 0.69662292282146776 0.59740329711048712 -0.5437355100834893 -1.1298174062545467 0.42036176054688268 0.29979628870954983 0.10841853219475939;-1.8321509677142429 0.2734546194505153 -0.39195943405967199 -0.074833717431082719 0.40223435281125791 2.2757947046786824 0.64680361587012913 -0.73508233221601826 -0.642408588799256 0.46172140564562336 0.41586026549849248 0.25953243489139843 0.24675764130062358 3.4719275222991239 0.12708386906518709;-2.8587272802568409 1.1325128435360381 0.20555757695814489 0.22767690938141066 0.14810409370338878 0.92744987694048364 -0.92152672968573546 1.4450321364280903 3.3492812817462538 0.12621729001737 -2.1327660110437288 -3.6100979023018076 -0.88481754197627993 0.48032751214131714 0.18631381642542313;-0.65154500077543454 -0.8611224022023749 0.80133697120116087 -2.3669222303230035 -2.3385493526227705 0.52400001818688124 -0.22085891285468626 -0.021890784897668596 0.18830255985004002 1.2083909159232873 -0.49967064238018338 -0.22661028525741322 -0.77977279700102053 -0.9865347118634763 0.3170785651328859;0.17868629403925237 0.19547985695156994 0.22860877483955896 0.087338649051290088 1.1847555475867959 -0.21674221209772135 -0.52823433404896702 0.14373376663931922 0.73456498252639391 0.12240632366688475 -0.018104362856615125 -1.0953467819917733 0.72738490667068101 0.63195062727282048 0.20918273393406342;-0.28339374528294692 -1.7844926477974039 -0.58997345987085148 -0.70851680585871712 -0.55313488083340179 -0.17148067477404186 1.9147840557733344 -1.6922872250395162 -0.50973612122230283 0.3154487873418087 0.31499919370808804 1.279465563983383 0.30555622737975136 0.14451664080864945 0.21939968364751089];

% Layer 3
b3 = 1.1844959311234329;
LW3_2 = [3.4747770382240617 -1.1309257253203227 -0.47048445203011496 0.78091886741476468 1.0468515638191609 -0.2683081868831152 0.12579250742870893 -3.0349444300950048 -0.14191662296023372 -0.48577638903238612 0.79031295334130358 -4.1918111966011704 0.30208739686898572 -0.71284244662840013 -0.58713424844383066];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
