function [Y,Xf,Af] = O3miravalle12(X,~,~)
%O3MIRAVALLE12 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:42.
% 
% [Y] = O3miravalle12(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.304971027752364;2.48447204968944;0.056980056980057;0.0063552589768033;15.3846153846154];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [3.4070858607551293;2.578826676233851;-2.0129094401093837;-2.92446748849164;-0.96720461030770055;-1.7427127409521013;-8.0923550650291194;-2.9503468640623733;0.8186762172773191;-1.0646176737486837;0.56350833444121917;1.0631206238812718;-1.8227962924583938;-3.9225419287161167;-4.1564182863067343];
  IW1_1 = [-0.33805659898463897 2.0846637924168006 0.44360691854710915 2.2798583344037811 -0.37074987232925966 0.23494558451599046 0.18214885182832929;-0.83549255869377315 3.4440144487220468 1.6864136449976794 -0.4200998600671067 -2.222500502706279 -0.7250361035755386 -0.021075458027163943;1.408936598666473 -1.361246597139449 -0.52432418786455026 0.0037077219434368744 0.52090044346312725 -0.22975699417937137 0.065359877396414356;0.40853403336167599 -0.98420081202406917 -1.7375025921174398 -0.51673592393992007 -0.49445422862692939 -0.060850527261191806 -0.70006584801229876;2.0558749367108593 0.22065963756606399 0.14978967991895725 0.9240176603622815 0.17322096355360486 -0.0070886037587815443 0.24936520334309889;-0.74451893970568761 0.87458079900198882 -1.4646612072886731 0.070417452258790508 -0.13811882685357652 -0.10415700032407874 -1.2655326851018585;-0.073622496362952025 0.30324942885978562 0.46093567962180232 1.9480512877535021 -0.55652525591011426 0.11970928087172457 -9.4382890636602887;0.10591953295828896 -3.8170783701252331 0.1167078638093858 -0.28504594040251274 0.23954527389385491 0.062522441399277429 0.17224739510728324;-0.84416381231136584 1.7699762256420399 -1.7207322961287523 1.6007501426211188 0.458706882093665 -2.7990601642914217 -1.4203992299393571;-2.0454811194762081 -0.036882409667919752 0.12772064104753622 0.40513743131615132 0.044426673335536362 0.087963827385384497 -0.10871628005558152;1.67092995683891 1.1647422484475507 0.67680244607196738 -0.20918750148385529 0.029426540490154179 0.089439624688400859 0.027529601194880383;-0.80951958678847979 3.5700216081108151 -0.48172382401388786 -0.60161286784615453 -1.4688844910496786 -0.1923392722886044 -0.056497221603592246;0.11513655160407006 -1.6574533682358825 -0.54819435005935835 -0.010270938554044592 1.4007462819450947 -0.53598434640468751 -0.17867864155315208;-0.48449814467578878 2.0793787716892296 -0.25471076532025111 -2.2922198690261695 -0.028189720488218911 0.24028891122434437 -0.49582291113196875;-1.5555099483203234 -2.8286697113850243 0.90968231316655834 -1.1207738683487445 1.5570972927327238 -0.33307554431905195 1.3727901340784983];
  
  % Layer 2
  b2 = [-4.0107206159498103;1.4589595131481938;3.0867367631824489;2.8171466359830162;0.53616952497692427;0.81572557985382765;-2.498869949955747;-3.3461917016448259;2.4399178765093739;0.71502131653787138;0.11297446286377626;1.7343848492365164;4.2108889648384764;-3.2059329486400276;2.1576645606367832];
  LW2_1 = [1.1273077411657233 -0.5551773472215592 -2.6529169675160476 0.95084843437685862 -0.36865155086156653 -1.1633061490332011 0.11384700054237779 2.4688829278354887 0.91794191976564721 0.94872483890377002 -1.5492744136420042 2.9737430575182904 -3.021430210865633 -0.18729170295619718 2.2496760812825047;0.68085308933511191 -0.16242106408721121 -0.84950070956954071 0.31526075554141586 -0.96003996385234336 0.96249731407586581 0.060350564235549096 0.15555770983111727 -0.061013969459158407 1.1088722594422828 0.024076019971646621 -0.022912564437161595 0.61953658757181729 -1.3248623558242165 -0.42611704983852311;-1.2994837116115361 -0.47243606386500137 -2.5910487911127644 1.5061430823739728 -0.11635152808673724 0.46556889365910586 -0.1482180405626293 0.68169518632474835 -0.11459340804838694 -1.6763087519963038 1.378469749397095 -0.19461069532802308 1.0134099531915124 0.55176774696851594 -1.830284198111811;-0.63198984197476982 -0.35492007329606456 2.1939811572196 0.64394372387793253 -0.77217309599074657 -0.87373492707391354 1.0157366418831999 -0.02848254366161785 0.41700578699873297 -0.25955814940500777 1.3595994889796614 -0.11026041283758931 -1.5488862544396951 0.43867032598565259 -0.74746793923585142;-1.4137780660642161 0.79955029264662525 0.79697200552775782 0.20902167203408045 0.49207898412216555 -0.77279286184044749 0.20064294503034108 -1.3972137213233871 0.34982257503893399 0.54465482943363597 1.3739493740318862 -0.88885250041212227 -1.824644372862958 1.2768698782055874 0.017924407602674313;-1.3664037762585224 0.43616946958728503 1.5276399705535852 -0.61555437935407098 -0.59915628403880616 0.76150610886702663 0.52279216327435507 -2.3111980096251212 -0.01745153121790196 -1.8471465849955266 -0.77760541666412131 -1.5770023758037865 -1.3522144755010548 -0.71055151990412102 0.78292634999203925;-0.49395298435107177 -4.0501854838208029 0.22634647798389965 -0.75067977089189342 0.72658701578839813 0.65030707921069131 0.23632132357129068 -0.25629288879940126 -0.95942132337282193 -1.3282351220570336 -0.69351507963763104 0.63003656649720308 0.56611820557264381 1.9140242125209734 1.2917128363228654;1.4034666286937945 -0.67828863473353151 -0.56681502612803047 -0.36433196391264766 -1.1045725798312924 0.46159742817689442 -0.17100783509357534 1.3771474043960465 -0.28047825770974749 -1.4768035118715961 -1.2022429621825852 0.7924140952698927 1.6296675591384342 -1.2954137264335914 -1.2428164515121762;0.69213628874855015 0.012264339283872584 -1.3716281868948235 0.74417843908207348 1.752237671225177 -0.14829216927196509 0.13573521757968685 1.8390917403788574 0.084925423511546569 -1.9872728892357316 1.2009358221630906 0.16475140977979424 -0.011542902288254719 -0.14923178030006853 1.6139653856894216;1.40907094314685 0.26450875443146216 2.2771521916251332 0.71958461795150652 -0.54225758247769007 -1.5431852617968547 1.1152834594647558 -0.50607674441235817 0.090502593513411028 -0.30034217606243907 -2.2988587582889193 -0.59304237572918506 0.43243104123522136 0.0059856212811753018 -0.71661075862880663;3.6898909833893652 0.37550346966189069 -0.92629633083180141 2.3593055873064039 -2.4486510826381145 -1.4215590320522895 -0.36578360070440219 0.32117275690737884 0.62253740816523706 -0.78094047798757737 0.75888771682866074 -1.4579372132219848 -0.75371624649084223 -1.2649604610448959 3.2728930406603376;0.66967586022507331 0.22706400545747005 0.79377437924149208 0.024114493374258545 -2.1377132584089087 -1.091003659393978 0.64508578263467364 0.40914906312271387 0.31597051311142926 2.7855722709577369 0.11928997425395593 -0.13449484051780797 -1.3527360393872008 0.49746196548472094 -1.8056211579441317;0.57429542478138196 -0.17396525182710212 -0.19296839760851206 0.65467261534171994 0.26343056261382281 -1.1445742776473558 0.67756878143012822 1.3879404644231657 0.26129592651258243 -0.44426842130625976 0.56636158760023558 0.47049666683985902 -0.48002449343580356 2.5669845424502875 -0.018148862562015075;1.5664242017087522 0.51701793516066263 1.6702083223058057 1.2381765690947633 -0.28395133698773928 -1.3037047756480633 0.82071080578534128 -0.89829452287404665 0.0073716469421086167 -0.15617834074251935 -2.7206327294512733 -1.0863557209103287 1.2012022513167291 -7.1743301989812176 2.1142719579910163;0.34248044329927224 -1.0834866297241268 -3.7285832626087614 1.6227012054590106 -0.48499245076356001 -2.2388798749966283 0.16133133380836912 1.5996265733718633 0.31273947940950175 1.6414295255463351 2.7126883183056374 1.9339308975671645 1.4441247548689402 0.03086373844968858 -0.91329036651146733];
  
  % Layer 3
  b3 = -0.65341987259892986;
  LW3_2 = [0.5380675218378107 -2.0106078045182652 -0.71724399480781986 -1.0560023777118792 0.99678195942831294 1.1894179659423834 0.6157200240596421 1.1101468794032567 -0.60487435958750047 -0.59867072051656289 0.30584079241779644 -0.82714826643424899 0.94509349764205619 0.47195811116566277 3.6028142731613024];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 15.3846153846154;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
