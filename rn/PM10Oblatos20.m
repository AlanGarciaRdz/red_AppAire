function [Y,Xf,Af] = PM10Oblatos20(X,~,~)
%PM10OBLATOS20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:25.
% 
% [Y] = PM10Oblatos20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.100381449508131;0.00618238021638331;117.647058823529;0.0560224089635854;0.00280033604032484;0.00462534690101758];
x1_step1_ymin = -1;

% Layer 1
b1 = [-10.466319736656962;-0.72980842452714223;1.3802140268837431;1.4150330135898419;1.0987504118078697;1.1393774867419777;0.62808478986944583;0.88785068215573504;0.54336833862477596;-1.5771396285656833;1.4585201928216376;3.5412147019924807];
IW1_1 = [0.32887613787834113 -0.078018572932932073 0.71400386201139954 0.29058228553258508 -10.553921789697851 0.51708212844164647 -0.64835317089560895 0.70454391332450739;-1.4118874836240844 0.13116479726374738 -0.89279404244334482 0.20439420100744435 -0.88885228627178536 -4.3831847374437647 0.88928704014433468 0.4112150474316757;-0.12616196676039168 -0.64369498113980528 -0.32877369349669339 1.7511376075963438 -0.0073084561878189007 0.71772673052209401 -0.39532295348359553 -0.11272492543129485;-4.2396678858257006 -0.34428463632531947 -0.79382780025947386 2.415880044757543 1.8678792049822004 0.0043834707507019836 -0.38336690399185042 0.17501934720604392;-1.0450854497157109 1.2204824906275784 1.4310225424691689 -0.40964420090960096 0.42638835845889111 -0.26161646060830618 -2.3149094167165458 0.12454291817446794;-0.54429681857663792 0.1975071855197692 -4.7151853568026558 -4.3162536848367594 8.1198532748963874 0.1681895791897394 2.2675006346309328 0.86017223061702974;-4.8826663633985792 -0.56599526149677559 -0.35027349629844556 -0.69400350474227746 3.2162804840587884 1.3963766497796015 0.34608479008677429 0.9491714162563476;-1.4259966320361033 2.0056305781195936 2.4495764362036372 -1.4268993475585845 0.77821323834120537 -0.48665521400479883 -1.8118177755698008 -0.71458233785021485;-7.9071970755419079 0.79808173173848895 -6.9381585263137522 1.7358121022137929 9.043400616476946 -0.45280910095855254 1.1430787227488688 0.17866934743564455;-0.94377586136339786 -1.3002636578895466 2.3949484847744538 -3.7110045105473572 0.64957769139176935 0.62939437960647859 -0.70863095708250723 -0.28290628496103748;0.03506958378322797 0.84849133949963973 -2.1597386570121992 3.721427551176991 -0.37264190567433542 0.94202329003718877 0.74283587340128887 0.15072267848493734;0.062218306313919294 -3.2127599412829757 1.7248081914429205 1.1874056186007134 1.139227949875081 -0.90617123814835465 -0.48070670498450424 -0.027917569254771835];

% Layer 2
b2 = [-2.0264514452232834;1.0652753063487344;-0.2514912846643732;-0.70361338984239041;-0.15250261265773452;1.2695253556313835;-0.68516588237821918;-1.5145867867117719;-1.6570546414269434;-0.34497405044339069;-0.10977387969926149;-0.27705392452079469];
LW2_1 = [4.5726505634116821 -2.2926703702534041 0.13338721430439485 3.5742817690793149 0.88099048575749417 1.4088204337468173 0.64864308702224838 -1.7353965786263741 -4.2277325524042233 -2.9309000721064575 -3.6044025572705198 -0.52661508463285811;-0.08707813316143212 -0.24939923870293643 0.5867207847731557 1.1599706883276864 -2.0069371929776287 -0.0031238296970678447 0.25551224996063826 1.3466472264120921 -0.29548678933362177 -0.34834043375485518 -0.34193704750907133 -0.85293949230323185;-1.1020559238665153 -0.11790271458242303 -2.3802106976427817 1.4044128486640954 -1.5682240852416665 -0.1672208161414315 0.27833445964942805 1.1058614744067889 -1.4164345606615534 1.1722036606237403 1.7493232436709376 0.84168522450382499;0.67363082387963125 -0.081372671150752807 -1.0887511325718555 -0.63993213161286566 0.23856769545860024 -1.104219869634232 1.8808533105003677 -0.68041094330547147 1.1828734430819923 -0.91390145732593486 -1.8729471560954927 -0.86867410458239125;0.069944854435482914 -0.11382677524286709 0.99816312276212538 0.75480480866825461 -1.0680479294858765 0.12181949586498325 -1.1414613690656876 0.62034141166619738 0.22309510431564367 -0.81970029942754552 -1.082150002747857 -0.051405221576296942;-0.16180420857677796 1.9953884575793972 2.433832262991007 -0.14643750608292402 -1.140808257362919 -0.30192377928483721 2.0515628249526463 1.6082473964118125 -1.116010898686681 -0.023339207030886266 0.5497255351515169 -0.43801797991433744;-0.32804734637603339 -0.98003571976126302 -2.2801908339656625 0.35635169470116823 -0.989159771034122 -0.18414469461544633 -1.4848280772724578 -0.47856382273752807 0.18124745399503742 -0.89437041450780019 -0.53876355327105097 0.20981246668181514;-0.16492404653841655 -0.19207857746378712 -0.9692158188786778 -0.5772443364251364 0.40963803439231194 -1.0522441013027153 1.8334675065590946 -0.79203529445696663 1.1171002122339819 -0.92867729085348305 -1.9107452798648952 -0.94046397516078384;-1.2451939116069 -1.8158527673558422 -6.0948791109677094 -6.2282840305182106 -0.34235573737940778 -0.54885257212357907 7.7531454865038905 0.70722700056527465 -2.5341117414939704 2.4568003627098798 0.95056824961305519 1.7139623684236274;-0.2767379548873975 -2.3020043140802868 -1.347196589201765 1.9819286273001044 -3.5638732715324171 0.75108478940584589 0.46558641631509434 0.37879897185900213 -1.6689177069559618 -0.62199042845151076 -1.1197407231343273 -4.4048098552941788;0.22975660436014192 -0.12685251897680067 0.96128702446833858 0.70324439179981768 -0.53768685876752564 0.13943720529299516 -1.0352801335829056 0.3102475564692494 0.25498775879532054 -0.69388845092797025 -0.90043375613560017 0.088048829075242085;0.17094592555438692 -0.013949129176776341 2.2328787992699444 0.5654067911057622 -1.0921355113472191 0.30569974329717237 -0.78252457992629054 0.57211991359266468 0.41329152908772326 -0.9857211488459291 -1.5565940653898929 -1.5424176675628332];

% Layer 3
b3 = -0.77782384628681855;
LW3_2 = [-0.203744706311589 -0.34088283054445073 0.31138054243627034 1.3617932748301509 -1.4393697312000935 0.18847589643017232 0.21519807645733394 -1.4120702367616234 0.13908075465690153 0.073908291602626755 1.5363095181725377 0.4944314292438835];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
