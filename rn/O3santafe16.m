function [Y,Xf,Af] = O3santafe16(X,~,~)
%O3SANTAFE16 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:50.
% 
% [Y] = O3santafe16(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.172786177105832;4.16666666666667;10.752688172043];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [7.9304555084428099;-5.2713155565483252;-1.1897887514682832;1.9156394947186639;0.61956508385857145;0.061708449400743777;0.36647495794802248;-2.8380992636377931;-5.5132783306149413;3.9852543836096888;-1.0573241508870264;-0.63198646582187645;3.2673296363880659;-14.409536120544351;-2.9391984072211161];
  IW1_1 = [-0.78421537131943386 -0.006285400268584848 0.18100474776262698 -0.27197310139286468 6.8855742869883603;1.9915542696589199 -0.48218541134293236 -0.044812966193875592 -3.2239834000382057 0.51025727508101848;0.5190015402916589 -1.3331779129916106 0.95697383571374783 1.0181621363714002 -0.12556356894065768;-3.5512714465752406 1.035179128077677 -0.74206975637092487 -0.7014839771936644 -1.7903201130897823;-1.0134824827668554 1.4010332786443112 -0.25747957851324282 0.065071278003972083 -0.021473467053822221;0.037363836201938325 6.5900966642245189 -0.96145321670891826 -0.48763472790512874 -0.56478567840729743;-2.5157442852540592 -0.65028040593284264 -0.20743591796948838 0.01054526251948463 1.3210491423211408;0.45365325983689142 3.5379695624324419 0.13839636299957908 0.3599352474331704 -1.6290507530560256;0.023238459657936399 0.57108929791841723 0.11967551577340561 -0.018098079586766465 -5.2090202908459844;1.7455082197164915 2.6482543110946386 -1.0459204467703154 -0.70128355096809381 2.8523818703941126;1.991010676144692 -0.39531393025511447 -0.25590327133764051 0.49072229902951309 0.64092963618243415;-0.26610668382071934 -3.3601831127264217 0.82427197768449045 0.38658161195596041 1.0232789172855314;2.8675300571559648 -1.1379293592345523 -0.12947530593288334 -0.052507705826261568 1.1206379529708386;-1.6974158787163283 -0.97613185317475659 -5.3594451700526093 -6.7688712734073224 0.063382374341047376;-0.49877758225826108 2.3880986860711051 0.62229426497579143 -0.61021284089271643 -1.0414800086657605];
  
  % Layer 2
  b2 = [2.6788958733625661;-0.26617803892422581;-0.50732089388203438;-2.1992313754327726;-2.2409662802549524;-2.6579262729980173;-0.49167419877312535;0.76628186801437737;0.78384462312823711;0.33394208333931436;3.2187424329620056;-0.50115306685335392;-0.8343130556101076;3.1828413985152229;2.7248667495562771];
  LW2_1 = [-1.8169946809398705 -0.46131970916315951 -0.83934608051135751 -0.61713973551404944 1.1337680291603272 0.13137631445687337 -0.64268512494989094 1.020969003877785 -2.4774118632391233 -1.9641732741050635 -0.58444294683276976 0.78522122991076615 -0.59921083274263587 -0.62650083461112382 0.50460139287455497;-1.2441431044557032 0.56939959952940156 -0.97944548636226747 0.70218572928236744 -1.3770909633021806 0.15263425240246395 -0.61339973195103836 0.86684818870836033 0.35265011612575359 -2.4847859076484973 -1.2150969580942621 0.86860550100700995 -0.80255376953919488 -2.7799214204533489 -0.00036689540644792296;1.3558695718870875 -0.40060195772414026 -0.024180974483753066 -0.71096775140544743 -0.82173677396464584 -0.10377810055374535 0.55941717765612031 -3.694314677611974 1.9515470722781305 -0.061492847839556414 0.23408863963436893 -2.1040754615836472 -0.10222065295661353 1.7370586503559331 1.8489251086754657;1.4872942909728486 0.53879675764804558 0.85482585419475221 -0.54842465897641712 0.012309811007020176 -0.60632684408329429 0.52560839352620681 0.1011708791327873 -2.0904146766087996 2.7532868114278202 -0.0102367054687501 -1.8554737033199729 0.31959900358577387 0.61163228802759684 1.2866099272095584;1.4874896909277326 0.74566110548644982 1.1057097197543297 0.91144996915932552 -1.1547761152697664 -0.16216187127214396 0.86501647200667453 -0.49406139725368597 2.2063019875880743 1.9480525070430132 0.53657751184484559 -0.86666867701420014 0.76855672242105966 -0.10013062054599285 0.0093021559999814634;1.9610654475467832 0.60615303351339744 1.0698336811526297 -0.33190431874822768 -0.15041299802831434 -0.4046113928961223 0.55533115584908022 -2.1548741791969559 1.237773369180146 0.48896306142969764 -0.34109627617452698 -2.3301549758343851 -0.53757236326389479 0.29371118985551986 0.44484479453855685;3.1368929398765251 -2.2059711987871009 0.04220706132826791 0.896463892726171 -5.1631533685255029 2.3380436761688621 -2.1031294684016455 -3.283726623501797 0.98960360156888194 0.7877312694184343 0.48694754879465951 -0.46665282576091077 -1.1263705693948176 0.1445570446472004 -0.67118084213635765;0.33099294173586974 1.7802517512558618 -0.95762306473863323 1.9569521776150438 0.99339375240776517 0.036118751287005514 0.84201020451573738 0.32438487278811684 -0.7768248207705104 -0.47455361234713422 0.90094367129898545 -0.57805840208873049 0.013995092289206715 0.48516358550334387 1.5121922388647491;0.99980782541607238 -0.076277047655810906 -1.096854672430752 -2.6319891988037969 -0.4635829305901108 0.35822040769215191 2.3789829630222736 -0.26329506191123497 -0.498784052244168 0.26662458926033761 -3.2337784695550731 1.188494600741391 1.8743340151095491 0.53145823226765188 0.42658148904562387;-0.4825783192757806 -1.3382825096251949 0.37441945207448346 -0.83653527479173828 1.0837761209899519 -0.39109632587406001 0.10386512223797277 0.13015944891698633 -2.916452848136351 1.5711269868955267 0.93135561381309928 -1.0515791140100053 0.51337743488744081 2.6999597814902732 0.75446365803717186;0.27599364025315171 0.64174250461356419 -2.0790718412882168 -0.92416795736733659 4.1348755909307062 -0.38697805005162611 -2.4615328220680062 -1.8450450191243832 0.10590547949990828 -2.0498049607611519 0.39458432250327358 2.4072807518285888 -0.038117963317187593 -1.2516685737215616 1.902914488050732;-0.50809245743935338 -1.2947890802136552 0.80769766993903647 -2.1890052343422677 -1.0394700225569002 0.087673411448140171 -0.20208622274126251 -0.32657214927363437 0.71831731117382669 1.3726966008029868 -0.57783812898911757 1.0662143743868655 0.20791115291450252 -2.8557597688432721 0.22376636817683784;-7.5537196592574407 -0.18919461965860354 -2.5407985552718331 -1.1584608525717932 -1.2158183294334628 1.4689377830948767 1.4300669758016877 -0.1730231020601902 0.94528368256938278 1.1622393849627872 -3.3671581025529105 1.6309002467499125 -0.24208060434857914 -0.79150321765186993 -0.46989069057423649;-1.764009433701778 -2.4601553646719605 0.023880465656503091 -0.84485219209196394 -1.7688368746166285 5.7088688178527143 1.2721798408445801 0.25596006348230343 -2.5781632129219862 1.2183073526776691 -0.22797306613600346 0.83563533027254189 -5.7175846392083098 -5.8458716919067477 -0.71305356206222958;-2.599456588857052 -0.81819035113720062 -0.54732911993883071 0.71113459872700857 -0.75578865046059129 0.63814940798871156 -0.58546374393968748 0.59144349834400622 0.13276898901502684 -3.0604871012950716 -0.53159648004290683 1.2771797738481649 -0.25388291085229098 0.33971065465165284 -0.98725536271425052];
  
  % Layer 3
  b3 = -0.74059115708392875;
  LW3_2 = [-2.875377955508772 -1.0109035161746067 -0.63492734484140445 0.8049145125621574 -3.2546278029711928 0.89993443856197952 -0.47338785438651715 0.58580771316970892 -0.25913198678887261 -0.93675830440350805 -4.1909588662107673 0.72051880096903187 -4.820388725113002 -0.38407406419263207 0.90534920580848588];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.752688172043;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
