function [Y,Xf,Af] = NOXMiravalle21(X,~,~)
%NOXMIRAVALLE21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:29.
% 
% [Y] = NOXMiravalle21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;2.48447204968944;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206;5.12820512820513;4.16666666666667];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.46255602504707993;-1.656778324245737;0.41449693661295384;1.7173402269093243;-0.17721976224229966;0.22405411642377554;-0.16779529599903587;0.15062298550191422;-0.32070419070056766;-0.62373846383304488;2.2094089002629227;-0.39394348106543242;1.7021736045937403;-1.0168265914030818];
IW1_1 = [-1.044988225144952 1.789755492767015 0.35677424338723601 -0.096222732450709725 -0.37920437439477778 0.28562498304833828 0.33335533080345231 0.055082023753226017 -0.059747662650097594 0.3220055511239695;0.15034307864681976 1.6100012606369225 0.28298837010187805 -0.020845679136952427 -0.013815237352488782 -1.0706220614303592 -0.87144662973655163 0.6622740409708141 0.73653652662603397 0.95189426059078119;0.34044732339806466 -2.8306956853639265 0.60483708628985888 -0.38285800832684241 0.5196435453040944 0.34191838263862012 0.13910941299079374 0.16060838955024503 -0.0073616054801092078 -0.66573868326070207;-0.15256757414540476 -0.42546220430713522 0.57460039542513541 1.1145173523146128 0.9196766164389526 -0.27556434613452807 0.12927176113652225 0.43157678551493345 -0.044692444739583698 0.10561030101987012;1.4939383427106132 0.36186766482544314 -1.5136592390788774 2.571003087617834 -0.17133867224401855 0.6217437137767341 -0.45913401949277199 -0.0018029295069822288 0.11805945952393354 0.31592586086224672;-0.47250567050873382 0.48309389968913691 0.33541825117329854 0.29734673066665801 -0.27964822197532535 -0.52185168735030785 0.37097472145386085 0.12504833338963922 0.25521233413091116 0.38253934111666549;-0.47376925449774826 -1.2309247647293635 -0.31764908603404363 0.53269706972065178 -0.48562774117830759 1.2867219095058449 0.63490371228733677 -0.43905724431465193 0.78835267781297302 -0.79924428439625195;0.30157232781511473 5.0205175188421807 0.027888967103356546 0.002540240624098071 -0.016507290774145311 0.48042434163415487 -0.12235472166075016 -0.083235111571064224 -0.057638335662959971 0.21310351710584607;-0.064759500676107015 0.16630476231885943 0.80793977433932784 -1.3639398014086586 0.87039700642463114 -0.36985069009352806 0.4324038756521425 0.23955993172692522 0.0083190404905755418 0.30318775925032443;-0.032829677190596485 -1.6111287048682028 -0.70531587962178099 -0.50424182409879559 -1.5358322351563385 -0.32201236955477902 -0.20159893726644235 -0.57169790494255479 0.73156590241133013 0.54695950304711483;0.24629801533780415 2.0425502793896353 0.094529634279798561 1.3011683531781169 0.67845459558592414 -0.37823098913324565 -0.47173293786693771 -0.74225931840641024 -0.76494779143471991 0.27895274977634871;-0.72957518060679061 0.120264027850928 0.0044363879957424251 -1.0216082921613554 1.0409842403801164 1.5662400814228141 0.063791080952691356 0.20989022794487897 0.0015212740681987344 -0.85926482095563195;-2.4786411900941241 -1.3130228730299209 -0.4593353010395006 -1.5754372781732378 -0.59895033314718771 0.21663009195414845 0.881303344821464 -1.6982501018923053 -0.18809506661618627 -0.2690118892652999;-2.1014100803428688 0.23570486677434427 -0.49227748123214993 1.5164377390412087 -1.2098357224181766 -1.3743957231601405 -0.42678182241182205 -0.015601354892067282 -0.19189091946814335 -0.14231494664213162];

% Layer 2
b2 = [-1.5982982414588287;2.0129687824042066;1.0199455456391551;0.54525883758969429;-0.25602051552083621;1.4082721438344197;0.88528014302989244;0.51804938982582027;0.97381488140925643;0.072857286953862954;-1.1171053488493183;-1.1243199392710657;1.4349321784454199;-2.3787106209646738];
LW2_1 = [-0.034539907474138654 -0.45300046269476235 0.11164946157635142 -0.087252375616917191 -0.0026725640761512577 -0.0069237415795851687 0.28789532403688894 -0.79476041465565506 -0.26698025763809258 0.22080413902067811 0.27396175374188092 0.51416812842641879 -0.30866824225332962 -0.46109884821572572;-1.3825761895338067 0.43020754675377915 -0.32194785648814978 -0.43042349697948418 0.9669123786918532 0.2678801076290338 0.27904790705176674 -0.38894759035180693 0.79147814602497391 1.3707231523142789 -0.43426525848177483 1.6806241970075786 0.28323875707608015 -0.59200738273008857;-0.77844617120252668 -0.030875439770897489 -0.45065748282126522 -0.096504377462191634 0.82691863266751109 -0.38152425260362705 -0.54739626349061787 -0.91950471478135876 -0.092858224881537998 1.2063587380352458 0.36098156077494126 0.88187795238317224 0.62017447299264117 0.080938255501588799;-0.6480259224951832 -0.18442062272870133 0.058709875263783608 0.34003345000596064 -0.23049092715800187 -1.3543693172826077 0.24967373496067441 1.3867934932403936 0.94642021658262843 0.022082248207064684 -0.15427628101106727 -0.016775321804607179 -0.82466500517864749 1.2075940365966666;-0.0011677855241712352 -0.64748765060833269 -2.0790544000642757 -0.20838441024939919 -0.042600559538433669 0.018693245823313609 -0.27852632085670592 0.53877639563671831 -0.12728147995618708 -0.82276178311277326 0.21830117301765922 0.41540524202132867 -0.6325807354549523 -0.83710655190374017;-0.85010757616214094 -1.9567458485128379 1.4362501002219288 0.74379541450123765 -1.1063908652487515 -0.60939204643046041 0.5827467040978922 1.1048751441039668 -0.81931268935348145 1.7351660261738397 0.44333318676972017 -0.033206122444378691 -0.49066257248223299 -0.49539044460118653;-0.30571607451366467 0.52971006798778941 0.43238888215210391 -1.2851409000045078 0.2625968111601914 -0.047471777558138945 -0.63571000168307346 -0.21352952492189731 1.304559820365462 0.21331445697027301 -0.48988652391174659 -0.40605243867136231 -0.80354729453569462 0.43191015634145768;-0.74627827143247383 -0.30723200594080535 0.34768839418232572 -1.1119107663404522 0.50655785123483854 -0.42183286659302854 -0.52578729788383338 0.27437875599436917 1.464883630676787 0.27093045088372925 0.25451876343449215 -1.1811078676674471 -0.43002434667655598 0.92830779884239401;0.70776679972594592 -0.8531092421286659 -0.14095122736381666 -0.81393358581384678 -0.15444990286951982 0.27468056113127154 -0.3758647844340271 0.88873938225685911 -1.2073356822251 -0.87083167576109011 0.35936031102753518 -0.135898885027257 1.1658145919949561 -0.57374258177235571;1.2954714686953692 -0.15554779152316278 -0.0077859837827605888 0.53882237275036426 -0.66213751414450794 0.49842355235703328 -0.4193747901553162 -0.69855305391047673 -1.0910326038757434 -0.86883705563725788 -1.1944688880921355 0.27482317788584854 -0.50640651843522444 0.30349055231148825;0.9436641058859867 -0.15375457398842585 0.46843813291429764 -0.68941099789842797 -0.02002851151013876 0.29796605868175113 -0.5022812357797809 -0.17675362345288009 -0.93476557276671435 -1.0762220273463505 0.20690264651449131 -1.5562636979257238 0.66089182187316742 0.27048160934701859;-0.73650896269533495 -0.59268787222491659 -0.62978092455116352 0.47640077246570689 0.18661993129352661 -0.30089107793458586 -0.088140167775168143 0.07373235349860989 0.4045692609896932 0.74380385536872873 1.004849887019543 0.18345470602952857 0.73332767431573975 -0.27205794946265638;1.309374212637068 -1.5921281934555285 -0.43716919123762343 0.29782497531335106 0.84543490671580301 -0.46546989816642675 -0.29793690867620254 -0.36380868117224868 0.0001958873100605385 -0.32939472217044197 -0.52979119749642356 1.4833779547240309 -0.367185392511785 0.55318445162951702;-0.18796507570822391 0.11695142660331734 0.17661544774408439 1.176528713528517 -1.0807155067317393 -1.0877731648536357 0.46491652510486803 0.39546664239923135 1.2883607037670872 0.95743490655851815 -0.47763369104116521 -0.57908206980584653 -0.40551148913215407 0.39120193847691076];

% Layer 3
b3 = 0.0025777264750353711;
LW3_2 = [-1.3994934547312881 -0.63890224651367544 0.35749823889750082 -0.40269093131101003 -0.74788728867091159 -0.94567990541296043 -1.9539810155634547 0.36826520488796732 -2.1458813651025874 -0.60872298781226797 -0.57714723774268695 -0.85638273394684483 -1.0177036921255378 -1.4699514660034194];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
