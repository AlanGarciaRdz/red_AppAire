function [Y,Xf,Af] = PM10Miravalle2(X,~,~)
%PM10MIRAVALLE2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:14.
% 
% [Y] = PM10Miravalle2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.32948515118866539;0.73296569635767095;-1.0308848736460554;2.8541033940351714;0.60540213489962891;-7.9706795195540083;-0.74345285848353371;0.75229286362581549;-1.7843134889143482;-0.71261230467568881;0.57493591594784521;0.20388152439105822;3.5642664945400875];
IW1_1 = [-0.16666019676277882 0.90834326840265489 -0.052146345691455973 0.46115612421961344 0.07189056178450004 -0.09185203195724724;-0.6270101087112584 0.25102203128999867 0.91574343291064941 0.087989310581529964 -1.839880089133147 0.20637491011169012;1.2152411674733674 -0.35511051991448034 0.95158968890115991 0.29356246252105372 -1.107406351992676 -0.45169781309722373;0.13203026410036064 0.70149451534307561 2.6892442823207858 -0.35427232108556733 -2.1558498384193068 0.31587909715919704;-0.72516505621247151 1.4813526696678745 0.34114340856077396 0.31735200137657205 -1.8463408194795259 -0.64173363874947975;8.9854458064920326 0.60226384313469183 -0.99740787380053908 -6.3266130393950846 -3.3244331323596574 0.6627038660669422;-0.093471584665392571 0.40479649018415803 -0.47762029986138238 -0.64424330360416648 0.3789552614438666 0.37247409232625794;-1.9784362719656201 -1.2498125310668942 0.1497914305124193 -1.8408045500719126 -1.6351139980436911 3.564638368352286;-4.4856740790273104 1.4105651525765144 0.23652732435941468 0.48962344929892454 0.44139592120184956 0.63665253299185476;-0.95151932822204421 -2.2888853813346044 0.18811024869196002 -0.017371877147835151 0.37496395368470553 -0.35059320721571385;1.2925234894896385 -0.50874343459880988 -0.62020197307212122 -0.079200672126152921 0.22133470572886663 -0.48304251244359603;-0.15572765702597249 -0.84411060449216124 0.13665206862183166 -0.85020077513578007 0.52514739391208354 0.30742798390945736;4.4360499563522788 -1.194407683376193 0.74853961801761426 -0.31696407310999469 -0.94775734995603877 -0.73912456334139554];

% Layer 2
b2 = [6.0409997843671972;-3.7583065498519019;-0.91233408778005243;-7.4553792714338156;-1.5977504608205877;-1.0803225422094282;-3.2244047181843065;-8.8881288917351924;-4.3301566098788618;-3.5949441039050507;9.6347227934215773;3.9259170873406997;2.0802369715727917];
LW2_1 = [-6.5608611280810489 5.1540926642109159 -8.0009644615111615 -0.27254810672426888 0.59553043857322074 -0.067114436898036978 -4.3397111409051945 0.38496650360170381 3.8915985332604981 -1.1448794191268616 -3.2160958191489701 1.1946891638459314 2.0324694337240792;3.5270036207174384 0.95030986093035397 -0.23956102781359645 -1.8577135823813724 -2.0646570098838941 -0.21196004916741479 -1.7108964112735472 2.0994096923337144 1.3396301187318329 -2.2500779916696012 -3.0796343362447347 -2.1703475610784375 0.36371793985735712;2.8280120977384984 -2.1114031231721557 1.6892995454707194 -0.031996559369942251 -1.1622435226878596 -2.0388620573449976 -6.6918886589090683 0.63360334252193218 -3.1400683861113401 -0.79641835335832023 -7.8382958264226597 6.0326238525462204 -0.36341205923035991;0.1430683988528012 -5.4726174641060803 -3.9605608238604955 4.0187587600693213 2.1997695179537615 -0.28895924375097159 2.3649448976356822 0.0062416111460857487 2.3922516907946378 -1.9675896293878385 -0.77819636112130253 -1.9447338560172023 5.1595947152958965;1.1953290595127326 -2.2798823930780148 1.2732725308719808 0.88076331658434082 -0.83209224820724925 0.59360998386598174 -1.9564884750176512 0.38640113958018718 -0.93625459649224529 0.68282263923840547 -1.1441320629500187 -2.5789163447825469 -1.3792079834969164;3.837192273987089 -0.95047161996481744 3.4547398163808158 0.29444681632317526 -0.016353818770846781 0.96767894578895164 1.5985345485535136 0.020152618857321537 1.4742726367741228 1.4541225277616663 0.48524303940251279 1.2634051129841628 1.153389720480414;4.7555535169955085 -1.7608690332790708 2.4584472724189088 0.61604294381489333 2.2466450917071406 0.098884501423536428 -3.9147357094686108 1.0621202812011783 -2.7163970603157703 -0.41897080207507642 -1.8646014027837829 5.9131297863856469 -0.43181046057469774;-1.7333449281428615 -4.4104640899848118 2.2096643686100066 6.5084131775015983 7.8187439389434177 -5.2548852182520633 8.5290496935539934 -0.98798655504777444 0.39664650768250675 2.9374891462001038 3.7943693917363062 3.010241519862717 2.7289471828686231;2.0055291851779482 0.62634982672744155 1.0793354973077909 -0.067027772525691143 -0.22043522982353375 0.48955379159547657 -0.88244193746197119 0.30131080637674185 0.19303568558398043 0.34306339745748154 1.410075279308354 1.73335430257525 2.8731004870828016;-5.4457432569252147 1.1204462112866325 -6.7551467475514428 -2.7580731267811802 1.1598357369840044 -1.6242534286232193 1.4854856656111983 -1.6925081855135744 -1.3852814850512294 -1.1151957682662168 -3.763688751631785 -1.6220297194704187 0.26913835029429833;7.7205984246059183 -2.3129438461650094 7.5316699910300251 1.8262846870123823 1.1466951211181593 7.5154530453976092 1.0583434646775864 -0.35170846342977619 -1.9646205256016682 0.24127461549160159 -1.091974938685359 1.3745318986968194 0.25772593099528174;2.8584404819856961 -2.5828074326594734 4.6726844950327688 -2.6282844331535626 -3.5428516747772121 -1.3329671601548556 -2.433198919413897 -0.4956120452427768 -0.55020286608993396 -0.64796062584946257 -10.776056031658642 -4.0025509616105603 2.6602622980500459;-0.53303887654779536 -2.6928950502003492 -1.4467550174178363 1.4068611978263947 -0.27524802844770069 3.2427728280946329 -2.5621375579416759 1.7823621137311914 -1.5379610183957486 -2.0645595065393887 0.026277445988326181 -2.9956092604143993 0.18750217529235044];

% Layer 3
b3 = -0.26012258665439375;
LW3_2 = [-0.084852285946941136 -0.04515485219013278 0.051000986530334684 -0.09049790213572792 -0.26405459922395769 1.0970369123169272 0.19706435396755309 -0.016419281762223934 -0.44576559719875036 -0.030996335069779443 0.087723787799168479 -0.050893726485890016 0.1493098583758839];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
