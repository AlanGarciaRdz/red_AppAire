function [Y,Xf,Af] = NOXMiravalle16(X,~,~)
%NOXMIRAVALLE16 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:28.
% 
% [Y] = NOXMiravalle16(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;2.48447204968944;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206;5.12820512820513;4.16666666666667];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.2768166074931393;7.6838284396874652;3.748106773168002;-5.1677676607382779;-0.66692106247155125;-0.49751737959281406;1.1015313726133151;1.9050088243606422;-1.6301774536102951;2.0318481845158733;-0.18301431717903383;-3.3058080166699657;3.2277020144272224];
IW1_1 = [-0.95539971438299809 -0.17734727983914653 0.14551654801532846 1.1215832447504268 0.28089977344575184 -1.231741116689421 0.33286716796985821 -0.55552351803744637 0.57823704126219677 -0.081732894402531037;-0.40410893472825871 -1.1747025889328031 0.34314887468053173 -1.9853575751678352 0.96059138724555559 -1.5460924904171938 -0.52741164791519735 -0.2645699339373952 6.9173507530662484 -0.068547463881006659;-0.30328604541490722 -6.8306258545112524 1.0285315094701231 0.32273538257338918 -0.14791889295165425 -0.99132833398038822 0.14134581522330089 0.062805473560554118 -0.87821039519546062 0.41045827675631008;0.2090554366619635 0.25482423934628851 0.15041531601539351 2.2199106516088767 -3.324647479005796 -4.4203647294905162 -3.6231134267666083 -1.7661113037096776 -1.4792776179355549 0.60740625470259968;1.7807427564655331 0.14265091997774107 -0.24522010281287618 0.65193141679115063 0.11971625140917844 -0.3056707411501261 -0.2967893200179979 0.64903585831841248 -0.030611872992864823 0.25641552822968972;0.88730320472065616 -0.069575200325433795 0.14120846073887078 0.92896164365158107 -2.5559996171749289 -0.26454539736330529 -0.059261958536840818 0.73183024175137912 0.70270705572189973 0.38685168633114531;-0.60028602142941478 2.2226728115802552 -0.067407994335563132 -0.36502456958071011 -0.24615893088512045 -0.76257363207446216 0.078946528750155814 -0.10631127219577502 -0.049287528557255933 0.33316102861272046;-0.30330900195806937 3.2782038781091307 0.19877460205394318 -0.83497277101346334 0.33127711276791938 2.5438157164614132 0.15116286555458885 0.36235044998809113 0.09797246676474336 0.29280740430851349;0.42207210986868288 0.024991250427386827 -0.38103188326692383 -2.228125036591674 -1.0453816529668418 -0.65939138131860764 -0.85506647497792276 -0.57529736015413457 -1.3230831296140526 -1.0222360573565104;3.1742239864122714 0.38771022269881678 -0.022766556796062938 -1.8557049240630406 -5.6474362104334244 -3.5184129297875972 10.285481908684034 -1.1761960417839308 -3.1811601614959835 0.39815418094234251;-1.12838778401597 5.1691056165303451 1.3729975701942936 0.21935401531215573 0.6212602437965834 -1.8167923889892221 -0.31626048976876442 -0.11150054343306381 -0.22828153963122055 -0.76551394295148123;-0.82754286850639835 0.12584245072702052 -1.0265516264017116 0.50223834810562362 -0.58204330425231754 0.87919859734581352 0.33678105797328939 -0.01895595403990815 -0.52816334507326901 -0.10496610813020679;-1.4827120225756374 1.8312909725145985 2.1565507489924736 -0.45661519059661321 0.6731031448228868 1.6083803714521834 0.40532122891143646 -1.0491524482560886 -0.8673593844435219 -0.23138287331848456];

% Layer 2
b2 = [-1.2380815825997264;-1.5397272076593971;-1.2683879990850266;-0.32802088734292023;0.57898433901310231;0.73183725357965357;-1.116408327521355;1.0709843561718368;3.4252559315150268;-1.0649163133371771;-0.55569070218981276;0.21665467817425044;1.4316065872591883];
LW2_1 = [1.1008763876273617 0.51253358239714875 -0.77809378946232421 -2.2719579777597847 -0.032903261961116474 2.5891975151862736 2.4697087233794837 -2.0097672985366244 0.81784645638026976 -0.047259582997081502 0.48373951591875597 1.0272793893720265 0.62730885565539096;0.56402457804031558 -0.44973909973700021 -0.86549615370793287 -0.1978695337672097 -0.93966550998311571 0.70542033668043291 1.1135744841210815 1.8662069425072072 -0.94932176940066237 -0.5247177804797587 -0.43527647246038326 -0.49345428219383936 -0.98961997677210956;1.1435510382608105 0.41016364188893495 -0.8228458871154829 -2.1795438544024441 0.10581488687470744 2.1595670088224677 2.1617079235508063 -2.0257931256578132 0.79687043944862945 0.023185734868077606 0.57388606827956379 0.55562544191820062 0.2572950077030034;0.2384197533120965 -1.7003609490854146 -2.32365574072334 0.56694560732379518 2.5877677020305665 -1.500740245342149 1.3287131324182562 1.2140496875643032 2.649402034859544 -0.29387212943986613 -0.38810214109612085 -2.809901425158869 0.70496549004680198;-1.3059865035689899 0.70446976067453626 -1.3724820182300475 -1.5610049908120716 1.1707333996661313 -2.6165386790186851 2.1298744273487671 -1.3099410355493217 -1.2266120158476557 -0.018209771773662158 -0.034736591088189578 2.4169372523556421 -2.9793542693049666;-0.44814891764305553 0.41872372446626993 0.64376689255740271 0.54559728459696644 -2.8675376671217068 2.5196407729589581 1.1581302967275817 -0.32529450497286339 0.47836458960083378 -0.51192707381978342 -0.42905012069718401 0.93508865601336522 -0.063275439118174348;-0.01907653203259943 0.66317206863718803 2.2064982312786974 -0.25715412619919797 -1.8636024826945596 0.44181613272845549 3.3479696327224415 -1.1099010702132188 0.45555486824922437 -0.37312784038340213 0.89268067702247922 -0.14399476470974543 0.41235102726302464;-1.6258410854701353 0.50809536352205575 0.89716977577454504 -0.90213409072765316 -0.87618352846891412 0.19100591700427672 -3.1615799960948801 -0.32140370848145844 0.66610309772267851 0.071581382556496514 1.5974565978694315 -0.69081617361704661 -0.63363867464393087;0.37486647853890304 -0.42683738414388972 -0.65424014910766004 0.59292660484501358 1.4277788180253506 0.92309328230220089 -0.6812672111081437 -0.77919922872530323 0.21661101279576334 0.4397844291235376 -1.0725811971526931 2.3032737926381635 1.6652807115298436;0.078352073008193857 -0.27968305708351693 -0.6431816540298585 -0.76264778772156616 2.6914575679489041 -2.2704053318811006 -1.3175283230130985 0.4076278989097008 -0.4099647163864697 0.49719633066478486 0.45596865076676557 -0.4738952982103356 0.23767753373889067;1.9161851122149287 -4.0956662605534229 0.65337793676414357 -1.4978377712548128 4.3983831830831353 0.46211934199149995 2.167735983204651 -0.32509776011407548 1.8618439157235438 0.70783650990668479 -0.36422375021393749 4.4313382498945257 -1.2469802395284326;0.21236602119754419 0.22957868825669114 0.63663680802266331 -0.46588811029860888 -0.75152618049327047 -0.062684578331114321 -0.51682716759458391 0.26142939836642987 0.34829935405782281 -0.23661005252276504 0.8425674845083494 -1.2496969307929042 -0.99802635234946047;1.2689494134846659 0.42765416716611193 1.3863238139673959 0.30573405614350202 -1.2133668606495083 0.27040025177175897 2.6738422421774102 -0.95628803527190798 0.52627396739035348 -0.39842243537122662 0.14094939561359687 -0.11916303310230286 -0.28373336270465771];

% Layer 3
b3 = -0.43347718028344467;
LW3_2 = [2.9600280394367382 -0.60856253576916863 -3.1729964679654454 0.27964401291439928 0.29993283181920372 -2.8714040012184525 1.0583692556065245 -1.9829772230357952 0.37848599388999232 -3.0465814723581173 0.84518726617071149 2.2676443046262453 -1.503534052570906];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
