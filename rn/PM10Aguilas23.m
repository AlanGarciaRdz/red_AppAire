function [Y,Xf,Af] = PM10Aguilas23(X,~,~)
%PM10AGUILAS23 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:19:54.
% 
% [Y] = PM10Aguilas23(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.2353210778208108;-2.9991271611568697;3.4611132136734573;-1.2038881953627296;0.13866000672323889;-0.75462270295486489;0.10890471326017699;0.91247343132853953;1.0854739253270527;-2.2861899977912028;0.38487289579058692;-0.61332249356249113;0.57134486638944582;-2.0453016731713998;-0.7317880192594215];
IW1_1 = [-0.16445063969930632 -0.38644250662739471 0.13866419792614879 -1.6299354881590908 -0.18586680728244548 0.13621567286677408 -0.87733820515472327 -0.31369253249523199 -0.2144617889849797;0.10027783287141868 -1.5820978636512464 -1.5600882485268621 1.6817005930568654 -1.0025559207133472 -0.62152111081423755 0.91747118470263711 0.69708949332178349 0.03003309958688432;-2.1952382442765015 -0.77298967410504293 1.3464514476054603 1.1133385962885929 0.69457470710026592 0.29419798286921123 -1.7340739229837627 0.64143304893100928 0.5939392268464686;-0.24564808475045424 0.60287354911784197 -0.19829995245262966 -0.11370768518464824 0.24268756345368275 0.048762643778713852 0.64119211756382843 0.1748020289808942 0.10929221813999546;0.5972908347839998 -1.7797228486476795 1.5936507734881249 0.5797369587774972 -2.1020732290916637 1.7797835586608595 1.3495647104564314 -0.48649504727768556 1.3945867210103617;0.15928548575547491 -0.082291291750952594 -0.50068750623657921 -0.13756855805615636 -0.27694867736687295 0.11111878218140979 1.6079805494558577 0.38657230930184411 0.083084580545989148;4.8644322188255211 0.26722719015026963 -0.072889899127733304 -1.0160152525492137 2.0079292425592383 -1.2421304395064288 2.1012523301081707 -1.010492758721814 -0.76661089066541732;-1.2282940406296361 0.88254005650354372 3.4882881863832491 -4.5637093626837792 0.76147522888571972 -0.708318231225607 0.71401366571243663 0.015444901704438602 -0.72743384554269197;0.12488689538685965 -0.43769980418331189 -0.17836330942080064 1.2146646412462001 -0.20803923011687331 0.21344036261938659 0.19104985696384491 0.039960573508041025 -0.11441109297117562;-0.57243366167592513 1.3863818951163354 0.10421537934389613 -1.583705935004627 -0.24744991593757376 -0.051443569068152589 -0.40778775269751905 0.10916360036523376 0.14696419365381147;-0.33382255500633962 -0.5463695456694263 -0.80788771319690456 -0.79895577407927609 -0.020814659512875068 0.30469270951176147 -0.47426028220427408 -0.45207305693755201 -0.49848120399237611;0.27477208478756965 -0.43459348941751952 -0.14458804413349283 -0.71923092587689486 -0.0081336281053597682 -0.045748605905338358 0.19802437823298058 -0.048042919771541431 -0.096239619832505729;-0.70564318981796403 0.16729983905849879 -0.83096393165294713 -0.20856061976083221 0.64373189790712215 -0.65014316226643187 -1.225601194143406 -0.60011798949163064 -0.062604097219146324;0.54759684738005299 -1.6351087942775575 -1.0053782530952309 1.1479944867382283 3.6561955335373524 3.0453053948247848 3.6855296795845236 -0.70921517289998315 -2.8736833624627312;0.32426588010361035 -2.1985787744301253 0.18356795221296585 -0.88960635763263185 -0.10035454981467914 0.3390820543233779 -0.92156505792738619 -0.34816078195336819 -0.409554104038863];

% Layer 2
b2 = [-4.7013994401794861;2.1615996172507979;0.20605495754653103;-1.5175686016262171;-2.6095246515007919;1.3999089469233119;-3.7849025086156942;-0.93701565962813749;1.0355774769311945;3.5510199982908537;-3.7189995923771244;2.6649116463899962;-1.9697095472068815;-1.255333552439287;-2.4300785163469287];
LW2_1 = [0.58464956494784492 2.8676573492598756 2.9183910585696098 3.5251349838426354 0.96774082496458114 1.4705391838184385 3.3233920722534691 0.86056198555411867 0.041702311597651844 -1.6310209213670821 -0.6532257632500923 1.6841626620570205 1.2516273546078203 0.38494539528022043 0.073537154583318359;-2.156553008690941 2.7461964561411096 1.5723705467473166 -2.7435595654140319 0.34061423752941461 1.1279310969337304 -0.32558013301817418 -0.33693273746769259 -4.3112058248773737 -2.0442791937214273 1.7271369605316509 3.4315626968758859 -1.6006548675847694 1.2474790229432584 -1.56355172165458;2.8662018833387197 -1.6013945054530618 -2.0061965639060397 7.6737320435149758 -1.9624099813819369 -1.5402142289183702 0.17486614748392726 -1.0081961838397746 -0.21554385754815264 0.94097420707103918 -2.2535006808193283 -1.7117588435624356 2.7038553682744242 -0.39654572052680959 -0.039748712428494135;0.42621887061286878 0.13730256144214265 0.72245140048331247 5.9767520191190258 1.0284285670779572 -0.3715825017890762 2.3375298598895879 -0.1308032744017241 -0.39520373939149667 2.2068963605068763 1.2969893924957066 -1.9428985081388124 2.1447653724798066 -0.63343831667622896 -0.1925477634344479;3.261607179737271 0.091220690555718062 0.61898657679360813 -3.6038563440299591 -0.57610445191131332 1.3432559199335234 0.36313849762370959 1.5081731233004483 2.2872087673621682 2.2068677130786827 0.90593580996561041 -2.6748413960645752 -1.5221417734848732 0.70124465005043901 -2.4552686838966737;0.8060036035323751 1.3794043622219843 0.14388757841048064 2.2335848272448744 -0.20777445764327906 -1.0121538099799634 -0.16816095179868243 0.56102570824270459 0.21260142202786531 -1.873640531220903 -2.6285572668413577 1.9523099408505018 1.7438354564594345 0.051584768624710051 -1.6782277343002048;3.3006258285364667 1.6468854227707463 -0.44882993409431249 2.1100461915813296 -0.28834102382475457 -4.7188546775743614 -3.4098027637315655 0.61486722315611442 -3.5650618407970898 -2.9718975097611167 -2.3290536288356787 -1.4426386448865525 0.58999268019553441 0.27046252177078495 -0.77584430720893061;5.4487496254655454 4.5564121462513354 1.5709191304437493 0.10223368492799206 -2.5801874100305189 -3.1279202096785421 -1.0950620624974126 1.0609814353834135 2.783247177495813 1.8727608813485124 -3.7219340281244411 3.4341110891594195 -0.10822689626370667 -0.18849405712151709 -5.2033041584467172;0.9523358657698594 2.0949452570963851 0.0067348477561702882 -3.2598771964927842 0.99824276891866837 0.1653263656684873 -0.45064124594267213 -0.21174489538344765 1.2825628136549936 1.3721601427562153 0.4177527664483322 0.60623871319049871 1.2154199207632808 -0.073515521394752023 0.58931409294600745;0.87184344713512218 1.9611068242915943 -0.87689865854874849 3.8658881162293159 -3.0332763619336647 0.66852517417959256 -0.35919169025423869 0.75371217554239944 -7.7767888787626882 -4.8026694378911827 3.6058555882293786 -5.0201198260158222 -1.8834534969383556 3.8906624102508673 1.9140348088471228;3.6316046044999744 -0.048745620005212542 0.17600910116009788 3.1241231135571272 -0.61776205360451031 1.2134318615948279 -1.1648250923185173 2.3071648988254934 -3.0140038223146197 0.050965546533692334 -0.5629218393428691 6.7628776934197603 0.16769522446716995 0.1276250127302839 -1.5055672792903012;-2.2771565962966793 1.6627190272953984 0.4450117862130526 3.8926676133280633 3.0458546714750345 -2.0101708025669973 1.0250595952491366 0.81454608990261956 2.5017773311561498 2.9702976184642726 2.1594981796954742 4.3878246067585804 -0.019722367560673693 -0.079869132085588407 -0.60807208380430011;2.2779851278504415 0.26807117255751212 -3.753219336798217 0.24046212391446048 3.1257260702951268 3.4164036362788148 1.7296492915700137 -1.4560483752900653 0.3078870230526049 -2.4147499189183947 1.3884455644784948 -0.73969436085653062 2.9377605095605039 6.2342209688120258 -3.2940610342792787;-3.2773129255382685 0.81613646080817104 0.80310798178357645 -4.6107496448641454 -0.8873702248008728 0.90704294505663108 -2.0628809925033522 -2.2513192760182217 -0.98561614294318411 -1.9745932782115636 -0.8384516598339985 0.36667841025469955 1.6606627705739265 0.03599891076181376 -0.59959857602735478;-0.50303886805696663 0.28296246110259138 1.4514465970465171 3.7440773136629946 -2.8800420982126029 -2.1920742572070262 -2.9933806244888208 -0.73762619266617846 -2.0005319736025289 -1.6744683753416549 2.4010060618016977 4.9358861408070789 1.1970112330650864 0.33321355230432015 -2.5548695131635952];

% Layer 3
b3 = -1.064389371955482;
LW3_2 = [-0.13899287092374615 -0.11063771172184869 0.052791828265360607 -0.075917007300950093 0.12698909139623091 0.22479914139914692 -0.032333063694965913 -0.094095414431661958 0.15128566957712444 -0.04171715290808671 -0.16367448277007202 0.17537656391587667 -0.0032911530556553655 0.075743853783242499 -0.065645754167231327];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
