function [Y,Xf,Af] = COMiravalle23(X,~,~)
%COMIRAVALLE23 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:49.
% 
% [Y] = COMiravalle23(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.7168002346742788;-2.0702889800524402;-1.5977988606204603;0.46227576638538592;-1.804776863406808;0.75833569020737945;-1.2279507992889724;-0.38702000503225009;0.066224461217774186;1.8707282725871264;-1.7320660855179291;-1.5029229593519171;4.5671779627676488];
IW1_1 = [-0.051186333778981762 1.0182299309396272 0.96919578885715607 0.11821284225635516 0.035590435420501797 0.46534258727025574 0.17172153359933004 -0.10351352599817965;-0.024713193080417972 0.24706473976399995 -1.9460775409249575 -0.25683001823877144 2.7703103856217086 1.1589676929229682 -0.78206292525994836 -0.24928212345717121;2.9096074401561123 -0.92912504350676095 0.30879199914270306 2.8950361529430464 0.46854391061006356 -4.6626328662977965 -0.13614352878281832 0.80861488259954506;0.1679641774226267 0.31087043485781707 0.60906853114029524 -0.20982079550052385 0.33118532920739724 2.3289922845423661 0.75615738065032501 0.12390868388063415;2.4474875695496738 2.3014573935622882 -0.33733804902081577 0.83014304196831346 0.087572595964606273 0.23373502684798642 -1.7846468954350392 -0.89555266942101897;-1.7155970913189602 0.10534025898801845 -0.29423586622839565 -0.15354860512604335 0.31909844522323405 0.014662114413049827 -0.21475740344002689 0.22188395714597731;0.27725832120083982 0.64156606884227685 0.42200721316963813 -1.2423717272486299 2.1983280274196599 2.4467072747998175 -0.1306685997858347 1.5797871662375407;-0.10582219013063232 -1.4373743309044773 0.062078850884136019 0.075178089539896298 -0.038643441097936874 -0.20088305404811746 -0.21488808643632448 -0.20693369887398286;-2.6042131724355597 0.031800055392572912 -0.1602072766434296 -0.14490961401844346 -0.48337120502193831 -0.27137633931892136 -0.26575162255214013 0.21490440893306517;0.49230415618952922 -4.1377160877529073 -0.19464837601856594 -0.79282760086995163 -1.7852507862649176 -3.0928734304907528 2.6252009708148858 1.0644616440279224;-0.072435221613781103 -6.1286284846296786 0.21272756658942621 0.07361599387534333 0.026628000591193496 -0.111230237974973 -0.05027429461276342 0.15165443880154053;-0.4397571408578036 0.10943756353651787 -0.041249431371143633 -0.077628001255125534 1.2715322336543824 2.0313161966295454 -0.21475626645010287 -0.45108153530882261;7.5756333392122821 0.23405566246020362 -0.47846244385274178 0.22677512544046269 -0.7124044494237719 -1.6604294005905216 0.4938752590940515 0.41459353362439383];

% Layer 2
b2 = [-4.9240531764622331;3.2426641310631203;-23.649109586457676;0.010022146112612831;-1.1105850545299751;3.8955532190107838;4.4184925621161089;3.1580808847587121;-1.5208285846829268;0.39429153929780003;2.8337300111626824;-2.657547289654997;-7.7316592202417072];
LW2_1 = [5.6997133750317523 3.9666868594895002 -1.0415614259763661 -8.3775651494378831 2.3124169039221147 -18.873476527393237 5.3831262597260201 5.754401385303253 9.7776306423923245 -3.9641610818116382 1.4056912058610014 -10.579308559007488 -6.1242480083671307;-3.341878463543392 0.55623809845592864 0.55883987109028888 0.89021048823700166 0.68405406563922078 6.3040525246581662 1.4955608056923189 -0.94102092467660925 -8.1566285217555183 -0.033417391358235682 0.98615434192033002 -1.0416979680549032 0.55072581865465564;1.4048256889951523 -0.19204921786515228 1.849893807569478 0.63236933653779259 -0.17925026215129145 -0.56021128556542432 0.30805235572238371 1.2199765954498842 0.51445335632247524 0.038955655309821216 -0.80147513346157873 0.76756198241064544 24.977891247843395;3.011367166520921 -0.15023462364645532 0.81738160799819304 0.12893673962043467 1.7495136272504079 3.4054175507314661 -0.57778051630568505 -1.0347368529015992 -2.3398545939933206 0.41705926555709399 0.17635599703423196 -1.3881575855298314 -2.6705235400164509;1.8586078784802533 0.11146945892462891 -0.89727440931836921 0.38063770326965185 -0.15083350021878444 -0.27693877467407463 -0.14231227694703821 1.9820978127716691 -0.033942385036673295 -0.094738241026495876 -1.3676839108775247 -0.63321821235255937 -0.43792805076207958;0.61992959595535913 -5.0120923388399161 -0.82172785875699661 -4.595652811123232 1.6794400349008065 -1.9134865596129991 1.7621743410326591 -3.8045086975572535 2.3942374046692465 1.3771441026014395 1.9757111956981046 1.4881179287035791 2.7297679237678838;-5.2791965880923524 0.62755474670775191 6.1189489461825683 -0.11628703766568334 -2.5574757135277695 -2.9747276261997944 0.61133776437183518 1.1048006807737172 2.0030731494079221 -0.37361048808033059 -0.4165391744340769 0.49694533984864986 3.0979064858059373;2.9697554360926812 -1.4137975277004344 -3.3064429861556146 -1.5709482939258466 1.1191983670474908 -4.3750611022085746 0.8082939224267216 -3.3498785986654855 3.7402044971594099 1.3540416441092935 1.671674736177774 2.2656160206231966 0.95486913992882916;-1.6123873024712165 0.1446297772554454 -0.82613972497678478 1.0477091168567083 0.50356309521338671 1.6602238437686005 -0.61672431166206143 -0.55985682106033341 -0.41474275981894848 0.27165798227519034 0.55007262367090803 0.81163472904493628 1.9586241544782228;1.4158831498086899 -0.23812137978648684 0.027076685554151825 -1.1915342040617549 -0.59691000026862473 0.19415277979692686 0.52966183620518803 0.48838330203882757 -1.443565423246542 -0.28995884709820352 -0.5750652776237114 -0.57342421126352494 -1.9928252169353584;-4.3216750184395094 -0.17828760819169964 0.22375452012050329 0.52926912501749823 -0.96399723693398631 -6.4542750619808444 1.450214119551356 0.52499618022686334 4.048507983151536 -0.47367660130147182 0.98559981407333253 2.7373042779309715 2.6316528548421392;-3.9768231840932664 0.89069329256547536 3.3307877018635712 -0.17538398304020261 0.17440390422881358 4.037624980604579 -1.3373841251620995 1.2091374275007127 -5.5186469512530829 -0.88413551149247172 -1.0676630608080855 -3.7599608873653381 0.29987893529581988;-9.9991700621213369 -0.76933210490829118 -0.6921669773488307 -0.26582013677092609 0.2201060370085173 -4.4099712551670915 1.0312951948973386 -0.28696719585678943 1.3482476484935577 0.35935607042632634 -0.63462389667237251 1.182418985920034 -1.8925619334461328];

% Layer 3
b3 = 8.7225363647899385;
LW3_2 = [6.7525039702246774 2.2813426540886623 2.4232096969146957 1.3605643958166038 2.5985336274260926 -0.081909965710019905 0.7719197347370822 0.18637761621663046 2.8701723869901747 3.1825104110845288 0.54747077489361318 0.15797164970406988 -0.22116166157414768];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
