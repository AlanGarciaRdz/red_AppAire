function [Y,Xf,Af] = O3vallarta11(X,~,~)
%O3VALLARTA11 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:54.
% 
% [Y] = O3vallarta11(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.12820512820513;24.390243902439;0.02710027100271;0.141843971631206;10.4712041884817];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.22265008639579789;-2.4310202118176321;0.35790656390239373;-0.10821865590450337;4.1103174532064077;1.6979140399759696;-2.7806195293315579;-1.0159493311101289;-1.7320442243799834;0.42987448816298529;-1.6806871825116625;-1.4978875033690719;2.4640485605533855;1.4061973642005114;4.442590913589175];
  IW1_1 = [-3.6112078297602426 0.074890635499001129 1.3290701463665282 -0.6352993820913837 1.1122462670142197 0.1784653111974136 -0.29462497304860641;0.53374327921589582 -0.66373658214750153 0.14985703680979001 -1.352634799255092 -2.7508377462050113 -0.88984449621820172 0.39152606413858598;-1.1235807154918833 0.86314075416005931 -0.64548615043055158 1.2612732281628471 -2.3124334688266384 -0.48073517689934997 1.2713460537897192;0.76008737370516422 0.069245776282092886 0.8321611257077115 0.29697637889926642 -1.3961208426277705 -0.70620712934492524 0.4355564532289522;-0.36357255080983253 -0.5709849997512515 -0.27550968174561224 1.9678991788993614 -1.1533111409560677 -0.58325067676351017 4.1145485445233367;0.66261339491236415 -2.8482499974074433 -0.73598103182471097 2.3140641736232523 2.1617307816181395 -0.057722874719319563 -1.3317602129149799;1.9166936765905334 -0.16374692001418029 -0.08837946442273556 1.5025536856576367 1.0560254283866433 -0.4074663907247198 -4.9490548533951451;1.3214002081262406 -0.25882582275046695 1.4271271515236599 1.0234369488071378 -0.97461924892393281 0.041698086608405301 -3.9935016943502837;3.9209427568403439 -0.54697815117427084 0.19747317313508619 0.70717038139166011 0.58610624252938925 0.1423433496904449 1.3180956331556795;-0.59782673494310057 2.439066805913634 2.7227013837085523 -0.028149536386645534 -0.48698246980915932 -0.14659941586143863 0.77020419547898467;-2.1400357200642426 0.33144155967874794 -1.4208151676924536 1.6697110983347907 0.47037227154187905 -0.88063749336880925 -0.16760497141435524;0.39311994427554547 0.43178513232080429 -1.0906226743591019 -1.1691775940672342 -0.67136485354037467 -0.12621557554979468 -0.18966821034606768;1.0276629180845287 0.78646277818500798 0.48842207878699373 0.037891475215636669 0.33714622489468837 -0.1134257844819266 1.2156238962656771;2.1373930171368389 -0.026975948619771158 0.32867140930491739 -1.6309662737331849 1.3179367155416641 1.1171690551826201 0.31415262804417093;0.67221223255599249 -1.6856470267024197 0.98681033608968949 2.0685734877582322 1.1388634578089896 -1.4540654497547627 -0.10144842327580801];
  
  % Layer 2
  b2 = [-1.8273029625674979;1.0531668029846644;-0.72310911465532834;-3.425067803158413;-0.51011865012249824;0.68904708484219712;-1.3141864340410099;-3.4962253382408348;0.0088976167073891478;-0.028420251402930093;-0.17298028997473566;-0.37558822878881853;-0.73962158550733681;0.95712971222545851;-0.50799059542438363];
  LW2_1 = [2.3206424101678538 -0.71669308889520045 -0.38181129500482031 0.46626787127571467 1.0430818743259549 -0.57941634095103833 -0.23934212801724269 0.48263161189677184 0.20707983634176297 -0.90227284886408232 -0.011380141904722543 1.2501147944746132 0.17244121969354506 -0.84653167393205342 -1.2640178558614104;-0.71985748844462094 -0.92990202706596303 0.40482526174836952 0.7171058858267213 0.083229597082337084 1.1189446495586046 -1.3277668831290907 0.85001043380461427 -0.11052503132933386 -0.10988289866698928 -0.39293596430282068 -2.2503813805634327 0.93497928238769346 -0.95874754080898794 0.41192530861028465;0.2005905460413219 0.21155754283957534 0.0054578864100542565 0.1497228378694743 -0.17113298818905379 0.143206916190491 -0.22293087618233104 -0.22183272447887153 0.045900850260016238 -0.45441202250764295 0.54162380716962022 -0.60553594337718053 0.92437189071619619 -0.62962219565954569 0.56758363721691885;1.1555834396524918 1.8124469272463113 0.59775127815097262 -0.64766314527452273 -4.1055414378976778 1.2999146729599111 4.465373509038673 1.6490052295872439 0.13293565669264554 -0.48209703534334453 0.059506131904407414 -0.6915654802097988 -0.14855495507019259 -5.5400063980583445 -2.7623961621699129;1.5967077806139989 -0.10781048393983703 -2.8769398095061307 0.75621830532034828 0.72603639728864811 -2.0664324009251707 -0.037117761300244301 -0.032181558042328369 -0.092690358115466082 -1.1134789165678676 -0.41316579588894975 0.14424390242616333 -3.2275424176189094 -0.8645519817221976 -0.90797478222104211;-0.76276475017581236 -0.13064866470358955 -0.087879527371286098 -1.765632562435258 0.27518558322406994 -0.078398674103829169 -0.054920172573598769 -0.20036196410172494 -2.2527487896111764 0.045737746492604835 -0.77558299732662406 1.281375887066514 -1.9308760370528224 0.097278398322104942 -0.44974521740845091;-0.6640747719166552 -0.55423041283215202 -0.48969465579472421 0.86158467139511541 0.20001575440672884 -0.32240700215503104 -0.90037841244733807 0.64247684778476721 -0.37627900036268136 -0.36223697488335915 0.24264102453815936 0.18296293091676352 0.39186681180960359 -0.93071630917960524 0.25254749351112848;1.5124494949395104 0.1654803107841005 0.83664758945242945 1.5410046736551581 -5.6748165017997003 3.5873563658023451 3.5692857480008189 3.5197478605302921 -0.03453932986428835 1.9037226001298584 0.87403375413373074 0.57142135484146306 -3.0134786534849516 -3.593202697363524 -2.8737060185353491;2.3035411560391834 0.42403124167430678 -0.11802812863828491 -2.4682595755286352 -0.5850345449833616 -0.44665280131817497 -0.3711269127109515 0.27150613122256317 -1.0710034018573311 1.3506276516390496 1.5893606586243161 0.24425726054128008 2.6162971193136282 2.9358838340401934 -0.95875712639561605;0.1571999840651197 0.51030282151985695 -0.078591934334121552 0.1623873163721605 -0.19355871974457231 0.0029081472944980208 0.0043645456375643859 -0.36307156798187412 0.32578088503272157 -0.36111755146406838 0.76207519558024062 -0.74616488065296949 0.70061574774320179 -0.71038114229143257 0.73808649384908132;2.2921916924245807 -0.49812175916789081 0.033460253949631341 0.77220530251471597 0.9094991057606111 -0.46039083071270664 -0.32655758307302929 0.42883132630653092 0.59776187035199024 -0.81990284899110177 0.82070946873080852 0.2256542849260072 -0.20490859433859038 0.048669604187286081 -1.1286057010828725;0.97045660743524353 0.046535067093253883 -0.66664394973870644 0.62828436497386009 0.48162736208413531 -2.0572634072333842 1.1917042946453253 -0.1551334161312001 -0.66857010550189677 -1.0591217434336822 0.28892460310300261 -0.40863543573925915 -3.2543223345338914 0.47297732006553417 -0.37361196746256947;-0.35078812257971526 -0.17530438727678896 0.054106051548220131 0.29473258692385679 0.056874330701581925 -0.11463157876064464 -0.40782267358127711 0.075347021462506977 -0.044467902572663073 -0.37335874557735954 0.22609697875317752 -0.31003431554939254 0.40260128344334495 -0.37297767714464247 0.27323649754162949;-0.11553650655841549 -0.37279939772990678 -0.12125299745619447 0.32042328749843491 0.040908159677743243 0.34020021173565529 -0.35079010065468108 0.39996683223709623 -0.20222404126817875 0.12969158314450016 0.21548794891605502 -0.028939537287009223 0.026534204264109254 -0.2455020422885606 -0.019423635413542657;1.7678432394794992 2.3038271897259026 -2.1805894104139711 0.91319197348123748 -1.3126992535521207 -1.2105489303419263 0.21813175537570859 -0.73121237585246934 -0.34298531266129489 -0.61681270368991192 -1.6571376529794577 -0.093097200446874862 0.84914684741331425 0.243694025397939 -0.22767693461172639];
  
  % Layer 3
  b3 = -1.522757410322813;
  LW3_2 = [1.3197660801832598 0.32920498200105031 3.1885022016143925 2.3971066334300604 0.67460778105735131 -0.28383110756084223 0.99691949880045927 -5.1666172244503485 -0.14194217991674776 -1.9377018457269737 -1.3284357810311962 -0.73896855143960016 -2.3123556056707937 -2.3907193908071358 -0.12818260529459749];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.4712041884817;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
