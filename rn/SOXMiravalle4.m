function [Y,Xf,Af] = SOXMiravalle4(X,~,~)
%SOXMIRAVALLE4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:35.
% 
% [Y] = SOXMiravalle4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.0208986415882968;90.9090909090909;0.056980056980057;0.0063552589768033;166.666666666667;45.4545454545455;117.647058823529;29.8507462686567];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.5529325371648501;2.3481007799649793;-3.9084544406700017;-0.72423408199393313;2.3392684686703276;0.60759547779131673;1.3625041307956933;1.221557786859276;-0.39153722046083927;-0.036164918736089346;1.5560245946117681;-1.7922518110974106;1.7605344174516737;1.2794279507194204];
IW1_1 = [-0.53787894079434795 1.2019843346829429 0.14231071847897273 -0.023383926028136888 -0.22244444674260258 0.38200176883520853 0.010188242073946275 -0.24103095824365242 -0.35555657263386692 -0.52864185225883553;-1.527167870443539 0.080092698928054526 0.34660244429486275 2.437320258135399 -1.0861191333573299 0.57981038680280994 1.1322631223102357 0.58194457423575086 -0.68255709533987718 -0.9497576239592167;-2.3714823778977747 2.7932587946074783 -2.8372845388535834 -0.55045747311599313 -0.25363130800534051 -0.35116796724731453 0.84808302938829239 -2.0783720045425822 -0.048325855010244209 1.443582987415013;0.83919953379550216 0.23875372710419848 1.0299239819716837 0.16656494060142993 1.291885838804699 0.11383803822648898 -0.0088585357902497396 1.292201092367522 -0.29236596006377186 -0.89012524310577112;-8.2214183475175542 -0.090009639894810242 1.8841563917423463 -0.76851431698912653 2.3718278645972748 -0.85178041648735747 0.27817799149089079 -0.49942680653416116 0.31034456675850869 -0.84266779166435724;-0.71475324627689729 -0.045137606370495735 0.049402089509727944 1.7568870929618623 -2.0240734103797426 1.1173127108432488 -0.1778091296162658 -0.74846341762650115 0.13972155534174568 0.29270586051004788;-1.8286670717550568 0.13358060231654389 0.61493928335057568 -0.42990356537873642 1.1733608748048265 -0.0431239377166895 -0.0048632294266405824 0.97314188275724622 -0.31196910501907993 -0.58640525592601755;2.6799460561297561 1.2563949730071693 0.94873120622155171 -0.70680862757878693 1.5275944372593591 0.31174859471497401 -0.097933134435333233 0.10452139338221385 0.47612306632490692 0.28877527264590819;3.530829112275879 -0.32195139642080173 -0.062718988110649923 0.72526046651843323 -0.49745377232338023 0.076385567655786635 0.38461232624339226 -2.9066409544463006 1.1233225684226276 -0.43219733156138784;-2.3605215746636063 -0.02178914750077254 -0.063309971587955538 2.0217266530356643 0.26223769222257637 0.20661074970240531 -0.28938063448016144 -0.38161994709944291 -1.2828455174874662 -0.1841727130057616;0.32311272902352695 -0.23302354922719179 -0.90655192828873055 -0.046629692911093173 1.4411309091705862 0.38473289816538803 0.67312345055613276 -0.045800974952592236 0.56327512217968723 -1.0862325181697496;-0.98169443796438072 0.22208504977279364 2.0429205139052593 0.13989331132082569 0.67493350782577977 0.52838856853273408 0.48976583121477163 0.29429343933376517 0.52574504264386512 0.15567164167468114;3.3144121362910699 -0.23014744170354653 -0.25459436197888113 1.4656993760130743 0.71430364452218076 -0.075474944365189867 -0.63660321748524229 0.16693638718138493 -0.56068616643535019 0.40135707909159241;1.395099086042344 -1.9843720998553243 0.088797901067724228 -2.9711174007708085 -2.6547421758198699 -0.051723798365476248 -0.28963399490815167 -1.0108251585758881 1.9849406973338628 0.25064479837323422];

% Layer 2
b2 = [-1.6162739845852871;-1.7109267099381644;-1.5391557117554324;0.2879106225146203;-0.45596444743261316;-1.0724080531478248;-0.49289927469963546;0.44802631570417067;0.96737087757839113;0.50931895742503686;0.75954645536257903;1.6846735076653747;1.1520070204257706;3.0724149526573385];
LW2_1 = [-0.12026662847906334 0.55988276065013665 0.56695000716806654 -0.50779133476342408 -0.89999643455064615 0.0062168762101603645 0.11688397641374744 -1.1429906428794854 0.2145126713576738 0.087083159781778038 0.11894790807956784 0.51619000672147963 0.48041470290648253 0.46759025265655246;0.1695574627319873 0.69268210749111214 0.036818513035099351 -1.1069734181179243 -0.022053729772697133 -0.40074569008251443 0.19048652152631529 0.79429886525179971 1.4547556100812846 0.31307624764726144 -1.3271350984028103 0.059214130337104376 -0.12364244482041825 0.082311374075045213;0.52444729509505283 0.043786513574549255 -1.3261271700008854 0.34669892193477642 -0.40798349601182338 -1.0882026836213536 -0.27024215386257083 1.3170982551771717 -0.64194990322568124 0.57696987279648826 -0.11839470886834506 0.502941604195843 -0.13294069938326392 -0.72075046789679764;-0.64497873952701434 0.062858869847589136 -0.57570173751945408 0.36771735323741989 4.6089847998789386 0.71216134730914016 -0.029310122957846661 2.8019813332794721 -0.21668263370468002 -0.0093090825666533941 1.4999233578983406 -0.073267329773908901 0.83898449837142342 0.2857776716831088;-0.6338677249282304 -0.27355273593004142 0.85504295855177037 1.5588930580453433 -1.4081666419623882 0.17430759772341614 -0.8868342569991523 -1.0959478808321306 0.20909998524293746 0.58759788415182179 0.64552807421456659 -0.31962900115208237 1.4626839788904507 0.15872948274512028;-0.78597626609386662 0.045312816692746408 -0.24619218234976836 0.32417915328912461 -3.9587838232570332 -1.0823562099540751 -0.50889671404141712 0.39890965945449636 0.080877600883621906 0.41848032298790611 -0.8223898068690827 1.0278963645279751 -1.4155110655011118 0.049029829981483183;-0.83953774280273952 0.086283491615328695 0.73466888261893826 1.3634507328399403 -1.8366476286421389 -1.3633544179167483 -1.0930604006176141 -1.1575072785966269 0.052766126646445706 0.61308068853942388 0.10884342862987299 0.04113485191598662 0.55404331773714988 0.38670862897858593;0.11727277121915186 0.31858964122593675 0.10744398515768348 -1.0703911201227865 -1.5164224431767588 -0.44313357743769222 1.4172057273030734 1.2486742172667749 0.52734675635354089 1.4006040060313059 -0.2184602987038714 -0.12267413410721588 -1.3308216580884018 -0.59768128058041403;0.88702815577381555 -1.1816827590035717 -0.051087120252133023 0.01628290933587228 0.87297796567836028 -0.53838094030083139 -0.27459993614386224 -0.093285904869438122 -0.3290132920513259 -2.0305295754382864 1.0112497112122074 0.18108400499928673 -1.7270855989293283 0.21172093604318878;0.071712617420514546 0.31456444132991246 0.93450620911980053 -0.33520889325749681 2.3657835501275217 -0.14652069711583113 -1.3114306991186906 -0.69290686757933695 -1.8081877368142201 0.79063705522836714 -0.39142762778107837 -0.37324901379047126 0.4096220214970544 -0.074741476586169545;1.0007452530613461 -0.34225289459983538 0.66252523171747413 0.59490794182620932 -1.0545261270157613 0.14359905238224485 -0.026518900883273199 -0.93308305910683043 -1.4833275708211366 0.73856157817926327 0.3311919730007426 -1.4614404571080479 -0.2470029604181925 -0.013818353474238718;2.1148727964759875 0.24615019107341407 0.28440137560620632 -1.8772185222762225 1.7090369447917844 -0.10210205969447186 1.1183234112321643 -1.927105940100609 -0.31965878699862854 -0.66219916641090715 -1.0917813847312567 -1.144694223752402 -0.62661273705083897 -0.32744057588928821;0.57311001393398087 0.11791462595868726 0.51509024972807771 0.10925183661597086 1.0412531524395607 0.83613407547949936 -0.99105567108536097 0.25190832939144997 1.2191616732344914 1.4287275606798158 -0.37182447758987502 -0.49002070633286188 -0.044648077783449147 0.42489683326891148;0.7874715757586378 -1.5968874771285448 -0.42822453400518384 0.24025654384458645 -0.79910857882425868 0.29756837745494746 0.18341931515108384 0.73934432567675668 -0.24671419035469996 -0.33195595190252902 -0.11000677266523066 -0.43231041716171886 -0.26914616880678421 -0.35585978283085901];

% Layer 3
b3 = -0.83271807453636681;
LW3_2 = [-0.67931520840617621 0.26279151264770673 0.037057906019714704 -1.6339986451317001 -2.6068062126304055 -2.3279293344755638 1.1311257537131252 -0.1429666623514616 -0.042010274388080561 -0.56998636404909409 0.70767436731151112 -2.0010847505787628 0.18513698087973163 -0.88172668472828231];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
