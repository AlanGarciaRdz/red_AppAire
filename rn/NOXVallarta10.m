function [Y,Xf,Af] = NOXVallarta10(X,~,~)
%NOXVALLARTA10 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:27.
% 
% [Y] = NOXVallarta10(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.92467739595278831;-4.3236723424615429;0.52772983858450973;-4.374415039335485;-0.10135485543074217;1.935252990442115;-0.041841045546255715;-2.4314017540155999;0.99461584495248956;-0.051792636956053004;-1.3903141154679166;0.93231644437308148];
IW1_1 = [0.48503951891429359 2.6274238573430106 -0.50087464296928963 -0.27283585177653091 -0.45255884195954266 0.097400257201031806 -0.076109945040268925 -0.38967206751163175 0.04566347843456986;1.2508717968583907 1.7081951427116502 0.95456801120555546 -2.0530504459806678 0.32191481405345507 0.81838121795531005 -3.7734330226436832 1.1466915034496192 2.5514685424814685;-0.53563315351836827 2.1860970943660707 -0.87874701805907229 0.5415929577698535 -0.25812743648112146 1.4847568332936369 0.47558913898511529 -1.1685522258459224 -0.4542664258984605;-0.04257042341487912 0.0044634335508988605 -0.50065705029240526 -1.0155103288632268 -0.92563938873334095 0.19703215987316938 -0.44087609888509721 -3.0744626973228604 -0.28052386086181275;-0.0964345274968922 0.037186236855635241 -0.19004240368861969 1.1169121642700759 -1.522331897667536 0.24396662750625128 0.11116880306981035 -0.52406672650839659 -0.057822660043712663;-1.4818850172199003 -1.2491621205281358 0.51075825566690991 -0.6533918273670174 -0.62924024524271738 -0.18734691384249286 0.29202069767870392 0.51925260162222897 -0.43437632599654774;-1.5982859697738794 -0.16043991463156035 -2.7396087765127786 0.16472164917599103 -0.34792433472646922 0.063965939943733272 -1.2453187653482278 1.5479683447911892 1.6353525527676231;-0.804248546032997 3.7875899222939586 -0.29092326812984493 -0.032807276519332747 0.29601626891212546 0.86409101786609732 0.39690704587511161 0.42886182268155715 -0.26534623532204782;-1.5463465055949184 -0.85718150555588513 0.027915451083231471 -0.61120634765975657 -0.51832049336918429 -0.23773706521355875 -0.25773546182173956 -1.8858482616243371 -0.44471475256416654;1.7242715743288353 -3.1348398998896423 -0.18344587427930389 0.053848767260085958 -0.52014713361478082 0.045375602280164282 0.27870491473383768 -0.43519238908634833 0.18643885619689402;0.12673473885006012 -0.55058657110388265 0.22092581555234528 -0.84493742471744604 0.75161434216551892 -0.50992263930289372 -0.72211971522921514 -2.4023345197031034 -0.081047635318417674;1.3362939091806982 2.1615029090644828 -0.32834201899529825 0.042800636494704412 0.059973402630560321 -0.17956996984969711 0.021249150444814319 0.73386349770189108 -0.0032466420610279324];

% Layer 2
b2 = [-3.0030034913732395;-0.024024177689424706;1.3216185007711119;2.9259893398883614;-0.22859267321360768;1.0333989086697588;1.940568958849985;-1.1027481862591697;-1.7504919699821815;-2.5923689000463659;1.680638170848944;-2.3051259495823344];
LW2_1 = [-0.7564717927094422 0.31773568190352913 0.47643679133950251 -0.25892158202952598 0.2743473483886314 -0.21534595456729122 0.32012630506954004 0.82224016354259721 -0.72392660405485065 -1.947654431101836 1.0354223932495379 0.74070017431602686;3.5225382036700998 -1.3741722286779963 0.90360377677402559 -0.2992066810199564 -0.90012462457045572 1.8925853374342834 -0.38193769586730303 -0.83978624121705536 1.8311499647770857 0.27194301689722589 -0.61102751380875486 0.97431054876656831;0.061476418117540045 -0.97372762856336215 -0.30576672744314942 -0.57850870308289704 0.98758683012545656 0.91764661894177857 0.080173024042761054 -0.9458918915796839 -0.02563862472625305 1.3784582975312289 -0.36533723221381625 0.28313469910707756;-3.0793022839934583 0.19826928294097354 -0.83037933115268736 1.002267468016639 -0.24677106376217015 1.6799175657871792 0.080048853894925401 0.099934358737746296 0.72177585454462967 0.25516016644989714 -1.2804065898574903 -0.33633744405795529;0.58628576465453786 0.14516026583180935 -1.0556618933411508 0.33650478668562273 -0.086401423819536333 1.9760667954806943 0.16731340165511382 0.48225781646270655 0.15364744809861142 0.45692219192610806 -1.1843634678666546 -0.66816546059723525;-0.25676573358586618 -0.36279119908288293 -1.0165815966407861 -0.39315231347983665 0.74107064914518495 -1.7778724435941544 -0.26040258829029628 1.1903875112201647 1.5336984119671457 0.42390379720398047 -0.038961058375051275 0.31051661603154368;0.70486060187252342 -0.32978769274355046 -0.95532777165057248 1.1766645970176064 -1.0546001793705 -0.46600016509896119 -0.33193600533102041 -0.99908495946385212 0.27685643333768473 -0.72419880130833481 -1.9949398231216844 -1.7467323846526073;-0.53132322105620056 0.3645273747509799 1.1838357628048151 -0.27702827886010861 0.7966574082109813 -1.5934390649042225 0.13223205912310609 0.30194608334794415 0.79528843194828935 -1.264652654952473 1.0079645713723631 -0.84809127461094558;0.21667263011977023 0.43200376175405647 1.0651609565195024 0.37989771169127101 -0.70860401572821452 0.52816063100889254 0.22775823334277678 -1.2056519328499846 0.49011519113968555 -0.41280312936857222 0.061474274838050541 -0.32262255434425119;0.72838552211166829 0.45192788298247666 1.722732399352811 0.094483498923748271 -2.9660240911388835 -1.6463746736507991 -0.82537686134459354 1.0034677376085648 0.49031815944776724 2.2514017248868252 1.6802933079030908 -1.2905058254972941;2.1189357649048519 -0.43622632986916432 -1.0191702995678289 1.3203603733588045 -1.1625168536446908 -0.67332547166190093 -0.25711431064444662 -1.7865343796851827 0.31810575266313668 -1.5654923309961331 -1.774960503081253 -2.4989952331384075;-0.53360313454449815 0.24191737003359604 0.7323512551167205 -0.68629400892067027 0.68579161215544848 1.5841799959592349 0.32308427526748001 0.63302405831268527 -1.2049080952945217 0.44839435674833805 1.4868158031117022 1.2866798674414808];

% Layer 3
b3 = 1.0013776155750966;
LW3_2 = [-4.0327929863873493 -1.1221752488378924 -0.83922310912260467 -1.175623940182245 1.02769080443135 1.6165821179512168 1.4230252175906442 0.57327098732377757 1.5398326574532271 0.91891648588587016 -0.69563857483307667 3.1632224525230885];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
