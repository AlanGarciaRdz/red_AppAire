function [Y,Xf,Af] = PM10Aguilas16(X,~,~)
%PM10AGUILAS16 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:19:51.
% 
% [Y] = PM10Aguilas16(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125];
x1_step1_ymin = -1;

% Layer 1
b1 = [-4.3267669981833095;1.3281905408529491;-1.7235556825674105;-2.5924302236381469;3.9876576063562084;1.7054336988960164;-1.2813764985354261;1.7987349274621409;0.545584143073368;-1.0026793907849816;-4.8157308754909653;-0.95979045156873333;0.10497609048623449;-2.5255332504142207;-5.6557376976966172];
IW1_1 = [2.0790180975866104 1.3313872129581321 -0.21513622652597494 -2.5101444423054273 2.0210051844890611 0.84895294675638222 2.9748492647685851 -0.11468334108114223 -0.089642863710146251;1.6982090495488249 0.17270074529347457 0.17477498414733356 0.9760405124854441 -0.8880896080942805 2.1236340841834691 -0.59889360740167508 1.8788037084882863 0.45543429980571204;-1.2810885282607625 -1.0599092276712143 0.49549779384077924 -0.76912103642390761 -0.63645937792171703 -1.4202598805190112 -0.18083785446854786 0.18582273527449508 -0.22147239840893163;0.66826420830889266 -0.97166015277387829 0.3492446862169038 -3.5915830232142896 0.008148916215299706 -0.045892869039213094 -0.005845126127272348 0.16354944748736061 0.24317504179016747;-2.4602018003856458 -1.4652799882101424 0.57154668623819671 0.59618107704588219 -0.98873154932341889 -0.42969389264631463 6.3865292550113804 -0.95338709069085059 0.3881221034608045;-3.8701430427537633 -1.040059774962274 0.093716402354234285 -2.0439725420298358 -1.564823465849039 -0.52307238703841985 -2.4502374405941172 -0.073619109514571054 0.27703159545373912;0.46827659562438123 1.7258529900049409 -0.30177752837370281 0.0032709737127253266 0.012738643482103176 -0.54719317341305274 -0.65380041114357079 0.060549721306426878 -0.31418035177816145;0.18349265525441952 -0.64724510619251607 0.083447154733662626 2.5948233111548964 -1.1477851596567126 -0.35524837370193291 -0.016996822635765539 0.13557698111993752 -0.013221454068350083;-0.086565891684860924 -0.79252596455279878 0.52942536604615154 0.068241506007522851 1.1375210208620645 0.20610739431449071 1.9313549177193183 -0.019430813557587349 0.59043340197198046;-1.7831213401451385 0.25564920217064391 0.29670654164292215 -0.40605494637614126 -0.59070816191647746 0.4024649240019228 -0.42074444193270816 -0.072897504973767638 -0.27645522025663977;-2.6842123027621683 4.4954814511394403 -1.3520401345328823 -0.43120171275192692 -0.79275499548297934 1.4030101615805974 1.2378688362963561 -0.50108955450217008 -0.14625320059561722;-0.5766655850792447 -0.939239336956052 0.0064827600074295853 -3.0438124729830194 -1.0401151155171511 -0.36937797334954925 -2.3528645060763824 0.32589295419741127 0.21880337151289164;0.228318650066202 1.08226209277387 -0.14803756394942655 0.064831421425436617 1.011160990498992 -0.32858089375147842 -0.39453926166312309 -0.22277386147690983 0.18153346191513683;-0.95857803923495699 1.0973583162310074 -0.68177602270968662 -0.91929526417591823 -0.42661312968644222 -0.34490667222701477 0.39262742091184066 -0.23172367866707116 -0.40467910842837168;0.57123119041392201 3.4219726463840221 1.2243536843335214 1.0678662638735195 -0.98990755979238432 -0.50735783948081503 1.3872467021342305 4.7394860487975992 -0.28096512904535287];

% Layer 2
b2 = [0.093194996982951819;8.2753089064767451;-0.80624301344625782;-2.5073154966173861;-4.65412594159198;0.33056380361190468;-2.7652739770049037;-4.4713595318466091;0.35405217640352038;1.9515458437327631;-1.9734097640622115;2.5621942039441103;0.93700755757991561;-6.7680875404486063;2.1155222148693418];
LW2_1 = [0.87750231598931017 0.52477695641565802 -2.5935610162845664 0.068505418713988714 -0.34983290134626943 0.43284190917651755 -2.8893275770473315 -0.70814563209925396 2.8319297566072983 2.9260370701340723 -1.1843617954329568 2.1727648963115711 2.6117390065074941 1.6835138413826443 -3.2827793749651173;-1.1458775231228477 0.6086345941612662 0.50238256395944814 1.67734888469389 -1.8947548505548863 5.2587326435593535 3.8167042222851419 0.60798306166205329 2.066451876566934 4.5141167456449178 -2.3289713665373015 -4.7702843161368662 0.61425473205647552 -0.22260463745470602 4.5520920427362128;1.6093443195465105 -1.3095799544342062 0.92364383207107392 -2.7045881518707526 1.599611486425051 0.85908929125231637 -1.212998798025785 2.3849231789271981 0.38639672210946641 -1.8399531707940244 0.92553516022748705 2.9770918541720581 2.24624024220864 -0.45252635364282767 0.72241953439619744;0.90837255313370158 0.090827713742127725 0.051937822206509728 -3.5012655740989449 0.59064454524701704 1.7576458745781764 0.091365113585143057 1.0591052505870033 0.45641741764601668 -0.64425670073331798 -0.67725910468287576 2.5672053714224217 0.39730755204721463 -1.5980816893020822 0.039756462208748108;-0.047298185833018938 0.89339287667671763 2.2787718259300926 2.6891676087498562 0.065832611411051081 -2.9824770122016053 -1.074923064912046 -0.14515936263296331 -1.8690938902702003 -2.6453376352153923 2.1817617382346102 1.6036239578620524 2.7507825351332107 -2.2863900664559003 0.61562426869736886;2.6939278359847787 0.55863851324639591 -1.5224005762305306 -1.804846707983357 -1.2152852908941241 -1.4675764650746939 -0.11019215845102487 2.1483321366659163 2.4722233429599485 -0.44319803248777062 -0.20470135052671962 2.3094887933590154 2.1473637553148124 4.917447026033364 0.78689004345767377;-3.3845137588585872 1.2342969867194855 -1.589980265607164 -0.66291685494166408 2.0293539654802615 -0.34618727312115488 6.0244654217480207 -2.3077434973178437 3.1114284826251368 0.72492433385558708 -2.0666412120128865 2.309616821650478 -4.1649970601759811 -1.0907450414896265 -0.087411826352995062;-1.028300244255798 1.7566733533299594 1.541233355898288 -0.66695022728038555 0.89400196122428555 0.29432848347584289 0.32226053778491148 1.7187474865838579 -0.71377554280482047 -0.20893093605907154 -1.7670229191404452 0.30787392249484891 4.195472266180607 1.2218806572064329 -1.5118753639999947;-0.42494243735728238 -0.28762256991731355 2.0955173406844216 -3.091281204376688 -1.1183678757795279 -0.72553750574128095 -1.5050958837066346 -1.4373864413048421 -0.31866474379048237 -0.3339044744387944 -1.2693979202255601 2.8330770912957126 2.2493480830624848 4.4675711212989109 -2.9482251299542743;1.4492056447021608 -0.70974857849370121 -0.20572688838888423 2.4184631753966306 0.13412834857081865 -1.4973627805811314 2.7260327275272362 2.5809376912158664 1.7613121361183401 -0.17000728669606904 -0.22623610831174562 -1.793500547914896 -2.1283253030382143 1.5791057743042738 0.79771914829234092;0.46248327150268903 0.5537294165791089 2.0919368731274792 -0.064248701711800207 0.049204936711029983 0.72724983054069858 1.3367076804017166 2.4145914190750184 -0.19444367071555607 -3.7704475594538018 1.227332873985064 0.4720984332342737 2.9475939332321048 1.2139865269556798 0.16646693212641031;-5.6751228921123813 -0.80612734556358656 -0.060549215825442537 -2.2742738966766369 3.2999638528975872 1.4663507399711833 1.9227903173322083 -2.3562582888423798 2.9833837899689328 2.3684206878133161 0.088172385999311681 2.3624156817578892 -2.8257734580809188 0.38036461463732718 -0.23604457852943425;-3.1559735339222881 1.8950296384665777 -2.1702024685844057 1.6241442475539256 -1.8319653111006278 -1.5155686610076611 0.50499468817226778 -1.2333282365042804 0.57131031549377065 -0.72017718001554643 -0.0057325939490680128 1.0936411455217223 -2.8420962599029891 3.2611751455410194 -2.0403084525627926;-2.2108045962576881 -1.5371109469584003 0.94221908196987236 -2.8134438055821862 2.2075446332318172 4.3707489949511746 3.0922631209122051 -1.4608775393218738 2.8111011968152244 4.2974107807998285 -2.1662795765717084 0.63282211231325947 -0.76229138119784001 -3.4936254501552195 3.815090895195516;1.8683563059470534 -0.32954570527201821 -1.0641184829372454 -3.0676745970708947 0.1646793341203972 3.7291630141970296 -1.0193373479223637 2.0277299799905055 0.70072457510867958 2.7723308331039704 -3.1532077080418932 -1.5612596069290392 0.22574910592126213 -0.5988256145830132 -0.57128105672193608];

% Layer 3
b3 = -0.80348726678775995;
LW3_2 = [-0.018907533369830122 -0.091821408762208151 -0.080257485736650425 0.25086585612419277 0.23256900708708286 -0.11961554682936552 -0.068754840285684751 -0.10177629895239917 0.087400633840550759 0.1090012175233642 0.16367792305021112 -0.053408900485917406 0.031954003920127774 0.044923783430608939 0.23675386637125115];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
