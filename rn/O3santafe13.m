function [Y,Xf,Af] = O3santafe13(X,~,~)
%O3SANTAFE13 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:50.
% 
% [Y] = O3santafe13(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.172786177105832;4.16666666666667;10.752688172043];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.0766567551016573;2.8062532031030925;-7.1672847268306876;-2.2874817800499878;0.74076950259946706;3.6777743502785527;2.8685085969379105;-0.49309543169622527;-7.7812124224204622;8.3436420237611415;-16.822092792435441;-2.9364648403565421;11.635220075858149;2.2129167477364784;-14.093460258705708];
  IW1_1 = [1.1119800047158144 0.93427520347475346 -0.12165615907686508 0.12433506755502417 -0.86777983390076774;-1.8992379186911812 2.5251887922441245 2.0772862751463128 -2.626995636057897 -0.093533574956425031;-0.65406293933704684 -14.931394904962799 -0.068083169511763506 2.4191246082701263 4.6653499509649947;2.7956989739272466 0.6918022615860836 0.72069400183775345 -1.692744406310817 -0.37668312902520101;-0.13501598787059566 6.5522777159055483 -0.38489529291825747 -0.32037635831266842 -0.04489461610194749;-4.1334354279428016 0.3002068385215092 0.56800455378792658 -0.9951448138061757 0.15437668891990913;0.26865303236912447 -5.5287673312737748 0.23881183078372778 -1.246193348240773 -0.18220658604748469;-1.6394827052249412 -0.062342392332964097 0.36725225496106789 -0.21152943527192222 0.5002344292017159;-0.56511541727731507 13.293836583609277 -9.5300729475663299 -3.0742294185799115 -3.1911387075581006;-0.028955128119767904 7.6397542031275281 -2.0778276404506943 0.26274082020632072 4.8492479455243211;-1.0768354272788367 -0.79518537229600472 0.35798440199474035 -15.45710110501526 0.18286358504602376;-3.2389431269513764 0.047103412130108546 -1.9991714181467319 0.62764360381525708 -0.23495617453280104;0.47665894513700774 -0.27443091375675077 -0.1461103359966304 0.12810924287293451 10.788415640587822;1.1216315130499348 -0.56485787055642922 -0.3064116692261582 0.3189822500663228 0.71922832532565639;-0.66361549306524015 0.52996792266732029 -5.8217253644772793 -9.6796547903897228 2.4924375352878254];
  
  % Layer 2
  b2 = [-12.540315476695723;5.2900795662442119;0.51267932820590545;2.835008957294904;5.8369333400843413;6.8916062000292664;-0.31801044833582148;3.9635745802955027;2.9148851514161844;-15.143835610662984;-2.6859854308023943;0.68555018311292715;5.998874827128807;-7.0285652599593993;1.6949239113407015];
  LW2_1 = [1.6375782977867557 -0.097217434756317542 0.34942667214203338 -0.33388586803218312 -22.426781607638102 -0.57415610708464093 -14.817822509955599 -0.6622587723130684 0.64334766571225921 -0.38052157480053561 7.8399915611121465 1.2140945370477494 -1.3570599098612002 14.130072949985873 0.11611270479236178;-1.1064649215843145 0.24757550712232107 0.20439583127025637 -0.17753883786830291 -0.3303531784340123 -6.5860406721531319 -0.56915103323241367 0.10617539910831425 0.18768338926131661 0.44825742836291571 1.1434664295453154 -1.1642250642661602 -0.64336991816667022 3.6979553450499552 -0.80366848847870731;0.92864179507967715 -0.072661041870406146 -0.16769510494286913 0.29630827329734144 -0.25630739257243818 0.20205630394550728 -0.45162161949918456 0.39742671215061509 0.045864299320766772 -0.31063739270132312 -0.10068940544558311 -0.45195935052328179 -1.1733947633912118 0.16803514621263688 -0.27750773804987772;-0.86849382209110249 0.090311476124084702 3.1208981525733432 2.231548143911207 0.88901730707868087 3.5793000147824401 -0.66405701019731056 -0.8195906999467254 -0.89461405413736106 -1.8135532612332357 -0.50634216725510417 -1.2503094680893609 -1.1943608680713467 2.3695121969607111 0.79259523391603892;0.29334764052292578 0.08603623509672105 -0.1746554848102756 0.16854208836103052 -0.37049675303768942 0.36913858158690593 -0.83345475209759634 -1.3658113403497083 -0.24172041008138651 -1.1985450775419868 1.9627731655948528 -0.97734918121980674 -0.75515730882733856 -3.2776356879451547 0.65316103211064402;-2.5691234838220902 -0.2086193771464615 -0.24129543939937154 0.29106781835675805 0.050418916525528393 0.47420750220079838 -0.83142966704315979 1.4050729536760334 -0.28311913631265428 0.75683445831525065 -1.4156261045198477 -0.94134001953028945 0.65012363769558923 -4.646146429849126 1.0639878869525805;-1.9407397871935972 -1.6543073458015163 1.6303733421187374 -0.60370650473860477 0.10405752235697299 1.7002733567331236 -0.38646236068872891 -0.33296745115584392 -14.689092667878009 16.863972694307439 -1.4937532088839547 -0.36753102693015921 14.318170077080888 -6.5691854046640064 1.7102702576097117;-13.690355682250257 0.028713102514712478 -1.7647404595949712 -3.0135147515429792 3.3868975294931336 -3.0554252640129484 0.085778814618950497 -8.1190248164704482 0.32774557860549414 0.54113331845080714 -0.81743541016257204 2.5896373802391088 0.12916692260191148 -0.72635915196123846 1.5252880973076908;-0.018521850493722909 -0.23338671839385222 -0.10813646735286088 0.25302125421913307 -0.13933249231096748 0.45124936881119504 -0.32757896952608051 0.52481748655636307 0.11058465279912805 0.078547489168698401 1.8068779379833952 -0.24929780464630608 -0.97187837572694646 0.63658702462594596 -0.31477747646379123;0.56645529635743086 0.44004443399696302 0.3132496681800479 -0.35856723056619078 -0.46247683129578515 0.069713827479892035 15.865654732597626 0.99987214187805951 0.34054782974188114 0.58801268099022852 3.6287839025156323 0.14374237577109814 0.25877471149605746 1.2723647579902746 0.20687698358245796;-0.9212242685916856 0.052635162370635744 0.26513452714017699 -0.44448423650835578 -0.84109803219757961 0.57112831136012643 1.3129637679252741 0.65431403124287846 1.0176747565840332 -1.6158240802312112 -0.27278113554258215 0.21251720797480003 0.34760546257806763 1.5272753347804924 0.4336841432533784;-7.5114852755275843 0.33677623119307593 -1.3270528065154223 -1.7639686006071926 -1.0410866137563999 -3.0083900802077812 0.14949478014781703 -5.9251836127496809 0.83269852371296871 1.9307948306855838 -0.77754286665287975 0.85582025275191265 -1.2394890385271204 -0.93459382484212206 0.28664685851414307;6.9959871373238407 -2.8534898075987911 1.155949597508994 6.0587688757827518 0.053155770869637839 0.97720687396687456 -7.6745043842590901 9.6517557927786726 -2.1444259337864171 -1.3885326703123717 -8.5436664957456419 -2.366076496510328 -3.2566472805701858 8.2735128378820804 -1.2412275425398469;1.7085839270737178 -3.3511804823746503 0.54131206213241367 -3.3692614185408121 2.2229967415266683 -3.6346254806272817 -6.3169318227684617 8.0369415392335579 10.877179779453154 -5.8630563353231677 11.843055597185968 3.7228759458392005 3.6824617617930215 14.916833461232558 -1.1322264962279973;1.1636814445951285 -0.0017959014853766095 -0.24884644703080566 0.41670665423578646 0.74871290154031023 -0.66075199059335754 -0.12859579080962896 -0.72773972398096176 -1.0109485213169593 1.6148017928983522 0.32236670126229328 -0.1569161961383331 -0.33652384801763369 -1.8846341902320645 -0.37870464934870185];
  
  % Layer 3
  b3 = -1.6522409319292293;
  LW3_2 = [0.50981047536736646 -0.37639662012121222 1.5403056435365552 0.27256505955435401 -0.57450449942102055 0.65757438955304215 3.1201538553210901 -0.25608467360689241 -2.3763187838672071 0.6626722203440879 -6.8606959287536995 0.35612534894740627 -0.28886343541781129 0.1163972392888921 -6.7945765587418521];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.752688172043;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
