function [Y,Xf,Af] = O3santafe14(X,~,~)
%O3SANTAFE14 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:50.
% 
% [Y] = O3santafe14(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.172786177105832;4.16666666666667;10.752688172043];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.1041111024066756;-1.7830436139122825;1.3748797258877563;-0.237295219446786;-2.3343455565304585;2.9394635043557016;6.8254119863248617;9.583498557080345;2.6440089686217352;-1.3574228327005542;10.123700451381492;-6.6017283441414181];
  IW1_1 = [3.9599874157733952 -0.074417478893749611 0.28505111823187007 -0.032842692204557003 0.11448129473321418;-0.48041789400675416 -1.1502817550229492 1.6239948930697492 -2.5446861803394869 0.59134327147268284;-0.18315376119381169 6.5996191854646353 -4.9364256480219915 0.5724913858250037 0.69363642258369773;0.39865015828824324 -0.77339199252701407 -0.2970273302394934 0.71229377955160456 -1.9516985987392956;-1.3053411929051821 -4.2354357140869174 -0.036286894730187112 -0.57220480958015463 0.62357531848065828;0.44674612366978395 0.26604965688362187 -0.21763203968688852 0.11412774944584718 3.1898086173668494;-0.8476320937590458 2.0253826287957892 -1.8634492747771547 8.0003488187240013 0.47516463266165498;0.31525718551842385 2.5971216673334268 7.5198207378377315 -0.7120119779454992 3.0222753348381444;-0.17825775142287345 8.1366292630294499 -1.7348936019044461 0.7949311262483616 -1.2586534735431198;-2.0599755573013998 0.0041855689735294912 -0.027361952217335991 -0.41762585907013616 -0.65918174069490132;0.45678081000971366 3.6029607464376574 6.1111262773044812 1.9946966324398019 -0.48061527403719556;0.23417480120795672 0.15200917844050493 -0.11939053329276711 0.061825809815449884 -6.4969422094558622];
  
  % Layer 2
  b2 = [-1.3669449613639686;-3.1567692528471842;-12.573355845500885;-3.621322955731932;1.7961465841358082;2.0822583219408859;1.4415949703732687;2.1000594109408484;-0.85312260766705839;2.2277859914698905;1.1182753421007179;2.9555308616228322];
  LW2_1 = [1.4439387783094051 -0.29535460212752634 -1.3847191676862138 -0.17266880206398527 -2.8268984852105556 -0.91714617753016026 -2.0407184501032378 -1.1393405200106459 -0.71326281128492419 -5.1258838373041282 -0.84520528780604254 0.12576415951614922;1.5829284320402441 2.3668842250209829 -1.5165972709715847 1.908066196255956 -4.4743212935728165 -10.505689550736703 0.01491219031749022 0.72425829679920883 0.22625373101287818 1.7688079531614893 -1.9284119434140845 18.403770102460101;-0.29942599132783337 -10.168604442604058 5.2514953760446961 1.3761600173948487 0.099710186489272476 1.3960044571310379 -4.3588714767564829 3.2217152807611833 4.6523455132708236 3.7705565812980573 -12.23784492403359 -0.49287064447576978;0.58738477547075707 -0.25765158950725431 -3.840290951155481 -4.0106728335961304 0.34473383698630689 0.30223126476061724 -2.8190436183047902 0.22124264519104619 -0.030493601530766773 2.2862172111084766 -1.1460331026211434 -0.18453467081649227;1.3693326074443941 1.2370418098488563 -1.4346044428656051 1.0966876176702931 -6.6362162912793909 -4.1186264993511399 -6.8968817181166129 -2.4857538412498363 -1.6020397223544869 -4.1926833590095081 6.6203906577613836 0.11127821767824608;-1.5164272876841227 -2.0491893861251782 -0.07427452659990022 -0.0016769801300044601 1.0682922806318778 0.21998315465113452 -0.0060250443700677406 0.15296764833295956 0.077345682532372492 0.31820718315008301 0.4005731408812675 0.28548933666135928;-0.17978532440851425 -0.14990009929848863 3.4486570264945851 1.0438615615257811 2.1989078761423841 -0.99486738261434671 2.5131078306387971 0.38254054034603557 -2.5791902397314503 -2.4583570189522055 1.2955804114779137 -0.11835106402248861;-1.0458917910534393 -1.2312606788556208 1.4653461655778925 1.3664973018779776 0.18724254010885502 0.3956829906997279 -0.54991041388020601 -0.068433461656036018 2.5766182083406548 -1.1849277115820001 0.6857835380709616 0.37238431172257841;-1.3920391166687562 2.7253779572172618 0.99004876214709514 0.39389792428709536 -1.7953036399687392 0.26011997613278648 0.78057244605644449 0.51334313175558222 0.0046527057253387613 0.58367486987436568 -3.2155673585981797 -0.18522491438104655;-1.6386918563443729 -0.62178799520946637 0.90382517999891088 -2.7023321029428988 0.23342773005662942 -1.3369254510322117 -0.32959361045892488 0.0075642584425889038 -0.46158640586133731 -2.6425441125705542 0.38493861160181375 -0.28021225796449439;1.2873704938726471 -2.9183544407292477 -1.0882943947643302 -0.46724511067706681 1.5237896047025663 -0.17617854492700935 -0.8528721740398828 -0.60758180890008218 0.03819877792335899 -0.61546733677441112 3.1842723546297651 0.36264032111398348;0.80742570889070631 -2.7156134586354201 -1.1816038211745756 -0.51253411592146325 3.869129588273172 -0.5069304267938034 -0.93071377829531421 -0.36033871162478143 1.2851133491397284 -0.88185479036917713 0.29349671498167651 -0.13823057154156929];
  
  % Layer 3
  b3 = 2.5633882699239039;
  LW3_2 = [-0.046895580968879344 -4.3178468509168697 4.7478374037603848 4.9519529435592515 0.041119964834500929 -3.2755503276147144 5.2333459563226068 0.76070996354159148 3.3906351042647471 -1.1882500744663438 3.2462976406226027 0.4700288287290143];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.752688172043;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
