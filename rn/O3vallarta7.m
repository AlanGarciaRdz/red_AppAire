function [Y,Xf,Af] = O3vallarta7(X,~,~)
%O3VALLARTA7 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:54.
% 
% [Y] = O3vallarta7(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.12820512820513;24.390243902439;0.02710027100271;0.141843971631206;10.4712041884817];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-0.34476551416879958;-1.628177208310305;-3.4872060468756563;-1.583308662739062;1.1971120088256253;-0.33284748306820017;2.3763112786260541;-1.1390724602034392;3.2933312915863504;0.34542502495296667;2.2106333427816711;3.3751081233562701;-8.5125014669499937;-0.53682921499760017;-2.0282602473015308];
  IW1_1 = [2.5248352408882369 1.5778877760677394 0.61290106596509453 0.19649903389793372 0.46607663935975369 -0.26873067189666733 0.37932879723776042;0.26629565773061692 3.2325994216013836 1.622738343698606 -1.0640244805421739 -0.70976200605143402 0.45746680830891329 0.98311559505710422;0.20705468016503173 -0.755014655717414 -1.4022564099841859 -0.31525756101538127 -0.55731625456779654 0.28109072613861019 -1.9507758470896936;0.40926263325264806 2.1472839773398262 -0.13783269919713784 -1.1147296133210161 0.22960004214087923 -0.077617714821471714 -0.080038234149065857;-0.21184620220594519 -1.2920498356867469 -0.95485169962859573 -1.3709265091101559 2.8985348195143934 -0.2007145442815037 -0.28015179171221999;1.027864385465338 -0.85499990568185225 -0.080768738408456081 -0.64102332149907293 2.2734997733063524 0.26368474721029012 0.15565969415318717;0.049390621003500557 -0.97134379553656891 2.3639230284441259 1.3743637220430247 -1.660956877825251 -0.39694657732832034 0.38850838323168613;-0.66414294545906527 0.94180013151003816 -1.4040656521951906 1.1436508837280666 -1.9559788082876746 -1.5021283127850238 0.12394130064395327;1.2385284664920153 0.093894621928207439 0.53081833699891423 1.1275572778400191 0.24196117331259148 -0.044423491720082142 3.0993776404757538;1.3488631750446332 0.10425246666499512 -0.2150211142277946 -0.45668483352001082 -0.014079106919393508 0.10728613580127162 -0.55075393926092242;0.10119549943175102 0.30554421796062831 3.5404451877481811 -0.68475343868241068 -1.8880958454253729 -0.23747335004395922 -0.47098636904987329;0.9023214632430091 3.9041403438205493 -0.46052059743820412 0.27957576160496084 0.3788998743523625 -0.38192928222759565 -0.11824129970418067;-0.34038211804154361 -0.12252372991767434 1.0567167809373792 0.81437200648954522 0.25020517259782743 -0.11157361818827648 -9.4770488182652102;-1.6419681750177313 0.35569582088066515 0.26990360575530337 -1.5002939841977894 0.73845593171279267 0.44769287523926454 -0.084319141628936639;-0.74389720515199287 -0.14889786561733157 -0.73938931760146231 0.86696756896185445 -0.14991694962287816 0.67882916187026754 -0.20498052651298135];
  
  % Layer 2
  b2 = [-0.68303969606211379;-2.0730759029661261;-1.3433286651662693;-1.3402367289932922;-1.0139828335410834;-0.725105200566309;-0.27398902286272342;0.19283351037074445;-0.20840573560758979;0.5062640000298283;-0.97116167934317599;-0.6772639745200012;1.2697084494083126;0.68243621973603119;-0.75188430030557674];
  LW2_1 = [0.41616453654645069 0.18422887368264093 -1.0826789793556004 -0.36682442218340872 -0.055444111757603262 -0.48910870442292814 -0.017666555602236581 -0.50206650673181608 -0.5321067738701124 -1.2421814361613741 0.43695610512568478 0.047928704118762155 -2.0054751328021894 0.038312838614029746 -0.66859210331122598;-0.12243480385410482 -0.84643514288835919 1.9581955809117377 1.6312827685468432 0.84669846791639392 0.4819178828415786 0.46193058273312515 0.6406779434434543 0.7221569694226625 2.1049681904483424 -0.1301992769186828 0.66580487245794961 3.3322582119253856 1.6189433651039078 -0.28182697855007532;-0.91862943061641333 -1.183783065053686 -1.0049021470173718 0.33529527112190255 -1.9662137769460479 -1.6780679143948471 1.3081184026327877 -0.0039450878463450469 -0.0018564302213864604 -0.33136958330432709 -1.5586215613148884 -0.84898752310171743 -1.7201934053724088 1.6446325082619102 -0.4251245727742583;-0.24506514772203242 -1.2758476385221618 -0.23051354472982488 1.0777093975038929 -0.74936930939489865 -0.48833621497749791 -0.45572995046598647 -1.677521248235835 -0.098155904653625392 0.82093857560826677 0.12687430251599571 -1.2112365539157712 -0.32882916512740673 -0.40956070101668629 0.78927909272398289;0.55195533030290245 0.074450261878666726 -1.2374559430724177 -0.28400563047276051 -1.6331137515006158 -0.04206899941415923 -0.9107109357564912 -0.031312984443786496 -0.74969596062457355 2.4447651203978493 0.48101631608699907 1.2565738736669589 0.28515662865747443 -1.0069516709840016 1.1525935477065903;0.11506456099998939 -0.8073476701581499 1.6200028906802078 1.5568223512908612 0.3993669539057963 0.099457468960347142 0.43933613685784106 0.25162765083822575 0.37255338235183788 1.1254561998395489 -0.40867387358775925 0.62307285163438431 2.3258693640564019 1.4553801524296484 0.96796336115782511;-0.99125189974734607 -0.97453903505460804 -0.34898376413326337 1.1074358528708821 -1.5211490724943348 -0.055821403269993519 -0.51538119576767705 -1.4231267626408837 0.080755799008207702 -0.080888554052890166 0.68610176681782042 -0.33289405207990636 0.088882579843979515 -0.48514440624355226 0.58198600506968923;-1.2601371301308817 0.056046514080186571 -0.71882728410445085 0.87825208893686202 -0.84884353087892861 0.3942516624556538 -0.74429503745652348 0.25848781739744298 0.13407660714532316 -1.1834458243065107 1.1252997667468676 -0.60365476321551059 -0.46362231961581929 -0.65910225211088536 0.18359523987234044;-0.11143286526335762 -0.12160921891407506 0.89921444372666504 0.37904688373664691 0.31098830173810088 0.46639674353753169 0.54461029914372006 -0.060006385317533106 0.087379335963027369 0.81174265792950184 -1.0130212069230859 0.12967116539369095 0.80429133575236844 -0.39133862900423466 0.6805811270323644;-1.0975462556451219 0.014302087508590494 -0.67119071778503514 0.8068704276252755 -0.98750201389255576 0.56649063444513226 -0.71718534898161579 0.20865153165893302 0.11039133949139532 -1.5192487015409935 1.1212466771961975 -0.26497464330547976 -0.43893773842687572 -0.61528901625209909 0.41265287944077172;-0.49678209592001499 0.66132669384951714 -0.47077740072789798 1.1929803722261467 0.25384596166114887 -2.1657187571687273 0.23039580428610304 0.19318008680634235 -0.035319400056082167 -0.9696529070284331 -0.51587709721082486 -1.8585383614556881 0.014578105692726799 -0.68455014174077522 0.43410194446110589;0.87743077913598144 0.30874614700323655 -1.6012055731167576 -0.78940050179490395 -0.42017562241305545 -0.62390814019222607 0.04937464876576414 -1.0083698037963542 -1.1279985970287922 -2.3404965613822251 0.31733710406407917 -0.060225744675689863 -3.2356726060903505 -0.39415666468395599 -0.80311539323419412;0.27118791161762118 -0.29246234449306979 0.53170963420316952 0.099633987560105747 0.76450356150132659 -0.67470891311522141 -0.63875016064088574 0.19874239883707256 0.83553205072619241 -0.29507968599673445 0.28718073315383047 -0.86993446024158461 0.65323934494995706 -0.15139765769838281 -0.029166625356960178;0.093969829688988094 0.62707265099517928 -0.81989480162056094 -1.6165550866009926 0.87152125764022492 0.47779043593359205 0.51559383776459511 0.45058646846570344 -0.78176788618515514 0.31649928043767278 -0.060698146201443114 -0.92297960606948726 -0.62486110946339768 1.1733340075935537 1.656752537850156;-2.250396880577243 0.54633752240817457 1.0032718738188255 0.12967799532881985 -1.0063040470071971 -1.9519080001559148 -1.1629958210765978 -0.19623803567397899 0.15926906409731742 -2.9862194981463528 0.35717286278461663 -0.37861322295779265 0.33067787768449147 0.016465325238385425 -0.53215595641793001];
  
  % Layer 3
  b3 = -0.43630737519172991;
  LW3_2 = [3.5279480911785073 -2.0998405473481032 0.37885410184419616 -0.59249876057450312 0.43865618201245232 2.5652512820261446 0.60967426219841259 -1.7672232728754416 1.5962832613127822 1.8537480624697362 0.39892625984991942 -1.8387404148127369 0.65313899514897933 0.56138524773972798 -0.55135336673687518];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.4712041884817;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
