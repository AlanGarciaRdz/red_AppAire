function [Y,Xf,Af] = O3aguilas4(X,~,~)
%O3AGUILAS4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:33.
% 
% [Y] = O3aguilas4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.42005420054201;35.0877192982456;0.0561797752808989;0.00588581518540318;11.7647058823529];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.3935746991128415;1.2833994984469053;1.6609761050061753;-1.4009202014876645;1.8270744615524082;-2.2224896209816674;0.55806431719276517;0.59188082046038304;0.37425593503831511;0.65979774129767654;-1.2692968956962576;0.31004154654215005;1.0907009580499907;1.9639679413655071;1.9759805230896725];
  IW1_1 = [-0.35197103896600812 -0.16838796259347233 -0.52905067027791219 0.41985656875710736 -0.143434599602937 -0.19271392713412636 1.0936626626090142;-1.7907455842492543 -0.037358296636639733 0.35057945077564551 0.2801857965911731 -0.7554946869599195 -0.34138730176324772 0.82913241375853464;-0.42576024796022116 -0.089530412904819473 -1.3213786022133729 -0.38281036318242179 -1.06411767207505 -0.379423512864209 0.34163493605282996;1.1494341319213981 1.4169365660645841 0.37912138407822055 -1.1003102294617013 -0.082562349638553925 0.19373576375842033 0.31473915446767831;-2.079633180983564 0.21038254963526901 -0.85092980569112242 -0.48098806307324732 0.05996654624328096 -1.1379281334669622 -0.93809382506800643;0.0987808334944935 0.51470508579051111 -0.3980529808699419 -0.33419060626986508 0.011993158732379465 -0.10004449994502855 -1.6106999060839251;-0.010781106898889291 1.9240385292521807 1.0632884265305911 -0.46948079495799139 -0.50934932069439887 0.10979753616409745 0.67511622359314127;-1.2680401567062844 -0.12909539013575991 0.86032800331940618 -0.213169370192517 -1.221037243577465 -0.74664711798007311 0.51059246273834558;0.32145639907368728 -1.3939812932235414 0.28986524533067654 0.70611027513911773 0.19576811444461409 0.033759165778768641 -1.2928326016959883;2.3730747745250871 -0.4938204623881679 -0.046607173926998494 1.4687811962289494 -0.92109561503699611 -0.082940262747525043 -0.37423880340233229;-2.1317295242640153 0.54971647150608305 -0.35686143863824393 -0.39744865931792178 0.17489516455410431 0.038771765536359935 -0.3859160107231373;-0.18431174994956237 0.49934055467473337 -2.4816080611730738 0.87806631392553713 -1.3080665739071298 -0.58309572671338272 -0.4188135374719959;2.7906996857268411 0.47836059477168502 -0.12270551619403888 -0.2962372483698244 -0.14983263893221802 -0.070671082029378982 0.16880492286289897;0.93226934811103579 2.0061063008131836 -0.16377912560203248 0.20733928945937427 -1.8409368506440089 -0.18152177392057708 -0.079443903602395602;0.37889994058718557 -0.82684121439992486 0.8411875441688057 0.14669094613611061 -1.0775385227205951 -0.57289090450437608 -0.28376549390777411];
  
  % Layer 2
  b2 = [0.997638279116149;0.63696451671363696;-1.2563935355531428;0.89791614576977197;0.33058015807463692;1.1425519047403636;0.35336190190739536;0.40809881566262646;1.2411799701071262;-0.86288169246611168;0.74900735997816281;-0.22002449377872765;-1.4888388437740341;1.3707891182929486;1.8979965907262284];
  LW2_1 = [0.87381018755180351 -1.2325854523029647 -0.44381012670586961 0.85176140847839676 -0.65411429296213208 -0.079940597705362673 -0.44360668831234423 0.55171111303378106 0.21261140130097073 0.79655626006011271 -0.30902607922260583 -1.215275272003304 0.59624153915010825 0.85763028057529445 0.31689146054780298;-0.5153815120188 -0.34043245200914074 -0.39511670880598448 -0.071211871792248485 0.39350663403658181 -0.6243481012161084 0.45147486037216394 0.90752089066784625 0.54389032543183724 -0.14423440109782562 -0.18364907342171921 -0.0099061121410868001 0.59384545397120847 0.35743817061443256 -0.80064839693249712;-0.31940118718595106 -0.98218683205509882 0.14855881932830689 -0.64918347175940883 -0.79139346180295833 -0.5426876101684498 -0.33649934660836767 0.28797104219737391 1.6418133979452361 -0.61242448410368477 0.014044807189246776 -0.58905912617751255 -0.33475478847616008 -0.68919170881453962 -0.65616638880792277;0.05547741058370842 -0.42814830449964997 -0.023112953874668798 0.54310459679806355 -0.5683996396493971 -0.29869103177143186 0.27363583329412278 -0.55495878358465711 0.39637157095491848 -0.69412158994841167 -0.82123844338466157 -0.12393895457094443 0.63969153003967416 -0.93900923543037185 0.54175314918017248;-0.2999921820488935 -0.57308022150080218 -0.32970197026178544 0.85247311862745501 -0.032759436121398901 0.20701444427733537 0.17444783564520946 0.72386296883092105 0.86149004710043264 0.22900315549809741 -0.33472432174340744 -0.026382127514979072 0.56062767083737663 0.51837589661119299 -0.62683530998639492;-0.39573458257276956 -0.06660536242848579 1.0724588413506371 0.50689031381744476 -0.094625921169000288 0.044101783847181796 -0.033195453680058398 -0.4035728008903946 -0.032299931320717484 1.1210464281952217 1.2797077240346075 -0.60767200184189341 -0.51142899598453417 -0.93567908618215556 0.11477578575407868;-0.0078113790302489286 -0.13397783495101534 -0.1996702578750584 0.020947901365479964 0.010584474833359956 -0.37491258464212468 0.12108448139382937 -0.92976294943927618 -1.516566944409004 0.58139397277334126 0.90614874657067335 -0.99070446645367116 -0.14989449413962094 -0.50519993147919484 0.58312246536756784;-0.59836815024854029 -1.4849938985842133 -0.41265573899225549 0.053438392745175138 0.39707653931144576 -0.43014485918290385 -0.33877331532239313 0.25345019774743049 -1.1955957659461192 0.72459205112532143 1.2712400135870623 0.0087594309628725824 -0.50114470965896241 0.17622248167978566 0.070488398462942053;0.76853642775175657 -0.82096768226407035 0.97562059545504731 0.65230640778787941 0.49490657597653281 0.61321902279496221 1.2130634477602955 0.22763195036460332 -1.1824822494166412 0.35964979339815167 0.13259267707895758 0.63750058337372795 -0.9428339535221818 0.8611110568673439 -0.24461180780852104;-0.58433654163303661 -0.77979033235403861 0.072445520184992396 -0.30612550012722167 0.20716045467488092 -0.15954480526927026 -0.029048883109602408 0.050440224437710637 -0.61639436248051704 -0.20692995452375004 -0.62816161916407443 0.391431494480245 -0.49582957079935536 1.010597628869488 0.11368064152633829;0.3801098947039066 -0.57953042228710039 0.22134825663977092 -0.21372984708445464 0.50900271529816077 0.60229362357922245 0.044442303024278249 -0.77241325206489142 -0.77490031394749159 -0.12420714790047052 -0.18077195082427133 -0.93424807290772149 -1.0218900782128111 0.30554079125444927 0.31491619818731859;-0.33542201185368065 -0.90725389189093042 0.71996636017268112 0.45894076153980745 1.0132519665859163 1.3113729518485264 -0.55511590470231365 0.46195473066867276 0.35804399854448088 0.6998606928248271 -1.0520144932058064 -1.6294359933588383 0.69024798581900015 1.1419539475879212 -0.32244084728422823;-0.12158797765393591 0.10974956174502773 0.98974100234414186 -0.06734781079683308 0.051262912013779402 0.77322320449602511 -1.2830825742584784 -0.52989688984258865 -1.5492048448860867 0.3151516767649537 -0.096120764284189072 0.67201054101372226 -0.54297773515416448 -0.3453895396844579 1.0786978733098143;0.24293979341896571 1.512717020728148 0.45900482118841768 -0.50889401121535871 -0.95319424545195808 -0.19797383026612728 0.15007118597649027 -1.019971360656776 -0.18841106877615493 -0.83203867726862768 -0.64254851451197337 0.80089490416263676 -0.68201141137563592 -0.70090312222016027 -0.34281736038001054;0.55077285593054448 0.386427585507365 -0.3148459451365645 0.62922266148959693 -0.059370608355447434 0.21023648721941354 -0.099103128073537633 -0.020896368697275715 -0.9451036446168487 0.59908583450632202 -0.77141211964652667 -0.13472583649287737 -0.79677717394679559 0.41994748748534538 0.43891761116515271];
  
  % Layer 3
  b3 = -0.78375461950728742;
  LW3_2 = [1.5616102310866946 -1.6534456334053678 0.84978988606303585 0.67233204951263748 -1.1598044846275355 -1.0534158084753678 -0.53837120910574243 1.6824929575569332 1.1281555858850363 -1.340541592686429 -0.67591701204015053 -0.902565611130694 -0.99664506873099512 -0.73682446966754633 1.0513805163518668];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 11.7647058823529;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
