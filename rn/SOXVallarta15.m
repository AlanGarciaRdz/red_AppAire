function [Y,Xf,Af] = SOXVallarta15(X,~,~)
%SOXVALLARTA15 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:30:06.
% 
% [Y] = SOXVallarta15(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;10.4712041884817;0.00782778864970646;0.0208333333333333;24.390243902439;0.02710027100271;0.00630517023959647;90.9090909090909];
x1_step1_ymin = -1;

% Layer 1
b1 = [-3.587893365317516;-2.7391291800442752;4.4714208491958134;-3.3595883360868579;-0.62191498073612239;-1.4977771804769981;-0.33985351447233098;1.5307461316379221;-0.41983011509720169;0.20984443401910552];
IW1_1 = [6.9413239225616845 0.66406846007795051 1.1295304821778995 0.1221627182630729 -0.70744523595014841 -0.92703733203639049 1.0782947398719223 -1.4310527251970271 0.055781944814598 0.57462801852507006;2.5368476709673708 -0.69286675335992853 -2.3130717853623741 1.8847807880671075 0.20415290480638629 1.411538473234544 0.64290758118710234 -1.7235220833725728 0.42419514462449748 1.887065190853713;1.5564356675236444 0.0016668519914848131 0.0016674442653862257 0.21586811212003462 -0.13760159621763016 0.0084364158637731338 2.9822048519654132 -0.28556923172346843 -0.024127309548864086 0.3385966793733543;2.088511224709948 3.0721964940959658 2.6138875269078992 -1.4391197333198318 -2.3184404415908739 -0.26212239828617068 1.4845960973270551 1.6737710006057216 0.95675595037857031 1.9112780140679375;-3.5094104962674861 -0.049080998885519742 -5.5242837492001389 0.51752132945183948 1.2291572379164422 1.5092213781309174 -0.32256442279850028 4.4132895945235022 -0.76290193441926202 1.6787654634192319;8.8163434496775768 0.03235937065301997 -0.63712905723867186 1.0573796548639356 -1.6415173096708551 -0.91446187173074789 0.78046564221885928 -3.4504951006658233 -0.25602205904311831 0.90597709113838354;-3.0194102028500405 -0.15351657956396192 -1.1522750308294516 1.2536455413105416 -1.3756694093781228 0.59953702352759819 -0.91451534888486197 -0.74279526746491098 0.9210952036598139 2.2526608634114411;-0.4200050930723781 -0.08467029430369552 0.19569302481383502 0.50541966554735396 1.0774417597098092 1.0055024976958695 1.107751895001911 -1.107327796122628 -0.20449856265184377 -1.4105574317229559;-1.3590725049583361 -0.14788468798962123 -0.15009463255129246 0.25969725800201926 0.41332232581955203 0.13810445110375691 -1.6681175144413327 1.666627453850887 0.1454870606660926 0.31978369732481549;-3.8601574375256078 0.13274855579668696 4.1931716628179361 -1.3652509972933624 0.43996434177885252 -0.71783107619827535 -1.7637033043229366 0.19737952316708401 0.23518382470833976 -0.50203737417792971];

% Layer 2
b2 = [1.1770735649270172;1.938540482543516;-1.4557674670950331;0.97214681649017598;1.1303080840614661;-1.2313549844954381;-1.549297641570301;0.66962288945286919;4.7186131227752925;-0.39879808137239048];
LW2_1 = [-0.29913182155728657 0.18642625012445491 0.89719856692547029 -0.30050157921277854 0.44658140539826563 -0.35239174374977966 0.36918315929884116 -0.37770482626496144 -0.81277052235367186 0.09749871903706539;0.26436286727654662 0.35366009413427585 0.20824782696580041 0.50642064710582324 0.10151054321322277 -0.047354001690840745 0.48412446650315366 -0.48270996071392563 -0.3283433496544747 0.25907048412508865;0.31242338851019247 -0.54211667742273129 0.33542464995943172 0.186489075373371 -0.21987433966222966 0.084041941770795076 -0.80872879269112108 0.8938075924004425 1.2901629782847883 -0.58112594419833119;-0.82139860212471538 -1.4332659817677933 1.0243543238767412 -0.37020017957115808 -0.098758050495640029 0.31008550375331417 -0.28745922011291669 -0.33096241310174807 0.13675492270851786 -1.8004807779414078;-0.88149858355663291 -1.7042172761706997 2.4253698281760192 -0.99514434256553785 1.5582997886139547 0.30949421630368801 -0.49946558175698025 -0.48010889123493561 -2.8254803926448457 0.043356318971206356;0.99586268171004677 0.4785349146625929 1.567890823461267 -0.41710027175567582 0.085085508405337115 -1.137063033575098 -0.26014314664653848 -0.11680494618637141 0.052380944783430999 -0.63510007210110142;-1.5356073655511877 -0.40935831749301788 0.27674553314124473 -0.71194978310752566 -0.51599412971405212 1.4955464015268369 0.17543642379433907 0.4575381250200638 0.25263542241702597 1.269578732916901;0.98177820927725912 1.0777852867531037 -1.6999963404104532 0.62248586996180388 0.0085367279718660746 -1.0777067357495576 0.55872369759253704 -0.048459229665227033 -0.75770394913005434 1.589001797204564;5.1591896382454889 -2.599947089836633 3.5399150822105923 -3.1191928513603426 6.2113494087433487 6.0382067002677955 2.7227100094289449 2.9613979522625078 0.50867513204035342 6.628429307931623;0.065537756997151878 0.9912087339463227 -0.2931642345501716 -1.4483141015117218 -0.43206188397654566 -0.52167493063340153 -0.16366860164658786 -0.13356695750662367 -0.99367670993802648 0.12055807388910456];

% Layer 3
b3 = 1.5616857750413542;
LW3_2 = [1.7255761541101415 0.38862127923044143 0.29558024541563133 -1.2239635412552237 -1.7573181882552049 -0.44256476240585385 -0.26073463887472964 -0.22836729183131138 -1.5739036759364096 0.13623478869301539];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
