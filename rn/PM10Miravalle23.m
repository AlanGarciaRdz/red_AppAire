function [Y,Xf,Af] = PM10Miravalle23(X,~,~)
%PM10MIRAVALLE23 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:20.
% 
% [Y] = PM10Miravalle23(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.9223355452537778;-6.236244437062612;2.988431733864966;2.8989171745726847;-3.5310365724707835;-0.47214397108522682;0.63401609056774633;-6.4132403185118134;-0.21438070281911986;-0.21599355103270929;-2.6800280385666828;1.5970672921388684;0.9658592702260147;-4.2336307086350367];
IW1_1 = [0.86184581113837544 -3.1341005476227415 0.54582809570673374 1.0403741225840011 1.4602807127136401 -0.91566094841020129;2.1062863967238088 -0.85679692109103223 -0.2111978974460906 -1.5460204687348584 -2.1182629146483682 -3.5593732590682388;-3.8923655266424504 -0.19067502033580139 -1.4876938778662441 -5.0842382221825329 -9.5072130682535327 0.75365102140541285;-2.3107859426591757 0.37330091558231798 -0.65666365294938644 -0.5833653349681166 -1.8938921317035873 0.60610062041405399;1.4310196113081688 -2.0598167277747041 2.1445429448315365 -1.1171999988505041 -2.4620650233519337 -1.998243354628352;6.1108954549925798 0.55904306358189182 5.3058306016521124 -4.3374550918408898 -2.3412716458850991 0.78124838132149421;2.5588258140342424 -0.084170254025503599 -0.079055147953348393 0.32363352262566841 -0.48054984648211618 -0.085584488951082976;-0.64880101197720763 0.37310478832069288 -5.4593945572371005 -0.60755333715369653 0.96758981836280855 0.69826956931025563;0.61641818218455591 0.11799405629313428 -0.66653362125059812 -0.10486247256020981 -0.94806443153375775 0.76730003574092409;-0.95057799791959308 -0.086115719358549836 -0.27261124007629328 0.47387815533340194 -0.55617118207324379 -0.082121366654544392;-2.5865155229330288 0.43094988265834872 -0.05856707023393886 0.043893058659164028 0.9055051829097045 0.49142516097084393;0.93142781114353268 3.7916416209031221 0.71098627284419857 -0.12321086168669412 -1.5969795151925252 -0.95748371489908513;0.13186704204613334 -1.6420052703595216 0.24022943290677146 -0.72354467912005249 -1.3460475470528059 0.28535687903556645;-2.9273690339239127 2.5696867065269116 0.49548963457958112 0.26140463728991153 -0.74689731877449894 -4.3572279978890363];

% Layer 2
b2 = [1.2082346831746946;-0.96212686711450246;-1.2940475570019734;-0.33419573288868953;3.1754161747866054;1.87820181659541;2.0474491970602631;0.26068111324110971;0.85106022900769307;0.59940798457537969;-4.5835025135747909;0.91585607028538663;-1.5122086627027849;-5.5905350142305688];
LW2_1 = [-4.1045773117172155 0.54508459054543679 -0.29747739018240243 -3.9694377535454808 0.043589536024606121 1.5150593864615736 -2.3301484504942733 -1.5684209667730431 2.4226283650627489 -2.6598734176193446 3.5402423193964991 -0.73203002591239741 -0.40761331045935628 2.1784341031919814;2.4978525623750372 1.5616209020254341 1.0294665606037425 2.3570061907775646 4.857842045296235 0.0095223480922481119 0.99904197639677672 0.2393154071476733 0.81689367860109641 -4.2241576802810572 0.29402037001672671 1.9484445573699798 -3.5142075972759499 0.40574692785586236;0.48658330261220323 -0.42914008150688254 -0.5202312695191591 0.30503331316490323 -0.33837985887109701 1.310028985914905 -2.0756906959025998 -0.14419862844187922 1.4455727256943027 -0.98440488095956136 1.466509158482479 0.50113919652801897 1.2723008295085012 -1.5878407823417913;1.3365152189198952 -2.1508531350374787 -1.0934206313343728 2.4406479775452903 0.72209523246691054 -0.39754575297309969 -0.27819876578901087 -0.33285058803326067 0.66745701911158817 -0.34790970184950643 -1.4346598901613958 -0.20317146957056062 1.1892287720907233 3.5184243379227631;0.50472783058638993 1.8701553611124255 -0.0037331244129986552 0.45920315957351748 0.11371759437830044 0.24534065773748753 -0.39158480193783163 -0.33735849445483324 0.25832647507148282 -0.47925464320721256 0.52670843126800726 -0.0063064665415188161 -0.57890648918104848 0.15286437692408947;0.49690161814491435 -0.50228772855067505 0.36430170395501399 -1.8523824213190059 -0.83500538932992263 -0.22790712479802494 0.99871018145905643 0.039860264210976187 0.17260643404926082 -1.0638788424862065 1.0879011598044219 0.69193586122226403 0.23155018678910161 -0.26399569726557426;0.49371699291996574 1.3263482767681176 0.0039377377304288799 2.6339248654853598 -1.1790471783727723 0.84153360445766179 -0.66012734021561714 -0.0050125087667854708 0.51249560480351375 -1.2338497562848041 2.8750630833775719 -0.16114226871082421 1.4881328309807731 -0.92155478197839735;0.69590937995498403 -0.18888129486431807 -0.063267077117499834 -3.6087659722569883 -2.6677723755805536 1.0542099517771708 -0.88103009282090561 -0.9501487052713451 0.68884391087791275 -1.9782195212036497 -1.9626681649609621 0.74340143784197588 0.1433136945438922 -0.18709486542020337;-0.69820470615100627 -0.18921998938132312 -0.032423246157576337 -0.30951680427766382 -0.74475814676309138 0.40741936510852284 0.91840727209075235 0.2105350187329888 -0.85029208067991424 0.61859605735085876 0.099138523407709012 0.08947245927674885 0.43481478669382351 -0.24226072405927576;0.04842423001803059 0.46199950758676622 -0.52334683633644885 0.50573142916061364 0.31564715783449232 -0.29661593698948735 -0.6178207285241778 -0.16699546121008685 0.41376975321602694 0.38844281688621157 0.22620265269399795 0.82144907068407924 0.020504442859349527 0.23655279716787586;-0.6870312426112255 -0.52518717829655259 1.0187793396907161 0.20141938427057182 0.70709092036320531 -0.60571587476300348 -0.47491444592981286 -0.12364248753279398 -0.1427496846539183 -0.59126102032537509 0.48345154841611959 -0.068420611679631316 -0.92066452537831578 -3.5751811464602641;0.40297821914869847 1.0025185233518947 -0.013567712087356416 -2.5701179685472595 -2.4434887030143777 -1.0648033388776259 1.4783050055126652 -1.0265326088418991 -0.69943695524163152 0.27952116774052482 3.7180034390896721 0.84131076894143075 1.8455427752476579 0.45318157119737329;-0.54613782007136125 -0.47520947173136052 0.08064378970596485 -0.19825387164456967 -0.5035617914100442 0.47630592455631304 0.13867708805075898 0.17981880913816084 -0.27372480936526894 0.060776078530742343 -0.68694197631585951 -0.33756246690397618 0.53994683985967684 -0.37084887065163968;0.12442116843509458 1.0812626769610474 2.6961300085657069 0.42071604360799797 -1.8999953470864746 4.417502476415982 -1.7755455440396424 -1.5480313967639161 -3.1833639024581073 -2.14636692008777 3.7622098382826197 0.84833409021175299 -1.0108177160983838 -4.5330173209976588];

% Layer 3
b3 = 0.24927970519102288;
LW3_2 = [-0.18129230783873965 0.27677939626692805 -0.28385111838789251 0.26180642852500263 0.83289103481957716 0.39246906555249306 -0.22532263044165124 -0.21843242684696038 -1.6193823419000304 0.48014099206664251 0.28020636449802178 0.19738786366833708 1.1429427169563964 0.081347761202615165];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
