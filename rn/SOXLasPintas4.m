function [Y,Xf,Af] = SOXLasPintas4(X,~,~)
%SOXLASPINTAS4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:44.
% 
% [Y] = SOXLasPintas4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 13xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;4.5045045045045;14.7058823529412;0.0179856115107914;95.2380952380952;0.0558659217877095;0.00576368876080692;0.212765957446809;166.666666666667;45.4545454545455;29.8507462686567;24.390243902439];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.3731442493085488;-2.4326448787502333;-1.7977696551615168;1.7285881768195195;-0.68222118252334107;-0.72699660151169598;-0.28866986104956244;-0.39179862163334594;1.9857087574714944;1.758109240245215];
IW1_1 = [-0.73205338465348069 0.094591181355636211 -0.17135080508093883 -1.473577637423197 0.84913828764130184 -2.9032628079494089 0.21531544683873016 -0.038399232789173288 -1.5512884867320751 -0.45572655786933619 3.3958669967811752 0.31884767221028609 0.95603572884492116;-0.52608894205091383 -0.010386555579233195 0.21902771098068854 1.1848688991183609 0.41736036145438959 -0.97976502153337941 -0.54592619649586027 0.19154111162682189 -0.70473321228266672 0.58941766657052763 0.55457335812986308 0.25756879150072426 -2.655845374884183;1.9669572458465241 0.01526440529608776 -1.3665618985721637 0.48621882252500459 -0.76807617973053188 1.6716378251153539 -3.1753262964904199 0.62607740964475522 -0.081777657131657314 0.43183122718140682 0.18199481300981771 -0.87354710362935617 -1.0725474893581946;-1.8081924034737233 -0.22262328357365904 1.3412458542789629 -0.26216498116899756 0.6026729165190049 -1.817745245692391 1.1585445605765881 0.68194363550871073 0.013274601968333612 -0.40558330850941066 0.89350095591951684 0.44331859605687812 1.7625425668589267;-1.8996999215075505 0.21779892056981676 -0.06334696446366278 1.3418024774213775 1.0010368999722046 -0.26014079290908565 -0.388646123951506 -0.066637534131290782 -0.45754838456525465 0.77409826670972337 -0.34575196301055322 -1.0432776558778991 0.56553767780851916;-0.31369457145012747 1.6841735178983988 -0.43202254050915473 -2.1395875036864593 0.62295167042127297 0.85682030006998999 0.65943951841519 -0.66588440184501552 0.12474916234110506 2.044769519856771 1.4991424181670563 0.26380867107109196 -2.1593554673545725;-1.0537842003114137 0.33796845271496817 -3.3676902069702646 1.4460400837299152 1.5641045992940796 1.5053869988978363 1.2735864509346433 -0.57045402332048711 -1.1969434327605466 0.64083343414348637 1.2289676983035258 -1.6016583276374801 3.6725546447319033;-2.561913246869993 0.078255827111516352 -0.020702954285339682 -0.88523862956407828 0.12912289790235124 2.1479826372646671 1.5693446153040473 0.42156173259456137 1.7376157495757316 -1.9508113722760292 1.0660781074012791 -1.5488246502817946 1.0326304030598989;1.3459653299013099 -0.05008641982647543 -0.41836526592490247 0.44600755638304534 -0.83775272128869749 -0.031269519828692645 -1.4005999942796767 -0.27123085304625139 -0.33733259431748086 0.2380365132676745 -0.10618763974914844 -0.1870448216261775 -0.23519007532984046;2.7524886636510288 1.7374747299863282 -1.1959590459125478 -1.3322241136194395 0.27071504801854862 0.70398629615001651 -1.4227879738478715 1.2217560739998445 1.2976255834097674 1.4661320089906487 1.5171403543132014 0.13830440656952242 -0.87413577558155697];

% Layer 2
b2 = [5.1550291965587363;0.74772817818019288;1.457316730628258;0.17793185786141982;0.080178979669899869;1.092623277889591;-0.96701839742711926;-0.89401007266959398;1.8731869573426618;-2.0257527404256432];
LW2_1 = [-4.1794465276511925 1.8478976544105707 2.0625166318207464 4.8848387935167832 -1.3683974781036912 3.0184822768522448 -4.4286555099809677 -3.4982746150298571 3.3171682782351222 -3.3114823973190237;-0.63925066498477867 1.1220686059841101 0.4992697330017497 -0.029537692614463651 -0.45781711523813551 -0.068417267338552384 -1.0991815387510517 -0.01056936702358767 1.0269365059455522 0.56942570777095403;-0.39688965467077791 0.2377141315738972 -0.049676004478072439 0.35741411804111334 0.024576869006231919 -0.18846649797930198 0.035506645470211859 -0.92396689399092047 -0.84521610026836913 0.39673878954744207;-0.069633479986088931 1.3392041689045471 -0.19961459651448651 1.3393026481548254 -0.57953324677928097 0.37621585573551697 -0.41051447074033154 0.62945344135513792 -0.85308326751151287 -0.48875298973167147;-0.9236035677594574 -0.35417171134386849 0.076429347610062148 -0.7251728740283403 1.7798158416068202 -0.26066662952402248 -0.29371388902777451 0.44354165516026089 -0.56970179851775771 0.19407320513344323;0.64208055672871467 -0.36619224661527611 -0.21690616829532899 0.35670493872088871 0.73971905514900049 0.46762838144518454 -1.2756968954182644 -0.53891443926606608 1.0504592332086877 -0.65066946848208995;-0.14263256858806034 -0.94980499218484149 -1.551900926624098 -0.74749711516205686 0.37802326838695754 -0.036201687820650391 0.89577966477351634 -0.10160593092622086 0.32248610696274033 -0.12781148962416289;0.16064867314542747 0.27852650331110618 -1.5148482759822077 -1.216448109875518 0.0019571316072281471 -0.089089282537407471 -0.61344393647561812 0.1000349789753423 -0.86786203320199962 0.068218178177248248;0.34474200562647156 -0.4392901834081715 -0.06212026618576455 -1.0323000632090804 0.024181303224574825 -0.095167239590919994 0.20023647202713782 0.033164622005324391 1.0855663953202841 -0.48414996465621929;-0.20030528064558289 0.17084997345103028 0.40156889275560309 1.6503844331155091 0.52827812069845737 -0.068310496937872417 -0.44719511557711022 -0.042905342766650423 0.2952668548785633 -0.10468098212962643];

% Layer 3
b3 = 0.62816200821406387;
LW3_2 = [-3.7085409132350828 -0.17050929385298966 0.10467939028338409 0.11085425869889483 0.12545573355811088 0.89549757574826161 -0.20430784598372476 0.23147417676173276 1.3331084590829712 -0.21161694230996478];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
