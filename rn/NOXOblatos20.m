function [Y,Xf,Af] = NOXOblatos20(X,~,~)
%NOXOBLATOS20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:34.
% 
% [Y] = NOXOblatos20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;-10;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.100381449508131;4.05679513184584;0.195790504160548;0.00618238021638331;117.647058823529;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [-4.4853266062360841;2.1030720730273433;1.7229599567689675;3.8072543530315479;2.1313078040048699;1.1988566269301766;-0.54715104753640009;-0.2434171998928438;-3.001044796581259;1.082277658090705;-1.0986538143332394;2.835687124459128];
IW1_1 = [3.6429112317171328 -2.2857591855343897 0.51915379573958709 -1.3052220836047645 -0.056417309503088819 0.015683719401506938 0.69387715786832538 -1.1794650459389575;-1.5682243663527879 -1.5231286576059395 1.2089162932286321 -0.11871419589794353 -0.88874004717013722 -0.8564278955371426 0.57388848806098258 1.1177390739783082;0.48171169136850023 0.090059925849267947 1.0775398906559068 1.7510095465822495 -1.4945506038594287 1.1756945263998835 0.79625512611289329 -1.0106346903021102;-4.1718153758763652 0.25466783906606488 -1.1479020656238657 0.2825474706020803 -0.55289353303600586 0.18649088863391067 -0.16165020777942021 0.45528107956559638;0.21159364859730972 2.2710439012904438 0.2287431870928697 0.42894926051554594 -1.7345570215915063 0.061068509133773943 -0.089298835015322417 0.010149243920157196;0.27678382626205589 2.6996696750380247 0.78360907664581647 0.43213068830119639 -0.15320255346415157 -0.31814201899900529 0.10914304519935474 0.18934354038898174;-1.897331826671226 1.0533639009702198 -0.23788590923636704 0.67573724351045072 -0.48859264454676388 0.50684511090456541 -0.58456142825646495 -0.54184954755562853;-0.46333740327344147 2.1516741991090425 1.8887844026221883 1.5493995570274941 -1.6633127302723718 -2.1382267434950259 0.87386271319381414 0.022144851586875507;8.1212788330646166 0.10484583134493411 0.33017339220954695 0.16188788931903908 -1.4581205744101566 0.04101831247669209 0.44653346299699387 1.0884192855441592;2.2510246184363525 -1.6156483478739194 -0.41636567190296253 3.074334197567659 3.6410928644806573 -0.014554129186579331 1.0244489010010382 0.60646998672752284;0.3597097248399368 -1.2091485070418195 0.35728253655794628 0.56245589900875115 -0.3377639372262502 -0.24554108659041848 -1.1273793026840446 1.6300782097211317;1.4349899169595455 -1.5403814244639615 0.23083615441903513 0.061245104540472703 -1.3986474014825578 -0.4365826381487849 0.69131867572413463 0.52245299522770394];

% Layer 2
b2 = [-0.43395710197570153;-1.6911751206773364;1.7998464461162673;0.24036466762609698;0.083936714393610223;-0.35141079429137784;1.1822302458450837;2.3581940787220037;2.0720951309200197;-2.024461426657544;-1.4217908787453803;2.5820415955861757];
LW2_1 = [0.87698569896027545 -0.42217068551732007 1.9091010368516992 1.6382914711890666 0.37444263707563452 -1.6130804593229295 1.8930933376043515 -1.8484942687379371 1.1956874317003769 -0.83797052343604905 1.6373880516121333 1.5230522350636881;0.63593195849392203 -1.1169835637614767 1.1940228564826365 -0.12787936930904145 0.19032423523465788 -0.92219594439039598 0.96039311442931041 0.76376911848146523 -0.246901105316083 -1.4273265572746923 0.058084259266992476 -1.1818884107053598;1.9133066140652926 1.5290680946763 0.84176781182279237 0.080384318059075893 0.69043648043284889 0.57821844354456142 -0.60567794479043879 -1.9473252680440181 -2.5552166613811305 -0.13182241167453632 -0.61258785324110343 -0.87649356713982773;-0.79072627147924368 -0.25429756370516787 -0.6032162509799911 0.3361040307104598 2.5453907057502936 0.73307093770716791 1.6983359654161518 1.3025384231010697 0.10910313604263257 -0.30345914911941269 -0.00021360125039444205 1.803036268426669;-0.1327408624430737 0.96701980958320688 -0.70226630668384338 -0.94418159606842478 -2.1615373750224562 2.9826372439163675 -1.0840821498748279 -0.40855960001945435 -2.1363369553890417 0.9614530928474242 -0.092198940440957639 0.067451105193852723;-0.99524866632481146 -0.38224181172501681 0.92769893294952355 -0.70747894957399304 -0.10971295548081153 2.4328283039653296 0.12867093163635643 -1.2384005864759007 -0.25151526475769592 0.48001636367724548 0.5633582412527588 -0.81198798894248281;-0.92540351964118794 -2.1181981485765742 -0.22574460505556049 0.50997117329178654 0.53430764323244517 1.0151121508790657 0.50389143675905435 -1.5570106795855012 -0.10131701683445024 2.4772211053178039 -1.3078941879249524 -1.9605376032614121;-0.24983347326964828 0.11999955199855461 -0.63075478661532236 -1.9616065471436781 -1.7356894399577292 1.4967827283064803 2.8770791086595793 -1.1914213765682209 -1.4007478254352597 -1.2906394434248543 -1.0969636963646778 3.5988814401726068;1.3402434776364518 -1.5507890439663379 1.1913007165381986 0.073974323245449031 -0.29162522226929899 0.19836257076912495 0.27496576223119151 -0.23822115761728374 -2.3573486147698857 0.25165993148865856 -0.53290542942840879 -1.0772101260017881;-0.61886744806305682 1.0584227204565317 -0.51922750268659346 -1.3401314207760835 -1.7211909336051388 1.2689679681419996 0.42211739490174804 0.015611839387424317 0.020789911289026852 -0.71242010766803143 0.25579275022501669 1.6544264513368052;-0.067270333168575142 0.12936229609399372 0.6007720764701151 -0.37164349661691132 -0.1382304030633428 0.1079378769444123 0.97357061485603358 -0.54919590734941937 0.62425531131937217 -0.38727482174226541 0.39008754462270323 -0.9075926538216107;1.3277273296229417 -0.64973874766067308 -1.5017033612658908 -0.032408241270858021 0.90609881813178383 -0.51711638176390839 -0.45730616504362387 -0.58860797510034846 0.57181731977498773 0.59585343499451848 0.73807790099016279 -0.98127588055360526];

% Layer 3
b3 = 0.9385398903384089;
LW3_2 = [1.1961425008596507 0.91450855747072946 -0.77235090442095378 1.5786187782542447 1.0031899545942251 -1.5659766298781193 1.1106881970701334 -1.4711110307367659 0.72447281047556389 1.5946655955074913 0.09505161279627064 1.3127233074203857];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
