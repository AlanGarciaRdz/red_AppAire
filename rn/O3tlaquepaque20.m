function [Y,Xf,Af] = O3tlaquepaque20(X,~,~)
%O3TLAQUEPAQUE20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:53.
% 
% [Y] = O3tlaquepaque20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 13xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.171659085057077;3.03490136570561;14.7058823529412;15.3846153846154;10.752688172043;10.4712041884817;0.0212539851222104;29.8507462686567;0.0523560209424084;0.00624804748516089;14.7058823529412];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.1972959895091755;1.863592303901028;0.85558331304615887;1.5944360542423439;0.09672758919319957;0.18320293998655066;-1.1479116278863266;0.63808604243416822;-0.049026100857997836;0.98200993221126109;-1.0110661952738238;1.484005665675979;2.0238501238546722;1.305738878430271];
  IW1_1 = [0.54727240302159585 -0.21899845418866487 -0.50962382694620556 -0.94763888828645693 1.0581797431098554 -0.53270382701996355 -0.8524305653972265 0.49201975752810656 0.82467651036090339 2.4384618135518568 0.69206395507270946 -0.29366686243970402 -1.3784850451354516;-0.58631367821527203 6.2383676319152457 0.35985048095853261 -1.2271987340934263 -2.7862674147625368 1.5451270097154577 0.073537940630964083 -0.325193595366565 0.36244478182050444 0.60554239030675305 -0.49452761755937952 0.11016450037891025 1.1392444996231459;-0.43032991486062483 0.388330370600311 -1.5591824189044063 0.68471482854754873 -0.0094671855193659595 -0.082400600823024708 0.038345712790435499 -0.11119368345672317 0.11306142600015809 1.1703073714046339 -0.22359618065034975 -0.075142718996406302 -0.24862063931650522;-0.42297721479327666 0.5387023709337172 -0.012172146191645743 -0.48307667776527441 0.39311502426751849 0.091070570527964759 0.31967247843831653 -0.12754935932683989 0.51514462277043072 1.3957836877963796 1.4062943700966981 -0.028827701920699875 -0.51011651388707802;-1.8803043928298611 0.16545202537010989 -0.094545546615642642 -0.63610343666368074 -1.1556607410033335 0.38990561804706403 0.68076085727300994 -0.6808242890093088 0.25758197960656704 -1.1638430518212441 0.0045660984942011134 -0.0074429138597904305 0.14303724210222346;-0.41421374458990012 -0.1354605053424596 0.7069390945687718 -0.094680264282693841 -0.24940827280950151 -0.28067115594021924 0.10153784014414814 -0.77800086205350716 0.57070467691453075 -0.40974563294488647 -1.2662229746786835 0.21995927352255343 0.66775373632543711;-0.015616184297077472 1.6490198711308859 0.44665211937277183 0.41702129076568378 -0.17971073234149271 0.49383596219197801 0.18592886102889855 1.1478825336730683 0.010768017645454375 -0.34578875910466184 -0.99189458220720028 0.11670093311770408 -1.4564665408662898;0.84253723658847646 0.55586535783454938 -0.5241909795104468 -0.097668741541125606 0.16701383798299604 0.12189843750068657 0.14100524658112801 0.19069193837091181 -0.038275735080052789 1.0031937218390432 1.2453596315478126 -0.038648135797342935 -0.26970209308386273;1.5346843167885635 0.14937551180308214 0.2194712616882149 0.48746203959881501 -0.21883737340402667 0.31756607224441258 0.0025618567037819853 -0.036856610706127071 -0.2589574549903641 -0.22821230643682208 -0.18970635757759985 -0.0070883975720427818 0.14827165333704215;-0.26413325900605511 -0.48604968323790554 -0.43660800094003788 0.96269241430530217 0.19133527684407001 -0.57858697080046251 -0.46547822731543687 0.34078285514500478 -0.46722344050613451 -0.0099349320805110081 -1.6203988839168897 -0.078544937265267678 0.072306084524846714;0.37839998705913702 0.55097495986715839 -0.31182748459961512 -0.70819279838936255 -0.21663654243629044 0.36698680793168009 0.14246833195891459 -0.13620660202919516 0.24012385836887865 0.32472928384376659 0.53504040159858313 -0.054182585474247348 -0.60416177197798249;-1.8229198308935197 0.10909582836267119 -0.46910628053045339 1.1414554099768797 0.22221178917894516 -0.053704577007089326 0.21403565913802716 -0.14307300287436736 0.13021770601997426 0.84214458891907473 0.44302399881964877 0.069056538471459747 0.63326741660099894;1.451157308932798 -0.53712541185379203 0.19830038345582904 -0.034947828908643043 0.11212526286067234 -0.23241099096565568 0.15416769662884075 -0.58168324322113063 0.069600261241730937 -0.24797615984286411 0.27788769754906972 0.081042850870051725 0.90756318005009973;-1.1402701206483903 0.022852519315710779 -0.4546051592498272 0.035072934730970146 -0.075323801323193385 0.25337886866628101 -0.19204507750453323 0.65599893276325627 -0.69066314891647806 -0.82673175017743938 0.23087273289065027 0.0044491275974099598 -0.10916030012054372];
  
  % Layer 2
  b2 = [2.0911335078380517;-1.2561232983538284;0.88668413534270596;0.12419141911851103;1.6781451161470069;-1.8813380090947598;-0.61005206236599052;0.056454486978416561;-0.60727737288789463;-0.87491273169528727;-1.1127105556137431;-2.3810253677905111;1.4062324070534171;-1.5373512092510198];
  LW2_1 = [-0.41402876510367487 0.19234889580191508 0.27795629270884076 -0.30497234008653812 -1.4856957471488415 0.12213497378168092 -0.43021292309622489 -0.49683513919546929 -0.022518307115763053 -0.38707652161510686 0.43597042882482684 0.443109262557768 -0.46940236572861838 0.26170063641695912;0.26125346162946056 -0.087678329980330719 0.63306071587399904 0.03067733677195205 -0.41288235301500054 -0.45185241078112348 0.32244414663247389 0.45120286697404488 1.0596612580003764 -0.80608225512549359 -0.99674895559621246 -0.68007495120192529 -0.35137917369907418 0.29874805504122548;0.040845630310343113 0.26782617194953129 -0.33726396309747236 -0.15843590717793751 0.28727681518337989 -1.0289561347584379 -0.1959752681041903 0.14278774136745179 -0.70374262221847061 -0.68482742140834529 -0.76915486422769952 -0.3016460888392386 0.23162177074485016 1.0951402587723147;-0.80227111062930689 0.77520248982102125 -1.9098107788664029 -0.71590867347454656 -0.47576535023214261 -0.11804431987338868 -0.8092108365968107 -0.030945164549311538 0.089912678226928486 -1.1652215626318985 0.18562546055278947 -0.60662896479186745 -1.432413721387449 0.95337550723479392;-1.4990688233272795 -0.11394583974044632 -0.63411371060626476 -0.87036120462393241 -0.29839757598579109 0.14804925111891459 1.198420423891627 0.76180861473612782 -0.03623455441807133 1.7524791491352434 2.2211445933805125 0.74760288956780363 1.2002252627460341 -0.54877742099384841;0.77716973738278639 -0.095107570497459631 -0.39617040342935184 0.22107649930332349 1.2386611950200503 0.63788850308205958 0.050754286591480631 1.8962445451203287 0.67424648015273181 0.53130527460835741 -1.2743254791426544 -1.5718804660977999 -1.4674460265762346 0.83746487705480321;0.80466228308723242 -0.69442142320638889 -1.0691253695934493 -1.3898122233938441 -0.32721974434345591 0.71912843157228368 0.70861472512156531 -0.0086815781201866477 1.0697119447944392 -1.1228020837669501 -1.1426271413402174 -0.049431929543992677 0.33404191780834769 -0.14275498181659868;0.36986799752670668 -0.66504666424570114 1.1686340056831224 0.7087348388855873 -0.42984893989885531 -0.10436617997329775 0.23236802431080983 -0.88083154783483275 0.38111809011173486 0.12992108055796608 0.22981697674819426 0.32367626880368844 -0.17815115435357037 1.3717370925350711;-1.5122951493013697 -0.30340392688240558 1.6668598811521014 -0.49138459973510995 -0.65317822779468726 -0.84583137587112878 0.24888120257844948 0.97750365818624119 -1.1216703993459258 0.47395958937989774 0.23674743332340478 1.5340672166878184 0.63278646297290497 0.82013168518025226;-0.21396238487675329 -1.0922226255279841 1.1434522352242187 0.3324597543109038 0.57434839121656889 -0.68283866375150604 0.17145814477806903 -1.0605155835969082 0.18046860287289446 -0.031936108983761965 0.13024212900847559 0.1479519619887382 0.46628014610366997 0.25287340960728205;-0.76762965334632194 -0.22142357273183533 -0.70836311446992228 -0.27715169616210106 -0.63643989020341318 -0.83657285248238278 0.16535077123244873 -1.0571694983480509 0.82240459122176612 0.52786401193791754 -0.84845546890438661 0.30986743807390726 0.11222861317562643 -0.95813488108786515;-0.37516734956491438 -0.035948276538937625 -0.11608452804330996 -0.081373929715858509 1.4555852847130453 -0.41649495602823228 0.17321489268513415 0.29798391556211545 -0.54227880667106509 0.15011540707333124 -0.44154946817927326 -0.24138707801208978 0.78882527537288039 -0.38498832081898265;-0.42796201149263396 0.51607989870932347 -0.039344253435088045 0.15351161885467179 0.43734004510121183 0.24389671212874228 -0.82339165779189805 -0.70072134374423001 -0.89882864855935218 0.5413124306248519 0.262227077138591 0.30636426713578774 -0.7678674265338864 0.013520863254835272;-0.5559882968828167 -1.3309155290998671 0.23648185323818877 -1.2553787582227141 -1.0639707087299033 -0.94365427714141747 0.50568002367628628 -0.7617368920851969 -0.74641060214894617 0.56809844176127178 -1.3259432199623526 -0.32245947793634289 -0.87264239343020611 0.20352882890839274];
  
  % Layer 3
  b3 = 1.0468841319731415;
  LW3_2 = [2.2263974093554939 0.96484132306891535 -0.78313992905926844 0.42735586290610988 -1.9290778464184983 1.1403470303975138 -1.1983732225122035 1.9405570810474357 -0.83499324704700018 -0.75297122089109136 1.2319378424618306 1.500017625893366 1.1187968975197771 -0.23433398038089315];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 14.7058823529412;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
