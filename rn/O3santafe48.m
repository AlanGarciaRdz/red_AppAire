function [Y,Xf,Af] = O3santafe48(X,~,~)
%O3SANTAFE48 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:51.
% 
% [Y] = O3santafe48(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.172786177105832;4.16666666666667;10.752688172043];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.412691888658077;-1.8866371995737323;-3.5115019217313463;1.8677529797660612;-0.50908638887611479;2.1678073863062526;-1.9470936820269116;-0.3344797738747633;-1.0604387531934027;0.25006587932394259;-1.7048426939859338;0.70055642576558319;-1.305528668055288;-1.3269266020949313;3.0527438607653847];
  IW1_1 = [2.0002828211156656 3.7822067677392459 -1.3834825071817705 -1.4169312800368434 1.3408854629688971;0.42835432728606665 1.7072619765719614 2.0716968006444887 -1.0316493866975542 -0.30723936272443875;1.9982937749769558 0.080603121346376719 -1.3032336804313336 -2.3115511180949713 3.0508733199778195;-1.2554666177024276 -0.31474142561836244 -1.2133307305396361 1.5189926412660419 1.4419100848898607;2.4013266827184934 0.48871493987502668 0.35520821690477145 0.10918580979934212 -0.82204510054326063;0.37293355700774461 3.0204989154272797 2.118180832742159 0.33950494063249748 -3.7141771595130995;-0.50859867939467918 2.2883544980135229 -2.9231225812223105 -0.78021093848482059 -0.21368834348113133;0.88247712492447294 -2.4525045102890415 1.5778428704702177 -0.33878215223078118 -0.65716000606910796;-0.68335987220834227 -0.6834303892350837 0.013554803197337718 1.3336101181160513 -3.0363011952513381;-2.7471474236671876 -4.2750484169993728 2.1198859392930012 -2.9610185719662545 0.89046867420224551;-2.4560999854488572 -2.3180558660804347 0.27225769595833516 -0.83739006637918645 -0.49820680030538034;1.6993932584987033 0.55354762966901649 -1.9525112835268656 -0.55244227456853889 1.6817193496556764;0.010257069218636408 1.9664674582980135 0.74007658274985022 -1.1568580971469877 6.4593211984359629;0.037813215664705566 -7.6600542607379118 5.450364008551789 0.50377730763316353 -0.85597664692003117;1.1645329364600134 -0.99832287670127118 1.2625415038528527 0.12874762230409997 1.2564003933920369];
  
  % Layer 2
  b2 = [-3.0480808204308647;-1.8803317983482803;2.5437415033271358;-0.27651012440764577;-0.24918803019575175;-0.67452470607519099;-0.4849041590026405;-0.36632599680393191;0.96068560566771655;-0.84647128020552553;1.1735507225195971;-0.98537866462732826;-1.6564490585019853;0.77319396110797411;1.4220065515493787];
  LW2_1 = [0.60639408720484567 -0.022415174813525358 -0.33731662899708154 -0.49572026074356035 0.34870497157779895 2.3421443752608191 2.9090161007121793 0.23958058596098936 -0.1220042344805783 0.69353291428076314 0.43173689022837919 0.47932336704119305 1.2428792674951081 2.1226201194117449 0.33713086058981145;0.36893573641707428 0.73169038476653969 0.52243464020291797 0.19131909190510193 1.5323907041297631 -1.4747132773448619 0.73812588904270338 2.2971387440826732 0.32581159389069236 -0.30150932513464007 0.33739724156202133 0.20081767758170771 -1.861937076533682 -0.42198427679486111 0.34666467655859723;-0.76622559326261219 -0.00042807099587088837 -0.055985619415477833 0.4073899331655419 0.7606641824346051 -0.68202226321110204 -0.62187383237108684 1.4025475621599948 -0.19592596803781326 -0.55060689474963032 -1.0885153607771079 0.69083915063439294 -0.57585049724820669 -0.17570306840758115 -2.0661813484505336;0.87636727346270749 0.25967355375792295 -0.10987402932512907 0.24835964837228333 0.64472402415426444 -1.0547497461250597 1.8881232302011863 0.48339940844939888 0.04127522561020127 0.46903793347119815 0.0015106770008869912 -0.043201867527059977 0.85824593182428244 0.23737369928007801 -0.048576584221043856;-0.55655865287845263 -0.58951003436635452 -0.29144215564402326 -1.1885216817577862 1.0727263411551786 -1.583574924831002 0.57313366732762416 -1.3332298777232559 1.559671198732381 -0.82650872650339746 1.4869577981027085 -0.0017021203582503093 1.3317881197773784 0.12148301600094839 -1.0527761006670668;0.63075425767441951 0.43692036953263225 1.1075382003383836 -0.38110150625377265 1.2590402067112036 -1.8899285624572706 -1.0635823219092393 1.3156786306865551 0.93233702023861631 0.79360879403493867 -0.82530431286974937 -0.52956599468467691 0.55004604232902421 -0.23879182930937065 0.17302302346910448;-2.5943584786992071 1.0512290261092359 0.87330362752869239 0.18406990875635185 1.1098886037993505 -0.42077054906347405 1.8512462510404868 1.4721046586915358 -0.4207204221214807 0.49905522191136081 0.32514955442989485 -0.01280370815771213 0.37673150348017609 0.97010819773409229 -1.1776031342287279;1.3227264438459154 -0.025720729440062533 1.0102227600766505 -0.43993114599594935 -1.72103401576022 -0.25438983296409523 1.043867347258153 -0.92157564296716299 0.68766028268127632 0.10683934616439404 1.0581372850553867 -0.28594436721000027 0.48494049044462134 0.9083287067636483 1.9484939832733625;0.33531304336062639 0.6405373862200997 -0.215489997229734 0.38899549995634486 1.3321139805264057 -0.34718530295387195 2.1855324768973743 1.037683097993563 -0.66308790147240071 0.33305147195128548 0.27932308531167049 -7.9851815519688812e-05 0.24147668947304746 1.2668449217823252 -0.83091096665014219;-0.67022210021805417 1.3049728430304868 -0.62480809029075779 -0.72495709293078991 -0.37144826860441366 2.4524017163551024 0.62531928399267778 1.9307229980604921 -1.1132559501831558 0.43609998276310574 1.1371020349325642 -1.3065377683757613 0.51723333027198548 0.5391967996509921 1.3385451649350228;-0.24335902870388679 0.038985537284387736 -0.61271017587817544 -0.75708762149340103 0.61879842803893503 -2.1109723443337467 0.080269158356135059 1.7676105900607146 -0.51237898719314967 1.3342895669083494 -0.38669271617828116 0.070635921559412715 -1.2411750565905919 0.15004649292360928 -1.0025250185356973;0.077432518536896866 0.26970932102887679 1.3261524459668761 -0.72191643820502671 -1.4605489702084533 -0.0040696591288469051 0.41697569421661423 0.61008101522255676 -0.039255566528866595 1.4547016783000415 -0.87025984986963556 -0.70344485056766481 -0.31424188335412034 -0.35875247128370602 0.19110729516749386;-0.21729811419573042 0.31245765299285294 0.35165583825638769 -0.042750651015522931 0.94035647259780941 0.92129470365289134 2.5187406739951119 0.71524870764298321 -1.094436936846849 -0.14657977703967093 0.42161979227546947 -0.11583858127721613 1.023827548033359 -0.82922992857287314 -0.49389301886060816;0.48589967922589611 0.19306635338084185 -0.60098807937741516 -0.21043823638607323 -0.12444430929573852 0.53136604247837738 -0.92505793286920035 0.31397303166899371 0.7585101193698045 -0.061916371193745892 -1.962440151200836 0.21478970835681377 -0.22124383198253872 -1.224183721106048 0.2944046829038871;0.075624251294555439 0.64848373960447259 -1.0544823249619872 0.21670764575694632 1.1911015178622331 0.46220258606809639 -0.73454881251502457 0.057675977151462207 -0.21727073195920268 0.31298964989057887 -0.99449715430916807 0.11189384927176448 0.3667256151252915 -0.89879656564402777 -0.021942637848317858];
  
  % Layer 3
  b3 = 0.12316638101632735;
  LW3_2 = [-1.1003868188931607 -0.24201662024350118 -1.080001205128621 1.9244172738621037 -0.39340386303398445 -0.27702506492343337 1.2999980355147238 -1.0326177032575461 -1.1646954848683015 -0.15706495330324763 0.34657270264020051 -0.61836946609982935 0.79313458836297046 0.65007212869776421 -1.2583689243446661];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.752688172043;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
