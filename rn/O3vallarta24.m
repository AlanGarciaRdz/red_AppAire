function [Y,Xf,Af] = O3vallarta24(X,~,~)
%O3VALLARTA24 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:55.
% 
% [Y] = O3vallarta24(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.12820512820513;24.390243902439;0.02710027100271;0.141843971631206;10.4712041884817];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.7469725626582562;1.4459506846754333;-0.65353239338676938;0.94073159402964179;0.84181199022720243;-0.70346244167804362;-0.40519119140049831;0.058330948034118993;-0.092857689879578237;0.53433375480094103;-0.60416581829411031;1.0926204907437245;1.1928043265042136;1.9233234439201288;-2.1458767503403813];
  IW1_1 = [0.7777395261684974 0.88842252265721633 0.13933804182038034 0.012489916826268014 -0.21125341638973172 -1.330002578472836 1.2757839024954027;-1.3261962780515566 0.57992043017322126 -0.20285657165438206 0.90873999285667906 1.1365742429740315 1.3107461111040408 -1.3866361567294736;1.1999070945947294 -0.20979651692204765 0.64522297948028373 -0.40509496523457555 0.54536004371868962 -0.10633130275346198 -1.6267105534230026;-0.93212858491531281 1.527554960662286 1.054109772844025 -0.70983899367625214 -2.0937362808944897 0.51558937302079288 0.32642369002605592;-1.5004627126254666 1.4303253712813211 -0.46533893876684224 0.51898455587850667 -0.47357128645918289 1.4579030248973017 -0.20298725183330874;0.43810046727134577 0.83138856815325357 0.019009027721515255 1.3645883728042283 -0.8643204816022948 0.76353026817998271 -0.10907437763025864;0.2324487462510072 1.5079256787438613 0.098588559614945767 -1.1567425204829251 0.85647760044556354 -0.94317663672583907 -1.2059760229520107;0.075413915131211762 -0.5359416561227619 0.091787839304384763 -1.418890546861161 -0.51321766682848946 -1.2010164616840269 -0.67718883120971529;0.059475888531906787 -0.14063062557544587 1.053482435083382 0.2308775001201358 0.71366030677107217 -1.6750647705943025 -1.1294273475797318;0.27669849248467349 -0.97944303649190212 0.91681412542428709 -0.3329240689969451 1.0033094502565452 -2.0605015307123886 1.7394940943241384;-3.1866520076691662 0.35825948874723901 0.0007990940267012755 -0.53889664535534432 0.0014141660236395986 -0.06863284211352956 -0.50918305401444819;-0.23781870604979699 -1.4690303083071361 0.52839802606698127 -0.81204491801685563 0.55689324819599617 -0.43846322384791758 0.8668567388815156;1.0943631333022499 -1.0915436453902916 -0.81751128848783028 -0.073808820774242723 -0.19282979479464635 -1.1770015381177379 -0.12181907546110353;-0.083231152781228029 -0.75337452602941601 -0.4481088458758215 0.5852624848686595 -1.9562191161988427 0.49842627772562187 1.0826716466653132;-0.27191371213833693 -2.8570432397563064 -0.47073192716353979 0.67541520447788495 0.62995899475127115 -0.70860121786590236 -1.4431861713802403];
  
  % Layer 2
  b2 = [1.6848596645277998;1.4710147519652528;-1.0874547684261877;-1.045106630058986;0.97038777983204305;-0.48855639276461688;-0.21824191623927805;-0.0014725933756412389;0.43545003447069669;-0.60046255896900724;-0.80366545875984885;-0.95099465512003689;-1.3917055979688981;-1.898399082690962;-1.789864988938646];
  LW2_1 = [-0.65422510311635718 -0.15004320630595658 -0.23563407434878211 -0.10419056156292157 -0.37376442526082981 -0.57995095963659971 0.79194340280903153 -0.08620260979728378 0.58702713574865273 0.54311173814968505 -0.55873505537182211 -0.60238429397971005 0.036807580722974277 0.4173439830045565 0.22106074249912536;-0.41798789909907491 0.45797975338882013 0.27775024211583943 -0.10616287773347313 0.0047869415908814369 -0.81172330748966737 0.027155382493904742 0.35133329840772692 0.58545760981875294 0.59595930456579316 -0.56713250075879951 -0.15791309633230724 0.7111586514453182 -0.0064646414617383369 -0.27519189469766281;0.44054379366239144 0.054327252927323412 -0.024961829746546458 -0.33598393135362381 0.54396686830354268 -0.15237084078276814 -0.46877653958062798 -0.51537441399332118 -0.17814598872866491 -0.60863371058234905 -0.51884669131567074 -0.64135018894062346 -0.37076137094275258 0.69864108193294916 0.61832340298668842;0.67633646025401606 0.8546104751088397 0.79500024396560864 -0.77563607318281591 0.32307728716992729 0.48966353118621597 0.30777052679677741 0.10080575930235028 -0.63973064558888937 0.094604439843954891 -0.16180116945604464 0.58388046343717359 -0.65465658278891803 0.031804230662079727 -0.60077538384935647;0.069336860090262908 -0.81290422086372305 0.16523276133358938 0.3186820564135181 -0.094772498943707775 -0.81766449329029889 0.0041963340483251663 -0.39463962650844248 0.24412261210966402 0.071096929219333749 0.56547549149842347 -0.74257404995858201 -0.56172196763749438 0.87974434370096466 -0.18772933208986128;0.06583139154125088 -0.087785834323472742 -0.21539769050277449 -0.067631734797398382 -0.72435056216060523 0.63115738712274794 -0.66476357400262776 -0.77415945561415089 0.48003611361240656 0.12490270846385379 0.20871051717613148 -0.37927219461042483 0.23876212369069305 -0.061758624508592264 -0.034537820777912967;0.29492243679953878 0.81849022138571492 -1.103933507282874 -1.0561363887842903 0.30150008109895571 0.53030544592867446 0.10912466353021974 -0.43309874309481527 1.0256910062023157 -0.63060309636831913 -0.88163284602970582 0.71546896396716453 -0.23276502114922473 0.26997676957219846 0.36668653585427907;-0.2992014539646583 0.96775397468300139 -1.1862904874238034 -0.078574129194594125 -0.21486862217791083 -0.047294638572658906 -0.57794277659018856 0.70534890045771848 0.22384769765043144 -0.1965701297617396 0.76382915570052257 1.1339844890331316 0.46745334111372655 0.18060460002755396 -0.81138137192099735;0.63099533115418527 0.17593978616975764 -0.17882095953897631 -0.75426361839196421 0.26146777839909013 0.021261451770744625 -0.07528229743176644 -0.26915881485169951 -0.66666508734742824 -0.47496702734516388 -0.16410787351931924 -1.0398326636711346 0.31890141348076789 0.47692613393514738 0.11556636890337102;-1.0840979158788027 -0.22448805454871201 -0.3350389811438203 -0.077712358034311979 0.88780837477413554 -0.44125344568345914 0.62831736539256666 -0.38375589899890539 0.026796288417838768 -0.19949873001396409 -0.87604444029201689 0.58290842668400467 0.34849248391100002 -0.59144371110064242 -0.58078431580092604;-0.29462879323035829 -0.24194544311519081 -0.083451765886791054 -0.8019948131450827 -0.37442774594128669 0.51950373208141509 -0.86256654958270429 0.3732413081446545 1.259042678041038 0.37530141325346955 0.12361454433235343 0.65904813702637 -0.3613011302041918 0.18716916995258809 1.1285642909711053;-0.49467603101422392 1.047284107634501 0.28814373009168909 1.4912930514999498 -0.91202531336189929 -0.68823720797981713 -0.49208229483290428 0.045476016528515392 0.4992541864086667 0.712673671518813 -0.078581830309668282 1.0164643695643603 -0.070950354532560558 0.2593822697569968 0.62784914448355811;0.08723976877563458 -0.82936279168724858 0.034057086818605996 -1.1135471503183116 -0.24047534008801014 -0.54064216882519389 0.45072219083263454 0.22555066960529474 0.042087940335103644 -0.52933391374500416 0.97591532476069287 -0.35910431056694275 -0.11897116561273029 -0.6604781805388793 -0.85775379524132189;0.1120612806559543 1.0816666671558242 0.49123453153701135 0.17310454138650108 -0.014340066506319367 0.85372855244731161 0.75484602780077759 -0.39659181203260485 1.1674810065510253 -0.47121057946370987 -0.8179321431321106 -0.9181449797869613 -0.68284856409587835 0.31564283932642151 1.7911096317510113;0.054254438026898194 -0.32461263497803888 -0.15360422557658063 0.10113853293599279 -0.69413223801020796 0.39747380879386629 -0.79202053614609336 -0.17360943224400163 0.8935153869429443 0.098622226143510669 0.29309566846617907 0.28747852387657991 -0.71036627106285832 0.49335876030906983 -1.4547055136656157];
  
  % Layer 3
  b3 = -0.48248342118997067;
  LW3_2 = [-0.73882048612580831 -0.49096438191291913 -0.562830313271941 -0.85721232748491616 -1.5953347337287971 0.69731631829462259 -0.39770263478040352 0.24447603281986782 -0.80276041675978771 0.48208188435649912 0.27264222698386553 -0.92746528895025981 -0.90027014633775515 -1.1571080965512075 0.89670504611354163];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.4712041884817;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
