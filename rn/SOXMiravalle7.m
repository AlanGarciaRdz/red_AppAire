function [Y,Xf,Af] = SOXMiravalle7(X,~,~)
%SOXMIRAVALLE7 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:35.
% 
% [Y] = SOXMiravalle7(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.0208986415882968;90.9090909090909;0.056980056980057;0.0063552589768033;166.666666666667;45.4545454545455;117.647058823529;29.8507462686567];
x1_step1_ymin = -1;

% Layer 1
b1 = [-3.3210582202518051;-1.0967646170089256;-1.1568957182344213;-1.0802148849482911;1.1496716092908457;-1.3311176112723797;-0.80869489846809106;-1.1466670905199867;-1.135033052229284;0.90817130984509031;1.378815391397183;1.7882784764966511;1.5000900351044617;1.6326377467657658;2.1712408026613588];
IW1_1 = [1.7836571228393603 -0.40725712014011362 1.168468803392642 -3.0134045475489279 1.9950361067437135 -0.33964544707314359 -0.06767788797001828 -1.5055921572109405 0.59297932526448949 0.75251937509155375;1.4162881243787486 0.47061371498940685 0.3523017344657664 0.23605944392384742 1.5928383832185391 0.36203699018621543 -0.14554734642249095 1.1968199819597696 0.68264826808857249 -0.64349798349089438;0.61290884115803301 -0.30611071986736055 1.410319193629074 1.4417589122527517 1.253145470685485 -0.18166298420104215 -0.44110530137098208 0.85293376978208402 -0.84333783538610851 1.7742180361377859;0.38538515446394966 -0.30025230451685558 -1.8138364434064673 1.4723164763004177 -1.4181695346493171 -0.68999183011259002 0.49121659384675309 0.014769155412138205 -0.30649542565019999 -0.85094967621480333;-0.54486637033127816 -0.068593921886983975 -0.38575316531817427 -0.88406080198411485 -0.20528740957354469 0.017767716621520716 0.43437749850445018 -0.67160250019243284 0.17579307292736213 -0.64140779002875858;1.1287595690154075 -1.5616045197580288 0.53879910302064482 1.8272101560514273 -0.76605105106750648 -0.21196157541177932 -0.69497072143191641 0.53961206701040842 -1.4777324432684411 2.011755247568856;0.72380757454197209 0.23786633672313698 -0.050323029309015027 -1.0071813503540243 0.035276468394102971 0.28524920391379377 -0.38851765441599379 -1.5969402329703353 0.63098546049701942 0.68147944503616309;0.073914163997121307 -0.44956032500399556 -1.1109165990576324 0.62928933723532399 -1.388994934050737 -0.64914619149699504 -0.17243590299279074 -0.3106336979337756 0.30390463464268308 -0.085114645228569513;-4.2816855134653835 0.045812615209825561 0.013097706892138933 -0.90130040921306309 -0.13881155995193367 -0.0039507916623771969 0.5609011216411729 -0.34998675775628968 -0.16890078429222891 0.21142312912946803;0.83706269679949208 0.5427951833294552 0.77381805966698702 -0.18300826694788261 0.62019045119892191 0.58657897974150341 -1.1526659758642084 -0.43783773576884077 0.082408561305827827 1.1878664001813435;1.8268103598924774 0.08764606586493294 0.42370354701657514 0.35233938326460246 0.6603105943830393 0.17626731651083033 -0.41271161783771143 0.019109204494286228 -0.048532766893293479 0.24167236584404833;5.1058853329684624 0.73632397901598834 1.4207412370834953 -0.41459368852829143 2.0632262581418441 3.544806494159261 -0.26576861627872012 -2.0315592500929669 -0.058513672008996584 -2.3432146562233709;3.014928341712062 -0.46638987331145565 1.5704640009396214 -0.3054712048102014 0.99473140330936904 0.54023633540502036 1.1774313463396573 -1.4010519823895282 -0.13693570595353402 -1.3103364228501397;-4.9206468447131062 -0.21391687639855625 1.4967758742477346 -0.84053835439252877 1.5190369319239911 -0.37970521285648878 -0.34367839387328242 -0.2481527859811325 0.34644573792655636 -0.43870272244151998;3.0408891128617035 -1.2630445594288258 1.2182448261303986 0.95819828682004471 0.42813772079071044 0.30041333079834276 -1.3992989142142789 -0.20450104265117222 0.57832668315500202 -1.1775622766037959];

% Layer 2
b2 = [-1.28303114176005;3.6076796981606445;-1.5127097417905122;1.067775616431158;-0.89008870608089852;1.2604223326769148;2.1489081112661399;0.27041488804075431;-0.61221818214013868;0.8207671130718982;1.0968887354261019;-1.6793217994477527;1.1501719898766058;2.0661671893772389;2.316100914342107];
LW2_1 = [-0.47583642346002186 -0.076511581047295663 -0.13539586580422647 -0.46485637656954532 0.072282166666392214 -0.25105569603492423 -0.2451738687832081 -0.18315766983663601 0.85194973455633927 0.13629504506126042 0.47152274208580958 0.3768014004143756 0.081061003757438355 -0.82086219352958567 -1.0084755367460405;0.45317217871934751 -0.64591599416800394 -0.33157631282924865 -0.23855053871632462 1.7227208699807968 0.65714891666929698 -0.49106875835504338 -1.0948455045055707 2.2072583470815399 0.96403028437263294 1.1856254982252845 -3.9126010478181792 -1.3956226287602886 1.7528284198983521 -1.4697811504267544;0.26046726541516535 0.38252736480077953 -0.62853356110597014 0.74650708170167634 -1.3370071353429691 0.11315953618804574 0.49092178711214685 -0.92340681351053389 0.52439153122842452 -0.34607705603398986 0.31147781818103698 0.13781343229859241 -0.3134088145673013 0.51084182751179885 0.773306990024897;0.16852495111812368 0.18676940743323991 -1.6838636978515211 0.18783345136450388 -0.35460299668637618 0.91635437387716323 0.48574039225675636 1.3321449490310895 0.079398737201740247 -0.51291574063294154 1.6570809553732093 -0.055286198651775281 0.8242165143256881 -1.1734256242705308 -0.19140058470312826;0.51600853944944369 0.54972468632786486 0.41170761565348796 0.19911893765541178 -0.10529191344530466 -0.40231206845698791 -0.12908949144017823 0.72183762169032872 -1.4641854477848766 0.45763180478790172 0.074044279022232845 0.23754179918425161 -1.5925679894582863 -0.33899913106016233 -0.88745769459124879;-1.108961349003418 -0.50307221565022653 -0.23875198929255848 -0.39390759529758262 0.13093402120598735 -0.55054717932302144 -0.35393949761939958 0.062381606047557936 -1.4511756504595403 -0.67567462317974902 0.24929181572711145 1.1309398923765459 -0.88005797696358379 0.14213668510140737 -0.29415321197408784;-0.18676447399959473 0.35170835967740982 -0.58346964318497407 0.16645760113303809 0.52798384513581054 0.24755634301214563 0.79899305954567401 2.2233035528424372 -0.54177110150469276 -0.84015433220552305 0.87811867496008811 -0.55991269690761125 -0.97802036833041095 -1.1921978773998956 -0.16678082532012684;-0.24566744161730891 -0.22818152428358743 0.8694576063820606 -0.42314716635038574 -0.70752482512958859 -0.75787084903471902 -0.56753329976277345 -1.006755229961009 -0.18066511627750709 0.41117683974200014 -1.4098064115404723 0.25816837898058337 -0.94390814918813137 0.32033287487774664 0.12992933623020089;-0.71978156204379851 -1.5159417016451933 0.54543263626122174 -0.028532999053380227 0.23048564312954528 0.4617703390707692 -0.19621227789956841 1.5611473957830859 -1.4195929597700929 -0.26110975774301942 0.065344329052702085 -0.40996925423416714 -0.26991649137646012 1.7483848028971742 0.92128528008466182;-0.4798556440571618 0.4686562960743777 0.092987646161759002 -1.1669279308918905 -0.082109023899113107 -0.67047342580410729 -0.87150399741712636 -0.64279825162674098 -1.8658161402233582 -0.078291861713796138 -1.0082087217307714 -0.74688101670793028 -0.47945326457233522 1.9672115885184711 -1.1377932207566144;0.56608257524221728 -0.26871700789618003 0.54202526493846315 0.98901000845092801 -0.38916916596625151 0.10988577080221798 -0.0047787513500942604 -0.54417779369995334 -0.56267237621010879 0.97481385839946977 -2.1197878022769046 -0.44065105649642172 -0.054030301365776287 0.60803419769077727 0.62642896287559857;-0.31084216874420639 0.7255373643960239 -0.083592346480538399 0.82962529673379737 0.53838524423230227 0.13155065022694806 1.5427226799306002 1.4104970193988826 2.5949800625096877 -0.85023217475084578 1.6202595089829894 -0.70956368823003702 -1.5078086127484491 0.48654282052283082 0.42380925064446784;1.4770404118015372 0.021969768200490875 0.65492004980323337 -0.01862896359039528 0.27310787706440648 -0.084654627580093705 0.77497365791853456 -0.098058078458974643 0.081608030718824109 -0.60599537829776107 -0.57357132222759855 -1.1232720739614244 0.67959817277800105 0.39515984319835173 1.2539584441623819;0.29618869216440769 0.03216899260670774 0.49987550139206416 0.71670327659690591 1.0654121338965439 0.72430347806743633 0.34306674840868218 0.55417199651158588 2.0481853200946292 0.0023842564656503216 1.0853527489846544 0.68908707606544783 0.51952542395574808 0.70729730973049953 0.61540612231654734;0.49837046568265814 -0.65153497640861124 -1.2492823377177742 -0.22413389686629084 0.17030147091576017 0.80885786429644491 -0.348055128995158 -0.83492676660287246 1.984770208168263 0.85745336382933579 -1.4098337979358928 -1.1953261927565386 -0.95150580344081925 1.8808359233168326 -0.12869757021346256];

% Layer 3
b3 = 0.44276897508827201;
LW3_2 = [0.51473878306743537 3.0352152533382193 1.7525759577905866 1.3636769365920987 0.60302899800869392 -1.0155745180919116 0.77233513513437091 1.3736933981782991 0.15475772647310088 0.14249028873481781 0.15724659464507437 -0.6900279153270017 0.14761368916862408 1.4036067222936999 -2.7265554662465297];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
