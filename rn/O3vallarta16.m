function [Y,Xf,Af] = O3vallarta16(X,~,~)
%O3VALLARTA16 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:55.
% 
% [Y] = O3vallarta16(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.12820512820513;24.390243902439;0.02710027100271;0.141843971631206;10.4712041884817];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.2999196898088645;-1.2823961244753987;-0.9361917791743094;-0.60928229119625799;1.8753958220312843;0.31389102953171849;0.13296913168549374;7.7180026446854949e-05;-0.20701649975550593;-2.4397684339583061;-3.3569037535396591;2.6796743880746048;-1.0264101214395223;-1.6122708783670896];
  IW1_1 = [-0.60729875831808766 3.9096755070849571 -0.95673242778160994 1.1409573642773299 -2.7283053167467282 -0.65984894806844874 -0.15366829833668749;0.33612948512709528 -2.1258294851063231 -0.88522713913911899 1.8073483992610897 1.1103179738642444 0.52950353071592249 -1.8670885330366198;0.83021172928520814 -0.0090838673325049427 0.20215662598117914 -0.60741261153364667 -0.20906579889317917 -0.4446239606908351 0.52629346100537289;-0.29794073805958188 0.32107494429646344 0.4861783969078004 -0.968601567382949 -0.29198689826716068 -0.31893143264263696 -0.21969203257861317;0.40294148500858645 -3.7192627716024318 -0.47823231449229547 -0.55164785850108566 -0.22927511596985797 0.84413049611847291 -0.55694525018115437;-2.2514455603869052 -0.29632545555624851 -0.096844395611255865 -0.24069910319549392 1.3375561320603671 -0.20915878215805872 1.354819493366848;-0.57749457591005782 0.50276537457263037 1.7877172941522328 0.026311046105738672 -0.570520564029945 -0.17521306656550273 -0.92406033117205988;1.6611643318951073 1.462595137282021 -0.0028359966263078683 -0.60830079402523596 -2.1705634145324288 -0.28437075345345869 -0.14598101043736728;-2.6110258512617572 0.48280077389611953 0.40647025456949543 -2.4913162199408974 -0.37897016086036028 -0.11823273744814974 0.27793108593047899;-0.18827116332549382 2.1232903947469306 0.52873484975683949 0.80740156026965537 -1.0745122226796568 -0.11978262338318302 -1.594575057927087;-0.043002666932248995 -2.9266257658589758 -0.037878184745480256 0.21716606885048167 2.1549208862642533 -0.085420909180924473 -2.9370648018895533;-0.021937697283635996 -1.4021266875190015 -0.12924625300450338 0.08914218476499404 1.1236510246875739 -0.25364805131712975 3.0593562848624263;-0.09902797831472579 2.4008338899605506 -0.17428011010777528 2.0553182394101861 -0.93822437873491316 -0.18582050907826617 0.34623967307368986;-0.83490897142495224 3.9610702466378243 -0.46770992774835929 -0.16974561587167689 2.024032311898722 1.471166429789601 -1.1951216202240242];
  
  % Layer 2
  b2 = [-1.2969075405007848;-1.1739985562146071;-1.3628216299422675;0.19107880507628522;-0.16996126922639723;-0.30747467051848415;0.99762964911820784;-0.60846405503445011;0.65152156631279179;-1.3362001848302756;-0.12764933552640312;0.095141952282048664;0.15052717051543663;1.3843793480931192];
  LW2_1 = [-0.66447811087638264 1.2599546916307085 1.7017660921860733 0.22707117998070303 -1.1731597441180344 0.95340184202268452 0.0175823129485254 0.55378117961151796 -0.91084377903638758 -1.0261823165520623 -1.0377119947821902 -0.35751474668420902 -0.31247583867945322 -0.41493878866922496;-0.30656427093968353 1.8399330023955884 -0.64697359899086127 1.0108739874227071 0.79150416186648886 0.67637209285733557 -0.13380439423583163 0.84992838022803752 0.66106320412266018 -0.10070876122119135 -1.8155035662886547 -0.15546865850060221 0.83651472356100731 -0.098495015394519075;1.5048941725668556 -0.43541337790310153 0.46983018165987428 -0.61222913114323441 -0.061721975786269909 0.21161290165925828 -0.53094373135934547 -0.38938598436780109 -1.2053704906544394 0.69352554560899393 0.59012083051628739 0.75375432644478235 -0.30584341543547738 0.61769439122945902;-0.018602356583869616 -0.85457672907620186 0.27859709440851338 -0.32166907754806029 -0.30705671604901641 -1.2922494539143883 0.085226374723613274 -0.95998611357848707 0.40225091779944361 -0.61145574900046329 -0.10936588579362949 -0.16515798431628631 -0.16029868815226128 -0.29591639212874715;0.85381700920139925 -1.4948862176852644 -1.6250302233486831 0.049952085201483351 0.14393333526739036 -0.65140319873857189 -0.12995808210651344 1.3217037596647312 -0.72715042909748184 0.11469251733311649 -0.8012606423942582 0.44434401582069488 0.26958294810512967 2.666839917185555;0.65827586408012428 -0.76478554275741706 -0.39936421164606584 -1.1445286504165133 0.70975186496235232 0.11675553767648295 0.31190705986452771 0.21313569855255937 -0.14240430743842455 -0.22678420147195461 -0.39307184228682679 0.056211078578443492 1.5902126484354824 -0.40212509519781903;-2.0987546428529815 1.1761986904382982 1.8801349443867179 0.012778270840774895 0.86526621889221456 1.0220111699877652 1.0371339304773639 0.474106417294133 0.029752601258440516 -0.57520413789797398 -1.4274432690580681 0.29479305293768843 -0.71379815916009193 0.23743006550258045;-0.43422121452388956 0.78723017146358032 1.076772917967231 0.18114977249194295 0.72984206798634699 0.68082351614391123 0.41581757406183945 1.3977263073714628 -0.92044020635520507 0.20074370904943728 -1.0836178221620096 0.095707654689081878 0.81843203439795975 0.58597273146082762;-1.1425253502353758 -0.37948734912620369 -0.6201684919689594 -0.59929526017410939 -0.8371609266395944 -0.78855528001688957 -1.032052056577105 -0.66576401969001953 1.109599333065209 0.82782695967458364 -4.266125722552446 4.5771615674136621 -2.0105503149450721 -0.40034706659859387;-1.8260587357623079 -0.032796352478337003 0.10218050389787123 -0.80541456880707873 0.99342422315616508 1.048360247972524 0.46640035604480234 1.93332842203386 0.19684263756194842 0.33682470421359428 -0.21610050353449151 0.56825037316483928 -0.45058145916848169 -0.47104740128907852;-0.57368782753540337 0.68977570268628396 0.031903304847435428 1.4804909162439621 -0.20068249411709488 -0.10377632120648543 -0.31693183714585949 0.018342919387273351 -0.19426611469614927 -0.20301098565507 -0.016797286813725623 -0.15385431975854036 -0.87983227939545483 0.30353722213794593;-0.027887804666639978 -1.6886378307064469 -0.29892049688180816 0.41669993144075995 -0.028681349033030323 -0.39172018028296018 -0.27183331649508025 -0.45101815718722471 -1.1242856322210288 -0.52161840303193785 1.6079649990309726 -0.056064970056784527 0.017303097191239215 0.082918759788869811;-0.29624822221159713 0.14417721849090168 0.78331505927752298 0.033354647088369091 -1.266033131070337 -1.8179523759794258 -0.61172364442292471 -1.8013706730233061 1.7162843226207352 -1.0577917023799137 -0.71808711039275397 -0.5704649401298848 -1.2931127981372459 -0.17202485330991352;0.96422464735154911 -1.0871361031059013 -0.8929527861716352 -0.45891463557589046 -0.13469006883211523 -0.73142994537414852 0.49941126159030969 0.1930294066826663 0.59874811329742283 0.052789965083095497 -1.0653298940070626 -0.91717700383391365 0.017040766776834589 -0.21228787383961348];
  
  % Layer 3
  b3 = -1.9221958435917059;
  LW3_2 = [-0.92600625603976561 1.2162038718275698 -0.74090548095294784 1.2583615876794925 0.28921381240980537 -1.9174755306266593 0.40043722709142454 1.3334420240117344 1.4352820460295026 -0.37685155401544401 -2.3931932892060606 1.1909785073108852 -1.1117230087752377 -0.2775131517171831];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.4712041884817;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
