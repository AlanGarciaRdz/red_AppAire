function [Y,Xf,Af] = O3tlaquepaque21(X,~,~)
%O3TLAQUEPAQUE21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:53.
% 
% [Y] = O3tlaquepaque21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 13xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.171659085057077;3.03490136570561;14.7058823529412;15.3846153846154;10.752688172043;10.4712041884817;0.0212539851222104;29.8507462686567;0.0523560209424084;0.00624804748516089;14.7058823529412];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.6311299381643656;-2.869487689588766;-0.56994808098528615;-1.346244293192121;-1.0246707921162552;1.3612443396912677;0.81916057355657113;0.22957814433180654;-0.76635067033155269;0.7853847783616158;0.52062951625886711;-0.51591001588105478;-0.57660700930397446;-2.0329376144035325;1.5815184654785899];
  IW1_1 = [1.8407547611912978 -0.16327183203432885 -0.57288500721271474 -0.25136992390062951 -0.024092053124957255 -0.099083466372681367 -0.089383868646078349 -0.14996632646666938 -0.15705596187117182 0.24147286588668998 0.33634234508800859 -0.24706054268944444 0.36038073791057423;0.99111750442173496 -0.16036112046459883 -0.16973728816227046 -0.096704375193128717 -0.26433224825922885 -0.89051198114697883 -0.87740304447330764 -0.57802730637553357 0.07591932232041404 0.47999562221049757 -0.26685076911525363 -1.7253562959018629 0.050475051051790426;-0.55020293822948085 -0.75029593819196938 -0.71326416987831887 0.61096349473585643 0.052571980470201493 0.3407975520862736 -0.13321116648537737 0.15613194907635924 -0.056978569704818377 0.87573749348389318 0.037724172418651516 0.15719577647840785 -0.095211668842154318;0.40267790738598891 0.11686446939840862 -0.28129772313991996 0.09465432971950162 0.3937891732156335 -0.01648859504009904 -0.28214815215049283 -0.13876738327246424 -1.0621260153736174 0.22939674133902063 0.30443484072300886 -0.031930192052441228 0.3642149027275014;0.063138215996734304 0.17498616135552814 0.0068143352532682444 -0.42931085496615728 0.57307243706111355 1.4350864838557125 0.02382210852240027 0.74256185880183534 0.46925245941568949 -1.0608684145021243 1.1188800025759522 0.72407154163628673 0.21957397014916585;-1.463137353499451 1.2498195997549313 -0.38340688977514387 -0.82481330890464621 0.21629816625590895 -0.24616137645968139 0.68261147702801628 0.015716066843490233 0.31488223827624912 0.31903243922252122 0.41871145361353318 0.063765674836061076 -1.1028189066191203;0.937511026614812 -1.0930235060695443 0.9041407387771514 -0.33225901577359523 0.92632776434431341 -0.89518367416865496 0.054435263368955683 0.013708588566021411 -0.14369628604519175 -0.7137434696853806 0.1366798379222538 -0.057790829190787499 -0.087493565404141632;-1.2921898458067234 -1.0398905255039446 -0.94037319980234413 -0.44018239775299001 1.0208513703360078 -0.67900788996557571 -1.1714397283381155 -0.60006521682764891 0.14138114624893255 0.28944181404750624 0.64706895130455699 -0.48532448017938967 0.24683619124480902;1.3137309441895824 0.64249950098230479 2.5140119112739603 0.0026461275282563673 1.094265051399679 -0.037165921907477424 0.44046842636643546 0.13990027381688902 -0.89726767545887642 -0.52132780720601746 0.46856473754598149 1.5572544748729626 -1.0104928527547548;0.096381362888236968 0.31626454574150464 -0.19558400989152003 -0.098506641971498346 0.43830284117781271 0.81038047569764871 -0.42323813387084325 0.93572139414264244 -0.0013208602496612501 1.0193166202852335 0.94409137272624521 0.14389134369973683 0.087722434010544248;-0.14120002999243694 -2.3219082271851246 0.44645602018162828 0.25947788182577147 -1.7697887478883834 0.73806848217720189 -0.78532730460330735 0.12768695112719164 -0.77247902907047672 0.35778576037381438 -0.63661434453802646 0.14454893996143517 1.9612845513948047;-0.55410108238247269 -0.08118979900526227 -0.85477303695830975 -0.10173020116610085 0.35428596931085699 0.09021148547361503 -0.28395584413122477 -0.10209010891270109 -0.89189868743778922 0.75317123296638022 0.3671907501383318 0.02902806030019231 0.047910281876541491;0.20373978633528045 0.45809737586998722 -0.041251436650543136 0.61456551056232089 0.69791039740408933 -0.54356377101516373 -0.32002453292266148 -0.20830112903271897 1.2358230940961688 0.024298746565267787 1.2712078310038142 0.12689480718962687 0.53936423584279636;0.39492633161870405 -0.92128700928821983 0.20119390840223381 -0.37029948523924128 0.57822763025796065 -0.58450449089593026 0.38465716444085812 0.022482124515898289 0.2805325500790723 -0.28908568390733075 1.2697006317012278 -0.69297738916699758 -0.054866633872212633;1.6435098845213434 0.20451170542988986 0.10776686256449748 -0.063852343635938766 0.2632434662218831 0.33355170568350884 -0.034425476600091307 -0.10100567514776566 -0.41627459411819839 0.55425194980229842 0.29623932952339871 0.037174984066742016 0.40951816537030855];
  
  % Layer 2
  b2 = [1.6015672827683358;-1.3888220730187477;0.85352941326771203;-1.0283922326986457;1.666067526113723;1.9110629934296195;-0.1955810632174399;0.22208302004359151;1.2057822906866256;0.42605645900370698;1.2427403570134954;1.8045008007957775;-0.53532248156248796;-1.6337944029471831;-1.540566428285947];
  LW2_1 = [-1.5838216757928238 -0.034630063495763599 0.41627109854618888 1.1969981720916791 -0.22794205548828705 -0.53471081442116153 -0.62070621315693508 0.4501688505505213 -0.65506516702067941 0.24792109747168636 0.13664140888109599 -0.63987875013991302 0.84138533582885577 0.49045327456127547 1.0065035526150932;0.3022055989843585 0.0015906053838271698 -0.42014681671888049 0.13265272153360785 0.46954561879262546 -0.51968547978414004 0.36863861577407286 0.36625925999258124 0.5511863278120277 0.62805455750919814 -0.44861964760541473 0.51681882054191042 0.35146791143476314 -0.57188802216879064 -0.28074601152575546;-0.49589831423577535 -0.73715032643300227 0.035954807217001117 0.063367626381245587 0.15095883918691122 0.78184676430177191 -0.09662734303963498 0.49012222264963945 1.5411309827601627 -0.68908708407839159 -0.77625398823297942 -0.52448644521949894 -0.28802173333255299 -0.0064131202656641309 0.42438377214644979;0.410232366406585 0.049560758830491304 0.70203275324251846 0.32424729495108551 0.33148432708969194 -1.15917429941142 0.83762861452619841 -0.098309958717168022 0.057293017048898782 -1.0435981119401569 -1.0512368582571954 0.077322300322768683 0.25298118108287271 -0.75748973154023946 0.20423694181786581;-1.1874318494667118 0.15028550639098351 0.35162438749912273 1.4481730837919122 -0.058639849962911897 0.51822086631691067 -0.8096434970031462 -0.60177749466230912 -0.64955393476681844 0.39433801511768102 -0.31838909884846267 -0.25597931303124455 1.0527284864560675 0.31213121487000645 0.55673023238939612;-0.11272699628898265 0.17018462087717018 -0.36441994666778366 0.85841392348119572 -0.17148579445629386 0.38078486159180358 0.29726565158253704 -0.40765889193468996 -0.86326869724917688 0.039332434762263613 -0.26571035154230244 1.2176382293708359 0.30559442866245862 0.11938571242654165 -0.82597180118646718;-0.53122283550363902 -0.65974906594312055 0.3019496692999043 -0.57967750831004761 -0.91042332979541218 -0.76813083318531961 -0.43950984045171254 0.169597131416865 -0.95723462777783719 1.5021139950904254 1.3736985248761109 0.10952175472989431 -0.62223216275744109 1.6096402130253002 -0.43475537407361331;0.19963706476807475 0.30809837305577953 -1.165204464674094 0.56369476843003363 0.71221338943514767 0.91446562618539295 -0.81903308672887165 -1.5092755772959021 -0.74912240674752784 -0.83985518599188036 -0.21618033903495254 0.23599904906828076 1.1424212250150156 -1.0899938417334971 -0.034601721057176515;0.19935303660132514 0.016929876698330397 -1.2871170900867357 -1.4489802809638992 -0.07579390300311159 -0.056100117492804996 -0.084111389858719673 -0.43107265728936905 -0.55272024548759913 0.45887963894205824 -0.26597413589144137 1.4699678891586732 0.0084654076054371877 0.357197640172147 -1.7906142569781782;0.056064751487626976 0.089666912945257499 -0.15181502923909057 -0.76940697253254065 0.17984053618352958 0.58600533185495529 0.49134841069966712 -0.19171325583428847 0.5675436085759038 1.1097148066661753 -0.96437621500455151 -0.19321482487362135 -0.020612340265184576 0.23467601405011579 -0.0070021386473701503;1.1130993247534851 0.48434064689168965 -0.49798013656969214 0.77357631691814444 -0.70792848159538302 0.082856002424592859 0.57493646062811588 -0.89570471927325479 0.854132903791331 0.74471051582129344 0.33179093324635772 0.79364938585436773 -0.76400874450321865 -0.71636388284296815 -0.82136335793309712;0.16483575620108892 -0.43175910185991612 0.29145677998102293 0.35725886093499731 -0.46140603208644348 -0.090763161201297654 -0.91163033163196516 0.60945156777778897 0.46604832996570089 -0.072812929441236907 0.28965686888420339 -0.24199354677215484 0.18359560177498221 -0.8847953139741751 -0.49324516543944996;-0.37590815286489365 0.85312034727975206 -0.38434927741741121 1.2905908722034483 -0.64758059866826312 0.58442441489520747 0.3023748049120808 0.026023969554422599 0.6710458471910471 0.8915817295670101 0.47415794624216906 -0.24350559292936369 -0.60541950334593853 0.12635483761781655 0.74423956987856221;-0.46733901493923985 -0.43196303247902063 0.29260973372336951 -0.20333868130634492 0.27733781869825708 -0.92022430293314716 0.30957969567935723 -0.081224500864949742 -0.99374958038976402 0.014049584046369717 0.2369712399939149 0.49672416996599045 0.55783310166515754 -0.23773506551680401 0.86670505776350815;-0.95482671135246577 1.3084045597994525 -0.792483388228717 -1.3298087325439161 -0.0583097973651103 0.52326811130516782 -1.7693670972278788 -0.20330758716580455 0.5813027907265732 -0.53551538757653516 0.43315499317899608 -0.71332666608343942 -0.92429489854396507 -0.67017258118986478 0.88696876800430435];
  
  % Layer 3
  b3 = -0.69258683257579168;
  LW3_2 = [0.89603612589468618 0.041738874031477316 -0.33461927431611732 -1.058815088314643 -0.69021504679443979 1.1638122885716016 0.3053051455455647 0.6749460887335621 -2.3848129496538291 0.44391044841403493 0.44690617516742853 -0.91508719188296916 -0.47632574401979699 -0.640318614890523 -0.21889476726594731];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 14.7058823529412;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
