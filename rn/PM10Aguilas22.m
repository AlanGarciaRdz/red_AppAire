function [Y,Xf,Af] = PM10Aguilas22(X,~,~)
%PM10AGUILAS22 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:19:53.
% 
% [Y] = PM10Aguilas22(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125];
x1_step1_ymin = -1;

% Layer 1
b1 = [-3.7959137943678494;-1.2815132619341878;-4.3513951283075372;0.41034333572197879;7.7365456825342607;0.58976994260854476;-0.10641577533739602;2.1033443803612437;2.6475078527286713;-1.0618103868915192;-5.2461807923190111];
IW1_1 = [3.037983599642359 -0.27694132893393647 -8.2244283457144078 1.5472469336411903 0.39430279722481365 1.9215277496590364 1.3493227032414696 -0.83988891033351032 0.22866115134108939;0.24768944051853142 -0.08545330427362674 -0.50432235315053542 -1.5130941548255321 0.85159226572469482 -0.43391005948109135 0.67537392484483016 -0.33370550940358884 0.25980204576999738;1.0051528891855968 -0.34248734707005302 -6.7378795267227005 2.7886455516590054 -1.3402356314779555 0.34536105697902347 -0.18512151679881758 -1.4224541457780082 0.36733012440171342;0.53727332068564504 0.14386611643536831 -0.017727538659776866 -1.2846516958970171 0.89125189365293978 0.86695288226221012 0.42347319316195137 -0.11452938360040435 0.28566860018926182;-2.9412314435493254 8.0709282281048775 -2.7684459790870215 -0.037520245225660873 -3.4463079334709539 -3.3078478044149873 7.9844217591534328 -3.0224970462641698 0.52871705273251446;0.018395275528004358 -0.97299654069450048 0.11001765430603788 0.34631977841120343 -0.5581691165162217 0.342373704205294 -0.96770492683716391 0.020608984175790272 -0.11460303838901212;0.083970149604066541 1.3878632095107302 -0.15675014658320283 0.04107810103126406 0.64145863892514787 -0.34560329757295233 1.601509615582541 0.025447380658732331 0.23295911151416798;-1.0333096559366122 -0.23580127164907108 0.66432056044285948 -2.286196839555565 1.1868384123069655 0.57961058665314957 1.0237614406387736 -0.19036928852621998 0.84435694910907111;0.64615075735842553 0.12305062579558557 0.044814169148435196 0.93768432265306623 0.67304586358610574 0.81999768243247995 0.19804117740739385 -0.04838370110223051 0.21650952173551163;0.53396268017029513 0.98174470458909746 0.47639562740533248 -0.52832910660725485 0.17276801241900563 0.29118738877094669 -0.86368589440402643 0.013833873101144967 -0.25811058414077032;5.0480942597936913 -0.10504252350549331 -0.51668175451199094 3.5428967356944989 -4.1455060854164874 -2.9278875604292107 -5.4291802447948934 -0.20226081109991487 -0.42300146399177879];

% Layer 2
b2 = [4.241507239724787;12.855716157669629;-2.07373804314591;-1.2085193004755701;7.4671865363665493;-4.4176564974170365;-10.229765329296303;0.53008787707245353;11.151232297033976;-0.22805390464609956;7.5116596791280816];
LW2_1 = [0.53686317130634897 -0.55981063923149654 -1.3464635303299948 5.5850605343157413 -0.4817002013612004 2.1314833540273046 1.4910085352644651 -1.667416268801766 -7.0857022650033397 1.1479044259786153 1.6353773679715427;-8.069822418066126 2.8393609762768288 -0.28929585302528765 -3.9269344915844004 -0.52928004527568084 2.6915728393803993 1.393668147047612 -1.0841033491772698 0.044196115844718595 3.0498012261275216 -1.6945383235587868;0.28351440724898391 4.2889742548203191 -1.3892194210694362 2.3856952917186942 4.0588229013085293 6.0233829637078529 4.7392090609137698 -1.8470839868160334 -7.3887498547795483 3.1052429758232916 2.3076995474556936;0.16629088244606427 0.36095549898443552 -0.11573701850890997 0.023058430302273093 -0.18081873863414225 1.8020846726344111 1.2418739317765917 0.2661080463749198 -0.55651595163620304 0.75725282311703623 0.35558244523532878;-0.91668798875418678 -7.2785205766025793 -0.67173416950911202 1.7104536973228968 -0.67873571680914879 0.016540214654382678 3.6005784857562282 1.3938986489030443 -0.21296358484966188 -7.0377367011830012 12.927499440667788;1.3047130986599349 -3.3976270631466123 1.1097708408354068 -9.7180357097430257 -1.8329050212557867 -3.9738368520307144 -4.295093076397495 -3.1802435924349139 -2.6256959798640196 -4.1650357664414122 -9.8141670023793264;0.47833731661980705 2.3092048548523074 -0.38188857208865445 -4.0964876155542793 2.8513145874903758 4.2819347368428415 3.6996702614751187 0.32969325117244247 1.0143789143638384 0.87962436421591417 -5.5010574630675482;10.362587500982922 0.62947911286259861 -3.5125909353403686 3.9084775559555598 4.4225196864442289 -0.75636931902189586 5.3072797240792688 3.4561759788599811 4.0787731112619383 -8.1191556171190253 1.6752709240881238;-0.34648850512693302 1.2377299969363387 1.1339502799435017 1.8411176569425387 0.62307485742443602 7.5436031282587859 -5.3575694743950395 -0.70195889663761035 -1.2970736836232843 -0.8026092959946789 -1.0904486691367778;-6.2159815102558955 5.9239259289783579 -0.24577566724053268 -2.9403914748108915 10.797368668315563 4.3625605400261298 0.71628663646090951 -1.5054284817331312 -0.47073652941949679 -3.3660420786769865 2.219981591487791;-1.3872504118352944 -1.1736162903856329 5.112804097623858 3.5844096024780985 5.4705530130019779 -4.5080153632926567 -4.3194769392420884 -2.9090179815279349 -1.7151256311885532 -4.342081745872914 4.4647317924653107];

% Layer 3
b3 = 3.4777713193865081;
LW3_2 = [-0.23730672175576847 0.20879861048186465 -0.33756239773873609 4.9542789693531732 0.033502945504256039 -0.021156992902043446 0.17622790912630154 0.078925483947849331 -0.15847602810077122 -0.082166897316963028 0.073017443084208947];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
