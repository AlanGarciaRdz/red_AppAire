function [Y,Xf,Af] = O3lomadorada4(X,~,~)
%O3LOMADORADA4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:40.
% 
% [Y] = O3lomadorada4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.290275761973875;3.96825396825397;0.00572573718866304;62.5;17.6991150442478];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-4.5126317036463215;2.6861744653187909;-0.90052894524669713;1.0601631663217685;-1.0733582942744919;1.0886267681455983;-1.7555589339133848;0.58857214300707494;-0.085856584928702184;-6.4392933703910682;1.8565198330309656;2.95635003266925];
  IW1_1 = [-1.6490009877581557 -4.5648231826339885 -0.73150695953609102 0.94742647244191081 0.064015044615632163 -1.29571084734478 0.84942901816619953;-0.72704870787061682 0.38005473571399112 1.7891487865360614 -2.1730725393201742 1.6137399438433584 1.0045909284621661 -0.90374089988351114;0.98600314803695843 0.0088827466510700247 -1.747433238694756 1.0680628302516169 0.38058115161415168 -0.29728960142416072 0.57425392594729885;-0.43173483619497399 -0.017876109819141204 1.8459156018661538 -1.5075362176154403 0.26470970104049246 0.16675397831266575 -0.50053971367338246;-0.51749880142526672 0.78821632754227466 -0.98125649398960901 0.19880120055967418 -0.20155138560617333 -0.059431755662454532 -0.12686245851321784;1.0217995827014554 0.020721326864602686 0.97979449905949212 -0.0015336716863020693 0.46603111210123732 0.21171107128525335 0.37164639462940446;1.4347976660675532 -0.42234676002078475 -0.089754260054855844 -0.80332545435345204 0.63000860734012454 -0.54449197803607463 -1.4771448904490867;-3.1282574087784019 -0.85877739720364865 -0.41907205966496913 -0.10460915332578713 -0.057968475204065922 0.22988006819151677 -0.49511867888677741;-1.9729345905379174 -0.045050698654020047 0.70602228148538448 -0.42795365180355832 0.39515043967665231 -0.087388803579007385 0.30741651177556284;0.28545585273550461 0.51195705836654493 -0.7439498235907791 1.132660751956166 0.10631217703713791 0.17672192948371127 -6.3372475002284414;0.873648379286459 0.26628209288320509 0.11625858238190286 0.36435845248228599 0.77861793713735439 0.151724895852095 0.56798033385925284;-0.07637973334104467 3.6252553085286046 -0.67032343983804188 -0.76530912604565582 -1.6379643194144913 -0.095405322918332924 2.5780348156256441];
  
  % Layer 2
  b2 = [-2.7593508380495719;-1.7681346822625523;-0.47386304402863805;1.1166212978317374;-0.7624098623945349;0.25444345718355166;-0.77682825966179347;1.4616753674075909;0.8607041100110816;-2.7585385792212058;1.7726635119323455;3.4213140523413959];
  LW2_1 = [-0.20850180768622395 -1.6045261975880447 -0.51275115080470457 -1.2465955172115437 0.22008321366595984 -1.7991937274496259 -1.1084947797467803 0.26945422493269433 2.5185044424470551 -0.37032925413816076 -1.0550999861940926 -1.1106305258275488;0.54139177149691564 -0.18492978234254387 1.6066464441207744 0.47556590539442972 -0.22838322079716084 -0.099660270124650896 -0.15199434342603685 0.16042115750276581 -1.6432580146834608 -0.35046124654286209 0.2233775863481969 0.44394489064848852;0.10817710997057776 2.3104517086003069 0.71245874401902953 1.9144086824378435 1.6840884289635503 2.0067921362265424 2.7041007869580089 -0.31446243584323497 1.8446786258328964 0.79391249576317335 2.318239007982712 1.0766346347974991;-0.34109922967830114 1.0836521346451209 2.1455898810382963 -0.65548219557019005 -1.5442811030064743 -0.30854291122635813 0.18495559029403463 0.59498255740937722 -1.5805424958111187 -1.7534810371672309 3.2850645356552848 0.32352618895438506;0.050496993370409693 1.1305926813335088 1.4519227180773917 -0.86216378958209505 -0.1356644819418813 0.51873071139920079 -0.25857051145465226 0.071646665466403164 0.59149389213437231 -0.42453323620843264 0.073090417623075332 0.14076689907229473;-1.4268572221227294 2.4369696794383056 3.6154265229769318 1.1123635621877683 -0.1172604783828884 -0.37464344160138824 1.5521724716907679 -0.83843402153658608 -1.5734147487634047 1.9326209662924816 -0.47607190610601496 -0.7995648660148218;0.29359822104496236 -1.2087215653004943 0.3545250180341718 1.0267238860703729 0.40325480109867756 0.45897574263137031 -1.0899564179953569 1.2363559290128707 -0.27006994627527559 -0.71179557876714095 -0.31515763051196444 0.046520589009207344;0.39969788773465709 -1.3076282308855771 0.33117968693001193 1.2721518573895094 1.4826612289927579 2.5502777102327467 0.72155058631244029 -0.16417103915560732 -1.3230409851431144 0.22574629555463341 -1.3270528164069271 0.21751663823320441;0.095741152409232269 -0.90294399975504902 -1.7271017670331075 0.26697014784773082 0.053119600672567865 -0.49566827224540627 0.36062931040208979 -0.27976868791037873 0.39247293475856382 0.35039277400297303 0.80591867326773703 -0.21417811813989215;-0.12487411302603812 1.2131139640701549 -0.46441037756975362 -1.5707049544352294 0.21626364677513232 0.9258593417295008 0.89561783733570555 2.9704598740398134 1.6645812989210043 0.27149595416757943 0.10621229988427416 0.69492115307290381;0.022563642522086057 -1.5136922403874842 -0.27019213422198241 0.52386502590979034 0.89015956805025021 1.2606867855551265 -0.24547170239244914 -0.8844630584868044 -0.16489079120919281 -1.258905550294013 0.075785320975810103 0.5571460822780735;0.72557007912967775 0.21344333033015966 0.69166962847857494 0.3147026536967707 -2.1743106386350135 -0.1636612758657611 -1.7325836247149029 -1.5186022776971744 1.0162848949023791 0.10377928728553645 0.60155798366696234 1.079576754254836];
  
  % Layer 3
  b3 = 0.54376226732779842;
  LW3_2 = [0.17907662233012345 0.86016351506727717 -0.2293460048041627 -0.20755971006842644 2.5863230486171616 -0.39166228518923363 -1.4097207513918486 -1.6337237748260283 3.2815977535497014 -0.98616193525940121 1.523372087278601 -2.6895005869460502];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 17.6991150442478;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
