function [Y,Xf,Af] = O3miravalle5(X,~,~)
%O3MIRAVALLE5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:42.
% 
% [Y] = O3miravalle5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.304971027752364;2.48447204968944;0.056980056980057;0.0063552589768033;15.3846153846154];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.7374324025730359;-1.4124759605701573;4.8041797937593467;0.70270811895114971;0.73439392929762759;0.29613210007348606;-0.52902419212546714;0.94150121348928772;-1.176406644738663;0.05096492225974019;-0.62129316596391726;1.5020345290648403;-4.1333484217546301;-1.1897741810999822;2.0643964277136182];
  IW1_1 = [1.5375071319488918 1.7671638003007484 0.17905695963043647 -0.97993234507663385 -0.17191914413238316 -0.0063111016101491547 -1.3537186305883311;0.56832772594976544 1.3901995864269623 0.42550149816902971 0.28756756337981354 2.4302008704385756 0.78380024736452714 -0.63499689546160454;-0.19720214816514287 -0.75125984168202642 -0.43523490236507656 -1.9261251258291352 0.46884422108307344 0.066150092132374175 6.0186753270306701;-0.41052878441029206 -0.82577428265402519 -0.37762283431068971 0.40378631505941542 -0.71739794278622604 0.025860728412047788 -1.0259354159435583;-2.1570702441439606 0.95929775557464092 0.79037589635128691 -1.5730752193471031 -0.050681881538011349 -0.070904315504301971 0.84705681234669861;1.5220394572655247 1.1253484147566819 -0.19498039703878961 -0.51957048097222192 -0.073729119223360007 -0.18783199190644856 -0.84777156326159286;-3.2318959697905409 0.19056464978714224 -0.022308980517235392 -0.88532978270087703 1.3393990677314811 -0.038156946472959322 0.073580388301935418;-2.40812750095983 -0.033907192560838524 0.45541572115699663 1.2023957881215228 0.54562246702806727 0.035716429020984604 0.59933271177971026;-1.8568750939927767 -0.14755453304342819 0.74845960143266199 -1.2706532937827175 0.25368628354873102 -0.16008497233317445 -0.80015591436047606;0.36227745134159189 2.2899698991180126 -0.57391313768021901 -1.4454312970948291 -1.3969436355177829 -0.84031571268700811 -0.23709936622205582;2.8727910148517619 -0.98485164839719552 1.1044124239150628 -2.003759687152121 0.26388080163270539 -0.30187628592181703 -0.1493430697083796;2.1186692558644635 2.3251880998313696 1.1925413009572319 -1.5782648753765585 0.55980375951389993 -0.0069521854461328898 0.0040683830374053168;-0.37352015421247131 -1.8646057417368445 1.817401400520926 -0.7574844929382013 1.9252499868090505 -4.2861314598778 -0.25506074805337781;-2.3058090958909609 1.2269436361340746 -1.0715047179412958 1.766728426571577 0.24750817609998832 0.38807142747878492 -0.26112525725528907;1.2900251570234678 2.0868025131106722 -0.23217068503965138 1.3534271013617285 0.09574083483537861 0.25191517039087225 -0.55696906769402499];
  
  % Layer 2
  b2 = [0.67465016864483318;-4.5339891341640994;0.3678472881397063;-1.0052778640609104;2.6416133696562691;-0.51390219657362002;0.71358189425147356;0.029447587692429888;0.93731248602453121;-0.92323564276843773;2.2230221565397748;3.0562706048181791;-2.5863639965463427;2.5486846914701982;-0.93035018682780046];
  LW2_1 = [-0.18337898075726147 0.061961653199657803 -0.23276676161237625 -0.15065768635927343 -0.69872875411427227 -0.37941899865166978 1.2871195671951356 0.83397712902355603 -0.90959166507910583 1.8400385486767086 -1.036112939300496 0.64814208067947243 0.15585598208132559 -1.4127558942900034 0.31081265607507125;0.7431440758398935 0.9714734593441654 0.55761940873601246 1.3089039573666743 -0.45078354388696656 0.92617001627642337 -0.65599341695236102 0.24005320793849463 1.9166349354859338 0.24361960945914859 -0.14440060888760528 0.57174195119454885 0.55225297321884603 -1.0855822889162678 1.7607141990623736;-0.22418318492966385 -0.12022528569745113 0.025885512409559198 0.22993009655254862 -0.65134526604522414 -2.9603662065091609 0.46965673644256789 -2.1251158359490319 0.24208371503797829 0.61608189482276576 -0.6038721255119377 0.86920609197866872 -0.10803071295383629 0.16744071736565197 0.89846819806083811;0.57727729288494967 0.56980612941003739 0.53808970182376004 1.0981179991625238 -0.21520598756547579 1.1489929134583885 -0.51040490684823503 2.7170329837855589 -0.13711611965083706 0.028022371397645799 1.6451380268130915 0.79002507924389953 0.43314404275339113 -0.74093987890906121 -0.68390885004157465;-0.30511688400947323 -0.11719268485675345 0.056732515134048804 1.1124431162986361 0.19149782931550399 0.82959283528500571 -0.16259450533784581 0.19568092394046388 0.25353240663882881 -0.57090533080568828 -0.054496265510626696 0.68921628140329694 0.68955052541403705 2.4715418508002527 -1.0270846588043745;-0.5665780538446259 -0.084419244554681055 -0.0048189277118640128 0.30398472676641231 0.55133897509678098 -0.17952637964410847 0.16232272690439789 0.24996573393752802 -0.13130889263901141 0.9525676378616732 -0.8239135596242616 0.66638273202787957 0.18325819173573313 -0.5670110619658153 0.47346597208819785;-0.53839075258933389 -0.073629136824258312 -0.028421407362485818 -0.089754670063040026 0.44378896710500759 -0.79933314542665324 0.11478120024520763 -0.2676231748793676 0.85849756579628567 1.1936446863194252 -1.3943963437211961 1.6780586059263616 0.38702001086486321 0.040897298042436761 0.56001346967331112;0.31926923073108882 0.14262555741181587 0.010946796423334355 -1.2368901096450453 -0.61154501806056694 0.90441329007238502 -0.74595730060435805 -0.96954650223705985 0.87998084279291733 -0.34110044056121147 0.22998508403269011 1.4033309535570906 0.19615649416319283 0.65024738714164176 -0.61677126148003858;-2.3007630037535396 -0.33114202849742874 -0.44711926707874189 -2.753265881852681 -2.0833805726220911 1.5499526005824225 0.99900977298976912 0.21276985049784514 1.2935252459203397 -0.3528077483567687 0.53958957870167268 -0.35169687328844723 0.081654596550760072 1.3753294321599903 -1.8191048934580774;0.65430663124891286 -0.17958804376945897 0.30106547867452804 1.6025620706227075 4.4492182857829715e-05 1.6825186836400288 0.4843865437680433 1.0255217327232129 -2.2591022776000957 -0.55680985653297077 0.70880198424211605 -0.39195403306502291 -0.47782498654038785 -0.21216549732572618 -0.17545610570716749;-1.2205016566589675 -0.031973982854613892 0.55869861792664488 1.0660751625848346 -0.16653361702631778 -2.1064552584729204 -0.4879099308152659 -0.038453691904419177 -0.31373721364695079 1.8680392394245868 1.1847170244265668 -0.26128746866782326 0.61471848635957205 0.029996705773158713 -0.79685011566268305;1.4484616813434821 -0.53185797232568111 -0.98683617432164461 -0.91893594356427433 -3.5128851496714617 0.5847217426348611 1.4859073600282389 -0.19252555806489674 -0.40589978598210774 -0.25433551503547591 0.78980976960528715 1.6322381216605208 -1.47581460507144 0.27485401112999586 -2.2346434899885934;0.019505842171074674 0.26274410703477458 -0.019801827966721357 -1.0793899731141057 -0.18183838596820465 -2.8518523278195653 0.3451892880793781 -1.6245337863496716 0.031200366078084907 1.0738552979321343 0.63829076019820208 -0.11707862006817607 -0.54797119258804794 -0.86210469134232581 2.0464610514722761;-0.78229735708071335 0.47882301592449633 0.99965952631160704 0.57013240030313317 1.0716108591428595 -0.56992074383892377 0.17154019047483238 -0.90975569162678227 -0.85991857937277305 0.499928771051596 2.9077295786222517 -0.44494781457520949 0.15403713807809688 -0.15911445824010745 2.2441001046255913;-0.18000732038610792 0.035118325255619268 -0.096629154398841594 -1.4778592136700539 -0.4968836449058136 0.42391321814439575 -0.32522615536885763 -2.9981122211346354 1.0000029710793081 -0.45018192449063649 0.59670759459577039 1.1698030915647941 0.30219359782226929 1.6130372955850709 -0.2884259629829577];
  
  % Layer 3
  b3 = 0.79309382285393604;
  LW3_2 = [-0.69528470044904012 0.38619725205867383 0.61442529041839611 0.54645002353321903 -2.2993735384202356 2.317999553369992 -1.1779466005425838 -1.681320063320328 0.43178906530395461 0.8694092072808286 -0.85509519447112281 -0.51621351430893447 -1.8241327802219018 -0.39650167674068426 1.3321162228922532];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 15.3846153846154;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
