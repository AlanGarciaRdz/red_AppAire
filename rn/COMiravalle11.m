function [Y,Xf,Af] = COMiravalle11(X,~,~)
%COMIRAVALLE11 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:45.
% 
% [Y] = COMiravalle11(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [-0.57528682654055796;0.83975189412754447;-3.712471547121126;-0.17323969647661919;-0.74561745140245506;0.047048183852843331;-1.0486564991731653;-0.97892163979811242;-0.40107659924420413;-0.8112686663062908;-0.6160007986000231;-0.59556292421434587;-1.0553156014551428;1.6343919253858077;1.1778282948371703];
IW1_1 = [0.59685001150979944 0.033031334423626699 0.30675796962585106 0.39905378852005385 -0.204474807120405 1.0343193419366792 -0.11717621332027801 0.41515516310045086;-0.45020990576630976 -1.5445256717697635 -0.43775232249591467 -0.29503080955025307 -0.62418037461435716 1.0917783755038395 0.31177859437614919 -0.091970791928892903;5.3793232615198203 -0.099333137032453556 -0.076294308318385795 0.99513753234525437 0.7990486722183977 -0.52010302866575842 -1.3659710202362236 -0.36227990874655602;-0.068887725745544914 -0.055171471217516664 -0.43863808639544094 -0.32735356239978469 2.438425474588048 1.0692196423754863 0.67610623206197384 -0.87611417879378561;1.2744657312442027 -1.7851230516113921 0.11505636255508118 0.22844328777823156 -0.64072254459313449 -0.25376593918473411 -0.17669656044573157 0.13523452769751695;0.12325122662857481 -0.86243219112029978 -0.26424449328441474 -0.3953948210532503 -0.054927564275112771 0.62391752507972131 -0.21272449699130375 -0.57191030070631121;-0.81889729043516357 -0.09710184093576156 -0.35716706641982099 -0.34679265515951169 -1.1597957096163189 -1.1726630731911061 0.26958691554937908 -0.14809914282271869;1.4760130556568816 1.2255459552950041 0.10767113249994605 0.52490253936252151 0.56809261023028246 0.084945669826214959 0.47894147352504246 -0.36898173272561396;-0.4888898657656926 -1.3551762960358797 0.18340334597847163 0.61676603139971853 0.43737286315331458 -0.7884664484721462 -0.1488985983732814 -0.21057839629022179;-1.3865624643491326 -1.4855094871765209 0.089416670070514903 -0.95041404050389733 -0.3932964277752965 0.6660313895864487 -0.45808504462562277 -1.9868376118159139;-0.92555957979193426 -0.27838495278530323 0.088520626929991866 -0.038858627011949767 0.069332958200927081 1.1710031058082644 0.056299477364981997 0.64745691022316176;0.28579271913805782 1.5847511634798941 0.10655978608372958 0.026487039273412297 0.56686846556742543 0.62216053869284438 -0.17192350658161754 -0.012879192548854513;-1.0266599257411142 1.0826383712685672 -0.01716598873597288 -0.3864403069142906 -0.99957109514016185 0.52959179347466312 -0.69429063463547869 -0.32369629813481177;2.7539910738202167 1.4506790831027092 -0.79909619239773666 -0.39423663791810037 -0.42720181759528969 -0.65641028990270944 0.37294985226966626 -0.24228371584244021;0.79244335668325716 0.33645274303920691 -0.39672764371191732 -0.42296226897853006 0.29818451002186008 0.43835545904596879 0.47796253659029547 0.38823958113975893];

% Layer 2
b2 = [-2.3568578272574849;1.1011179737431558;2.1039400139163753;1.5289553873590984;1.9244233347985313;0.70748146707093329;-0.76423382498988168;-1.2428817171765389;-0.15938808307249525;-0.19123657603324232;-0.040595644833544331;2.5779736887368645;-0.90148309352480005;2.0750948550081483;-1.1111265920244482];
LW2_1 = [0.21628993800791765 0.63824395949238599 0.56864160256421847 0.44941198004756722 0.59937934310070817 0.30091631682348124 0.081946322123385207 0.46586098388867592 0.19156022875183049 -0.11882356223787618 -1.2260393425475482 -0.53640742730136981 0.87032657191645613 -0.10934637518715117 0.38592910473688086;-0.77081598036601895 -0.58731346953081542 -0.18558432435069705 -0.10961678735188027 0.74853843016086785 -0.4759061248189978 0.3562346002127727 0.69108054713538092 0.72374848725124474 0.085068476429261561 0.52497454961223844 0.65914635118703502 0.72132515951755571 0.34579238039061261 0.2093188035331684;-0.12116820995354391 1.1678256831008591 0.2562189203318217 0.35549558133946724 -0.045350716552917621 -1.3643147321911639 0.56397888744203672 0.020907275493605354 0.10081314098802011 0.098004660966161283 0.52537051832864867 -0.79509163607355693 0.75175219164650364 -0.18049951329265276 0.89240621826277333;0.20494423599036743 1.200865325172227 -0.057142693205856868 0.69464755039339721 -0.28764942634128127 -1.5530343800517543 0.89439714418654537 0.10949233954250917 0.34933011947214476 -0.23722874070914876 -0.33404756370134703 -0.55869118881043089 0.58106654720927098 -1.5751180990056399 1.5037565976255476;0.054114991493570429 -0.45115126897848612 0.2764626808321477 -0.29334173400946945 -0.44807500083978274 -2.0754186085881501 -0.027866054877351495 -0.3156857829367396 -0.16678577796099384 0.67421189086193223 -0.30398297815974384 -0.12248955798070524 0.32209084762850138 0.13566543093020333 0.40815525601588787;-0.043530043658690516 -1.0473354401024466 0.026498585677394944 -0.10516048154563944 0.034618114517637875 0.783154605111261 -0.03529371593444465 0.20882669881114069 -1.3794862670771004 -0.093751028834848094 0.28299873255874469 -0.65117315160040212 -0.50205824270349741 -1.2802729697839998 -0.89942757764303227;-0.50009854877073223 0.037686948964563365 2.5516004736144309 0.6517448038175313 -1.7501607944778665 -2.3145152292143418 0.038934235771549981 -0.86342823514003952 1.0439345122927226 0.87798907880612509 1.6496582891656777 0.27836650984172601 0.99764611338232301 1.1110407994495 -1.5040259043960817;-0.11475083115821415 1.1766043051829842 0.026247443206096899 0.0034950405899625871 0.15920272761342552 1.5315316651375064 -0.066493098049068791 0.30522033601393639 -1.0084149373563867 -0.31615865318138875 0.46727237478802719 -0.33069191052269065 -0.64293861490346749 -1.0403701451174652 -1.3061868846528757;-0.54762380896132723 -0.7842555502590054 -0.024189372487821457 -0.11352852692563312 0.80927528933778126 0.12460883646143085 -0.14332034687958561 0.32709569963210322 0.46676178893168735 -0.13819960843616483 -0.27833421247150447 0.46121781626636071 0.28974296157748136 0.624589781965874 -0.0098201092852376552;0.34497736697044007 -0.37639683085426373 0.34120746015574899 -0.040047701069305053 -0.3089093696362385 -0.52776088410928768 0.72076937411848474 -1.8059564904365708 -0.11761544822702102 0.21060505950285441 0.24521057125836385 0.35293708583565497 0.29269504604550822 -0.85349345987600411 -0.27572624254090039;-0.81630112181390491 0.37130273664466906 0.85366936953685413 0.64502530948487247 1.1163670274707538 -1.4279900947294684 -0.11169270903140861 0.94435233932251861 0.021142747156655393 0.25494864388637284 0.59796381890989236 -0.20845944837022962 1.2994166571832628 0.0039573098359918027 0.46558104676203771;0.3118792224118857 0.99525316266456498 0.65825876460627408 -0.086002010153299085 -0.060923315831399399 0.091371409707669868 -2.9556559148491299 -1.370218131675875 -1.0408810753096327 0.72121835607200557 -0.16197526768441639 -4.4097897765776137 -1.348538297347696 -2.0024902180859239 -0.12691453411785636;-0.38079590929762741 -0.8644354977888502 0.96171657959728263 -0.72962719481387683 0.17893863254675382 -1.6900466541197856 1.4942174446244612 0.26914854506700686 -1.1156446288582851 0.51197252141516536 -0.15899167988575758 -0.21613686442970312 0.94476437934486412 -1.1922208475333316 0.43139566983204364;-0.73672238744529184 -2.2256910490685025 -0.70622958498712407 -0.45456647168356629 1.4818366283939672 0.67226529600434115 -1.5198621938952066 -2.2350698994956346 -0.56678450062285057 -2.0057761575355411 0.25905412242200987 -0.37882362223647525 -0.91838068462175759 1.8108744287469478 -0.73596510704679852;-0.10647281460633659 0.73771173300410864 0.25023531239945546 -0.66073327926757064 1.2326754969023463 -0.49184738568625891 -0.99106285887311552 -0.8273132923309614 -0.92819466967958209 0.85120020150537801 0.74712258495239992 2.4044605077294881 -1.0196618718711647 -1.0944741015182418 -0.65588982253976258];

% Layer 3
b3 = -0.65523792925520075;
LW3_2 = [2.0772788636926647 0.84881557189854373 2.0762431738881708 -0.91076434753886526 -1.2459434012665296 1.6813115736813746 1.4924608692401926 -1.7413985849138849 -1.4433078863503701 -0.70693355794722224 -1.2944561677292103 -0.50777424664540272 -0.42595558036095837 -0.38457206394268184 -1.1422305483333202];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
