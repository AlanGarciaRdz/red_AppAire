function [Y,Xf,Af] = PM10Vallarta16(X,~,~)
%PM10VALLARTA16 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:47.
% 
% [Y] = PM10Vallarta16(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.12820512820513;0.00782778864970646;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [3.3005402916867341;2.4207696145840005;-6.5882338126695785;-2.6913900146223093;-3.0546060117923415;-3.2367923597719113;-0.38153771796007863;-1.3295460761623608;-0.78997227921001822;1.2066748292475096;1.0677107766910732;-1.3555645711031268;-3.4963826777339846;3.9958195934481155;0.64225379898703916];
IW1_1 = [-1.0370377270909963 -0.99797709121182887 0.68737269472750517 0.3791320199815964 1.7745999382380282 2.7250585874404361 0.028127469499266158 -1.2780240041295494;-1.2862762329245554 4.6893695656145633 -0.013671899212392265 -2.2935799930088234 -0.42198533392992177 5.7009240627000226 -0.18191381430468515 -1.7574341070396411;4.2033797402474233 -1.5443530828775207 0.69952204964117337 -1.2363257818532418 -5.5075867410778425 2.5904307201446053 2.0044354367468928 1.4777563817364847;1.5133287733808867 -0.53874357964453412 -0.54011038187330251 0.061203412154007472 -1.2706042357206133 3.4801893849716299 -1.0567225048244238 -1.7899335976424198;0.65677908457265466 1.2152377601818625 -0.30455388808914174 -1.5580523722542543 -0.2817671750952026 -2.1624014345595599 -0.031730317397059241 -0.13182949687118917;1.9971171093970808 -0.27597688478829219 -1.0057273807526841 -1.6840418355001272 -1.2496438695678116 3.2568591918627185 0.55195082729688161 -1.7872768944621267;0.49432517057547115 -1.8958700615017554 0.22442186486717708 -0.004106627105393279 -1.4598218148719422 -0.25623169415501418 -0.18492928862285019 0.71966482660407416;-2.1361297084580753 3.1133935915039279 0.25526230461957805 -0.55117215163320721 -0.51311878916731024 -0.70573870304843644 0.31493958523335164 0.1003554434030945;-0.7079739783409088 -0.7499049343306553 0.61991508236919401 -2.964397138679062 1.149637426709913 -0.89965131820709643 0.42580327230185827 0.60112358990998782;-0.68272089035136085 -2.2822967990481238 -0.20810374884403526 -1.5009575199275644 0.1590405374927237 0.61629827726059161 0.088089428761853078 0.99148020488896915;10.540454553042206 0.52841391988913455 -0.66188375214164064 -2.3201853635107503 1.1746621354104569 -5.8872793435346011 -0.31939174336621828 2.5317065921576347;-2.2137266741036665 1.2828260476336841 -0.93234630273538932 1.9908388735990015 2.1620735513225982 -4.6523499760368043 0.97318414778553897 0.39816358267939073;-0.36862041559947067 0.40119812213766132 0.83146304343495903 0.60513098418172506 -4.3828350371888183 -1.8716029146161064 -2.1016095509616215 1.5398150036143656;0.24691265344916558 -0.17762019670720536 -0.28419716418000474 0.36006775076624176 3.7773654072061129 2.2994304877116081 -0.061191656982055587 0.15152469392373577;-0.39852945921911498 -3.3289770368258793 -1.8317051312883825 -0.015620323984538073 1.8109356216413548 -4.1656438724825486 -0.90143013302694575 -0.66688835686615699];

% Layer 2
b2 = [-4.1958923358865459;-2.256058907255444;4.7952027332977663;-2.7412105872534283;10.727847487362853;0.6806710737696573;8.3362106409301564;-2.696109852275244;2.3170653674858293;-3.4492936980951141;-3.1387950829571318;-4.6374844390347807;3.5886636426854466;1.3032869225303061;5.2240104096720943];
LW2_1 = [-0.81692755837348741 1.0313902795122265 0.32792847994860136 0.35817980074325811 -0.96931454262444572 0.44121353220429538 1.9219192293068239 -1.2955591332847709 0.41960880172421838 1.3631624896170722 -1.033725030935865 0.30681611893602506 -0.092547306929132336 -3.4402029500322517 -1.9568746461104518;-2.8856822915777305 0.36053658567169988 4.1693405422412182 3.6422740566817615 4.9990275036686533 -7.1702253709969472 0.51948346600978534 -2.361156397494609 -1.7508124208649147 -3.0547314919589521 1.6705352955353754 -2.7980724985318504 -0.81849190458724286 0.50444960684644413 1.6691342461310383;2.4798602559526857 -5.2614555790676283 14.305848132587528 -2.5319933020944121 0.030108599144965852 -1.3732095596522824 -1.4256922916173429 -0.067680009093877169 -0.24905664846523312 -3.0203870766794756 -2.0805930348680071 -2.9008411758244828 -1.1184102395170172 -0.62930885729198516 -4.3458503344516943;-4.7638644558509204 2.7220867727145559 1.4616073750146774 2.943420184115173 -2.0380838287053287 2.2497496684406038 0.34668159456663589 1.646942779002994 1.3893716021555358 1.2352841957817302 -3.0255921169855831 1.6099039991580992 -4.0381610737233187 -6.8717652575754826 3.1488480528414478;-0.031798068196565873 1.2685019938309825 -1.5103074597149493 1.0932524721245642 -3.5875358848066754 1.5494938029921863 -0.63551952714373161 -0.67843897057659419 2.971087611775137 -1.8432951885449422 0.58562852546644273 1.8744077631646432 4.9704636589735625 3.6948428472527919 -0.22042901268191689;1.1544653336742223 0.029058596408140888 -1.0620528482423588 -0.43107716142795044 0.5753452697637842 -0.64666209753253145 -0.49610453968161083 0.51275138772341222 -0.67947485148357978 1.399005805882773 1.2473297808842374 -0.30958366979846497 -0.065550733705019473 3.6619775065914126 0.86278509172953466;-4.1926657552132838 -3.6466480979825264 0.36033213458926483 0.33085655318183416 -0.63783207952851939 -0.47787897036810362 4.0829898107179048 4.4139900294703818 1.2119671948902391 -0.91503577162070715 0.57446103041327812 -1.917748629244183 0.59719977902416255 4.3714811548380164 1.9033883116735375;-7.5906942779725481 -2.7373830346041501 -2.8990844258630482 5.3224133481215867 -1.0408588084124384 2.7396945712327256 2.6739541255696202 1.1537652443484374 1.5101384538698053 1.8128161352389245 1.9535614263480401 0.76438529551090217 -4.4072731664539235 -4.3999913859012914 0.34535685780311554;5.2214408555303864 -0.49699466975792372 2.1817568800542677 -1.0014493699578859 5.0903920633135193 -1.6676417653784263 -0.90172239961855449 -0.43769097347427255 0.60269091665766927 -0.87275681648635517 1.945883255650352 -0.06678707755165364 0.0091843986470700432 2.0940662031152311 3.1467212786860173;-2.9408984953593618 -1.9656958911721121 -4.3434375070387441 3.1774772230391002 -0.97915878588655936 -1.4430566364206809 -4.4174269125077013 -1.6521438691692039 -0.64750386739998078 1.0635772749089152 -2.5444514205804345 -1.0367321291253218 0.21941899620774122 0.21548982984724777 -0.48141727161131492;7.4810888245268901 2.6796913178629294 -0.16174597588504683 -2.7583689688422592 -1.3015852324139729 2.4195125276716758 -1.3874510058572642 -3.9911148844212261 4.6288520494965741 -3.1963790466042101 2.3904602254276837 -1.0909904761772173 7.522584423328083 -2.6750195658206284 -2.1548642710469483;4.8464565787757721 -1.9403444521377942 8.0091405457040281 3.8326100347742913 -0.97554383452654381 -3.9234853406442785 -3.6037511456586095 4.6720126106732884 0.60661828271449814 -3.2675935711557949 -3.3698522632834735 -2.608710064403529 -2.6812079811278018 -2.9347825480616865 -1.5466254241651067;-2.3835949446959566 1.9153060103838442 2.1743423195617448 -1.0957365585116647 -1.199200534175882 -0.60818399886576591 2.6840891491883037 -0.38419787893727814 -0.15666427218276754 -5.1058356050462006 -0.78934667329733943 2.2179800719609766 -3.3394810016491849 0.68059773552573555 0.40773531235471089;-0.45925858641158807 0.7394163673895856 -0.62841087332378565 0.61986814460310746 -3.1542768257683336 0.55518022027804692 -0.69007414902106201 2.1469175160929619 0.20058786382163307 1.6518623066155362 -2.3685299705343512 -1.8182243451490869 0.21821589913865397 -0.07572709733836136 -0.1473992596892825;-0.010587289131631525 -1.4910722096942604 -0.87845227778869617 -0.76941494448083336 -2.146630346788172 0.59808674765257774 1.5631850927179962 6.065516741036209 -1.9743782384223718 -0.80962528616092655 0.38880508691566001 -1.7091709145239875 -0.37876526819075529 1.8271178223419329 -1.2589121591835131];

% Layer 3
b3 = -0.41904988604269683;
LW3_2 = [0.14964238293970702 -0.03531472396354858 0.0095776806355679298 -0.01964445209633486 -0.092503570226853057 0.13752702631663463 -0.090658201826156692 0.0098741430752566153 -0.03867007547342427 0.10788442601568907 -0.028980912601398019 0.076301608867642146 -0.026276586480451832 -0.1572633367972639 0.078840022732911574];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
