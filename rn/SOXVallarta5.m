function [Y,Xf,Af] = SOXVallarta5(X,~,~)
%SOXVALLARTA5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:30:04.
% 
% [Y] = SOXVallarta5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;10.4712041884817;0.00782778864970646;0.0208333333333333;24.390243902439;0.02710027100271;0.00630517023959647;90.9090909090909];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.8877645792177322;0.6131037802652719;-0.55609196125101645;0.64588260837308087;1.6776253347660008;0.1522172929294541;-0.93123522782601154;0.62286704967544204;1.1290328734545012;-0.20194054856393132;1.582352603203133;-1.8590908432204003;2.0133396005153577;2.4021870651288895;2.6974196297405979];
IW1_1 = [-0.10784158762650405 1.78369961915791 -0.37080078768801705 0.37282112744909546 0.71426371111310683 -0.84284069785335158 0.092343989071419413 -0.4527713260808745 1.2863537928331168 1.0657432887897025;-5.790752661539325 -0.05605779454968253 -1.7635976850268444 -0.35168146796203031 -0.45098322844469213 -0.42965466855747753 1.196623287324347 -0.022584449666906425 -0.44988323979216166 -0.17755196616312993;-0.38241162117013167 0.0048478717015848823 4.8595290702062988 -0.45038756551649201 -0.95432559308585907 -0.48103025991533288 -1.63094618336488 -2.2709396132453219 -0.0051263220191496853 -1.5481051162590975;-4.0770885352765891 0.10734855304412559 -1.2058432892084709 -2.0212516276412402 0.36118686847870957 -1.5285285971581204 0.7932241259104531 0.44063061920533708 -0.56876816145627118 1.0075280761620451;-5.3992757771463049 0.065570085117773513 -0.14947590005899489 -0.62316677253270492 -0.057716436609487519 0.594547471307035 -0.24292335372982343 0.0075195062009581221 -3.7711036617878939 -0.46397813329467397;-0.010698601158841069 0.14330204944564517 0.74923493601570434 0.22447741438765159 0.26864139749245525 0.17130756273361153 0.94492043301521045 0.55143842624663253 0.41316251031710416 0.49421017389738559;1.1614791173612933 -3.2532926498622614 -1.7758104070472658 -1.1737079429256767 0.47240406829177373 0.14835351631958635 0.58516144424484906 0.37471444971465923 -0.71824359302019813 0.042776261929885984;0.39458440082997848 -0.13325180129209951 -0.61993019798546378 0.45763249745612522 -0.33896536299419294 0.39251595323596911 -0.72902405533037051 -0.75793380907469921 0.73092260912344087 -0.21454769448652342;-2.3182754375383281 0.01688170308553575 1.9314970906059576 0.015424053119552344 -0.79188451027127038 0.69416910326942072 -1.5826800134328332 1.000431408159592 0.53809914036455808 -0.50792018579292875;-0.6808691450258566 -0.26559862676262613 0.49836613438706423 -0.44795358568960614 -0.54788434867050373 0.59477109144951013 1.0530562170900279 0.062023840760783579 0.2893161580305903 -0.69309604320401874;3.847274066658986 0.087081838212048679 -0.73209724468544768 -0.41534209842745462 -0.62455401340157668 -0.93728880442563844 0.77136988228692749 -0.55687886108038875 -0.57601986047773102 1.3184676972491722;-1.3074740129240749 -0.31763795465600053 -0.05373948152688305 -1.1514768203633343 0.21276850493093649 -0.51696571462413354 0.14996366111478313 -0.50442696493159822 -0.11520005207735165 0.69116961398009824;-0.17027869485353972 -0.026197842635390885 1.3437103830758115 -0.020535942347259223 0.02576027442588447 0.13615027693858717 0.83543706147440244 0.085557860444173336 -0.0020798448860368393 -0.25877285858809085;0.64883763147934626 0.2161598252209056 0.69664400048295561 -0.64753824219984368 -0.30131262551984039 -1.2699049174459134 -0.98765013514037903 -0.10485714919064736 -0.57278425101651909 1.1579262340796972;1.048983489275551 0.20041241323393558 0.65641198540978585 0.5598035769675298 0.65074643147335287 -0.27589221524704188 0.12547914799012458 0.18670419381567011 -0.14714468488062998 0.51732657417106731];

% Layer 2
b2 = [1.1309907420104586;-1.6555920370114459;-1.2612411637521483;-1.7114758370332712;1.0983809289857778;-0.42522434292725514;-1.3551516593629358;0.018996166786482305;1.4911843451145681;0.35828395691220705;-0.6189760379614897;0.97464370782700005;1.1602735881372628;2.276478447678862;-1.7525314490075385];
LW2_1 = [0.02168618515121102 0.55465243648732943 0.048005649036108593 -0.11352787043798857 0.10083076742962654 0.52461790811963438 -0.092480905980091357 -0.33285057857671185 -0.27412138292810984 0.84729010116176806 -0.20130864298390425 0.25934803126847394 -0.14894587167076415 0.71071506107304139 1.2807569238451508;-0.59484591478388682 0.96114545626442205 1.4925428213052749 -1.6489787959096143 -1.1233714603342553 -1.1068435942403589 -0.63504910344010768 0.39635409813084149 -2.8772370864549139 0.40090041682714278 2.1208078639987766 0.21551661295178684 0.0003714819087974764 0.30237640995589266 -0.14030617629908956;-0.072017456666733273 0.71387590964958025 0.53171860594358389 -0.95949651105200973 0.56639858363501594 0.82533305547013247 -0.20851250474946759 -0.0015353978737279329 0.36164507625282599 0.0036508133045375256 -0.34030138615437144 0.45124293476731409 -0.72126503603273506 -0.26820198836157261 -0.36738085867092152;-0.059937812247253544 -1.1320329463391097 0.53701153277633284 0.95793622733915396 -1.2028078849968811 0.59079985198286444 -0.6764261368850043 0.30184191731307147 0.32812573189835775 -0.54804559997014557 -1.6077606259429693 2.0998246336856234 -0.043345380946874103 -1.1777801648393158 -1.4540927788810916;-0.041686404546277728 0.77850464406322262 0.396925759420442 -0.40712689987873008 -0.17968763251808406 0.39422504659620178 -0.065043364263429562 -0.24871037881853 0.023412663214294013 0.55360423055043528 -0.6341957891809149 0.55209389157240241 -0.17646799964363483 -0.35297117378222959 1.4831277967012224;0.59517768120215309 0.0281513768149474 0.80831023287850212 0.72308086287730877 0.37439041912436843 -0.66422267556083625 0.49017282760393321 -0.36019157351237691 -0.42635056921578035 -0.86270662535726617 0.16078891890928512 0.81171538280946387 -1.1539572744055482 -0.35071392239546401 -0.4555841463173434;0.68962499791830467 -0.89426595333421199 -1.4783344234862859 1.580043126855039 1.0973039658739849 0.011550772789911025 0.69821521880853843 0.72425039980737016 2.7804568663782883 -0.46797991747787504 -0.22603097400791958 0.053123041328459339 0.36994656658287062 -1.1707953667721684 0.23024224696597764;0.11732370264830083 -1.8034224052332832 -1.112352577720175 0.80867946198226826 0.49413708712532961 -0.41040431967369151 0.10946022919335931 -0.4685408219249792 0.070650306109323532 0.45780694510919129 0.85692810420239918 -1.1841628333627492 -0.036385778937215632 -0.35978383998420482 -0.6392257494978123;0.39310052177909116 -2.9404794225966544 -1.1229323046494006 1.3906717870653018 0.6328088147435309 -1.4025039966699235 0.56986926761365564 0.81064351104269294 0.2150221078220893 -0.4632440495856267 -0.40345679757392716 0.069644716906773374 -0.15188998693731154 -0.18538873059886998 0.28938831839611057;0.59668522644425281 0.03901511414519903 -0.80529472045537054 0.71320303922165196 1.2082553121702932 -0.32129976731111337 0.42606925615121277 0.80484015950523158 -0.82100276678832163 -0.37136102523909886 -2.123352215287269 -0.65751433353836053 0.14917495201284009 1.366261582811457 -0.34271315711170897;-0.70690200870120368 -0.09709326861081638 0.78024093201491151 -0.59197712978038886 -1.1996006485809079 0.62391897247023098 -0.51386000539175236 0.33241969945928385 0.66467419993650345 0.31062132431632006 -0.040461646257365459 -0.031390228635438375 0.0014446559443941735 -0.082960403615090494 -0.033204863894123193;0.45460082739430568 -0.19818336118794647 0.042727207709853519 -0.1777480007664258 -0.55488636023701554 0.31389143317465451 0.6764555322883582 -0.42639505591154125 1.0898459500387363 -0.5713630054624147 -0.40909380926044342 0.20811102350152766 1.0451443304343417 -0.12721208693981995 1.1042111942406858;-1.0034149681040079 -1.1388492753745405 1.3164258243907481 0.84464700392784064 -0.9024646767981197 0.27796968575796938 -0.68401877267514744 -0.15774266909218451 -0.25185838959139328 0.11900633227711005 0.51840347386521024 0.36049431988195435 0.11407481033812909 -0.63744187620368375 0.59463540428717399;0.2663018150686528 -2.5910559449025286 0.16018481339455096 0.13402291320986859 0.30421113023190849 -1.09638464612219 0.41651826633570244 0.46141766265992817 -0.73231248038677554 -0.87808669352375102 -0.4488330509496774 -0.0023496334424831372 -0.39172336376677858 1.0034348969566629 0.2685643706442743;-0.18144038710861776 0.23589605500329375 0.10894361156182641 -0.36508709221050584 -0.86855404168536043 -0.42508543625549261 0.31337983884321452 -0.45181045612928783 -0.056519247165177644 0.67893166381202175 -0.70645096685889053 -0.16540612121050263 -0.88300297567922081 -0.64846642997754422 0.026521295006215091];

% Layer 3
b3 = 0.044456176621312467;
LW3_2 = [-1.1195045526717537 2.061197598359704 -1.019083127658363 1.3319009052909792 0.49474914644349099 0.079709842628559957 2.1204895027202064 0.27615193068871136 -2.7233850571974609 1.4240485400258072 1.3825446684986298 -0.20338361643111566 -0.062880781732238072 1.7689129911899106 -1.1871028792287859];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
