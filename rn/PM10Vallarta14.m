function [Y,Xf,Af] = PM10Vallarta14(X,~,~)
%PM10VALLARTA14 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:47.
% 
% [Y] = PM10Vallarta14(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.12820512820513;0.00782778864970646;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [-0.63650427404439336;-3.1721374057846248;-1.8123313763911297;5.7869749839723346;0.11399030459915682;1.5137717797801336;-1.3133718467220108;-0.63951360296541504;-1.9687487131833743;0.21213976148060013;4.0982109082416951;0.58014968539421896;2.4410305438207298;2.0245819276021004;1.7492634710517851];
IW1_1 = [0.87264676604084113 -0.4546436692669425 1.2144366568084388 -0.45502345390453153 1.0917110775411196 -2.9017279638355911 0.25165684963710594 0.21640105142521163;2.2549605901086855 0.99823111222574534 -0.11293167928896485 -0.72744113470624172 0.4915470778534613 -1.8385205500327229 -0.053014770589413007 0.13793671332650215;-1.6210909955983077 0.71171570185819288 -0.93519328511453514 0.056782070800635853 1.4034103149187953 -3.0340058491550064 -0.091838193019199377 0.85296623112151304;-1.8127855907749901 -1.5490572252280366 0.42359022457254414 1.9690340682855543 0.63806158330181895 2.3111418674102957 -0.35820675066298868 -0.40662811529997622;-1.6487295545843743 -0.46158689347046655 1.2039713343658967 0.50301834979406046 -0.30343944812453089 -1.8747635565194776 -2.4926111235506139 1.7151930968561033;0.28110764492195173 -0.1722594769188521 -0.5710858498722502 1.3687596265329403 0.32555358935455586 -1.2913300164907182 -0.35228059299597925 -0.28830205188175062;-0.38322788895026805 -1.2929264581643665 -0.3699778897415702 -0.4462709296396184 -0.97356080505880238 0.98644363469598717 0.042403690069785428 0.069892520756667728;1.608630575631157 -1.3643236510306886 0.10816140000619981 -0.83429057753258629 -0.8188149619057693 -0.78938689616261437 0.19294528885660911 0.22324536984843177;0.72788089432377678 -0.60648971312126798 -1.1515820270789767 -0.10554279549649165 0.34647770608802764 -3.4349784009533173 0.64167054291545944 -0.55816439401507489;0.01179628150482131 -0.57362083016557408 1.1244794507224094 0.4778591753300564 -2.1673986577339437 1.0238692883507008 -0.23946280560966884 -0.10677145046674218;4.4986863326523432 0.16242537011002153 -0.079304253123215027 -1.2028412714344652 -0.40800993222710435 1.7182989950668821 0.032899544175454376 1.0832636320187916;-1.9316345897709646 -0.17922515036122719 1.0764926863705941 1.5362701982890141 0.069217647332895288 2.1227173411022107 0.36844570587968262 -1.4159733389623637;0.66740658707115952 -0.0049935004254032626 1.4715993840219559 -0.25039995671602377 1.1077587643119249 -1.490438345576871 0.46729156027945457 0.062369933945584932;0.034206967356071392 2.6969016647183768 -0.66274896707362474 0.31443976106553906 -1.0259801430220323 0.83804971755362001 0.18885421210612785 -0.66926500265866273;-0.78043424136948403 -0.38227470061540153 -1.8136763045278452 1.7776022962280216 -2.2691953281353969 -0.43164779044755924 3.7948334989377521 -0.5086829261607817];

% Layer 2
b2 = [2.5722513055962812;-1.2773565649428711;1.6108131182597498;-2.5590783617436084;-2.0063421921931384;0.40895793235594219;1.0964283651322135;0.21817855632209551;-0.34281904776123284;-0.70386438312086175;0.36424685331791568;2.0106571387574323;0.80099083969378793;-2.366697652783603;-1.3112901914977464];
LW2_1 = [1.899072631860929 -0.52022465180730904 0.63706831638324901 -0.89399489972197577 0.75023765218278737 0.93835452928896101 2.3988601969559964 1.2128126579398726 0.35291696234516401 0.33576864587868804 -0.06480311124293521 0.27267350417822206 -0.80281971580192291 1.4589832179832469 1.1484092113636224;0.5751391719997806 -0.64319802965919082 0.29607195643231271 -0.17388581882829646 -0.28838150443626764 -0.4987606887400905 0.55595960827489654 -0.46865554426957151 2.0166127614568978 -1.1013114689922363 -0.086742254781934758 -0.23274403307329933 -0.47411260318904985 -0.16772638773811879 0.40011500867857974;-1.6654597241463562 0.086491228052496705 -0.22562504420144597 0.2061199742698977 0.25092103468002841 -0.2981942932660907 -0.31510897381684444 0.54879317758990964 1.1893793679061881 0.44850961295264502 2.2081213176237253 0.99000457712250023 -0.65550519491406689 0.20634006368207478 -0.21482459891827976;0.70713474712020896 -2.5360617665804104 0.77811434338205754 -0.17512935864291221 -0.23089027218646466 -1.8509971735793245 0.060648841646336868 -0.023195169270108399 0.63118945835932638 0.83940912718489991 0.23250689768918689 0.5819186783172875 -0.056193960597403288 0.44696098636160664 0.77462460694318735;0.96858928330344485 -2.3116723361289893 1.0261452633537163 -0.24595404730724893 -0.72563519367905382 1.3011762402537981 -1.5163894504018536 -1.5085328817636687 0.78803166425358395 1.1138473138842471 0.82009917547743916 1.6035831645072305 -0.026711797413926978 -0.044517814767836977 0.85626589926780661;-0.44178261964499577 0.43580800467064618 -0.50952392611498576 0.48861680153485854 -1.4017659582145103 1.8099864892269908 1.0246773729206742 -1.0148526201527677 -0.33421185563547934 0.046721237765063456 -0.20694078053733372 -0.3612451046660462 0.15013941050192986 0.96956903806873251 -2.0749677013937973;0.79089168860227033 1.7514398066562378 0.40668036030621674 0.15876169396843495 0.1729624170016231 0.55612524816091047 1.6542068619486539 -0.49634794363471507 -0.34601031835437657 -0.19766749539688153 0.89116311391863023 0.97476155622199345 0.16298110883759551 0.66778352541881936 0.97336772737307375;-1.0187784549944097 -1.9223135423223323 -0.31308285205526176 -1.0935986469708425 -1.3791417344779118 -1.1406983996213376 -0.65039030433071865 0.42532657202934859 -0.40728522821368507 -0.91155784452236377 -0.1070164884373251 0.63860256129816384 0.083430140993866433 0.3482776561405736 -0.97443292231767331;0.91804755550244255 0.62090341186831599 1.6323680807435181 -0.37245577816533748 0.026276993944742505 -0.13235798094319842 0.95589180196042356 1.102672973983021 0.50173406148700828 0.55933893650168709 -1.1267617502934519 0.66726988214130356 -0.30481335939296317 -0.12113294578956894 -0.17967043403075728;0.42394213518730656 0.87275973993165978 -0.65088032209742053 -0.45851532673003775 0.11553360669534427 0.24581163790883895 1.2729588710209274 -2.0226692421778441 -0.15281654881183393 0.17493068128027045 0.37171888963844507 -0.4263920747665611 0.94221521890432702 0.97865336548919524 0.27075298875907505;-0.26927725110114398 1.2742062473107292 0.2450075253733825 -1.7151941967307012 -0.59502430824419283 0.20253134825521765 -0.46111697263440476 -0.6076839988764845 -0.23160078711108567 2.7828193470317402 0.048638220177786635 -0.53089038089713636 1.7337699944569818 0.089491271193681318 -0.046275689790787888;0.17506589559680077 -3.3016112081916003 0.23880668487094991 -0.90827464103714495 -1.0206695376530268 0.19455519132585458 1.7843387358481226 2.4599584111156307 -0.34415210817350189 -1.138023964275747 -0.039061306082476724 1.0902109617874831 0.23369222883235552 0.52516182557969437 -0.4806344579270867;1.0358280076982984 0.0574280124345104 0.47841672983888722 -2.4096992470744705 -0.20493082119710362 -1.1554101936439443 1.7739067742498844 -1.8873561342749445 -0.71823827225726167 -0.40083962622750186 1.1020520796271018 -1.5453014769051221 -0.49866430473835643 0.71441238600548673 2.0375605104227317;-0.59526163217966122 1.9246962438828703 0.23237292708858348 -0.21597155765885595 0.020034206124460247 0.50218939774726057 -0.82125548431155926 -1.8411883699437528 -0.053538924034620093 1.3044660854694237 -0.35990123383812261 -0.72324671816896391 -0.44583081845755895 0.081688759739074107 0.57962992715945849;-0.17395101862736401 -0.23824963944974337 0.039920975410493623 -1.9013428999381194 -0.97431566213564236 2.81449078532337 0.78560310019394874 -0.23334188732994726 -0.86999923227166609 -0.13175164190453947 0.061602682150416102 -0.28662643117224668 1.5746399769594954 -0.024576512888804164 -0.18530006899226656];

% Layer 3
b3 = -1.0752279265146503;
LW3_2 = [-0.30971043285268912 0.16968713430921764 -0.15029112571924436 -0.43207973284406909 0.073636274805382818 0.17419944586502692 0.46532310501979479 0.11614844546483268 -0.12407920684652317 -0.51273930049246075 0.32112620946447035 -0.29630575881834331 0.11067042123752126 -0.33434173929571487 -0.37518878813031303];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
