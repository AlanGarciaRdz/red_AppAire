function [Y,Xf,Af] = COLasPintas20(X,~,~)
%COLASPINTAS20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:02.
% 
% [Y] = COLasPintas20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.241545893719807;14.7058823529412;0.0179856115107914;0.0558659217877095;0.00576368876080692;0.212765957446809];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.9132019743552471;-0.73722312868431639;-0.75095577903996769;2.8137520927824378;-1.4696882901321342;0.72780743996989106;0.69058689647753846;0.075334617363340933;-1.2690021127452684;-0.39828908617922176;-1.5315478539092058;-2.0633421380080685;1.6987213359465538;1.8417571011266647;-1.6209348013975691];
IW1_1 = [1.5531101069105682 -0.071494373148932797 -0.61653819286786393 0.24340535534318122 -0.094636767307444858 0.18012498519193382 0.31372763314726965 -0.82018500923924076;1.5085918113187431 -1.8008203053694409 3.1065300739583814 0.81114777087014089 -0.75768825124551653 1.8834666776065503 -0.79323215044035333 -0.043100466399275054;0.061436604124566932 -1.7965346345476101 -0.40380467248887142 -0.85410999731749238 -0.21004742790812492 -0.84929738579315461 -0.036198469195117287 -0.18742365302786301;1.6708785725688031 2.6672496225270819 -2.2336837245251635 -1.4644518149971457 1.6818405056647423 -2.9138722100017458 -3.2391218396281443 -0.81554462025188401;1.4705698236461688 2.2199585158363866 -0.020474159550666279 1.8597141812481006 0.24589691485396853 -0.87799828756331577 -0.064437912511491197 0.37941459343943923;-1.3873666042378259 -0.044932910405920123 -0.48940703600920832 -1.1964458834380109 -0.1332685482230708 1.2392964337495842 0.28503997432971484 -0.19784357062049723;-0.11254097757837964 -2.3999914070426924 0.043371742241141674 0.32466343078342352 0.22969854898213049 -0.276923654126287 0.04556857558892196 -0.10613201933034946;0.0095258474088249015 -2.7909228322086133 0.72915097549841779 0.47302163626917382 -0.76552570391260955 -0.17297902537479587 0.050831970956969695 0.022025279680302486;2.4501497604282636 2.4324819041085357 -0.79976937818919103 -0.90569293966117947 0.37959374217098518 0.20022270864429317 0.17938366918893062 -0.050187752711174358;-0.52319582472047343 -1.5755229944055922 -0.025597333294310486 -0.41110831866702824 -0.66042597291451677 -1.1129955851591951 0.16483657117561376 0.064471805269089869;-3.2284827291307696 0.29400844296737083 0.29217363344395153 0.15667206386641491 -0.096755473073762699 0.09244047756901938 -0.15152905350778356 -0.27554457334828958;-2.3380930508773079 0.0040202396012019746 0.22753067538706545 1.0490938239022396 0.54236044995142774 0.57028056833479168 0.044512418545074692 0.07296888621637368;-0.9374073514147121 -0.3484618957817418 -1.3548596645756708 -0.39396859297513914 0.21662269991545841 0.95237945253965273 0.70869689929036106 1.306132644367235;3.7079002141141131 0.958038857585778 0.42802930536470218 -0.2020947253265955 -1.5179714641184439 -2.4738379220206976 0.95440219623631461 0.18840031908530391;-2.2385497420400138 -2.9346426272947763 -0.38275328810117309 -0.27350950947725378 0.69069289358575903 0.24800154487363296 -0.26406903375489554 -0.4919196437929802];

% Layer 2
b2 = [0.19578218334111169;-2.7043972057812811;-1.7155537967437149;0.412798614078832;-1.8290559201040155;0.82145997952529171;1.1266470110287345;1.1229473829221657;-0.95280537029595569;2.7413849600411972;1.0362233256169564;-1.1555170009547315;4.475565446316204;1.4468775828695857;-1.7613004253035416];
LW2_1 = [-3.2238932686227488 -0.62678719765071456 -0.31290476659868771 -0.29261052956907818 1.8011550453002028 5.2569265866695476 0.43955162087335786 -0.24403626935296452 0.038626947163436003 0.48368047561978778 1.1302969798683082 1.674287844269055 -2.2725754828467979 0.24379884923893846 -0.80850020981433801;-0.48634371328871101 0.52251318668426494 2.4250857048000118 0.88818719026906789 -1.6135024008420682 1.2386714248517414 4.544265659221292 -1.0558133053441343 -0.55376932191116768 -3.46229268117537 -2.2788962877354053 -3.2980845412241639 -2.592821658335998 0.5191336210978732 -3.4060852755677957;4.7584633710882089 -0.35109225745144268 1.4867314036171599 2.6154750700522298 -0.88500965034333645 -0.85528784086721288 0.39466248614491684 -1.3173591797333541 0.52668554076664542 0.69961020638546112 -2.2353437193990073 -0.6762757875961849 -0.94137577686992802 -0.72042412514953946 -1.7671825254952522;-3.1521048450476701 -0.54215475828509274 -0.64438014858610559 -0.71870909077491096 1.6992770258242809 5.1889983347161461 0.66101415780143813 -0.4418574038408663 0.20268777031614763 0.61008942245931841 0.024160397897556862 2.4870580920562086 -2.2458175100301268 0.28513677688536471 -0.47767730439015404;-0.75996180678250869 -1.1116456600707254 0.47308514901426618 -0.34194046060356836 0.49503155147308558 3.3736195996794822 0.88181444756887239 1.5414287732259131 0.81260542606889019 0.23466806809988688 -0.15225220956790309 -0.5556594714508194 -1.6534779031612534 -0.48005728446160723 -0.26799074368215547;-1.218696181328391 -0.046676762495433434 -3.0509650913737603 -1.0670017967601932 -1.4730620716210643 2.1680940956504462 1.1366850498640024 -1.0742113568263894 0.87897283382015423 0.98239270032244286 -0.21758662280291546 0.4293709570103002 -1.3439341689806676 0.21805844094451621 1.0165752066088454;-0.081580998749446715 -0.84608783641179985 -0.90323286126915525 0.47306792640803919 1.7092706389927714 -1.6838767652992019 -0.99279428177626794 -1.2634166302360925 -0.26663563719859246 0.16309688128517191 0.38942231114737808 -0.77986495483611851 -0.33153192305338675 0.17428211987179681 -0.12632810811367939;1.0472538674410821 0.59604607264543752 3.1459893682269531 0.91402734590109846 -3.4689766994834041 0.16693721662295899 3.5288191754772948 -0.72663288865902442 -0.29905810595730548 -4.3640778709221211 -2.7170059478085529 -0.19141939147696482 -2.4639728042914224 0.65349880180009323 -2.5028078837879044;-1.711994343016509 0.77871281824268912 0.2763044705662116 -0.71833926181228291 0.34907333361762177 3.0758125984306623 1.4213288000931841 0.24957250477818937 1.1069104961106868 -0.45106612366782423 0.37820717773231466 -0.58355859139743216 -0.79967414937058745 -0.6908735375212981 0.69490926602246883;-0.16840440150878461 2.7182985163176885 -0.68427204864413604 0.90313111846602778 0.52481548537929701 -1.3613248391035353 0.60587084349875442 2.7947053548305769 -0.21298385751499765 -0.8181427806099737 0.13264503701247143 -1.6536512961395708 2.5689415006070195 0.87029625939994537 0.5754954414956357;0.8221882681894197 0.31647701485654284 1.7804220509017588 0.73505847374122679 0.60803393476032319 -0.69223054372861614 5.089525072149562 -1.3343023201600184 -0.64410735974241828 -2.4564327874929255 -1.871418861669071 -5.0631375202772597 -2.913042996928302 0.41907485649535803 -3.9624185973743842;1.5205278835467306 -0.25474486677009023 -2.2402241718988476 -1.1085786168934437 -0.38820065078422972 -0.6345214315197224 0.60866431884849326 -3.1640045673845005 0.60030395286582194 1.4861200747754764 0.84733503209448158 -0.42277013483220838 -0.92799637054815343 -1.0611283964483698 0.58949022358387737;0.90920584335224119 1.8082404798926095 0.26285431108908347 -1.1632730275269818 -0.94111887961366569 -0.53192255161608037 0.264323184459407 -0.082001120763216973 0.592199002622115 -0.47625260649219897 0.053483148971803479 0.097709977510690438 0.82319380640159079 -1.0238575831662762 1.5100007015963548;-0.24243383837558885 -1.1089320660604374 2.5719320514635706 0.68165108192231483 -1.2607923277423663 -0.69283089735262704 -0.050321127349805414 0.68502985688878493 -0.53715307830862513 -3.2577343433198243 1.0901675919510101 1.5305598284763759 -2.3537983893587278 1.1892204589278965 1.1276098000879793;0.5747240978882312 -0.72888128330437985 0.75727329449711001 0.76129590361660116 -0.48944954798242413 1.1041962826900982 -0.94086215858433697 0.39964121442861256 -1.005213306253582 -1.2340378728304713 -0.11059942056948534 0.48637166097629264 -0.60496948573505327 0.80756335526933887 1.0882073918146935];

% Layer 3
b3 = 0.43467287657662063;
LW3_2 = [-4.7929826189760965 -3.7584073400348497 -0.24374976866022929 5.3941152965328314 1.7663344560532375 -1.8426014317006578 1.3684996960034579 1.5829210520362853 -1.0154890221063584 1.150157325921932 2.388565470085942 1.5780406233883799 0.48307267120978487 0.42058156043569539 -0.4029164646945686];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
