function [Y,Xf,Af] = PM10LasPintas2(X,~,~)
%PM10LASPINTAS2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:26.
% 
% [Y] = PM10LasPintas2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.0251256281407;14.7058823529412;0.0179856115107914;0.00280033604032484;0.0558659217877095;0.00576368876080692;0.00618238021638331];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.6581475374066619;-0.51785294812909843;-0.80700095123341675;1.9336933765938618;2.1637558770711345;-1.0380614807470161;0.38781459977286453;-2.4425331624126176;5.5760393370985968;0.34572539022707982;1.9985164981656758;-4.6512072446561508;1.1305688769984608;-2.024229625774169;18.493306839786058];
IW1_1 = [-1.5606912993637974 2.1137530178297412 2.2832128411290618 -0.62590028635818817 0.16369553852832874 -0.79934783289082656 -0.27827075327978712 0.22659130175123637 0.84536627237098638;1.2870423431908813 0.097704384605092773 2.5152036000821885 0.18897280157130794 5.0541890646538565 -3.7036287118191646 5.9708053119625788 -0.66691955713699846 1.7148582106157262;-0.10985041507493208 -0.69627045675530186 -0.99535190516645011 -0.061377435652267331 -0.71232183025131479 0.13103643085429234 1.2535083814106831 -0.20960574357005565 -0.36531334847783181;-0.12900984203785101 -0.25431924725672994 -0.54066593865024259 1.476337559596737 -0.37408686796898094 0.52952893054397054 -0.13933120726298756 -0.10597650454581589 1.9037396758715632;-1.5525968977367119 -0.23100332861662115 -0.62298203880525305 2.4941343513993366 0.037188236345831412 1.2853056037267534 0.72433242444554924 -0.21245647240341584 0.14064506286118508;0.95840273495830608 0.81069702762517515 -0.93318567808607 -1.656764777376619 0.36390017732954644 -1.1773702144032943 -2.5611830197258398 0.029336688812820144 1.996954543954411;0.57819101003233375 0.083532022885877411 -0.62574215030971503 -0.19578801075550281 -0.6728138933901483 -0.15317297943237954 -2.5384643916266443 0.32209641838727165 1.4292012819368234;0.98374370504094777 -1.2788494466874871 -2.0200700329399965 -0.54974631057508916 -1.104145561303989 1.1272493079247303 -1.0912377493558427 0.20705702614591148 0.12599023469122772;1.2035195263395186 0.87131462256962322 2.3520645523970827 2.8674019223556497 1.9054686765981157 -0.13478722069381321 -1.398378779411573 -0.16789302191353611 -1.495467070659636;-1.4592400562243157 2.4690176189487878 1.4541113362670048 -0.77821914679176407 -0.21290020912294458 -2.0150093820084707 -0.15510968978429363 0.34612750039570661 0.48850449134629237;0.2999163448949182 -0.61046316896625685 2.1890977819866353 0.56647794932388484 0.59252937969444197 -0.28014463603749162 -1.4229553239892119 -0.14991924783393665 -1.47413484833369;-0.14542541642091203 -0.90313667129287478 -2.6670520952722789 -1.8152379551667672 -1.815350959138015 0.076164552340225955 1.2075663226218265 -0.14917951278483474 1.5575170006943517;-0.79847793153743907 -0.22737550120147171 0.12419194089997969 -0.55967317504098968 -2.3693965541457809 0.23474216182262883 -1.3680493190576983 1.508245793821311 2.1071408366514075;-0.25135819036225904 -0.64527087746460865 -2.4156300981469232 0.76140591563220461 -0.40062696118758201 -0.18909885529942333 -0.56572307517319698 -0.23136242619708849 0.17943542134809193;1.8605793963954749 0.76997479121929191 -0.37818464823823594 17.269253322550835 0.56154773245335088 -0.72868170689329792 -0.48100691183944716 -0.07255939474543785 0.17364837230205432];

% Layer 2
b2 = [-0.70237276091502299;4.900960180357206;-9.2031962242253762;-3.6446689251570588;2.2044669461827882;4.6702327802506058;3.4926309992722024;2.6729649037558421;-3.0773825297658104;-3.4442740766007724;-2.1912939639091715;-0.18260934496901238;-1.3537487360828064;2.2122257697424055;3.9551154011300489];
LW2_1 = [-7.2791652339899056 1.5389625319162474 -6.0502632679097994 -1.7256621167683488 -3.1527265010833099 1.2196717519492317 -1.6694953275162727 -7.2105328791187695 2.2186071679947377 2.0226672280528586 -3.2986516674442812 6.9594401520433324 4.5559215926927195 5.6882238323214196 6.9741423705696945;-0.81426879539722008 -1.2431218174663439 -2.4227733426750944 1.1517484693650231 -0.91259882612097931 2.0843103670313057 -1.4887630462975474 -1.6090576013073825 3.065094178099331 -1.1017785435809293 1.9561897042028229 2.3692240630167354 0.75482204440249778 -3.8522460972508052 -1.8061793442745744;2.6355127929468352 -7.2952267728608637 -2.7967236361167731 6.9475119960329064 3.7346036010592383 -3.3374393211950797 13.946377145466203 -9.2766329548952768 1.7041069820454535 -1.0284229904780087 3.3638325576055044 8.5245730855331843 -8.8239965355521957 -4.9001143658601576 2.365545833891995;3.5327222452836571 0.48876656261893586 -3.4065455272264109 0.52858253082953821 -1.961659743642967 -1.5411974929681214 -1.0942082373834028 3.3358469188174742 0.72125472128785539 -1.1277067020108484 0.15936167746425092 1.2342425011477418 0.39290501342399842 2.4481198557506647 8.6642532839607771;2.9337727222456107 -1.2700503272908732 4.8081608121618231 -0.15579945740926796 -0.12250476542060093 3.2268727131250747 -1.6825682370981325 3.395740782810599 3.181272087779587 -3.180095646330241 -1.9717964862688433 6.1615412758577843 -3.2242165299280638 -3.3812686256877544 0.1178002452558566;-1.5391338093118385 -0.41150658459867329 -1.1877264099040439 -6.9704388145214775 4.9138963918951184 0.38894438697898626 -0.59903336294209431 -0.41706990388699966 -0.27537491286166893 -0.35011255959685827 -1.574629633649921 6.0245737619519772 2.4076374557226505 -3.0624667205209111 1.3876787344545576;-1.6648790785346899 -0.21744044263143095 1.4292844178949151 -2.0056132821046506 0.77059945951614028 0.78293321200590371 1.9997311074269257 -5.2199137661501451 0.26099112485647247 -0.43732932860667695 -1.4964302233192575 -1.359660005001929 -0.022895631007994438 2.6605274925542601 -8.6531876425261185;-6.4426037397465361 1.7045514269631048 -2.7048815640726023 0.98996721742792471 -0.082967971451926886 -2.8322307748839348 4.8503850517533547 -1.3141549959059839 -4.6954956512471293 3.8397686523220496 -1.2577632306284854 -3.1139896346822971 0.83524541536708541 -3.4580216368520791 1.5225618020295113;5.7834678749964636 -1.9325648246826213 -5.3315115615110882 -1.3606016713312727 -4.5096486990102074 -3.6136318458210166 -6.1856761608332551 5.3451452214487034 -1.1134092093774766 -3.7065865513082894 6.35494116772563 -6.6637979447050828 -0.20777425700764846 -7.5782306859102508 -10.421767854501873;0.57629716113828766 -0.23824312658321684 0.36973790616436658 0.6127954895671236 -0.15783880152245547 -0.25617100775854112 0.35907501545591014 -0.13311406861656558 1.3462979331040987 0.082718090463546959 0.58703753135609937 1.5307723822264507 -0.1202240520599703 -0.54157684064278877 0.78867908871430259;-4.061094857702682 0.064273160598415466 2.2353380078578602 2.9719661309016083 -0.38868367141222687 -0.19092241843776039 0.83465184274102433 -1.8119614034650455 -2.6189659968637686 2.9568694156365281 2.7261630352326338 -0.60478513923348565 -0.97054164165659407 -3.3260071223801519 -0.16089281311508832;-5.609223587480451 1.0159603371906725 0.23421784928484818 1.2057590031085783 -3.1146063460168141 2.3333645093169846 -2.4776361456673111 -3.7804567813344341 2.2448025307635029 -1.4302049022101415 3.3607426287550708 4.1791006672639757 1.1661774729097723 1.4346497043959321 6.3021130726929595;0.27330803053312536 1.7674720010486398 0.47725794846077185 0.18301593614359501 -2.2371861414469492 -3.5251436203797342 3.6061214808245219 2.7855621533789363 -1.25435284229125 0.46698098055263354 -0.066566502203714947 4.2506383324591406 0.64003367535045863 -6.6619374018417439 0.42837167019079248;-3.0185904682791569 0.25411610442564747 -3.1982516151017744 2.9184782817688371 -2.3259767824912525 -1.8725868014592226 -3.8006865144521824 5.5980252645630966 9.352459431112166 5.7058426905707842 3.6331960811109196 4.5636042050311287 0.24062247130090994 -2.6919107158132762 -4.6265430880306404;6.6978412425759082 0.36233953594163115 -1.1238115800217847 -0.20082926633937881 -3.5661862929627488 0.61609366325871961 -0.67009852945229564 3.4304852104879955 0.64011945030935868 -1.0748996350355826 -0.49178860136197161 1.9937531960838157 1.4457046757336587 4.7977073137854926 1.5408853814533827];

% Layer 3
b3 = 2.2290076939178891;
LW3_2 = [-0.033252414410267918 0.064221116859018421 -0.02741094282027878 -0.072350629960923271 0.030735391304827442 -0.063147094527177761 -0.10016344143546223 0.023133949796982113 0.01752823971513463 3.2289347255957814 -0.11022908760204658 0.050702708954921856 0.050438924605421084 -0.073757001732355998 -0.047277474844182175];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
