function [Y,Xf,Af] = COVallarta4(X,~,~)
%COVALLARTA4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:19.
% 
% [Y] = COVallarta4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206;0.201288244766506;0.281968137600451;0.290275761973875;0.304971027752364;0.100381449508131;0.172786177105832;0.171659085057077];
x1_step1_ymin = -1;

% Layer 1
b1 = [-0.94809487527304592;-1.6231361081431444;2.5810007355042868;0.94458454223833366;-0.76217618275999865;0.5585314796247427;-1.2630524763046611;0.083913596381341604;-1.6500949128052476;-0.69166013430840279;0.5263692450057158;-0.43199624710302764;2.0322516284182157;1.6846570033322108];
IW1_1 = [0.035361526855944507 -2.0404394836059723 -0.19497236997166786 0.027986419980172879 -0.28477431836029177 0.3443953368464861 -0.15541392266403731 -0.039826381177330041 -0.024896807194586354 -0.13170175806311718 -0.021231044152139205 -0.057688767521477828 0.41577781032602157 0.052093214217500287 -0.37534069484365995;0.12397976782815509 -0.61760611847854319 -0.13887689028885414 0.55643379362321754 -0.60408217436660527 0.72111806475222495 -0.20583275461771178 0.24925597877267297 -0.27171088538445703 0.33115766336131275 -0.18002656420319388 0.29580356294477311 0.30621186703870246 -1.3657913942193258 -0.10463344380866686;-0.10870782141175621 -0.34605614238911331 1.8003056370994033 -0.030716699118119948 -0.45649008178125605 -0.48555716535446097 0.04881173595540006 -0.02757966977466433 0.75582399128387878 0.38697340966439864 0.20347361854706097 0.17539592649242611 0.38037156529511967 -0.18769307407889926 -0.24810309734306893;-0.9078134482761564 0.48469346723646689 -1.2944616630115944 0.094439278870948634 -1.2196585819963341 2.8527006038744083 -0.19868238939012575 0.29475998874633763 0.084002558716542303 0.10385998530507673 -0.51137388226530278 0.84752624881242999 -0.2158880701703528 0.4906964958822092 0.36757349040315485;0.50280619103530333 -2.3548744193043056 0.70104128483017514 -0.29219135582525502 -0.70658573362418564 -0.19344338760479682 0.59407857038075029 -0.10594263124889225 0.018006944344828878 -0.090281580868221994 0.51890008137916832 0.16766353871056017 1.0315829380670296 -0.92890577715801737 0.16985772028877247;-0.18751260884603449 -0.83565447545778937 1.7734932731137492 -0.10532524838490211 0.17929867313217757 -0.90123460186722681 0.6129818612518364 -0.33680381330751341 0.45898732450517021 -0.54972420082231577 0.4273770420216863 -0.1556395954080918 -0.92503540795382366 -0.48588408753802642 -1.5337771045946436;3.3361102938744809 -0.31559821931606979 -0.11963402254146328 0.032012182570741815 0.99684744086453747 -1.2770894454689843 0.050588961152905079 0.0014139331788778995 -0.0086654066860379526 -0.13287555832994197 0.37225738527375679 -0.192569577848544 -0.15211191724266473 -2.8372685764002283 -0.01356820264684858;-1.9411799163639505 0.23361923319420325 0.58811791738461328 0.39759118715662384 -0.28465630411267884 1.3946220375059672 -0.1358431564186024 -0.39672480800219645 0.046494300995831843 -0.40713365648151734 -0.54467985347082915 -0.03870601257337751 -0.33391333423724112 0.30223036058371622 -0.50717634929659616;-0.01041256354904968 0.32754992385339293 1.1647642907492848 -1.0397389108868091 -0.68678181798860938 -1.2879439363084546 0.28974096989552872 0.14510166677156866 0.36082534046251297 0.68694221365859998 0.35381260775284262 0.32349008223671522 -0.12102226627229956 -2.0052550125617072 -0.89265313102012023;-0.69160836114533586 -0.46167527581013129 -0.32155687756909679 -0.025326280448287979 -1.4991620434741375 -1.0892130541675402 0.017514847911577987 0.7743937884609049 -0.25696640299381157 -0.3601026204424288 -0.42082893934234578 -0.28040234990062668 -0.20469983352285542 0.59172087097921977 -0.22716045940767676;-0.030738813783955751 2.4418422700560534 0.38863263752504007 -0.17046473399290593 1.4146853657775549 -0.98947275468323148 -0.09645410750984762 -0.28378795436990462 -0.21229546987602463 -0.28677555967166224 -0.0071266477087481876 -0.39680354014337166 -0.96255225906534203 -0.25114402228267513 -0.047225913215759863;-0.10211181805502033 0.64108573778976541 0.16365721524035595 -0.31133705381475907 -0.10005956316220942 -0.69043086034239698 0.41128835293165922 0.1714792373233113 0.17567844305460506 0.46416631605035036 -0.042505758598450988 0.24679327175920465 -0.37668121297093005 -0.69702302345949374 0.11889209022455977;2.2992303434559758 -0.062000940937865276 0.21164668787397006 1.1454640747188054 -0.77688512729534565 -0.30004103136799987 -0.17946670367231035 -0.12151739596652424 0.44285318645616573 -0.20513126266899726 0.32069485009851828 -0.84360732156662388 0.55727941312019158 1.204768898566313 -0.70352524768798885;-0.88055124888207981 -0.76463648015180519 -0.19035967016602207 0.041957920793493801 -0.52386387331490714 -0.97372638767549513 0.14449238672385564 -0.29057585892278381 0.11382444720223824 0.11144540429753967 -0.26409010304989289 0.40462867668792529 0.76868688847056577 0.3134656431616622 0.80100523132603585];

% Layer 2
b2 = [2.6188363217798849;1.6962929737025871;0.29915116047272083;-1.9388026859964504;0.61531936137897592;-0.22090220086283396;0.9965468596481728;0.90422958241758855;-0.021336693746381266;0.43561348208347261;1.6784557846348338;-1.2099683378493176;-4.770886328640791;-1.2949882518046976];
LW2_1 = [-0.77403705515699706 -0.22853223263890332 -0.6270759584257557 0.15948150949850542 -0.028432229545690663 0.75057353724562803 -1.7876399069348863 -1.5783643209462248 0.32088009546128066 0.83989871092299651 -0.78022567703137635 -0.60600145942834227 1.1696689341876174 -0.66704941265314366;-2.4956514785218515 -0.93494598846019139 0.54190448154698645 1.4863381695574698 2.5512532004033455 -0.16047485013208271 -1.1193660533813559 -0.3274266915279504 0.26675870880411506 0.67146953207941262 1.0050182443154294 -0.60809015271242273 0.2756802803459501 0.52922624718414646;0.84716805703645848 0.5278217357167091 -1.7606560092042665 -1.6796365363309425 0.62585654991220019 -0.57774275377765105 -0.38414236794402357 0.74715636080173098 1.2317618768882179 0.33270963450095958 -0.46241240045438586 -0.52073471031956831 0.22152441929043246 1.0621459979640304;0.33858165049705591 0.50241269280478895 -1.5081675437035236 -0.82591637772185567 -0.13067541549530837 0.19759274751507061 0.34058339273135457 -0.94924161989924816 1.5362070709728857 -0.84994365269222982 -0.10575971306622342 1.0565750319870519 -0.8297535364809524 0.11856562695345724;-2.5267959479085347 -1.2842662763997614 -1.8546652504861794 0.72754750245378219 -0.88419382578985184 0.10340579167353187 0.72076704804015945 0.28391106379194758 0.93805871057682033 0.71335120276158315 0.70652247464081619 -0.18118278149306005 0.34069808602404328 -0.84456569263539627;0.43455299551439741 0.23585236967759127 0.55496434607645528 0.77657203511412831 0.40257658987013423 1.0867034861939615 -0.18853408647084849 -0.31196853416343073 -0.54637065538821339 -0.47403396490746841 1.2391927294898537 0.65248449215503834 0.30189826778646583 -0.70380725041399572;-0.96885680279765929 -0.66229982697429923 -1.272775433985726 1.1337420421892093 -0.68152797646093799 0.75675762549920311 0.27345044497532073 -0.12135213199021816 0.29955235946650488 -1.0218346017722173 1.7589329024525999 0.80583186648590344 0.5323971857558899 -0.37276593616720927;-0.49771412235763396 -0.074470859352483904 0.71201340425514048 0.045915285774686267 0.91545986725643202 -0.69947131815575447 -0.77383188424472127 -0.34417763430354659 -0.27347221299597985 0.28401624401454401 0.37440774071079458 -1.0324468456261111 -0.51530847773646471 -0.063105274009778944;-0.45345721632274261 0.12971516522190552 0.03343978441850845 -0.40040869904070164 0.042752102809851436 -0.67785813453063848 0.29968890826090844 0.11014378435836776 -0.17696446487824422 0.52758175150832187 -0.43695555005848069 -0.07193775677097225 -0.37253553197142225 0.37403762314762673;0.3798225139738291 1.5856172414676319 0.040598271212905768 -0.46270863619553115 -0.43907610334209579 -0.68226044436819744 -0.83483889963014113 -0.43346488130850858 1.1442118332964399 0.74428173987555957 0.084469047859240989 -2.2171276531058091 0.039815316513193866 0.74308121208420652;0.43923456095618452 -1.0251264247563769 -0.079611412975864493 2.5466957270872506 -0.084999364022804683 0.42284929316917341 2.3715773046810913 -0.2742494885058267 -0.98899170566917249 0.37143412812777288 -0.40410387462765995 1.5962317608790855 3.3081781938038239 1.1570983783539526;-0.28054988439064976 0.032235932409607169 0.75494869940477394 -0.77079243469138081 0.8842670977884024 0.75015607589050515 0.41734054289696371 1.4803953329802877 -0.70238021201352718 -1.3511563501596204 1.0537709113201861 -0.60040073135607797 -2.0131186394794458 -1.1664621479634023;-5.9200491296012272 2.6767407870346243 -0.25574182299861264 -0.048616020282903842 -0.81412999722917045 1.6144446699303883 -0.0066811177978332026 -0.68621329971487122 0.26671014352308531 -0.28850184549412528 -0.77560658128799731 -1.8036041507445815 -0.52124399520303166 0.49428428479015296;-0.21048987162181662 -1.6992091770027908 0.3549240085825584 0.63267977115382845 0.60545231522918741 -0.44892129846750017 -1.2853801193229382 -0.50693543692658516 0.97478867229810939 0.031186202054852216 0.13115956627674408 -1.8364285660205153 0.11359916242804782 0.053558569320473676];

% Layer 3
b3 = 2.47520292348071;
LW3_2 = [-1.3614947015978458 -1.1975749868222774 0.23190466020321418 -1.5309973133093076 -1.6330655912260101 1.3951250115248135 1.6129751258628569 -0.77667300012622964 2.188105391798715 0.2235692582134754 -0.41549202584721379 -0.72988570181074153 1.9290712046612644 0.63928377017995786];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
