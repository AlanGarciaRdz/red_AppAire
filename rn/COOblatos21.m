function [Y,Xf,Af] = COOblatos21(X,~,~)
%COOBLATOS21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:57.
% 
% [Y] = COOblatos21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.100381449508131;13.1578947368421;0.00618238021638331;0.0205761316872428;117.647058823529;0.0560224089635854;0.00600600600600601;0.158730158730159];
x1_step1_ymin = -1;

% Layer 1
b1 = [-3.9469790871727883;-2.3929818744628819;0.88266151238997737;1.7110258207774931;-1.5469625663013535;0.76787724922837597;-1.2129575418938359;1.8013690032277598;-1.9053312567763445;-0.46546245806981201;0.14116624018361051;-1.1680101448296583;-1.0951232212257691;-1.5280746735871815;2.4883858164397901];
IW1_1 = [-4.2673411012635203 -0.46827133285020839 2.9948180466005017 2.3059778825180852 -2.921871477403267 0.12394862863780046 -2.3482993065545004 -0.4717699681339006 0.12055573331299524 0.66911569704144858;1.2314324774508059 -0.974788543690146 0.91039933793403527 0.56059220133701926 2.36050262679443 -2.5625550426320345 -0.56403097473440766 1.0871125642182577 -0.64415702814725262 0.981346117477915;0.05669365943516861 -0.69698111533045726 0.25424560496174686 1.7278633015488667 -0.0043472906451055907 -1.0288591629762143 0.41677456125693246 -3.1608472972256476 -0.29419876079475921 0.62789626730490466;1.0100331135032969 -0.038100875876566118 0.80744018260848116 0.5303589503259265 0.99242894088157407 -1.019241680493004 -0.66989982466351827 1.0058399763449852 0.26025339406166387 -0.49415519708283362;-1.8497727815780396 0.69783316849723598 1.7324678244188965 -1.8203462293018866 -0.0092610826102392865 0.85122227615824753 -1.7572326062738892 2.4308228335650681 0.43328815851257985 -0.035471792622593819;-0.62502966379070557 1.0266448147915699 0.56009817981783616 -0.75588719461721765 1.5256022107209608 0.17784893924890199 -0.92273789892042235 -0.92012924505319404 0.33380542070127833 -0.2163539419142011;-0.38110452512368309 -0.79257488461989523 -2.8554940663222101 1.0342835394309295 -0.38752602905387851 1.6679581938625831 -0.26005960884536211 1.3363042746820315 0.074948496711575302 -0.22266144694389328;1.8752372281764125 -0.23733521994418624 1.3686381177200355 0.25991502198444771 -1.6051381219068788 0.20668097630079221 0.55092082038748702 0.91476585763443674 -0.23678065266086012 0.34563646722433028;-0.96965045464432364 0.80517018015841901 -1.2875733574749153 -1.4169343559631831 -0.085211683289233703 0.032020170756151545 -0.099845523080813792 -0.1671934043152089 -0.068299235111892218 0.17771939085747243;0.38876662418402141 2.4346458556502379 -0.43072487712330426 0.49491485179215483 -0.56153914165467822 -0.86323005284811483 0.31429424833753072 -0.7684843983681855 -0.085577799201272758 0.23697895132467534;-0.26798825848466995 -2.1977718592260556 0.94685883347985811 -0.77640818066687756 0.56315353449109373 -0.47442235856848325 -0.57638287561217438 0.014070466094498003 0.23540068971792877 -0.15101286106736461;-0.56990009437642919 0.26507528381242046 -1.7179020274649366 -0.45177092519354817 0.092797589785073964 1.0177321491620692 -0.03891359809748899 -1.913102073354624 -0.20854395544481585 0.052168935827083429;-0.44810498340707922 1.8510522211333773 0.42083282675853162 -0.10349942267529319 1.115159673570707 0.10665882035854087 -0.65904530446636711 -0.52063231688883715 0.37095076135163174 -0.32503944142323854;1.1131372054329474 -0.51929866152457693 0.18953324396006616 -0.45019680290346797 0.7024869465371989 0.11051251702562725 -0.26967955060998466 -1.05199567627084 0.25443636187791246 -0.34851817036242105;-0.42956205949435722 0.30476302809379086 -0.17594012281470567 -0.19218627653315287 -1.040414784992981 0.063562964434749097 0.94773628091127793 -1.9826488634928541 0.15729734612841806 0.082707364472652867];

% Layer 2
b2 = [-1.8762010290524107;-1.0381962625400554;-1.1005313718454348;-0.45858949489943457;0.49013808910421047;0.34869005127703995;0.15105425901932407;-0.34174035504132355;0.64700683734535203;-0.16511594910425331;0.47829864197430916;-1.5919117899747131;1.8714631364538152;1.368588734673517;-2.0696131433091987];
LW2_1 = [0.18662818751320456 0.27181678268168402 0.96803745259849583 0.40340974372234883 0.28898316141455721 -0.37427849363293275 0.28669755937005459 0.61564542029720437 -0.6160874269893355 -0.59367736129470172 -0.74855828574616856 1.5741416819338192 0.4724184284630592 0.19439359041221174 -0.66401557377513309;0.1758308818249929 -0.26494860222810829 0.037029524555986557 0.18746158810626631 0.05457710619828849 0.16624725406704777 -0.34092357420771058 0.2672830613867449 0.046815671990992049 -0.34182299433458485 -0.039652097797370459 0.24820525325189166 0.42888532655966594 -0.22429610635785802 -0.26455195847907509;0.10111818545867376 0.013266003627035368 -0.20726050824920117 -1.0577664901810406 0.41436966378580825 -2.0265229495221906 1.6993861692006047 -0.025257309286686527 0.26028087245894999 0.69748051725170812 1.7536237548745304 0.25095343828589856 -0.1983746177081547 3.0824457283931657 -0.58051732244745391;-0.10685392099610064 1.2709338930780567 0.69446144530576215 0.21553247653138249 0.9070315027639535 -0.55869586387176784 0.35879399545928253 -0.70147137336656595 -0.72217946715382852 -0.2877012405617228 -0.82018400825321658 0.96691430546941204 -0.59028577834800799 0.92301728239639425 0.78110819476046411;-0.53658620845957272 0.73549646831582938 0.75092677833127941 -0.77164088792565466 -0.3986825735530245 0.76535868658563777 0.69782132200499658 -0.012017362540618456 -0.36831528896898924 -0.23583260839640713 -1.1025946488703111 -0.18584268481557084 -0.10470662106306226 -0.70125474522933107 0.35884952337837334;0.11947632085268586 0.58652347952101358 -0.38197679664637652 -0.29365743604352801 -1.3595599517482515 1.8453560519415781 0.83049309689281481 0.51703177641210341 0.75034872628993654 2.1507637776306039 2.1983623992777783 -1.3658879238117774 0.01687918868957541 1.137733553878443 0.32224778363055673;0.30101830051326861 1.0895951108302644 0.1037161307638258 -0.56538451142935386 0.79143900041311221 -2.520058922026327 -0.43847788720431558 -2.3815076657535998 1.0785382359795432 0.76073843886137948 -0.0003554983858315465 -0.44089051460082079 -0.46696809552967322 0.15281763032840662 0.3890734741216576;-0.013247713806120668 0.20287855370114966 0.97630759526319 0.5335656421262851 0.82343654393043009 1.1714130945205579 -0.025331923220115585 -0.40095300469681455 -1.3063080508516229 -0.14504183361814427 0.79334573585245849 -0.14946675748516866 -0.5224639293079596 -0.53738906381871787 0.37458098641549686;1.3430653492106974 -0.68755961968766421 1.5211818166873914 -0.48242625384015686 0.14822873147194932 -1.3801870809788164 0.16054608957354108 0.16834601045902425 -1.1575920552222698 -1.8889654765618888 2.789838063760969 0.3148141401427933 -0.19760724999019813 0.11693196153452895 0.39949062043497052;-0.13137116171285709 -0.045725798913638066 -0.24629354517283308 0.25591538458733798 0.46916428495952273 0.93649695705809 -2.1146336241718555 1.2651606286752588 0.85710241980080226 -0.34050401752163639 -2.8300793549226277 -0.62425430271306592 2.1667258291779459 -2.0981606042756353 -0.4103077287908235;0.83367500607073808 -0.8085581074579935 -1.7410455329640291 -1.5775779460444332 0.10456172876372768 1.377008299315144 0.47934798890453018 1.7337899494854072 -1.1081300912050958 -1.1157341307818085 -0.335370353769885 0.11491470529536593 2.0080842075819558 0.86923964460217118 1.5054380632063338;-0.027906644338680835 1.0764297331275259 0.45402656717793943 -0.62413035802365147 -1.1060646100127891 -0.6245165126255311 1.0002072237624173 2.2171413103843922 1.2837778569856217 0.56778755930411207 0.5261012327243394 0.37779044883957252 -0.1394778346376383 -1.6942568686700699 -1.0670420470089363;0.049441581985872771 -0.66233183156146058 0.19893943409358164 -0.87204796579139232 -0.30594464097278729 0.63492054305168788 0.3844958119233351 0.15437616299548837 -0.11461599389686568 -0.12321015332917645 -0.4074856696072317 -0.13149116048198217 0.68359779376389684 0.20558116515670341 -0.68521648618243913;0.47737772788800104 0.94444238558303717 0.86704065836105892 0.27632051606106856 1.244756601684724 0.81271070311345239 -0.11209232784635401 -1.3113521076649801 -0.91485975994105484 -0.79308046572831703 0.81837550205511256 -0.15458851127369283 -0.71522144180786285 -0.84252345966835529 -0.053476543459152016;-0.11038917235847318 0.71005831963704213 -1.8287457699437737 -0.52825644489339985 -1.213489432256172 -1.0302985550017372 -0.23277462414761252 0.67951600739382678 2.7606861192609018 0.093025667035767687 1.280518602374078 0.59575420584624261 -1.7384211921421564 2.6976760181993527 0.20790435339633215];

% Layer 3
b3 = 1.1674855599039522;
LW3_2 = [-2.1032672038592652 1.973384953401903 0.27311616725014581 1.2761698607104086 0.8584069921584303 0.18873892803983291 0.43004052933512726 0.49362111834890077 -0.4381874408363019 -0.315564404213518 0.31406330051314163 0.21658626098832515 -1.5789746937380229 -0.27850059111542175 0.18372336612663076];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
