function [Y,Xf,Af] = COSantaFe23(X,~,~)
%COSANTAFE23 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:10.
% 
% [Y] = COSantaFe23(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;10.752688172043;0.00341273633199099;27.7777777777778;0.00632111251580278;0.294117647058824;0.448430493273543;166.666666666667;95.2380952380952];
x1_step1_ymin = -1;

% Layer 1
b1 = [3.3184481548818319;1.1697485668635645;0.858602896840296;1.6099981804649146;1.6433836473170982;0.5490148109168046;-1.3241723252948965;-0.81755291293993926;-0.064182976650649454;-0.13551603510406618;-0.29377116290045646;-1.5409579240965938];
IW1_1 = [-3.2479523678178563 -0.8647523610160156 -0.14102872657733848 -0.070508293440023406 0.4618491015234118 0.065135530940752251 -1.0848002238513925 0.068460348691278858 0.40716701889967144 0.96813363883153358 -0.11506736617577187 -0.15637483712584097;0.68498849364079195 -0.7369230822751287 0.36161635142906468 -0.071768717734359583 0.047620767696496716 0.73809824158970583 -0.0085017220166917484 -0.080257753231701132 0.15166753707870939 0.21926638342322952 0.20622827454890841 0.70631272179247284;-0.46838032159311727 1.8307908416856391 1.5530958881269066 1.3989984389432102 -1.204448613431909 -0.68149699724806878 -0.74838033974633822 -0.55996876959110153 1.1858093674479264 -1.4389725021064974 0.59430629916024313 -0.40182734423501876;-0.34930303302070964 -0.022710333413060717 0.06473884700642614 -0.59698459908158819 0.0077702530249960811 1.0560734605472917 -0.20650197502248085 1.0812215318535503 0.36984065434787544 -1.2514658003311387 -0.47172989602511023 0.41483455752914511;0.32294840990233648 -0.8779661103042109 0.16591203240346492 0.51438363684976973 1.4102786401596141 -0.24006199845235926 0.010675478638318858 -0.18899423836434126 -0.010599493912623548 -0.47456460873821193 -0.011846675323026606 -1.3315999063851913;0.43820839808202638 0.13029562324709135 -0.16714139505736478 -1.1697135686080951 0.82554655951201439 -0.54612112180176808 0.49075538397930313 0.091562412387700132 -0.1260266271437096 1.8979678883796851 1.3734242755895114 -0.76156655888142011;1.6492037223589131 -0.077916387750569444 -0.9137411432897169 1.1828284926007568 -0.11882464380515469 -0.69701805653984517 -0.058930935107534381 -0.60830326755801878 -0.69744192040763209 1.1145183707210591 0.28331259081114341 -0.65686597581914474;-0.20019606107774265 -0.5472944058332192 0.18830042987314036 -1.0633110400742449 0.002955362316176267 -0.83986630597006973 0.72508916438846582 -0.15584537895304795 0.14054992650036227 0.29629638915973439 -0.0016034351841445194 -0.069518231288910756;-0.089539604484546703 -1.9331038440415842 0.044039195654487967 0.079104793496524883 -0.12537154503817327 -0.19182146504953224 0.27699537347241293 -0.11708224399914724 0.049349366955660237 0.02047671783478066 0.034234041770775214 -0.073169252931902629;-2.5113540704352362 0.38522115284475889 -0.0098747144393456915 0.71096590535048487 -0.71882870191411863 0.364428376401839 0.95669123890232433 -0.33190441438897633 -0.46491550439706092 -0.23383029413276502 -0.022020650936663059 0.70355339736167899;0.19905618803386649 4.0231965148802562 -0.0080206059677494675 -0.065766561498868642 0.0014321589995036459 0.10686537880245696 -0.30692757073267607 0.088982496340323763 -0.10124613177016271 0.054795753196002328 0.13082828490624979 -0.017604873392019472;0.25121540668208425 0.35507572872305532 0.14574316482558189 1.5695005685428098 -0.21085937147788267 0.5418219243536796 0.14929116222667552 -0.13181896217807751 -0.693836754457547 -3.1987065255925189 0.143866665371224 -0.049483222114259193];

% Layer 2
b2 = [-2.8060686099970935;2.1150809744022667;0.54500307066864073;0.25078452249041161;1.8965195411137838;-0.70922243612974001;0.10183503082043316;-1.3193715169285229;-1.4255137862345961;0.92092910003845629;-3.5558168163951831;-0.13618434428736731];
LW2_1 = [-0.88859131944468794 -1.3835582900883108 -1.0964922487209232 -0.80902357742771269 0.00051484730675701446 0.23498807638056873 -0.42880671531315051 -1.2027969713361299 -0.57472222362024306 1.7016427890887948 -0.0042829558746076499 -0.182632783519319;0.20765548797022079 0.0030387122404745837 0.15932511003113203 -0.016573004970549393 0.5808679525663013 -0.023838130479825879 0.029958648201412651 1.3448528648859097 0.083275803015921065 0.67272902894741671 0.17776238946272016 0.069825745715921844;-0.69056554076257537 -0.97479471037276355 0.087751283900870503 -0.0036935933724271189 -1.1440806366709835 -1.1768918371796788 0.84222548521334639 1.4281439807366689 -0.51473722341100647 -0.18227589245844875 -0.054730674096212059 -0.71557879599534902;1.6811538424890429 -1.2852590944858804 -0.13476194991512011 0.69442841204217831 -0.67147462208702224 0.32756786942902599 -0.28835164239792488 1.1962244286424268 -0.75185547578596645 -1.368496398710914 -1.8813866936731372 0.51423355518177249;0.1474431735875463 -0.23146826213111707 -0.55316726253031678 0.49956315221640868 0.068499674475058225 -0.25983297745066769 -0.15062952215924963 -0.24005940340976195 4.2945939100639103 -0.15300046539833156 3.3734820688446554 0.085052896203050829;1.576840466106314 -0.83002339412029613 0.013658494455382822 0.40726415315649078 -0.6292188335197002 0.25541686417380338 -0.68474891210551858 -0.24469576953340477 -0.18245835233265323 -1.0500179177515652 -0.50686876904702372 0.12147782669370288;0.063885579922835833 -1.0362332574000206 -0.65958072923391475 1.391639800672245 1.5203179989445634 -2.4496121122397563 -0.17575442517301992 -1.0360734834813412 0.53294123588473941 -1.3720008585035683 -0.47114638295353406 0.66522507071720882;-0.2028304255757751 0.73682970818654392 -0.25211578482359215 -2.3725276926087946 0.2357606492083234 -0.37721911659478463 -2.5852043091884385 2.6435177989051244 -2.9987628988724229 -0.25908146115817221 -1.7845335435305292 1.8163109193008888;0.32793873622189323 0.52228667260100159 1.4072540027822078 -0.67235712593345531 -1.2866791102192252 -0.2124031289270556 -0.56290350657104971 -0.13178114400596247 0.64880571100072437 -2.2118064685559395 0.34394876705888289 -2.4368500249576748;1.3469732655361939 -0.49506507272188832 -0.55778154646352263 0.45190080750671585 0.38219509679657371 -0.23395214010130319 0.23141476913066966 0.35248065173260168 1.2130103777124697 0.4111100071745043 1.992380774264763 0.52973869458634537;0.061080855687207176 -0.35475305485470898 -0.14859612268096498 -0.40766915433679402 -0.58693725442571221 0.35591543786340923 -0.075766882146459213 0.023524501192643672 -0.62109589514349073 -0.091868397055780038 2.1018961926502366 0.031834271143945589;0.44305802175823289 0.61483175000656065 -0.014805575554979442 -0.30570259379583181 0.87806170986423959 0.88403020932210352 -0.70895267987739219 -1.5854451165661561 0.73211905004326483 0.043034617725985574 0.16960818442819575 0.3768202311241125];

% Layer 3
b3 = 0.51871753246411823;
LW3_2 = [1.9460226582394444 -1.2639868262615341 -0.65058154557180636 0.4474223303399148 -3.6259479822469429 -0.43671537743931099 0.12684195860912828 -2.7894547944285075 0.1099309545631712 1.2341562562567407 -1.566108785463481 -0.83178540610581364];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
