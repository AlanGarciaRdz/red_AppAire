function [Y,Xf,Af] = O3vallarta2(X,~,~)
%O3VALLARTA2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:53.
% 
% [Y] = O3vallarta2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.12820512820513;24.390243902439;0.02710027100271;0.141843971631206;10.4712041884817];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.5788998091680397;-1.0221307318608308;1.4288730743647975;-0.41190314397008315;-0.76459862395035993;-0.31864013014756393;0.67230845797906846;0.58006383545247453;0.29438194029603471;-0.58381351580309393;-1.141081320331796;1.6361890231596683;-1.1020080621299502;2.8691532813452914];
  IW1_1 = [0.67069233128809624 1.017377844627041 1.1857769207492095 -0.46181757634388709 0.63790283690510718 0.094480419679644073 -1.8886711686888233;0.57163675522487278 -0.50558415064458384 -0.45469490340029683 -0.3555589012127513 0.79547999669696356 0.3673960036232008 0.05335930582864306;-0.08942258219348076 -0.2103452335898261 -0.91609664480978958 -1.2712454805243509 -0.89033514145601422 -0.9937587538959648 0.085342427318202768;-0.46859829809011683 -0.2780129306366993 -1.2215551678798879 0.66573308805020204 0.39235398512976555 0.20549511721695382 -1.6507866400661264;-0.62113056051641857 0.12457815685730837 -1.1186171397024542 0.46371968802486535 -0.16183094053741651 0.080619421787569742 1.5088568561403095;-0.23017872025868941 -0.94947441714343972 -1.204924279917454 -0.010998873865217966 -0.60593940470503971 -0.09302814831286374 0.99970044543515479;-0.21171938648629252 -0.18051867224950238 0.37358447232444658 -0.9703873129035675 1.8535237300585337 0.7295588945528958 1.3004473527312539;0.061379150873691612 -1.8017926764642072 0.30844837366009803 -1.3651873039314812 0.61055847564413412 -0.8832894870090966 -1.1766987772013033;-2.6752414895645278 -0.087926979145188169 -0.13779912709137809 -0.98163343545685 1.244360164535405 0.15785524275407101 1.4253852418465078;-1.3027483172666254 0.55522212947791905 0.66758756382784135 -0.44103863741440552 -0.13843635360790399 -1.1407550668163249 1.6410385286559701;-2.0619476574480959 -0.46145736947256866 1.0645643124336837 -0.25160113115538218 -2.2430764134977825 -0.22411175784198595 -0.50170630441406727;3.5964233555213818 -0.97998815738804168 0.75169339958513837 1.1882594202239167 1.629496426172806 -0.20916320994195187 -1.5686639736628547;-0.30191445119744126 -1.7981419711350222 1.1385899174794309 -0.36990855456296129 0.17320150258383232 -0.58219204296358873 0.67167706380744119;0.90540068022323494 0.11522864864575053 -0.68886516492096128 0.56639495879892809 0.13736995301580385 -0.19205584812682402 2.4158681771049437];
  
  % Layer 2
  b2 = [-2.2138546942787674;1.6945742068703176;-1.2558726875560278;0.25213658378141557;-0.94673093017848964;0.47245423167406758;-0.034782306471663485;0.86690046518611608;-0.49168500649382141;0.81757490193576177;-1.0713357972145037;1.4095852032185534;1.7194398797698431;1.0975635424801673];
  LW2_1 = [-0.80702290946124744 -0.30620356608488108 0.20485384969843048 -0.46182006001087283 1.5440022327966694 -2.2669363245779595 0.16646760040963032 0.26020671579906596 -0.10561541694090333 0.16702431939585832 -0.62073773859815662 -0.31993137608233635 -0.48249848976354931 0.13923900517877669;1.2598236934198674 0.731266234392147 -0.060824976484359132 1.1376502494248035 -0.57054970822523243 0.86969484993826174 0.046781331959120646 -1.2147086497225923 0.77755734941235177 0.22149135185877725 1.1708154253589482 1.5270838566668878 0.21927370469081683 0.81350835811485267;0.20514055493406741 -0.76524674827877992 0.066150526738194562 1.560501813781177 -0.77989994278908248 -0.61987459429348946 0.47258675148976403 -0.80026109887959829 -0.71455454777759231 1.0930517023790922 -0.90895686193981562 -1.0318314033626508 0.13568302301186 -0.64175446830439464;-0.28022410521816066 0.16934140774905362 -0.27117986217397577 1.1130958154900996 0.68717498553198897 -0.57079837818758494 -0.43253539546497433 0.48425869263267546 -0.76538406590086117 1.1397134182342179 -0.81510237420097531 0.26763709015718429 0.11694040834335988 -0.78616658966247144;0.93733425356476019 -0.35317287751219778 -0.31303338486411825 -1.2518621285159235 -2.2215466045446837 -0.16038190706778938 -1.0398289741833713 -0.17230421798548201 -0.25392900395982965 -0.53850497516122853 0.55888314933892713 0.81821598999815914 -0.27932415343497752 1.2730847629909565;-0.77663728644962704 0.046595267822619593 0.24919290758663085 -0.46875074319313847 -0.47181310890299749 1.2833796097641696 -0.6209573994825891 -0.0090858928160975246 -0.042839104164960173 -0.57022442787845407 0.57097293530356674 0.10445968884304337 -0.0081194246067461846 0.64392260564101211;-1.0362232112761862 -0.49054843694157568 -0.19872495432086215 0.35409582017322838 0.08271525283416277 -0.66976566657827419 0.14942327610635134 0.023161878696060401 0.018579138401450319 -0.019866615224461998 0.44201414951125528 -0.76200261564090388 0.65628214081098313 0.42413982198887568;1.2269561135544189 1.014487220214654 0.91839122651167482 -0.76700206992950815 1.1345200852751882 0.52138660426888506 -0.67381680847675807 -0.3531256979472629 0.47083449373104586 -0.12680275614493797 -0.34052315165802549 1.2379902863002312 -0.63550686301258119 -0.097849079118476151;-0.31808981458982716 0.67464154377400565 -0.64254587836448795 -0.96368955089152841 -0.84917249043573384 -0.61217973352944421 -0.30349481198610478 -0.51112799381660112 0.41320194770365415 0.0012057381160010539 -0.36924962111697235 -0.22596606252545839 -0.12529219697696484 0.41737688246480609;0.31066080007241587 0.12728014823548145 0.80152361352514212 0.59041679547829662 0.42431332251581222 0.78238984758496599 -0.86424638598807446 0.27778329231672355 -0.60868780924804022 -0.77440608871651206 0.38442853799252985 0.012288512703866966 -0.32413495124906766 0.17312628880074252;-0.15996018963606659 1.0002253917240618 0.64504392123932663 0.036178493953798567 0.37967909488889534 -0.49961701902148226 -0.86302882225538469 0.51190602148709463 -0.47413396728556911 0.34553333166928746 -0.72430203995866038 0.23847632079021197 -0.46965100491151796 -0.38788084055277822;1.2322694659456206 -0.10396931904168069 0.12696455150988439 -0.098574576525554986 -0.16771538077681053 -0.13020836892371088 0.12311938972124239 0.086742023529979534 0.59673449619402452 -0.8097891133273456 -0.66848786351674505 -0.12938542588097462 -0.11412995312468098 0.251560033050575;-0.17538960550073199 -0.22488190632477995 0.18269069726560372 1.1883820539356129 -0.85672837940196722 -0.24905995491406654 -0.004389503764191352 0.38396407780733438 2.2059536166216107 1.7742976373361086 -0.24047401794306233 0.61915839530398709 -0.32604231009509971 -0.55062997386069223;0.84599992894140952 0.24891300627353027 -0.009415300315005308 1.4550330959150559 0.0073872467455322784 0.59587852356816517 -0.178473104220426 -1.3193707676183306 0.32741590364052048 0.49685934519497471 -0.15218513415988991 -0.50308807467308925 0.39564217773726013 -0.2201489904291665];
  
  % Layer 3
  b3 = -0.72952980083569374;
  LW3_2 = [-2.194420147680721 0.43047137822605575 0.68170910359805315 -1.1162887862768036 -0.33809381778396647 -0.35946072035744464 2.2897218217760158 1.2425734248772577 1.2547171857610644 -0.78917189555220124 1.7122049740030942 -0.64391609470139499 0.76472395417651429 -0.75445198510757983];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.4712041884817;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
