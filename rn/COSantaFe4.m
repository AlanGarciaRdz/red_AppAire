function [Y,Xf,Af] = COSantaFe4(X,~,~)
%COSANTAFE4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:05.
% 
% [Y] = COSantaFe4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;10.752688172043;0.00341273633199099;27.7777777777778;0.00632111251580278;0.294117647058824;0.448430493273543;166.666666666667;95.2380952380952];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.7146265404822534;-0.38069876318018925;1.0672188754957455;-0.72966741147287906;-1.8138363843372518;0.39330897047579616;-0.68074816967458407;1.5461484884199543;-3.0399453867949151;2.102703503943629;1.2134223707438518;2.1678649563466799;1.9524044490208869;1.8124010813135247];
IW1_1 = [0.99014473793029123 -0.39164922563458482 0.22099228749509206 1.3895340577923438 0.30699663665418359 0.5884009146052539 0.57015617665374907 0.52169058050679162 -0.84908743574241174 0.31539675893725727 -0.047068123437404193 0.3393199359666772;-0.074043440709834901 -2.5880894797776288 -0.65205366969295475 0.068398967514608375 0.013584342381078866 -0.71375654789355447 -0.12624388739929729 0.53206010825380468 0.28897097431247104 2.8628876780184727 -0.071488944658838344 0.17341841802233066;-1.4360002375579046 0.36913824440165532 -0.10922632771141794 1.3906248275268045 0.79942605695924795 0.21838522105465341 0.71264498938790311 0.12870808532384168 -0.50420320888770309 0.85878112094472769 -0.021306621894429188 0.42356223083697181;-0.5884191814091505 1.5851384780013362 0.057356088822608092 -0.19428926988735984 -0.25150362582283803 -0.12695538746279583 -0.46179393834914728 0.11634722791816327 -0.51909375350778253 0.17177763608091925 0.095267671345768676 0.017607780207074413;-0.069250743474489188 -4.2203759588522907 0.75828884690222342 0.53344593368687621 -0.1983380788326253 -0.02583093215818888 0.13710579231243245 -0.35437474045547485 -0.030806098570061894 -0.50910225284880917 0.23558685229814083 -0.12694500611515402;-1.7515673448406925 0.26422496003118456 -1.0472039529488733 0.1607715382118553 0.26700012287064412 0.30294040161677244 0.68616808614541125 0.23555996348932026 0.29184301922580691 -0.66536113106465333 0.087844407387931672 0.53594328063924179;-0.32031059872932899 -0.98821016804324047 0.54523531879819709 0.49842676352091153 -0.46480217164226922 -0.07061501845595923 -0.75090075184955307 -0.037564930461800358 -0.83040196899238061 -0.34268746626924201 0.033732777476118352 -0.64405053082249086;-0.2770817476353335 -4.1740312787360345 1.2327527045558349 -0.22330608097356291 -0.3990599736416704 -0.17279604351255456 -0.2743593571756458 -0.0355360262710082 0.071413616706355432 0.76458672543850981 -0.29141863151506425 -0.20669556108099582;0.72881090751287192 -0.26022353660992453 0.039943516826190031 -0.31706234193430227 0.14080891111235178 -0.2063523670964631 0.38858560726131575 -0.12389923656042712 0.24371468162489487 -3.1833243586552493 -0.19065630710158746 0.1985504334061895;2.4134789112467652 1.0174195671508468 -0.44218865696162218 -0.15008419920201688 0.43311200825209745 -0.072830536598357767 0.012137157494704348 0.21519191211352542 -0.44643360805724225 0.64231770413485834 -0.1153235460119796 0.65262178469175125;-0.11548613060754562 2.1602710769337605 1.082623073714893 -0.075009791809183268 0.14055804594631069 0.31045354680101356 0.061817045090685301 -0.48118954675360054 0.0069116519755076065 -0.55414888557670439 -0.13118400652688217 -1.0093174780842835;0.81098591933971853 0.43349006894079017 0.044975531568430205 -0.42577097343871256 1.5156550824929131 0.65847530945621635 -0.64178924293566586 1.4005689799093111 -0.57762593688581476 -0.54067198155672347 -0.0051851625753256666 -0.60983830663221661;-1.1022483045872904 -0.99599983095011579 1.1106024817725157 -1.0758570094966575 -0.343362647729895 0.24035720072930231 -0.41356134860571298 0.41178126400966264 -0.14226797805579003 0.33411702637069474 -0.058785437212446327 -0.33698943037313095;-0.72857225026992645 -0.96660957266034264 -1.0967361234011848 -0.39819336429844759 -1.0083803770919972 -0.98075293154440046 -0.13168474950326894 0.16586464028889653 0.17352853792715622 -0.94889755566146261 -0.54553390391333101 0.31761923777478224];

% Layer 2
b2 = [1.6893762295912047;1.4249546108708395;-1.3881626280999861;-1.5334337429687677;0.94511802025847957;0.15338546686569643;0.50731853263500692;0.5293678031456982;-0.27964576237562622;-0.56121375705641707;-0.85540202265303045;-1.6274901450192678;1.4111265137423112;-1.5107696819239922];
LW2_1 = [-0.5029020569622068 -0.30221614262120922 -0.072262964695986046 -0.13912990116548585 -0.70389505127168983 -0.49043714318393439 -0.21611252338732848 0.22896311039088293 -0.56640170369555209 -0.24522388503087658 -0.27824206148624209 0.77815054488173352 0.21073268537053416 0.73700791062873761;-0.39849417830706063 0.18087628235693159 -0.38685090230412073 1.0748388287548418 0.82836929397379733 0.76000315923793305 0.26849099404394744 0.26739853572774702 0.91204997171430957 0.10634380512861606 0.50000506974736614 0.3879659586468816 -0.55746594238766867 -0.87081454361490718;0.23440000815394113 -0.22160216088339355 0.52352890650857153 -0.4093177148168321 0.28772577172650288 -0.56556745598320102 0.5094297898755924 0.51038152455289565 -0.71982432353603498 0.19559838427741918 -0.48723790178240894 -0.14839465497630727 -0.084466487821070843 -0.8636242122762674;0.40794588437228801 -0.2294779849885647 0.12888843443670053 0.95971698582554199 0.9370573730703663 -0.31916189626227814 -0.33690693116140691 -2.0965581058880742 -0.1973308358040293 -0.39965387125246615 0.67647230331232955 -0.33024685335611592 -0.70669805908253069 -0.2022192841722085;-0.22199746704178022 -0.50774521600674893 0.6778356950189387 0.024838423062970516 -0.18218283974257721 -0.44441859324509647 0.42737337284704985 -0.73875744427636503 0.23956158145988254 -1.0859194726743624 -1.0035118907181062 -0.15998736811892614 0.032845533080112177 0.80248479424799957;-0.016407997036188463 -0.63646715922016017 0.13204107710173318 0.14849103408047987 -0.99047129504526876 -0.421669480372523 -0.23766599292819077 0.27278672506843027 -0.6014462431483778 -0.10703985191543573 0.021735881762366998 0.25848850231927667 -0.082017208281876336 -0.4342967518821611;0.92471147729079461 -0.18631012449949222 -0.47089496753494292 0.808273410185676 -0.83498910078642341 0.18389461450343642 -0.11850322233375196 -0.44208964896547936 0.053587998018215566 0.66666260278700773 0.77239452938739661 0.6487239940311571 -0.91778955074982571 0.91092203920605286;0.87556637020858574 0.31662155275195375 -0.98749397463371824 -1.3773855651324047 -0.60236771163123981 0.16608019178621969 -1.0344619039557521 0.63633989188950024 -1.2421611722377901 1.107440269677199 0.41712779096373526 0.91914418763845229 -0.69959631956472645 0.41466228670978261;-0.45501250304875562 -0.4128274288351293 0.21450527942622213 0.89066226506603263 0.51942935902753817 0.7013639111091452 0.48370938131146363 -0.26337195863581758 1.0175258571547467 -1.3757051849798219 0.70909808671900121 -0.65887616685200623 -0.043258088634001879 -0.59557927743728367;0.05478277930917444 1.249998697899916 0.56432956992790995 0.0078802419988368653 -0.099430765038521121 -0.29418719130261406 -0.12157191435694356 1.4468834970119462 -0.13411251108356556 1.1013790316271592 1.0629198005872631 0.91272320821515529 0.53262940736070719 0.46995982824490373;-0.32034730504118708 0.069608016995443459 -0.88732493311619665 1.015923498654431 1.0627068996302163 0.42607922453562574 -0.19904230195909609 0.30927644425930617 -0.0058479555960141063 0.61578358581815607 0.89662823741144282 0.63462524932618669 -0.050324313060389925 -0.83318151355234416;-1.523683449302822 -0.16866963763255291 -0.6951085726863977 -1.3944249937869242 -0.59214993434579222 0.58118006024915747 0.23381182321261457 0.86283023071693854 0.47311827830837705 0.89211813723649536 0.38546165151963163 0.76900050291274358 -0.12983446874973731 0.1019754472637058;0.44475734105489301 0.27030029165732899 -0.28499881391657755 -0.50448518207389492 0.46848171475712397 0.46061029718698665 0.10725867787943733 0.33222511900405449 0.20463001441897544 -0.053653549284147624 -0.54725770625841397 -0.17960022432939726 0.85702429930150348 0.39626200540178302;-0.24613048416960881 0.027316079961934144 0.96851401751559008 1.0219141798425053 -1.0960499975665621 0.92080543882215204 0.89835928274562649 -0.11155873498683308 1.6785768933394156 0.017473110034215034 0.72776161876010703 -0.051420576680366745 0.55791453440612881 1.1273916617148152];

% Layer 3
b3 = -1.0061190550000003;
LW3_2 = [-0.0093374262072909962 1.26291033551887 1.0486996713317391 -2.0463094676596301 -0.52788453144079694 1.9313319424516215 -1.2574100875291472 1.3344248808704833 0.338918328640264 -0.45322388590439838 -0.81250916286213759 -1.1274726772303498 -1.2152146576739151 -0.5579851941842382];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
