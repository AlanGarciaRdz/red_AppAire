function [Y,Xf,Af] = NOXVallarta22(X,~,~)
%NOXVALLARTA22 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:30.
% 
% [Y] = NOXVallarta22(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.7359403544049949;5.8538148084340431;3.2611621324973648;-1.0551327121219864;-3.4057261197786275;0.98483942558801851;-0.8798316745662591;-1.8456289398740209;-0.60520174104328928;2.2318565794753731;-1.4488326436945986;-2.6479024131913014;-0.68249722946739744;2.8413950332705316];
IW1_1 = [-1.7491756393857907 -0.42613190570687298 0.98034122274995472 0.30662035211811445 0.36331869956170204 0.25990450368948592 -0.6389443430669336 -0.8255922426162966 -0.14734574358880934;-4.7449586292129595 -0.97828720456087859 1.0471462651067061 -0.4345489176387034 -0.25824624339542385 -0.65946987438917859 0.57299128236665731 2.4570912745177238 0.026957267574462505;-1.1678141788385701 1.5250187718513384 -0.61173099994812763 1.5349788076045972 -0.35199366518111602 -1.1997966415879424 1.048108888635352 -0.010033414351823818 0.66943411327991598;-0.53331794025783197 -5.3036363746736344 0.24256436290529537 0.19567595043231478 -0.25940136683111786 0.0361841553157096 -0.20017567003809761 -0.60714383350977741 0.0017766998131784799;1.2157270663402826 -0.093230885707683037 0.28429291201440998 -0.55595274368334757 0.036069556899021318 -2.071130922151716 0.90667793270325714 -0.94261727309182142 -0.22420306787060881;0.18026959793373068 -1.392643912590982 -0.15851021370841006 0.91272759759959954 0.054126341608001546 0.59034984173747262 -0.27010790260307416 0.26095917900368948 0.066381098946403053;0.76277923485044286 -1.5674661557787675 0.26203883818367518 -0.57029520456537708 0.024786789418494021 -0.19775494432786381 0.10882089978090771 -1.1994455616999808 0.030766820973698289;-1.8341083705115089 3.0357324730880708 -0.71748318998084959 0.58792030049784383 -0.1366123573063846 0.52074026232167114 -1.1364544148861813 -1.2301126648238878 -0.1110900198204151;-1.1625980229120811 1.1143278743609855 0.56780967494064039 -0.44721221009881373 0.25035526686175147 0.10793045970054939 -0.48488163416913233 0.92724405494764406 -0.10859548895337999;0.10809320152147051 -0.24022388922724242 1.7832600199766648 -0.083796430427538648 0.09128189828684205 -0.70294992357211206 0.49929044783235338 1.7226305819273153 -0.27149541094538765;-1.1764068482324157 0.072949815343748114 -2.0951558508049888 -0.40793831352098725 1.3556331173348095 1.4171304853867066 -2.0804800989633345 -0.89291863928013826 0.0015295412058385005;-3.342600201987691 -1.1021660686327865 1.0851993828634556 -0.82796265296348592 -0.62787934339411589 0.38159298549299192 -0.49636503195908138 1.5405795794575725 -0.084931646578250933;-1.0484117769508321 -0.71448566401522107 -0.18291907049415984 -0.85350009733379562 0.28646204125756258 0.63941673699923052 -0.92085780603244649 0.1964286085437964 0.054293226701733519;1.7512303987035824 -0.36465249053103066 3.3652458472518507 -0.72600473626867856 0.94605892073976006 -0.8370578767835779 -0.23069242165114112 -3.8936604835871558 -0.31133050725784733];

% Layer 2
b2 = [3.5878091055257539;1.6384365774580105;-1.9473825545485759;-0.8024500686449505;0.44264386543103273;2.2511775775449263;-1.3284352591100586;0.13862134531873244;-0.10543345029096768;0.44496563183184573;-1.7288872875392101;1.353034674553486;1.6950771398351465;3.1215167186477331];
LW2_1 = [-2.2594726404496854 1.799578875874613 -0.11984187324806278 -0.18744752237759446 -0.6378791452917425 -0.26665830833479481 2.4482323971132502 0.10671969551629097 1.6104119965201924 0.54081356393908564 1.1198985279460101 -0.86459016012773116 -1.9657329053258741 -1.1954760552608794;-0.93895821723140205 0.084340107533112163 0.37895572569089153 1.2265730890209312 -0.047459798979969124 0.18462997556824479 0.96630737672287792 -0.89316711999584308 -0.19467499692219439 -0.048147199246333136 0.26342340089106725 1.5106038949899503 0.61048464261221358 -1.1239940086369877;-0.45257964978467685 0.92026448546860529 0.86675948307189876 1.6787100177693464 -0.82394847664483706 -1.2805127797313651 -1.4490377736250273 0.3776518060401205 -0.3094887705092173 -1.228379396449097 -0.57965035046775448 0.61073961999029946 1.5649830157486444 -0.13511645637697428;0.67241329734876698 0.552388688966444 -0.96532803031870318 -1.2353224148215474 -0.11496897529802361 1.5047022718610903 3.3951505707184699 1.5152471672242087 2.6635282785928758 -1.1620513618315524 -0.96980577834397919 0.86473162611426468 -1.6127303744639645 -0.30314984319299126;-0.43905744455987872 -1.3264570770095225 2.5332826349809698 0.57872599877025777 -0.60789905681956657 0.81854524839939258 0.60725241949941955 -0.4177566149569058 -0.24285277814319103 1.5218454386931672 0.49820333944138184 0.67556775069302044 -0.97229087146636095 -0.58179370012947662;-0.85651205372318406 -0.73701257846439505 0.19920998391539838 0.90768507380639851 -0.16774572666976767 0.10258012992076322 1.5695232450149827 -0.21154959936865977 2.1264958897055952 -0.37431084854354407 0.6326419325179814 0.61415015521805194 -1.3773906284181354 -0.077024391133754561;0.34741943203590103 0.36854141390068956 -1.1409984989161399 -0.11817930979143423 0.39590139339767771 -1.0929952554214941 -1.3252928284504093 0.39370265455401515 -0.02634275086932486 -1.3180058458835939 -0.47323058301651183 -0.93498740404736858 1.307198858511653 0.52128771935780849;0.07344490688886357 0.46328757992996583 0.04292630836074636 -0.020501276531132567 -0.092316471597746377 -0.51764380085930106 -0.97135139139401216 -0.30133877865444597 0.42681913462257992 -0.54615304729822145 -0.37584256893113616 1.1526656419578731 1.1308895312188709 0.050593407303928035;-0.047248899590610738 0.84286960549811651 -1.320493619737229 -0.16251687354869912 0.59884673750784656 0.33252145808247979 -0.019414178927047915 -0.26484940493869225 -0.0044893698756530709 -0.93689523191409074 -0.017931826365864521 0.67263493537232033 -0.82839817237253222 -0.27433142305066166;0.67661776947556562 -2.3895133911237112 -0.18384395103655804 0.16852033982716336 0.67548412457937368 0.98883946429500325 1.1425165156961417 -1.179580283741207 -0.18473419435873573 0.77358170355253153 -0.12117044814017716 -0.9695916367260381 -0.29392961554015384 0.23877960374689758;0.14124355818875359 -1.7465909677411038 1.7605616798558075 0.31262320861499238 0.2855768960825481 -0.0072698371827546165 0.71894091326611631 0.21053283023454353 -0.55468043950796464 -0.96641391160367685 0.16109772263692362 -0.57778141078057454 -0.78905930010764336 0.27030901461441126;0.46787078148158578 -1.9640307648768025 -0.048796886221439142 0.084600340948117567 -0.0068546150519011306 -0.086273984555028868 0.13001024694057697 -0.91098059525941755 0.26774445668927688 -0.17662545577149913 -0.33147144675766521 0.15948928726356337 0.60690881183374246 0.21729902438578291;0.55138189281542849 0.35667032331701604 0.73866305767901852 0.41305480685010287 0.095553739115844388 -0.021860505061438582 -0.64226036880116988 -0.53874286469462107 -0.33726313818454856 0.58853768836626486 0.075322164612565523 0.29319922775299451 1.5538258264260987 0.29509694296679273;-1.4453807206658216 -1.1273057308441792 1.2337967870517355 1.8175564334749232 -0.37964616062063361 0.11757072770008666 1.6772602043248306 2.1972016873260434 1.0554353502472478 -1.4219093428900285 -1.2071579444728446 0.35799719352435433 2.0331887492321195 1.2805416528627684];

% Layer 3
b3 = 1.9786385654298313;
LW3_2 = [-2.0654518564979067 -0.71518010539589105 0.33810996026132056 1.8892450637747398 1.6924533699137019 0.55383816067968539 1.8402288916585463 -0.88000874136179374 2.1975093386828224 -0.2117935408469386 -0.60591658348665123 0.59796697121315567 2.7137943127265163 0.24928449188303639];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
