function [Y,Xf,Af] = PM10Vallarta21(X,~,~)
%PM10VALLARTA21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:49.
% 
% [Y] = PM10Vallarta21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.12820512820513;0.00782778864970646;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [3.0565697483777687;2.0827428976910292;0.97558514173117505;-1.4484668291666334;2.5187269418713507;1.4688624082657913;-0.25413512329091198;-0.59423509952227893;-0.096932753231629684;-1.1098653553078774;0.93811906288698876;2.0761550700451146;2.6922456574974198;-1.7068319245699379;-3.0246332917930761];
IW1_1 = [-1.7159194080119249 -0.10702877029630249 0.64752175809658608 0.63621242452491999 1.8859712849018502 -1.3982676123349889 -0.64163608863578125 -0.40770499861800058;0.5145430975525741 -2.8622400476654546 0.75824231069015613 0.383653563395289 -0.36197588154700927 -0.83279649147687318 -0.13832988709040644 -0.35445322227881892;-0.083440662374258859 0.57360260766336268 0.36988135331707062 0.17611090413110486 0.49063491868030146 -0.15627597139247121 0.44213372664311795 -0.32767109566663943;2.8866816035861826 0.65550038907667296 -0.43350072185795696 1.2998038298068932 -0.028502064722994276 0.05936611110030765 0.43967464533040779 -0.093506316327661779;-1.8255036652633474 0.98075136721585032 0.54497182261742927 -0.033209608719615799 0.10950477120759125 0.75121301334638402 -0.31226740298678801 -0.075085665591682699;-1.538646490195251 1.0337414670141802 -1.0234031581547411 1.4653038394789972 -0.58777623277565161 0.35585003203156662 1.6626963606984935 -0.63273958575619704;-1.3282735643977284 -1.6764573216423 -0.44438454196483973 0.66920814945983853 -0.82826724637123583 2.6456611404036114 -0.38449394656444041 -0.30917179392867794;0.98877089318356925 0.39322476376906224 -0.29463689151083017 -0.29297667218091528 0.36727503194637368 -0.79564468221322038 0.14603923538955843 0.22456151599692106;-0.47046704018748453 0.39759061708881144 0.24457575493720968 0.23404415315390267 -1.4927748510440375 0.68582931374625289 -0.75619086781745926 0.16261459601953143;1.6133221123061428 0.62433057387529511 0.76616475984054222 -0.91354105119633655 2.1002361923579573 -2.7258505475518477 -0.68198052983882518 -0.083267060653408095;2.065823687156271 -1.0443639525896531 0.40935579209627565 0.23859136419836632 -1.5047062753302927 -1.5363292022781585 -0.6276045904398776 -0.030468874996359856;-0.23377813197481195 -0.20125564213416636 -0.24429073279889577 0.3069408583329738 1.6635218523040654 -0.59164251463634532 -0.93472689960867184 -0.15998516618175437;-0.085035297682860111 2.3199388925674209 -0.57161156807433922 -0.5062731609467096 -0.01199095030884708 -0.021368554090011746 -0.82010375041528172 0.053946788246955306;-1.0975324383931855 -0.40062318071474484 -1.0097277788690984 0.80247457634759223 -2.4005234794821191 3.3004997645073662 -0.19479214766132108 -0.48043660699818758;-2.8879403544447957 -0.24833624334961429 -0.83004101186069967 0.3253144761873461 0.24230422335441842 0.22753646460785412 0.3387296592466984 -1.090795353212122];

% Layer 2
b2 = [2.2378503697880765;1.3769527092384688;-1.7510163609401737;1.6389217911362104;-0.60754376770772733;1.2149084188794803;-0.38190696814621411;-1.491980828371547;-1.2830649027328309;1.0733526073198507;0.56454249941581114;1.4616424854361514;-1.6265413068902186;-1.6682257369232942;2.2285007088481263];
LW2_1 = [-0.78189974968672049 0.94648540261965664 0.2984808137176172 -0.86692552499911957 -0.073788176996118948 0.10555579610308094 1.6583809971147401 1.0069810810708153 -0.47345601352834987 -0.5741368283677899 -0.72349034449763883 0.9054842544682935 0.44788171872964355 0.20125095867254195 -0.58408382188591856;0.22636497244995435 -0.27804968930664353 0.3699559834899328 0.1624433379459754 0.5710159316212402 0.015176798344235255 0.66616464015690879 1.3840672394307294 0.43035636772648916 0.38817329967287034 0.2409949679262387 -0.4302161670525107 0.23480980175704577 -1.0634088228237224 0.3148765605805468;1.5134261823285817 0.61877458180135991 -2.1214462262815039 -0.99428090563366489 -1.4523850128887363 1.0627531042240956 -0.92273237589311952 -0.01175138773443548 0.27490050974496377 0.93948255147016824 -0.20193726034704945 -1.6715453297737302 0.19968486022300419 0.4397897887381273 -0.19683132425620897;1.2340643927811561 -0.71943396211523836 0.019921880762333921 0.00017051374901203876 -1.7588677825191974 0.4438858204208182 0.35113047318246671 1.6317774841121906 0.58782173108047509 1.6948463540677507 -0.85550306740418736 -0.53649379275187525 1.1166878358999672 1.3158913461234283 0.87330380682088538;0.20534026063200175 -1.3029574244879243 0.12325764549247482 -0.23742323743079849 -0.78133103570863527 -0.21686776437503524 -0.52321336702974064 -1.8181941705308309 -0.061503126719101381 -0.10715050060694283 1.8696277523699834 -0.93315164234143866 0.46771714533873648 1.1632018268259856 -0.60076233429768178;0.91333391723605151 -0.31143942313083356 1.250961141609112 -0.048395637117700147 0.68645728202548983 -1.0311744220544077 0.71337134047117767 -1.7131721967702247 -1.5995819260027826 -1.3258312968067512 -0.55866152746750708 -0.92314809816424281 -0.26846495591578479 0.91297480967851774 0.38731639348477787;1.1185916680589476 -0.14112630961390188 -0.29149064708811412 0.87602069814467798 -0.701349271846887 -1.0968553365022733 -1.2603274014823982 1.0891942034644362 -0.77041332238343063 -1.0473993868172402 -0.35725059239780177 0.12669069285586762 -0.36982509167675143 1.218611640538793 -0.36821343636259524;0.7071338748766407 0.84625920751555772 0.32183525034647925 0.6558316548197195 0.4108226244750634 0.51076743693064908 -0.02480879920892402 0.034626953803716172 -0.75686850466336486 -0.26108823990356872 -1.1260607918686767 0.46182809784472645 -0.016529609935425432 1.8661996588016845 -0.44202650355373557;1.0344185326647706 0.89511037888150136 1.2059757475832984 -1.2992319304665092 -0.84752493840942567 -0.80127463755301376 0.7306284370828392 0.66396625903899842 -0.43813574669001093 -0.80364565909728858 -1.1886786556925899 0.74708932655679827 -0.14231570095465043 -0.87240920810249056 0.59770788701623889;0.048476607820821839 0.72892510236345898 -0.71955787184666031 0.18599348717752459 0.59499219973419615 0.53775613709581038 0.78951048951713942 0.59856932428842924 0.37975852067390686 0.67111492130314743 -0.89869649586590061 -0.32763402259711427 -0.29953609581049068 -0.98889108980181517 0.66961662437342029;0.32839243692128645 0.27029186162586794 -0.65861840787339354 0.10287803523042838 -0.40541363272895553 0.046802196601821049 0.802608773527828 -0.52448869989740832 0.33278622315527745 0.25312924960983596 -0.17468370053916632 -0.75947134075992317 0.53198109479837086 -1.271182432774028 0.69341421469072972;0.59210217889851002 0.066458392879722605 0.22541342652243107 -1.8903483100768863 0.74049775339420687 0.5280182635532652 0.42408497135309181 0.33723851659714538 -0.21381046576142715 -0.15452802098717783 0.82344532398971226 -0.61093967375330227 0.080422610518573023 0.16059978116758766 -0.78972475548015142;-0.94713828681720791 0.093118623601402883 -0.062592916576159577 0.82936913414335567 3.3337891547822593 0.76554393126268305 -0.16710119716504584 0.24143835410789788 0.33029794373211868 0.00084554871590289751 0.53459073892010645 0.84700860981327386 -0.5902625494778333 0.2322878983377975 1.5330846126153557;0.47897364384378205 -0.13944102138975881 -1.1686552651626267 0.86489193795624086 0.23228165795568267 -0.58078014561251046 -0.94674678414593305 -0.33583031321293721 -1.3425091468367274 -0.92557868294713475 0.85655379114971131 1.0041394575159344 -1.2526862000028014 1.4878341477743082 -0.027557382936365529;-0.83815224634143293 -0.32627471393751112 0.98396801474985063 1.4965424456396466 0.84456071629012952 -0.31259509534181157 0.82764256593483854 0.01806132798429233 0.54234225694114435 -0.5311113736965849 0.34176334332823322 0.16045923399274512 0.74247285013327269 -0.91429567526823108 1.4350571026127259];

% Layer 3
b3 = -0.47852513135370295;
LW3_2 = [-1.0299855837483081 -1.8945576497756424 1.3728259932027624 -0.20217656762889688 0.39298481534487495 -0.12582109343415673 0.60178591247981572 -0.35308986461612368 0.51671294654595956 0.88009066728435004 -0.95952186139197282 0.80584314588266603 -0.25903049556672619 -1.5685727100132698 1.6507205826549318];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
