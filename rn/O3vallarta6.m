function [Y,Xf,Af] = O3vallarta6(X,~,~)
%O3VALLARTA6 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:54.
% 
% [Y] = O3vallarta6(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.12820512820513;24.390243902439;0.02710027100271;0.141843971631206;10.4712041884817];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.18017489414656962;7.3609884958015881;0.41360274080512316;1.9206403656319524;1.6708493741639405;-6.4416167440032268;1.0923448914899176;0.9056707222060012;-1.1880901011160263;-1.5885100395024501;-0.41975440166469208;0.28327919910198596;-3.8144370188939005;-6.1305333753325808;-3.4073463203102294];
  IW1_1 = [0.23748882582488012 -0.70958786877108382 -0.99162564103525985 -0.24724636881071665 0.91412402763320089 0.66060690727251836 -1.2168108356443461;-0.52917500226228809 -0.34228092143625899 -1.5860692406701522 0.090332477885937443 0.28013646064331238 0.045312171234644504 7.9706079378077428;0.6652938371509548 -1.1314979107967922 0.10610773872086462 -0.11419041550831253 -0.09515935066733465 0.071720066625582737 -0.19030917854831231;0.3731320184567562 0.5996892766873132 1.0948132969243625 1.694864592121383 0.25789965619469418 -0.25728383271285188 1.3064242053253829;-1.7539869583607242 -2.9241817317473093 0.047594137224375471 2.4588088205470906 2.4461311681631424 0.42675646722140143 -1.1294038001745756;0.19032309667474481 -0.72076040495836247 -2.9588144641966569 -2.9057732819869733 -0.92498693437404433 0.77639752424884867 1.6783377074161063;-1.8288401393342395 -1.1523121452580389 1.0933237689126138 1.0453669810634876 -0.34996225181967999 -0.15897809761279261 1.3312390519738897;1.6990887146576799 -0.46219273940444133 -0.0088483944157631243 0.67005137992118902 0.27493767651547857 -0.1486813318550857 0.26476131801583047;-2.4570446914458008 0.25026613545293025 -0.13155198661848311 -1.5691751249948698 -0.21987129696959709 0.20408798492062552 1.1233665635787273;-2.0509085435888532 -0.51510658036320711 -0.70530812426256906 -1.1095180273196026 0.31409499816327235 0.38536158639022222 -0.2646164412517556;0.93775118013004355 3.2690680261345149 -0.96797129153637851 -2.9555776303941457 1.9602232160755708 -0.94919655022638227 -2.0888012134250089;3.0666126860180287 -0.90531710170335045 0.70955035211118889 -0.45289423648480837 0.17737096061826085 -0.086578715381798538 -0.11929326755456354;-0.49814969220992306 -0.31133905547097934 -1.7430007498240889 -0.64645233307206051 -0.029592683194008207 0.04059055355490291 -2.2709152858844961;0.051067234300703472 3.9580859390587619 -0.53807559735166777 -0.40216463013233222 -1.7852020483547182 1.2627795009879534 -2.932565860324214;1.079762115996501 1.8088036348499321 1.5806132433160298 -2.0479687905596649 -2.7740061087240653 -0.95927653676128344 2.3475651070698262];
  
  % Layer 2
  b2 = [1.1591850211488752;1.3622073847700389;1.6899523671800485;2.133364855613288;-4.4047031440055049;-0.63754580389677729;0.65249672531397729;-0.21710883192761121;-2.7726907604629729;-0.94541458868669748;-2.1201815090654037;2.6464066757516216;-1.0742580145572629;1.6103173673473119;2.3374799021460526];
  LW2_1 = [1.0790364107291919 0.22538168889638779 -0.98306425131909125 0.37944356103241306 -0.24396375769691592 0.56696158635143923 0.25555208739654495 0.10145333664584522 -0.58572043540739527 -0.45119280008814378 -0.092344666784035689 0.19026306348878419 0.10086493025714645 0.27859238819337995 0.52930212760289463;0.61876602539799652 -0.38419601460938713 0.18103498179911637 0.36084001576726688 -0.61418293197723839 -0.88565544312339961 -1.5473225007260936 -1.0349161046432789 -0.47492344550205778 1.5673316719148256 -1.1967159396232876 0.96589042601002484 1.4554020112829513 -0.8959964777817393 0.43825589663296011;0.64748683356755432 0.0087727376049346779 -0.46287717153219093 0.91049822585826301 -0.22172241553263342 0.63846673968283485 -0.0067464677798538975 -0.08014267813518805 -0.31235766067611009 -0.050315308917056052 -0.3739444754384989 0.49526261098685681 0.39744235180036808 0.13849807294100006 0.26153148595187281;0.43645278596878784 -0.16890698643877028 -0.22813430378162247 1.3258099443363658 -0.17184793557757402 0.58220783280053934 0.088695340145590856 -0.60772169907883256 -0.3818746988257119 0.22987977385415001 -0.15868332966468404 1.1589685029526766 0.86238055056939456 -0.21945780188952171 0.15343150280875892;-2.0216255883334888 1.1346102278459584 0.20249777153554649 1.2323995044231806 0.43119895972790367 1.699465823198435 0.056642620488753792 -3.4415738436732455 0.52264802371727459 1.6052027007481782 -0.45581146604405171 2.7038978227641706 0.25081615992471029 -3.4088640580991152 -0.94245040044763928;0.87521190186589071 0.023410863837130307 0.75865372029037625 -1.849294591945466 -0.094075880122853353 -0.98005445823851289 -0.35593305352935528 -0.6718352012440143 1.5377266315506746 -3.4786394574093622 -0.22244555102337962 2.1193975796295192 -0.23614042110636005 0.33222011318711586 -0.78245820525841037;1.3657461613346555 -0.5787775212129983 -1.0981690769402523 -1.7115500646661546 0.67800457032625305 1.2829198813105855 -1.216625542445974 0.7797679525194402 -0.7241008123215199 -2.8515572223846806 0.22820294892628146 -2.1030938781794815 0.32965113104926796 -0.17805364058932119 0.67709493795375464;0.23614076997088368 -0.55791114770194483 -0.50155008029825676 -0.30637705357954925 0.85620347952844078 -0.22214413137264116 -1.6665589966321157 1.2909847501320459 0.80100477365473732 1.838301049959014 -0.7753571370634621 1.6373724121220576 0.2080808475696081 -0.16502644522037435 -0.21779775119477857;0.032608436318988791 -0.31237813772910389 -0.019822972680361227 -1.5217418180764437 0.5934840165811065 0.32569993497838434 0.03630135463329652 2.1159125901640952 0.39640293416920214 -0.33575284687788687 -0.12787880879364194 -2.511757299083397 -0.33121722860796166 0.2539826513196603 -1.2095520868993841;-0.25233634898727575 -0.0952311274839827 0.42337442609024384 -0.40702690191170288 0.31400062252138361 -0.3799256169438453 -0.24069945959612879 0.036872265099296461 0.61730070754029043 0.25687335644404036 -0.14035984383074523 0.95766670672935816 0.14630614804460199 -0.036751803209258638 -0.11360139505467337;1.9719045434098188 -0.20651417329329699 1.9498996391108601 2.49716963438176 0.095664075058910031 -0.19675828376097199 -0.74381604435922932 -4.0909808968363279 -1.1632793388658131 -1.2506490877390697 -1.2092202317872376 1.9544049720465664 1.0135106735910926 -0.93396745738764919 0.47188398731935566;-3.314124078267263 12.309014825728656 1.9709528493586959 -1.5325192038489432 -0.74639404077397975 -0.65528853125692854 -0.99835472830601246 0.25454308271204901 4.3881003355868566 -2.7753686682295351 -1.3013528573924216 2.4851673961263772 -9.2419100195516357 1.7224236125160415 -1.6932422856734946;-1.6747354344026677 -0.11888424479452336 0.10565162346935923 -1.1481605501767598 0.15277710362985408 0.13293901501374339 -0.75224900754687352 0.54816181831834065 0.67753182751301344 0.9367865777076364 -0.46590045635841859 1.1585025497945565 0.24472757039840357 -0.076513768867439935 -0.50968627728158389;0.025374261125957864 0.13730102412441084 1.2964733459979827 -0.95988427462919712 2.369851379083824 -0.43031513798448107 0.50845325747457626 -3.4587174186113128 2.6496265942077537 -1.7285934175008577 0.42453844678066549 1.6986139455057003 0.24173006189676713 -0.91233342315723542 0.071607249687793001;1.1226639828883638 0.57441607848812437 1.9723282540886047 -0.54872788349089097 2.391235364692319 -0.68813351581482185 3.8651485623829136 -1.9464277777009369 3.517305935491216 -2.7731342008451594 2.2615090846902937 1.1968272153721524 0.12223380965225827 0.4422035695618004 0.72161498895586529];
  
  % Layer 3
  b3 = 1.0102827458539345;
  LW3_2 = [3.619748597198261 -0.77866963449688853 -6.7461603526615193 2.943118559694661 0.69753577020118174 1.3516512230566404 -0.641987097866767 0.85725683081450321 1.4509253595817346 -3.6870469855346073 0.83103293315640481 0.85740553049878576 2.7158058369357985 -0.76111371018831431 0.69978690757656159];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.4712041884817;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
