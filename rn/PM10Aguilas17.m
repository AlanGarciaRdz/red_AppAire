function [Y,Xf,Af] = PM10Aguilas17(X,~,~)
%PM10AGUILAS17 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:19:51.
% 
% [Y] = PM10Aguilas17(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.2353665636109308;4.8226631390423389;1.3172651517814522;-0.58670294911702314;1.5625687966233182;4.3432402371007939;-1.5037245343285692;-1.3573648446172062;-7.0421348519987408;-1.1006807915771495;2.5322314053444996;2.2470098052535743;-2.5457704136017063;-1.2485037972580277;5.0748015737550665];
IW1_1 = [1.0381751305166274 -0.61872015619788834 0.60655043670085063 -0.35610884408662269 -1.8401726432640002 1.1507050040359161 0.71472348751245651 -0.13095106614440094 -0.9843932377309812;-0.2233623204283163 0.55320611858811086 -0.029222698089604832 -2.8179330593813368 0.93087628203201978 5.184080609855525 0.56105334726625278 0.43090117075352935 0.18622515652201072;-0.372633735863932 -3.2212052985182424 0.019844912675441664 0.79064000647070831 -0.15139675228774621 2.0726308458459632 -1.7729680203672205 0.068638169229864529 0.41466949649824564;-1.0445333295542876 -1.502846324268825 -0.31432278178099421 -4.7369964118420338 -1.3695255393086905 1.1167610520941911 -2.4810621971894387 0.62377783131277376 -0.15403018219042555;1.0806060793967753 2.4706627373725278 -0.16447418288743984 -0.62578579159035697 0.015265735761907054 2.0757623254817843 0.37208991931917046 0.22202021926556431 -1.0645236581079602;-0.22494391996475055 -0.6158711141327089 0.18462105578981033 3.8783907493597045 -1.023319023478225 0.44276926134478245 -2.5619474832122728 -1.3637976358391359 1.0050442644344888;0.81620315794276821 1.4787596387316357 -0.42151057627331318 -0.13578978957974305 -1.1222322801490956 -0.87627217964959858 -2.1460396319127875 -0.12847413315411502 -0.00035012097635939436;-0.75831291192903505 -2.7844485593763233 0.63206232961351394 -4.7285650482237607 1.2435529874763811 0.44777502549879605 -0.1452977142737297 -0.31428810525621109 -0.30538420010410128;-0.41214740892196433 0.4464467731449524 -0.064424599669164556 -5.9101125723620527 -0.46802195271885588 -0.31862698380886623 -0.091117143135286432 0.0047082306256187433 0.086279467037459534;-0.13330468460311548 0.5405211552368766 0.13666041796500139 -1.5534367544731533 -0.20053172554069301 -0.52398126283348012 -0.71494746573621104 -0.41317369248565827 0.11980381456203908;-0.38100875374523774 -0.40152286379493085 0.57912191512578171 0.29261565990390132 0.68026359479441134 1.5782055882630088 1.1549137399338245 -0.17328059759107636 -0.11871875096777657;-0.014129325218911266 -0.040839277122514117 -0.21769853096977893 -0.51787069129035801 0.1985572805633655 1.5805215797716294 0.059316125995007581 -0.65319999207128432 0.41719473043475142;-0.091561746281091885 1.8723169592066025 0.73403125102802025 -2.2541680692377692 0.90514457322782493 -0.25002163242685155 1.4157662302829914 -0.059323251304572729 0.14142499411350526;0.011830749686565979 0.10692813652445636 0.16436658394784007 -1.6425283522912253 0.11310414718269396 0.00078282961719926963 -0.12617263577130922 -0.083844564530353299 -0.18599389189745771;-0.13541285835427286 1.9212839604064553 -0.48819527826260301 0.50739554774586337 -0.20510864483330532 2.6454965133593888 -1.1965540562138903 -1.3236075352466043 0.76405892240009698];

% Layer 2
b2 = [-1.6250798125521286;-2.9107252695125094;3.5574707987179623;5.2274830667899117;2.2287801782502292;4.8052141269228894;-8.3978981646416102;3.5833201240035804;0.16318055460467595;-5.4016821776907964;1.3759826276668325;5.4422053333352745;0.45145623431200854;-7.7688045293005699;2.9844272926696327];
LW2_1 = [6.5877346663918583 -3.1686854237779865 -6.6563353833616308 -0.044501572020451935 -7.85457360963039 -3.0162305524755997 -3.8656031063215042 -4.8406655655448585 -1.9058202907565058 -1.5508436356483526 5.5584628604488664 0.22013329865436981 -1.0069118330331635 10.940794641866836 -3.1947444505775704;-0.13434711446420897 -0.15095911944158935 -0.18110115255911816 0.29576472156257833 0.29612768341298945 -0.81379978463617786 0.8313093751508811 1.0146408777970344 -2.8348196185181012 2.5039550837985445 0.70876547671121048 -1.1951831460611466 -0.3518430241826333 -3.7306924679111528 0.64026363059537861;-2.0006039968823774 0.20452378672673951 1.6807941969405882 -2.6606024210602079 1.6387320005240436 -1.6926659260031804 -0.68728955576255779 1.7599228684496135 3.1219792538501019 0.39181182807822784 -0.78337783985139353 2.5951630509321704 -1.4321388999625191 0.36380928493807752 -1.9295591070163123;1.2936508100807871 -7.6556640781016814 2.6712695357319021 2.4360435442167088 0.18901928212823868 -2.0318268634816841 3.1205380093054944 2.4869233222996585 -6.2418233242442769 3.121310723060235 -6.5834095742390053 -6.9307522231449443 1.1909142686216256 -2.2760097619784441 4.0921395410635348;2.9933163642612244 -10.189641122909181 2.5284538295211552 -4.0504561709024927 0.64213020026121637 -2.0434774159512941 -6.2321760588799098 2.5652961657677791 -9.0796472187715178 0.24756851147610592 -8.2251775335091803 4.3710327771802326 0.4941226026707467 -1.2793187213945099 1.1059779577157292;0.18986845488233534 4.8857713806331082 2.0708992116168932 -1.2538697051702847 2.0628173043012676 -3.0333005996014206 2.553557977104548 -1.3720686917869371 7.1163365717474667 0.054082158839700967 2.5419594826330152 9.8578774529110724 -1.4598243883726241 2.0238597768814577 -7.7868331632258361;-3.3245398074357024 1.7260216784034954 2.2652765888747903 -2.2182516783754913 0.11922786293642237 -1.5504189330658888 0.26067301890246125 2.322006420412837 -2.7424100006035532 1.5914147417460678 -1.7603366406171574 0.72564071550466613 1.5858330789387181 -2.094796910346989 2.617401787641974;-1.5636118251953912 6.053698593080119 -9.5562982829540086 2.2422903493908173 -5.1449331985568438 9.5925346709480284 -1.5904488227236708 -1.387115304318143 3.8625591640268593 -6.5411495661286772 -0.3065196148946065 4.4914416416732674 1.544787164914865 10.193071428395994 -6.041688403779073;2.2406803266689215 -2.2250670539402844 -3.133020298187688 -8.00712088063921 1.0211142570658385 4.0427542189531946 5.8582950219615446 10.442814451190088 0.019042174416146307 -1.2016943797581656 -6.7369088315980576 2.2491819252553289 -2.8739019369847743 10.659746962213459 1.5049315579500266;1.380999292686981 2.768292123599104 -7.5759666553461082 -1.9076493361906846 -6.6041439098167238 -0.17892303226580694 -0.49457812451405286 0.27066022089690583 -8.2210169449786594 -2.3530385474464812 -7.1771199120600633 1.0765666471229229 -1.3922745877030955 -1.4866324785639831 -0.6991645164887168;0.96808195009371001 -7.8289117253664129 2.3319218848346299 2.3559493362282455 1.8408141810415921 -2.5860478939453349 -0.098714657162931124 1.0173455652671832 1.4556672762525411 3.0758610776689101 -4.2249477770793886 -5.499048815431423 1.7048235516722827 -12.580447484992707 6.6008138383423205;9.3698339316996204 7.3515077879765958 -2.8538684473883644 -3.8281350901418718 -3.7926497174046596 0.77426040302102528 -6.3742674525100362 2.6675888101433562 2.1191655672176855 0.38566854727584809 -7.8528363650991402 -1.0356794929833353 -3.724034008534554 0.27227857277142342 1.5607249717592753;2.4946470049854641 7.9986327411799989 7.1047939002544425 0.04303481848350825 1.5245700177084622 -2.614635470585549 -4.2591188025936706 -0.59291117015094663 3.9682487912677731 -2.7497468152796993 2.1778850350462831 -8.9967364709253772 3.0541060664433246 1.9201845891209881 8.6966732748472904;0.16042652916252095 6.5833669378734827 -0.15992540639165737 -0.83843945121516494 0.92886889155302998 -1.2727253032916561 -0.50370226514836902 0.66236741227477913 -1.3491569292484686 3.0422587943106971 0.086411520277494824 -1.4375603755610784 -0.21550299519244467 -2.3434110545889411 0.66921265879577974;-1.2631497761057033 -1.0710157686062551 -0.49767235058957382 0.060234873017636359 0.073554105242798401 0.37097214112229804 0.81134883763426435 0.75937523764376591 -0.91071162779329007 -2.0022812833328687 0.10542678483072684 1.6196968937146321 0.31399413539480625 1.9568181700696907 -1.8692080369935944];

% Layer 3
b3 = 3.170933510257572;
LW3_2 = [0.023398193286919475 0.25053661773741825 0.096234204594704095 0.027239470994719739 0.066261489443973351 0.053331091395147523 -0.08270367167794361 -0.034432447347970602 -0.035510170887842855 -0.039955991066635881 -0.093710587397266953 -0.063769771651391957 -0.051898183832924237 -0.12694578570906312 -4.2791200589672869];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
