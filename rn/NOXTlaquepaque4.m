function [Y,Xf,Af] = NOXTlaquepaque4(X,~,~)
%NOXTLAQUEPAQUE4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:17.
% 
% [Y] = NOXTlaquepaque4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;3.03490136570561;19.6078431372549;0.0212539851222104;0.0523560209424084;0.00632111251580278;0.294117647058824];
x1_step1_ymin = -1;

% Layer 1
b1 = [-3.0893828220865198;0.78715830474519344;-2.8849548575782795;-2.8456751098737532;0.44891426457640399;2.7957128960718638;-0.0061315651285474108;0.8055332937614551;1.8549985772990072;-3.0857471593355918;-2.3050673747015495;-0.41809530136029777];
IW1_1 = [2.3216453741799121 -0.29332981136979908 0.65782840166492318 -0.30103664883623038 -0.87672674255001493 -0.21598193795256104 0.046769337358524864 -0.53618987220322989;-0.66620926168093619 -0.84618772482384175 1.5858322272371828 -0.072738860323624407 0.057942410751114289 0.61955619607462431 0.28824760954115292 -0.039597611247887729;1.4308399788032768 1.7348886863952584 0.49706318860578819 -1.6200476137708717 2.5586374568657551 -1.8250341828839347 -0.70803886723366527 0.91147335603442303;2.918486243388442 0.36916473165585867 -0.53218203688824683 1.173656226695633 -2.3974251297732438 0.94885580828675298 -0.78353228001801456 0.0015486670239058635;0.13393347450196849 -2.2852868398580504 0.1122871798037389 0.38216189007133616 -0.0020174733902135217 0.46644601993483836 -0.509812186206127 0.17673412124991889;-0.66240314611874795 0.79520102819590854 2.4673702539076903 -0.18790901531117848 -0.013461283874452154 0.48091922375922386 0.36218877291302209 -0.33550421609842618;-0.036192690557848142 2.439266218989304 -0.67544802026255468 -0.21195126017247154 -0.018818861333712265 -0.1614828919187106 0.20347987196154757 -0.33332299588255476;-1.1749803412156343 -0.30877482162535758 0.82168260139876692 1.511945945342166 -1.0891671824319944 -1.7235417981123407 -1.291246638479709 0.14966110148832951;0.1674541216752094 5.9673314847539132 -0.69448797680223384 0.00034292207771913783 -0.090050757823936622 -0.38311325251428963 0.14151777071030702 -0.12854969155144022;-0.40464953739513665 -1.6827700321702364 -1.1368311676193601 0.25708152957063646 1.0293282953837481 1.0506078871514897 0.65378080943492256 -1.0306177452497405;-3.9001506091066998 -1.9447729668486167 2.0552117403147308 1.0565282732943075 2.9686710811757999 -2.5489774716433216 0.18410902919008884 -0.84799443678542707;-0.3535343664747716 1.4231508242350577 2.7974031463330578 -0.06219227010872537 0.63523349655305439 2.4523423746024395 0.76322836381333681 -0.13932252895348987];

% Layer 2
b2 = [2.0151515361241681;1.358542253827592;3.4444557820969925;-0.68248298701883292;1.2071612333283912;0.63799897900014113;-1.1881948687793387;-0.86029959280865409;-0.74319459713049707;3.8972947713874393;5.3670364160625592;-1.0806045108766236];
LW2_1 = [-0.42319472693063037 3.1250388484806222 -0.069535055062570114 -0.28601908493501116 1.1968141987631777 -1.4668184255117966 -0.23277384500133425 0.50757374398475952 2.7976346913127794 1.5714282665999406 0.13001845506570339 -1.8740828911898559;-0.31362992551290969 -0.61460449786599114 0.49882626447363521 -0.6608549009495861 -1.1863207799072175 -0.58255492402341824 -2.0881990334876548 -0.25364796250842242 -0.68830537065006236 -1.0993823641578917 1.1142389629451186 -1.2224021434372252;0.82068772572101878 0.090674083763731969 -0.092660474557394013 -0.70237057007463832 3.0416284026904612 -0.91216009537808507 -3.5476533055893467 -0.74790652251446921 6.2855327595699766 1.8823319441537463 1.0253507452448367 -0.13989379411369912;2.1151675591943189 -0.25323617450509284 0.58040827692345021 0.41319071090140158 -2.665924150905123 -0.08170256288255609 1.1590957903323404 0.024077619491864488 -3.3870616907139182 0.31432847528075114 -1.395859891300957 -0.2125414892262297;-0.079737099005941073 0.36297490663205062 -0.30415183746919783 1.7962765480354372 0.98926141355762187 -0.45167667322470512 1.1535951090004115 -0.34450507339075154 -1.135769753009698 1.2435143552550409 0.516780999752946 -1.0450848590396675;-2.6204966460561976 1.9909319906957739 0.23981388397892264 0.33677019930607521 0.85432444478020586 -1.0979851978880171 0.83061157013021403 1.7002627442355389 1.7004275436998371 -0.23051975404424549 0.039241278617382219 -1.497397913701483;-2.5359555283847866 1.6425852825854719 0.17407581580008397 -1.2128533214719164 1.3396207684240165 -0.70652451870847321 1.5604354813342043 1.7156281536099276 1.4820118331412995 -0.25663335368350759 -0.06951369499741436 -1.5635361249120996;-1.3246694767146401 -0.90643023430351066 -0.078403467409642297 -1.5688380443039933 0.88975597724277677 1.104229747082826 0.65511902079477091 0.61290674721771998 0.57844564933716502 -0.26187519851919122 -0.20050024978959385 0.010671790330344155;-1.8061925901427252 1.0697615359418986 0.97828558499022655 0.88373015773648789 0.27563257951423131 0.62931651350091566 0.86455445106806861 0.6596972103655343 -1.2059754220159784 -0.89527659721651864 -0.59818654541608085 1.2867121048030252;1.509486016067906 0.56999256679145605 -0.052956577431953068 -0.67196318570081626 3.0872104798654214 -1.1137846756026286 -2.109999681565311 -0.68535368241643135 5.3288737579783607 1.7877067459416565 0.97982943864539762 -0.40341628763397741;-2.4339851906954655 2.930074178410552 4.2073050152612579 -1.4617643598988164 1.5102503219487391 -2.7232540169824606 -1.238765361541347 0.59396096409525989 3.4936287696592325 0.71751570761558692 -2.3416364840512065 0.39356206250462311;0.4633541732892632 1.4558705377724999 -0.2270144950805098 0.28506863099999036 1.931819700829182 -1.2650300710944999 1.7685442279995829 -0.23890571118055037 -0.38467334693839811 0.12442467571244498 0.12849152088495458 0.54984131907388156];

% Layer 3
b3 = -0.48149713387472348;
LW3_2 = [-0.29413221159193342 0.065492262486610497 -2.9629572650264957 -0.79111368672744686 0.047261787113738511 -1.3301680970539469 1.4237906869405879 -1.3479844527941987 0.087401278449318637 3.0050371617576501 -0.87918164977505264 -1.2345316023274235];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
