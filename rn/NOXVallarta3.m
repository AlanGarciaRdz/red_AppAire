function [Y,Xf,Af] = NOXVallarta3(X,~,~)
%NOXVALLARTA3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:25.
% 
% [Y] = NOXVallarta3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [-5.0930228828378814;-3.9639229736892618;-2.8031341017640679;-0.95675418381559929;-0.70821698928054566;-1.3498577468765494;0.42670550762220727;2.8301193034354815;-0.59038915484123711;-0.26625393888965576;-3.8338191327592197;0.65612230584097497];
IW1_1 = [4.5640389457764492 -0.57709908608430238 1.2791736266506248 -2.1025799829215037 0.23040347458808133 -1.1610909180646334 0.19619388284110831 0.25976360403147419 0.77373400019577998;3.9166360451381523 -0.44935409138252602 -1.832429072268478 1.4936577520146517 -0.26873938823183641 -0.42341876947493895 0.27030256248343071 -0.46691897404356314 0.6450179732690503;1.6022730714210691 2.6901739632665924 0.54031255443385751 0.6032226701315988 1.107974336131565 -0.21641151320290164 -2.4340249592004168 1.1624591480978452 0.39592763984589668;1.3591830438623262 0.71755423682166952 -0.16227872276252311 -0.25670498000400893 -1.2796713400094599 -0.074914030456626049 0.18593455549598692 2.3838188210779809 -0.41937665817008984;-0.20841139950082474 -1.1375313061182653 0.084842293860267287 -1.3954252020460189 0.28622924438784292 -0.33192924189837009 -0.39107272981987801 -0.21962726764598292 0.25495067322290954;0.7930078628910443 0.33066236587485665 -1.9645632832723692 -0.0015415709795252031 -0.11934344328460961 0.75537995155530901 -0.67591470807184684 0.65261104667918757 0.72462906335134336;-0.76483357431126486 -4.3385280269745099 0.10458843966372602 1.3762256597465634 -0.37526786457481015 -0.24716190742905894 0.29544104164855339 1.8785586574946171 -0.33587149221564799;0.018077675664137195 4.9786571808517976 -0.060668831309110653 -0.45240647627626607 -0.034572222393915553 -0.18269217063503854 -0.094796790600845768 0.3228687929377333 -0.14933543810374569;-0.79459255597803236 1.3628245102003231 -1.1415402590639796 0.84354053499350989 0.031087702186976814 -1.0286291514317665 1.4043129656674926 3.0748382433755994 0.47939465256112501;0.0055402091890338762 1.2983939320260032 0.1196934182653904 -0.68126822909117823 0.0085045100468353792 -0.24909557846363231 -0.05614044059265353 0.14031245901286379 -0.098040768605179282;-2.5583927238901643 4.6749231343938282 0.44320101596193157 2.2835639916285375 0.11819851835006909 -0.65624430327293293 -0.95674949036542378 0.049827949512010056 -0.11540422469737661;-0.66963531729125925 -2.8257354539288366 -0.45294943805311089 -1.2150188933556021 -0.97059466765708446 -0.47751670178626399 1.4153262423810498 -4.575785676940975 -0.84275683354434683];

% Layer 2
b2 = [-6.0725482976566694;-2.4769174877357254;3.134251811903856;-3.851175660919349;2.8091330677159658;1.7500643648521337;-0.14507353690800345;-2.2882672071551373;0.47259731062432225;4.0817402613225768;6.0612309944030027;-3.7346272815159645];
LW2_1 = [-0.058004269345187334 2.1302641674442504 3.6120805650045664 -2.9313030751102236 2.1709500105387058 1.2155736728729101 4.1608447201103536 3.5836226728401122 -9.2187923004163768 -1.7808905250800648 3.2339631469055536 -3.8871561863059561;-0.094315009310950118 0.85818146189714284 3.0159547172427708 3.3328570777267603 -1.0713806413088374 -0.74467154474775632 0.61016992319308538 -1.4205722391174798 -0.53007478122085649 3.0416250598989656 -0.80854673666891508 -0.78893254384776224;-0.74744489972057593 0.96749961500659287 4.1427877483984732 0.92360799011000327 1.4638283799343448 -1.1149428184539905 -2.5659810662923368 -0.25318061587764007 0.14770521316645285 -4.0673438533236599 0.91174322600748714 2.6646200194401199;-0.65873677431533373 0.82604728156498253 -0.84072448511397313 0.86379716650201444 1.772711109505025 -1.1461100832222495 -2.690864355739341 -1.0820542736243803 0.14789427539157141 -4.2458403316650735 -3.2963667961002665 1.0968288457459525;0.10268690781491074 0.43632184290849191 2.2570671149405981 -0.17783819481973201 0.41435108589827224 0.67808032161163467 0.387600124462052 -0.37225314385336639 -0.20395841723063274 0.15250498100097593 0.91451856050952218 -0.82144210636872228;-0.85619710769634794 -1.6544855066077202 2.2844037986482233 -0.88180629251145148 -1.5660626163550497 1.2008949388488863 -1.8781877106740701 0.12380001959779102 -0.0034749074964022589 -5.1266370050781962 -0.59879309506658851 0.87732090274895813;-0.71989060631898183 0.30766414212674581 -1.1536365463624889 0.59062685493310896 0.62646463045699174 -1.1795504066581375 -0.11763330898324457 0.39053729182099317 0.94346387551665156 -0.066746245742951904 -0.44338746343504815 0.44826204583812745;-0.41067598038084557 0.26878934297780671 -3.3632935017338479 -0.76153367903549452 -1.517962837587012 -0.50334621443617777 -0.28002868399424141 0.8143460673617251 1.1038687411279795 -0.76045596301211626 -1.2093414071723316 -0.59941497174962155;-1.615966480911434 -2.859809490856787 2.4730562564378755 -1.6999242478409771 -2.9221918041893864 -0.67966805234101546 -1.8663336186476858 -1.048881162391383 1.7281058896732127 -1.5093604574214601 -3.710281097357615 1.3137900185415912;0.050648715119172745 0.70067648898968637 3.9544850918347905 -0.1804712529507625 0.66609113230402306 0.52048312583936651 0.27458498818334931 -0.70726200471416456 0.35160366854376762 0.24568758342922137 0.9824194281407912 -0.1123048479468209;-0.88265705324069743 -1.5205045748814312 -0.42975977284371458 -0.78566337354518134 -1.4113141588660523 1.005675765296538 -1.6955924156357784 0.1555445209652172 0.14861960099916724 -4.560476677222324 3.3173286333150256 -2.3192613440849015;-0.52291138284709671 0.70466714647412676 1.6388831297269189 0.52329726010512012 3.4165406482163991 -1.7801198369757358 0.29327249461121641 2.2308533333079477 -0.19407203559186484 -5.8344996691695785 1.1721452007069135 -2.1331922291819763];

% Layer 3
b3 = 1.6705518072248546;
LW3_2 = [0.65969929573257646 -0.57146194573101616 0.61026727701710692 -0.60325680732263076 1.9144455089727723 0.62685715326924396 1.2511416851916448 0.23254675244780104 0.10898752923950852 -1.2246882414404598 -0.7393101173701736 3.3044820917582234];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
