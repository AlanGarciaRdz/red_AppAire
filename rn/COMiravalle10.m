function [Y,Xf,Af] = COMiravalle10(X,~,~)
%COMIRAVALLE10 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:44.
% 
% [Y] = COMiravalle10(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [-4.3968131306686482;2.7358141938970171;-1.1087476022804508;2.0968442213984537;0.14928931030574011;-0.67323441886976165;0.63533248036137802;-0.01814558323517583;0.031649533230057141;1.1375996189491975;3.9451759418362333;1.1675147885983208;3.4352447297258997;0.88554822951232903;-0.83504368912791005];
IW1_1 = [0.056409306976547426 5.0644061040996142 -0.0088645873679036279 0.38158172851668143 0.19568508911838653 0.5575127859611444 0.12900143730957669 -0.12376540189494598;-3.1723381673489652 -1.3605684939339235 0.36415817857753285 -2.0061387228157588 -1.3088051487311927 1.1563944081984459 0.28671799101987977 -0.016451167458795331;1.0442374347860155 -0.15351472561639415 -0.27666308142313772 0.65820677386543081 -2.5305689737148871 -0.76087998350234198 0.17710930168051658 -1.4836683023594921;-0.30999826209893616 1.6786644048567492 1.0799718798334246 1.1421304450193164 -0.34044359941579994 1.8728983397825736 -0.28002856079345612 0.083403483223935593;-0.36533380020387629 -0.61450056124208829 0.13661664999586468 -0.58935199545454964 1.0007163636122698 1.4903706721843344 0.057751871076321321 -0.41140044973732304;0.74809578721424508 3.1310219455730772 0.92154791171089179 -0.22369720448841507 1.2167914872106942 0.49431388844986079 -0.37174625990546861 0.13353330349160822;0.50579372346764018 0.34723454534634007 1.4196495353056342 0.35645384723988899 -0.73580461866215896 -1.0046812006326544 -0.45012311325671039 1.8371557233438385;1.8365418883519238 -3.0498251171533286 2.5350714189056549 0.64923841890417122 -0.42265656384316941 0.6709393184909479 -0.45843296185760357 0.84399466683855029;-0.13821313375890612 -0.014357975606612075 0.42331765534088567 0.54617611332645222 -0.83776686667699463 -1.3035559757121218 -0.38943072674910384 -0.33734212198237234;0.59900524307633207 -0.68255056300372074 -0.013395811721393321 -0.34975502946822956 -0.18125574383352677 -0.61383352795667367 1.0964109243685054 -0.065158672869288711;6.0521299830597677 0.34753470099719475 -0.83107931990215889 1.0554467779415115 -1.6055168127959618 -3.4530579943649826 0.50589152756254674 -0.33525764135260611;0.33048714976666727 -0.27245944462350064 0.20761033999991554 -0.03958864878697229 0.75645754433334356 -0.099288627674682037 -0.3972242992873759 -0.11666049622106384;0.20137900104054993 3.2746396449038118 -0.042067308639528317 -0.064227710320896719 0.18358935326828996 0.7086557394355093 0.040367887882543606 -0.013388159352913823;-0.068028257586981611 0.639661379377096 -1.3033678988878523 -0.89805449043356944 0.30918594126044019 -0.94419654263606745 1.2374939061388295 -1.186451683123706;-0.13726969584412832 1.4568326160189526 -1.2648324273575582 0.21972223172816854 -0.78912982632811735 -2.528520707602218 0.57775147116519809 -0.96508658666643121];

% Layer 2
b2 = [1.0181286532104536;-1.3065751564726307;3.098258564561474;-1.2155428044244481;1.1801048666911855;-0.66012069083061631;-0.82508320731125595;-0.58438941618976104;-0.01695858308979422;0.37126322608548723;0.43451330204444583;0.73830493328415181;-2.4219779721842345;-1.5128378458181928;1.4258408828771745];
LW2_1 = [-0.07607989592570423 0.85952181034070163 -0.67732701381561145 -0.039428488313233014 1.0183835450034999 -0.26272700151331452 1.1460014231194213 1.4330460405364902 -0.51540960341789921 -1.2188230644511326 0.62681620255334991 0.93920088918116984 0.10635278050526578 0.38876769051081517 0.47117363764282005;-0.36271450774242864 -0.22795038837406212 -0.078132701941090454 -0.99420982403595726 0.32518972447960337 0.61498295035693984 -0.74579042501142445 -1.2346857528548401 1.5253565014341681 -0.42784644145059691 -0.93639411226673963 -1.1569255760004122 1.7153902070706859 -0.44144159846184966 -0.23253433291604389;-0.61851144806423086 -1.6264878998269439 0.95917306662475565 -0.75612306291645304 0.15507524544090617 -0.031460541862591611 0.857024442446223 0.76363692220879642 0.38401043184259098 1.0970984926402707 -0.43551502532651731 -1.970405022533422 0.213661544745325 1.5133123100415857 -0.28145794587644762;-0.12138584035550502 -0.2228687873309767 -1.0013582186812975 -0.15189635380854394 0.66381813031242032 1.1890074910476054 0.40823211576473184 -1.2395546170365821 0.48379439041323291 0.24894991842416184 -0.39943751251079057 1.3465447470697196 0.13467600804705906 -0.40785725432513636 0.091046625537841333;0.47916093920979286 1.3146599266322132 0.35002378332422923 0.63439005299088425 1.0800182995569254 -0.7725099855869958 0.75495431759853626 0.66159810733934732 -2.0275354493422975 0.66724850454821216 0.23425823677139243 -1.4222784187287736 0.86779624254842114 -1.0055406191375271 0.14615174895605224;0.24450750836579294 -0.65061541422983671 0.028326006798239156 -0.31001918150153784 -0.1036076365954066 -0.87172844642424485 0.34626091420188976 0.45614988508614124 0.3044312379789067 0.078685751208278962 0.54833036109962463 0.46304426977852314 0.02367490928107429 0.3987262619914505 -0.53295219551797002;-0.20333166973879624 -0.57500686986840177 -0.19933832851478922 1.0141633809777828 1.1041228641974619 0.73738088502253563 1.3455330673182619 0.26663624438974387 -1.6016373128797614 -1.4305756544958514 -0.12621350242595225 -2.3689583947851349 -0.69897793974186906 -0.5610678890978299 1.524720289614814;-0.4651753403916466 -0.88931805706224676 0.63023705107839134 0.15318711456610851 -0.28312287993743568 0.42795872228037052 0.41662277585433694 0.18205938750296852 0.40579551503884043 0.95052517540424197 -0.25880377406342847 -0.088166501327028371 0.69873573997345728 0.39801300596429567 -0.1181880483754897;0.010119596065167328 0.61523710476573157 -0.65899542744930339 -0.022913472529441557 0.29644319593367702 -0.76371378102902077 0.12694568296204389 0.0096203596481403211 -1.3360159121527282 -1.3338521331815867 0.16484049922483526 -0.29426852519004632 -1.2066622835010241 1.1593368142990619 0.0062584417399150702;0.42814493623871258 -0.37432328787820651 -0.18393572712118453 -0.59210478929018195 -0.30475629346742983 -0.54293982940584062 -0.84002703166654058 0.25105302068400426 0.73454145363604029 0.39677964993967119 0.034682364265429366 0.15584293459878756 0.3651046236230352 -0.9936618837253951 -0.46534049748792788;0.14628441615887511 0.72454766003954252 0.28600264501090999 0.04683886348523527 0.33138326487555925 -0.49362948936417161 0.82438267658476239 0.95752128293450101 -1.7586105549923698 -0.13379310852967469 -0.16727280880049475 1.0698415470644524 0.391158875640224 -0.15822600435315584 0.21416497756126518;-0.64292143007569824 0.10373890577628073 -0.11346561463018348 -0.19953882648523683 0.38506264735454504 -0.49405964338111846 0.15614219693067666 0.70797924095734754 0.37533564407430642 -0.061214414097375006 0.70020844129954407 0.41740255487412053 0.42281634631967213 -0.40253618643753752 -0.30111762995635893;0.79144475063507191 1.2242980395978991 0.33834074048564972 -1.2848327257535257 2.4282551196178126 -0.038553377502452996 -0.086223703770182361 0.62795138412523754 0.13977888297764374 0.13845394679647152 -0.74441270635282653 -1.8029588227472773 0.063866137313508806 -1.3369381258902922 -0.73205977923837295;-1.5650783125692895 -0.23034870377431252 0.44900820565366267 0.73611983753319843 1.5174722140537198 0.25925442500972806 1.5331191931747015 0.043913902286221468 -1.1023248962998546 -0.51544507445694343 -0.085428065224481722 -0.67176977698689277 1.2679603649400197 -0.19130341121686784 0.68287392004416325;-1.0118825709479358 -0.1781163605839331 -0.30288783689612009 0.12417878730264105 -1.9019858500983586 0.067645373410143428 -1.09614192690854 -0.4065608742557415 0.85157128896129597 0.38053336361161105 0.47250116553221477 0.6871378004659292 -0.12391189765230917 -0.18150742255407898 0.89405081371658968];

% Layer 3
b3 = 1.3726267468730895;
LW3_2 = [-0.71216614822059676 0.33330862612491585 0.34971141983386267 0.18856423936146313 -0.64373526690203942 1.2220505429945947 1.3994098158500425 -1.2092438411015041 -0.75585587498933948 -2.0506778203072562 1.2342657841436866 0.77796664611266253 2.4087540908435314 -0.68373328597671279 1.0621496811889117];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
