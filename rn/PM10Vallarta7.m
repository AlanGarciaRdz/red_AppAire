function [Y,Xf,Af] = PM10Vallarta7(X,~,~)
%PM10VALLARTA7 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:45.
% 
% [Y] = PM10Vallarta7(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.12820512820513;0.00782778864970646;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.71816376541225324;-5.076621868653227;-3.6959194159362831;0.73629651316231903;1.9480793021431402;-0.65482027037071522;3.0425236742108366;-1.5135961662626969;6.7062851190393458;1.7875104825357488;-4.0132253813058929;2.6619190960945174;0.61707634813317636;4.2836001589773955;-1.9517148535547535];
IW1_1 = [0.58493199913358518 0.92663054876890161 -0.25605982063546839 -0.40470551797773868 2.0700733487921332 -2.3030527076565384 0.18928412468214365 0.38565096250022712;-1.2657063416185816 0.12434930083804768 -0.32635795503182824 -1.5515508883188525 -3.242412318061596 -4.1706307051122158 -0.0010107234278013029 0.80028981904874119;0.20278019852229348 1.0628679926087563 -0.47497014421501138 0.29465256627194431 -3.9170184796296228 1.9251548891607022 0.050878836860396855 0.19852635185773476;0.37644809710662591 -2.5791348458939649 0.82811848232509955 2.127959513773594 -2.0501361288436271 2.0461089344023184 0.23041355762008575 -0.55110972904777544;1.544650362059353 -2.0363350914154443 -0.53966181319758966 0.30074599539733921 2.2858554827335147 0.70792611117969417 0.55975942781944377 -0.3631225310209425;-0.63918201350022708 -0.90627831288975658 0.53716923016879514 0.010396626811728382 -3.0012516109976097 4.1653574869490555 0.25143806534419633 -1.0176042509273515;4.3317381556734116 -0.1691343769614021 0.57729745641806185 -1.2625754381772627 -4.6410845526139477 4.9277620661923569 0.093580041816228129 0.38375799817269945;0.24382177418766582 -3.8175597260880689 -1.426687019068795 0.60631126176342953 3.0574799836622168 0.71431854887817581 -0.070106614699345815 -0.078104659200941728;2.0304931366270602 4.0082346194585696 -0.26469267976456501 -0.50839738313750527 -0.30789176838968307 3.0925132626551193 -0.66908969428466192 0.43695724075750864;1.2663077729490069 0.41032685060456436 0.028850745809086011 -0.20342952395510186 0.48176336937435127 1.2740517195895171 0.04859684607932159 0.038308098706452465;2.0430980344766869 -1.1905471340706129 -0.31164781731169316 2.7657021336695014 -1.3439523543383733 0.2805764974104335 0.19408908117962281 -5.3909306303557107;-0.88583211676960083 -1.7767097106125707 0.25059604722225837 -2.1593855621579614 0.75364141448380295 5.2416368147563688 0.090672486818742806 -0.62278291080290449;-0.72209090634891548 -0.51772780539311192 1.3911912556129042 -0.1127869215891214 -1.3418891521040026 0.18797861686656553 -0.21573410847180943 0.2173676223147325;6.715445673905001 1.5473993710639553 -0.23218006623912504 0.027859413816423088 -1.290798457486946 -0.25057259560976392 -0.75058371598854989 -4.1118806585442069;-2.0037568495474738 -2.6196929837611798 0.98663050994287038 0.43491017739166965 -4.4495695738646424 4.0877019920508086 -0.74236495576742079 -0.60673969479904355];

% Layer 2
b2 = [-0.36667635638325258;2.3149198730892939;1.6448590863663131;-2.2160166790374136;-0.66508514641034921;1.1799255983673851;1.1678002982699944;1.0505333813538882;-0.47421661782393332;-3.2699709972408888;-1.1389137450861071;-2.515047174476861;-0.19886696054649297;-1.0754069025163255;1.6228894674060663];
LW2_1 = [0.29470021579770866 2.1580945649325263 3.2494706637358259 0.67770680297310415 -0.33742267723941799 2.0952393508418163 -0.87547005050439586 -1.0048640568476206 -1.2674755212072186 -1.8842123209920936 1.481941056457327 -1.2673689522036853 1.5778134448769889 3.3271084516267484 -2.7178804607889764;-0.24666846501020293 -0.048544916565645697 -0.83300644618520625 0.95758021807046279 -1.218030141773867 0.27585468596703439 -0.399368985753217 0.029504584944869273 -2.1426248082935828 1.5996336047725714 -0.42336962564707559 0.59659871496065131 0.46134823733521518 -0.6329393767958359 -1.2557512779042523;-0.060584229763638461 -0.348724183533623 -2.8652687442336848 0.30104889743564983 -2.8505979911197956 2.3575091018796095 1.2653349031686338 2.0920738244133181 -0.0044615920830891158 0.16337906394302759 -1.2222368920035696 -1.2557957481642288 -1.8307825264696551 -0.3750268537103883 -0.59804112817824939;1.2041846394527422 -0.91255494760647105 1.8428555754686482 1.0824049614129672 -0.43940916410494119 -0.82790466726671907 -1.5386355333318793 -0.37641036885742052 -1.4667880272983156 -1.5432314557561659 0.029943317783950592 -2.0597074967403164 0.21837788932522414 -2.9634158262723447 -0.45818973106522176;1.4833912101478326 -0.6729598759370391 0.64335415565560572 1.2256311151565868 -0.70858345552234836 -3.5313551327253494 1.5480707130732827 3.2819369307938202 0.044504280862423182 4.3484447848084926 -2.1652496930477456 3.4366146432556919 0.077971591875619348 -1.880547865932868 3.7654565760753309;0.015197961981062982 -1.2145942959802198 0.45710236732208953 0.70211672103141431 -1.3461062359420581 -2.587574134187212 1.410562227861053 -1.2500183269876077 0.077174013579033571 -0.90185378889386791 1.6993625229347828 2.085850919659034 -0.84421737158520627 1.5806221605722659 2.219946504628513;0.027863503986487109 -4.0981305768791172 0.063727778419214856 -1.3118504319651862 4.003171237051081 -1.5953092962143722 0.50741496364561967 -1.059273418848661 0.066375474076720675 0.67464262887067716 3.3160667663893828 0.32580817217197688 1.2347726429103461 4.8901855946465087 -0.15975263541947668;-2.0080298832220955 1.4246686053483764 -2.5453326892106141 -2.7196347185736909 -1.7851899048103432 2.2405809781860522 0.37103634792201989 0.12127962218872647 -1.2275353494290659 4.7547126313705768 -0.35456585812322639 -3.4571715535012117 1.7474627861483096 -0.95340959333756381 -0.43350198523579903;0.17934138585632811 0.63455204236700047 0.8490705408015683 -2.1420239601990416 -1.519187436159142 -2.242025092345719 1.712193923172286 3.9738727318252201 -0.14203679229774954 -2.6065517856578158 -0.79488397379568687 2.9686063199671326 -1.6241943301823101 1.4297018016198042 2.5728083233554648;-0.72252362270335535 -0.31254917692052958 0.85944838121478073 -0.61855031447739894 0.84443515132449054 -0.95228997303587093 0.57251360131561901 -0.95097139394394614 2.1574719766068817 -1.4837531187255457 0.37143329609973236 -0.24323747313617974 -0.27395676807089797 0.86975562316541188 0.74509102087796797;1.6989620663428577 2.3077686391443049 -2.2527511314763107 -0.47358706565426156 1.3314173600046437 4.2341029361646907 -3.5078093802899728 -0.56391358748021514 2.9702602756497325 4.3424973245976162 -0.67831908299626353 0.80721526167166779 -1.6516396498568056 -1.8290096788401422 0.16869538077089191;0.49320105344260196 -0.17337820792996775 -2.1595816757383348 -5.2825588334663953 1.8063233766816533 2.88666725148008 2.9544386132113516 -1.05092761257662 0.34053978298688103 1.1359752669589405 2.7234968757063571 -3.1128570189359559 -0.49835857478431184 -1.2595920093650317 1.3750853854471361;1.9262451700168846 0.84880671700142518 0.1499836753739589 -1.1101100682848488 -1.9955854792536172 3.8800583202379522 -3.1165729414232675 -5.180116411632846 -0.68093710180946254 0.42260393970011528 3.1553770848149849 -2.0611240378360489 -2.4745621190331168 0.92249701785456417 -0.25578217828222166;-0.10187251604442994 0.8009805280207356 -0.18789122594685459 4.3533925301370386 -3.2590351723077813 0.47456750823775479 -1.1696277002141899 0.10765639812730649 0.12452241290896279 3.2017693893023149 0.29306461443342136 -0.6066405777122803 -5.3767409700958968 0.72507240543795126 -1.2558558883066733;1.2840887215950243 1.321401254584367 4.2255277951735932 0.7494899521011803 2.7874426697801691 2.2309016084681161 0.0012391265614668725 0.97456436934805279 1.7529338986805105 0.23401882666605625 -0.63149921737547388 -4.4476225262259135 0.55789027694882887 0.56932299807357367 -0.1041520581471148];

% Layer 3
b3 = -0.57124677622383457;
LW3_2 = [0.046218389380312974 0.52689611625231914 0.087577597958646877 0.18821652206345171 0.034798664202619886 0.072229594070045533 -0.045350057175845331 -0.17157285055512536 -0.038187442958656122 0.70847267905800704 0.078346738242000266 0.066924261194722862 -0.054953762264412905 -0.052581335560172859 0.056122875873451078];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
