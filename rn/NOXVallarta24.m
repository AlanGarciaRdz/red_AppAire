function [Y,Xf,Af] = NOXVallarta24(X,~,~)
%NOXVALLARTA24 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:30.
% 
% [Y] = NOXVallarta24(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.8456554607870101;3.1095755895848951;1.5331619479272209;-1.3633931403528368;-4.8846115988371226;-1.4198234397640408;0.33238206916673374;-2.5788512062131232;0.86091728410518142;-0.92635747248450417;1.9100200371440166;2.1788444065999304];
IW1_1 = [0.37944377141909647 -2.5103311344032502 1.187159087454962 -1.7465330016761098 0.74091770587168793 0.57821306620660728 -1.0250198614387951 -0.060776929568734032 -0.54513089535540604;-0.66433232001569642 0.46150701272536521 3.3418699478380951 1.4144886734658204 -0.59946321005005032 -0.41981865338319241 0.51587645576558383 -0.36078828079312342 0.08885602215724088;-1.9055767305253923 0.20956183726525129 0.20967520183245272 -1.5395006708161085 -0.54058368345011265 0.11017838638457866 -0.84479465519694208 0.53726389619460357 1.7827950338914214;1.9175814006558125 -2.1004161416794154 -0.28992509137850969 -0.36406260026938969 -0.42791406067292048 -0.31106911312560803 0.50023407132329889 -1.4462586326353142 0.29207861804486229;5.3280550126123192 0.4728234452531046 0.93139532883581944 -0.7031337979290031 -0.11347426320980342 0.26920628890075715 -0.10821059283948042 -0.65513989748279811 0.12298101712151439;-0.18359808471894121 -3.1627266668144807 -0.57002923757096202 0.92854539640653766 -0.15177088248333348 0.13660209731661099 0.33517435054340855 -0.36032076621988285 0.11605650408039808;-0.33040738363941352 1.5449151840451785 -0.54484202416758998 0.86677676008327109 0.070425734696949391 0.33501811027952655 0.15467544803432409 -0.060179903036638727 0.014935780235556778;-0.55940730364596369 -0.0695916347884903 -0.26883138667962458 -0.87743459574711968 0.3432829721940015 -0.25064001804963892 -1.0025630298473189 -4.5064234375698522 0.045227763567290753;3.8415598598512464 -0.18826041179018563 -1.0651555485155728 -0.30198626718978094 0.29361436611319369 -0.81506432755687519 1.3061748635015189 -1.893092671477199 -0.051232248523871107;-0.98805086443294432 -0.27338082821359921 -0.076985630469689259 -1.1651150262667562 0.26771999215905223 0.038430936463881869 -0.63850628650938157 -0.69936739907830403 -0.074586166301106163;0.31343549164938139 3.2590364444273896 0.38217971482147528 -0.18697320249591898 0.070908896112309897 -0.022983434736529716 -0.20249272169686833 -0.05885367975429219 -0.023944062711086386;-0.057415646783452672 -2.021648158086605 0.21993279681426292 -0.74397495783125733 -0.7299379049947694 0.087880318108008212 -0.64554980187360966 0.99520976948693074 -0.15305859725028842];

% Layer 2
b2 = [2.9634254118984433;-2.4701530315017335;0.47185924623344777;-0.18159173554826316;0.35446625664400522;-0.2373726601779477;-0.48961680382150291;-0.40325493488419312;-1.7913175072823284;2.5639400799902154;1.3987847435340812;-2.8825759658320438];
LW2_1 = [-1.79303797074156 0.64674246369875865 0.10764480072877872 -1.6545311669323015 1.3718389778224236 3.3788026699693541 -2.5527341927283249 0.5168483328904635 -1.5501442257640354 -0.54151494440790759 0.45840859257453126 0.5953751602961137;0.8709391635690944 -0.13985875402731396 -0.92863151610228201 -0.084765121352302145 -1.4470803884779679 0.0046379409739119755 0.40974556709800969 1.5746748342800589 0.69195173892984574 1.1171209289787185 0.041658661234442278 -0.23171542363905284;-1.578151553049864 1.96779579646262 0.072617567518030002 -1.8572200561898367 2.6848658306813808 0.97016684193824276 -1.8449615322817121 -0.49673335780225469 -0.57470189528044935 1.8170890762282468 -0.32698498447071855 1.0659262542093224;0.21172326706353597 -0.015658351273428548 0.10726093677600568 0.07309124982808661 -0.47084982833132716 -1.5461053067080943 1.0387192789915007 0.45785865808624215 0.34841570455605825 -0.48428122801162438 0.093730836414436455 -1.1860756009083422;-0.29241320553603245 0.82272764514962904 -0.073878781658473489 -0.63389099939388427 -0.42938152591501383 -0.69903357703297908 -0.95504392655017867 0.57246183489297564 0.90825461568011012 -0.42261358181061159 -1.3772737242127846 -0.074155179532590432;1.7146795327571023 -0.30446530655522808 0.15049698011894161 -0.95121245042489955 1.6998962665221693 0.79313892991059542 -0.30924059419061595 0.4265098083856701 0.16545398334731318 -2.1821672546774704 0.9311201651504345 1.7866501888987081;0.76284692803147802 -0.48524018897566851 0.15237317077718007 -0.69815297339338744 -0.70618554524566368 0.46713541217943677 0.6470787178227656 1.1642768499948164 1.1521998036217238 -0.99403850869884391 0.38088598899373055 0.45290732243506748;1.2345549771436275 -0.3957472895613624 0.15699141149846862 -0.27192670698538501 -1.0917004828862966 -1.172335540314865 1.1318949078042284 0.87589447044887803 1.1266316556208058 -1.2317992857475446 -1.0177296441531749 0.50335854475368202;-0.13842924931899905 -0.73464371895507119 0.05368406435751958 0.1044555812775394 -2.7841094603199825 2.1908266283167737 2.2663054425911162 1.6293345247359952 0.30344255501840806 -0.16281224667497934 1.6732259880066926 0.24480352080059115;-0.57818991607989945 0.12553963761519513 -0.85180045505548452 0.15214594533317272 -0.53889867299123606 -0.81518607766641882 -0.54588045135148544 -1.8718157031611611 -0.68059793525184498 -1.2221549243075116 -0.59355674945475134 0.28565470283114058;-0.30422533278870689 -0.10241841403020877 -0.092488344826871322 0.2899144837097466 0.63304225133407566 0.84930367107668781 -0.32442270240032933 -0.71879446270283098 -0.41275699912298841 0.52240340796085161 -0.99096079409004767 0.39871454422643293;0.8551947889477729 2.4104597459651247 -0.79649876248705054 -0.77721409093781346 0.21759802450045118 -0.44276435769977546 2.0614678751006452 1.8352686424365228 -1.1617627648810622 -1.9475856555017195 0.59042046450729146 -0.82644403148673218];

% Layer 3
b3 = -0.11113658657158727;
LW3_2 = [-0.15746300199372748 -1.6208137931389899 0.12876882001433848 -2.0289364715739739 -0.32005264087963864 0.57350234851469839 -1.135377802498339 1.1877907998603872 0.32760665511417264 -1.4481657626311946 -1.6508958627210208 0.18460303803470926];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
