function [Y,Xf,Af] = SOXAguilas20(X,~,~)
%SOXAGUILAS20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:21.
% 
% [Y] = SOXAguilas20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 13xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.448430493273543;14.4927536231884;11.7647058823529;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125;95.2380952380952;90.9090909090909];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.2110693207398837;3.0518266860202425;-2.2068967698476469;0.93574655557298392;0.38848644545269567;-1.3392742706254022;-0.9764503742049776;-1.6880717544563824;0.1746234188027429;-2.4917305439082749;1.5449255634696188;-2.0552671902923096;0.41961481632122488];
IW1_1 = [0.73670900261503736 0.11881118770371212 -0.06105305106563122 0.12033826757484743 -0.096151944844938067 0.24344485985854256 -0.17296908293169413 0.1498061457237605 1.1992217766434585 -0.096009155973879656 0.40089075261979323 -1.0942664425545285 -0.136328761586131;-1.408571736039071 -0.88370610125499249 -0.27244845824717695 -0.59418648976102417 -0.030727131224208552 0.42783507710894403 -0.56462579683143432 -0.94494460652621426 -0.45452278896505693 -0.27806242434877249 0.14386653769899863 1.4012122611735522 0.032830485873866472;0.54705051538806093 -1.5902642761369861 -0.042538774594247111 -1.2250592931589328 0.15001531094055895 1.1425792486931163 0.75190069133123405 1.4301341356170854 0.099020375910019234 -0.11865522896370863 -0.17872605555385954 -0.56966542786238406 -0.090471218208745846;-2.4804974427456856 0.26471737535063966 0.98781452503801559 -0.19784116493835938 0.12139395440647968 -0.14799880025158141 -0.1689185815906418 -1.3074309022257229 1.1934339618183341 0.096493362772350377 0.5259814484463774 -0.32958518809338289 0.053088967477336352;-0.54271692960194162 -0.38851047550876472 0.62579074956597813 -0.60873196282976516 0.67598592167328997 -0.20848247562327679 -0.90825196367022154 0.22852436380303406 -1.1189973035727339 -0.70281493217511659 0.44326989533252409 0.82565659907573752 0.12091369133360701;-0.55776431331230003 -0.57975069998914086 -0.78998109464120225 1.2556406191898086 -0.52230327867040116 1.7960889154139781 -0.1193694018904783 1.8044784927322917 0.12421890021049839 0.74699403917070917 -1.2295648435586004 0.59365725368488975 0.16101903167228182;-1.5761663061167301 0.23479228255751328 -0.51409906703124575 0.55987133928187915 -1.5539897171931496 -0.55678019419069458 2.6876084419085298 1.5842090415257524 3.2636182615788769 0.070825543595177537 0.48295440900047842 -2.6085074973524689 0.11207531752161984;0.81011763776003254 0.25084469402631654 -0.13734268271085931 0.60077690757750979 -0.20721533128079239 -0.42987241979531088 -0.54033229518604964 -1.648013914304485 -0.43231978890026745 0.089096056207797675 -0.034172271094068382 0.28363882775267696 0.30366443517567732;0.22144664459830093 0.5894049817369712 1.468406338350597 -0.041498767190819144 -0.47080289979259643 -1.6174696398898114 0.42827571881031101 0.11554374615798124 -0.15999130585198815 0.43044331747122994 -0.48944614401414371 0.52352747786302178 0.62758604660945527;0.51651074100990213 0.0099330868242508037 -0.14749516578029107 1.2920193885033888 -0.017123669823788941 -0.99009117783335998 1.1316469010630072 -1.7884859165713201 2.3057238972071437 0.93398728534047282 -0.40142754640740297 5.52246764349717 -1.3550078747510159;1.0578433334511606 0.33913118573916423 -0.17551072306293269 0.76824724893477825 -0.28332933124042908 -0.60689829944988816 -0.68502781213461506 1.5266615990760193 -0.56481666704713973 0.12519796333966571 -0.086953314413819302 0.38516589467743489 0.40525287260101028;-0.23819615944099842 2.0224088862191314 0.56782632555636048 1.6420058837159697 0.14271199137584581 -0.88185564896992663 0.65309486474125056 0.42505626398597973 -0.16453874730754442 0.59644720797701956 -0.0086955467287705788 -0.36500142044743655 -0.1343916761374726;0.39373587302614099 -0.81771443548863632 -0.16506999716104243 -1.3324697418209273 0.69731125765475432 0.79732001332559621 1.5131278963548209 -0.61588272924802878 -0.47687740785719546 0.036220654211119557 0.27585830255388499 -1.7565557172311357 -0.39702674093953561];

% Layer 2
b2 = [-1.9199265505790368;-1.5718807110311408;-1.009633490957363;-0.90153602139172273;0.096788386207531857;-0.34817228321978538;-1.8260733054004286;0.00095094629741558981;-0.62747400526780928;0.53452119157053579;1.709404012507183;-1.7635531442618946;-1.3013662915691724];
LW2_1 = [1.5617857396192081 0.88740618674308447 0.50603302524452576 0.68849365998845691 0.32061332638689977 0.61100358657485665 1.6282437850813485 0.16111072458328829 0.11750276182689467 2.1132033233198846 1.1270093438749262 -0.59822452807633286 1.481526475914803;-0.083818055833209087 -0.25422095692624636 2.4386900733149064 -1.4785860652848215 0.31252159007886016 -0.67105701743856472 0.04968508400300338 -1.0981665885623886 -0.69584485577890465 0.70565432377923576 -0.00077505927031544823 0.59614539503933517 -0.037420228891071404;0.4221936584272859 -0.15331700412354279 0.58860095855896732 -1.6010344210551588 -0.99055899137870895 -0.54360556229011525 0.204725686587413 0.72018342745188246 0.75771515324074401 -0.80535736923939316 1.0877070910145941 -0.40013612048338321 0.33916093629593297;0.84468447182995565 -0.14377865001400097 -0.016169440653293263 -0.54572204157122162 0.53953823220568975 -0.58410520471061445 0.9697811248359115 0.91747889208781808 -0.6792761888196136 0.49455385140868069 0.60246102845760341 0.10394250557081043 -0.32899607680805021;0.1003297832866525 0.98405284457696907 -0.15035981579233287 -0.20102543540701073 -1.1308751009174121 -0.71451093222589712 -0.86675284487188875 1.0072835254268515 0.69510410033899439 0.17418428191741595 0.84460164751177003 -0.91655903894600577 1.6256844657634288;-0.44729948317636586 0.11313525855980179 0.97856932868847268 0.90778533808697803 0.34782688517319332 0.76685196943101031 0.46451230158474083 1.5701037350075004 -0.42456073546204698 0.056075714699740709 -1.3657084319642461 0.23831603529383708 -0.37905508782548009;-0.49152014173615483 -1.8940012937958923 2.1782535657047535 1.1662370909767152 -0.32399050037375771 0.2112539162995597 3.3498731087760487 1.0207659364505268 -1.3116532046244584 3.6899436934944454 2.3447425540298803 -1.7312740788730046 1.7689913447072922;0.48247171079146045 -0.75745662543625758 -0.45509974103566869 -0.46372956923677999 0.35192918386688132 0.89457396226208541 -0.47130223460908011 0.39536204400969116 -0.37350985678468923 0.11799651662871079 0.056994476891584767 0.16266434633202781 -0.42606040427277175;-0.25226090946460139 -0.69007499392993044 0.34651684585903259 -0.28766239295104018 0.96993461216739485 0.38248464573499341 -0.064820499158971492 0.61380636810370393 -0.27871183306384212 -0.1120641020903315 -0.33435560522756724 -0.52336614468021969 0.62163854439978461;0.010953637107685377 0.40227385438834129 -0.66671606704621633 -0.8317448483694786 0.20915684373977517 0.1634605537948374 -0.10860482591355661 -0.74816451935371742 0.30320784755437757 -0.015705748350046081 0.8390421971033043 0.45186606455956757 -0.12583905855329544;0.21340487368234951 0.41745730779138995 -0.038123402585129786 -0.10060404911838239 0.51587174402737701 0.098584106706217381 0.33452388712523073 -1.6036912610660057 -0.025968824824003554 -0.0066141786013664446 1.801083566673185 0.26196968423819189 -0.18926231432597798;-0.39931889219574174 -0.28319474903803776 0.23603990462716762 0.14423638502211125 -0.71668730855383944 0.60991278730752641 -0.7741641903436326 0.033792840071964626 0.23824609688950496 0.13505624597133523 -1.3712154324723957 0.38534417427407708 0.16039153277745133;-0.21730059259091253 0.61976661633674435 -1.3112470318438891 1.3255706887211436 -0.1041476907734829 -2.3796181058405659 -0.054980734648234698 -0.58233833939376389 0.40448700049235986 -0.55385840850561585 0.74302182275467565 0.0025398467210789944 0.23682880755611507];

% Layer 3
b3 = 0.012239152112960495;
LW3_2 = [-1.6966788510702586 -2.6377424739819229 0.075589477383532 -0.71059222350654427 -1.2341533277706309 -0.64944001893631631 2.5012002810473675 0.72640738738739596 -0.042087444777187462 -0.24762709901836194 0.95023601936164792 0.95119329383272211 -1.9887672678349542];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
