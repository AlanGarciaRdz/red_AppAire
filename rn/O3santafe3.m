function [Y,Xf,Af] = O3santafe3(X,~,~)
%O3SANTAFE3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:49.
% 
% [Y] = O3santafe3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.172786177105832;4.16666666666667;10.752688172043];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.20687110623471794;-5.0325351509049767;-0.10070875956895911;-1.2430394552893931;-1.8421410958467608;0.77613473897799357;-0.64116280020273952;-0.67729604034012436;-2.1098007822458138;-0.062612248680732077;-1.150815628761459;2.1970318170711809;2.3172119955727806];
  IW1_1 = [-2.3308198305380179 0.090829588258540706 -0.45780336484214995 0.17370233770928384 1.7286943646091315;0.65212964115803973 -1.0510959799944326 -4.1102560654064542 -0.31380142814890366 1.6614494644680669;0.37711076281919925 1.7744390515481083 -0.34300290163526953 0.20604073875134812 4.0946993493175921;-0.44662290613260719 -3.6643046827065526 0.73909913060373345 -0.073856348686429776 0.20474209725213557;-0.10147471932103895 -0.13035119764530323 0.018226376534679713 1.5541045411661689 -2.8053875243448791;0.36633788385962929 -2.0058567197229649 1.5246990915623126 -1.0905955758723203 -1.1405911849012551;1.086756484004352 -0.04476646588939983 0.3100184804456767 0.21358320060972782 -1.8162329005228954;-0.78669348321104515 0.42867089685702253 1.2032241207985055 0.49847952409673141 1.3710312867763446;0.17801443528323188 0.15123696519332172 -0.26704373102438894 -1.5909038767101609 -1.0961616476309979;-2.7748724455641942 -0.12018966310998136 -0.36621136020295353 0.28552009885938423 1.6378923974287973;-0.56625506119130631 0.36049505012028665 0.1693645110877694 0.44662571428069431 -0.49137660408401695;-0.21599535617888904 6.1729186829731288 -0.51267795872007871 -1.0840048034732745 -0.20749929567559702;0.29694093050769399 2.429234501240261 -1.1399200129948295 0.28688501339213984 -1.5773171687673659];
  
  % Layer 2
  b2 = [2.8925124892659331;0.73992758852884855;-0.32394308994012694;0.73642946129581577;2.7412461376332473;1.9228681171514301;-0.50281356654357534;-1.0127313474947894;-0.38088221363277136;1.6291849085641668;1.9622729303991298;-1.2321614499102425;2.8937298765180657];
  LW2_1 = [0.53721531577575832 -0.468187768549512 -1.0958570317880005 0.84067363790526961 5.0932079121280758 0.1208916098530398 0.67710584839509669 -1.4422557261401625 -0.17741474180080996 0.04069322153872075 -0.3188416693166235 0.34079997640815868 1.0603260460623118;-1.5963985865326671 1.8023666285195206 -0.53644094719391699 -1.259562897553383 -2.0087531727247501 -0.48224300289847544 2.321268429377946 1.4205947020544614 -1.7389454772312107 0.98687679565488928 -2.1869466170341267 -1.0919682543322833 -0.48995685969497771;2.4097989222142191 0.68267951591538034 0.0014497999506533346 -0.41435968592364181 -1.8596494546222166 -0.13473618705141605 3.1311097993390828 -0.97271950791496231 -1.7179105185378742 -2.3465586740518036 -1.6629761158524823 -0.83343475874207085 -2.5903231129292492;1.0493726106518519 0.50586669990172761 1.2171906883654446 -0.10901129231541945 1.018175106810147 0.26222596717784141 1.7314640532036945 0.73848215925736704 1.4710745085003705 0.70376971102649744 0.49276052241609086 0.42461041286053952 -0.76557106310127265;-1.4933227250761709 -1.1671818594385108 -1.1183366660463461 -0.66367552218771209 4.2464476373915012 -1.7466746886451836 2.4387695947539796 -2.7660026418901609 -5.0949577085642677 2.3400754840532194 0.041407225023313024 -0.039869085387264448 1.014090994368313;-3.3513953418670739 0.59881174950786864 -1.5224316655162482 -0.11466536356336503 1.4790799532580887 -0.12434851629910451 -1.6242975505863162 -0.5942121530415656 0.62773716595318485 -1.8588160943360381 -0.51574110300481402 -0.0041458398209919152 1.5356817815538524;-1.4777583183045557 0.45834106949574738 0.33811359467132068 -1.5946525574841215 -1.3523328332176277 -0.15566601779091604 0.88000972038096181 0.86371049438936853 -1.5358258776203202 0.3736167981153064 -1.0990350766844623 -0.99483776195295603 0.16294834062630623;-1.1011209464358052 1.3277889047212479 1.4826642658082896 -2.7464418247379556 -1.6618231210619687 0.12168488870076383 3.2576276364533503 0.52041578078297768 -2.0009624132853796 -0.75764858494236842 -1.317734113601124 -2.0420060106390974 -1.6417854472938445;-0.33894714068113208 0.5325910020721627 1.1639594116843592 -1.8218682526137573 -1.337470170510662 -0.029211669020755941 1.0214029333662364 -0.48760568319930708 -1.5689663831586165 -0.54320772727575395 -0.81384529070062661 -1.2465309161629305 -0.42300632196736426;-1.3539772579397158 -0.24220087455746092 0.63804864572666675 0.017003261037204929 1.4093044259793004 0.15723245290719776 -2.3843604199260988 -2.0175502423347029 1.3371004846393799 1.7399131955956184 1.603424876587578 0.41400146785280612 -0.78419917536249906;-0.46806519265989949 -0.11115474843517043 1.8116062960429546 0.096355123146749613 0.13691233620087445 0.061449624504805352 -1.1727385673037205 -0.60773982359078316 0.00025472957267221735 -0.51842278867524927 0.47713920351318317 -0.064163692728272284 1.0487293314888428;-2.3527855966079079 -0.31227441840797754 0.66187642918855449 1.0566442225684953 1.3419839923976828 -0.27340039766754892 -2.0689868805798097 0.15522881927191137 1.404989732731345 -0.083917970949083598 -1.3716529990121364 0.37907182401886858 -1.5427339042997537;1.8792546129819991 0.44960514357677367 0.4215607712906731 -0.46366290641968627 -1.8980822169144678 -0.17463706687512251 3.6104189902479877 -0.80972744427250876 -1.7501241421871236 3.5396746850542851 -1.9813850069538752 -2.4891297757404529 1.5359343141921287];
  
  % Layer 3
  b3 = -0.73644557413904144;
  LW3_2 = [-2.4834965689994863 2.2798030524020634 -4.0089395486963078 -0.7720956770828481 -0.40212261665946691 -0.59689250339826738 -4.4904065863919538 -0.47594072290624989 3.6694356257387022 -3.1996849441798285 -2.9376584882961092 -2.403942774535178 2.7549346188459873];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.752688172043;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
