function [Y,Xf,Af] = NOXMiravalle12(X,~,~)
%NOXMIRAVALLE12 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:28.
% 
% [Y] = NOXMiravalle12(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;2.48447204968944;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206;5.12820512820513;4.16666666666667];
x1_step1_ymin = -1;

% Layer 1
b1 = [4.9267475042740427;-1.4036079584202357;1.021933547192472;-2.7006871205348251;-0.57955838200415477;2.7783959385859434;-1.178443472878667;-1.2095301647982475;-1.0602729970135474;-2.5920517329907455;0.14806219550265071;-0.023678299994655823;-1.6982842122557247;-1.0779253093751304;-1.120048170383015];
IW1_1 = [1.1922846222128933 -2.6823058408782363 0.52483656803124135 -0.41086813561439539 0.43794719375452001 -2.3424929280493418 -0.12093595787423216 -0.029007324474752096 -0.82225366627506424 0.84772798276702266;1.1581936826263681 2.5761629764798419 -0.19802939125144278 -0.023543756563962091 -0.34938888969625126 -2.3468986826194436 -0.28784121344591812 0.10594747984940611 -1.0039649099414898 -0.12720451350141257;-1.2180133855573754 -1.3477342172217657 0.98270263787423628 -0.72165908151622515 -0.29594117006302911 0.67054072518113472 1.0896034599259889 -0.1649812849806441 1.0557127747259669 -0.92734719005708965;0.78149296913185684 -2.6861983005928702 0.39392304321485577 -2.1667298243151158 -0.11960750287831405 -0.24485922219083667 -0.45686239990907818 0.020226259049411267 0.07400345909677572 1.0529558022232173;0.22375903496371441 -1.7178922822645393 0.52376329784022935 -2.1505618485080027 -0.53394183795765682 -1.1942848713634644 0.85298981224746351 -0.15285234838606465 -0.36847008934291081 1.9835069672769665;-4.0040154785346767 0.72498839132737636 -1.271778245986009 -0.074909339388125745 1.5770301662400306 -0.51144057554886813 0.11831406831974631 -1.2203399485809117 1.1879318566290396 -1.6810741321617313;0.11699956145963424 1.9282397140154628 -0.34722268142794949 0.36090632801278477 1.2768914113177254 -0.19445733868528137 0.51788820945341085 -0.63813666900678012 0.24171448228627002 0.39239704318928398;0.58357788629178386 -2.2635866204688777 -0.56215247972671079 -0.66363460521533468 1.2262353235468761 2.7507548134302913 0.32017575945438459 0.17186614434676056 0.12561374415319299 -1.0585359989487322;-0.71103610581959897 1.5560392766751958 0.25098622457409803 0.027144076955386766 0.77607359031725087 0.20488167550813816 0.40129165296933361 -0.16888514482823924 -0.49445043376140169 0.37762140451206894;1.7770029660858293 2.6635072659412384 0.98372209859152571 -0.58967248845964471 0.24639860916881184 0.27499631432126809 -0.069976483383930685 0.52593801347277669 -0.8477101950546112 -0.80953368528476355;-0.88662378653367535 -2.1742505927995053 -0.15360952667139138 0.8148488664052006 -2.2693234068708601 3.257502197833829 -0.54611423684777116 -1.0437677938090244 0.54067406886699376 0.088872072226753668;1.0498978850406946 -0.17184198404416426 0.094373252958644738 0.2833421236981673 0.4184847388814964 0.5530481332716124 -0.34967711222133729 0.31237040382073195 -0.37682345468587758 0.22685698618402503;-0.51231584329499513 -1.2808982624009488 -1.2155466144988329 0.64663614347873533 -0.61060087615151626 0.23349522625335528 -0.7119820790845115 0.14228482331743991 -0.60511386532456057 -1.0356807669320691;-0.73483614385291995 0.016557809889234418 1.1897549950447346 0.95496407701313102 -0.4243865286621144 1.8311747174047286 1.3657019369738137 0.42560071971352409 0.22818297699599971 0.57777301431337558;-0.15538062647698492 -0.22932640501881799 -1.1586115459719413 -0.077220356972939511 0.034150392943091794 -0.73948037885376505 -0.136958287500415 -0.13905916656695369 -0.061678682100892154 -1.4090944602882571];

% Layer 2
b2 = [2.355402294874652;1.6172721538804757;-0.65612597262914285;-0.27388409559352173;0.83096779703256141;0.38534575344276223;-0.26317019032285888;-0.89136852182499404;0.26789236429239488;-2.0856313503071924;-3.7621309632601969;0.21582372720426291;-1.2719939394956403;-1.6510589317805278;1.3481368893719374];
LW2_1 = [-1.1339137388954226 0.34518760816952371 0.38324473135379955 0.29797086033827525 0.11649907873989535 0.24522484802507061 0.70518610251344604 -0.43002330293323993 -1.2793117320856922 0.43831404039005606 -0.25611760685745494 -6.333482415527697e-05 -0.0050575299922056838 0.08550180808838409 -0.29553663160184168;-0.86531945518224629 -0.18398221656080987 0.12397205507167867 -0.075846724367978652 0.036843908295281787 0.0067319503580668509 0.87097838418621232 -0.30319957200892594 -0.67933078060868501 0.39474600776891455 0.46935407640756066 0.24033635919495538 -0.41916049042701103 -0.044636197406921228 0.37071040689518997;0.49792960747866516 2.1781957950454283 1.2821486753327491 1.966883922337421 0.64545543672222971 0.84987283922690571 -0.38301851725402225 1.069181659230938 -1.081492437378732 -1.5857745106253227 0.15459000779478957 1.0901447185643853 -0.3467339312775114 -0.41713559072534612 -0.0014621034928993396;0.48084816526904756 0.6743534834888355 -0.057247026678093588 -0.14661036830632668 -0.62552893604361715 -0.020590753854588764 -0.43752838107279912 0.72454335702943451 -0.65406916911649027 -0.035264175442048407 0.15798467164441565 -0.38227130235094081 -0.41241294686879287 -0.2106274609450598 -1.0583030956269526;-0.043001576119113545 -0.058761326703340486 -0.14739957071391172 0.042452730522643221 0.23444026450041686 0.12171357604856275 0.74892926393769166 -0.61301473247193872 -0.64331764983141904 0.019353194191879964 0.17988465270412576 0.44460144109924393 0.4522866870741058 0.66648610292606814 0.74096827780488805;-0.18766187285275948 0.20424322135197395 -0.15358315640925105 -0.057001774964323355 -0.45291023403041192 -0.02010633445976328 0.11698967427661029 0.36342252883194553 -0.79737998568556789 -0.14731792040938627 0.10662079396808995 -0.40811883115191439 -0.54549449157938468 0.20561713011552141 -0.618504350170481;-0.89633517701396959 0.36668971689308605 -0.50550096093227559 -0.97729624601173615 -0.84727223852483047 -0.37540024344308032 0.92092432361831755 -0.26318731664320044 -0.82223318173594429 -0.46982667120269661 0.26867799642256779 -0.57641404438462662 -0.15356455553170706 0.46816552006788642 -0.5382459034773639;1.5154519591487077 -0.5971905358440891 -0.77033775174147734 -0.9063148306141241 -0.46476989343169128 1.2164873509245997 0.062240775460202021 0.58983124608231019 0.20423709057614484 -1.147440652497119 0.88751053107276601 -0.047686938976025217 -0.23166317656423535 -0.24916794236534318 -1.0310670358905059;-0.97101999736215283 0.15499675515145461 -0.48080956943852027 0.27221427656226321 0.012789374317270051 -1.3779118721258967 -0.72620668428351631 0.11868612960995789 -0.43479421111475525 0.18835354525510811 -0.55251636771008439 -0.41880457566359985 -0.26046320437597636 -0.11624022234193215 0.86282675559328026;0.93779294633691002 -0.10265066070568478 -0.21930163050685422 -0.21914833173270318 0.02700812104708511 -0.3550459405166525 -0.16699075879273614 0.21469045757624025 1.2396634950612191 -0.40532790486937581 0.39783388394671176 0.18341349195554629 0.18553760817137133 -0.89748957169168109 0.31498927862534226;-2.0309767198455946 0.80603996881258444 0.81998136160393853 -1.6337499606623396 0.6531935183849088 1.2023862842876543 -2.4055761217587319 -1.3978549580617627 1.0797060408794579 -1.3068241744808191 0.1763431532274263 3.4699568940242935 -0.61976067355832187 -0.15581728330902034 -0.40219095865313464;-2.728480620057792 1.142959787251798 1.029197170815324 -0.78929074161773849 -0.4937913405777582 -1.0337702384219072 0.23705575782361399 -0.7978644886734132 -1.0640823751553352 0.44179768779674544 -0.47408819352401088 0.47107904204386197 -0.3750932631179823 -1.6442868928000229 -0.24341561362848413;-1.0446734978702936 -1.5649965900822342 -0.13495053183573152 -0.47541865179145393 0.52592483228519371 0.01160598321626688 0.71902437290380639 -0.20714791386613965 -0.66583887169738798 1.4507422625636879 0.394089042443168 0.42558228548231858 -0.42874278320121884 -0.57215423920745623 1.0704332957015672;0.12597919712230429 -0.47073338812113502 0.20347367332185695 -0.42601943953556393 0.22665780804219821 -0.58633593468969691 -1.6368392407779067 0.70680151526951318 1.4008884948875637 -0.015615817869870513 0.21046656372840972 0.34479705474668687 -0.63271312256461021 0.63123436149124912 1.0992567856738609;0.013010091943692043 0.0922379219900063 -0.076342716620981257 0.17237350271103227 -0.3540949437739459 0.45183738742185903 -0.61367993044522229 0.097447781772789815 -0.80391465839961795 0.12190494875895572 0.631319064925699 -0.36563612434517218 -0.79703336653676571 -0.302610580434371 -0.82729091313762615];

% Layer 3
b3 = 0.57132739537848776;
LW3_2 = [2.1312902749438996 -1.5296620116676301 -0.37582522475195951 -1.2926752679028792 0.92795039086939191 2.646500148469435 -1.1014269581141787 -0.34002451921963772 -0.50884496954305114 1.8043526728137687 2.6985862497254702 0.3915593061406632 -0.39983151848884579 0.70462067813016249 1.2854788714091134];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
