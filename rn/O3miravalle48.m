function [Y,Xf,Af] = O3miravalle48(X,~,~)
%O3MIRAVALLE48 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:44.
% 
% [Y] = O3miravalle48(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.304971027752364;2.48447204968944;0.056980056980057;0.0063552589768033;15.3846153846154];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.1800082271258823;1.0898671040069965;2.7684687538033259;0.84046741348425003;-0.11852990031023808;0.61207560928608373;1.66451081121834;-0.21060831864193938;0.91870698842200993;3.7018651635287978;2.6755183635622117;-0.7201969127617831];
  IW1_1 = [0.7841992773319546 2.1364073331330533 -0.45389936382691942 1.6611876446199474 1.6478594872342964 0.85595001974384421 0.76634760687583925;-1.4086945136278877 -3.0445025545689108 -0.7345039691103602 0.63581324032089082 0.68815268453971057 -0.16938869762820394 -0.97809124427035687;-3.2483392655178842 -2.9347702325171636 0.5611796607859364 -1.9489842592697892 -1.7088960894747989 -0.94578223466369071 -1.1780030242012713;-0.92480781648538291 0.86908882764153839 0.090517207598660679 -0.8012852496332733 -0.90431583829684437 -0.085964410594847648 0.41222237509590376;1.1938535069870557 0.36932526102139007 -0.077189839034479929 0.15167344117931975 0.64717922078784051 0.11099732124921891 -0.0028802394473894516;-0.48913155336110536 0.04088971988362429 0.99325627248759729 0.024488425917460397 1.1305772235191376 -0.13042835833295313 2.5986560829647809;-1.5926706023317667 0.2660608674329073 -0.97669789171357069 2.1481619885324119 0.67621854333459963 0.13975780016039729 -0.28111410690000715;-2.062247884542515 0.44473806505748498 -0.35364840486622851 0.25929586613829958 0.86147762540739148 0.26526157055683003 -0.69772179302515891;2.7009256343397534 0.43974811877785114 -0.77489747680494792 1.2319233546638573 -0.0094710124776702358 0.23068008690942576 1.4462123161100946;0.051827367453584711 -3.2667904617638515 0.28735588826826541 0.052493601441407876 0.52307254064477826 -0.33056293908175977 -1.0208873086229577;-1.2734898191997681 -0.62636823140926756 2.5595061537926949 -0.19745871145468943 1.1838826950250214 1.2555715192518311 -2.991108122339178;-1.8279955876947813 2.1916500257432094 -1.7441004618098361 1.7052730166105359 -0.21564918350354087 -0.055197778300929867 -0.046918524073191303];
  
  % Layer 2
  b2 = [1.6020477274058684;2.6868149105048986;-1.1258230056095595;-1.1425812806742608;-0.61587499316610139;-0.851930627614087;-0.26489203813391365;1.1755555744467427;1.4721645593850048;-0.05600682887217634;0.12617276163793886;-1.004388666181242];
  LW2_1 = [-1.3163429294445108 0.10046235374483792 -0.1860605827656471 0.79639758706755936 -0.31825082228430046 -1.0354007095712294 -1.118413076108111 1.964153350319614 -0.8673927562903484 -0.42141671795629565 0.11738930745294462 1.2192263110750474;0.81228665866029237 1.4708452270819516 -0.6452070696953589 1.2005301809003779 0.54673098164998146 -0.74300457112237028 0.17454134719004094 0.86657096334891148 -0.30045057660007268 -0.62998694718530035 -0.03024517010660879 -1.3533809747717995;0.12786408282768674 -0.11018550032788026 0.81578460132008201 -0.13859880487683987 -0.76484108188118272 -0.079950711472834057 0.77251394672570928 -0.037027995609610072 0.098103262187078891 -0.29440990686060126 0.0028636518173709982 -0.64045003496779906;1.7533972802599405 1.2921396653180095 1.0639691441412942 1.3552478455783081 -1.3545936384127479 -0.13231226467548601 0.44374072778001467 0.096230699623670923 0.47910509430906556 1.3099288204014543 0.24818446472026148 0.064183370137582171;0.38783331186077008 -0.22945294207469005 -0.28750001905850647 -0.43515568805116855 -0.51074364329145483 0.8210593704477176 1.2251980094189008 -0.88796821717701113 -0.32920943822532894 0.58484257453872313 0.8440042205699072 -0.25662467676164735;0.49549644987523356 0.034096182637999607 -0.14408329443793516 -0.31111303988786476 -1.9820258279347118 0.78862789217440532 -0.31765712018928849 1.5901370002747641 -0.1672812699534417 -0.5969262234583107 0.52597349817940509 0.24832737469251592;-0.83561607845803088 -0.27697140354254979 -0.22471819159799991 0.15185614792798019 -1.1167576400028913 -1.2335002594680722 1.1643519141185046 0.39295613489600517 1.7990509043291567 0.35630871652804524 -1.0052833262966809 -0.50010986248954004;-1.1599633829895932 0.57503728907571483 -1.2687214335842292 0.77062213489146825 0.84999207262616372 1.0855924719381023 -0.032100485771315398 0.69270079028882781 0.40179360213083609 0.57238884653098332 -0.68445351893730777 -0.21522484232195582;0.65689597073154526 1.0402841517766026 -0.31588362731802128 0.56407588203084946 0.98824449430369277 3.0849948089926 -0.40501432725867814 1.5008313159981355 -0.10892205994939505 0.75570838614130653 0.78891155106214239 0.17971882767415126;1.1479637577465549 -0.95671356053339895 0.25671614947528948 -0.59180420046855264 1.1676335198565628 -0.19347869749557181 -1.241369586359093 -0.1977244742916584 -1.2396408613429224 0.39769735352254543 0.091499286567530425 -0.17890427429069861;0.26375335090297986 -0.030296947384508256 -0.11679655473991336 -0.44382354002572072 -0.12304726198442012 1.0714234107378537 1.1668894188821481 -0.66332804971371695 -0.058664469157241189 0.90219573071164505 0.41705678736040852 0.38654926646766619;-0.40397550019045442 0.22379095685505943 0.0006822410693270442 0.11845414308058605 -0.47617362229924892 0.27259629054655599 0.34372679465614675 0.63072168341335066 -0.11025195789632666 -0.17571106077379919 -0.69978571559059066 0.051157062835606282];
  
  % Layer 3
  b3 = -0.41208636307318369;
  LW3_2 = [-0.38086698509735711 -0.98489077544421511 1.7111966644240155 0.92794580885303601 -1.7613805905244153 0.74931261263185633 -0.79269208347184561 1.1626408791237985 -0.55098552864820105 1.0850298279709047 1.5926137178061128 -1.8368974426669142];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 15.3846153846154;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
