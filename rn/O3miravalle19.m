function [Y,Xf,Af] = O3miravalle19(X,~,~)
%O3MIRAVALLE19 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:43.
% 
% [Y] = O3miravalle19(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.304971027752364;2.48447204968944;0.056980056980057;0.0063552589768033;15.3846153846154];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-4.5028927302667547;0.13914833988763883;0.77035655392103486;-1.5356872558684505;-1.2324270418545054;2.8410126172479573;0.28152118492598932;1.5020243689403261;-1.3948760386861216;-0.77940960210234889;0.37812459294569245;-0.83488897778257287;2.1638412402787734];
  IW1_1 = [0.77344044800324985 -1.6553637343755625 -1.0600135702838109 2.8042094365444332 0.02020191600153106 0.13471935448039721 -2.7267988047904113;-0.29653363688577816 0.38242509839307642 -0.5101450587819667 1.99992758309287 -0.035264680696149436 0.027095866383717082 -2.0517945216942981;-1.9828278352552953 -0.18182939944486165 1.1651863618382048 -2.5919879081905401 -0.20570395672499181 -0.26503236630546728 -0.57756740383502958;3.7511432108141012 1.5040481254859488 1.7908473479183122 0.10254945605295004 0.2430953731475827 0.18699035718836365 0.46377335345486465;0.60697536086461468 -0.90352873861787097 -1.5243160808735665 3.4557719147306014 0.64428667178828858 1.5348018844146654 0.98841835402264788;-2.4731474076884279 0.26016190018981589 2.1057972496564616 -2.278592154924485 -0.19301527605081617 -0.76811661506056506 0.50564805244478761;0.05637567238687119 -3.2623567846806112 -1.6613568733976132 0.27083595196037002 0.26533196907514039 0.041970445064112204 0.32503462129903016;0.3224034581625852 -0.62607310024809493 0.48257859575270512 -0.13456550467822642 0.12898903312584792 0.0012581440083364263 1.7208741593647134;1.8368055185914747 -2.0096504315508668 1.1809597468466861 -1.3648785550906348 -0.69650295626251402 -0.010027046243751822 -0.17410735881912162;2.2201693901477313 0.504611566459784 -0.69209767949162215 0.52447666614903288 0.63002231689896571 0.016874074185114489 -0.032549324439969121;2.3312079290187886 -0.49300985676443271 -0.11100300731532331 -0.34001246859663375 -0.61143774314594357 -0.0069845883467211317 -1.0372186788416362;-1.4620982896804091 -0.81488204450793322 0.56574724855802294 0.94762981816517011 -0.058136711751414868 -0.036566337521593807 0.70765982280492701;1.8275949665750433 0.24367422678267822 1.2474534907436774 1.423498684837273 2.7511263308686629 -0.084351727638882379 -1.4043106384901465];
  
  % Layer 2
  b2 = [2.6904247171802345;1.770545393349628;-2.6230090597400371;0.77307652838032015;0.93708387494991396;-0.56271462761939062;-1.3087254741561187;0.8077425705719361;1.8503105007183458;2.3648910460362011;3.3920347153696278;3.7960084681954687;-0.61025909852476401];
  LW2_1 = [0.89939967167420021 -0.19294044013167144 0.5815812039504612 -0.60352801362559483 0.48711972641485224 0.0037930457504193214 0.90347520933019132 -0.077528188221414968 0.3036271708695113 -0.17124783976413979 -0.29483211979213031 0.6171792626792586 -1.1754091424460689;-2.4380669826505978 0.17573173524790472 -3.1005279733155242 -0.02161392684988701 -1.7436506941470156 0.58004501042330059 -1.583619201020225 0.39651485405267523 -0.36359620532580267 -2.2087250619496746 0.83664000638698133 1.0962430606240845 0.28455695402766829;-0.28793593748560381 0.31784788883343396 -4.2609154979550672 -2.4058780384709526 -1.1174575844612686 2.6462125404228893 0.05877120372667817 0.22082502352649197 1.1485498518941402 0.64048377708744209 -2.0353992019617078 0.42832717695786876 0.051415211031936782;-0.65360474561134729 -0.81405870300767402 0.93127630047083509 1.0563594106078311 1.855312041847315 0.90447722272333253 -0.56242656182134965 -1.4986570777887089 -0.27639501426919172 -0.091135198475101611 0.7668765017056195 0.70455423097287007 -0.70064338221198308;2.2349356255618273 0.53211290326775817 0.28788148762028382 -0.70284118410931506 -0.34419477977064994 0.25663867254221601 0.61742205088461799 1.1235287895867501 0.29532426682310053 0.050329473879026511 -0.86570901287776747 -0.07691724012999053 0.82180739193638708;1.3474629247285939 -1.9778853960138474 -1.732055026352791 1.3072874176739155 -0.57289681462480313 -0.20252733754785468 0.073889074977746189 0.056872816529706008 0.10397872438855192 -0.66446962004975019 -0.81737762143869164 -1.309166561791121 -0.72571201864181079;1.2118611148562504 1.4448637716124084 -0.62230307412321983 1.3811685700199388 -0.20127957696471879 -1.5015609992906853 2.348165686252814 -0.78413607374149752 -1.8018072871336357 1.7723755389410181 -3.129339680837214 2.9391817789832957 -3.0574386985974287;-0.34851443611415645 0.27975727643669795 -0.2895704765717485 0.021154111060302655 0.83979012292606225 -0.29100288904111882 -0.48011307670967923 0.86496177848528955 0.27341595179439526 1.6253997468055452 0.21205175096189838 0.86377635610115422 -0.53370602093353881;-1.5008687728113059 -0.37268661985330942 -1.235965768625706 -0.58097005235389032 0.73815402702176591 0.024048426261292492 -0.79412389412988105 0.42509470918631986 0.23456180644160837 1.9664606394081336 0.31371635862983638 3.2892317410908642 -0.95423362747788953;-0.21173562609048086 -0.019529040726063374 -4.7885692110594018 0.29266259027612329 -1.6730960920742159 1.4872649753233791 0.67886551519732219 0.30201019905195653 0.88103470599397982 0.51716185827779693 -0.47278414015408754 0.019461640472741095 0.45417867345752294;0.53608456515856584 0.081341778544684176 -0.31379349377984961 -0.74231629126111875 0.62399079265039759 -0.75186219448554181 0.86225877193358769 0.31772461758248216 0.15579638002216353 -0.18063378726526225 -0.21520230357571943 0.17125602375106433 -1.184635963466999;-0.39484107899167409 -0.51691500439322824 -5.0540113117322445 1.058693649870613 -1.5565505404468518 1.3876462426992637 -4.3341053539704504 3.9275669691831223 -1.7520092271624996 -2.7869082300293559 1.2511638672043341 -2.3435674289817392 1.2576385459057924;0.28104475834283615 -0.17332084685171908 -0.36728684502000286 0.080409843639085432 -1.1350902132370662 -0.10099422242418346 -0.75896533855373571 -0.35197338511758425 0.83929052915155777 0.61766529711248763 -0.78378058544172369 0.52846469996899637 0.57502669662124839];
  
  % Layer 3
  b3 = 1.0117660101138337;
  LW3_2 = [3.5823234724616655 1.7384411265099164 1.3443036316649419 -2.3446006230874814 -1.6997694684751259 0.58507525578632025 1.5279928646656411 2.471171066764617 -1.2155757380289136 -0.64340088002175599 -3.7918632974977444 -0.24290162589445169 -1.4117682356160077];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 15.3846153846154;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
