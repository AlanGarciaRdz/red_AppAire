function [Y,Xf,Af] = COMiravalle14(X,~,~)
%COMIRAVALLE14 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:46.
% 
% [Y] = COMiravalle14(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.602428084477499;1.9833060774028033;1.7889238939462917;-0.30694058051439066;2.1592385326970871;-1.0232788137665303;0.065989863368621657;-0.87878735876225333;-0.41427469677268886;2.0818872887022373;-1.2329786970984733;-2.8743083172385671;-3.5748919816063345;-0.46507771723328656];
IW1_1 = [0.092828639509627983 0.18024696251511052 -0.36076884664967035 -0.17562173008419804 1.0405466148338458 1.3744819005295945 0.90058319340736981 0.15203112297618837;0.062757581944708568 -0.8907280601688885 0.5531173536550773 -1.1341574498298126 0.54805040444132036 -0.3206643859278776 0.16982312538283173 -1.2920077979606448;-1.1398326490193738 -2.7149986252393621 -0.36955529845886004 1.9060782050519074 -0.39806022124070045 -0.98358564870462828 -0.21949334212636001 0.064822392817644667;-0.92854272196091692 1.5137419188526231 0.46140075782130502 0.81451310652834508 0.69971419439896421 0.088167235368284858 -0.81926388064406952 0.091815410762982677;-0.12484310467875262 -4.6985881255684667 -0.25071312013153524 -0.30105904772654257 -0.20087485353306209 -0.65607026943550928 0.18102021148573066 -0.063591743304087442;0.13817917170520994 1.9843810117456784 0.035805270560867242 0.007877494580300402 0.12447441144060407 -0.30826888819789106 0.19636016034919865 0.050171890712166788;1.4179953908328349 -2.41468695198623 0.59836127318111065 -0.2320057692821868 -0.4009371980543236 1.4035097334777107 -0.07666164889860469 -0.14627201127732625;-0.056154882323313796 -1.1354343322252174 0.31645200783554067 0.84748826278536693 0.60385195768010558 1.841673950310484 -1.4367125483797927 0.19778624090132646;-0.2843598889101529 0.98734787283197212 -0.16083505966723904 0.31163126665775692 0.43316905209002704 -0.71542080200760605 -0.81518562438941466 0.15817216118375022;1.4127253110032443 -0.0073770758806105466 -0.088568568271409076 -1.5319215541571465 1.2946791850860764 0.73132649878528988 -0.34192456817448619 0.54265816279981227;-1.6889080639457128 0.39397211872202864 0.7928169346605447 0.32683849959592332 -0.29469143832055017 -0.45076781235952429 0.89862778484879402 0.5781164615597707;-1.862739496395176 0.18266694707604589 -0.2482104345962502 1.4723878132051491 -0.22168915729907113 1.1397300233852778 0.9548497142540584 1.5773895471356911;-5.5959046074532433 -0.54294267457589884 0.53762357863700017 -1.0690597466849387 1.4921382441317199 2.8151984495199338 -0.21646820687703994 0.10649029554588586;-0.033475350178984446 -0.17802774485903738 0.12383826986135214 1.6258901636870711 -2.9186185716366393 -2.8687998776286086 -0.44214222082419535 0.73340465741525562];

% Layer 2
b2 = [1.2692977967977461;-1.6038953342388031;-0.58413518275946841;0.74628344544426983;-0.072881410326922941;0.79739657804348696;-1.5852379779274302;-0.069721080910828598;0.38343012095433293;0.99122561050279978;0.62058704876886528;1.1304601288069975;-1.2972413021239391;-2.4061163916121293];
LW2_1 = [-0.74580106307292848 0.0067934605704792622 -1.3714795340068977 1.0624755477440182 0.85792164495513135 -0.56951373972358998 -0.20837031476455681 1.639533448752212 -0.68929660295139394 0.3827150313553101 -1.4060394466071373 1.0087856553341943 -0.091828053456667932 -0.39932477956269835;-0.46231076042570352 0.53117200462399472 -0.3010978270219471 0.9369397643245968 -1.5709789225290098 -2.8400188527473613 -1.3563775342433146 -1.1718596290197527 -0.90480222539267274 0.13115797943288951 -0.60386652203637869 0.97032867197573414 -0.064008754251808672 0.19895647352004914;-0.032253696984044344 0.41182489684259105 -0.20851201831770316 2.2228395545805602 -0.36573148534783512 -1.2733676385361559 0.017258348693019537 1.3011981461103903 -1.3114661197149355 -0.32846827648117138 -1.5404880245206649 -0.56037815249824185 0.40570389324809641 -1.0041352066188176;0.025122406018513208 -0.43369906678699649 -0.0835838301316459 -0.16670081683911134 0.66027147875529923 0.15146481021040992 -0.7642623540653144 0.49338866411443405 -1.6586049738876651 -0.47444694351232797 0.43219495544792946 -0.76776543644550144 0.130406324562862 1.0015113887471587;-0.054622318620296012 -0.24009765944866066 0.14310974767812695 -0.019506235164388458 0.43337008487130629 -0.033935544236492358 -0.84289195541121353 0.62324630650760493 -1.9365458480054019 0.2117822101006209 0.33756778940923504 -0.37684204483262818 -0.0191220748789474 0.80844497796607473;0.15525311764177441 1.3297177986631294 -0.89457785023668523 0.9391249795451031 0.56000716838657738 -1.3322956147045124 -0.52860536977856387 0.6719769367650813 0.10885000733530015 -0.57784085202481505 0.48449836221257031 0.10145338251027082 0.91199180758037579 0.28718372815684123;-0.42787190192929347 0.58580290535363577 -0.19535654531187641 0.79299443672058234 -1.7813067650926473 0.66080633858999471 0.32769752977558453 -0.16776227045305042 -0.70336096261353231 0.80704131160903192 -0.51702505125204923 1.039589129550277 -0.22213365180176597 1.1884105950876305;-0.34784139107783607 0.44426606199693019 -0.14922144997661602 0.14156996058228724 1.1548830031798665 0.52980751901719025 -0.54473870522686896 -1.4725186225600371 -1.189606341337371 0.067469053453039884 0.23730305685321468 0.52721963122613669 0.28221762207744194 0.45933943565508462;-0.43235261387241608 1.3916644890517897 -0.29681328793786077 1.0250645101225651 1.9503647986101129 0.81736685596699643 0.69832991164385727 0.34543979043857903 0.16273282377756793 0.027415905324133544 0.24350616770975855 -0.62588289576602407 1.5960270917942569 1.1761585517387938;0.24285881717658414 -0.44979491474358424 0.12896763243486276 -0.20410472556998027 2.1514022585090942 -0.079853252956947562 -0.13116468585874691 0.044988124127006396 0.28242117598341759 -0.69372761265495553 -0.10314845585895838 -0.80350654890528939 -0.0026828426379928837 -1.1845375774654554;0.33659525822846881 0.87432343072932739 0.17195782884640617 -1.3577977753120085 -0.76406010315792006 0.74470352469049306 1.0389701544069962 0.46979221582406605 1.70184826882231 -0.23335054015401618 1.2471448224941117 -0.49940674737845514 1.2073315122173798 0.64904339241096898;-0.55804499659789686 0.03440661523313579 -0.18328340101683985 -0.28358222898017521 0.58842020033371978 1.1531080399333502 -0.57890952654559158 -0.4610874880156155 -0.87601560224923269 -1.1037017840468526 -0.26735518561594218 -0.081110560408605509 0.51231841702413117 0.48158884686671688;-0.30043234306408229 0.058870754735164559 0.095485909844671965 -0.94559956632449815 -0.56651614554799867 -2.1303263195061946 -0.4792372142172821 -0.50741637766193115 0.27960030638605898 2.4885317150835728 0.89614619714772681 1.8200109516978591 -0.66568747776040826 1.4209612591683085;0.083179422974397718 -0.89950393245739857 0.04332564664168042 -0.9892292468880497 -2.2688853113761014 -2.7604944133100551 -0.57029586787085507 -1.2969259161507238 0.85373164456687889 -0.54639889779230011 0.92955888325359748 -0.40334243102802803 0.24541478282594423 -0.39457199933151738];

% Layer 3
b3 = 1.7667187292070288;
LW3_2 = [0.51037357307828979 0.40756964709963622 -0.21750314182855471 1.1682344796487611 -1.0476204928690263 -0.37986530904100685 1.7964126699462504 0.37357764091853973 0.17603365289181927 2.1487657075888258 0.53263922728499791 -1.0319005419696849 -0.24828342706373036 2.6409995517078202];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
