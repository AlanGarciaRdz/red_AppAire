function [Y,Xf,Af] = O3aguilas13(X,~,~)
%O3AGUILAS13 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:34.
% 
% [Y] = O3aguilas13(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.42005420054201;35.0877192982456;0.0561797752808989;0.00588581518540318;11.7647058823529];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.2726674979240928;-2.1826283772845585;0.41805488942894664;1.9421579029561968;0.41513416658248553;0.10812266240441858;-4.3985416730407838;-0.78343032339860785;2.0198578547374488;-0.91681399619942194;5.4105980381931644;4.6664179967145811];
  IW1_1 = [-0.39463006526234601 -1.9970065486646535 -0.065167193838191431 1.331404923206809 -0.49898402547168624 -0.22217904751711051 -3.0476654286863112;-0.46248755961329507 -1.574499615075875 1.885247184780134 -1.2928898578585772 -0.45575308589846497 -0.3678690469492093 -0.78581295240052351;-2.2650269856551231 -0.14831397530947635 -1.1824670700659645 0.10264791675734146 -0.24899739370186733 -0.054108384473068601 -1.5909971994221468;-1.4917773733937532 1.0339983777033586 1.0280646485295131 -0.03195138795963999 -0.40381412282667711 0.51787556362583265 2.3911605547962473;-0.57194550861127447 -1.7899443913338344 0.26971145525322782 0.38840730676645296 0.23870590973799066 0.149752231060816 0.49145578977783244;-0.011408472838237831 2.116117310501719 -0.17430375545975799 -0.52062863849595065 0.018888568620328689 -0.39548089022036642 -0.11882200127934231;-3.8387652592810877 0.33574990837014695 0.29264108502146907 -1.8575482887407313 0.39278885908142924 -0.070515581077266867 -0.63723376746783289;-2.3340069801358574 2.8593464984625161 1.872529011112438 0.61080580280023267 1.1557610497869342 0.20943842861969106 1.7155526452897414;-0.029378224243738232 -3.3367468343109157 0.31052051485669385 0.71172234527320954 -0.25610713452405431 -0.32886157301067992 1.3040646445905884;-0.58936703870527563 -0.52106428564965712 0.14826116785956947 0.11004071937442311 0.3684657480648959 -0.1647855432865965 0.27280175473512702;3.3019817983254933 -0.41336930057782612 2.5007112368416622 0.54520615176023146 -0.12728103800990062 -0.032513459469024245 0.55577603572689371;0.94679029103710755 1.7856428722997748 -0.28125114364310089 1.2548088560545838 1.277941935418007 0.0055810263481570789 0.4362408020696773];
  
  % Layer 2
  b2 = [-2.2560495848007549;-1.0335952310249332;-0.56448042126991615;2.8456021295974909;-2.8507687978543537;1.8996673988483153;0.53482372249962062;-0.75528152711292951;1.9431010369492283;-0.71401626547088803;-1.5578388547751738;1.2611875899787373];
  LW2_1 = [-0.066836893429239305 0.080246355361635296 0.18341092317761795 0.30664874928346136 -0.36000937347815065 0.076144179973612336 0.54263400464287947 -1.1415277237749608 1.3638206870640839 0.24107697032121989 0.7134396378991934 0.29916867236023137;-0.69072953034683238 -1.0078002503097949 0.71195702305587472 1.4038586399352755 0.24786298651620073 0.61935268456824821 0.43760795956169385 -0.2912003451768308 0.12543829685192892 -1.3967946382721175 1.7427281846375391 -2.6156496732089409;1.4877405418157221 -1.1226110335738078 -1.7054361772663005 -2.2435926411146117 0.23836673470238604 0.26901089436514392 -0.092978318512449587 0.30774163505488045 -0.66088195933070282 -0.1249334368033562 -1.599090383861969 -1.058832263985223;-0.8857175205770691 0.41054452540515884 0.52550106350165326 -0.65743116088886355 -0.21956794528454987 0.46804220232606059 0.13253544464959391 0.97134673749374112 -1.7442603843777285 -1.2911599728911711 -0.5670022303553065 0.53184139955417664;-3.3277103323519217 2.423475769405691 -0.052052385979572069 1.298102708009176 -2.4865209228279133 -1.0682725169356775 1.1250709416993714 -0.85716180804922448 -1.2572118324903165 1.0575988969211607 0.5887821484644411 -2.3955839183899008;-0.25063862881807131 1.3489526652824777 1.5812907820346838 2.2755561289042845 1.800766628356735 1.9751765239017463 3.6998324884919014 1.4163051319094724 0.46186990773240061 1.0849071550940468 5.9801515468724213 1.4327157840577236;-0.560760292328079 2.2867809129306509 -0.59086853204648204 0.83797347128695898 -1.4198985152901464 -1.8370329754890573 -2.6453855824398538 -1.6447416212534747 -2.4493594116322037 -1.0679514512450561 -0.77698297236498037 1.9305621373419386;0.82690549565638127 0.20072570369300119 -0.19054009328637236 0.20235225721663547 0.886012087718694 -0.078406352742097743 0.60757364792959312 0.072692124153131962 -1.3172709366414015 0.051179524992293363 0.74667699843777402 1.0265738128410766;0.73765420085610733 -0.36023788160411291 -0.14660467521285542 0.4548383898778865 1.0566596736478129 0.40942588392365692 0.35743097142781355 0.15411773366666351 -0.80184843735741373 1.6508505222497212 0.093097633085835296 -0.36281385178651421;-0.2186217200180299 -0.17453901624983295 0.071633483970870063 0.50650113332476232 -1.1343927603435571 -0.89098896269525241 -0.0096008922624140867 -0.26276713238308685 0.94326639620656572 0.17085104306741541 -0.30084049610030505 0.087969426590757793;-0.057069116821978932 -0.0084147688011224318 0.32460905858110317 0.05592378287012606 0.58132578752133968 1.4899581314497703 0.89873475602738317 -0.69918272674176496 1.5385286854183562 0.93787752221188336 1.5528745589828814 -0.61424206339173948;-1.2592454407613225 0.38375369850267183 0.98463775289776123 -0.74698171746854514 0.2298998800501765 1.6379763915420222 -0.14614507705632868 -0.075403908513502746 -0.32916859287944716 -0.99103580692752014 -0.38547346902421997 -0.32287343678680225];
  
  % Layer 3
  b3 = -0.84068396123067179;
  LW3_2 = [2.5643214702973203 0.48682015887404234 -0.87144328391554315 1.7379756914250777 1.572744156296936 -0.73256919851587321 0.20650665242107044 -1.1539135053868814 1.1908113527835105 -2.0095350401029508 -1.0980619917108243 -1.1700598923288328];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 11.7647058823529;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
