function [Y,Xf,Af] = SOXVallarta4(X,~,~)
%SOXVALLARTA4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:30:04.
% 
% [Y] = SOXVallarta4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;10.4712041884817;0.00782778864970646;0.0208333333333333;24.390243902439;0.02710027100271;0.00630517023959647;90.9090909090909];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.2164091388227019;1.0285883302935617;-2.894058450680145;4.9642587620963212;2.7237401768769103;-0.58724551292539917;1.1965495894528142;2.5085987681774937;3.3196313286862842;-2.4811389313244687;-2.992874845364498;0.44164124439089136;-3.2512429471940809;2.9738125607909138;2.5523988102493189];
IW1_1 = [1.7877238476953818 3.4730014043989681 3.3278261627820465 -0.87285256918798781 -0.21071773941422661 2.549048913355715 -1.064267268963021 1.6018079415011053 0.75431626083323777 -0.94337296719940944;-0.75950538757081176 0.27960879732806959 -0.53883714364485158 -0.16759421563350166 -0.070502581786414165 -0.34785917963368967 -0.66300324175274516 -0.55830269369321861 0.8009814879929249 -0.23771671509279221;0.99270487871238156 -0.23799377814100484 0.21412562213794331 0.013603106454466538 -1.1676589569857938 -0.58585958390929926 1.8324913779337781 -1.6621717195706969 -2.6777775466314107 1.2340161612766365;-4.4234056276216203 -2.3073196577740034 -1.8805466745565775 0.54885771141625705 0.73731751504046439 0.49391318417041274 0.34966129030151644 3.2530311302632136 0.14303590078247821 1.3167211681801136;0.42831039994350539 0.06478853736510029 -1.3679364953122117 -0.083908833103083141 0.57478935865683467 -0.55938890928648344 -0.54241619068534608 0.47026010015557784 3.5409085801125579 1.1658638164265869;4.0586798508835829 -0.73632979759249773 0.62615479231816917 0.7751840815726676 -0.92339575105987659 -0.56292344619908929 1.3234653201891085 0.066871604964687512 0.28698571603972323 1.7539639692695945;-1.1221810914490729 0.28721037282449891 -0.48105174573683579 1.7156386003243966 -1.2204565527285818 1.6186708111617836 2.0215638850984328 2.5306626882468062 -0.074009641125211315 -1.4205246042566926;0.026489210838649413 2.0412002277353603 0.85395068952577047 2.5022146753193075 0.34608235665440434 -0.30070755997418641 -0.86826077385624045 0.39299371610633393 -0.25365751350716187 -1.4596129108714391;2.1384873407039846 0.22672206314756402 -0.45723930381637851 1.3742325017483541 -0.127923302217159 0.029285254045618596 1.3153573929135456 0.090809967594258093 -0.16140343964542866 -0.47645659173559235;-2.06930633413302 0.51781032562652174 -1.924007344279697 1.0892776449021275 0.11911244089549225 0.19467949623022066 -1.9676736485494681 0.57836813522238584 -0.40411334603650978 0.17830512408817634;1.8751000908414159 -0.8990987247679042 3.0951765428260507 -0.81199284198252197 -2.3000605459581216 -1.4955129151426987 -0.19636114386397985 -3.5317141257254954 0.038915788963023834 -2.5679500193914362;0.50513257991467431 0.34977035577517462 -1.5924791455453562 0.26668855770602273 1.1139648649699796 -0.52330225063909519 0.19389848784249888 -1.9544212139485606 0.58602248925197387 -0.3267945451412424;-0.24810506413473157 -0.1355702436478271 -1.9953292361816259 2.0637500109371865 -4.4237287524461424 2.7527334984997434 -0.24444227439649069 5.991235728199932 0.41933036386178402 -0.91573442668271698;-0.5556290246196125 -0.087916875110536377 2.4544314932463132 -0.95186461191050376 -0.89377730819530288 -2.6310766492050708 -1.7942180543569333 -2.0937556363057102 -1.0696696332282736 3.6100647432988784;0.85159445664655975 0.43898520748499686 -0.64236212169513818 1.527747632734052 0.92981200210815351 -0.39422260461203107 1.4799517359408321 -0.3519558622950793 -0.039166725537787474 -0.21212727599328171];

% Layer 2
b2 = [1.4123531975918646;-2.2209361404289973;4.589838182358867;-1.1055404928835371;0.50992652171123998;0.37637635741191849;-0.26124507696278843;-0.69835834518104067;-0.06121847617471593;0.065037871811433265;-0.66459079033241242;1.2411153578663205;0.14511771836998127;-2.0059201755998028;-3.6256183556455404];
LW2_1 = [0.46426960576271448 -0.29449133270905664 0.79562792084357437 -1.8504411544090249 1.853438119090189 1.7853980963865386 -0.55200387100558113 -0.97634674486505579 0.062983854043253421 0.26736378675826034 -0.46160665915606336 0.12225983609288091 0.24679195854469868 -0.4024312312151801 -0.41221102408832233;-0.17068681844788711 0.08041168402522389 -0.73121357877689075 0.6637637032796434 0.53861954151298475 0.75670330636993 0.67087169939439606 0.36465290992297295 -1.3238851162969649 -0.4000206689447553 0.33351458252399729 -0.26594922365010448 -0.51777170156796359 0.83122215904807684 0.99264492966083473;-5.2861520584401926 3.3838271808996407 -2.6517473076849076 -1.6318412006223137 -0.63162232408358099 -1.0494026923311324 -5.6158299284657733 1.4547266804165364 0.77132688330754362 2.6722284345000178 -6.2221386924954247 2.8957723619200113 -5.8737956008880339 -4.0969459272554687 -1.4958023686848891;0.15196823891282296 -0.32713702347257101 -1.212742129473968 0.51068246294645725 0.34439189348817817 -0.011341650463490276 0.0059127756025147025 0.2393892280324863 0.23853256356755895 -0.59676841548068116 0.022440414784773783 -0.19312937521285409 0.014725518089435955 0.015407022911449507 -0.14735273911492799;0.19304828026233342 -0.052802972481517087 0.25572439220438692 -0.10491735750457487 0.24591878657668695 -0.73517955249353661 -0.28979352516994183 0.1621221766057194 0.64143777268887492 -0.92809844962227062 -0.17737572512103855 -0.11253681181865133 0.40197139571350843 -0.2039746400828184 -0.18974276525636496;0.038544258341726367 0.11464701981115125 -0.034130639104246255 -0.21185596367348783 0.023110979142820468 -0.10817591186997699 0.19311027642608503 0.11041058557497611 -0.209268902945665 -0.50753325057879939 -0.17712535817605141 -0.11823557580306404 0.13670841820677376 -0.021735892484680008 0.24077622070721513;0.53364318962485136 -0.023971820816134387 -1.1984440418183735 -0.0673175134741128 -0.73090059660056206 0.90465636540348504 -2.3783536861017498 -0.57916871759754396 -0.24115017028466509 0.25031631338513965 0.39771616833340057 -1.037470492502812 1.5545739968900343 -0.23654075144182948 1.5158928793976896;-0.33154264114713211 -0.48407931912802871 -0.23347386140852475 -1.014988740612754 -0.123364061638187 0.5195217754965179 -0.12359383756258807 -0.54560615388887246 0.10521727755753622 0.19225003929004375 -0.10083629337795602 0.59154928335424872 -0.043588820441094585 -0.1866880742175196 0.17737516015225163;-0.10917832635068375 0.55446816237009433 1.1753251616570153 -0.095468148868195268 0.060968396176271179 -0.24345297490766143 -0.28950576024488289 -0.04104220808364531 0.025826860782820843 0.31637912447023547 0.19505920697727447 0.16720464525419085 -0.17744666009315802 -0.092881123511681471 0.068547579812022211;0.24615204910536131 1.1621603064922168 0.53631025211349259 0.70921789587461481 0.017782839179470052 -0.25786171248565892 -0.041495067099199395 0.46261833588001522 -0.40335291895125774 -0.25918096367225002 -0.053641063450962381 -0.14609849888848137 0.08887047919585199 0.033903303247096735 -0.067784341398804265;0.92733163740175428 0.44865156567539277 -0.17699845569147915 2.0318559765651973 -0.18258456919780547 -1.8613622853860241 0.31661065782056202 1.4583537195536589 -2.019077422773865 -0.63126338590444264 -0.34526513482850268 -0.91624580241672349 0.071174561572260403 -0.011295613417057832 0.40260978147565107;-0.18170233750259779 -1.4316337540956963 -0.36806287965653733 -0.6518774128273207 -0.19325151544472313 0.55897599253724428 -0.0286187085485742 -0.019507123081361922 0.31502021969434291 -0.19931771306851936 -0.2319341625277615 0.71799040105421952 0.020062327187464618 -0.19515659244096364 0.16988778085286824;0.14472772563102368 -0.31777194222160093 -0.28503740660060795 0.35566101551643886 0.35536678930394022 -0.40335701126644363 -0.062754239860052283 0.11996667605654977 -0.20952779613900388 -0.21255000860820661 0.20690831206528021 -0.57340489242729376 0.012912790413464355 0.078762215579125064 0.037970336737427605;-0.4858348327207308 -0.88835667044158428 0.79357430355451719 0.13864533662207085 -0.58565257171673557 -0.30904772139891756 0.5064009568003075 -0.28680185138628911 0.73501394868708503 1.4633276043298515 -0.13644596814923496 1.9298767860747346 -0.73988574160881559 -0.47404474077799846 -0.44827553320116575;-1.2681924965812452 -2.2085978105907786 1.2887239754315933 -1.3051797539864389 2.0518419369679419 2.0099449440259338 -3.0240504590892767 1.3252114887193278 -6.8428395627250502 3.076664494681038 2.4076302479774148 -2.5252968716273667 1.7945440806843636 -1.8624790775371065 -0.5837031172428393];

% Layer 3
b3 = 2.144479446463448;
LW3_2 = [-0.088231447072162794 0.22741534758505869 -0.97506272858348997 -1.2353097117610681 0.5979638356894984 -1.3335621018900428 -0.16304190051493975 1.9023455045120339 -1.1388096736521738 2.0351104749514382 -0.14078147533532531 1.2508130696608988 2.0917201722990186 0.3083628665610057 2.2508129424800924];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
