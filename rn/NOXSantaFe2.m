function [Y,Xf,Af] = NOXSantaFe2(X,~,~)
%NOXSANTAFE2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:50.
% 
% [Y] = NOXSantaFe2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;22.7272727272727;0.00341273633199099;0.00632111251580278;0.294117647058824;5.42005420054201;4.04040404040404;3.03490136570561;3.96825396825397];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.6572261974261013;-0.76009895755941603;-2.1775119657692943;1.1638582964163211;1.298805035865034;0.64911075801447482;-0.003835015647383179;-0.42908596917705538;0.36488882895209029;-1.6348882678087644;0.22155767313514582;1.035786492319644;-3.1356640506026823;1.9045869808183065;0.47903770450660454];
IW1_1 = [-0.69387281423603286 -0.037357187047991708 2.4463349899875606 -0.98996268929940578 -0.72239718408397779 -0.36805635268135084 0.039826100157074454 0.96890630751932671 -0.039419986014089824 -0.25463764607431405 0.51390972946845792 -0.40345445333800167;-0.16394408373657532 -3.4210478782587779 1.7158124404729953 -0.40238235751638651 0.57110112048857686 0.080439352424783686 -0.027043923498896623 0.45534258958908003 -0.25242650303808045 -1.0305095036377161 -0.24055530348712015 -0.2066216070807349;1.7884255302480383 -0.55873332652680474 0.14292224707380663 -0.80856518318903781 -0.80025190231515153 0.11400513050753514 0.11203717736834549 -0.081205688709559118 0.070005667147240408 0.069551928088191703 0.67906715324548306 0.55300026371670852;-1.9062823918974177 -0.94194830862726275 -1.5443924284460415 -0.39331967593006956 -0.37949784286984739 0.084970777455150595 0.080646615021546936 -0.53292455913155889 -1.2544752075490175 -0.1555214641515604 -1.5303153776398073 0.10000468623357106;-0.089241475520950922 -3.6177403271920743 0.022648650072040116 0.070794524117895344 0.099718064356075609 0.17039721193691942 -0.039762141112631828 0.19533586877772874 0.25616775425022675 -1.6408710012961298 0.21763111111826611 -0.21365655711477385;-1.3367352203327558 -0.75358964535548689 -0.1785173322406344 -0.24552314663677649 0.28062935437024117 0.25598837657304291 0.10383560370356505 0.027205828664755446 0.19195584924547068 2.3752081130732927 0.12071349757485575 -0.38107598087343553;-0.84711524693267826 0.50237972002180165 -0.151912920930733 -0.42134516198511712 0.018922701855809139 -0.10251788403478806 0.033261750572295863 -0.099904043523248498 0.25470562727602242 -0.76633714731358205 0.19346482726807948 -0.54839853916859371;0.18704181844728007 1.2398303917176028 -0.88470928838910234 -0.0088796525433755234 -0.36835694671448688 -0.55067288581621621 0.19504695363875951 0.0088732702203093879 0.20997265024122697 0.32715888864869158 -0.028350100928797327 0.0096851179130134427;-0.14367199106417081 -0.69715877746937116 -1.2967938479025281 -0.27015773709078805 -0.62554736682157841 -0.58651537235862405 0.029356120898599316 -0.17917317205150848 0.60060202582873179 0.80800769694085761 0.26952656465684394 0.070130287884161202;0.095401283891216562 -5.2337835559923835 0.55774467755959456 0.050421473147547712 -0.11470265842631247 0.22802718964641888 -0.18165270592905411 0.12512853908163379 -0.17445724010458391 0.44967407425434069 -0.42344766349274876 0.06442314951986472;1.4566707898072233 1.1544436376460425 -0.30825299830143421 0.58651509414037706 0.38041463592196856 0.038352629525152872 -0.16424482735225196 0.83519390645548863 1.1982537947798426 0.95396850338564065 0.58770335191467993 1.3739344864803547;0.19217808140003123 -1.7730070817842216 1.1503189304493773 -0.60820034199250672 0.38467790525583956 0.4117334384392341 -0.10933266972590713 0.30410134940899108 -0.085473555945374174 1.1111215053427013 0.13380201265980007 0.11616115727102375;-0.03240426058420752 -0.52695527371745288 0.093468099110558533 0.25001868848066383 0.35904243762965488 0.43609782244413253 -0.17500955095796769 -0.28669272645190341 -0.15596974939022282 -3.3427431343694369 0.042773996981979 0.12942563695986692;1.2694131372233832 -2.0737285388091888 0.64141540796857677 -0.63668384315455551 -0.71943419337002001 0.39004233303316466 -0.12133306057479 0.18777707905224306 -1.2522620514406002 -2.0174856129592644 0.63336989014675393 0.042333537410130628;0.46396603087948562 -2.2923721847011924 -0.97053609315471068 0.1327344368897683 0.36014148400757812 -0.55895656940831562 0.19194449038772721 0.50748713049432126 0.59413474860277582 -0.60288561322647105 1.7434588148204422 0.2131483455967248];

% Layer 2
b2 = [-1.73363611204009;1.5741263258107652;1.9073701875628153;0.82551666107188426;0.20833180615622632;0.60123467099329653;0.14316244272599393;-0.86664135077133575;0.20372627741471577;-0.001430156913360757;0.04844442532076778;2.518738935390417;-0.6670710620338608;2.0339807134557035;1.3068502190087219];
LW2_1 = [0.31421693576372089 0.6846165774550298 0.13957634080801246 0.33007217000634165 1.6311543404907067 -0.045691255157668378 0.34065369815542362 0.73979879794631709 0.58312712868891847 -0.92982980794555148 0.13472032730246686 1.1599675395234963 -0.040596229419888698 -1.1592124179327932 -0.52271251137365338;0.59450192542644331 0.43827764856451018 -0.82385827083211038 0.040456978553764865 -0.10786665708429639 -0.055228937531332178 -0.57820588453442556 0.23490847843764426 0.37584004816127392 -0.82141397077823008 0.75293144701485437 0.60067226140926211 0.61326261132346715 0.22693516297369201 0.62307700123907495;-0.66766759026959144 -0.63350718944793571 0.67561091166462961 0.54393633802665675 -0.50783008749776704 -1.0768371828666981 -0.72749089885813534 -0.55356781063346883 1.0424212307516272 -2.2795100281697991 -0.370339071850949 0.69920106590048325 1.6510770175457528 0.27899564237142899 -0.73439680419649289;-0.61709786193565996 -0.24746622214674124 -0.33303174719157991 0.43964924461970345 0.084090807590141911 0.3094143070359156 -0.36717280439924088 -0.098116010707788331 -0.77022684573052713 0.16560999518554823 -0.14005336925780448 -0.71076135293738274 -0.71679252782508041 0.27427048806094451 0.57603654681703897;0.21985356961349628 1.5428064171887041 1.082245386711256 1.2079639258208421 -1.813604798174238 0.5480671306640057 0.097647371049757598 0.14796677121510457 -0.47024560908850432 0.1690135258337625 -1.0907255602046499 0.5729997348823872 0.20789056269392947 0.24523323615909876 0.29993826604372154;-0.61192992592162676 -1.0014434905352376 0.59929011483025063 0.84416588135641868 0.41622142142182467 -0.8974222181758662 -0.58465230148581071 -0.91600193953118147 0.66235618744070834 -1.9218841475673816 -0.43362260369277167 0.57545485372197547 1.2177070265363854 0.44823029443699597 -0.69265877637244189;-0.51819635746618409 1.746434825828187 0.86911745691338116 -0.06060468815788797 -0.73361401674132154 0.65594348332491559 -0.15357629687159671 -0.0061490871351315155 0.15451462461737792 0.12096556348256429 -1.2583223035759643 0.43104384041894866 -0.66494389035756984 0.17352102757954491 0.22584826888071965;0.11630886484047891 0.53903831004856129 1.0449409508049039 0.28368084713600744 -0.97084548146791172 -0.69370077547420295 0.13713491069753597 -1.168310535933123 0.22913054852478804 -0.78429332059649493 -0.037571665839916474 -0.77868626443606026 -0.056545707489208973 -1.1846067739900636 -0.083026576560455589;-1.7868088038469034 -0.71687847996481469 0.36240779417637298 -0.89615504276629676 -0.54589569459249687 -1.125417066109859 0.5191540704330293 0.030838082508388605 0.55509054589440054 0.75781888032966715 -0.23314561569402392 -0.00036039144890443809 -0.64275195151865594 -0.68965648284856085 -0.29338456462711626;0.49945566233057498 1.1939695732760431 -0.28736450072593428 1.9028916870401309 0.57193474655381837 1.0141511817881523 -0.30930106547028952 0.35890543801658303 -0.34170542341779891 0.18631601250461405 1.456434424978855 -0.011614053370401591 -0.048226291596184967 1.6648969372775098 0.26901427944090389;1.2658216732985861 -0.50329952170843373 0.10320499044990036 -0.30152148684545399 0.44420293060491728 0.0853637033927101 -0.039214140146738491 -0.24136507818936287 -0.08400747783088118 -0.7505825836425738 0.12894652263404216 -0.3127067606870077 0.80845147359390168 -1.022100205299636 0.038960789146006071;1.8282258760695262 0.52675468583374419 0.3427320543407425 0.75874968152646993 -0.1272839733206404 1.2691665685127238 0.11153709622089404 -0.99385570816493041 -0.85635934189851903 -1.0668558724046939 0.47182794930262734 -0.72014060714467343 0.44093170102359924 -0.58619239864298767 -0.0068954069887837734;-0.81320740531787583 1.1749626852462143 0.091477364212539269 0.55009277296079329 0.68964267724926365 0.40409955602050368 -0.019589155398813896 0.43286790396358044 0.051879719604335441 0.33097317076208249 0.058073994643231215 0.42138992509198425 -0.67801266283910977 0.36706779956388957 0.017054007624446949;-0.096097282636755738 0.3845558240370473 -0.41742842040546152 0.080296276719331247 1.5462422259099882 1.7424514967703948 -1.9641124910682217 -0.72631065329081301 0.74889057424647831 1.6147251752789844 -0.97454125156751215 0.0098409521508618612 -0.45631542533909902 1.7695910189439166 -0.121081394224011;0.45947975083900533 0.14217687005567917 0.13771451256352302 0.041650389327494902 -0.13003752656100342 0.52837220882148062 0.022495717419677659 -0.27695527958451149 -0.39229588979325697 0.11978070892868503 0.68090332235030349 -0.61651457832294987 0.16144120757714153 0.069992729457053232 0.26345700917317472];

% Layer 3
b3 = 0.0024892826710482289;
LW3_2 = [0.92490744684246839 0.88332178477302281 -1.4555840071717137 0.5410538084486044 -1.1128002087293134 1.7352309808809117 1.8063695657928112 1.9540019752990494 -1.6898594526527737 -2.0517706008993639 -2.1916499240314118 -1.4679084840618382 -2.4534421594788531 0.75792368679532784 1.7807526013988788];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
