function [Y,Xf,Af] = NOXVallarta20(X,~,~)
%NOXVALLARTA20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:29.
% 
% [Y] = NOXVallarta20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [-6.648575947007167;-1.9918659167931321;-3.5476190576975029;0.096240802493050268;2.1218528852856871;-0.60378990923921294;-0.83111941188152949;1.6349792328637691;-0.81768129178167559;1.8706427890754298;-2.5907306703518094;-0.82301150569786619];
IW1_1 = [2.8017042276076309 0.46824485458089443 -3.9216020025072407 0.64239029112380597 0.75213159505442517 -0.5246379718264268 -0.50925108469942226 -0.68790035638899893 -0.095048629192221568;-0.51939206066916743 -1.2828635939344211 -1.7255128819472121 0.29371489976954712 0.082612609175803195 0.66908594672061028 -0.99373739949146322 1.3420317484613169 0.28508270223790699;4.8564447701562017 -0.32988551211126971 1.5326465202988955 -1.5722798400443205 -0.27392716808909928 1.6608584146705359 -1.9669668725063825 0.027874845704651999 0.361489116073481;0.023470762198916081 5.7030357158429901 -0.24135558373632787 0.32235351377487209 0.053966781082764953 0.076768325470625148 0.038697637547632203 0.11760064461676914 0.018916107730910476;0.52564078066015252 0.24909550664241678 3.6777386776715471 -0.98390647367387074 0.27793941176908432 -0.44883148966353476 -1.0391122291322425 -4.0279456383328638 -0.13503815085738441;-0.98697287031656267 -3.9779107177641149 1.2648725851370066 0.8291621480110728 0.23766980199378493 -0.49509195262552697 -1.2485699722294643 -0.37235344851577146 0.1898236911666959;-0.95533069398566994 -1.4050304197966319 -0.066429760086031353 0.30784204304686547 0.13981960077706229 -0.16809456116659918 -0.26330561919618817 1.0162375721869537 0.18466365357708223;1.5855896004794501 0.66965210127657016 1.0068473152298021 -0.48513920276771716 0.18353899005595567 -0.036790674449624 -0.44825100609206303 3.2370167897878535 -0.025424982510864017;-1.5969819127651572 0.69203069944541062 -4.8152947960429309 2.8833757224669285 -1.3845368703008933 2.0319355044425009 -1.0683443543484925 -2.0961668830027973 0.91443518389111411;0.52442153199953612 -2.7236343896347495 -1.4947309503277204 0.65355533967152935 0.034686067448597667 -0.6632611390816705 0.43752792461296131 2.6579994041545696 0.079222006545193444;0.96671903941247905 -0.3061998574600695 -0.031859895469962117 0.16217647766370755 -1.1665502118267228 0.63824911199401546 0.65060304878815733 -1.0752594784249223 0.040377531359596833;-3.1917532330918568 2.8451873605340623 0.091085890246617202 0.44714498990992041 -2.2102993914196163 0.92396041747637958 0.89708634326566994 1.086714376744736 -0.25601573512462078];

% Layer 2
b2 = [-1.9818210590751106;-0.90219333024025128;2.5936980527776505;0.19780576429357336;-3.8657411335496299;-0.27971189357221832;-1.2931938819895783;1.9610236141574526;0.34452235748265186;-0.12652545239286589;-4.0093488965428463;-4.5399964349704263];
LW2_1 = [0.4432011773601589 0.55796251803030517 1.0990977754795279 -0.28497483888472391 -0.11915441654207518 0.35589881224473247 -0.13624377573223562 0.48209130267417949 -0.74132057024301246 -0.22537350256763192 0.081384523533650791 0.78936961046041221;0.74429243812637158 -1.025058775721309 0.46556510521202588 0.28949314410470939 0.34453767531148338 0.032198386465094021 0.91876179201156172 0.068685866940853796 0.27401397736191896 0.25293443157951595 0.21562174762839328 0.26703018560446889;-0.38139636596108184 0.10082234881470756 -0.31489962196308946 -1.8836803645568005 -1.2157004420460862 0.56738856011594063 -0.70303141625647159 0.19788867899884177 -0.39470492530069051 -0.091303885081397848 -0.15267192695202531 -0.47473279434192789;-1.2787899873659028 -0.20388993552328205 -0.16620997278901983 1.1567808285643122 -0.10487067925132937 0.039858185308551772 -0.21458195407890204 -0.83500682310046126 -0.34285677138341297 0.26004193380947477 -0.2410648420509855 -0.25682955360966692;0.23653600072827574 1.7282652548743309 -1.174773424969503 0.65854038588720221 -0.39769474674269373 0.051303977966392043 -2.5008894224732177 0.84803065432486047 -0.10144120733381369 1.3748327829227776 -1.0115917584740179 -0.29136385626931677;-2.2376710517449765 -0.66914277183989546 2.509244562665307 0.78136801637089204 0.43033999121681232 -0.52848681834382449 1.1875210995467702 2.2771722793964546 -1.0418783129776013 2.3062546484517581 -0.97089991387789554 -0.47660944141739509;0.41794564445849003 -0.29446787643960282 -0.081398074005330029 1.8005332407124126 1.292853801548989 0.2851664373761445 1.663849713504155 -0.26735568724928965 0.35754248760585472 0.077790532118737321 0.24831924818982298 0.54692191787825517;-0.50107485886630665 -1.7359740680343869 0.11495902456424575 1.2579102370942321 0.22235844550088091 0.076950554832105611 3.3883744313797433 1.0336127585196513 -0.62326070948708878 0.84915894862471575 2.007542349411743 -0.19313165187812747;-1.7677438872308338 -0.034509319823157927 1.0950907377977512 -0.78204193091874297 -0.13749099335756132 -0.0084659703901051563 0.19139498879253891 0.27197084390260612 0.50601789594480373 -0.82791704928010212 1.1252040996500916 0.23090602407552324;-1.5697560694903088 2.2850306315974276 0.55171773702142979 -1.127080264683231 -0.15194317510279554 -0.054632081418383965 1.8816116561284248 0.0022037252182155187 -2.0068580752001521 0.47936805436956298 2.4177964682512059 1.4725636860045523;-1.0805440952727114 1.4320840611961598 -0.52465883092368204 -1.3104002407165452 -0.18426623388667487 -0.20736145465545097 -2.99832848189219 -0.95365181559323631 0.63847251739624655 -0.84052498317729152 -1.9884899439923438 0.22782136548216908;0.3720447554142034 1.1160757958502994 -1.1903158453346721 0.74224265988041482 -0.48722525468683586 -1.5816239853080618 -1.0615634288387101 0.8000441075901884 -0.093042974801206602 1.3675448693018142 -0.97031175149228388 -0.27208870385141054];

% Layer 3
b3 = -0.98194375349253604;
LW3_2 = [0.90217542220792668 1.9168714366645434 1.9505519767311927 3.2888426347609423 2.0249667336089945 0.11088966853754843 1.7305840986961338 -1.7879272241526447 0.35249618557980511 0.47572609756553225 -1.7636726849179303 -1.9506509999135719];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
