function [Y,Xf,Af] = NOXVallarta23(X,~,~)
%NOXVALLARTA23 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:30.
% 
% [Y] = NOXVallarta23(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.1216246130717977;-2.1509164258701361;2.0609179181634927;-2.1286806980272392;0.96883024881759672;-0.28766618904808655;-0.14111410641136454;0.20129307570248361;-0.026580213036588165;0.32084903545976479;-1.5095045398784734;-2.4209086719811634;1.9502170184522907;1.2311553554705146];
IW1_1 = [-0.059824236389527684 -1.7083013741949253 0.7000909994957365 0.36145189287092033 1.2690339971618223 -0.53828478638649024 -1.9806744189778371 -1.059981337035957 -0.80442634606281815;2.0767247126292099 -0.045979594042043673 -0.91188679466709321 -0.068588770101823779 -0.28133568052280744 0.67332743946496088 -0.66914599228239413 0.18102287398447522 0.10249084235975806;-0.73835929988322868 0.077679298069654429 0.12282283721818621 2.3486923088861262 -0.46648330235500429 0.72809785870197474 -0.055647912722785076 0.12719403514807404 -0.24039080660575379;2.9227614884100506 -0.61917375497449534 0.22637707474287166 -0.46232571655737686 -0.11571630293422197 0.27156827408285356 -0.3017176047075793 0.9682593460698411 0.11937056327666223;-0.14122805385086631 0.81010841322081684 0.57268504369641149 -0.73643049835029351 0.69322990169791199 -0.71710589585999496 0.40743871742919813 1.2581203079580801 0.29653229915910584;0.0058823496983852735 0.47439780796752923 -0.5257985487543253 -1.3187742708553019 -0.99813575190702841 0.31092803670464542 2.7586892672802965 1.0216071274330152 -0.29821409647744396;-0.3502023319764026 0.46644730403600082 0.52140095223510097 0.01036547077515855 -0.064333916984813638 0.75624064856534479 -0.40301218004719602 -0.8875577520953527 0.0059061715725757004;0.34832554946024941 0.97312091015128532 -0.33426250601422253 0.67016567343837918 -0.017940689561950628 0.38994395792066816 -0.23490843193434455 -0.69035205132371269 -0.064457245467054003;-0.26269237885365854 -5.1079771789174124 0.021567443528493695 -0.10740792427405217 0.2473413360144216 0.10258128806368566 0.2509760446619364 0.0961329331818465 0.12017692165373664;-0.59538401197837343 0.5204724980222204 -0.84652413597733633 0.20951664936728331 -0.19767348235534565 0.40699190590230422 0.99792480256565286 1.0265842368489493 -0.2575458150058752;-0.63645650199504045 0.58110901315262931 -1.2907544302795635 0.37434198187561796 0.10133979654021501 -0.37031192697243398 1.9830432815699184 0.065955171427577383 -0.367799147449693;-0.82108179958134797 1.5098851796344002 -0.65890817720531036 0.68899166191934491 -1.1393253251878372 0.78850301471110296 -0.08702249687794221 -0.64757841762262647 0.26806234471834178;0.22629551334590356 0.084624557670141237 -1.3124658408780239 0.085809972489002725 -0.49252107383756982 0.15221740387488866 0.12829401059944393 0.6191352024302792 0.46098106110820419;1.39537298433479 -0.061334566394328979 1.0818025966734042 -0.056383623565305616 -0.16917417188514011 -0.30538069323808625 -0.4692952698642438 -1.2141110687514847 0.20975558395922841];

% Layer 2
b2 = [-1.9611153172700073;-2.5867782783806264;-1.0650193468440099;-0.58493462183995271;-0.88925344240741278;1.2816848840006403;0.89836162938106412;-0.50205006036305633;-1.6133951387102383;0.077224401498366346;1.2564127122809454;-1.0599212969899987;-1.1533772873910875;1.2358815350493815];
LW2_1 = [-0.29126313536300624 -1.179143052727182 0.13060026135176725 0.59201803451863844 0.70258207102825165 -0.73569743241286512 -0.47142564224289768 -0.22622561942406508 1.4464528080618873 -1.2605044448809448 -0.15968489515488063 0.93908552268034107 0.30434711697129441 0.12237202231395977;0.67878559208976053 -1.3372436102783394 -0.34026508534009003 0.022111397397470131 0.63643987915565392 0.45655110210322053 1.8370107135258158 -0.13933391050554106 0.90335686290164641 1.1597130664444428 0.90965928899465898 -0.21063221526857101 -1.1120773422976928 -0.058546753044720859;0.19544594962446929 0.43936118928923823 -0.67589573845975004 -0.37284753475060495 0.091078673261566045 0.23674571397789401 0.099783149136885879 0.80283673526658561 2.0034245731388576 0.23078562760139615 -0.21343586729114375 0.97435598162877102 0.60982733946077561 0.41145757386083559;0.42873273961559283 -0.60183944847795268 0.018726696005181273 -0.23528167756096593 0.69795453962931342 0.27658406738682528 0.0061816359265495918 0.68671379719906078 -1.9952781054783741 0.22453261619754272 -0.015451535092255338 -0.3267900716326464 0.38487590134820859 0.17022607039416957;-0.44171935401324192 -1.2280436928739533 -0.30558508179319049 1.8426833199482568 -0.051004668190013279 0.013510847096175102 -0.58207267442803334 0.22685171892492584 1.2648584864727144 1.7432189028238332 -0.10715831984915847 0.2058143828654182 -1.0987861389793416 0.23879202914663164;-0.72618164168870758 -1.41838471756686 -1.2460473089702415 1.1750994729038662 -0.79195426280623138 -0.58911080676636152 1.9571607332122867 -1.3809627758951313 -1.0646631706249945 -1.2107297096619349 1.0121206507534417 -0.72349611437748929 1.4294898793837627 1.7642385894794936;0.32303932873034169 0.1726517356618982 -0.12946678687719537 -0.43632728500536549 -0.66354150980996007 0.0095264536423040024 -0.65077046759912405 -0.74312967536654895 -0.15614892631663455 0.4183666067641626 -0.18234115615136282 -1.053610290545731 0.48135842708678567 0.36116228278432666;0.23863406315689017 1.7190325464327445 0.080439726353265129 0.1289963473268759 1.2329267613653059 0.22426043436899606 0.28718626700481004 3.2456017337116756 1.9716016752981329 -0.58823546528564452 1.0430145034219944 0.76326701490122728 -0.55468695361806886 -0.31085600065672231;0.21830442507725573 1.4373368036426066 1.5792558800781471 -0.87625956453397735 0.70565587201454749 -0.20878021344160491 -1.4659330714373231 0.098421827954314534 0.93529550171394127 -0.47724786659632723 0.29717250481161622 -2.2242817780576756 -1.8649053678918215 0.45789872899956213;-0.70054852684550739 -0.91999808183408649 -0.9178880627998921 1.2064467490869086 -0.082773822917659626 -0.57748140806361825 0.83616213171959142 -0.563054731512179 -1.0247668794654603 0.36122824011215177 -0.12299560777857907 0.49908102955938455 0.56824055274351037 0.1541828196452425;0.54226825224955 -2.7154260000392307 -0.24071460755677038 1.6331981934768256 -1.7247779524328988 -0.3358386441028039 -1.0224494776303554 -2.3831057871425787 -2.2845340282484465 0.85961791446562752 -1.0934210294210742 0.071666171059927786 0.49422583948269816 0.50039663981147353;-0.16153375187102748 -1.0255377138738824 0.39066694598102314 1.033077306541591 1.0913984608362872 -0.36090602418406836 0.38220228328007844 -1.0413098324951091 0.886865167410267 -2.0823409640014683 0.060801203159488323 0.32697504986529824 0.1262481684528752 -0.12432771533943859;-0.69772343850963126 -1.5033064491108625 -0.33173448889912643 -0.015909166161799292 0.26200437696442092 -0.012486179613528305 0.57934318075858593 -0.70942962965147049 -0.44874496138029768 -0.016755089381708516 -0.40575493867086904 -0.90347827600752828 1.0030901425880541 1.2574742958986684;-0.13735940958902731 -0.014463466656429386 0.39249945239340106 -0.28907153323556545 -0.49038136611767863 0.30439959097769248 0.6208757122509031 -0.88153372489400372 -1.8548407963093498 -0.56741698787606742 0.17680965111522792 -1.005409955638124 -0.37583351475968219 -1.0524591590414765];

% Layer 3
b3 = -1.7563191247460208;
LW3_2 = [-1.1003649029173233 -1.0471009931547008 -1.8015736905325339 -0.89267591998158358 -0.41101838468300317 1.6638312493461094 -0.53840940735823961 -2.4298985464953478 -0.63454256325879987 -0.30310094741909066 -2.082860447622414 0.68980027447544534 -2.5867185037003484 -1.2257304474150517];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
