function [Y,Xf,Af] = O3santafe15(X,~,~)
%O3SANTAFE15 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:50.
% 
% [Y] = O3santafe15(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.172786177105832;4.16666666666667;10.752688172043];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [9.4218238883018639;2.7128623474507298;1.083622990173142;2.0147378395877538;-0.45185361925433326;-0.91089306815195281;4.018700959044307;-3.7368021063791237;1.3339864365460927;-0.88812865750299841;-3.1648930082142961;1.1632191668775438;-6.0508189297495472;2.2035750544357215;1.3050745784144362];
  IW1_1 = [-0.1086416284788445 0.013132928597198772 -0.33224002603031166 0.47719854820450841 8.7135604061861613;-0.89298147587915089 -3.3887089836752371 2.3808145973840444 -2.3328892012595746 -0.037557959796894858;0.030899681323740272 1.1107833079678633 0.53211298735713242 -2.0625051814667628 2.5061207105626124;0.66572914737305655 1.3708974401703078 0.69810917983048715 2.8682364192940075 -2.1509074446939924;0.7531733742257829 0.70525278800952296 -2.9036094529483396 1.8517011195823478 -1.1103232924602051;-1.9681189321288843 -0.61401182575015767 0.117790850806733 -0.19609942506218311 0.25586386623331486;-5.8092423503988577 -0.36403826059421185 0.20744020293818413 -0.16154862262251055 -0.28780262470555446;-0.029218780330983934 -2.9040237021107065 -0.5083968381983428 -2.986607106680502 0.4610427197053506;2.5419074670009949 -0.06733370980092597 0.48458079347532429 0.39866190525693262 -0.59492385197915587;-2.1741580212365461 5.5712079375513746 2.1818926740671656 -6.1093090235727265 1.2667626984871099;0.056036487978559084 -2.0755951572246665 1.5126191306248806 -0.71462262481799088 -3.6679519103889637;1.8832110504696957 -0.74234304680712448 0.88597976900659547 -1.5645056485294588 -1.7321898223416627;-0.29849588253751697 -10.921440724909036 1.4142592891261032 -0.17618083932147796 1.2519253316449166;0.97447127551732293 -1.7246745398781438 1.4644780818221723 -0.73804349264511226 0.57233738923325372;0.23098586651618089 -1.7125940130837067 0.10831938375493876 1.1642555058360893 1.3736153815213465];
  
  % Layer 2
  b2 = [-2.3633904056765829;-4.6752543115040499;-1.5051215198490668;-2.391419096912593;-3.9214644547833535;-1.6585471132845244;-1.7947471195019764;1.6456061020032089;-1.1695666125339361;2.5376049808715249;-1.4166545398821069;-3.2237497703242655;2.1546170024288229;-4.1767779346706995;-4.610480730529873];
  LW2_1 = [-0.046203481977444824 -0.15588521995568064 -1.5302725192519044 -0.10472192236069583 0.21457576940516798 2.041799304459242 0.75434117147306001 1.0356466583500308 0.34675364691894117 1.837075014284808 -0.065897760892494134 0.030055329888093233 -1.3846877248803042 3.4721938377216706 2.2394058012362179;-0.92192206492801876 -3.1371446423774039 7.9545439168186967 2.8834086705428557 4.2328909260476006 3.7900484576063729 -0.12272570735447801 11.195964884137055 2.0111790310341076 1.0414534776941184 3.208020841630177 -3.6722695591255894 1.0264821902429366 1.2690801878932936 -4.0815601326531592;-1.327363282681749 0.066961165703559145 -0.15891136113555757 1.9278558016810246 1.5666911646833224 -1.2963869391386067 -1.0574343251426079 3.2260273184151185 -3.4999128522331566 -0.62670466827471349 -2.5222740759334599 -1.2375450444907199 1.0244012556190005 1.2309627864734149 -2.184363882374766;0.14880723883576227 0.69922925874371633 0.63823936817460492 -0.6137830898184633 -0.10503691439604955 0.15997536635437878 -0.87194218513577404 -0.44720930982751483 2.3150273834638972 -0.40598583260118959 0.0316215804357248 -2.4060854764059663 -0.041702572668476538 1.9650653785017318 -0.35730282545138597;0.080346537334069518 0.6828536967270491 0.66512420216085322 -0.81923678314101078 0.045069652053391654 -0.24308742602831995 -0.84898765202763948 -0.5960021631348198 1.1619581291907204 -0.43097243159769555 0.053695478009627109 -0.59395140014395775 -0.029234320671209957 2.3239451852871018 -0.38639483924195178;-1.1873234565721003 1.755514560485822 -2.2481377025020701 0.57193848666007818 -1.9329604522265005 2.1130812046359293 0.28994580931047875 1.9086565837348954 0.346387668652476 2.2842976273326467 -0.49243143691920355 -1.4193921648599368 -1.6044080877658988 5.8208626563004096 2.4126598818145539;1.6789027486484718 1.3259558606932593 -0.097758454081188079 -1.3835796052129719 -0.16821876004148084 0.053593657310756937 -1.4020419021716171 -0.97448515731235652 -0.78453668988318737 -0.20550392007266008 0.12711529848566713 0.05131980371565624 -0.67416987383635407 -0.45752285072657539 -0.14347868248977452;0.95721596118811147 -0.46520537717188387 -0.11439035439840865 -1.9911152573431214 -1.4739486383681759 2.0586911514422708 0.63419650865192101 -1.5552549774553983 3.2672579612729518 0.50727585735506198 -2.8721123162322191 2.3097649455288378 -2.4850017677194334 1.2594998939523003 5.2343840205847743;1.3113374289068858 0.76766109034821983 -0.057395069699270614 -0.42986630962649242 -0.33666051388897067 -0.53973598629311215 -1.1361035523239444 -0.28596020433061198 -1.2456730330262358 -0.091280638071256442 -0.036846023239105075 -0.33809986413407261 -0.41615936350075677 0.35153746645173201 -0.096072342611912442;1.7336032559673418 0.017514256210377131 0.036158907972785419 -1.531124551406164 -1.7152059376013338 1.5018132389747396 0.91407315355791818 -2.6809238323191384 3.1932891044424756 0.62146818797374725 2.0959349166616525 0.51796383311964578 -1.0185805117846829 -1.5026505784366229 1.9043982527140422;-7.790797573927537 -0.051402428966650433 -1.1739150767590225 1.5011115218587816 1.8425436406186095 0.20717518436529031 -0.23530760727644867 -0.35243771059249757 -1.1273166974636852 -0.56268231703283267 -0.14450563788628293 -0.24595605727641229 4.2758546165161411 0.33839399897352046 -6.1236797129416765;0.1504964037459913 0.3828067000893362 -0.01251020942404792 -0.15810877614203228 -0.2735453922273452 0.52600515201575437 -0.25281780397579051 -0.19189677607312366 1.3447671336836391 -2.866418856094255 0.31801535599374642 -0.79275122467254622 -0.21104666324864876 -1.292373265572861 0.39643086172393072;1.2621275525028861 1.1882453380212139 -1.5938598579893466 -0.53967442830176704 -0.9684437168279314 -2.9484452726588155 0.018416337464108992 -2.2816588636260873 -1.2400465458971597 -0.24741070836079634 0.53961750362337702 2.4794092689405502 -0.46662494641026209 -3.8547136111114653 1.9365846538946976;-2.1356783687064653 -0.42053663216691739 0.23476565738281699 0.58335884252678039 2.1537937734123282 3.4094464988099382 -0.11762288528143186 -0.26072224485811563 0.30410449269278544 -0.77420472027768805 -0.87296963816045292 -0.7749651726437885 1.9374897388494916 2.8370602579226945 -4.50530011633247;-2.7534810101517464 0.15982494648305745 0.95082552688532351 2.1113966134672482 2.8712639138676135 -0.96494502014668471 -0.79241512375536005 2.9418060701675026 -2.1382212520475035 -1.3110331338687609 -1.707608730859383 0.99453785303207232 1.9421975309021886 0.23385075770080729 -2.6670423612563963];
  
  % Layer 3
  b3 = 0.98433021482443295;
  LW3_2 = [-0.26012008184343066 6.3236924118277695 2.7235569354462807 -2.6602438967343018 2.6135720549640147 0.22126304933166108 -0.7382602593242984 1.8968609695392864 1.0858240581898231 6.2308162007227725 -6.8997443041105564 0.52259616212878301 1.7607044928169402 5.4419708021792959 3.4794943111725662];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.752688172043;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
