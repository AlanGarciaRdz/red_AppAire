function [Y,Xf,Af] = O3vallarta17(X,~,~)
%O3VALLARTA17 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:55.
% 
% [Y] = O3vallarta17(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.12820512820513;24.390243902439;0.02710027100271;0.141843971631206;10.4712041884817];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-3.0868050054053802;-0.41146704002048595;-1.3268170974656015;0.46419327142570349;-0.70949199823280495;0.50257090103247315;0.76608751903865835;-0.16194355885008282;1.0402976092316158;0.71919252714572912;0.57067665790055788;1.9913792724099566;3.3863901474639948;-1.2970500370349523];
  IW1_1 = [-0.2202267155407226 0.015502478361187462 -0.214486335027123 0.094250866234820763 -0.03972263763642829 0.29872740008828669 -3.3322560833588128;1.001531687353922 2.6786663668522088 -1.7907850179743725 0.27772075309050187 1.1099744086506926 -0.19933930500148772 -1.304361788407445;0.38968302041003144 2.8143631625671737 -2.5977510972399922 0.37889214524852788 5.2305694769150772 0.47198150969161601 -1.0910556008236716;3.510760039560711 -0.55987771782127516 -0.65676098145097694 2.2184121933230876 0.59232123229183709 -0.012712855955104862 0.43156007184520306;2.5602808692751537 -0.73292589040053602 -0.40459465544877421 1.597640315886522 -0.22725130800965604 -0.074908104303668607 0.39291984847870015;0.37972716060157841 -1.8398309191718181 -0.77489775526825666 0.74177687578712248 -0.1591355284208231 0.09285238074772946 0.1259276617292476;0.24841040254504873 0.86291892653150915 0.25376144665708361 -0.66865874117635027 0.19092906167066279 -0.93263349346897739 0.91448397098182144;3.4810076445590021 -0.0076402558716676394 3.3360980944524017 -0.77579202512092704 1.1030084129100068 0.64384079796661253 2.3478141061007669;-0.83561720358853453 0.59963083881582635 -2.1128667123051552 1.4530006242585967 1.9683232815359217 -0.48548663830642064 0.90350319200274543;1.4353614068984895 0.72872113053490273 0.4445159807068122 0.35892243266875457 0.17102600190154049 -0.27081351480924498 0.047098934511186089;0.20724520466807086 1.5473647092765839 -0.31438819273598961 -1.7479068262931703 -1.1180149221761966 -0.48474059057851748 3.1201136642617846;2.4803936238912216 0.5121744411581427 0.1139700737658942 0.19645700529561499 -0.86384307796493587 -0.20918579774384435 0.62907084272584624;1.1395842697203595 -6.7206138181558162 0.29476952474936824 -1.5651882814451172 0.86883329749681437 -0.31002025674501221 -0.84671499935528527;0.35883592316157592 -2.2104612589036639 0.54122240708048308 0.47531830623362514 -1.1907093874013199 0.28576632225975135 1.0305348570571258];
  
  % Layer 2
  b2 = [3.2804891145529034;-4.0741237030667579;3.081674523916544;1.1656183800183693;2.3124406131606228;-1.2416084895311246;-0.34297871648214218;-0.4151054006346806;-1.3226653125182048;1.8429791715390427;-2.3183575349696905;-1.9936186801908948;2.4466150849432693;-3.0212874230941562];
  LW2_1 = [0.056888313150024288 0.38579355989192621 0.34046298836981026 0.96667698030390681 1.5110397770505239 0.33275638482525133 0.50196628069893878 -0.5785807240489742 -0.43848094441059665 -0.03625998852558688 -0.99599557955668494 1.107112843942647 -0.89528997679266398 -0.15473544185464688;7.1799688024747903 0.19687938301484925 -0.15889127078331813 0.23093471872375332 0.38641838812370988 -0.58893427196085535 3.5619450200765952 -0.82825029194233246 -1.3405238783492499 0.38304696600396604 -2.0626531869157132 -0.68937621827548046 0.38975942791572793 1.4123730136823622;-0.364413492907942 -0.45034495401599484 -0.29049618585148468 -0.74874188816139919 1.2591356847831885 1.6411149007960775 0.11489016587926476 -0.5503041065838955 0.00023355562370320875 0.1629634790624038 -1.3576774586265234 -1.3227542010544475 -0.55950632687277035 -1.7606493662890401;-0.54710002271848024 0.71060898047266408 0.26451101527804993 0.0047946037065565439 1.974591495983399 -1.4961849706390691 -0.66379321622239895 -1.3360419742196494 0.37707790687396908 0.23399410504002724 -0.23219852382135267 -0.058797641913517176 -2.7735172175912863 -2.0359065182727902;-2.8696649558971501 -0.77784631066231413 -1.6205694298953379 0.2105062743771986 -2.3688394313050214 -2.115715395917027 -0.85329880777434852 -0.31098960440127799 3.6918028762095858 2.3622703086177825 -0.16212556895333899 0.83424457955604858 2.2071463123667181 0.26856108060962608;0.82528396860220876 -0.92849030730347626 -0.55021062941030807 -1.3285246086989564 1.4918563917255427 2.1056032283682264 -0.1400942187741783 -1.1314688412877971 -0.58242289271137226 0.66285051194784039 -0.094521428909429717 -0.11140944565940691 0.82926997650575951 -0.27413861895401481;-1.9522506336326004 -0.14198334803520976 -0.40223852792735487 0.44852590363048062 1.7416375623220108 -2.586993705240098 1.1718075308284401 -0.81867697335187495 -0.089147285180067537 -2.4781296075293935 -1.5309430649564633 0.84914209827428011 -0.10176503077173546 -0.85845568737301559;0.60635987202278618 1.465805653730595 0.022681800737624436 1.6653327418551425 0.36784158507566689 0.37952901975855313 -0.2280778519584899 0.14487770531438468 0.16789032735543213 -0.67722348383051956 0.51438454967949021 -1.1521959719690533 -0.49518222621971875 1.1946464588629346;0.38205448936443054 -0.42445062322663618 -0.31948973856348734 -0.20971444840321027 1.2587653676602686 -0.10776629815351867 -0.77446355165165703 -0.010296585120619789 0.71076443876858186 -0.33907283062212318 1.5728481049708405 -0.97898307486593139 1.8604860904526361 0.56351847982349834;1.1813196685360405 2.0340082404735287 -0.79124909099597418 -0.98380165660826024 -0.24282340741875599 -0.25811717156486352 0.7011870994403222 1.2082374331410466 0.56735719546799346 -2.6589541935439343 -0.023883636606252631 2.3053736711718646 0.45414623167484913 1.5293377734159115;-0.12047951698497497 1.006384688080294 0.05518688544728801 -0.57289032049845146 0.044287635404714074 0.035982537484441621 0.30686510242238108 0.25802235633705872 -0.042179739611687403 -0.12623752247562828 -1.4265014396594178 -1.2159879865359191 -1.3204392227374908 -0.057314123998882506;0.2533775539405409 -0.14009897056900245 0.014435408006263768 -0.5446158257133501 1.2585848656138494 1.1149778728519688 -1.1986788996616253 0.4913329514548323 0.931530933619793 0.20595597110068753 1.599427491357414 0.48073409944741274 1.1208708873593889 0.79473373018387727;0.053113257571645416 0.035567509633025629 -0.04733000512666248 -0.69011693265380325 1.2317395097076915 1.9261357136977528 0.45412779442338136 0.31791124018064626 -0.13875756317931659 0.10051615761438078 -1.4061858914779988 -0.280119771264637 -0.41497088343128413 -0.9051178653983748;-1.8139480094351594 -0.092626868385292882 -0.56429723418612665 -0.46466825974022014 0.95060567362622428 2.6006279855634067 -0.22536110612460281 -1.1515328546675461 1.0374287495480277 0.32679499931875139 -1.3411882858523489 -0.62073919898167473 -1.4194268498710043 -0.32833296377950055];
  
  % Layer 3
  b3 = 0.94432172669465231;
  LW3_2 = [-1.588842652359411 -1.8086031489334984 -0.87749304946072471 0.45572570571127247 -2.4162954128686249 0.28345884705630514 0.20101513958028941 -2.2539331621471566 -1.2693296006830836 -0.41785970397551325 1.3466484539260848 1.3236442270391051 0.73163460332208341 -0.27212938275904414];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.4712041884817;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
