function [Y,Xf,Af] = COAguilas22(X,~,~)
%COAGUILAS22 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:21.
% 
% [Y] = COAguilas22(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.448430493273543;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125;0.281968137600451;0.304971027752364];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.6584678080427162;1.5141033660294538;-2.9970544187333186;2.390518548299243;-1.1404068471034399;-0.29724687766040236;0.10644835193398178;-2.5248271690911794;-1.0495215488425067;1.0373170942329246;0.76079134718158481;1.6729227667014674;1.8226421790944298];
IW1_1 = [-0.24029388223404655 0.12993134012573659 0.19784452322961521 -0.12237960357298762 -0.30946684507475469 0.024753639268404692 1.1318484064992953 0.81493197329651224 0.011322813575315047 0.24357877882651302 0.7283510971388546 -0.25531776963410363;0.50986894981366659 1.436629703569688 -0.40348638795063668 -0.40906129187075252 -0.649496611989693 1.3706305805713641 0.039686524361102045 0.0064878255713225752 -1.2190913534301684 0.22497616077329316 0.85288242186840213 -1.3019588320059752;0.12176326287099092 1.6471038068547743 0.60816240140009947 -0.96851859494975068 -0.63187468322969997 -0.48889455095257994 -0.99218297441025927 -2.1856109814084315 -0.14939958483598692 0.041313360335850209 -0.46766802805297264 0.10007823129112915;0.026442920161572694 0.89874897329158787 -0.16465558016067217 1.0094330626266323 1.1444764599472885 0.23264114151015433 -0.55002869633338025 -0.11897609762849351 0.52594241424323773 -0.74233800789724047 -0.24552512174399052 -0.032816111273060125;1.6448181523156904 1.2018056623669102 0.15277763768962693 0.29654872590135167 1.0314608260384395 -0.51336068804044444 0.6024389434261066 0.81615462118898119 0.8635823223935134 0.081468333014502223 -0.51978534914164765 0.82369369565240325;0.045069175287543312 1.3844362132765786 -0.77784785779588117 0.56115228939893158 0.28719694340482532 1.7619312243792276 -0.86493345282807321 1.3518033597603325 0.13766524686861295 0.48253846633126085 -0.99801006208035792 1.3889381804586367;1.4407301972715214 2.545932251297951 0.31409124164294994 -0.37397758542370935 0.40188278844684655 0.079575414221559684 -0.64719247497044552 0.18208094353032059 0.34786722026235189 0.27338220286946047 -0.26671025544445781 0.59708173096203243;0.31056148336592648 -0.40731912410145404 -2.0349591732834105 -0.089758984878370501 -0.057041941451938166 -0.23348307424016523 -0.3719798498996893 0.092743308504055655 -0.21248682544286604 -0.046968528590112531 0.4117477011082975 -0.38269054749630971;-1.3347368031314457 1.4831691273441616 -0.12268485243531299 -0.67722041979774716 -0.48852077900506902 -0.063977724630699465 -0.40189513330240167 -1.038933397706437 -0.73424325186846207 0.11029801513654457 0.65652403864423992 -0.84423579789211345;-0.23796027605678974 2.666775063005228 -0.56748718564671907 0.71352396560314069 0.46703597824172294 0.41428864920679775 0.043329730996939944 1.4046427947858728 -0.059216631458357954 0.074046559757395908 -0.29749379900509809 0.24146337638638252;0.88277799006576896 -1.0983887046256204 -0.59432080229628981 0.25465449650837008 0.12130940347095671 0.077747473837839975 -0.48963915820628567 0.5481273138883066 0.033440726096789913 -0.079689001857984554 0.22158010689318797 -0.54992653217182497;1.1202632361135079 0.64351694337069421 -1.4170269095486072 0.095088374322269673 0.5140703086714471 0.63302335907750562 0.09338380939791216 -0.28484540289365345 -0.10446502611951777 -0.16788405677791821 0.25616507479777728 -0.76303269627891368;3.0612753080008468 0.37576195380738753 1.7153206228770554 0.9580619259858304 0.64243998197879881 -0.56595718909524717 -1.6496903817538859 -0.3058825823967003 0.60207638793162555 -0.21978965445976126 0.9768067609935791 -1.8823151679681234];

% Layer 2
b2 = [1.7024852034183648;1.3408737689137362;2.1428358486143355;1.5297345714995818;-0.80855703582861427;0.26203314092937685;0.33754269369091383;0.14401007440370209;-1.23926446462633;-0.1032659983440673;1.1235796303229795;-1.770234639609477;0.99902838124134119];
LW2_1 = [-1.0630812844953652 -0.37447706867601582 -0.19978944344376678 -0.4732356423788151 0.32031209154763574 1.0103172528903639 0.9229709713907297 -0.39706090788991921 -1.0749022369106267 -0.56827551914518681 1.0499016145759277 1.0981311513163032 1.1205624665771861;-1.1237737708230735 -0.47335717783837328 -1.3033018067907816 0.7570082548695013 -0.56909319736259312 -0.14601100939746708 1.5010060145814288 0.20928356860916456 0.047446050585289175 -0.21712301867708905 0.90758941391618686 0.15322643878174275 0.28562884942197186;-1.1772827012735865 -0.83394808704304857 -0.99866327369273755 0.58649609578232798 0.40311993965142706 0.15107290050977576 -0.6293091658227965 -0.069644758568357862 -0.075275784775567109 -1.8722749912305732 0.40229785809943513 -0.69483662285220471 0.11115737558869027;1.0474385845289058 -0.16427817517566917 1.0374465943386939 0.76223618073067045 0.16953989613682174 -0.06131704653219848 0.099703842935833203 0.096590236256735795 0.15133416386938839 1.3839012799289643 0.20425842214192141 0.32436158717482577 -0.10329169138257041;0.25566204955483551 0.27694062926871638 -0.14501968368273149 0.10388325992470822 -0.95972197952416904 -0.44593526856704835 1.0998921425868882 0.1108115415375264 0.46218160838736155 1.7968988029279251 -1.2621187110492378 -0.13112430377966694 -0.15769698297925175;1.1149209164434255 -0.22800979867135879 0.31545041966161402 -0.11513132703359669 0.48613426779572 0.45002716734232873 -0.76441974872843199 -0.44529606685926826 -0.37536639923487963 0.2814762849300293 -0.41428844198323478 -0.016646289606119233 0.047265375241564767;0.32248100845785227 0.027958999056209466 1.0686594313297628 0.64063487439610645 -0.36257600843222448 -0.77636008129645862 -0.34361688455157813 0.091856810247335607 0.4458076350891676 1.2822878244392801 0.17309798018668562 0.69939081900459343 -0.46816985506278569;0.24963403569538603 0.15255959973651445 -0.96812173285214609 0.54004823282471703 0.22756959514903968 0.49050418126277229 1.1029196043651139 -0.2207910224036545 0.42973101349031928 -0.42345807866612717 -0.42985563299519081 0.010552054310080064 -0.81865569065759214;0.68647304883813431 0.24808199052687716 0.60429338208694028 -0.6191573487555998 -0.34433891588759197 0.1722704838870851 -0.79309449006808663 -0.60433908876608944 -0.31751192794243416 0.66976369847685358 1.1154848714468883 -0.47726791558725684 -0.6892998335249223;-0.019250048027107405 0.054002435860047798 -0.17738728825708935 -0.077299525353572984 -1.165579584303766 -0.21132364816677912 0.56721199501205743 -0.53379118397488956 -1.1982712715006856 -0.2013730653495262 0.1901025983936159 0.95983781281518532 0.2983131980390481;-0.23546189750105612 0.023639704763248781 -0.58501260936771837 0.34325986263368702 -0.66028263556451383 -0.2886110524897596 0.079535368360730357 0.68762736198604535 1.1052435267148399 0.099157610725713968 0.33758661159227915 0.46642522757224736 -0.39939789184923846;0.30855928110442676 -0.60992307708298266 0.40516339007254548 -0.78231011734223488 0.97139716808995369 -0.16679111353012457 0.14273745482887312 -0.55404052870104981 1.0466434091047547 0.42619154763146727 1.5776223618557985 0.59741746621752578 -0.8597691535881149;1.4442859196818638 -0.33778973852848726 -0.08589102231418827 0.53223683797358423 0.95355961726717842 0.57626367488601571 -0.61698579403892773 -0.46273341913977889 -0.20017588527237107 -0.082584068884266074 -1.0731133389302157 -0.018387209902519783 -0.32081391468513454];

% Layer 3
b3 = 0.79971801861353331;
LW3_2 = [-0.2045363280416069 -0.93813495421762827 1.2546370312792745 -0.93985857640049397 1.0291766639909723 0.94730779088859673 0.35500097058748104 0.31059965389255334 -0.54337046886645335 1.7694433954912194 -0.5664044603769901 1.2680493617410995 -0.80443567878352684];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
