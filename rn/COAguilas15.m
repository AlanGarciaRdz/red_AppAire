function [Y,Xf,Af] = COAguilas15(X,~,~)
%COAGUILAS15 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:19.
% 
% [Y] = COAguilas15(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.448430493273543;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125;0.281968137600451;0.304971027752364];
x1_step1_ymin = -1;

% Layer 1
b1 = [-6.82386840926657;0.15475548368345934;-1.3186554873027498;-4.1547777561992314;-1.874293762876835;-0.5633156556164336;1.3426346616515481;-0.020173067235666142;-0.1130482434576541;2.0278777745947729;2.1093739353526497;-2.7544540400380928;-0.50037025025993531];
IW1_1 = [-0.81319837790646177 0.1630623908538526 -2.6602959467902139 -2.553736346912769 0.052904940261546421 -0.15596073072373082 -0.63445624278853685 -0.3972365157973427 -0.061868145255751378 -0.05496525814793024 -0.38722608461954611 0.096066261223486729;-0.083020317604887997 0.32199361335579996 -0.66042116327604994 0.32364818610896479 0.63226126823400219 0.445430021838357 -0.73106610180484333 -0.13673399631958613 0.16669733610284468 -1.0336620342458189 -0.60677453902801759 -0.022860380845057121;-0.18706299645714361 3.199586277695428 -0.070445720493215264 0.025411132571799812 0.14304299740537396 0.38957792477146119 0.66333479592739897 -0.3697632876689787 -0.14819292260358088 0.21761148869543093 -0.32998308173006702 0.22812751208320806;4.5269018567724757 -0.87494518708004487 -1.1459264793374933 0.86289921644813183 -0.68358021101609201 -0.67100816697612664 0.47043592981434151 -1.3526164256040984 -0.14063538307740076 0.69811942108772151 0.2086362057408726 -0.70835897943911519;-0.13695404721649249 6.2476648022608954 -1.261283285964272 0.97378804784474182 0.1812034232921973 -0.27537130625620121 0.33064840516224919 0.14051709333740706 0.071602305799917193 0.33017596068608618 0.56417725717598111 0.26092530728428909;0.17606680747893985 -0.88321392659222442 -0.40219540028260597 1.2045508825929829 0.69727822937125172 -1.3921947044661671 -2.0590295314820115 0.53400209869983206 0.25177412182945086 -0.19337097032219772 -0.14635371136540423 -0.46772133202874816;0.041315088323831045 -0.99593831690197232 1.4454826552709912 -1.1364951789621895 0.31872521278537691 -0.91841077127627324 -0.14181648427251542 -0.094934042723872056 -0.48145524838243081 0.3667574000992791 0.44764642612964023 -0.15731563585454592;-0.084782164973357804 1.0885225281639492 0.078970805096253247 -0.32146566030162044 0.096904907502977172 0.67818188985969519 1.0321699002168201 -1.5165040535577439 -0.14647906079187398 -0.13350985238870067 -0.67895469549639065 0.2508928723825618;-1.1534766184647767 -0.94021897487832573 -0.523889555721338 0.95012494826727045 0.18923016022155503 0.196093002380343 1.0074355599859899 -0.78879330615936816 -0.025837660020349006 0.022880385350724917 -0.21196945479143856 0.0091168094889331718;1.6367561413913996 -0.96055280839348545 1.8949546654817797 -1.5448270697669213 0.042421735894444326 -0.17629682406010874 -1.0238343592926789 0.2021615001098537 -0.69684291068759985 0.77063340500636823 0.65350728194913321 -0.55414687368710092;0.89455967977130246 -0.45929797993434307 1.1477003423965457 -0.59962932527313806 -0.055690675532951969 -0.26944275125821426 0.79308911175810803 -0.032507464185269883 -0.30167704979665361 0.48133897522990438 0.86553021576916389 0.32083585247392765;-0.96367184019906404 -0.027263992928463515 -0.96473211142603843 0.048411739173958926 -0.9186312993439758 1.2899181670297943 0.73782299750808622 -0.48992042099802702 0.59664405814232824 -0.31080478801952649 -0.2213111726774673 0.33579098495261578;0.97740038004986463 -1.7975116146069485 -0.34560025251430987 1.1201599860495006 -0.090506103402648974 0.36763311580091756 -1.081425759274891 0.72499736235678713 0.48501507288445778 -0.59143624627132818 0.083042647993907301 0.093088829649805874];

% Layer 2
b2 = [-1.9826666511260731;-1.929998886020988;-1.2780278538986349;0.34360256719080079;2.1779916894637905;1.3719633101711792;-0.33107402735659153;-0.016330753287149665;-0.011702530904179585;2.6719974335319381;-3.0654971627666572;0.19445164760292963;-1.8668031863857903];
LW2_1 = [3.9506114878645264 -0.72403104699258214 -0.81170745880763473 -0.89860694750673631 0.92031468270343464 0.6011721773526344 -0.78872242851730767 -0.8830655433827399 -1.7015020090312012 0.95535847142396235 0.9419827822450858 0.62700965374767148 0.79716704694301643;0.64137703614729258 -1.6344082125686852 -0.50669867680847369 1.0873559290391315 0.31386254828359261 -0.30710039007859857 -0.040855165101831209 -0.21183629454646868 -2.0011860873446348 -0.25680047883687901 -2.4809502071796348 0.11729774276544713 0.17331483401687878;-0.7552128282864019 -0.19018062727261689 -0.11283006698089182 -0.3646648542563235 -0.16229176574801896 0.46920579539201496 -1.4493586165978225 0.37140832541260871 -0.52625757349704827 1.6018020403458277 0.52599674261683094 -0.42186572332622385 0.1222660507785933;0.74950079575278716 -1.32276754470034 -1.3491853878840625 0.04628037560653922 1.8223380661406905 -0.94262149698965891 1.6446179921945805 0.26473242089388382 -1.0365740521351803 -0.99452879298469132 -0.9371108966468098 0.29996222648385984 1.6648700444223976;0.63390885452802426 2.3176176901241781 -0.4916953066157016 -0.80603478343728496 -0.9436198636735742 0.17059096657627232 -2.1495141227681187 -0.034103498322013134 2.4754708217861152 -2.7301538381940387 1.1278911089452479 -1.225136249973162 0.96537990377429073;2.3569969175974297 2.3921352880230451 1.7469136494623778 0.84547792714779457 0.98539872623442437 -1.0170351887183944 0.81303641127306714 -0.8032785100657045 1.5811252659656372 -0.075545736936414615 -0.19090169725357653 -1.2059162363611584 1.4410183399757006;0.94796691801369204 -0.43294558145643497 -0.685598883822365 -1.5173762068010948 0.72805897064031433 -0.27385715892828705 0.51927030764062998 0.075661203039221483 -0.17398112989992295 -0.43331874387396574 -0.51419366152887069 0.60329491617925668 0.44368806473250655;1.0474195966762063 1.231514026946732 0.057321069179134834 -0.3882709271304241 -0.39529168097675638 -0.088578932086509521 -0.59504260335971393 -0.063807343445796236 1.4030746211941358 0.19776590069814129 0.10023144813964334 -0.9443247798520209 0.25424598951998845;0.53163196453663064 0.9027230722148768 0.015877839620434916 0.12099485922830457 -0.21255506417645936 0.19242207970712469 -0.54608772823300467 0.14820525951886862 0.92383204935774088 0.74751054468352085 0.11597967438818754 -0.34380899986486463 -0.049263375449149396;0.081069824934239448 0.52025369982302749 2.0498845132651766 -0.06690689048935182 1.0540335526104285 1.144963298751297 -0.39073859305978342 0.1342628960526871 0.13199775376125744 0.19349493185271169 0.38610313189367823 1.4016929400873717 0.54101792098594281;-1.1256193271847454 -0.72232775821480022 -2.723204400376658 -1.7890313559095001 -0.15626224320797044 -0.48551675628324159 1.5271445473620604 1.5538047321084236 -0.27721777417794186 -0.72359951165107472 -0.29485057479533 -0.44371305734137784 1.0837556347146047;0.81623278443928404 -0.81051045622441342 -0.58578680937297078 -1.584730785570329 0.8379338101324898 -0.78108555173912952 0.66019714858537304 -0.32177537668761858 -0.65052387998335226 -0.53949974083262053 -0.38020141442912625 0.051304901921381922 0.49851752209609346;-2.0405137693134741 -0.34302189464972488 -1.7101964754652479 -0.55674799896007154 -0.68803751867489737 1.4305214667831292 -2.1728534389591192 1.4557576751997168 -0.77743707878707302 2.2112313566562092 0.9584671641819793 -0.52187599118066152 -2.4829611846970225];

% Layer 3
b3 = -1.2004542972318639;
LW3_2 = [-2.9844823468871926 2.755797902871497 -0.90136081984293237 1.0474468451425505 0.17013962240831354 -0.27995377906523039 -1.2820856422870532 -1.4717221748987883 2.247571499480769 0.39288063991720096 0.3332584332321587 0.84774182784698915 0.30770977446366748];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
