function [Y,Xf,Af] = PM10Miravalle6(X,~,~)
%PM10MIRAVALLE6 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:15.
% 
% [Y] = PM10Miravalle6(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.0564720704495743;-5.4643658352707805;-2.4057957544716482;0.024212782476408741;-1.3842049301313999;-1.6879729066894229;-1.3813634018275214;5.9808809110084216;1.1339133087554298;1.7361297358667569;0.99364263036347555;-1.316196889518394;0.30216603573662432;-3.1091947467181007;-0.074648983025686164];
IW1_1 = [-1.4328147519358447 0.71841559232116647 1.764283144691315 1.1713589510640441 -0.19868801370758976 0.38206413948244494;-0.86009765062430055 -6.2139367635461573 -0.3378493044648932 0.88849299083277911 0.4511354815353511 -0.42926156727820675;1.6392047906806024 1.5457322510127618 0.37374182164710101 -1.8865533105069128 0.065152230921565482 0.39089347393777668;-0.7053433509508098 1.1157565981049817 -0.088106849711585028 -0.95219608322893623 -2.2960071998112936 0.62772299596180059;-0.36604536154357392 -0.062235216600088336 -1.0121063517306437 1.358486682495168 2.0752517955774343 -0.795831370899027;-0.30556616499838607 -0.67801810315261146 -0.79654157583081198 1.2938366600587319 1.8058765725596149 -0.36098754760693946;2.2324835060075974 0.84917359013883198 0.92527920370687644 -0.67768601550173047 -0.21340083200607149 0.97108589513550925;-1.2622462012534492 2.0063165475383431 -1.2346653963051433 -0.79008245434847268 2.0818945498576751 2.706511579492747;1.1491974127332794 -0.22633713949286893 0.12949852588939534 -0.65929284901591179 -2.9432227845508137 0.61776376596225013;1.8278536140221866 0.30650132281110892 0.50525176872944011 0.3879583892875631 0.16769425483120731 -0.10166182397175724;0.31902325880819737 -1.819469717620267 -0.68922934725207785 -0.63662049466645432 -1.3986639820551554 -0.26765031758094326;-0.22728865107069035 -0.60350724224946528 -0.22489446019321216 -0.26042057672038865 0.38246843535361857 -0.78120126602309903;0.95449618763586641 -1.2195314349027 0.70760516681494179 -0.99719383030021647 -1.2186929752498146 0.2837336158238068;-0.86944767667487866 3.7779246683732173 2.0236482369256432 0.33777315701405436 3.0632364308820992 -0.8280567970136633;0.40960955450175834 -0.53447702829598021 -0.48564190641729005 -0.096030111864943812 0.56444978917808541 -0.56907562021822833];

% Layer 2
b2 = [-0.94249243057826149;0.92316785006799207;5.5687427563271266;-1.0778760050763045;0.83880138920547365;-2.7811317903283643;-0.68867005717665586;-0.76237132397183349;-3.4499036838474235;2.6582352574147943;2.5076347539034933;-2.3875464431118427;2.163245550360624;5.7081158245479457;-6.2992742585034103];
LW2_1 = [-0.54072753543129015 -1.5620662378256005 1.6634087346412549 -1.1100012552542857 -3.6875059654122042 4.2677440239932531 -1.8780278559123664 1.0587427499462363 1.3948500154405266 -0.2013064491956541 -0.028405329273768747 1.0188810388088629 -0.92501056564706596 0.07909237853194033 -0.85966328653929758;1.9107682141475257 2.9424261633679194 8.3543679624328302 -3.7444866797971792 1.3406251143001144 -5.5165933078475904 2.9519248396572921 3.5219054653676349 0.51913737738110166 -4.1795122298901992 3.0364474183829104 -4.4821775573457519 -1.7687381828359754 -0.2463382875103641 -3.9332882191147935;0.58649713063807485 0.13606572570298364 4.4893468071386122 -1.2456698894108751 -2.4512964423703618 3.3502680175406159 -6.603446009977735 -4.2064967545023286 -0.074011118537228318 -3.6245421264234459 -3.0225069342065893 -1.2510438626390801 1.5960884893009222 -1.1293642688817056 1.0165190032452496;-3.7611525382113151 1.8607417041647616 -1.6799447604524254 1.7313373483469956 0.5238679739452885 0.92587473086686145 -0.12601364405507892 0.08826948870436338 0.51571682301267618 -0.34986612422179159 -0.6435285940916412 -1.535200507587438 0.11633127319287612 2.5625255373906008 -5.4998588094335394;2.2999256992518329 -0.41443072298481798 5.9044436086533363 0.23886670301823348 -1.9374742681585972 3.9179187219063869 -5.2520270802076228 3.6409556542869521 -2.6865298841549259 -4.3479443028778739 0.44123148671178819 2.3852408096679238 0.36588156639933378 -1.2506180661455384 -3.2054404176176954;0.03735099349246597 -3.6619231365129794 2.2433634119915036 4.2230052639794176 4.7499964139803028 -6.1027293509271656 -2.1696605608779551 0.0017055157845889679 1.5718101924944281 -5.6475423270910339 4.7851857259712425 -2.3972902312808944 -0.63507253568737088 0.84066465725793038 -1.1269264799580985;-1.4644695739461866 -0.47072698262510265 1.1934487200336692 3.8160361035629426 3.8073702145867001 2.8760657427727585 1.0969026713113661 1.0175398703583125 1.8054880782899423 -0.33937961489678004 -1.6682390894479793 -4.5012470461120904 0.41212964832612109 -0.20996694283067635 1.3668334930204715;-1.4484681126890659 -0.10890646104208153 2.6011967455727198 -0.5366959275155887 -2.1559902885757549 2.0581190158030882 -3.7449183465217066 -1.1511520125713943 2.1469097168411562 -1.4449526537960182 -1.0118023571095871 -0.52127841918722095 -1.5188913394691852 0.48913934010794441 -0.30604316910046669;2.7465949822912341 0.61117394079214959 -1.3473922353975443 1.2364822129077508 0.11053069446555266 4.1232278428736304 -1.3101514327434365 2.9448561292120323 -3.8361520150809341 0.14027168924269448 -1.4508217344497489 -0.017482426007813787 1.1163177334572243 0.78131179586177679 -4.0043769791190149;1.212194604548005 -1.0315837832193637 1.2571605957753247 -4.7945407341143964 2.9429270861810348 -2.8064325039650928 -0.29700623627005973 0.54051775220525056 1.834495803486734 -5.4791242942867022 -4.3057654720625784 0.7286827880092791 0.072081156772209609 -0.89085334895679691 0.54884995709016371;-1.1878800217141354 0.36318411913339788 -2.8122153644541648 -1.6283633549679775 -0.46575201645363801 0.83347385860281198 -1.4250803106892524 -4.3011001771297224 -0.71050396297239804 1.5458115896561142 4.7780445474485607 1.4913646241385881 -5.6206777171320397 -2.1805950607437223 1.3738508433103465;2.078107782287935 1.1362779229890665 2.7057539040775143 1.8967038216353465 1.5962157639053747 -4.7296358321176077 2.2785145827610949 -2.9241854289395177 0.024447650274036399 2.5530120544392028 1.0549105161075552 -1.8813539589734478 -4.9626572802801876 -1.1686012586014414 5.6386990703535815;-2.7202294903332476 1.3796378836796159 -1.4858137777691296 1.8936990854608002 -2.363613649843721 4.9660828965150454 0.12274927933559307 -1.0215974428955916 -2.8276537776133051 1.505280855893985 2.4357339051174387 -10.012166604003102 2.2284028420422084 2.6816945018153264 -1.1150815079877667;0.094177735078573716 0.39448631735500689 -1.1487820569786968 3.7714173615380733 2.0944063632005556 -0.18164937220146349 5.308978106745994 -0.28011093008277566 -2.9464238122963518 3.7827466105721825 -0.70994353176128755 3.6388458601380602 2.3421305442318352 -1.9570092718736549 1.1898861223016806;-2.2563427304529062 -4.6745700536286829 -2.2964371859092862 -3.8494613786774656 -7.4191177701327602 0.18663633837978416 -0.096796625740819334 -5.7534855418986375 -2.7327241426570983 3.4862764127940244 4.8858131276211374 -2.7789483440205167 -1.705475305758551 3.5902427725035473 -1.4195908855924086];

% Layer 3
b3 = -0.94285925336905863;
LW3_2 = [0.17943527176923496 0.051260723803133963 0.14628475333205312 0.18832268950621711 -0.1004546851302834 0.038415504529732095 -0.0692278488616659 -0.21406380946412448 -0.043232991858170776 0.077633964516598569 0.06877011452307491 0.11137619007130882 0.10070879615649855 0.056500199746724974 0.048372547637218995];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
