function [Y,Xf,Af] = PM10LasPintas4(X,~,~)
%PM10LASPINTAS4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:27.
% 
% [Y] = PM10LasPintas4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.0251256281407;14.7058823529412;0.0179856115107914;0.00280033604032484;0.0558659217877095;0.00576368876080692;0.00618238021638331];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.1362185404613294;-2.2712457040625833;2.7990353012668914;-0.015265188167900578;1.0587915342668337;-0.71973555537537848;-0.19139282778453315;-1.6171464018971942;-0.019566891081955265;-1.0847157384742543;-5.6703552031605238;1.8117564127861652;7.8012178953400548];
IW1_1 = [-0.71786146676890694 -1.1943642335996296 -0.37178486507867198 1.2786974524209973 0.15908062677408097 0.40164649537248071 -0.63129003338363698 -0.2253692097858683 1.4128900399403987;0.86689906570557573 -0.023291689648672009 -2.1913509877813655 2.0856911409180254 1.3325100810878698 1.2689716308825036 -3.6352107857787987 -0.83250813058679662 0.24645646504563831;-0.91719637248395802 -1.1556175910905624 0.33752991437462865 0.94643897672778987 1.2297264249965327 -0.4650616842308426 -0.76121954946784709 0.019083183286542949 2.5067236452703776;-1.2206363589380018 -0.41666088207833307 -0.78857045937546755 -0.20740938376227 -1.0593736660990423 2.8838402764969535 0.67906309321485059 -0.067538621291029416 -1.0020631279628183;2.2181489858360806 -0.75877772583932812 -0.73108083345736341 0.055179518490203722 0.87562936569002814 -0.44691064087824067 1.0066453452207946 -0.13498844815332231 -0.2472200343104112;1.4529141157039089 0.60500788754089774 0.26368904571189017 0.24328509416534397 -0.10073053815147386 -0.20120837704902217 0.63019041254193064 0.020790872097874988 1.303603504774512;0.48870754096956182 -3.2190912253077966 -0.57657045689305053 -0.20616013724250731 -0.18740922134501864 -0.22272501949422546 -1.6280507035607317 -0.16245276191661276 -1.9414516552535213;-0.86344498433230277 1.7638779091291674 0.69009474740277421 -0.81630871307859554 0.23567191228942061 -0.42099449403415895 0.58176697691773904 0.37988697042494124 -0.21023602375285477;1.5288220517869098 -0.31921792224697182 2.061172925137233 -0.60834304508524017 1.1508913524644675 -0.89908889050073082 1.9528761399223979 0.5795382103133222 1.3188678444353743;-0.88724131390360539 1.7832576111039098 -0.52415361819886341 0.039183992174043634 -0.14875906831553865 -1.2659536139353282 0.73965282303305879 -0.2013855042895781 -1.1627176103713683;-1.9407390845696777 0.59856923640636461 -3.9773107668617063 -0.27417931327730977 -0.75852753438153198 0.35980884852062273 -0.81646614514446147 0.17832145701441846 0.15431976757128257;0.6576438657813084 3.8239770386467855 -0.55725991631401584 -0.072731478908783384 0.079727286080160026 0.28808742609503413 0.20700600600845337 0.07552211090711726 -0.23091996029916617;2.5828348732792694 -0.61341823304481857 -0.72393385006982547 6.4311776543770263 0.76294876649479537 -0.42881453472067937 1.0344967677284926 -0.16139243245792595 -0.12723639153827368];

% Layer 2
b2 = [-3.593641389268889;-5.8341977573399344;-6.6303933006269604;-1.4934363870440366;-1.7194157110548851;2.5555618914149556;-3.3197996464924775;-0.10885278458101735;-0.52408547988573773;-4.2771633719353543;-4.5376739127424095;-4.3063283576730127;-1.3997506165997691];
LW2_1 = [-2.8200635522922033 -0.88663359409251719 2.1663428662340292 0.77597923955564219 2.7291005977322103 3.8202878185663174 0.63472085272578327 -2.0553493488257999 -0.4456609525657047 0.69956149248443045 -2.0413369641936128 -0.94981047357524329 -0.33439939959322479;-1.2096310552414056 3.1332025602960787 2.6030951064209944 0.48654951100418536 -2.5569339424904394 1.1990681181122387 5.343911040982797 -1.8616921534870126 -2.6980570781242963 0.74213157271656371 1.1538652460593506 -0.36594872019711028 -0.092047978718173121;1.0688261995436457 -0.060333375745214801 -0.39084632623677584 -0.48353150901717884 2.04654555796836 0.32552429239856717 -0.90302735620933217 -1.6825201300064891 0.73963725999163354 0.52813770091618251 3.4737096350951675 0.2026344198329191 6.5120402201513814;-4.3605729864504017 -1.7706183289035138 4.013935753165593 2.9704005710615595 2.6491065022489493 2.8756876760852301 -0.78176567618483206 -2.8850138567121699 0.22098913242474766 2.6190648033841692 0.60021649320631909 -0.014266670931562957 -2.3439491817797156;-0.7619978535690568 0.81928766383530283 0.14837286341480943 -1.029298725630267 4.4638569268944686 1.7491632825781356 -0.045513231176084162 -1.4279639509064779 -0.86507151224166901 0.17611513216654798 5.1612366761990982 -0.76869618701826525 -0.35411475018673888;-2.2813481696177118 1.0470041371215508 1.3835134346919524 0.79102405344871818 -0.40663118767814332 2.9203138104182793 0.015698022095187784 -2.4692406991778642 -0.27506635399643625 0.51860647894379297 0.38272048953509519 -0.034373472625940316 -0.74091647212759992;0.27393117754533358 -3.2330756260926918 0.67528135003862821 0.48734988290493847 -0.73307585031469558 0.64358033771121781 0.41844493980117553 0.32547571465106984 -0.073263405980053181 -0.37238197662494854 0.60851357052739841 1.5779664994416931 -0.2580477750208735;0.23435882201959246 -0.89276277946042137 -0.37145115019284358 -0.076591028017363075 -2.7915595207029429 -2.6162296522926494 -1.7531788413216747 0.63608870050508992 0.55036535814645959 0.33385118129468727 0.98195633345416189 1.2653830741678547 3.2253385983442779;1.138411656330701 0.20889243081313702 -0.91979497034613622 0.39197378660248372 0.42063249918575341 -0.069851012029865822 1.0170204930987823 0.66132031971055738 -0.30401332092189032 -1.00055238880292 0.46831594970346252 1.2016683841676785 0.24003831960912267;1.1050931646712421 -1.8069616323328777 -0.65927402756258846 0.42030704181948708 1.0682456780023823 -1.7745495840220322 1.1738728800012184 0.52761201515946488 -0.18835257526638288 -0.84399985130648469 0.97075563166017909 1.3929722658096431 0.15182070149532548;0.2182424708562028 2.3048456625651963 -0.27404031949175295 0.85946515226330233 -0.66547403008294093 -3.1681416753682052 1.67915916701427 -0.58295424217485514 -0.8227090016712082 -0.79211760235130979 -1.6087993159502918 -1.6461983633468409 0.97260070224292994;1.1956383363438661 0.47544601677767734 -0.5415093188498985 -0.61500974301139655 3.0523662761005377 0.22534914647239662 -0.85185523247433403 -1.5952590328150471 0.81683807590401114 0.77699657806220934 4.6963118828954995 -0.02847869569602398 4.7554517191495469;1.8253978375450535 -2.6588943394392492 0.15765183104917119 -0.35533023626730809 -1.9468674741460215 1.155461272451898 0.94594010858215583 1.3503623783847669 -0.020073466341612486 -0.68920613379316198 -0.10186516591731358 0.99400091193600593 -0.17668200946977802];

% Layer 3
b3 = 2.1850456568934717;
LW3_2 = [0.28167444821892629 0.27855528359520743 1.1857066572483139 0.10643135534785364 3.0860193631514563 -0.40867312493999447 -0.31432118102512069 0.45513343246467458 0.49369515230616534 -0.37664142208453355 0.24040623729167754 -1.2336768690303517 0.24688941052497906];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
