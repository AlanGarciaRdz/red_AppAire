function [Y,Xf,Af] = COVallarta7(X,~,~)
%COVALLARTA7 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:20.
% 
% [Y] = COVallarta7(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206;0.201288244766506;0.281968137600451;0.290275761973875;0.304971027752364;0.100381449508131;0.172786177105832;0.171659085057077];
x1_step1_ymin = -1;

% Layer 1
b1 = [-0.30270365980775671;-2.0414028973346312;-1.4221941742741333;0.38729798931790116;1.8583268894397438;1.0910512556246055;-0.088398883002817119;-1.0130118049024484;-0.16737626429762209;0.054230518162976901;-1.0775995179244882;2.7254732978119462];
IW1_1 = [2.6617719508599049 -0.21702208294195785 -0.8152258867555342 0.032526725839431586 -0.59241863972070874 0.053413648851288555 0.11233271741117279 0.45315207818795311 0.16129009424552898 0.3891270346071391 -0.096972076016126257 0.73323935513462535 -0.94389876635161718 -0.70071285365754643 1.1119274533622163;-0.00047855624181543377 -0.20742629080731823 -0.018337224644697572 0.21185070753141444 -0.45957834261870978 -1.6873208898239442 -0.81483668387534058 -0.0022579387113031146 0.12159983616698405 0.10903589728311548 -0.13163938657885826 0.33667949113984508 -1.2511254174328632 0.44140809740230819 -0.557233718409052;-0.35827614846953992 -1.4625439906413857 -0.93004685940278764 -0.23964500387513354 0.22525509779499178 0.42692660735365762 -0.18155175438603699 0.43354622887063626 -0.39489380309628791 -0.2217500587825019 0.027899802381509173 0.23373792359698553 -0.030495574097120476 -0.47205600626639366 0.45475577886805885;0.63548408454871341 -0.77985859423438852 0.7807955484123279 -0.4551624008796244 0.3171397854920005 -0.20150040161833746 -0.21742807689187221 0.015612403406356171 -0.32945879503481451 -0.11253063063262357 -0.21322597724432321 0.11937456161193838 -0.54822147481611139 0.42312652614224616 0.071104356128573493;0.2976453120621062 1.2851819761119274 -0.094266231549840263 -0.18554347224450637 -0.37309445873766839 0.20945831906440937 0.22601854233483398 -0.16454544695669426 0.2014002796526379 -0.1965206719271182 -0.020141597760989231 0.031552669452477006 0.52304212264615446 0.60848244306506938 -0.46722665039209177;-0.18418335111888107 1.8221364778591995 0.58949714763103611 -0.43714379009414556 1.7120908129010917 -1.0498900326170522 -0.15999485856834689 -0.031681978106342407 -0.44674945434217317 0.11803590886255413 -0.30828487050645248 0.065373035388214956 -1.0011221862488051 -0.036807548730940443 -0.10324381154526749;-1.3142965604449071 -1.3425176675327379 -0.69839497544955165 1.2490333881497595 0.6978407400788178 -2.2715344783629705 -0.39387562121195274 0.024568088618852152 0.11535389679493861 -0.15878799524939075 0.72192261429260218 0.38923395585524612 1.0369112629149495 -0.067050544334763942 0.30846736591708052;0.49546988375150819 -2.3232001355668594 0.19535594571195999 0.13164434277057893 0.61973532049230518 -0.063168400099911579 -0.023228198077706198 -0.17893042003095166 -0.16850116330972517 0.04553968608698454 0.022779885729108735 0.054079705400325202 -0.36077399372288971 -0.35324501545768189 0.032232033198141719;-1.2782897946079756 -0.51841072102702712 -0.45194800842278954 1.2132592670234323 -0.47099383544495221 0.15100194771049169 -1.2783001747113052 0.62180491000263682 0.2290120824075027 -0.29587803679807778 -0.4310535442866309 0.37704701699066373 -1.2956244868358366 1.0559812148048775 -0.27678034392058259;-0.087139620755055658 1.4017124953455222 -0.4943159232301168 -0.26198519236070733 -0.38460453283672646 0.65115158526485373 -0.20828807980252434 0.27507562318776607 -0.043626648442980288 -0.10630145674096286 -0.15485628241102836 0.10081696981035822 -0.27437520605693999 -0.074923140658686688 0.47641007151164499;1.2837284796068447 -0.051260578968417764 0.019471640081802147 -0.1059599226677312 -0.017910763604483577 0.54919894105097 -0.53308641684588354 -0.20342790537451333 0.55592419948448102 -0.23107758225894501 -0.51343268054063906 0.27968720028641342 0.34814745602936048 -0.19391709867112436 1.4396352061560591;5.3342443969699582 0.30370968838116508 0.12935969567411726 -0.68102439872493581 -1.4027104630039724 0.13426592363533765 -0.020498170105714475 -0.53263917178991416 -0.0047171086159419652 -0.21712040480241759 0.19222290925355245 0.030718140229840256 0.2259834656004496 0.93829104633192106 -0.10858752416342102];

% Layer 2
b2 = [1.6377787260480057;-1.3234334945550217;-2.3547164847575228;-0.77851521587780592;1.0927381098736237;1.012789580131304;0.28855945815616102;-0.89114623663315173;-0.14149088458964704;-1.139642158695215;1.7990236577766761;2.1067316522984711];
LW2_1 = [-0.37488185057282103 -0.14219206950016 1.3630703311668346 -0.60659155871836501 -0.7781682741586291 0.78630003326457776 0.1889414340136728 -0.77081532302780043 -0.15941426620754129 -2.072246630997741 -1.4674495296357086 0.64130491779578158;-0.0014863549697769311 0.011533429780128715 1.0438691915555272 0.87901430680995385 -0.14238653956190891 1.0388207953614503 -0.71100700301420972 -1.0671040335395416 0.5256635431206923 -1.0156703444677648 -0.46602289256004248 0.12576056964650345;0.45066969274628949 0.74098815070664625 -0.46110613982315979 -0.91628779320335907 -1.5248647313832919 -0.18503487737835245 -0.94377516392225003 -3.4408355925624585 -0.63110382016873701 1.1226672971445248 0.37557801060597645 -0.47579458920510243;0.10744534908952234 0.19498141069144012 0.70209963320340651 0.25019807871478483 0.067133801600316789 0.87084936936515589 -0.67766069302224774 -0.69495779928085677 0.166203971213987 -0.53793292811905924 0.13869742039366662 0.15538644995684847;0.45377510329836196 -1.5388518188867786 1.0990985239297066 -0.018747550984889151 1.8425817442502019 -0.11715184443844566 -0.0098721832882532057 0.0080072251443598363 0.97835156979936522 1.1505224156221618 -0.70230787457848509 -3.1342892862860094;0.31837700914309353 -0.11614610276627542 -0.684077492253092 -1.273907059260289 0.83989230668362103 0.49051257439087226 0.38148711800738105 0.79907934558472948 -0.015080551360017331 1.495214573244692 -0.70582184810288551 0.29943279627470692;-0.19320177234675845 0.5358443070693435 -0.79739577596933775 -1.0446379113105639 0.53034234227263721 0.64285755310409431 0.3270654634067065 -0.32576859311641482 0.49907585417836214 -0.85039694297505808 0.76302734415386853 0.016081950137952404;-0.786527401649455 -0.9960412050940165 -1.0034011417957414 0.95557407711545339 0.77763633068017812 -1.8084191207847033 0.05031209735618683 0.26666431042634081 0.70874477614361708 1.4617387488460512 -1.5139301790728696 -0.84831385221840194;0.024424440346205376 0.15563854660961876 -0.21625649775721331 1.0878739117662901 1.5442759970943911 0.36193663300919182 0.67405713445378446 -2.0332939366751712 -0.16156194955061334 1.7306093031983716 -0.71573136928053505 0.67901565245841344;-1.643988724733799 0.51852099869621882 0.17401596066651728 1.3227361921881557 0.1235414715443946 -0.46243454630197073 -1.0291503569448921 0.59712792328582398 0.078655226856452654 0.045305517093065517 1.386643144033842 -0.79744260308024217;0.2802920702469312 -1.4448354214806554 0.81238286393937342 0.12065821975576153 0.93295077622955924 -0.31590060231995892 -0.32661865872008927 -0.50392033652156909 1.0091217364754346 0.62849841192432754 0.41644656606536573 -2.1749658994326273;0.6428300435020291 -1.0430666815488059 0.85363426302544387 -0.4054579715231903 0.13328186759247104 1.0037230946709264 0.99395361150997497 1.0857323701174839 -0.47350470602215244 -0.91393101194528292 -0.047891584405604579 -0.59699709028589987];

% Layer 3
b3 = -2.0470518581849833;
LW3_2 = [0.57309449371158905 0.74251203632176765 0.33780509804493597 -1.3308667081652341 -1.0096039350751205 2.4401261499943576 -0.25285852661807212 -0.56496998263643983 -0.55082345857400072 0.65954010040737654 1.2198597742375679 -0.21159628839792893];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
