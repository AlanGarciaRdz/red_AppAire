function [Y,Xf,Af] = O3miravalle20(X,~,~)
%O3MIRAVALLE20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:43.
% 
% [Y] = O3miravalle20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.304971027752364;2.48447204968944;0.056980056980057;0.0063552589768033;15.3846153846154];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.7742944904721356;-2.0333538587839088;1.082198917057448;1.6655496861013659;-1.2694150116889606;-2.0608905652542067;-0.82399851367187704;0.20920757810514851;-2.6879591560923473;4.674246933448523;1.4294405544110533];
  IW1_1 = [3.7045322402442995 1.061682137881383 -0.88250650295194799 2.3620959785774645 4.279573955740883 -0.17115987074898181 0.0017080147519532018;0.16028184745861651 1.2921639826756461 -1.376369813390196 -0.30289701859348594 -0.059963765676408952 0.15159793936277038 -0.44867616420747947;-1.7875727337197469 -0.10537807190543952 0.2910153162338191 0.0026233053655794585 -0.15486665372564598 -0.0028058287406538332 0.12002113334588661;1.1337958614676109 2.1424754341551022 -0.29550601759995837 0.24687500974148469 0.06034023276004051 0.10057091726538384 0.95594095579955607;0.46946933513957345 0.57832112158291782 0.46277798322539304 0.25684308015781054 1.6662158451529059 0.040619452321046058 -1.2880347191032711;0.53646533828290954 -3.9710317727415441 0.63961152057428816 -0.86766682222192371 0.70916228097592038 0.16179467600266151 -1.2121420847922539;-0.47926686418054054 -4.8023688891992444 -0.23651669156453503 -2.7109101835025062 1.5075812312750714 0.088064699690884929 0.088496217795956067;0.32170170792881886 -1.0102090491063196 1.1752620785252723 -0.26319401653575564 0.15036839448913622 -0.021993690475014253 -0.71982644375335814;-1.0952424304024579 0.60760322790933596 0.15579238325606909 -1.3501947100717833 0.3054897008809363 0.68687601209159321 -1.3376833569917994;-0.12659170753222421 0.92802982853684091 -0.22005187733477899 2.9465855924250581 -0.41512982330579562 0.13576282476915719 1.0534338825541598;-0.53766437513635024 -1.9877918726624844 2.0865398965985569 -1.3772931630594309 -0.89837142515484492 -0.036032680385031643 -0.7874684335556652];
  
  % Layer 2
  b2 = [-6.8194824619725534;1.1953758955604401;-1.4639615531441588;-1.7894165304304082;1.3773064523389051;0.80246867706783997;-0.7953494138654521;-0.37977027629906102;-2.9407473265725623;1.5757589785578352;1.8037947512786907];
  LW2_1 = [-0.23185277636505663 1.6916020754155117 -2.1277294435478673 1.4947867372546271 3.4777159236616257 1.4615212834063824 1.4893240030029951 -9.5493922258076545 -2.2656941073840242 -1.8659720593838951 4.1654941621713659;0.036879258666598996 1.5900285734456181 2.3329744828538699 1.5328714893975293 -1.3406671306051567 0.60764613444725879 0.18189544402915217 2.6856541700086005 -0.7469479006271269 0.083886418637387813 -1.0430355584653017;0.023804089340891996 -0.59501777614816331 -1.3525605086292971 0.9526979898729846 0.12667776556492127 0.33537014660394943 -0.03026636726064464 0.4606018359777182 0.13931782889047309 -0.1315746283270052 -0.44122253115398063;-0.28977135431843243 -0.6073792398483201 0.39607755414576196 -0.092011351602736019 0.027272333572236639 2.9492048856574313 -0.2310759583387067 -1.3696731817251568 0.13493538840535757 4.4125149070350043 0.43262545756494142;0.012737327973410997 0.62718147734951279 1.4381129797308976 -0.32940837074475404 -0.26081202204773779 -0.3785354434620371 0.16535018480785357 0.29022064780345141 -0.078669475363877722 -0.49660031149796152 0.0061105596732886902;0.26785458882272928 0.7234880821085512 -0.19399103516500268 0.11109112809855939 0.088531909392643354 -1.9181959979298215 0.3172881566871566 0.92949281755128443 -0.2050003357673941 -2.7281934215820978 -0.22200785271452916;-0.032285245991357146 -0.10966842641727337 0.43618956639410311 0.88755122140067333 0.13183705985217106 -0.041772949752998813 1.0643258949164742 0.42599831035590841 -0.34694212828128873 -0.33981853922526684 0.2242667241290412;-0.15254978685000042 -0.39999775777780283 0.17318319758783857 0.94079608503923118 0.088267967876011572 -0.18953775958912111 1.1481393668313862 0.4598529194610721 -0.26823388743889731 -0.82277115403832335 0.25184719921391918;-0.29099907120039853 -1.3100867087091785 -0.28792532908927848 -0.10772627751243902 -0.31033451044973509 0.76419696371295898 -0.27347219421886731 -0.19654991054261628 -0.041037836472563261 0.80371399700206481 1.0611216114154012;0.18637511615035085 1.0937910506338924 1.9094792012229722 1.0267813681396041 -0.70225059584650906 -0.28229173292061255 0.71522820901607531 1.8548151730587081 -0.34022547547562126 -0.59171969369903821 -0.71471664342474861;0.17100333479171445 0.44616771115818732 -0.17878037189909349 -0.36849068393096379 0.15310579217291298 -0.66132221955912829 -0.033436325229718136 -0.16720814584397981 0.209749206401702 -0.58274607548618884 0.021690182154017509];
  
  % Layer 3
  b3 = 0.9135842100519872;
  LW3_2 = [4.2916068745988669 -3.6953196429808028 -3.7431325094515318 -2.1949540158098695 -4.8441477601180516 -3.0826399804656583 3.2374245349183579 -2.7225884324757206 1.2131752934899833 5.9983933873040547 2.3637430742353431];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 15.3846153846154;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
