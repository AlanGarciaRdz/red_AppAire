function [Y,Xf,Af] = COMiravalle3(X,~,~)
%COMIRAVALLE3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:42.
% 
% [Y] = COMiravalle3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [-4.4786070954844712;-3.4587146368367452;-3.0252582361378209;0.86663359413234764;1.4992307642370881;-1.4032282332706751;-0.025715260650592368;0.51034575551663997;-0.54666240821043777;0.35776209186821911;-0.10604088568518365;1.6225273359099028;-0.92520457474973949;-2.1174993474995172;1.8856329756300496];
IW1_1 = [0.18727486726277323 -3.1690180356480804 -0.43205405564028221 -1.8898409488732815 1.7339938871621636 -1.7418422174601911 -0.42288424396378582 0.1619915802402557;0.84713399854104776 0.75502883606571525 0.75152952195887013 -1.7199543595099431 1.2296345469747576 -0.90555716461028535 0.5872420995964176 0.15735159290593639;2.2216922336369214 1.964065207525834 -0.17491370958792432 0.38744111694962707 0.53961009001550397 0.50445245672514594 0.26077328481239975 0.11906951561454668;0.76080505873366233 -0.14643666290249299 -1.858843171295206 -1.0190807731404758 1.2014448725374092 -0.49332733434954945 1.6254146160110794 1.445706166515411;-2.0096190684981847 1.7049742599297091 -0.13767556228839023 1.509324997171962 0.80383767816436758 2.2995778509705169 -0.27058986417091629 -0.51151134205947602;-0.20598924446493905 -2.1798326378693078 -0.98841273011951292 0.11554075847315801 0.23168789376653137 0.45532204083378219 0.12374212321721538 -0.44032020505363284;-0.3535707860426725 2.2469008282116132 -0.022186547415465177 -0.95029682778907987 -0.22445963065478744 -0.056920926940492181 -0.016292481118874092 -0.013357616842691057;0.32179143906881402 1.0451539905357941 0.25013249975359569 0.47850729465400482 -1.0688899779064582 -1.1747249196132017 0.12455670113184063 0.32991063171225066;0.020861606795200969 -3.0394298180049639 1.1386248780242798 -0.11686840702358373 -0.80632879052821693 -0.59284536211665229 0.16568242836564318 0.27638013468198847;0.22556918009309612 -0.503606199955692 0.024450604144857967 -1.572305825189354 0.90724439853764705 1.0654091885784136 -0.75474919160870269 -0.1474211821300678;-0.27130890426243398 1.3159671197756464 0.43523931254674397 0.13541230853118053 0.98824436741036981 1.3701030552427826 0.64479068373361048 -0.70112607332680577;2.752341918792355 -0.1354173152627135 0.78747497124682231 -0.94099937816147139 -0.1748897493642606 0.85829002762618534 -1.2086517460894175 0.098235789065137066;-1.908306291016669 1.5031154896397767 0.33060501455370955 -1.0623749307222392 0.25157720397841055 1.2078144168030298 -0.084665311741114843 0.15795656529500124;-0.0080711454855195014 -1.2235136225320977 -0.83920398121948325 1.3631403320826609 0.4658675735081817 1.4323456945227091 0.87220268903711429 0.53635615581949103;1.7736293529989346 1.8367405896932332 0.50213106560495457 0.56401859909295704 -0.0079925355400158552 -0.57077178123128958 0.22950550578713416 0.30722115767617381];

% Layer 2
b2 = [1.7217910777956533;-0.33239540621721309;1.83982904372728;2.7384021968239556;-1.4844888946888819;-0.29526678097428377;-1.0248273166046367;-0.31734776430442857;0.62865510974257777;-0.49520981161509897;0.95027923917989299;-2.4297580625341628;-1.7101813265463373;-0.72362506069578214;1.927364162946527];
LW2_1 = [-0.54334354103653915 -0.61628192599401588 0.36826618601494837 0.55493311599546025 -0.86242707181473066 -0.78215351244688103 -0.042796207936483303 -0.41339046070223623 -0.65914609120931356 1.057033733013981 0.2085561846174479 1.3998405001288476 -1.5253849354921472 0.26205897561302999 0.57910673825760384;0.34136980826209051 1.0718087065237591 -0.59324090378968553 -0.086584513718639899 -0.25026253175454888 0.89721571928764343 -1.3635024648807232 -0.55155170552047605 1.7301497506173391 0.85127750113391365 -0.15743120381722245 0.21182683792441026 0.95544291584780883 1.0759466670843869 -0.011493618579734834;-0.64556467974032083 0.045037249694303873 -1.0099141964326797 0.34237704436716987 0.21159744830993044 0.069024423304248725 0.71221141132018295 -0.45691316800178683 0.21477544621753278 1.0380753242225733 0.8409519253359834 0.41338507122028784 -0.72244205509040182 -0.29577372702717419 0.19067890861931819;-1.3054985627388873 0.64854741488631618 -0.78183918157302323 0.77343820050062462 0.71547964180623291 1.5116009108478792 -1.2055692900085071 -0.60684139278782234 1.3004505782980822 0.13217521616301467 -0.5809632237989979 0.82006348771938076 -0.97370004588700099 -1.091727134587043 0.80992440845333413;0.39068917697186445 0.82019911576061111 -1.1917627450261075 0.13333161670010571 1.1609090913613447 1.0827238346492427 0.374648070365521 0.053453509967115169 0.023180356113792374 -0.29529527295929453 0.048776642762209499 0.73421487641434857 -0.72911573142217123 -0.0065354056883305863 1.1338370357178811;-0.50003152366132697 -0.96038861916246909 0.14820804260795892 0.10414657764890428 -0.16605183165757653 -1.3469221766872312 0.36286621364350885 0.94439973603866112 -2.065434306282683 -0.57425248702897158 0.28130015886395154 -0.13675612460480241 -0.65669350462753195 -1.1409402724844482 -0.52427302430878009;0.15647969703084577 2.8264187204145301 0.034172655407557727 -0.24039338655219994 -0.8264712502441498 -1.1147203560269148 1.582621419467898 0.079745373165135996 2.415891673256624 -0.92022617854337208 -0.15792561044837261 0.33000307016705993 -0.44050476531734467 1.077626233932736 -0.42010974962372327;-0.37170778521450715 -0.28035431919680515 -0.0098891717201982591 0.24236274987563095 -0.89895263588350105 -0.43843682979452608 -1.5736905618218195 -0.86831568708440909 -0.28613093342990514 -0.98435518149700951 0.41577648578207532 0.4475779005803065 -0.4293581318960647 -0.68518028836819878 -0.099508118556591516;-0.52049860591084296 -1.4506464543133093 -0.76625513829619307 0.85593434146140468 -0.1805148686169914 1.4483080825277814 0.1183212705381305 1.2106836180050458 -0.70291067146239494 0.5780247271496145 1.6201249235531618 2.5410358742921897 -2.8375583717044215 0.51237037378601036 1.2846267905178055;0.17654481947271744 0.85364432509779098 -0.32939196085118938 0.16474534193320739 0.97323902395626194 0.99548516386277541 0.079061093575922961 0.17525930222005248 -0.13672831800186963 -0.19438339177272351 0.21829098128090141 0.71455445135020401 -0.51355556857914086 0.031995853644486774 0.79508159413800172;-0.45709671476310088 -0.26764315197243427 1.3602406113833774 0.24268633226729347 -0.019531763411741614 -0.27467830900073631 3.0613255488048576 -0.48045309787722601 -0.51218405148424417 -1.501486073111993 0.23971895348467179 0.7237811709652785 -3.4360916980861478 0.11614414177208507 -0.34050949555862586;0.10948537426870149 0.78849000637207733 0.34961400015119126 -0.056348807219030378 0.49894956822431163 -2.9387363038295478 0.80249114794583642 0.49992264584721946 0.39331755880877106 1.002871895269829 0.39242226863789031 0.21011185494730519 -0.59033794848530985 1.060619637053966 -0.68192855810555608;-0.86919973726393818 1.7222273575485783 0.0099756929986539629 -0.51447209752219825 -0.7520172451313627 -0.94280825011335434 -0.35292368676058783 -0.18586877422614229 -0.25872366090325621 -0.11936781458189152 0.073043116649082085 -0.64170002268515347 2.0604534999737805 -0.13007779387117294 -1.1088809020094752;0.35414387286907978 -1.3619446593535931 -0.8385957918306185 -1.2489844095230112 -1.0991501568963498 0.24143061177718303 0.7113976607964172 -0.14215298916465324 0.95569370165461509 0.096847390598532562 -0.40012124957134532 -0.18394237760579232 -1.5252125642024477 -1.176073690673791 1.644747002129886;-0.15843650833042414 1.8053113039869118 0.069396039003273749 -0.63672430015067782 0.86254494341675136 0.87281692106206255 -0.12230659058152504 0.54086323413596449 0.23764401073154451 0.49321081848071124 1.0601887578798697 0.82919892409921481 0.045525885796241804 -0.060221240439361848 0.093664400987361118];

% Layer 3
b3 = 1.073485108643494;
LW3_2 = [0.44900831197999036 -1.8926099647151515 0.080018037131418668 -0.83227668310689262 1.2391748431222065 -1.9934383634928086 1.2459609122428426 0.26975624858710356 -0.39448327488436652 -1.6055995669405125 0.296930196315009 0.80984773958607392 -0.75406134729818619 -0.17964981052262063 0.3133161255614334];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
