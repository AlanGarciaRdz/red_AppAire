function [Y,Xf,Af] = O3laspintas5(X,~,~)
%O3LASPINTAS5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:47.
% 
% [Y] = O3laspintas5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.241545893719807;4.5045045045045;0.00280033604032484;95.2380952380952;0.212765957446809;14.7058823529412];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.0227170828184908;-0.56422803359481133;-1.0778518435596889;0.20944836782940601;0.803828296721116;0.20808829371866119;0.77893548570220239;2.1955565932695649;0.50567654622656;1.1184045144637154;-2.2107055686779988;-2.6211715720362894];
  IW1_1 = [-0.78256812951233412 0.31422774985573892 0.1520150725593134 -0.13314310440290675 -0.66646858103033113 -0.11991856280551295 0.15189116691157148 0.34599650430095857;0.26280997491806779 2.6434058733891677 0.36164865335743679 -0.44814526028088564 0.4442526039857505 0.29410863881704297 -0.37138583619671206 -1.0656334472414282;0.55824009220317072 -0.65377803716159655 -0.8905177672459359 -0.35444394889015407 1.7768958767326095 1.7922281842862888 -0.82604567439274679 1.0798509029474994;-0.95058309848614109 1.3896701114388177 0.29469698000357919 -0.01745356466288614 0.43057048178737356 -0.26384446564497577 0.044225797324591601 1.496204130594907;-2.1305830216146209 0.13621589317203028 -0.52327883040782608 0.6420152158280602 -0.11214570509325657 -0.1608876139173219 0.066329694713011339 0.042133765500789719;2.2972120659835427 -0.15957946616161534 -0.40720546339883568 0.17557361740816727 0.074379579143394881 -0.035541664372642653 -0.022641246060474993 -0.72660890142674639;0.5474807205894936 -1.2387138521248602 0.058931172577836047 0.075066290792563162 0.21020628226249652 -0.048495563439416696 0.044740973088597889 0.75773527528614337;-0.20656617764691149 3.5002911940398298 0.51082105603304928 -0.55684452754773461 -0.16675497619083174 0.37327344153142555 -0.30203230523473767 -0.60235651623131081;3.1515939142122904 0.1179566917142247 0.65289587659210258 -0.25859963657198387 -0.49885128067513768 0.51984377585112551 0.18525854479907042 -0.13838972685731185;-0.85946297874357713 -1.7389293902547776 -0.18206322554454049 0.15692698603018629 -1.1013594854211048 0.2115158068902856 0.12584442063993706 0.15720985124500472;2.7748246847784035 -1.0548685805023483 1.0224723422308 -2.1969418316835898 0.36820168431596934 0.31322296539582617 0.0035421463234971244 -0.29314190815513813;-2.2285182012308238 -0.027751668061995086 0.47410680996568594 -0.524376031651829 0.098347412304948353 -0.15807691006043054 -0.21021120703166091 -1.7496756976942942];
  
  % Layer 2
  b2 = [3.6515039421654816;2.8615312939706343;1.5462257173728959;0.57990159075767045;1.1362757533210004;1.3564144591365799;0.2078937888617548;-1.5282971200775519;0.46315317053291227;1.4859305434643177;3.5947093816506897;1.8595165775094114];
  LW2_1 = [-1.0607650579552381 -0.24844494951010243 0.14369247359949264 0.27695658448486177 -0.43796223040705473 0.05664770425195291 -1.4036702513530719 -0.13172972163305621 -2.3175908466518451 0.3882598784687965 -0.31369771117694301 -0.56400836414814981;1.1316208058280317 0.62106294857074529 -0.92430377189416468 -0.71793090221898792 -0.98357574646923529 -1.3743170156978322 -2.1933880178740872 0.1670439866811475 0.5015308185637346 -0.16610484706512618 -0.63778352709702546 1.3032008453726245;-0.39275247771508581 -0.87029908870206252 0.61673458109323631 0.68502765460127257 -3.1611777927452951 2.0958998553006105 -2.2065857034366045 -0.60848655240679494 0.12980910878829485 0.79709678166665032 -1.0305421171086475 1.0612498777009038;-0.5539872928980325 -1.0311700619429649 -0.82934505479160414 -0.96520605283559657 -3.7433859645893448 -1.2160996745602328 -2.6561654020237428 -1.2666279847861255 0.82078007569575429 0.94793891855144463 -2.4886079396324732 -0.67842892279085776;1.1208515469968183 0.7372884776287032 1.1584018100769846 1.0146278935076054 -2.4937974920456862 1.6743610575782144 2.28533569197509 1.4256306581246356 -0.52756781337811054 0.18217705331205059 -0.73647083076312936 0.31666677938798848;-0.41902269288613886 3.4374622734598859 -1.6148047112878765 -0.83704737938754525 -0.89269522694061787 -1.3164811476920408 -0.50455031879257761 0.74321784991643436 0.19452297200390747 0.62409172892990949 -0.21223254790054868 -1.2297818990489946;0.73455871211397428 2.0270877299613548 0.0031006963700587614 -1.0341286546259512 4.8787963563261973 -0.68668697037970094 5.0499209713333606 -0.0052654077852593703 1.8082244462051813 0.35845942417869242 0.16363310595241845 3.9648185716505302;0.08426068176670011 -0.27111495242638145 0.8285822522240297 -1.2624621285642026 0.61046402563188706 0.93124071434730316 -2.0351643414869436 -1.0498467147877315 -3.5748998530922487 -0.989656349227929 1.1525166055987721 -1.5549456188953961;-0.46733911364388236 -0.11827858656050194 -1.2871339681711074 0.45548960758025231 -1.29054918983481 1.4835528538105622 -0.55100704234312226 0.59982478564329966 0.15467540768250354 -0.99095457702034151 -0.30582748336714016 1.2627974903205323;1.1206630018321322 0.078028820256237766 -1.1112170060872517 0.038052093466803785 -0.2002254600659969 1.4565753018188299 -0.31632391364742307 -1.0435415796726446 0.72585917272290934 -1.3446001965734429 0.53947121209974536 1.218581957750428;2.0455019983709009 5.1466092906526661 0.16501415244521081 -1.1593414998339506 -0.80659908242087019 -2.3956406704661202 0.31634404349600209 -1.2633896034265182 -0.48314885007690722 1.3715212614342576 0.14388209938608648 -2.321944511070019;1.5827290096509345 0.84251650665185951 0.10131742913437938 1.2658119918364299 1.6885200351251322 0.14669513632686859 2.0194246608522692 0.326715650881091 0.87029314701555427 -0.8077838692568361 -0.67266219616156797 -0.1992618503755009];
  
  % Layer 3
  b3 = -1.5579695380965146;
  LW3_2 = [-0.77538897555188235 -0.73995067666231829 -1.7726941878203908 1.0991867820123893 1.1876362173745092 -1.5573700664688968 0.28348155233516581 0.32414555483430041 2.383056975560478 -1.4911323531928278 2.3680802655325759 0.47769888233495811];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 14.7058823529412;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
