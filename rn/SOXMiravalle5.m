function [Y,Xf,Af] = SOXMiravalle5(X,~,~)
%SOXMIRAVALLE5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:35.
% 
% [Y] = SOXMiravalle5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.0208986415882968;90.9090909090909;0.056980056980057;0.0063552589768033;166.666666666667;45.4545454545455;117.647058823529;29.8507462686567];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.8334524154940461;0.57037740245901769;-1.9982474699943784;-1.4493946400715385;0.7404862094304745;1.0033463300408627;-0.075743824384539055;-0.14372010803691843;3.4310313585470285;-0.35830237026544376;2.3761162621053971;-1.1957610732797406;-0.89063319572847643;2.2797135792664363;2.5036674227055586];
IW1_1 = [-0.94307135496470684 0.95260323423070525 0.22311134615100767 -0.21404823675719431 0.60860390385413377 -0.54944683270400596 0.021158160852287576 0.9795820951663804 0.25975930784359891 -1.4069095867254253;-0.2330996582395507 -3.2172184652246529 2.0625191630942465 -0.0333645836958451 0.57268174084679691 0.15283499732470837 -1.2040551043106293 -0.62152547800463109 0.087514489064750289 0.98899377873962746;3.2222257877911997 1.1906440627530561 -0.96114103093053282 1.83915433527184 -1.6592460504790953 1.5333665459667902 -0.47215368814855707 -0.71085710223015075 -1.1867075922047809 -0.67857921225459106;1.05280602825727 0.21841048187595574 -0.13864471122748251 0.31619426713712845 0.24818488730991975 -0.09779549290531464 1.9531119301666864 -0.7933088860144788 -0.34050833320208129 -0.45420279536578484;0.55364625015788249 0.48241083464837153 -0.74445848258326064 -1.0534932858921224 -1.1200084873111995 0.14394972659927485 -1.3995226733718809 -0.77036635293029287 -0.17901341682647964 1.7645592426138763;-1.6906139242306983 -1.0697597984321716 -0.69123719286543339 0.29939163463466734 0.035176043345177307 0.71365047265213721 1.761848388891452 -0.80087138945898362 -0.60038380598924235 0.48154537696762961;1.729810499050191 -0.16145460445533186 -1.549200731609278 -0.58291881021652037 -1.4372128594262119 0.41127913388770732 -0.0961820008306698 -1.3541029662080581 -0.047167554875511088 0.34828488082864939;-0.3902157649636242 0.64398780214736384 -1.3407295477349643 1.7447446462222789 -0.47358106585243315 0.43779915086633281 -1.9467780224949567 1.8401658499756333 -0.70353740511425122 0.073476563164973044;-5.2240274696808253 0.76878395376967235 -0.44761939756520602 2.0968692607274138 1.4885605308654264 0.32804103626090703 -0.89066751843556313 0.95727712474519411 -0.26263794839185373 0.24125346805663911;-2.8756089884629623 -2.7412601784074186 -0.43482922490390097 2.4138083287450014 -1.6682089899142256 -0.77644612029877758 -0.13821777207574096 0.74190373987245606 0.20398097272834337 -1.0899528092696005;1.1825083825539464 0.24363597385117403 3.347194386986089 0.40911327942419706 2.2353873068533101 -0.41995396502237703 1.1579446834717197 0.89664333118343342 -0.2946651380140422 -0.49487889110512945;-0.40404709405916944 -0.27230596936034351 -1.0219407866651682 0.055258354006498249 1.0321992492273444 -0.63733191228710862 -2.0982152133333658 1.0616615084299421 1.4287486698590415 0.0035150406716213875;3.9009082620867908 -0.13196275423671994 -1.4165533643474175 0.14295053026421811 -0.30138113689908541 -0.3106837584240455 0.030407870202001936 0.49101934660679158 -0.48858697595947559 1.0907520487943652;0.34256017602288286 -0.29739669739209784 -0.2874560095797043 -0.16583740469501401 -0.22954640504077076 -0.74201371241780723 0.0001971626776160057 0.084929732644297332 -0.54080707916869908 -1.4061818649255005;0.26665820424199482 -0.32022097184228754 -0.47818730541231241 -0.63667587754981991 -0.42022116725316672 0.29631298391903138 0.24036374205072106 -0.92066508396223035 -0.72078103544205396 -0.54140633464745125];

% Layer 2
b2 = [1.5276305744794747;-1.5634854508629761;1.7570351544116998;-0.95249645726811361;-1.2761352440084894;1.3388890284761863;0.095505158300718207;0.3369151608323967;-1.1149986442601847;-0.51726963235637402;0.64204949934981959;-0.35271057607237638;-1.5132839685605275;1.7769244575606944;2.1845740883305367];
LW2_1 = [-0.85168110866600411 0.65336752297304057 -0.34896380808614463 -0.07772951724752164 -0.012250025311777581 -0.37507014344409967 -0.66867762041820311 0.56661713296808291 0.65530552790524443 -0.96515028748797416 0.20827557306186142 -0.4134418474136814 -0.29367928906991458 -0.42414214326865279 -0.77246423207815451;0.31977834926920445 0.24570573055593975 0.1937712598139831 0.11596752068732492 0.4167705644752947 -1.1591341408301046 0.15140868743653807 -0.194687813405822 0.83267704277593968 0.38181326308681474 -0.22985757044485897 -0.98181487071007456 1.1676596839144295 -0.49040989484236447 0.3232343561082236;0.38478466265814582 -0.91380024420478789 -1.6867188862383045 0.1765448799406639 0.88338855908212977 0.83752275390287301 1.1886533113547502 -1.3614354860236582 5.6635591589822791 1.7474949667307145 3.2824756916502453 -1.0521214122863527 -2.3119814013783144 0.63408357386207737 0.25174565265186033;0.53543192002087925 0.53163420115862114 -0.8375881615289027 -0.089787812063922057 0.97491633048132442 -0.035541055363929638 -0.5319606614513297 -0.11592726561999521 -0.25127309642746704 0.34937520653919751 0.081955073381962729 -0.03904450110860979 -0.97808503853439932 0.085480561133475144 -0.39310184352833022;-0.017042890327030154 0.75889609658190094 0.78272611596456176 0.27919600464609284 -0.081792435956873258 -0.83489350354651548 -0.50352496897228272 0.66373649081881181 -0.047004105469796872 0.054381488400240575 -0.60271581173770783 0.49557033311943949 0.039633526442538647 -0.037907530576506525 -0.28631060374662221;0.59464118229026697 -0.88654546114642319 -1.6087604125077553 0.030358904081516459 0.63301846849535959 0.94615387308244725 0.97509678629571395 -1.4600674952456356 5.5197032777089508 1.5967792477986635 3.5357692253981003 -1.0646439070261235 -2.2210072847771456 0.52168268139505147 0.36442313138056642;-1.0537712055693478 -0.27135048070864221 -0.60141514922425998 -0.18939725673979166 0.088006058754955097 -0.30754705374979302 -0.59060788218336668 -1.5763478835467115 0.69099466087034578 -0.37514720285563435 -1.1762757777939299 -0.33701738682819765 0.18646178295637442 -0.13911066005589903 0.34238438426303563;0.33814078437181211 0.0071257917876184004 1.095768417006094 0.56953989908810843 -0.34670878656913828 -0.81319840018249789 -0.28832875695357296 1.434536098862925 1.328319200684672 0.4589726353843247 0.22891660250662715 0.070582467346677516 0.3279426604428704 0.36274175842204709 -0.11807981334373388;-0.64926195820503174 0.99210777026867636 1.5336168401836627 -0.012376228832107525 -0.56903520060416013 -0.97875703973657491 -1.8906666481665217 -1.3832550664838941 -0.54939680719143036 -1.445692328812425 0.71150184433360764 1.5531531623555983 1.9362149929549883 -0.57280286851653306 -0.66897236320404074;-0.74233547566764124 0.61703541620793489 0.35179109481808069 -0.11558162313658976 -0.32854181115407916 -0.21076794192255363 -0.52322825973794618 0.8058649826383858 -0.19091808112235803 -0.17643569955860922 0.070718707777201462 0.60238574119812027 -0.40849011431378279 0.054726892069691134 -0.41296241381746224;0.268334924141231 0.2879813755506036 0.15331396994649552 -1.2640640634628315 -0.07428918501928379 -0.017009654293566899 0.5377841657642819 0.32590439097393276 -0.94536543979896803 -0.70146399374273216 0.6967687269671512 0.24395443647729537 0.52594221683068332 0.61653672718247921 0.60468119693750122;-0.33103861622096104 0.37129411679954555 0.16654753475205411 -1.2106074295707872 0.10214429028703353 0.089364206048233141 -0.12018004986596603 0.34649543885004747 -0.01292504168297854 -0.76353382751053944 0.47269670132848357 -0.18448577207494743 1.329876451262888 0.85739024543967435 0.83256073366899253;-0.89653912011829606 0.79848984786127886 1.064717672108672 0.33943890694444889 0.11388195524135691 -1.0749011371521437 -0.90693687974306259 -0.68341866297957499 -0.7404784524740895 -0.88661026453400749 0.64112674090127797 1.2248857275900458 1.39750655057964 -1.2564242456784513 0.36114463030597149;-0.14795193225541273 -0.11603634800226406 -1.2062775279344118 0.10920680544504249 -0.33080906573318986 0.21630098910711074 0.061045585214500271 -0.31400540802152882 -0.13464071179169446 -0.3435868902399426 -0.21689985269180112 -0.29953200076863901 -0.33111542024523938 0.81602313428589068 -0.17981682375304159;0.58017960600905838 0.56897454216341337 -0.32941509525468893 -0.9210879083578758 -0.60650914829327529 0.20351905784798918 2.5212231931296438 1.1649041388525625 -0.78876572198570183 -0.76628728093091936 1.8693028674518668 1.2392163379842092 0.1415197368858748 0.84138146067233544 0.56742844974076978];

% Layer 3
b3 = 0.26276945339915592;
LW3_2 = [0.11335308367548601 0.13150257294099191 2.8939189058449406 -0.048142954100336179 0.22454864361197885 -2.8979526647338893 -0.11062619278655159 -0.087676526408215161 0.91318404380847007 -0.074170810443262625 0.59674338541228567 -0.3408223917212756 -1.0718743167728286 0.57680539653687013 -2.0315180540882256];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
