function [Y,Xf,Af] = O3miravalle13(X,~,~)
%O3MIRAVALLE13 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:43.
% 
% [Y] = O3miravalle13(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.304971027752364;2.48447204968944;0.056980056980057;0.0063552589768033;15.3846153846154];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.9652434363993154;-3.8497388042172918;1.6722156946432838;-0.39649204929496817;-0.82264067496000637;1.6677305757813501;-0.91298284607852553;-0.59819054396798976;1.221383812066515;-3.0569257743157441;1.7798002807718711;1.2604352906131426;1.5749700384437542];
  IW1_1 = [-1.7608242207756135 0.31127241396833399 -0.68953567377364799 -0.47174791669228688 -0.40468986220133263 -0.48350138707763829 -1.5391919939773282;0.27500087795393358 -3.6317270490621358 -0.39731484790849042 -0.64644242296884957 -2.0399235062294716 -0.31382097093739725 0.49208548456595114;-1.9399663578001241 -0.13032499530464142 -0.12503726877785651 0.20673495423873811 -0.77457954496169645 -0.077094511620482559 -0.095454372413778882;-0.21456182228737092 -2.1080989047764311 1.9020946497358091 1.1144508376690816 -2.1484294163998463 -0.57756762266886952 -0.2190327238761236;0.71474665201889775 0.23663084033105139 -1.4872013728555675 0.61317571961358142 0.79901162654171654 -0.66400819446399295 -1.5104464953879018;-0.42419434363121694 -3.2724955937226654 -0.63487953531960628 1.8312481231843809 0.45806230191623254 -0.20403316418891576 -0.089964865221894424;2.3233785905161564 0.1207851941687028 -0.47161795826619973 1.0715225753664259 -0.27756154133295324 -0.054802277729823413 -2.2001075243923718;0.36226434803585544 1.2156595273957991 0.36705387664619971 -1.0514829477405063 -0.071226304037362465 -0.46760697251574707 -0.27019349001425697;0.31274026995060683 -0.47679560038375884 0.33313810683435657 1.0720309936885444 -0.60668031757211205 -0.31468621628057813 0.89119875152611006;0.22141643435924938 -1.8887430601320527 -0.77163012166186462 -1.7781702714649448 0.0063252482083968886 0.36767395710177964 -0.26658877530640834;2.3396934525312014 0.05629658339500325 -0.22657723499451562 0.79258471167685407 -0.13127949194060806 -0.0091358943622737998 0.43337098652462591;1.0301727247952164 1.5626527209054846 -1.6780745460094637 2.5612780991250435 -0.76032586358684062 -0.10437767198852956 -0.48674976256361807;-0.67652413041365389 -0.41363104745860524 0.19279164778171617 -0.12790332389498116 -2.0549281657927541 -0.19477126608403442 0.95273158500969957];
  
  % Layer 2
  b2 = [1.968181840773487;2.4809060726702952;-1.3890724730844612;1.7534383198998149;0.5886227497036951;1.3878573557172398;1.3165795891305749;1.2807338164515916;-2.8196404305127869;1.0663258066900576;-1.6516039077436671;1.4169995803154407;-1.4107792655855556];
  LW2_1 = [-0.029045821838744417 0.19729416599481894 1.4068816667897921 -3.5211722047268075 -2.1998269450128496 -0.040562163811630636 -0.303793621647439 -2.3217745486650685 1.3777968185448524 0.9914426820474167 2.0832682872876909 0.68938098803274939 -0.11996040665451202;-0.01976743176628102 0.92847793337451934 -0.18351835082022114 0.31292997641183967 -0.34790143702400933 1.2278938385331375 0.67217810321327942 -1.2943038197740204 -0.078800329844998726 -2.1040089390504684 0.88994652208737768 0.66022665771760836 0.18146240013986098;0.16599211968570482 0.37371190715998298 -0.3885584457098632 0.23529494425413514 -0.17008334302549089 0.43971362461919505 2.3146837957086861 0.10825984469986004 0.077410830208257397 -0.23760794939643612 -3.7235800647417476 0.22491157642631127 -0.030175033387454399;2.6393818678485168 -0.82328739150281982 -2.6328153471234232 0.28802730973008978 0.46245312548898032 -0.98569459717025054 1.5002413943064037 0.23212831665333658 0.37879163366422697 1.1525726744572808 0.75688168086162166 -1.1203787804767003 0.33707288304137129;1.5014704096544478 -0.84295149315983875 -1.9510359277303819 -0.041066869292704547 0.078922247269960388 -0.90956587907163922 0.48410732448384747 -0.34819138748854167 1.3625182150215278 0.24029905592884659 -1.4435327442247514 -0.45424806312762656 -0.13164846992156046;0.81697424127660201 -0.1881284671276463 -0.072927193696182141 0.6451348564849877 -0.98896086295830476 2.48470447109352 0.47784896835114199 3.3830041267168269 -0.67090636064884213 0.35125874782673044 0.62400046960685795 0.41813892573348765 0.024502082952192042;-0.32295517625048298 -0.21531267630691014 1.40165104604834 0.92798417218575979 -0.39930329647670537 1.317820104052118 0.8886925711115472 0.98318250758982451 -0.37200529367809598 1.1656338975673242 1.47072672313543 1.206201960461186 0.3494255201273716;1.2199965512782633 -0.48672420911352188 2.3758865200986197 -1.2253370386231011 0.24219635793028688 -0.45523004422166496 -0.89676418022878857 -0.69999999823244896 -0.52108898907260692 -0.06854101304256402 0.70142273840898872 -0.25857970888594295 1.3661765557415726;-2.1354403184494446 -1.4840808931628524 1.0203158161826082 1.2049514003745136 0.80049557336598176 1.8663559267135814 -1.8001404541326838 -1.1407228491324668 0.17899527676440591 1.9686449969710251 -1.3682073132212011 1.7971249484905392 -0.79417332866007984;1.9530520219153389 0.05915502688449243 1.7811555313059761 0.74537165924080073 -0.12884300317378505 -0.012725000089412674 -1.8857686298117238 0.37155035769965578 -0.79733684576194541 -0.18965413002107678 0.74634711081238769 -0.7562266628708656 -0.65284552192139322;-1.4078096381170617 1.1743956450686186 -0.30320421679338527 -0.56873438004414578 -0.57607685272927878 1.4876163718244364 -1.5309680853449248 0.078332191180357794 -1.568966753264696 -1.367821646460228 -0.68783140830594469 1.3715090489110613 0.069316086771124941;1.0016859414682642 0.82375892355100477 -0.17934560800517216 0.76304481584626571 -0.91414521305099605 3.4616096369630429 0.21076005892929006 0.92009862297018308 -1.0463229075822966 -2.1259318719446152 1.4693233248490929 1.242219786792609 -0.19385734380518013;-0.31398467260966412 1.3742924334651878 1.5837462184914195 0.11080144839229955 -0.75323424396922545 0.9639654637278513 0.70936907811575811 1.197956051002258 -1.3624565458733302 0.45843649546241833 1.0895314138292074 0.91080287643842195 0.32161475016033197];
  
  % Layer 3
  b3 = -2.6587918329344578;
  LW3_2 = [-0.57222391910984427 3.4933847807694671 -2.7184995713794664 -1.5834423183222481 -0.20037438748398514 2.1405050394554594 -0.52318807296336867 -1.4943401506179597 0.77932378579038786 -0.58261441250038803 -1.275408025262853 -2.392176054900454 -0.16327183080279367];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 15.3846153846154;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
