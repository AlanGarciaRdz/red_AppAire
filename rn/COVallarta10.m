function [Y,Xf,Af] = COVallarta10(X,~,~)
%COVALLARTA10 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:21.
% 
% [Y] = COVallarta10(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206;0.201288244766506;0.281968137600451;0.290275761973875;0.304971027752364;0.100381449508131;0.172786177105832;0.171659085057077];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.0933244215433184;-1.3632078650713335;-1.6469580508078074;-2.2133682238016417;-1.5582076860976053;0.11790412077146747;1.7533558574321781;-4.6228267580545168;4.586477639379031;-1.9921710417731737];
IW1_1 = [2.3667542946581315 -0.38178578956261583 0.54183666441731826 -2.0255840119528101 1.3888428198163485 -1.3995147143339828 -0.20598266213367175 -0.049225909357463148 0.35560602222023369 1.2541486381624862 0.91187798820090871 0.0075620782111477311 -0.86670860782728243 0.071862921882656375 0.61105715287657747;1.5121656392465137 0.5033904269385332 0.039902627522109532 0.58717591100020228 -1.5692625300465943 -0.99802651418117816 -0.17649018094538238 0.76908807133503776 -0.55248423270060898 0.024090740060038071 -0.050973914028031815 -0.1518707143051499 1.7842833914516414 -0.90804447531463872 0.21625351834191886;-2.8593717756235884 -0.13210649239269923 -0.049040766913913403 1.0845103055590424 -4.4182984553012785 0.78144108790665456 1.4717489137976401 -1.3822693117989782 0.31371016167829924 -0.26742818218601833 -0.52174127065796039 0.032761388323089197 -2.1134619351280506 1.1395554430543386 -0.9471535830112694;0.17885207995321373 -2.7642930633913134 0.23592757737304448 0.059888557445198665 0.51776247105585593 1.4191341143950993 0.20640268331076214 -0.55790150160550689 0.14072193094882746 -0.083287794264291892 -0.031519634590402038 -0.0044572294803431941 -0.25001742600967275 -0.091967102981008603 -0.12578830070376465;-3.0279615244547471 0.33310128879417955 -1.5966666802282043 0.3111350653674243 -1.2119428563204562 2.4016154584608671 0.2359390814562215 -0.27621317994091205 0.27243489426334072 1.1372395348702597 -0.42149442691459044 0.011566719222494894 0.47643499821661733 0.50019328303590915 -0.98115114302941642;0.21166759880248459 0.90655826644785908 -0.42274614181461567 0.11419311069481367 0.58172365179264396 0.4915527365827187 -0.15908289536232006 0.59181312347532311 -0.18930276103465041 -0.029427121965793973 -0.06435941819413174 -0.023979388689931595 0.5840905458952409 -0.60899249323667104 0.45895968702337864;0.83603309384253932 -1.8601777394435075 0.22660549703787666 -0.26190177882896282 1.4737216138220641 1.8043409897207305 0.018651109395844957 -0.28300757465053006 0.18955575018591367 -0.4080549989557351 -0.0054896372394070345 -0.053253228495893798 0.17937223092329507 0.11055314597811454 0.61351789543983382;-0.48189326892920609 6.5649666331563674 -0.36753866995411594 -1.1714062992063956 1.9434428955435723 0.97260776406559413 -0.041168566585910477 0.14222890842099964 0.15028709530327547 0.29895240270592516 -0.1674458839845186 0.14019918636771944 -1.7112909429590877 -0.43336916831262234 1.3724482794303554;5.5177365408019288 0.18749924922566541 -0.95270522895461174 0.1986139904394581 -0.11236641390065866 0.62910519140534682 0.26116767914034783 -0.086919469795791668 0.39991892059136297 0.75703617400626844 0.0048196206427362671 -0.9289687568824212 2.1311495813900021 -1.5122390349368722 0.013826405467820206;-0.20985523629091238 2.1122431446250016 0.27221408275219705 0.29359483785646806 0.059836984902297302 1.8670838101112082 0.05031662898895746 -1.0115068865972052 -0.0050956288452722381 0.41645301712216837 0.2801584769420471 -0.54472951253020185 1.8984025272904184 -0.45989434737899859 -0.85995232435712954];

% Layer 2
b2 = [-2.3058242959742334;1.4773085337841156;-4.3963673496525724;1.7654915558105067;-1.1037194029446948;0.35746174181610518;0.20183110459160072;0.80920435344683028;1.7811231018086107;-2.283481302109521];
LW2_1 = [0.3793596509968078 -4.2959255400700265 -1.8216403365306406 0.10561702955827015 0.12367972115224252 1.7025302511140021 2.0623110855800073 1.0209027737529039 1.5781090871412518 0.9606826427960159;-1.5792200970499057 -0.16096864781084766 0.41899256205269669 -3.5054434616130212 2.4942745259991623 0.32982948667993528 2.6854080125053899 -0.13123900769852118 -1.4265262518262367 -0.0091233465658908143;0.29713968848133504 -0.35713726922962424 1.2292105445245953 -0.36047319065790406 -0.3407640141483631 -2.0757201500810756 0.51304765735289126 0.34229326512331798 -0.78290140480844495 -0.11842827111882823;1.1486754864116915 -0.53093356450078999 -0.95005913305455814 2.6916392393801467 -0.52707180025134692 -0.94235711773654984 -1.8462021825339083 0.41955199542528587 0.3182394356413239 0.8853492305060422;0.6499975163490046 -0.64637919445072423 -0.38472074638265302 0.48189787672999229 2.3674228139946916 1.5001459715067917 0.021567087220462633 1.1695911814839888 0.31137985551748737 1.3911862222239684;1.5253510189439548 0.65960171599239026 0.38391212412276071 -1.8894494966727844 -0.28127125998612407 -0.31415040512645459 1.1118952167277121 -0.074997336923465871 0.83682668812373739 -0.24865138711641763;0.15402441717210008 -1.5316625551280163 0.17739804472699477 0.5990964806109037 -0.97105579829076771 0.88228702248452995 1.0733150094405852 -0.55484008865582257 -0.64112541784864996 -1.5900280061646415;1.7223504761857047 0.76526656460061437 -0.97274839019224191 -2.6014416450523958 -0.12446984314034294 0.15375198529365716 1.7496777279126254 -0.30082712262574929 0.71852052182883253 -1.1998325075460872;-0.33125688242016438 -0.74754982468564857 -0.058223757132412117 1.2205305037347149 -0.88208967744745026 -0.3153047969459285 -0.20323364829517915 -0.078702144554212317 0.13296062717268051 0.80576528063465513;-0.57030586276465078 -0.21564027130816163 2.1005162668145965 -2.2973300823433926 1.465569193661916 0.088602998379915768 -0.26207852936150106 -1.1980198192168765 0.59477476412634311 3.1119623068158071];

% Layer 3
b3 = -2.5444942905063694;
LW3_2 = [-1.1726505081535326 1.0116734898599942 -1.6939963748870166 1.4301435997682677 0.65994002637354565 -2.7806826848541295 -0.77885662936289246 2.1589596785289014 1.553861301491575 -0.18445944881347132];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
