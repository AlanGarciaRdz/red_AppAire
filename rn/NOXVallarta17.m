function [Y,Xf,Af] = NOXVallarta17(X,~,~)
%NOXVALLARTA17 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:28.
% 
% [Y] = NOXVallarta17(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.1516978182404063;2.1748168182544254;-6.4756498781792304;-2.45312836694659;1.3856892480806688;-1.8118732784371565;0.87260647436158734;-1.1812911507150445;-3.8072025788030417;1.503348528755815;1.9252093300457775;2.5274505982350828;-2.9157483231769805];
IW1_1 = [0.97575443397059869 0.36402791069742074 0.95214625869690694 -0.99877567851119942 0.57879017607070005 -0.68991466587420491 -1.3167286698790415 1.3597262166605089 0.34998560092322611;-0.36798446019552139 2.5551246502379517 -0.22584461747352794 0.046625741019039886 0.2701244912308407 0.096521888578984277 -0.11210636440318894 0.54678758468560051 0.070687342334725831;8.1826719250362654 -0.25355707086167056 1.2853635867324391 -0.35905397230241998 0.51014742350734743 -0.10103414110338035 0.84383696665962837 0.29695031214390954 0.205558490488191;-0.11950389471714096 6.6307733174446613 0.15160117826457747 1.1335036827325691 0.3047037689335354 -0.76782881322640451 -0.57481972745248766 -0.56259016282235985 -0.21594849550068268;-1.5208632690972128 1.0020443642016283 0.49671538160713741 -0.25761696025682063 0.84218629715400994 -0.011356742605991871 1.3206744345967756 2.623518093105218 0.10442076576862219;0.25579610395273339 -2.4543897988566337 -0.037673099207013352 -0.060224014044551785 0.95378297174823046 -1.2437019154556499 -1.7274069431593482 -0.4209681124500726 0.071234718330975166;-1.57120790132801 -1.2857772048128779 0.25297781093472377 0.099458825661969161 -0.21531370802680008 -0.075723326651694164 0.2016352128060897 0.77551962608432612 -0.13136770881884796;1.1932125645709686 2.3506263733386228 -0.0092527937700350449 -0.20573385608432579 -0.2979282700366484 0.55814889419587488 -1.8971842125357767 -2.4309319561114062 -0.034908177196918272;1.4715797324236002 -1.6246086613071655 0.84028190043766182 -1.0594469090973735 -0.97242173270505594 -0.094421447779791917 -2.6736848719847623 -2.9987861991780203 0.45455916501878851;-1.1280849519405887 0.083845904122848536 -0.2213183358120871 0.090882481570381493 -1.0658274806573933 -0.18439120134156103 0.0484331005363169 1.0316901988045304 0.039700820552292057;0.52412327804786574 -0.40617383821061009 -0.0071845783790930526 -0.52720290873024211 -0.87257908657100691 0.51196256309069321 -0.45672172385497661 1.0409965075214707 0.147919561355285;0.57774951533728813 -0.074545802011815307 -0.27678416490678953 -0.18322973278445401 -1.2129539408207115 0.76227276788754661 -0.30152924175645401 1.610603888308054 0.82200831837595345;-2.2607386934485199 -0.44454274396181237 0.41054306529914525 -0.27026440951149966 0.71750722330494654 -0.9877025966498324 -0.010465369781093081 -0.32578212540779872 0.0057414599273252695];

% Layer 2
b2 = [1.5223463292012138;-0.66962055511013496;-0.33391490405561741;1.4056970871422674;1.4679924048856756;2.6719218861420515;0.67992800478389948;-0.86220247371010017;-3.1507827121608352;-1.1992199030633481;2.0262852614108997;-2.1762161003753664;3.7648246590362175];
LW2_1 = [-0.46711340987384209 -2.0848292345043555 0.81352147153073617 0.12456288986505144 0.17377940507478931 -1.6401511157571891 1.6535774794574432 1.6773315719609931 0.11748366220607556 -0.90504737828636384 0.91804026902073399 1.8662332306524521 1.3815633221763925;-1.3285235105285462 0.91192612841390708 -2.2204961982810336 -0.6318080574930095 0.011443466134636194 0.011552940839178735 0.82866232392076788 -0.39970965765876548 1.1250305311114184 -2.0571683063957864 -0.52490396755750457 0.95478587416989757 2.5416068653697037;-0.25952598821946721 -0.74660862565160035 -0.50803889433064042 1.1829638086860912 0.09309435880810657 0.68662171971037778 -0.88948069188695211 -0.01633867240470117 -0.71024844098349105 0.82687029605779694 1.5377645086870344 -0.99049433443942714 -0.39186743268643692;-0.4315535910486053 -1.0601034684976065 0.7311839117615625 1.0854761978949137 0.45660473439668231 -0.78102909057819669 -2.0411801621466266 -0.89390085720950496 -0.48352933054940167 0.53146822661059379 0.96146843779354607 -0.83283885425451776 -1.3096401962611592;-1.6527207488308675 -2.6881431352122398 -1.4534181588511477 -0.67714146571105061 0.36338724382014143 -1.0311763413478638 -2.4744384609172965 -0.68320855143605685 1.115263563097725 2.0361579917054065 -0.96212268833401882 -0.35517396034399834 -2.1238706859464256;-0.067681964490796137 4.1336069248681442 2.9151264396020897 1.5459572742481742 2.7802457936643323 0.12342312969374863 8.1942357716900283 1.0482474012374101 0.31341289812343509 0.72548193448376985 3.0524907874379577 0.67433423375306178 -2.7358458586144936;-0.47550395670787254 -0.96135717237413354 -0.48520118831389925 1.2533253565311391 0.011561372960042164 0.20434289776950387 -0.87512039864737456 0.033085121451843336 -0.38816284405856949 -0.25660415471972486 1.6486453958054061 -0.33531385779138084 0.44367717753840158;-0.59065766398578967 -0.92612013081138311 0.2553593027362106 -1.063351410089644 0.2146978990852445 0.69196556680891919 0.32877837338183774 0.44335758022201721 -0.76267180881497787 0.64871833542598056 -2.5372563351917137 0.82175926499482055 -0.26195729194483092;0.70922417200393106 1.036871434968343 -3.4096244406314726 -0.97764066845750486 -0.52458209456865201 0.81247339097497906 2.2709872994644837 0.98527807464099892 0.46259205809200282 -0.64240811957104138 -1.9625297789322378 1.2868359492615646 1.4518838121384412;-0.66589575530482303 -0.56077085692031348 0.014397505070914304 -0.93347221868161201 0.05259732771366394 0.86089965676335489 0.013318186686804515 0.08052146276433432 -0.7957306164753698 0.34607614773394002 -1.4019663527473816 0.15979882873365744 -0.32229912522359078;-1.8093306237599065 -1.051557966093472 -1.7390563385091555 -0.37285947788771412 0.4619560993848818 -1.8407930754361748 -2.7546315495389919 -2.1107788366949056 2.9696775723297488 1.8259102432424192 -1.2390392523755578 -0.64551850961680068 -2.2338080246814895;1.236684578892991 -0.89372741635107344 -0.11995500944097448 1.0186354619420626 0.59651532029695054 0.55207446535839311 -0.24127005469421198 0.72965996750731243 -1.067091482122891 3.265057592043568 0.72513699197823578 -1.300937469016777 -2.1560310770587345;0.059737074250847767 0.083086417343106317 3.478320510989227 -0.10197697865790788 -0.25152990539725412 -0.84139291959159934 0.08135684498521803 1.0116598717938505 0.5078311105710247 0.18913005195809834 -0.15817727204322019 0.30962519322843496 -0.25643643154212992];

% Layer 3
b3 = 2.1691446923316251;
LW3_2 = [-0.22497708796109597 0.51710499198134141 -2.1248377755908239 3.4838364128102586 2.136585775363649 -3.6272741835017168 1.7001122435050924 -2.2225352019521041 3.2007518989393415 2.8776677928668977 -1.4715837650202446 0.7522487674757059 0.6446408551324081];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
