function [Y,Xf,Af] = PM10Aguilas20(X,~,~)
%PM10AGUILAS20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:19:52.
% 
% [Y] = PM10Aguilas20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.026029673798346822;0.58244289327948306;1.4909199383286147;2.1585462330089999;1.3760562869514261;2.7209088866957614;6.2737236183987832;-1.9110194596713086;0.83996381320638069;-1.1660898959809876;-1.5591697309962644;1.3006168482841296;-4.510365940441166;-1.8353611759782402];
IW1_1 = [-0.71904193746358047 -0.027241388420534095 -0.11836734990425155 -0.48464243828575287 -0.22679766918566396 -0.35593680748281109 0.71169276242262891 0.35997574715733027 0.70446724696320151;0.21679899615413592 0.12100467529132666 0.31903655187228808 -2.2798860001638719 0.25450922941927268 -0.15099131320368644 0.39350376745135612 0.4501725207880703 1.6898093838526798;-0.62262899119734805 0.39254100640403877 0.16999688056743764 0.17654909027549209 0.48054298709310445 0.53993464040099703 -0.36445826769382983 -0.01794026500608055 -0.26429849469998806;-2.2214909702314549 1.0057682647638753 -0.27056164822382039 -0.33096208249244141 0.012764713408793937 0.55820801998656444 3.9780149179028559 1.1503334527096634 0.4288051841778977;-1.7975129053891712 0.49634651501104726 -0.2878592003730947 1.2234981735264963 1.0755384799202889 0.52937087353174006 0.11991132790201985 0.15280477576491894 0.32386684415666678;-0.30744834989568676 -0.61582667693538695 0.83569731602578523 -1.2068622437483896 0.65436700017859017 1.8727429857460509 -0.55751396493735283 0.43021621573300067 0.41363472470071888;0.701555661608534 0.60813046759227907 0.31819205626199693 4.7419443861141115 0.92746014365481577 0.3502937414846698 0.37177013402025649 -0.022334727387726429 -0.2635786256962645;0.41627008489751793 -0.22452559136508124 -0.51011354041542201 1.0419210015945872 -0.57041707600948066 -1.0086852673935816 -0.23154960519501191 -0.35070084015183373 0.29266840559889967;0.46143022437532583 0.46641694958211294 0.26127877108532077 -0.23052750037488437 0.73462152066593367 0.31500314934795337 0.21726784360926132 -0.06705294151008627 -0.24994171384991676;0.7027278568042552 0.12833680336939304 -0.94429421154636861 2.1096849616185933 0.318697170207626 0.8436015120814131 -1.5882860300421 1.5221717613585113 -0.18006472535883256;1.542050122881764 -1.1649221541933106 -0.053073172180524618 1.7751763551665045 1.4762337135536825 -0.69866126762546454 -1.0910712577605153 -0.48251953038352535 0.55068245726803811;-0.32883320326465448 -2.4444619676094814 0.46115034368258162 -2.7565152583730521 -0.41652638234816597 1.1144486198403944 -1.4139369403304316 0.58437169365812314 -0.61572575320912759;-0.54189087701492611 1.5175817972627268 -3.064905564215763 -0.24409140057390941 0.85614296927535261 -6.1084607190008837 -0.34651676133037823 -2.1481189510029464 -3.2730627761587132;0.46627672817710841 0.58298981706216324 0.012890676908026873 -0.96097751494263361 -1.2419203559808212 -1.0831865906668283 -0.15939129419351614 0.21530549163153834 0.034918285843722016];

% Layer 2
b2 = [0.67481371941681023;-1.5000722109509759;-3.7085159562667407;5.0115628762170861;2.8320094311782817;-0.51343689326932385;0.29717434366893841;-0.22787380293424178;0.31843815183004398;-3.4291380180817703;-0.25438788749535668;-2.2259261882085557;-3.5039812188552077;-0.80072851160130176];
LW2_1 = [3.3288260407563075 0.4910514530063087 -4.3368738692656326 -2.1253417243980333 -2.3591032033442199 -0.34119118536650334 -1.3616560043003336 -0.13426062369579878 5.8296134705424318 -0.032139652463686844 -2.255686542307366 -0.69242800078036981 0.046841807099862548 -1.9923441623596081;0.82563536359328749 2.5162244239040517 -4.4516505363289198 -4.3627854653087965 1.2780992499377863 1.9768101159492353 3.0598371551715169 -0.029206772195631149 0.70953943684041809 -1.3171461274094798 -1.0091550362818646 1.383739826122228 -0.94784029247174995 1.2831173418051933;-0.53106913372458886 1.6773492212283183 0.74595254180869963 -0.43612013824199075 2.062881730988209 -0.65714886199804268 -4.5951871526186707 3.0887534990019874 3.8400467294743774 -0.54656801446139247 2.1328927083050013 0.069230371208435768 -0.46315189107092497 -7.9285338913898951;4.6959407885935507 3.1800664833132277 1.8381099028527212 0.71913489166072009 -1.1105020008341582 -0.086770763215064078 -2.375648731109099 -3.6199012153883467 -3.8351186057998405 2.9158571522916699 -2.2687810687175829 0.1317300136513615 -4.4362729531069354 1.4844656895031336;0.37930594195101286 0.31858650140490896 4.3419137959715783 1.2878747290856434 -1.8210567140750344 1.8710264476469176 4.8578267519325076 5.7425640521167027 -5.1096237340727626 0.66885092250911415 0.64326978619834208 -1.4932223102899147 -0.39876619149544146 -0.14098246880239923;1.3493964969899157 0.60655725980118669 5.8356557495972936 0.052013172651529306 -0.31218140663606986 1.3899459664089098 -1.0910404767550517 -0.80752977335662568 2.7405352433139427 -1.5592328004617531 4.0206796001564342 -6.6472474888861326 2.5133261802092126 3.0211031844783989;-2.9066773501528016 1.7434465999724957 -5.9825349359140043 0.49826813657781005 0.75700898295280417 -1.7606569071538813 -0.15463148265944066 -4.4942880981697195 -2.2994840231541116 0.48524422599381506 -2.0872602330706291 2.6191561724385908 -3.2562861654341533 -2.3377571602019094;0.1862012571188523 1.625520223502249 0.37244841261033146 0.67261816155823273 -0.48384909338575111 -0.48054697819779069 -1.1416538286499469 1.5479396347367129 0.57324796219324126 -1.1744425879053288 0.91619269071849019 -0.043847592629559798 -0.055106520613755018 -1.4208863764332127;-8.2901161806281447 3.2054704885508754 -0.90224882857933475 2.2077174044100181 0.3934459287817087 1.1870898248605475 -1.3457130191843407 1.8163331686730733 -2.5190592619973455 -2.2576257726886038 -2.6827948860920374 1.7207269578038098 -1.4949368202121271 0.87512831143316094;1.9646894829666957 -1.7187155574799375 -0.59165454406402507 0.28252161357084798 -0.91779281258344692 4.6452467123164585 1.2170961396216464 0.075693630802915579 1.8791911198226767 -0.48970323663924797 -2.1850516252803494 -3.6287096376185577 1.7821428907651333 0.69715172441280726;4.3697592576672752 -1.5126697767391315 -1.9058613744658652 0.51645166894299854 3.9186315659820479 -3.7573072611824947 0.95110280070547981 3.9071104160585914 2.3659770347454994 1.3448174092617098 0.71797233210476308 0.49461468037267758 1.1443616301256319 -3.589002555742586;2.5681425419597206 0.18814941262716106 5.3118716563023405 -1.0757885653420054 -1.6922551490825097 -3.5885026822838264 1.9622601771604979 1.6792349569139822 -1.5826914980595534 -5.1359107712879339 3.3646940441462081 2.3765044177429444 -0.53302270924107686 -2.9514891300989166;-0.021988932740522375 -0.79509026856680753 4.5342931524113741 -0.43659067972072407 -1.9094916249669818 -1.1062416443790704 -0.40329088824610188 -1.3900752625465109 1.6585236999934123 0.34284890897789932 -1.0407806972619604 0.26835900589016259 -1.8910235135998199 -1.823528828995685;2.7937124587276876 -0.21478441221208655 6.2801539811637088 -0.61792715079776683 -2.4421361467443679 -0.98898876229702426 -2.3002088393938012 -1.5954471854347347 1.9304189385968771 4.7197685844486994 -1.3914848559415627 0.28624056057489278 -1.3482570695459264 0.64333261113114115];

% Layer 3
b3 = -1.008905178670549;
LW3_2 = [0.08741016166058431 -0.038863585338358403 -0.029983971248316151 0.018738312801315445 0.22741065207791167 0.15823999627323163 0.2216789965087716 -0.25793760302119073 0.038950564165800929 -0.15057372726579196 0.05285887995664898 0.057059464505528602 -0.063929427528037208 -0.097959292913031959];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
