function [Y,Xf,Af] = COSantaFe20(X,~,~)
%COSANTAFE20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:10.
% 
% [Y] = COSantaFe20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;10.752688172043;0.00341273633199099;27.7777777777778;0.00632111251580278;0.294117647058824;0.448430493273543;166.666666666667;95.2380952380952];
x1_step1_ymin = -1;

% Layer 1
b1 = [3.5221777467080089;1.0152423753357187;1.8037051856737045;2.0273866726733436;-1.0413937773033357;-0.36720237606902417;-1.2363701255224964;3.8264699739749193;0.79834851839918619;0.7300775168190442;1.0539490988016353];
IW1_1 = [-1.4603456410942572 0.2121169803086688 -0.45702706494347589 0.58559026929051938 1.9419409521247539 0.61718745040181056 -0.37421741533697617 0.052725758071304918 -0.62410569949175798 -0.23672771805680415 -0.34468945447261373 0.28133309185430411;-0.34318745966173325 9.2384275549636783 -0.53479954018614795 0.52629358091359946 -0.026305422948530947 0.33207782546974468 0.89894814130026857 0.0089309522530272197 0.24105045858520288 -0.28874631069676232 0.2008294606309034 0.060935283415659763;-0.51876336741998996 -1.770429341229784 -0.22247028180942593 0.14527991213730654 -0.18082464821324148 -0.14834793778569477 0.42889065640407004 0.008413786351494576 1.1178814706025126 0.1112174775272564 0.059331434320977226 0.18685281023079112;-1.3911745489176954 -0.83701443073583148 -0.30499837432989813 0.11835848314082451 -0.17600350293069139 0.18683202979199048 1.0777830736058869 0.10081865254538999 0.54143054750180752 -0.14257014262213227 -0.00049094089590555248 0.37603843835366896;0.11722282971417262 -0.57010240375322674 -0.8801871956135513 -0.154449375817721 -0.79881738138499692 -0.18446466938523198 0.54765488223959791 -0.076018991154183008 0.49201699330675419 -0.46622184321377153 0.40086351046745478 0.31083212810991273;-1.5695004372585688 -0.45416693661206042 -0.69347928545283344 -0.0056619718747611542 -0.27750458380961301 -0.44399441232996228 1.045418244330288 -0.16717078434061666 0.9403500427922683 0.304580557634196 0.13050503313226491 -0.00071250175819177579;-0.15458317339652852 -2.8150821365831811 0.47481519275517925 -1.487662752602966 2.5739959387412319 -0.62254748151558226 -1.0547258065112695 -0.18087305213177282 0.40615793277918982 -0.10167284477480168 -0.38354609119095684 0.54494242358328737;2.3381060312896476 -0.24723800596823675 -4.6755458450173668 -2.0466234733136832 0.89496757083632783 -1.6110051637157823 -1.3137520403272298 0.17964628538793273 0.71004139788861875 11.952442738855623 -0.11782853871349612 -0.86372881375695498;-1.2360483999401439 0.017303539879032589 -0.20550780434347521 1.3019914490166198 0.76717896499418847 0.86855791662387716 -0.34500915162576806 0.3796006718430307 0.060467526353072287 0.022170349934412442 -0.072980866713849818 -0.076599646234704916;0.332547481759918 -1.0953211580307947 0.079660115463036654 0.49086729310718669 -0.23622100684548802 0.082000493428767043 -0.49840047217658068 0.11074631188169336 0.050952833250832184 -0.26281752958801924 0.24406755096165428 0.10997966557878931;0.83796165134869627 -0.67494446861367918 -0.22032110097735108 1.2430715017164329 0.028092618733025383 0.44474713884724432 -1.1277539129302565 0.28053256347149313 -0.025647826362439206 -0.6289936630733427 0.34286744939028735 0.1779206431367405];

% Layer 2
b2 = [-0.90250005950911305;-5.3997444212245718;2.8996977664200285;-6.680902502686191;-3.1072099001249089;0.73636158820726594;3.0763880644051014;2.1848113289469775;-0.71836664945938922;0.52560295349941955;0.71085576391250838];
LW2_1 = [-1.351783180673789 -0.3649382891261278 -0.83628284015268017 1.7278968541227182 -0.99340383678352107 -0.4419853007045666 -0.86872065406052246 0.58644232708887101 0.6571140647322905 0.42849619810482475 -0.16788749191544269;2.7737874145325834 -2.5485206393198228 0.99295460368941513 -1.2608075438910473 1.830218233892051 -0.89746109714762023 0.82332464260627047 -0.086590704961697601 0.35894540967677213 -2.2916353581775546 1.6690109732534359;-2.0469136344919101 -0.42875422914696465 -1.805423115981017 -0.30047491064547505 0.94648809818451796 -0.39905693681402321 0.82980992030943435 -0.14219298783603113 2.169554339094125 6.8443522374069339 -4.9579827190678456;6.3428524508746751 -0.58722943329821242 -1.0348670919695442 1.9332101151897303 -0.014283298158813205 -2.3895016406202547 1.3014954771562961 0.73310165873261557 1.0977149107082229 0.9086678754834191 -0.75362155717391088;1.2570393755504898 0.78416831672212228 2.1704802414455853 -2.2865630890305004 1.1956204378436253 -0.42913399308946687 -1.0376989212943775 -0.7065299203542037 0.48820129590862904 -1.2898481464995435 1.1828738189367891;0.96622141734304434 0.71020578260243516 0.89696806863801304 -1.7389512155024736 0.96492395303707545 -1.0604960859560069 1.098005429289876 -0.20978632856352042 2.1562158521966701 5.8117259914735522 -4.994551216469362;-2.0946248061228152 -0.73894847456699031 -2.4013611762555676 2.7803837967718081 -1.523651806013625 0.81937863488674745 0.37802077652055022 0.83659758913529814 -0.50079060828491573 1.6181759921673815 -1.1562504554857997;-0.63357219784472041 -0.26491951048171791 -2.134038478535623 0.51231350809981502 -0.70567572007967549 0.54500416640494309 -0.56610493085734559 0.017532551103134664 -0.18493525548918702 1.0384831544047011 -0.075061849286375076;1.6440979656356252 -0.00026254677216698379 1.4569785293015394 -1.0979480589695074 0.64616395773361579 0.24363714174172491 0.91436319757731466 -0.48502801821540764 -0.4624014128184184 -0.77910161705775838 0.1967358749823333;-0.87897592382229239 -0.97358440135770397 -0.77069172050643908 0.20433033050259122 0.37692179474345244 1.0047040012418225 -0.12611762972686136 -0.26185056633233772 -0.046116329302134294 -0.67530241778388711 0.19358332813814211;-0.97305285177355572 -0.75674720157530173 0.64881375255823726 0.65786828436910572 -0.66895307434838414 0.2684498266232212 -1.3039340889800273 0.63021480465563962 0.74734976039011924 -0.0067430034947171674 0.20910776638655934];

% Layer 3
b3 = 0.31604319242949386;
LW3_2 = [-0.72810383174212445 -0.59608104148050134 -0.68156969376762844 0.20257412154026719 -2.677057331234848 0.70751267577617627 -2.3243407239367246 -2.5524065767741724 -1.2186945033742174 0.79844304099538022 0.5399602452086848];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
