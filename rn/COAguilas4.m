function [Y,Xf,Af] = COAguilas4(X,~,~)
%COAGUILAS4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:17.
% 
% [Y] = COAguilas4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.448430493273543;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125;0.281968137600451;0.304971027752364];
x1_step1_ymin = -1;

% Layer 1
b1 = [-0.29742721334268912;2.3699265482740826;-1.7970112381117549;2.150625723590438;-1.3889722781989411;1.4604264994207128;-1.1534341093317966;-0.9872570465776791;-2.1953568574445477;0.4933204169716523;0.70085305121720409;-2.3215452391980675;-1.4625005476921555;-2.4933674668836496;2.0393366228889147];
IW1_1 = [2.0968647748575076 -1.2794010196611563 1.3204073140578987 -1.0643644502830842 0.41242736738614921 0.40767804622708609 0.50534213394221517 -0.62510506727085391 0.33727497806854728 -0.80907940036204296 0.82547519530987146 0.3279829068900274;-0.28362592357825261 0.16876700295011676 1.9342047865656753 -0.34051449367319309 -0.20803877685697691 -0.13103502106497156 0.34314536963580911 -0.076432792837475852 0.0065403184745717142 0.26063917175537249 -0.17845576789350373 0.21384540023603835;0.52087801834712288 -1.0177234087519273 1.4728855479493983 -0.2106266197717479 1.732261379875673 -0.61885089145798822 0.59223718547517745 0.63569774759058595 -0.70749671803464265 0.68705535148959884 -1.0212548395998786 0.62290727819568925;-0.27991820181399479 -1.0816632858541133 0.31582580897181567 1.5417598309291585 0.36063393018639323 0.2440870381742585 -0.38289951752405282 0.57497545321130483 0.004699063957225063 -0.85893103885252819 -0.063089233634826644 0.54050612602357839;-0.10635607707260586 -4.2400444560277828 0.059050035223639538 0.96674448915954336 -0.026410191917067553 0.021900124171100259 0.1595410539671353 0.52448578880986163 0.21412694600861601 -0.23660183516636699 -0.19131514585642914 0.11336557475428435;-0.44859765640312865 0.89458769654124348 1.7725144844313299 1.0424583752729695 0.20523188413566962 -1.0209862220084374 -0.061556526015661188 1.697746032525123 -0.017108601064339951 -0.22992038067443238 -1.7159893230005978 -0.17617914079726904;0.13914143962635961 3.358838046697505 -0.30802415707785358 0.97688891225005658 0.092342192891789784 -0.12243757790088711 0.051427616038707553 -0.00819251552955951 -0.041424507559698454 -0.12213941070702226 0.064626367086692088 -0.15484516630449124;0.88177056085903727 2.3840305606203764 0.064900375872429306 -0.84870102788734603 -0.19505810075656155 1.382066633655112 -1.0588113441025888 -0.7210373800874339 0.18699251586736815 0.18507116344367286 1.2622589913203652 -0.17133044445956874;-0.018241164039464405 -4.7495409462269507 0.55274975333704468 0.15474679091283883 -0.031689054532341096 0.092473869816330198 0.21627496768555135 0.34927862569615031 0.16164985111150304 0.00084219388828911737 -0.073785076614526476 0.23011220400986418;-1.4155895297436476 -0.14286551584189566 -0.48124236430427098 0.76984360759896786 1.3399285411712607 -0.82142195192471978 0.64551998483849315 -0.22185398881359791 -0.47148659808994742 -0.30579144781876905 -0.33059597894604198 -0.31466248391204243;3.209154785729488 0.38066215711917994 0.51885094328494419 -0.24439731917510138 0.16269716463780309 0.7270253755393582 -1.3089589441685543 0.23235342796209774 0.40325622534141803 -0.18478106110760179 0.4069181882770741 -0.27992562518526326;-0.11373342557270542 -0.98965506033400974 -0.61097542698848706 -1.1301541904501171 1.2798888715880326 -0.99980172023926472 -0.73091059562377125 -0.24811591478247469 -0.34114735679983105 -0.06784231093582202 -0.30248218608986432 -0.10773588723360243;-0.18650381987653211 0.40769829818435138 -0.18981291828131155 -1.1842647015397303 -0.52197670705921762 0.015136574804492209 0.061195690035561731 0.6037868410413243 0.24719774588024995 0.31916366238325067 1.1813117456436291 0.19352617867204006;-0.22440045738965614 0.64366670348676436 -1.5500394087166771 0.83386457535673131 -0.1410406490286116 2.0753152056006683 0.38588576894012788 -1.9049883286760627 -0.34037258242287699 -0.57779012794480966 0.0096680228649189022 0.7284579922345662;1.4318305440827162 0.21528457054719119 0.88154508127077835 -0.55942962580322098 -0.40850399008922522 0.05086378388690381 -0.080084391168894709 -0.78126208051135737 -0.052435658515263078 -0.17013805504163818 -0.63588930673559829 -0.17027388556399325];

% Layer 2
b2 = [-0.56481873150094697;-2.0835557244692553;1.3153703099257921;0.47778125232246615;-0.9086951997098397;-1.7474500714452788;-0.094057480141570865;0.11151595477390673;0.22004863188804683;0.63297788157191581;0.91251038762733716;1.2197451930248056;-0.13935659047438087;-2.2189094128156537;1.3071903464575954];
LW2_1 = [-0.11347271352673996 -1.5218714204187471 -1.1855551187908724 0.40917799117893977 -0.30484465596944704 0.059106006682011394 -0.48639682104647675 0.25804555183862216 0.90408217301140836 1.0726440551713725 0.22865000451470116 -0.054669294752164879 0.49613875682857367 0.39291364094719172 0.43131936578184427;0.65203149496623225 -0.29016065411357606 0.88005043768340285 -0.12661232056292049 -1.4902015187830668 0.32258959834790024 2.3035656414766312 -1.9842541193964975 1.1526273315959257 -1.5328515256897157 0.94632893446744382 1.0426482737012015 -0.90309756486921478 -0.35711041754041506 -1.2337324732193906;-0.3749992327340213 0.53008362154882505 -0.5510953798545245 -0.47013170562468948 0.35285416499569011 -1.0187038171165259 0.14283220269238259 1.8199541498466314 -0.37678362215349043 -0.47039035055626066 -0.14137087639850418 0.21981127873401779 -0.18057685827099834 -0.74124083064023127 0.64533814886819207;-0.7524815025738999 0.24409319000167795 0.021690470460029417 -0.21289332674133071 -0.37488337209385059 -0.50019447698863018 0.79322358043383168 0.23664501866321777 0.52752032188772391 0.62252899318474031 -0.25596054445312777 -0.65542500224631806 0.51302449096810643 0.40972569229649458 0.65309617590295233;0.60717246751069176 -0.37864590304344342 0.12643227438597754 0.27681634268017696 0.55776184810759688 0.61189358699429164 -1.2410522050066231 -0.098803892739183968 -0.48841161629846574 -0.0057946840279634176 0.2948045512454136 0.32220579660908549 -0.11651268142630369 -0.31259468027113568 0.13820402355488481;0.38457360206301999 -0.35483211904587264 1.2176430623333014 0.43693080537603013 0.33339113782467272 2.5757436427418612 0.62521215983021716 -0.29430487511426118 -0.50170069477115598 -0.11139525944859402 0.35015712758462042 -1.0902130868530979 -0.25527527868584626 -0.042496502210520024 -1.9470829642245711;0.43032701715050559 0.35848493261777309 0.68424997182881275 0.23213762062660592 0.70310910041495633 0.20063622712397811 0.51847059761840952 0.19783270089462254 -0.51354700692191235 -1.0656601371658372 0.15311882106352556 1.3156838320221389 0.58003527158181034 0.58167003111623261 -0.34853103167966154;-1.4297461645560003 -0.20949393503470803 0.016327317700047972 -0.11760996889923091 -0.58614905773956549 0.8819694729757781 -0.34061155799632936 0.32799469718171892 -0.17222762573873318 -0.041111461945090647 1.366170088589945 -0.47963479793832009 -0.32290671791165987 0.57393914788854172 0.40868238785033778;-1.4259403815020502 -0.4391472318342638 -0.28920406728927595 -0.28767483426495066 -1.0374091752626575 0.85183667471225732 -0.62216557692433061 0.51290996449924253 0.44517337105446264 0.12573389782137245 1.4977554341208017 -0.35130303410025937 -0.1873129399068989 1.0917342024265766 0.78152487456851294;-0.31080766528908527 -1.69794315359813 -1.2637522354430686 0.21787405328368614 -1.5505563905179087 -0.11806735121952083 -0.046170287826050899 -0.13962658684318688 1.6357605111578042 0.56670548994103953 0.035339729341003975 0.077684167855792491 -0.16495663283666834 0.42385966078839826 -0.034776629309317103;0.29804414518739403 0.13632462182778959 -0.75550001258592991 -0.24546928765098805 -0.14798120682696056 -0.40903616842682411 -0.027839955285963211 0.65140971344195164 -1.340346704620752 -0.55248390279864856 0.2003705365365234 0.23264350572494394 -1.053599019054924 -0.2210354886398643 1.0380579298767849;0.60777065926182483 1.9334237515687522 -1.4354697971836128 -0.83425768110687515 -0.83192044260689224 0.31444608505304456 -0.45954655213934359 0.62340707326339151 1.1648510595339845 1.1642191020605692 0.53640216047761424 -0.66844642085417283 -0.54896929274585815 1.0619902636212655 0.12229691405904272;-0.46390641863845511 -1.788922422947651 -1.1227612001051341 0.42559485510988065 -1.206265023866484 -0.24421897971441148 0.085274778971064794 -0.064043392968681737 1.3139503995667898 0.57428552819211443 0.032527674059359989 0.48309433878895702 -0.11007434917087007 0.55561855179632746 1.4845218124796604;-0.15296945147982755 -0.62013481920631019 1.3074958708787414 0.16034021219139921 -2.8124494562494351 0.61816088084701037 -1.4452473717309904 0.15687682230499833 0.48125306957468805 0.9792260387228866 -0.12500721318715913 -0.77158886772040436 0.21290243417078034 -0.82800260915887725 -0.86489150617664257;-0.41874151567245693 -0.76168765826597551 -0.48293409109734187 0.18398407785052057 0.17740349128300839 -0.65700393023956194 0.36253915648361562 0.3693437660954636 -0.13099615981989171 -0.67422426330889729 -0.13402792808184932 0.9107178590535786 -0.15561561802833335 -0.54982231020065742 -0.14645107225019763];

% Layer 3
b3 = -0.14784019940270482;
LW3_2 = [0.83905155995621084 2.633317120943905 0.62798634993049829 -1.5556416560628878 -1.6865535998766168 -0.83121684779740779 -1.6000790755632039 1.7572617605216394 -1.8407849717041838 -2.3689281284688688 -1.0311890571741027 1.460505821343475 1.7613592743944282 0.3613129574159043 -0.75504645007319959];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
