function [Y,Xf,Af] = PM10Aguilas3(X,~,~)
%PM10AGUILAS3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:19:47.
% 
% [Y] = PM10Aguilas3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.36107494472115031;2.7770482426209533;0.33241667740639474;2.6101662174367499;-1.8978514535769599;-0.39000062298828886;-0.92638540626627841;-0.90403396188570895;4.1443569871048744;0.12962940321137006;-3.2095225950218009];
IW1_1 = [-0.024217847641611261 0.57161268462463721 -0.34899470956619993 0.69671339519143982 0.15198616825186129 0.54926632443965151 -0.13900923961758177 -0.13379154892280301 -0.19994296041061699;-1.2237146856330945 -0.24021540048737389 -0.60543551316033939 -0.99900929713570641 1.7962469335793789 0.084123997291573493 -2.1355177607700639 -0.51567538241181898 -0.099744624980507429;-1.328430030254798 0.2468281120839235 0.018068377397700792 -0.48376095303662764 -0.2807945750229654 -0.5017988827010974 0.51677675725462613 0.15653471215563941 0.093055730438875009;0.70586853660006699 0.38489944658098385 0.48868085513715992 4.176611092159682 -0.2462378741675284 -0.77741288355541116 -0.63581823821499339 0.16916445434345947 0.22273049047738899;-0.039180935226804159 -0.012821268457445219 0.27142216707014788 -1.4711136126677626 -0.035527743070885826 -0.48345077303893069 0.15223025444600308 0.071956014629732792 0.17458393643788842;0.23793696679730234 3.2025950498747622 -0.30194111460339651 -0.59267096706082678 0.1953665396973277 -0.25843647338049258 0.44448559641431129 -0.054922000356861789 0.05148474631636487;-0.026447656811804613 0.20306621787494289 -0.052611046553026078 -1.5002491741678794 -0.020838269794293318 0.019060112732781222 0.044377796573179931 -0.022310495030313612 -0.0022479312844086805;0.020828802658955359 -0.55645532642903606 -0.06198346080244841 -0.65016387570535905 -0.0073193110190134924 0.43321661255243343 -0.14777957467862526 0.01006664914892407 -0.026389914259742481;-0.90291283068299588 -2.0925196430295641 0.77464598735840906 4.3594668168863668 -0.94718769899100874 1.7648318214298497 0.4867855420557462 0.70218688066473489 0.1694768896882031;-1.0924923632065513 0.90435783004646364 0.0067183969920511745 -0.7628040110064922 -0.45760394510936353 -0.12718429824978178 0.16601880619846363 0.11518790574032046 -0.10125426873481813;-1.0738353928030688 -3.4504762891526624 0.41145692107680482 -1.5756015649864543 -0.20966796962049664 0.075148233966052511 0.48964444792783213 0.074594257474821943 0.10348342607109075];

% Layer 2
b2 = [-29.374881086498842;2.3186984361618235;5.8613904280871161;-2.1444772917795558;4.1581110929107803;-13.059396131577653;-3.5702437321579215;4.0339510401259915;-1.1293870305546103;-4.3792786609653858;-1.3409513671909465];
LW2_1 = [-15.709403755713438 -0.36033298566757299 -60.352011607389677 -20.599517288111453 -22.121347845517096 -6.3856008661601456 -11.34576363929043 6.6102002348439157 8.8820896988479614 47.073653141773001 -47.174386838372506;-3.4535725841792853 -0.78479471529036371 -0.50791952206633306 -3.660804250064674 -5.7361914290793656 2.123636748969286 -16.319484408255256 1.7816125825145817 0.58750678588444805 2.6503220023229761 -1.3342334649695096;-2.3182423540081669 1.5596573441546131 -3.6464167154299827 -0.24675997906424707 -1.4148241471322389 -0.14905710486906271 -6.0652242326861376 -5.5810280521604243 2.1825366749408457 -4.4143885911930028 -1.866065668534213;0.94771761048918601 -0.51622264147208063 -3.1422813033847432 0.30916992103990237 0.1366261402717 -2.3544638792639963 0.97113117690592887 -1.0999664934423994 0.29956956719750183 4.9093554756668878 -2.7654349296003757;-5.0792242285035449 -5.2818339728112127 0.69259691011736546 -1.7700264577146905 -5.9298608371986168 1.9733054302303934 -1.6894049815537242 -4.344881048478193 0.88257083938257841 -4.9707460999309188 2.965267161072223;-9.0266625797963016 0.64473018480768318 -5.4288845592853656 -3.3066823573889073 -2.2149791514163844 2.3990853588376377 -11.049042299569201 2.3240175753183641 -1.7974199228015493 4.5939555507123453 -7.4085301580828391;-7.0968767101500436 -3.7740019945927847 -3.5430651539980444 -1.7630288615074536 -4.4037898692072828 1.6685992452277103 -2.6844477593831688 1.2318875368187436 1.0393384705865596 3.3635729141766899 -3.5766830321420562;3.5462582800367053 1.9848048500547131 0.61346593354974144 -4.0049203386143093 3.5885339080395848 2.8272081514037963 -9.3618254309551752 1.4696719867320425 -1.8212410217242938 -2.3887894933212426 -0.31198416581184202;-1.0436531833613323 -0.6801040243298504 -1.5853288401251959 0.66586455833438973 -1.849732468026303 -4.0657232561894476 7.2009704900962515 -2.289562881261987 1.6397598766978403 0.99745867612691652 -0.99907198695093591;-0.80885216207563571 1.905214044502499 1.761590502047623 -1.327467902962596 -2.8817267152415402 0.0034431210328570751 -1.196016094543342 -0.44951096065808827 -1.9748484658367065 -4.3141782888644356 -1.2439302317135019;-0.74969398286113698 -1.7754414759795445 0.13464764500506363 0.30245930457704989 -1.5907483645511002 -0.57030876473828251 1.4504109271896319 -1.420368675782697 0.13697092921863485 -0.26964997641212196 -0.0088051972943221229];

% Layer 3
b3 = 1.6721823018357411;
LW3_2 = [0.0010526255463986973 0.036452351347469429 0.039584039866966667 0.15396177099899588 0.15735564650341685 2.172646175254632 -0.16852184357464303 0.065120666611680408 -0.067959992015755047 -0.074161367028097891 0.7210822053418513];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
