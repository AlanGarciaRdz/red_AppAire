function [Y,Xf,Af] = O3aguilas23(X,~,~)
%O3AGUILAS23 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:34.
% 
% [Y] = O3aguilas23(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.42005420054201;35.0877192982456;0.0561797752808989;0.00588581518540318;11.7647058823529];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-3.4018477666872968;-1.6932592960254833;0.9532223347904285;-0.81012840919810825;1.6937879784481595;1.2648566758628175;-2.1014199980989248;0.84125732578932888;-0.12378050601400332;-2.9865603967115031;1.6295841864162535;-0.28452334543874253;0.30495568329020084;-1.7246473457702167;1.0591321497202542];
  IW1_1 = [0.21391113758358443 -0.46661252856140828 0.34412559681916699 -1.0522282190979135 0.93214489857869054 2.8156512918733139 1.7148188735688987;0.6978968791538801 0.25887868016973958 0.93300101154197623 0.60189921487685816 1.6010846451005136 0.86930223678708662 0.20686568033656808;-0.77811420880949056 -0.43096329802973354 0.42097482624887478 -1.4688581142683581 -0.31774702542620537 -0.64557928159162814 -0.88574866480237613;-0.015401059034268048 1.7679739745545904 -1.10806365640967 0.12660157248078777 -0.17857121572427842 -0.29558542029714902 0.53451759937866672;-1.6247565442563756 -0.25873677789250865 0.82000788171203998 0.12937472650969117 1.2282585325282926 0.39903777893469117 0.43029874264734236;-0.81985792616537911 -0.63278137479782803 -0.56766267136328585 -0.070526524287844977 1.028223214327608 0.013203694076944486 0.96320005963130439;1.9551266583517268 -0.23336951172892381 -0.73545990169855613 -0.066935993213332226 0.70397955281703783 -0.12177274821513862 0.16918962544646493;1.0770805844232016 0.88676776839172433 1.2919038320847471 -0.2187287642562428 -0.43146189146750402 0.053639736941165014 -0.65028468368174064;-2.2223375090616053 0.72607019659694216 -1.3781872134175026 -0.029966976236646944 -0.23189035075723941 -0.52895008843779467 0.087066841469507328;-0.36264201989155448 -0.28272363235772419 -1.3848093866205904 -0.37547621504834133 0.53854998597733217 0.014845364443308601 -1.620098423594575;1.5767367471007223 -0.79194041569248785 0.49309985637011333 0.17533450981359669 -0.26617178972122296 0.11722475842602188 0.74240219384431316;-0.73513613809916911 -2.010190582786433 0.49995801830201414 0.10798683114893676 0.37802395591247029 0.14418586082387641 -0.065328025524166639;0.97602092603627988 1.1388098936149336 -0.23494405812871044 -0.63651484090016774 0.13918891278900297 -0.29048901527671256 -1.1992766690994769;-1.2313840813635692 0.17324802050121332 -0.78435182256417768 1.6388538270339301 0.11160038980510202 0.75455537124524397 0.4135079521433318;1.2314385250724353 -1.0012182187305971 0.32724254536938779 0.44226304302995301 -2.9166792294359021 -0.033206757940573844 1.5601854542702636];
  
  % Layer 2
  b2 = [1.6743550986740419;-1.7381159905865085;0.58506811076602061;1.4965269643746846;-1.3393757042354151;-0.40989343910242249;-0.28138359315240535;-0.048147430965197011;-0.062654430915975015;-0.0527337100086194;-0.0026197574523654926;-0.76227697769263281;-0.8379189264898298;1.6246674771151315;1.8811510546608152];
  LW2_1 = [-0.5854037370226195 -0.42034605681682263 0.27203657680827958 -0.50023610927883966 0.1683414852387356 -0.41320435706647007 -0.23996240344056535 0.40000412664883961 0.68388150319023466 -0.55354779060963355 0.33898649176149948 -0.065166531804114441 0.52084841712680574 -0.025157756155130044 -0.63212630785015078;0.58085333380574888 0.11217268829682768 -0.069180370557819379 -0.033835068438171113 0.098392308914428517 -2.0122838758297612 -1.6683697336337999 -0.58441246744628494 -0.56616852940101225 1.6747349643290745 0.43611562484273719 -0.29046021215147477 -0.45297406429284498 0.19939020836853857 1.5192305390243537;0.27059707895126434 -0.28353236035009277 0.81809408170894748 -0.72088899423157493 0.25287064454495795 0.3879479427995578 -0.07617594669208895 0.86750253673999922 -0.32183154864301933 0.08727936702834449 -0.11496333343310479 0.97876311676379879 -0.82083906154792274 0.27927028531836101 0.49829941860342708;-0.70772055921093635 -0.53831560917992549 0.56859618545970603 -0.43590374146991684 -0.56198174869490181 -1.0589367737480975 -0.075975787860446509 1.1209307875562333 0.028342589029039744 0.2573879347435466 0.58917079722972288 -0.39562113059872733 0.14455965402822829 0.24517100579570555 0.29571651117159647;-0.35737917878278463 1.273556267869234 0.50005131158658533 0.83420412566883351 0.44321857657121772 -0.59260424200092154 -0.80158626845460246 0.034299735141342366 -0.068955657220810207 -0.39326064346628381 -0.10396114789961249 -0.63845937369060823 0.027754931122666658 0.13023561308201687 0.21008437305766969;0.73796523941897718 -0.51286086281034604 -0.061734440609653093 -1.9775099415451911 0.70507456527137014 -1.0157431490356696 2.0015692968191487 -0.60685035316709812 1.1351387079013953 -0.86777320498951005 0.44887604255605695 0.92180346079740416 -0.25462084348149683 0.20046888843559565 -0.71121572916717135;-0.25339075056096816 -0.22476099147663847 -0.23766284969413751 -0.19980977001127287 -0.063281366923103113 -0.47857436211041199 -0.4170677980065724 -0.092339577182867727 0.51063091464000354 0.25480145594842613 -0.19367274378459959 -0.15378360778580666 -0.27914569900079561 -0.21558902769447505 -0.465653797014695;-0.59145145564880608 -0.50171241557000579 -0.23336477998196167 -0.48806908088215095 -0.13345660751114558 -0.41712908768403784 0.52824540360621253 -0.072883128213106441 0.39228065654069766 0.36059606838402358 -0.0041218185311756028 -0.34331056549937761 -0.23318197595825646 -0.19548736567111616 -0.15446625201141509;0.97814108733668448 0.45673421429147265 -0.1722902015526451 -0.71424108771782413 0.55718533921576707 0.47150775433523512 -0.90846677171921153 0.26199406478314213 0.45500498316394739 -0.35002577741842922 -0.12865728405920349 0.49429577503420996 0.08401936642419966 -0.065442311153127833 0.47231131870990323;1.091530460624367 0.38271029932240958 0.65958051315771726 -0.39914042242564174 0.53654154619117034 0.44214096467991615 -0.29854387912415847 -0.041484648398508496 -0.28626782649938431 -1.1958506160782207 -1.10845401668844 -0.61282555788327175 1.0586213528134139 0.61294141169429406 0.48482472193387066;1.2046294349303901 -0.41061509938048324 -0.075393969229978569 0.024697223449976921 0.54691106261096645 0.32321108472203519 0.65207710339048419 0.67497857652618343 0.8090164228844412 -0.28586329410026468 1.0648628806335256 -0.45648717131952471 0.4445344452628649 0.45021639841566996 0.29425438265767745;-0.24756667858554826 0.001969441358643978 -0.61182759220909011 -0.39001987176712782 0.49919004283037915 -0.49975455233280219 -0.94117871045116586 -0.34507915721709664 0.14061562327358293 -0.58284726717817348 -1.2871348323734402 0.3833914464049038 -0.069380169060126423 -1.2704885307626155 0.32407111002446237;-0.44755584713095964 0.5056792344002724 0.16026846558746977 0.11311031059412045 -0.18090785197152215 -0.77651691728052441 0.82782473014751101 -0.74846873058253549 -0.26999055046277193 0.11202662938947609 1.3241931043022932 0.13488300176096807 0.82937198096888343 0.20177819844984116 -0.019265807193210107;0.76827954752021499 0.026138981484638224 -0.57205938688250502 0.0075086765057801944 0.13813083546324556 -1.40354671452258 -0.58552769957971584 -0.82125249140202961 -0.11120185770900601 -0.013201843778455 -1.0145731978893422 -0.12765508385431623 -0.14676156386522055 -0.079852174261476519 0.33637744554979515;0.21826127057726263 -0.29311273883348549 0.26305754861544811 0.47119334823718717 -0.12538364380925493 0.42378904449711341 -0.0065388427757787186 0.51769033456367552 0.41267206506755466 -0.22855992698519098 -0.3434503964162382 -0.30946590370524762 0.31699616326211999 -1.0310241054589964 -0.029215858684574207];
  
  % Layer 3
  b3 = -0.086216366808440845;
  LW3_2 = [0.24878201461347804 1.3817957886825862 -0.67027581137081416 -0.83581602224568663 1.0251280143876396 0.39047555996663957 -1.6860074314721332 2.3448252998241292 0.91193532617591933 0.74770010346179672 -0.83249870301104389 -0.88730843495305611 -1.1246660137345985 -0.69651045903597142 0.80656119413836869];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 11.7647058823529;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
