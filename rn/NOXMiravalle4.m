function [Y,Xf,Af] = NOXMiravalle4(X,~,~)
%NOXMIRAVALLE4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:26.
% 
% [Y] = NOXMiravalle4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;2.48447204968944;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206;5.12820512820513;4.16666666666667];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.0777947614287928;-2.1488826326820121;2.4356366087762082;-2.0110238656150905;-2.8818194824259895;-1.1746978448010081;-1.4154098985650794;2.4850100868651639;-0.14212495551699289;-0.25527021831815311;-2.8987514620199288;3.5922867872358961;-2.4562865034018122;-2.2797335007348103];
IW1_1 = [2.3620171648219128 1.2269078599992496 -0.84122191954257197 1.1581110956494478 -1.0204426511493947 -0.89520624289918382 0.19050627053544775 -0.41060361849336835 1.5042931860009654 -1.2419917324322043;0.55125877922263433 1.7262965565880157 0.44096328067849788 0.41753624314943116 0.32368072269229009 2.9195830888461369 -0.57399890296801814 -0.750802651419061 -0.29653312914392888 0.49470512835781205;-1.8996636044814479 -2.3752420964469247 -1.3197997809949458 -1.7518780005658496 2.1501787443210545 -0.57280208306317837 -0.1387401484614979 2.2659986949606012 -0.56405479013311177 0.85394076450079592;1.7850251713910219 -0.75980834415081056 -0.42052950396633726 -0.18045952551083319 -0.78877588826826095 -0.27286109740863346 -1.1860840069363272 0.23328432847182426 -0.078627754831677693 0.0017286085016326048;0.43576556719665593 -0.89122648150477257 -0.48212485631159596 -2.7644805259942218 -0.45897990796482757 -0.42542969364697714 -0.14731908335804378 -0.14627921896585805 -0.25270290220159286 0.70227222448437132;-0.74643956617921958 2.1613534172505835 -0.75422508111347264 0.79771250196747912 0.89160721273163346 -2.2312961249229812 -0.41610391714914807 -0.0070043410796870806 -0.59080336494887054 -0.61579342939549164;-1.839011148814778 -1.6047978665471225 -0.37385171564994124 -0.093012190013107066 0.11446427997674492 -1.135970266659557 -0.74444344303002996 0.13020811171129953 -0.92466411229626011 -0.41428050909680214;0.6390591329449804 -1.150274853896101 0.92336377209599851 0.18734024516093409 -0.015483696101943906 -1.4673374598930804 -1.1244492719896189 1.113208908398448 -0.64355258865659093 0.13020948445063998;0.33106104667992309 3.5932370935616107 -0.42670591434714733 -2.2225943442867244 -0.42869634209570417 -0.69922017683664217 -0.15443755972974527 -0.13909031501417035 -0.63577077826336104 0.19269371193014442;0.091638740680470523 -3.1540625737617924 0.082271252064359007 -0.066738678289961578 -0.15306035059774226 -0.077625393840065518 0.024170277515194925 0.071888769267740391 -0.081737361464241085 0.043708663993372525;-0.18113524010211779 0.79850105030116747 0.81312675823875902 0.52438380289261355 -1.3892049717214983 1.4611910234832906 -0.32223267777722803 -0.098049182103689903 -0.43930443789366491 -1.5519609717123721;-0.3164187245581665 -0.22847680852574223 0.76629399151565747 1.3929788718813729 0.32028610217014053 0.818858495072181 0.17551069497797506 -0.030165168229566486 1.160905350000548 0.019200705374355802;-0.86867556065761453 -0.11057534203722337 -0.61323569163068892 0.3464144839867232 -0.48338498978114691 -0.40471527537499519 0.45540161347931329 -0.13033733983883156 0.78065714103690353 -0.030963260356966019;-0.61165384929526256 1.1349454865943143 0.4538088433525751 0.52546509514499307 0.53291025190401209 -0.18294192163011744 -0.74478705806159784 0.38910777633893256 0.43652188109186324 0.016763191149741466];

% Layer 2
b2 = [4.8062452764830521;1.382085759037555;-1.9157839785060953;0.34781202734497768;1.9846520520799746;-2.3928973559805193;0.59763681183519879;0.56806472657287388;-0.20034720728197475;-1.9478948584729645;-0.95121217138314695;1.4118683074640712;2.1320274924515217;2.0154260180047214];
LW2_1 = [-0.5286835097265965 0.98331628478030919 0.019168336631372501 1.0770373224912473 -2.8484219398549659 -0.39899865204360452 -0.74910088440692213 0.56262690888866906 -2.6182740168598726 5.5559930618714581 -0.83495820123937559 -2.3299960430198903 -2.5611392524590086 -3.0677592134064011;0.85991625517994563 3.0738360728300376 -0.9387434293977357 -0.4415760382325799 0.86331447768533964 -1.3167315555874575 0.96004214730239035 0.45287840565315829 -1.521588686456365 0.45164761612616527 -0.85939647575932343 -0.16910436359032294 0.055844210114371858 0.37530835598666695;0.49169812574367139 0.71493547392778489 1.3303710957110717 -1.1560713101882836 -0.073063284992391231 -0.22469521029693362 -0.275525247775672 0.024617406717499901 0.37774800936044034 0.75948113191132294 -1.2562393418985631 -1.1139758819464562 1.1854528319397271 1.4845390581414657;0.8166468249565062 0.87500032874182798 1.1078519973872332 -0.34699353737301725 -0.10062085907809103 0.70788585692382977 -0.35381594906997788 -0.4889887097104082 2.1728482328815995 0.27542970917401022 -0.7249929325450255 0.61929232834142089 0.96782165575508405 0.72519658034743306;0.3832675661750467 -1.1954191748861329 0.96856066257108309 -2.7698053896948243 -2.4261591000335097 1.0121686202936937 -2.4686694312375841 0.050419717509102013 -1.9060459496973765 1.7910304324307273 -1.5649174885558517 -2.6095585760762141 -1.1234568437426142 -0.74580987368353791;0.43344589294893182 -0.22741395360254429 -2.2404341584407113 0.10856034094475508 -0.22001861126478117 0.19017521824858005 0.23280386705406819 -0.17559119929894551 1.2083819783086303 9.2452621617600421 0.99380677005809359 1.5412211022345899 2.9675759920096842 2.2177433120115451;0.95413425649364791 -0.1358800966340574 0.69291536394814324 -0.68342682083870532 1.836808731104377 -0.26433220908880761 -0.60082203597821315 0.93201179909274123 -1.7900939347385039 -0.77813857006933917 -0.54272240789156245 0.63064583670427687 0.64627662245884387 -1.0625302183517182;0.28349438145015882 -0.64004947958871328 -0.92363831032195032 0.11401217819089376 -0.43256278099384265 -0.4054132755402422 0.1476219672179023 0.10153444637998811 -1.2796020748557371 1.0114500817592538 1.5494799118056541 1.3631999750335395 0.34131169826672364 0.045883255323235415;0.43921498190851682 0.48649116631026179 1.9208578864787127 1.1500587507291486 -0.36805944606001323 1.4683497259060525 0.21507856880957896 -1.5281663573718718 1.3164717489577475 -0.19954741816864252 -1.3268980724896227 2.4443034366901046 -0.2040025242301631 0.63723818945981259;0.23242424899245034 1.5547273381133555 -0.72132732639184993 0.11785076751713329 0.48886172735922701 -1.3243490920770522 -0.63490807896584345 1.7881656849047323 0.037644796170974937 -1.241271008380687 0.2417520434555927 0.3119672931699049 2.0486964539533146 1.144953075428407;-1.0938046289680365 -1.8116763746053599 -0.47988576812180056 0.58640516080238492 -0.32913584847280941 -0.87065775331576567 0.58497087988192842 0.39111801422211373 -0.94879745428488815 0.15232867411306747 0.78465145689557025 -0.78265750694255898 0.37742927570540141 -0.15271931102834413;0.92684660730196877 -0.47060143737018961 1.0505686494106934 -1.0840091593586223 -0.94475145281619211 0.1153572833790818 -0.52924146868763444 0.17212774669564659 0.31077970332891569 1.5394683565946001 0.77062563505568393 -1.0904380838918875 -0.67977980773105617 -0.25572104178843913;0.23370946736656245 -0.88349088142667775 1.2116776938762972 -0.092209536022515776 1.2457470913380273 1.5284272206107539 -0.57288713504199651 -0.29092570048786959 0.55387179920549223 3.5754311684614133 0.42481842938580416 0.6846896381574844 -1.8815442101602997 -0.57322333628249977;0.44069527876946407 -1.0529349426746577 1.4227911968574765 0.99293445444403705 0.62359107489845911 1.2649492234433768 -0.55136642636596656 0.01685145506969938 -0.25916223949737438 -0.49637028544728851 0.37292911460669587 0.30510066691083038 0.084372537144326451 -0.70581832615217288];

% Layer 3
b3 = 2.1062686700214437;
LW3_2 = [-2.6783958459551553 -0.39311615882579365 -2.4846273392685205 0.75522499608509341 -1.3415729775156409 3.4290840772198647 0.10537269317162015 0.40106999465962156 -0.34061275673504054 -2.7156687147647967 0.34550629941412864 -0.839371329161121 -1.7357917422182447 1.7372275135721107];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
