function [Y,Xf,Af] = O3miravalle3(X,~,~)
%O3MIRAVALLE3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:42.
% 
% [Y] = O3miravalle3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.304971027752364;2.48447204968944;0.056980056980057;0.0063552589768033;15.3846153846154];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.8971148365044439;0.52790176445626047;-1.7431403653102522;-1.1927955643550388;2.0426266198491465;-1.2852092807477113;0.40588238510805313;0.86613528519182292;0.16430985553470864;1.1302084606826894;0.40990741627032296;0.5267303303675771;-0.8401587694174304;0.92581229971745471;1.6315216705310422];
  IW1_1 = [1.4318557783681849 1.4118329093965269 0.73473259679884284 0.69564625918173018 -1.1241742585604562 0.61814645736907914 0.4281622455081775;0.37573776445465829 -1.3568167178052395 0.71273591823554627 -1.0539574358967552 -0.0018321370412374902 -0.015487293402764618 0.51206978358156563;-0.0052460407319170864 -0.14859034524092513 0.97213617029908428 -2.168663593476075 -1.5177379751436397 -0.43643637849646127 3.0092159061667192;2.023039626290339 -2.4305081690436077 0.04190868740071315 1.9250004146021358 0.91897245563419261 0.010317387094306581 0.70769101634695153;0.65678705119357084 -0.71458632398977828 -0.14557074251723018 1.5891287365605034 -0.16637344239397231 0.17782478018935144 1.0575260743738417;1.1808385796444241 -1.6087247548584751 -0.23459875725328003 -0.78773163391932577 0.69578753028860252 -0.46036993631194095 -1.4492219703980354;-1.9874990849192764 0.13302605969805331 -0.15617682846102113 -0.77516683973869405 0.92276214060828676 0.13719474142729352 1.0157738534033631;-1.4635142381435442 -0.89261907914549721 -1.323090616811839 0.50531170007231319 -0.26568221462208985 -0.20293553995857955 -0.87511495764083613;-1.6071626027051316 2.0667831658790514 0.65492851762283666 -0.030251590418471003 -0.29504412906977723 -0.29795034162949757 -0.83593780614989199;2.17480687479196 -0.009615420033469305 -0.027951414350767527 0.1657050536094937 0.01095585628478107 -0.023511548167701055 0.74364094463191188;-0.73894414258785324 0.68483493135214346 -0.099793498333381928 -0.079282413550785386 0.014569590428064721 0.043922406605172125 1.1909461638373857;0.024603770209949458 0.86592641947983739 -0.061530503126989641 -0.04601310174500986 0.14589477643175797 -0.086104419381961061 0.80048900339897089;2.0511273997267576 0.23302579024429171 -0.10708257812561452 -0.35507409505889148 1.2896495218101933 0.067705078642048749 -1.3202764035717545;1.0061606237235674 -0.80200154900987053 0.24994055089415498 -1.2992151793011188 0.24602812459623766 0.64109089120518126 -0.15727206594053755;1.3841299692761568 0.58945297628318805 0.18594344244920774 -1.6095052035008435 -3.3415419352816276 0.19392151117533138 -1.3773875026200693];
  
  % Layer 2
  b2 = [1.9173203853288754;0.95073157192688107;-1.4104637954319457;1.2399692201505714;-1.6399815977667576;1.2801853689509461;-0.19366952518233532;-1.448279586005794;-0.41404556249482632;-0.41734482243603221;0.42266112160978297;-0.91512827305574374;-1.2955043051481714;-1.7669821706524962;1.8587406932067077];
  LW2_1 = [-0.048942939904215055 0.1790665380258448 0.71409184725207664 0.44611157103736854 -0.35931310551094253 -0.073515465905119509 0.61728159142491357 -0.25845065560030139 0.51009765620385406 2.1038950120075128 0.26210235393781667 -0.80746293790194079 -0.90511803489616527 0.058009367913030248 -0.32473822455834217;-0.37341026523793514 -0.11627192805961957 0.56273420226484128 -1.3066748805476169 1.1663804661484323 0.47688077555444452 0.83695239452621983 0.28070582150876383 1.3554578146728951 -0.32726360930032977 1.0853156102977759 -2.0500712838967492 -0.42873515095702741 -1.2485917858523894 -1.2291307398354434;0.67088580749363091 0.075553332338956933 0.38847445400479169 0.08519318337006751 0.45800573341682949 -0.20129204105348317 -0.16683588306751368 0.20753968570886308 -0.014460042067222959 -0.36106413821288502 -0.49447797424161144 0.094667555270010292 -0.69014417785851978 -0.53258865099104713 0.36036095592360734;-0.6867853552622788 1.1388597424796774 -0.069120973724722465 -0.32308783650213924 0.41381962333383199 -0.16032680932888915 -0.8004467640664471 -0.35959654941505192 0.10009065777038749 -2.0811497556024547 -0.49210908150829985 -0.0736303093618869 0.25861383854967518 0.40802134726505823 0.94557010333875502;1.0081418971014102 -0.4168106119025019 0.47623882008496032 -2.2988590357284613 -0.23412319982171123 0.51911687306282317 -0.14879049632201907 0.50180866420907722 -0.75407973188711985 -1.4885733368956777 1.3844993917862964 -0.32765603033957591 0.6813797398950211 0.65568609014444112 -0.84438844504343735;-0.89256253367561977 -0.23713846138440989 -1.0059066110401025 -0.3184770250285151 -1.6622044159846028 0.5373279620413336 -0.99946936375522843 0.30965263561289247 0.73427742865090484 -0.0047311832751178728 0.8623884952383597 -0.43347460642093627 1.1384690926342678 0.51635032107619805 -0.22783941708027561;0.41559672650643209 -0.98811391068717469 0.29698699161250841 0.30156638935214131 -0.52881685408003132 -0.42922923536381952 0.13305979862806636 0.85830545506453881 0.86224846091776053 -0.067017708808592411 0.19650384124154124 0.81007074949892532 0.072630495287002245 -0.1935062655681917 0.16445484910471611;0.26290400770949429 0.68670984581620809 0.46764540764245238 -0.4737166683338076 0.42433372268738667 -0.081976850657663691 0.46629201731171582 0.23631436949497764 0.50110832375614778 0.14514918770504287 -0.68513652371038647 0.4379497329861588 -1.1551002106957533 -0.62249344239980253 0.57799640382718209;0.21136238599963553 -0.42919633679616903 -0.74477781069632398 -0.14920922685396182 0.090105491215714234 0.50907211352355508 0.56697520063823625 0.63989994585324883 -0.47309053180561378 0.55923062823146363 0.5966385716313336 0.41972290787432032 -0.37885111711440128 0.575089074852974 -1.6064467536155269;-0.55844030953727342 0.48831423337708219 0.50633562750460137 -0.62518259716850766 1.2397796680961497 -0.22893309756751976 1.1107808160197479 0.62898554387060235 1.2248371034602215 -0.043619704425351999 -0.57010779761679631 -0.28536078962117356 -0.81408002344424557 -1.1057459083919696 -0.28835340769864898;1.1622500009790895 -0.50838427954499865 -0.90441414276457599 -0.28588525797725345 -0.25256033024247593 0.12200855653123219 0.080673724179709333 0.44937315297181951 -0.73062738033849017 1.0455811807813111 -0.82832108034513774 0.58243936493825488 0.35536389090782583 0.18163366836607256 -0.57801138313806244;0.093088267076892689 -0.30467490236684286 -0.65609702128423542 -0.096721128550340915 0.47857883584942013 0.55543817178561272 -0.029138321271246825 0.4933056970517164 -0.65792263306281396 -1.5180952909887948 0.18261300559944188 1.2314254372297517 0.52522105486403903 0.43171773364560734 -0.44567776415416593;0.037784323921867286 -0.52718108236148753 -0.19300657736901511 -0.50959294272616795 -0.066525350997401159 1.033016782816947 0.1958200831351907 -0.40377234725887984 -1.1372231414827016 -0.29150030181930697 -0.48969740817280383 -0.49465104865045911 -0.97317914071218337 -0.61293155192833493 -0.34101578611626482;-0.096245387539981769 -0.15732305851362638 -0.50604526201019784 0.62390952135233846 0.0002405329313505903 1.038204384892436 0.060200248572758921 0.56982522917556711 -0.98786768719056217 -1.0633933925456491 -0.091136236650339708 -0.067854727093538597 -0.84387818843434315 0.14607695397733328 -1.1802492414118344;-0.22034692970679209 -0.43185652541788488 -1.7633531698317058 0.84711283115099578 -0.55669634431105619 -0.53807968696648889 -0.85216898268757102 -1.3043448135558959 0.083216526848261779 0.66129262332986161 -0.098989069728018145 -0.32894315798611884 0.71860434374639692 0.25123771908619896 -0.62605978386676886];
  
  % Layer 3
  b3 = 1.349708242793622;
  LW3_2 = [1.282977378298235 -1.8100604994379261 -0.2296398993459432 -1.6960446485474512 1.3936759651726256 -0.94368478748840079 -0.018102178469566323 1.2742133329226673 -1.1884384695836974 2.5984263211447542 1.298017444178762 1.2980907817738634 0.63563013860213835 -1.0036411938337839 0.81701246522524273];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 15.3846153846154;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
