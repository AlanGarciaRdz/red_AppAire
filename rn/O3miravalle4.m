function [Y,Xf,Af] = O3miravalle4(X,~,~)
%O3MIRAVALLE4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:42.
% 
% [Y] = O3miravalle4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.304971027752364;2.48447204968944;0.056980056980057;0.0063552589768033;15.3846153846154];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.0783461329333708;-1.5430909294834751;1.6410772081177596;-4.080118827303223;-0.71335130842842598;-1.0982706025176272;-0.86636409556551375;0.52947436747989252;-0.57642111848032884;-2.6854812958180898;-0.93415225103724542;0.12077813803411423;1.0454550912834073;0.78559182007739736;3.8203550779524522];
  IW1_1 = [-0.0025640545578317019 0.64936248585449274 0.16977410516002367 -0.22475277556775849 -0.19174602504459631 -0.037717426619871978 0.98095367689809887;0.58957541642073097 -0.36100784700774774 -0.13130787211638331 -0.091662439198119214 0.68586025500132197 0.092152943407895788 -0.5608690967143638;-1.0810937772457057 -0.046047493750327677 0.58640097632322363 0.34834518994994912 -1.6414681599462162 -0.052851542468757312 0.78392156181767969;0.72055544995771803 -1.5220223007083749 -4.3969644066154041 2.0640820617805344 2.2899022023235625 0.67494104759365281 -0.92913060563698124;0.46457357122861304 1.8204595595296842 0.12133981174659843 -0.51854749037730585 0.15822787470670965 0.064728343403399446 -0.63594871006765785;0.97463289536893216 -1.2927447666361083 -0.34194107650079264 0.74353635651892347 0.91484866644911822 -0.23739254064076151 -0.064455357975290589;3.727628800155756 -0.32369261021747892 -0.12351262329720575 -0.86227933470531493 -0.50313980454015539 -0.099629187162677976 -1.1625864908486261;-3.6771576463405209 -0.23796278784668282 -0.36712178395133288 -0.20758752263104757 1.1687592913000386 0.15388316245128761 -0.32631939156524281;2.3810368841511216 -1.7087885979435649 0.57893262993467653 -2.2781862806241877 0.4386204343236022 0.55014132606303989 -1.2907210120137058;1.2077589633521992 0.63417823104552851 -1.7298529064689117 -1.6973263668681879 0.66433255797383828 -0.16541781774046896 0.10422664484616034;-0.50165072916340314 2.8076195484472519 -0.9997614580935591 0.96573735563136898 -0.18920920814309297 0.89797088896672228 2.4750925326824431;-2.5180682607019387 0.39191111584785815 0.66099459828864826 -0.65625591386745141 -0.2759852016516367 0.032097552892260343 0.64212422170289929;2.0372277221577813 -0.22367826841553137 -0.29488629159487884 -0.13046860010893246 0.10209256178094424 -0.010297382466211437 0.68069314324560781;1.5923153181131304 -1.2319855087661753 0.06011239303745175 0.8657082099011183 0.96107607620274316 -0.48307320667489428 -2.0462784783350454;-1.8345414225486254 -1.9924256428368949 0.23324848372030815 0.90174306229381418 -2.2870076653931477 -0.74100511501336297 -1.5383933816113895];
  
  % Layer 2
  b2 = [-0.77008294760590601;-8.1821295252323889;-1.1699808784995074;2.0503590160950167;2.5937199234822002;-0.47888307363450849;-0.71574729941483028;0.37145478537893639;-0.36533482633223863;0.10991037658845573;-0.30289835811680971;-0.28680985284779831;-1.978090952051377;-1.1764324087178537;-1.6944038456459161];
  LW2_1 = [0.93900541083234168 1.1498072105860477 -0.53600049357824864 -0.122558868499997 -0.96757243051223374 -0.62989433075554224 -1.516339913947083 -0.11135316592303639 -0.66025277917735481 -0.44398996318687223 -0.64115153510485345 0.55823876225016444 2.4780032830894805 -0.76662764965802987 0.35338231253243957;1.6519138194804328 2.1647199386072353 -0.25566867904625917 -0.40007664932650921 -8.060051195447004 -1.9680398839589912 -0.13426660479958333 0.38090517505325583 -1.0256100078341124 -0.82301473676231096 1.2356238601862892 -1.8931397077771301 0.16839881946554833 -0.019307010356917606 0.65103122770176747;2.8256525901973597 -0.27506803541609143 0.32399559704969622 0.8074915850014156 -0.86283456736636255 0.89407954071571738 1.29426919932109 -0.40664116443451409 0.16280774790019556 0.58238422607166551 0.33074124759393325 1.9835529987613505 0.56251098632249585 0.29871603653679307 0.45972428634915957;1.5710985984747972 2.1245050457454613 1.4064199994138395 -0.1349690363560371 -0.020568644463963497 0.66493601847768791 -0.54180643915822935 -0.36518740831375035 0.48140875785940151 -0.71454642002288193 0.13856264414790556 0.036739424724092418 -0.053130797432601032 -0.78806942160011229 0.51876568468537121;-2.2254987766054324 1.3451561879964049 1.116860716921207 0.30626812951838556 -1.5567321358444719 -2.2425227844278948 0.99206116610924533 -0.80434454941313027 0.67643529880031228 0.87184272440071542 1.1777223197532989 1.5302307851532564 -0.84825455153843921 0.26550651174251189 0.51178633154979525;1.2994379591104772 3.1026999753436386 1.5491773811093215 0.092006364731268928 -0.7976183249733344 -1.495286421593981 -0.099321834451268534 0.19829076267417631 -0.82427528255911864 -0.23576808970409394 0.64164865630334866 -1.5819595207250385 0.87920261244764042 -0.10314063687945434 0.47492004673725091;0.92028368372943981 0.23303557268506761 -0.52868457176126626 0.065984036066404003 -0.84168617492150233 0.024591764877466719 -1.7444409392331779 -0.20450390758485867 -0.6790597570325988 -0.74564921563016939 -0.54635122752244725 0.45173108910005078 2.7896045436076959 -0.69006185913706519 0.43653092519110703;-0.12860120753520113 -2.9611753130766578 -1.5951910817168125 0.33387280213248133 -0.45140883257379527 2.004144660375621 2.7403043521460244 -1.2753377467079006 0.40339364715137754 -1.1265051195065297 0.5280187418725617 0.93116682794136141 -1.0436738478705287 -1.2034745975222831 0.63918225125241368;0.039902653888526415 0.2401657283988243 0.43489119031138734 -0.11462228063513089 0.38462157068396813 -0.40346118886211979 -0.80665526473378357 0.47331366635992317 0.47323359798102471 0.44967921014387169 -0.26922260788605595 -0.38420634699996403 -0.56718043626937686 0.31355979968157766 -0.25898014485530546;-0.045829673544143287 0.932750631552688 -0.38482223261199267 -0.061066703994964916 -0.41312310210565079 -0.28125495456570737 1.4492852140315484 -0.55164923917673325 -0.51240583600714573 0.014046372854672232 1.0287273499455731 -0.71325901316217977 -1.8329977184295543 0.38552013813646391 0.48351607777838213;0.14067447500693356 -1.3186601880383169 -0.85430600460810935 -0.0351471392143528 -0.285256942315045 -0.23547976726821024 -0.85989881748014696 0.10717445813064633 -0.14581835789581352 -0.10537359564805901 -1.2053034165589369 1.4115959613580902 1.7755816887853875 -0.9020391530187859 -0.69359212323137698;2.2090659881723389 -2.6401412828394002 -0.019874766242567933 0.82739968827100985 -0.30379903697928667 1.5761683523286079 0.43597159160552257 -0.94922763110686881 0.11177206101015214 -0.27660943963736084 0.38406366670928049 1.0789938980332785 1.0718432539612153 0.30866426505112537 0.09812555056360435;-1.9090516306443204 1.8797590238523665 -0.11296664348452706 -0.38307301455064596 1.6435632704658225 -2.4220684510575894 -0.51300864901780185 1.6980399709020269 -0.33749336803979307 -0.39213576889408258 -0.62056823737549649 -1.6951648080784347 -0.89465344247552026 -0.20433863017525933 -0.8234989414972691;-1.5578582126729432 -1.0375560411121783 0.44634421389578671 0.091745599187580087 0.2996569065406226 -0.45030166396890697 -0.60512972369631846 0.81362608360046929 0.26848818458258206 0.32890093695345723 -0.14969009555498275 0.10562551914393331 -0.14301113945584992 0.29790973357011691 0.09651855537891002;-2.2230427994249835 -1.4615786738596408 -0.66908912877622928 0.36909719513616657 -0.58681866946204597 -0.7066853551563721 0.93954964617438375 0.36014811700925337 -0.98018662159761494 0.86919878474690759 0.80825884118517788 0.58692070190128776 0.46138742109694025 0.80553930329803647 0.41942310799830768];
  
  % Layer 3
  b3 = 1.6923728854376772;
  LW3_2 = [-3.8729793943386461 0.88671996091581762 0.92812858699084833 1.3362625677012607 -0.63713655767592947 1.0830046813760261 3.4996857865576083 0.89995066220078956 5.2943025587098127 3.2940985667757978 2.5826734742241264 -1.9582482726747148 -1.2563666232307389 -2.4581890423330433 2.973051502317495];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 15.3846153846154;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
