function [Y,Xf,Af] = O3aguilas15(X,~,~)
%O3AGUILAS15 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:34.
% 
% [Y] = O3aguilas15(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.42005420054201;35.0877192982456;0.0561797752808989;0.00588581518540318;11.7647058823529];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.7919781770642662;-2.6934273352794325;1.9580592513473039;-2.6437327348858668;0.50126126163677498;0.98765252273281456;0.050558967841251592;0.50480735123615095;-2.6482076926873623;-2.1863738015451037;-1.3625458043553595;-3.6870518544845283];
  IW1_1 = [-0.41464328563880648 0.34436406923535157 0.82784628495195234 0.10656284159776565 -0.35605682237896985 0.17855274014041927 2.1411514130769871;-1.3392628054795959 -0.68479888684080215 0.54112362462154195 0.40857939928232734 -1.7385138610811235 2.6060500908224804 0.36146401804603673;-3.014268225744642 0.32576435784425561 -0.29638785078903845 -0.09578484278323339 -0.21461460591704634 -0.018995010245802066 0.030799972920245677;-0.97375965813611076 3.2064678660467303 -0.59910069916199293 0.6713755508818634 0.32337016992566403 -0.21787698303254807 -0.42964889895644343;0.078739932823666994 0.87649838578336992 0.87603365988253001 0.096582578243284326 -0.51590580511611617 0.09310600580542247 0.63436986628128456;1.4902297729986724 -0.96945573788037609 -0.2141516703225283 0.095266685768223613 1.0522832443366077 0.231054308524661 -0.67881147503143646;0.90027038146023231 2.3008055889888968 0.25343587617795915 0.065212582091015298 0.22591442369094028 -0.024155368489697543 0.21856367244886088;-0.82035392670851848 1.9826034811555862 -0.025146711193642906 0.0074392123088706207 0.053604882908495299 -0.086579473955665051 0.15497138049921222;-4.3789739203515881 -0.11873653385762065 0.035630006886878701 0.71842069027713107 1.2085914850638007 -0.11486972984016036 -1.421518311835114;-1.7900844761241244 2.1942869726007777 -2.2714953735142398 0.78543536085408427 -0.1900933061477357 -0.22795155545793858 -0.23938461733325891;-0.71653063553905394 -3.1303564625638707 0.19099729589550152 0.23498763097451136 0.56989911837760543 0.1837875964079336 -0.25697170768798261;-0.43558969700036537 -0.15613332156168691 -2.471774402671937 0.094201692485285482 -0.45505346192493656 -0.40796038636638715 -0.20775144711875876];
  
  % Layer 2
  b2 = [2.1015443478186806;1.037126075450223;-1.2927929293203182;1.5654367852559632;-0.28992953307167957;1.3448222623606563;-0.4230241782825554;-1.5428598194876872;1.211861547994602;0.80968001121772992;-1.9343476386422787;-1.386287561014415];
  LW2_1 = [0.68279504626015841 0.37869582061932527 0.87491350945246738 -0.078528247123122008 -0.56669605033709569 -0.92384849088168886 1.2477681754299121 -0.79938411315579871 -1.3036757456674428 -0.43974103665231984 -0.40422935404854815 0.49681773720357303;0.26592762369768663 0.31365827003623281 -0.54020008662985453 1.1490068618457543 -0.32740996753364321 0.97591054129360222 -0.17251442606563783 1.3559184954061567 -0.2363015524628323 -0.13563692365987906 0.36797427213767581 0.89402388880064987;-0.21989659114737875 0.39805542844892089 0.69515182586552604 -0.91920736334809217 0.3315309714619446 0.17225896213251934 -0.98974548407968432 0.25267215664944359 -0.017360298968729933 0.91768648952843435 -0.84623812199425685 -0.91560814722111727;-0.63854500786718438 -0.4731551478325951 -0.24143475264156963 0.2250928543835283 0.62277329829564376 -0.27578015027051195 -0.49826468435483079 0.1915425198792918 0.51501101123333193 -0.42636687813809915 0.51305146587127803 0.015172190991790152;-0.93870574270465745 -0.15076208514604264 -1.0628278584953612 0.74222649499082893 2.1756464606331924 1.1415647030370621 -2.2562069252384891 3.0407565842435833 0.33903150545111016 1.1160437513795332 2.4054759984683542 -0.54509343177278846;-0.9998724037894422 -0.23761656582850804 0.56242573005438334 -0.89245763898298314 1.3512205426317838 0.46657146710727893 0.31766480140065606 -0.98348941152318403 -0.040581853338973767 0.61317649685938647 0.58460160772597536 0.6694038519197083;0.14061827363012841 1.0952338078395676 1.405475843320775 0.75598442898590945 0.76756582851519473 -0.86221616958343006 2.5690389594483625 -1.7062237787127317 0.34449230980436074 -0.54599004356549097 0.54882661392905985 -0.18844185665632335;-0.65923727872576832 -0.75009461141229883 -0.86878413031165835 -0.62083163797850716 0.55590241423265263 0.90400295787026008 0.098447314315543669 0.42519679176991532 -0.78496316477738848 1.0615987201108339 -0.32400469885683725 -0.18974294870115091;0.64512785577486542 0.044591161064363033 -0.60222052947330595 0.81754690768049088 -0.52147723029909732 0.7123571739484208 1.0952557476784983 0.46702310788112361 -0.24485250731237773 -0.57411711372505225 1.1762082146412198 1.5553842562352869;-0.5739062801910042 -0.60945345477006141 -0.46564309800803133 -1.0767868166363086 0.53445758738419935 0.95130131128429496 -0.72846123772564308 1.5777687775025986 -0.11945645223383582 0.19372063576907822 -0.58216525891118875 0.089463101154895391;-1.1764716966444764 0.59368001648435353 0.65007716173916708 -1.4199126755750278 0.9748053100884625 -0.86440675643536025 -0.73202051992795281 -0.35589866400928505 0.025616091587324405 0.60664941085273971 -1.617701246716388 -0.83136814007220894;-0.86636370759142256 1.0253720634368675 0.55434032457214011 -1.1515786619437229 0.8940409461554395 -0.024945078912986973 -0.56252321914280334 -0.28398939821261809 -0.30294126990842812 1.0045092491255134 -1.3891285725229232 -0.21714841527107773];
  
  % Layer 3
  b3 = -1.0254672643483971;
  LW3_2 = [-0.91395400052340969 -1.7216035153100324 1.6252157730928738 1.8651288670424377 -0.63329756895037836 -1.5092391298320753 0.37993409075429829 0.80539675807309186 1.5094391003137675 0.7241072632821256 -2.2666974975134062 2.0562755329995337];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 11.7647058823529;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
