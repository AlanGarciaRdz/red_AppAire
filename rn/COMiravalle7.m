function [Y,Xf,Af] = COMiravalle7(X,~,~)
%COMIRAVALLE7 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:43.
% 
% [Y] = COMiravalle7(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.2119814839840903;2.7959588636784014;-0.57620708125046793;0.1188356222363246;-1.4377585098508854;-1.5710136299389665;1.4355270036779102;-0.12865832574417441;-0.086935533341001431;-0.20472467560855714;2.1810511758674327;3.6575955389287147];
IW1_1 = [1.5554984553879185 -0.58782641829279336 0.23960182604773364 0.16192020477694807 0.016807867934244543 -0.6248289211888074 0.15911700049057986 -0.26074947881770227;-0.62042487460943774 -1.9387749909810672 0.066322134393264953 0.92690966668925423 2.8840326402865291 -1.2587762226262695 0.42092433705165144 -1.6128388758684149;0.2651516743378885 -1.7140972425217536 0.53521658249949877 -0.010913345213193279 0.41337062605369407 -0.062771935695228681 0.00077336779080968213 0.022713284598827339;-2.1539141571974478 2.6695276779413151 -0.53810454177181921 0.64784963171111076 -0.23579175573058839 -0.46591598719839022 0.2203673476229846 0.26043742216239074;0.043661394024397948 -1.1789203575416225 -0.16679308214001407 0.026381327251148477 -0.056395078874122276 -0.21038523101101309 0.1618590513832435 -0.13798026443189426;-0.87759379535570281 0.15740540509940254 -1.2944635024067754 -0.40520342715622765 2.5513732284650961 1.307706415813088 -2.672886023431158 1.1525174671366765;0.15265250159062096 2.5144260899014661 0.070385876628686395 -1.0026942391474416 -0.62032938414396188 -0.34482163140509692 -0.4571205414701508 -0.22045265397511071;-0.77985301947124452 1.8410155668918862 -0.41953121323535736 -0.41666278262122669 -0.23518071069104937 -2.6633245674375581 -1.0157077799270431 0.39917832662440633;-0.17170080482674957 1.3046469411148387 0.70579858384548544 -2.0663979677232502 -0.17477979651349584 -1.4824028671507603 0.95001939970409832 0.62474469416796363;-0.29552174220847122 0.31665601222156631 0.01834259789552304 -0.34913407805620905 -0.22412748858035048 0.30200470035330451 -0.15567660637809311 0.09070750319139198;5.2853921714319627 0.039360805656996435 -1.2857925002067083 0.091399293952073468 -1.8902183776498453 -1.8290792151488522 -0.7640141055165014 -0.21217894963921238;4.3840465249868696 1.0835943018347274 1.6718638781571751 -1.7890252402727407 0.42093795978456544 1.9698594462730952 -0.54134700204080843 -0.47081649567692901];

% Layer 2
b2 = [1.0743669549706556;-2.6293458103142715;0.15847474406162709;0.25475794081890618;0.68835532702588342;-0.13995810830343078;-0.65553144341794223;-0.65363397531570655;-0.47951010762724244;0.31222444901475688;-2.320841847365775;2.7689805603145783];
LW2_1 = [0.52458857569774897 0.11547539322095543 0.63026858554172216 0.3237281743314635 -1.1093532874444145 -0.54956191383449393 0.9874242797275099 -0.098341236649838321 -1.2123536595947322 -0.96954430406236158 -0.50225170689787391 0.87462084580500232;0.2879395272497145 -0.2994630915929431 0.35390623121566983 -0.30971685572764629 -1.272773932003235 1.4084464432757478 0.73176240364116263 0.19086502859748805 1.6562969943373744 -1.1096844307505793 -0.50904548302214814 -1.4418733671040216;0.67738318134669051 -0.086518443550634774 2.08653541928232 -0.96573073110869367 -1.0599108282375302 -1.2167834128663311 2.082396356587116 1.1215372263387904 0.16305361356825529 -1.2401080299510969 -0.27036795723488605 0.9261738841744741;0.3496162761280594 0.29072558616360972 1.0174943483202803 0.49759375032463593 2.4450725998610543 0.082820658480184425 0.016250710581408416 0.25614517661027425 -0.22038080439533744 1.5612096271275224 -0.013465119290601037 -0.29393886391099805;0.59007298022907761 -0.3650740072507403 0.19241854811508255 -0.29468028827238557 -2.1703933878753849 0.30655731122429875 -0.43814981434397027 0.13300525359038393 -0.25018792410847057 -0.029932196943361904 -1.0640809246214489 -0.7901044712331643;0.7166940340962179 0.5548500010006121 0.82446028313391284 -0.23549136170665794 1.3346786588343602 -0.0098762788931700072 0.24833717264384517 -0.033880871099449837 -0.35374958815368479 0.94683702159778638 -0.30211224944143983 -0.35639114027157576;-0.59491834572122304 0.24436927882305889 -0.31656159130691369 0.12467865746684309 1.1151189331177813 -0.30814957025793971 0.0611063276780974 -0.090315319621401033 0.16819425639611038 -0.38470906397369098 0.79988515896564127 0.76352054597639918;-1.6152226144676312 0.19519229370014493 -1.6298637286125945 -0.060073688099338586 0.2031960183743288 -0.44184303067343539 -1.6766323609123461 0.20959542406992965 0.40911621979699386 -2.1280875608319034 1.5344432264518673 0.93627517931001569;-1.3833252126601121 0.17955011094986828 -0.5203155359160363 0.19197816422150488 0.45738791825142389 0.090909298595594254 -0.007412093011321657 0.1486075385716307 0.61097476133777939 -0.7882276921736544 0.87825526353673922 0.080238590329944071;-0.555532069361242 -0.41042642341424329 -2.4357167133578814 -0.53944882799443605 -0.87339002050835868 -0.16384854714871477 0.49842076305406358 -1.820364588578484 0.31582629632065051 -2.5432946554130891 -0.21236114169712028 0.56279244510457738;-1.5587368652350631 -0.2893948364265857 -1.3577306853486704 -0.60357313478349806 1.5581759381550313 -0.463279618403588 -0.045628298850160773 0.15196516476489869 -1.0075893463956762 0.9839578240241017 -1.0002453135467431 0.031533579244568448;-0.21712818910480086 0.99282731354386566 0.49348346212967031 0.68005069288690523 2.1987359162494133 -0.76549666208558176 1.7938506934455776 -0.069683484997299316 0.022516923688469404 1.6029601323457101 4.2101914046592226 0.74566094536132177];

% Layer 3
b3 = -0.93390302392457669;
LW3_2 = [-0.46835908539480681 -0.56305711884264686 -0.13976717063061145 -4.2843751151576619 1.4459724165331949 3.4218930836115531 2.2925865315952128 -1.1082091398462379 2.7596997982016842 -1.0237796557333687 1.5279255566274239 -0.55859711431828274];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
