function [Y,Xf,Af] = O3vallarta18(X,~,~)
%O3VALLARTA18 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:55.
% 
% [Y] = O3vallarta18(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.12820512820513;24.390243902439;0.02710027100271;0.141843971631206;10.4712041884817];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-3.7654515453950808;2.0672814294762811;-0.69326173355564613;-5.3326148920708976;3.0483375530667365;0.35508293345795233;-1.0438662810079948;-0.23869260516140234;-0.73541204725612508;-1.6523550793976756;0.45433211959082509;-3.9257568331250017;1.9252977346896307;2.0665671611696035;1.2745259243052145];
  IW1_1 = [1.9733891121061617 -0.019314146857873561 -2.2794687451834257 1.4033787118784877 0.041731843235528893 -1.775720770484116 0.53129297803618813;-1.1758250759741367 0.67242819676958365 -1.071643865145298 -0.76104521824132776 0.96941000516782838 0.97319340827616874 -0.43662914553090837;0.95207217864163096 -0.077151061652572878 -1.3338926264491768 0.1902538293554405 -0.83041774417044245 0.045572322573728903 -0.85774722850100094;0.25048363523381523 -0.028066968483238509 -0.16395838872226348 0.11960859715450183 0.16816917412755011 -0.076045902517778902 -4.8060613681465529;-0.19384158690114642 1.3011424006149899 0.82667133488824551 0.37870964283489933 0.055965275452267274 -0.6124861907955873 2.1928952700439019;-2.0040298898709996 0.052226874517734084 0.053383414394606893 -0.49464593175294724 0.30074968200836893 -0.04836039039071887 -0.14458858844115138;1.1170548052351359 0.31487099319553258 -1.1052582908953255 0.14908310421891885 -1.0533969078173551 0.10456731615529835 -0.64706940297730497;-0.37745114969066512 -1.3748136934525781 -0.14072142034495294 1.0089523040166608 1.5981089209836374 0.22475953611567123 0.80688232487779032;0.28042679388565073 0.46255637992656196 -0.86591194265120963 0.10298145653010232 -2.1284992450059348 -0.36619475064254642 -0.64782965649528113;-0.2776325187708118 -2.0447315218377207 -0.35355770419061328 0.72045339492474614 -2.0204937373343221 -3.1630214506889534 0.08478813220141429;3.4819215936869758 0.23450744496761525 0.18213894525427368 -0.45432679216911354 -0.98854982664833535 0.020461043348480683 -2.0167647755398743;-0.6413049780684329 2.3165180260207565 -0.51724771269903957 -1.5603221543140815 -1.5828316034139436 -0.21611718312696965 -1.0689752137373445;0.94391384920423715 1.0877251890789879 -0.021284736374544946 0.091694479936537815 -0.59697568104291754 -0.040420657826360874 2.1932950697581899;2.1212653877964813 0.23807261186468218 -1.2955576105108653 -0.1412946605623282 -0.80487921082506331 0.58114841048444787 0.76590733982814141;0.19656417982116295 -0.41886208693608074 0.51058363414236074 -1.6324714750954854 -1.4880827270056873 1.1468032798600853 1.5811071959876855];
  
  % Layer 2
  b2 = [-2.2216664758886493;1.5199699664468813;1.1199304410890993;0.9148421393794326;-0.9154941357274744;-1.2296775562600346;0.66640445047148489;0.18919633456653392;-0.60298389640943151;0.33939915577394431;0.37494239198865015;-0.86403340096742587;-0.99436331673361733;-1.5008086633064981;1.1743149230131718];
  LW2_1 = [1.1714045689303159 -0.043347544999496591 0.87493961571404355 0.32242844816967337 -0.10943642061574999 0.35993632510169415 -0.35733631950130357 -0.096911400890545105 -0.41685254599286636 0.9333836508075477 0.38582338940053112 -1.1089893578970638 -0.46751307342073806 -1.3581735180692449 0.34080623728512144;-0.061088913663778589 -0.039368464113508972 -0.27380253477916733 0.57390470694227225 0.019583268788620455 -0.39683098392303745 0.17779961377327785 -0.3945493112305748 -0.65449487967457853 1.3112304572576055 -0.076323741405799853 0.57973646961115488 -1.0093633143570675 0.80028352215199117 0.16750639210937335;-0.3282722174728635 0.55920883260851773 0.38077367451249933 -0.36889815866292769 -0.85486142952679833 0.12735216762503979 0.18557620103425337 -0.0051345190036009127 -0.29065182865214984 -0.010436638813699942 0.51072445869446925 -0.74919964784243587 0.99031554178299408 0.1062701934352164 0.36798219850473984;-0.39791335586133714 0.39565049667896002 0.65385045358017291 -0.75147817148305174 -0.46189838083442142 0.65710044199629714 -0.32253263765308693 0.43607179764472515 -0.0017697791938148305 0.81253392771629152 0.56496570777867527 -0.16850399350093515 -0.29165788875873061 -0.17949940971261896 0.59721483446515178;0.94906289469609084 0.061839455358435991 0.8991449991525744 0.6023259135385084 -0.13390557394785291 -0.78075258017913385 0.65774295828734286 0.34950974202339963 -0.70362618600371418 0.78606881689291919 0.018044523667724986 -0.45484523388043152 -1.028496263663528 0.203158781059149 0.11684271178044779;0.61445445358423922 -0.069960754484343801 -0.63152200936684766 -0.13561553200935153 -0.32834136828196198 -0.16599393861314329 -0.17992612385438408 1.3276932778579487 -0.65331172876058419 1.2016736553530596 -0.25164296979706385 -0.23510505165755266 -1.6730841819510989 -0.20487794955229849 0.46546597495625158;0.10507582488864231 0.97494454887834492 -0.26520068376663691 -1.2536504982885284 1.1951019663351503 -0.54281255783319071 0.33067952848213672 -0.12395109494982576 -0.15946559144212066 0.25447611834754386 -0.35730344269153824 -0.092577346465894689 -0.94894134597994118 -0.27235030580558206 0.040930204942509388;-0.32426445779529722 -0.42260353006227269 -0.009208716079997438 -0.85255810565859269 0.13866993449510129 -1.1065838131641772 -0.47781109918808173 -0.057234761885688823 -0.4717771298963539 -0.052312862780621742 -0.50239049034833916 -0.10018197133237171 -0.24232763639161989 1.0782777612175631 -0.25669934709186709;-0.090226729554986382 -0.33057618809983647 0.38674138005879538 -0.55186746315869462 0.5636226025127824 0.10176958986802656 -0.20166577808692435 -0.28859924515931307 -0.61529035076909377 0.02304361323112207 0.24753195108055753 -0.41533633448428126 -0.15036242716844581 0.6650107123294634 -0.1380020995369424;0.57047509433161492 0.69917600439476268 -0.19852702764172633 -3.82603193718146 -0.29193623936668894 -0.20316797219866464 -0.22827623561108656 -0.061502988558809646 0.11677508545552706 -0.0023250753073289672 -0.5246938459584547 0.28050466979676703 0.306182627568304 1.0824485013915857 -1.2268068337476195;0.16217801510954405 -0.91585746102746479 -0.032145113160257317 -0.98330450110647816 0.6850902583701175 -3.1880289446679217 -1.0140059866661024 0.11480691756786984 0.14938382095610231 -0.30790463246093996 -1.6553352027689816 2.0421042562518008 -0.077088898072891279 -0.3018471324576561 -0.5276299917014442;-1.407720725575635 -0.820635347166769 1.3277677846547309 -0.71386110893088772 0.55743357045806385 0.7150945180498528 -0.69321815279081045 -0.87902465726699097 -0.34614108916770336 -0.93035051935910418 0.46861966536038618 0.73039695979587849 0.86561146533857691 -0.26501039370948504 0.42783942743074305;-0.8539096649945318 -1.3917280350020835 -0.71402045132440217 -0.24950365791579057 -0.13911707903878406 1.1302291610271016 -0.11466378973331789 0.3896072386423986 1.3241550260912087 -0.022670435197728059 0.71157961814059112 -0.56114579515128504 0.42319990991974388 1.0046805210609449 -0.85814870794764664;-0.11835613989335717 0.82295174873668997 -0.44571453888641716 0.022362122762698233 -0.44845140869506506 -0.19087409517213691 -0.84945445642047268 0.14688938085969608 -0.64678042549964954 0.49831689674051571 0.031979507118042746 0.37696855680733732 0.060199675786766195 -0.067998719308544467 -0.47616908782192291;0.84531864549041003 0.28511228960738666 -0.17457773746091723 0.37586126326278929 0.49409449692515545 0.81509252030899915 1.6583444480200733 0.65117261905477652 -1.066763121525947 0.21420393430147772 0.4775400045236608 0.22530338389138629 -0.48524046110298641 -0.50793949571724906 0.69591408567667379];
  
  % Layer 3
  b3 = -0.58328876854463729;
  LW3_2 = [-1.4068417836525995 0.082275703629499583 0.45461042813460395 -0.68060929778580648 1.7638922441091553 1.8534885665378531 -0.9159864394186864 -1.5224879016920221 1.7774799525494311 2.0601739627623026 0.27697408630664599 1.224602915297017 -0.88206192518801396 0.24559737147365721 -1.035249519692905];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.4712041884817;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
