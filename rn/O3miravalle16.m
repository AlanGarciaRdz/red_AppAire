function [Y,Xf,Af] = O3miravalle16(X,~,~)
%O3MIRAVALLE16 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:43.
% 
% [Y] = O3miravalle16(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.304971027752364;2.48447204968944;0.056980056980057;0.0063552589768033;15.3846153846154];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-0.93077759601705579;1.2664604206648529;-1.613903892887911;-1.5500368230429185;-1.737809819922558;-4.0242921906050855;-1.1154226713674351;0.71460420802119207;0.67776215512360583;-0.23816108823547183;1.0536114459478951;-1.0962283335592393;0.6317413634841319;3.3332336452493707;2.0092683405407774];
  IW1_1 = [1.4965588559635334 1.3069671259409219 -0.66288922246244331 -0.47986284468414409 -0.64064902558851655 -0.026345133140093131 -0.76427999954805503;-3.2334593618916041 0.059177235134369982 -0.067050202462738739 -1.9019614106696123 -0.81597753595591316 0.021705396461116161 -0.69313883051935665;-0.07351301108327167 -0.92624392644372278 1.3517733576242714 -2.4649669900460518 -0.06140111979847887 -0.11843151681089643 -0.024996627549191484;-1.0484853943416361 0.23374939374313403 -1.6211597312325459 1.9877323838289502 0.21829645230435696 -0.80115635083990266 0.14447664666630203;0.076259165719974681 3.720956282837049 0.50902161706617521 0.92114557216145776 -0.17595634924026587 0.63763903097704255 -0.71338858202829669;0.35789142920271189 -0.57660945289923382 1.4298170698287123 -1.5096739255855565 -1.1149684226799035 -0.27416416552581752 -3.0114526922387221;-0.81626826991249257 -3.333726487864018 -1.1908698646362748 2.2350879168785576 -1.036448708569335 -0.0049208820534544437 0.53655248696367031;0.72832878028627679 -0.14896493118570789 1.4541900542103168 0.24652096273652635 -0.42898523588691173 0.10972760617052751 0.31895522960372658;-0.27748496197230027 -1.0099459553246286 1.5709143372338428 -0.0024736968211930225 0.35672463080030686 0.023547346744865298 0.6913402178842647;0.53339721119410077 -0.72930243331359224 -1.7011911584757857 2.4384136597014114 -0.65611158124687496 -1.0803047188623214 0.26526903341600178;-1.0183569890230233 0.46643694119140322 -1.7344325362048836 1.6518531161702179 0.00014167959379425554 -0.033117596758618438 -0.25254752133255021;-1.3253931972456816 0.93336595943759204 -0.34261485399239167 0.058638405882726966 -0.19908244647405976 -0.12005226451229271 -0.30900250015686714;-0.042708077924352009 -1.9182833677488602 -0.29190073100871361 1.1804252855030302 -0.55843027819921565 -0.25030380697827814 -1.2472603934420812;1.7816798437452026 -2.6576888670648922 -0.10455251968526684 0.18107756779595952 0.90341447892416138 -0.53432291030265988 0.28539838585667571;1.6455590455647484 0.018183611086620866 1.009111264029509 -0.64039263704672378 0.053621651315855223 0.010716389021800752 0.25232903066577278];
  
  % Layer 2
  b2 = [-1.7088276556733661;-1.5792167824095589;-1.1698253935621259;-2.4836101538085473;0.36644543225684556;-0.22504127734590681;0.033928707308256145;-0.68912852108888556;0.59129055143486686;-0.058508947930538277;0.20022135597752705;-0.58309191067594879;-1.9341373430707145;-0.9316316061966754;-4.0143476803440823];
  LW2_1 = [1.1098972166760068 0.0045554195487668651 -0.095563222223159106 -0.64790350872325631 -1.0341434235007732 -0.64093396059080032 -0.053242298784226802 -0.34935332785826179 0.69838631765688108 -0.48628256366125772 -0.86912757544377783 0.73825428241348001 0.12257173264640792 -0.094526638063562984 -0.57183502408825748;1.688059657762971 -0.37454287841167727 1.3807390875213101 0.28033267727010108 0.69792376754463525 -1.2771079788181112 0.3642686518673745 0.4718997683825405 1.0534186982506946 -0.6660705106315078 0.36109050023343703 -0.61354324995352394 -0.10268591814052472 0.5747382179785625 -0.10414596281977034;0.0079586225562476246 0.35360116280253001 -1.637144901933314 -0.13841859971289713 0.77109955859560275 1.1056569259542919 0.40631135188202955 -1.6191163911927664 1.1722411933945227 -0.17431620812249637 -0.81624404400210726 -1.1542408650537623 0.38195214049809317 0.47886951701485314 0.38814999165335129;0.28592260107845202 0.64776786220666371 0.0042545648759253797 2.6171484136372261 0.64367810768628086 0.49249509079523496 -3.799452530148538 -0.59292255058627941 -0.85069915377649974 -0.80391425497166558 -1.1003298213880404 0.88884155126696818 0.65700390640845807 0.086091056754623682 0.16266897186760473;0.28124885092405361 -0.53271016771104696 -1.3498291374767373 0.28436162119282932 0.97547173936176113 1.3429584264500718 -1.3656746391047205 0.29005881855305593 0.30574514215014958 0.79734410270073508 -0.57454372136313392 0.17910247493379697 0.76041001647969242 0.19215856459950179 -2.7528331024235313;-0.226246836321009 0.68246481455558761 0.3417092826371797 -0.31036669494568025 0.82864207058249739 0.11829071805299941 -0.17227367533986804 0.34434648486226854 0.10875051740078927 0.35528484240401542 -0.20994343804481616 0.70066817040970319 -1.1713613919827393 1.0473267375414232 0.63369149533878755;0.13785170801335564 -0.97789590059564635 -0.026286630979605995 -0.48520715855711283 0.47907855657781212 0.59666291378194647 -0.065098576998938062 -0.14569852983730702 -0.83554839861152286 0.026361662573150813 -0.39752519947459397 -0.61264490233054136 0.58127221743544244 0.44014854854654822 -0.2911137547148005;0.31031878206476093 0.82174974687226743 -0.46104602818358503 -0.16128047462712244 1.1285254747356936 0.083359200002213293 -0.63828773482809642 -0.25039303577362171 0.99496447151149714 0.31385865490509168 -0.69454465629059436 0.50684434540699763 -0.99115879801201778 1.5132555276679123 0.18050706541263295;-0.19715912731591692 0.1440810510261297 -1.0034940673048778 0.26366080767839328 0.90801465235251999 -0.030483473230654111 0.21146023728662 -0.79403368358685722 0.56010660821406177 -0.33806599755758021 -0.26452309228876497 0.39587615836673218 0.38220760456613123 -0.71222308269816414 0.80092981320036383;-0.025048496904061478 -0.58638297679156504 0.17052549503079589 0.022366352484686325 1.0443754055434125 -0.17743716558693692 0.0019370224646680385 -0.58420586321808676 0.58971093788848383 -0.1895155487983759 0.47202028856196798 0.90424263479894118 0.033441622118768534 1.0176558439620895 -1.0791765249840672;-0.24468000806539553 0.18376723472094472 -0.26115505551898921 0.79329349262864945 0.073062062895669022 0.39648006575752032 0.24539413570626056 0.19621765012806835 0.21893736756967527 0.098604521337992149 0.017222204130952302 -0.67998847450081956 -0.28097600494905839 0.0017215885815891688 1.2893003392353;0.030942197591469357 -0.52171028914268958 -0.060233469138607776 -0.30198735540542426 0.78041835490906231 0.10316943909455055 -0.87449728096887136 0.0055396776199082669 0.67282087946413616 0.019549342378742566 1.0134118024328131 0.43288505124436177 -0.2410397020268536 0.93934458304959745 -1.5260542260992298;-1.0663535992341773 0.63421641092134373 0.37995044799224587 -0.5513497778911548 -0.54786795663164445 0.80337307172945793 1.8578675066546821 -0.59614177038429728 -0.87031854710992096 0.04956502085823121 -0.50941622016659893 0.067771011340020323 0.16998629410367466 -0.077663249567557366 1.9769989622009345;-0.35967200576874697 0.40257640614978379 0.84380718435003732 0.24377382370680775 -1.5466501759904012 0.64516001442232984 1.3508502486003118 -0.27873954547157509 0.007610577600464451 0.50645683431995026 0.54378539847803864 -0.018247564171452967 -0.18695060571483271 1.7797448038195813 -0.75169726270543502;-0.96202204699371052 -0.43180978596962954 -2.0543314952125464 0.50866983248461861 0.6737660594848075 -0.49481807449695503 -2.7170629202994498 -0.91583313678669154 0.47292170664362543 -0.78533178433962214 0.26555097847401493 -0.47704281330523945 -0.18311513895607648 0.38807400156726612 -1.7705463878871537];
  
  % Layer 3
  b3 = -0.71974643769008317;
  LW3_2 = [1.3204011620598355 -0.6084948259973596 -1.1758025658642324 -0.67362280165636657 0.82968350858664541 1.893706753310908 1.3881984185297422 -1.5366589683187923 2.1256282837428011 2.3387692787720535 1.6847986482553801 -2.888888236013031 -1.1983445342078825 1.0933272702682664 0.7931322955239255];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 15.3846153846154;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
