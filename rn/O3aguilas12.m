function [Y,Xf,Af] = O3aguilas12(X,~,~)
%O3AGUILAS12 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:33.
% 
% [Y] = O3aguilas12(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.42005420054201;35.0877192982456;0.0561797752808989;0.00588581518540318;11.7647058823529];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [3.3204205334601342;0.2721508554454718;3.6019463551457802;-0.54165195778729269;-0.47220789489511206;0.84686227375712297;0.30872162927532415;-2.5765990063742126;-1.5715757015658673;-3.4475541179493501;2.9212796853126934;1.5250734792595557;-1.2876387239184304];
  IW1_1 = [0.17309803123534584 -0.15740454177988247 -0.26311031040468696 -0.11368915402607617 -0.97394406023555669 -1.9468086119714263 0.67095222500993867;-0.45426709672048504 -2.0635605209004564 0.50773447458424659 0.50807574874890737 -0.84808464314356757 -0.2741855424044049 -1.3154752586245777;-4.6879276617933847 -0.34020084488493924 -0.2905231580902079 -0.16240016277907643 0.31143361217127302 -0.15519318529949275 -0.25911062569868704;1.0280267978879771 -0.9113482641663323 -1.0502752473862562 -0.96199958318991097 0.72431457437397839 -0.50522700402542076 1.4136454937347021;2.1886618811998333 0.46883982379581246 -1.2271564144198464 -1.0498373591596588 -0.026642443378355141 -0.44620613882405002 0.12903375620646107;2.0348389974166419 -0.83644239349079419 -0.71256138414845871 1.2470945404626328 0.81669528613426612 -0.16935809790927459 -0.90908760438236313;-0.71808409805875972 -1.8070849546251917 1.2790740921404837 0.026793761296142072 0.96618644555593847 -0.18130770882810965 0.1130376994077521;-1.3014135713903794 -1.4789888868945817 -1.4231486534091082 0.29143025131852784 0.26335951729173207 0.054092794528341953 -0.50463990172690132;-2.1453478062843985 -0.42541308409903489 -1.1509482888661553 -0.30212235660258313 -0.077657716573056992 -0.03213345350239305 0.28816880525189165;-0.82180613664476332 -1.3098422102444418 1.483800338858724 0.63311359910664278 0.63621207499973775 0.031550716601975871 -4.3245307967201958;1.2411711087832693 -0.5316054856365483 1.1423734319007044 -0.50685168787352008 0.54529988488782055 -0.079077734123554469 1.6881792878062316;1.4851505215546761 -0.52445892106847247 -0.0026454030567978973 -0.77404064230773162 0.89060393921160941 -0.32945598162651812 0.74065710996322376;-0.9031000527084625 -0.60491647376252899 0.5497503234198996 -0.063747786556148572 -1.2251673601789896 0.36173776228316468 -0.36336672548020488];
  
  % Layer 2
  b2 = [2.971181802924082;0.88279394153510293;-1.2341079516626645;-0.69624914157508377;1.404886345723807;-1.049167698784224;2.3789810130552875;-0.026570319975211643;-0.4386520164254637;-3.1097323733379847;-1.238476488686076;1.9246729853158266;-2.6317129328082496];
  LW2_1 = [0.351902309046566 -0.33496669256538925 -0.72259970771149673 0.547334076402195 -0.83600496386951895 0.38710698724051279 -1.8712008777382696 -0.33063059059002531 -0.33024764279624269 0.53125713357087723 -2.1112682088017261 -0.38629332704853353 0.62890244231182324;-1.4373315735132803 -0.25479835213333035 -1.3622487533418848 -0.39309370946041816 -2.583432699195257 0.77343896149306923 0.78193542295916674 -0.24922515039042281 -0.66346314632004355 -2.4511484148336322 2.4162995397788465 -0.89416223701622755 1.0092630960977229;1.2074643282671291 -0.23181836854389887 -1.2133822123551641 2.0069803682905638 -2.541725745330218 2.3462928080397196 0.24723785739678905 -0.44750448257267489 0.86201259342974879 -0.24135565041770271 1.0675934334339769 -0.33204679811737137 3.8568972002066504;0.40903287050845211 -0.10708022815384938 0.032998671489806453 -0.10722087318220694 0.3263996861916495 0.51553408091672825 1.3194111453304296 0.15784872602060326 1.0640444671810769 0.17137590389676086 1.0392404852734074 -1.0286476185588784 -1.0841322552095627;2.4114579914241983 0.53642953135876548 0.77912368673898913 0.73133643870733889 2.1464492027416906 0.87130405223273011 -1.3655507312802158 6.6112453033540213 -2.3587665117769809 4.0534665250528601 -1.763573081727444 0.47023245299893029 -1.3373794448804113;0.030002132172381707 -0.82590044624144676 -0.11688605378972799 -0.27751411327750986 -0.64736565804266444 0.81468434902019848 0.99272944285747511 -0.37386183912898124 0.69079359178923117 -0.26968702858227733 -0.13393119430588804 0.74885027664531534 1.1777277073016337;-0.79814455778333149 -0.14173707644978076 0.29348814783864058 -0.32057513223442669 0.66565282787990654 0.36766980846908659 -0.83816946988941643 1.4841588263569332 -1.1386224622801249 0.027585502274251543 1.2824600530104791 -0.86359189441760698 -0.050617522702278185;0.11352972326917218 0.014417840333840732 -0.25726064266942816 0.066671020539087897 -0.96970237100315004 0.16775997620266783 -1.441979539270269 -0.27235603383591511 -0.51102767796028348 -0.14426352802440037 -0.88252152340651768 1.5921458658744949 0.95971800813515795;-0.69874625126850465 0.017838501678056042 -0.78237865255118344 -0.47069478256383646 -0.47729403106024981 0.75687542417843012 1.0523740132779658 -0.64682314343044944 0.95035496574431277 -0.21527095641604554 -1.2181039141837788 1.1150780551992707 0.89594797931523706;-1.6852844117294237 -0.69487180287619355 2.531040516204528 0.55383455892452227 -1.400354182738156 1.3340876823369492 0.77408239087811448 -0.66658143836498329 0.54306647314236323 -0.58903988065936208 0.45000061987999851 -0.54294969873761134 0.085584104224778995;-1.7855574541565353 0.02925318246642028 0.55033208778515375 -0.70371662488813702 -0.1726057565207319 -1.4254026320288871 0.45450931449139154 -1.594088773829083 -0.23024110350502364 0.71946273782566017 -0.82075946156551061 -0.59003749195465649 -0.0026459036849482143;-0.13529760046138042 0.17000469629641321 0.43487983293368998 -0.61131782099374921 -0.10416103621527131 -0.27771246915760428 -1.5503425475633434 -0.58273363376082876 -0.11022494418823411 -0.24204078890049116 -1.3296072752482844 -0.094139619832318722 1.2341285870387229;1.0200160038178245 0.01702096916983712 -0.076178377637403649 -0.9911820225964677 0.5931554422171984 -0.8584748438090033 1.7440747690924043 -0.88113943192176825 1.3284871581546036 -0.39033396334530107 0.57239833635242376 -0.57669160693323773 -0.35650439117358607];
  
  % Layer 3
  b3 = 0.91037018211279463;
  LW3_2 = [-0.5543233907199554 -0.15222465325164455 0.40243851880098924 1.3158102382294445 -0.19192484159054596 -2.5690378618777534 1.0584517557070432 2.1383106616768601 2.3178634284813313 1.508029451217362 0.25929289659028054 -0.28754878007132295 0.93412822641683069];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 11.7647058823529;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
