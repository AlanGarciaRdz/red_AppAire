function [Y,Xf,Af] = O3vallarta12(X,~,~)
%O3VALLARTA12 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:54.
% 
% [Y] = O3vallarta12(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.12820512820513;24.390243902439;0.02710027100271;0.141843971631206;10.4712041884817];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.3465838655524516;-1.621486622426028;1.6313564093881996;-5.484325449531716;-0.58549511406631471;0.59850866324848317;1.010708990584595;-1.8900924145289932;1.1870555357144124;-1.6850065923948692;0.21365770336734669;-0.015944793466319301;1.5071528235882661;-3.0448897824555341;-2.2503372267182296];
  IW1_1 = [-2.0808432946448323 0.29203529584304189 -0.64256333486873696 0.14880260873870899 1.0704476410421604 0.16620038592742309 1.1804172475450834;-0.28854907795938434 -1.0536904141154209 -0.10029643402399306 0.39519842720527887 -0.21800975136909251 -0.083641950580384386 -1.7396615486804594;-0.19614863690317713 0.034576669617894129 1.7423854238535581 -0.19417522706337459 -0.87940070789816915 -0.95380081744359335 -2.5654956333441863;1.3942803697232025 2.0161795766659885 -0.51351695005273901 -2.7202076825835291 -1.4728567583156524 0.19842443462202386 -1.9661459823618028;-0.89686437888053216 1.3240849108257133 0.54872648319128292 -0.99019193029750197 -0.20488839500368608 -0.22925530861893942 0.20911925709048892;2.0218659970051149 -0.15455512426006876 1.755354022162225 0.75549841080164215 -0.50853002307404216 -0.093119022091777442 -2.5914730575397216;-0.23948010063537498 -1.8227406961631014 2.5592494969280106 -1.4678327618334961 -0.84032220293366078 0.099831580475484891 -2.043174990586039;-1.8421905959792482 0.26113979179156194 -0.088074652305147633 -0.27625029748519364 0.7382557023836358 0.10150924453176215 -1.5900514734599485;1.8817191223824672 -0.087117476518662029 0.33748283629273568 0.34238758852001233 1.0303257438632034 0.02736568749789374 -1.2597671084299027;-3.3475296533577947 -1.4210520180638351 0.11680490376097083 0.73623164223959692 -0.53620120012034911 -0.54076219675395221 0.94432578430109537;-2.1083554884123705 -5.9266585018971814 1.4158725447382745 4.7430111579853413 0.25919088571306842 1.7572132922993431 -0.86710291773787984;2.3065180319862488 -0.058665038402777814 -0.026333657996495015 1.9133249890583295 0.29301944808770469 0.0082537925223378234 0.44421999099516596;0.52429001712673495 0.67272405297759763 2.1283989951242197 0.57846034487058695 -1.0041855261468144 -1.0391479107320343 -3.094330220105888;-1.3180641283745844 0.22981570280892907 -0.57979064525095769 -0.15732734550133259 -0.40370419932338752 0.022206440379907447 -1.4894538837581666;-0.35072786789258831 -1.1859531813867588 0.63156791355787001 0.75541729418158166 1.3640023442387208 -0.02444164802418065 0.60334761456744634];
  
  % Layer 2
  b2 = [-0.44310656979044555;-1.3289474016062939;2.1868711789832633;-0.50409185615540442;1.7345789874367754;-0.38357799363207734;0.2615660476131525;0.31181342953215668;0.37206714433200722;-0.21226337346036256;0.30079193470598131;-0.8689231208514504;0.65002326804217692;-1.5874778284400655;1.9228654300341628];
  LW2_1 = [1.7158425055587552 0.16030559418767931 0.14165696752896159 0.90237106378414222 -3.2330974838911994 2.2133911053829456 0.41387569461069162 -0.92690003223753503 -0.90493486066969142 1.5249344404426011 3.4307408844584417 0.097851967892836691 0.67586256364227748 -0.94892620714054821 -1.505897362916631;0.31661822535240602 0.99569573947483003 -0.65886225921358754 0.071779762493221044 -1.6313123786635229 0.11041801971544322 -0.73810699250770762 2.6931099785603618 -1.6450790025843722 -1.1151344148791655 -1.3350935367813623 0.28308835512199376 -0.0011133150739528301 -0.57389158149032404 0.46394822972147975;2.0920511296099518 -0.14554459425950367 1.1388787392027739 -0.54508217817564275 0.35422381510104051 -1.11224341470469 -0.028462416132710722 -0.78908636511730823 -0.37115808750243118 -1.9249369228953235 0.78735994006537335 -1.4201189581825837 0.14019354008741919 2.4483364232570426 -1.2429237258684183;0.73309800486447485 -0.78849933090573232 -0.6008921613234971 1.0978512030968137 -1.0275525341419092 0.16868875976122724 0.48541990846951288 -0.87660054309756286 0.19968942884343843 0.44232192213899746 0.83824731269395314 0.9677839289740362 0.72502621419400182 0.23886084756154266 0.24507007382983798;-0.72132474955942361 0.095188578224924436 -0.34627344318729358 0.6733076551755165 -0.56182368093373258 0.17523544976512792 -0.73243773728874817 -0.27527542787574577 0.86296354693439814 0.11742623625177612 0.073693662881108027 -0.1624115691424019 -0.89097588348157941 0.72801456623666638 -1.076148944842388;0.44573313619788729 -0.16106927566973606 1.3082855494931518 0.69324467843921334 0.76447999658355803 0.57838048367766703 -0.57681090368183052 -0.74213388071857045 -1.0509732161741441 0.15831776941546361 0.055955620568780173 0.2534957983086259 -0.24077052547333413 -0.78510652013810589 -0.10597109996774673;0.52361333205206417 3.1615641619751242 0.29557008106493843 0.28437948779726463 0.24621190452749267 -0.053021755170302942 -0.048565141116975921 0.50442662534052329 -0.54194783968903204 0.69806576973891432 0.74078670558877324 1.6599673464695177 -1.2585375457650267 -1.1812276427198365 0.19752432885664181;0.9264934082193429 0.27602890993246215 0.70048704518953964 1.0863576777683872 1.3641295834440412 0.53597339150341283 -0.59128815419160086 -1.2973553393666624 -1.2095815708604289 0.22298336270798852 -0.33748957042538796 0.44083728059947819 0.11437824761960239 -1.2130100289728614 0.20463119576218419;-4.1928077451563537 0.38595215105197117 -0.84356657809894353 0.42188500590403694 -1.0369479580160437 2.2500926575353364 -0.92246995255441833 5.2519135772740357 4.3562686156040806 1.2665414743270964 -0.41395545612458839 1.4961998765691997 -0.27218566742193112 6.2091896345129705 -0.73681350338621454;-0.68315435432936045 0.35107365495255705 1.160178749692574 -0.73130310498668627 -1.5292721801748794 -0.40352078172428396 -0.10150863147418465 2.1657510386770911 0.75217638099001149 -0.41319710302590629 -0.4900826611343056 -0.095965001952413712 -0.50526477869263609 -1.5938052572814705 1.3366539108504214;-0.28283901119206933 0.48897067362587698 -1.1560209834135726 -1.0716055237785933 0.87417231753440217 0.01152252717878002 -0.18324731268345765 0.41838654523566976 -0.18887363040732583 -0.93760809040878001 -0.93499829297076609 -0.64443843848364801 0.20978229020483766 -1.1626172250555404 0.60082319508647231;-0.66411046811333241 -1.4008921624046218 0.12767406244248841 0.44924942507124183 0.1992029579791075 0.052468704807397459 -0.50190822074209485 0.20735454977512566 -0.050109088116904246 -0.6874063938227114 1.1220055356897112 -1.1969623487302194 -0.60309943082038531 0.59775351887752115 -0.54295768425396718;-0.096590074910982232 -0.78857124536405721 0.71547840377529448 0.45636227141097802 0.34674732209746995 0.45257285493278915 -0.47028809032430335 0.17711999791220798 -1.0406574074317692 0.035826494637842113 0.47457074788531017 0.26005317722207039 -0.38823546629776351 -1.1827672322657745 0.49208800301998296;-0.33750287506332777 1.8672513522801548 0.41043178066530212 1.4812991508589011 0.49497187035325307 -2.2989381067945716 0.5944222958894454 -1.2473392944289117 2.1885309067153829 -0.18832981931956477 -0.13366015702406323 -0.10942066584261501 1.2607028320066278 -1.2618422875474729 0.097569335458933842;0.067679457509724206 -1.0065854416844402 -0.13692077332552727 -1.0196877493710241 1.6009757194002867 0.55093058265355799 1.0011065812714948 0.22311851273338082 -1.2072857556243464 0.24648947395641163 1.2047056204951978 1.3645075286220754 0.81043634374027462 -3.641881902765606 -0.57560126155992986];
  
  % Layer 3
  b3 = -1.0487184158425435;
  LW3_2 = [-0.1284765659737033 -0.84360866756293984 -1.2874867650289001 0.9633291743125163 -0.55579982496466906 2.669265999784264 0.90410444274521662 -1.2308567494470135 -4.4966768104648747 0.64117698176350046 1.2042532888846018 0.80740101582237522 -1.5529104019567264 -0.3613817186472269 -2.4389878077457374];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.4712041884817;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
