function [Y,Xf,Af] = COLomaDorada2(X,~,~)
%COLOMADORADA2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:36.
% 
% [Y] = COLomaDorada2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.290275761973875;17.6991150442478;0.00572573718866304;0.0175284837861525;0.0546448087431694];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.6404667471894194;1.7775907823905819;-2.2070147213138611;1.3443003666470645;1.4437562825529264;1.9716874937615239;1.277442666233201;-1.5405631875488748;0.20822820479044585;-1.0737526110969176;-0.40683008331830955;-2.2251824022043674;0.26525516605148386;-3.5479619095683037];
IW1_1 = [0.72619903247474549 0.2445542577428664 0.65520389058265893 0.66530635430751506 -1.3617397987578193 0.039785500439211724 0.86760848616239272;-0.40540108453253543 -1.622526360697921 0.5933228402722317 0.81956700655942916 0.51731336025874786 0.11865812150396859 0.78177044796942408;0.66758751398754479 -0.16468880346024783 -0.46388825920214671 0.087263015552133366 0.43821301862440043 0.13227659153180396 0.88396305616770543;-2.0000324037038579 3.1531221632885247 -0.25453511986845251 -0.050884926395101587 1.8514433937103798 -0.22881139900565972 0.86943409758323709;1.5264996210347337 -1.4780050473923865 -0.71006417298913971 -0.47872896554586597 -0.25989262754565007 2.1382806247657435 3.8703642892524805;-3.0070127666618198 0.43102058751381372 -0.63037757433440222 0.057297252341849091 -0.23259006397609794 0.28985933170208683 -1.3025119956305167;-0.1831624581408689 4.2183512964616083 -0.48937169635203071 -0.54214126319571809 0.30169491819927452 -0.14157612089801785 -0.38453751045756174;2.6196342877784136 0.080161150151733182 1.6717062324644458 -0.86475783352775004 0.75455428423436566 -0.86453873365019585 0.13342787594348612;0.29286500544234995 1.1139153055154583 0.86981251698634754 1.7567275227556001 -0.53452214769546624 -0.35278690950957231 -1.2122937079991547;-1.167704655930428 2.2363043201940207 0.49809953222570053 -0.54820268122507421 0.19527872517912093 1.2532635680964663 0.53083960105147066;-1.0966733253219054 0.34051340112053102 1.0777877152138642 0.21696364276787439 0.97874981048971876 -0.84153187747325586 1.2442252029243535;0.10083199817101551 -5.5970227805897919 0.51897192984390661 -1.1721593387095555 1.4598489241997807 -0.63399294493587055 -1.3455358207022448;-1.0382925827990142 0.33238317477378798 -1.3218974811478197 0.0049377870847501929 1.3691345730050262 0.08566518168664948 1.6135270861557167;-4.6620971980783779 -1.2701340741057199 -0.29613806787803831 0.01706275100536582 -0.26563628632888786 1.0318663663065972 -0.055504589787208874];

% Layer 2
b2 = [0.97811119541964286;1.7260003506012034;-2.1428942933428865;0.35919437295569062;-0.30833410660672989;-0.48788656380941353;-0.1454563428415569;-0.042224618276559357;-0.92644721703526389;2.0154226386180771;-0.58591058261729623;1.4537853161136371;1.0159480182554663;-1.4900025238268859];
LW2_1 = [-0.28113833848390546 0.070511996854747905 0.82534580243689859 -0.7781731191974125 0.55194888646604678 -0.75243536043452397 0.15231551236123045 -0.35142336805635505 -0.29285925319978234 -0.15011929313712805 -0.32950248823246703 -0.089827991614626151 -0.65070800931482575 -0.11518403841462876;-0.53639360289960925 0.120681995815818 -0.79688194402161572 -1.6016690036715955 1.5531743039238259 0.56890871840710588 1.1019107532924379 -0.33622406779785163 0.37766201992966442 0.51972757047279927 0.09880736828909531 -1.4135318418437912 -1.3205677082035467 -1.1134824139933492;0.86607480525349834 -2.2147833677793649 0.39553076223826306 -0.16870598516111224 1.7135678548712567 0.010858497558134759 -1.3037426426725447 0.40221394255440818 -1.2444362756333085 0.55551820030742305 0.15591827912837558 0.71444080151532585 -0.96590744270692841 -0.4600257409982626;-0.44232528923052394 1.211980116629926 0.83343463112566107 0.27524359774436019 -0.61712704733589641 0.37183535422904596 -1.6120088003708413 0.51854722225440142 1.3725150593329596 0.59415536074010222 0.30050216660866796 -0.24024205828961276 1.9285277678164654 -0.1224925188004178;0.37096410723197931 0.22469928605811873 1.3729674776129646 1.2501405555537402 -0.6308637608339267 1.4823474295173449 -0.37909550033713579 -0.015815669773378255 0.33172342589772102 0.28705402368894051 0.61277092659545807 -0.61975689260011102 0.60523196173805316 -0.042756499031480891;0.2595119688181281 -1.3610524506171964 -0.91566580217525673 -1.1023306199944656 -0.049921431486391402 -0.27448093566702136 -0.080292277481368329 -0.26593071637066362 0.23170798320316588 -0.42885578821456249 0.49715816338093688 0.06653156771758742 0.94332568308005404 -0.40389846669615831;0.017966458982592078 0.76587856739415594 -0.49874531680468381 0.74740918721266825 -0.55854777638987363 0.36571611202351256 -0.56828812020129937 -0.26054839405770519 -0.1644703370504132 0.42820106365187677 -0.41867992830832174 -0.60626161690946423 -0.55841735230550216 0.604880272256619;0.56813931791270234 -0.25506481806461678 0.32534480548458716 -0.28142214438034391 0.22567575119297853 -0.010880668922128321 0.67727681531287998 -0.12279595008268106 0.25199863779063059 -0.032213242489283922 0.42950259347220598 -0.99562961962656571 -0.45019046598800055 0.22849919424071108;-1.6602777717490109 -0.80222172921489687 0.83142554256029222 0.29581740184455507 -0.25569745891305845 0.25345559267963919 1.192276998554376 -0.73412306797587779 -0.28297333090737331 -0.55574006961045419 0.02378865781363363 -0.72982560321089107 -0.10533549502397613 -0.33783213312497251;0.64360159600614963 0.32358581181793594 -1.6336576064145176 -0.94419794841199212 -1.6183115905719152 1.2151901319068432 0.94639251111304923 0.55427373032050276 0.083644840464849185 -0.0097947726090407451 -0.38331662594181937 1.0912494857445429 0.80256732565584854 0.74978630070553687;-0.89389997689890999 0.40742221592183131 -1.010223782490179 0.53742626188065723 0.11532431237222571 0.063338254517697812 -0.22483718643541489 0.41358060046056944 -0.33170261149148789 -0.49376094296651779 -0.3426283828648467 1.5968823496875584 0.31021600307543989 0.2946215400595541;-0.51736661450062971 1.4041057427455317 -0.5416320856875505 0.44595299462110738 0.18587059398703809 0.16667903236427509 1.0660193756976712 -0.099220482747661362 1.6665616704048523 -1.0693472923543723 -0.62701187980907191 0.32963037491534397 1.5171842937331443 0.46545871378754211;0.55568542873247417 -1.6256306771121574 -0.19140586994500913 1.2334843280261738 -0.21870719644085554 0.014878895070253251 0.70901271209916672 0.20548007538931526 0.36262450313810124 -0.70239379440031047 1.147692813533254 -0.053957138066059965 -0.50332144323157013 1.7804934615352295;-0.081589430154736617 1.3280025275804102 0.30501780678299961 -0.56344654706901443 -0.39067722965300516 -0.13374935847009534 1.051106246716593 0.58306259647708392 -0.31490113605846787 0.92097142988347824 -0.79986915723167606 0.84335805016748466 0.81963709294881115 -0.71716289953508505];

% Layer 3
b3 = -0.7650258926351694;
LW3_2 = [2.01338193337173 -0.92861264582197511 -0.7589792537800687 0.32436996362415971 0.97239787841849368 -1.1803743404129832 -1.289134056783644 -1.902243315137276 0.39691769809989336 1.1394284658926086 -1.312236043500544 -1.2927105178140823 0.74457652429882815 -0.59507389625086482];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
