function [Y,Xf,Af] = SOXLasPintas21(X,~,~)
%SOXLASPINTAS21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:47.
% 
% [Y] = SOXLasPintas21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 13xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;4.5045045045045;14.7058823529412;0.0179856115107914;95.2380952380952;0.0558659217877095;0.00576368876080692;0.212765957446809;166.666666666667;45.4545454545455;29.8507462686567;24.390243902439];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.9086052227753487;0.91731516253334489;-1.2725195508488678;0.30880870869862936;0.19152851761074161;-0.014912707344290177;-0.62791550675454022;0.46829289384630801;0.5031434351883719;-1.2945099304914538;-0.56172533604336972;2.3781768761489102;1.5513497984486071];
IW1_1 = [-1.0263755358169475 -0.89020921404622277 1.6250106609470196 0.63652979798829068 -0.47331096582389143 1.1247105477837351 -1.2866857660620519 1.2970607532062712 -1.1031156353293772 1.0589949361141859 -0.85938093660358383 -0.25557835143280921 -1.2333734155138361;-0.58343290207065535 1.0724107298369003 1.0771359652826771 -0.1800627533665542 0.33824857158686061 -1.2293465498301854 2.4362435026432481 0.75752921250943062 0.41471255376850658 -0.42211403597187952 1.1882596250150168 0.58524611731372467 0.91311226391497802;1.4955968715953416 0.25075160352042969 -1.0450106993554455 0.53622959093680556 -0.65094358055700585 0.4469741173042735 -1.5279095444191857 -0.068187732642558813 -0.56156758566305376 1.5493266058738075 -0.05201427086129521 -0.35029928590713844 -1.4847334375301371;0.49882633607370475 0.40748049875038594 0.26870299867536157 0.92093131929180916 1.9176835929349403 -3.6348163518066445 -0.29977766375968018 0.3320047745830742 -1.1141655050974704 0.55224704245872702 1.1058167146807292 -1.1090117779347739 1.6802306843344814;-0.013688416280665274 0.085050185657685781 -0.014934079338760516 0.52039933017342699 0.22151094168079177 0.1709438646519468 -0.9521960050197763 0.40934729510123741 0.45579066074388386 0.48827001187060709 0.79070836144953427 0.30818055895836549 1.0957886317448131;1.365032795348176 0.0061211046395379387 0.17961143282246794 0.072030425659672381 -1.2705136912251132 0.74465944941706641 0.94670164262761558 0.096190048750043972 0.3514333155173352 0.63087490839739835 -0.052474768446365644 0.49114335916831464 0.16889162536994798;1.8873041237184174 -0.24058785192071067 -0.11966667258880645 -0.76639099847461711 0.16999844208637133 0.80073338248829828 -1.2809197699201307 0.21087165735455973 0.12938655239106836 -0.69939560670762169 -0.062345569846032151 0.98727800947200051 0.013665211582432349;1.8884000303624049 0.1462627698537281 -0.59850662972125646 -0.49850455943700611 0.31967298967103408 -0.059301491253441196 0.65906159870104475 -0.012234274923579442 -0.27867219472429139 0.79477348563891936 -0.37679402698423425 0.13902998987584261 0.12473795320365912;0.30864713643949526 0.10172546685297072 0.80069356664224434 -0.11997658182912771 0.49608632765978561 -1.0549043466849024 -0.97222069814722012 -0.1458344082431923 -0.16822807217010419 -0.44308166348828659 -0.4914318962706723 -0.93338593697204053 0.42355375144883822;-0.0019561519578138488 0.0021964989605763041 0.5533015745201898 0.72088925859832087 -0.57872731496234509 0.39418418772854508 -0.22154639318215705 -0.30966087878736248 0.30053510597878763 0.79115405019150153 0.4737565574754779 -0.21776440204774777 0.51644727971798177;-1.6409973189873206 -0.06858471135715194 -0.35231222928285955 -0.56494654686109502 -0.76071166236271792 1.5049845008265372 0.21302266342351009 -0.15820194646968622 0.26223579720208401 -0.0016658980165193127 -1.7302100802246543 0.063874884751699029 1.6199131565157217;0.73463810484970071 -0.25469622925075341 0.59964796609609428 -0.38860601737042255 -1.9964588403317647 -0.20457198258559117 -1.6806293856208654 0.1675938314128895 0.25279209146155646 -0.032763907446449948 -1.1209295264048074 0.33909227237075634 2.166390488411801;1.1227360904577484 -1.0934989033863491 0.47594616577332166 0.50604195138792174 1.1471387847307923 -0.92167098244514101 0.39261774608422095 -0.62841456790711603 -0.14256671397115514 0.39771603028071567 -0.5532544833587576 0.86482469653222327 -0.25749393801941167];

% Layer 2
b2 = [-1.7311377898601639;-1.6800544968374282;2.7473102607926516;0.68198849491280145;0.60785868589860814;-0.30841895116725448;-0.29345335868390454;0.81675873264025012;-0.36837123706005848;0.94179134099309092;1.6533273438283136;-1.3345770993336468;-1.8569557407970321];
LW2_1 = [0.36890650958051974 -0.43977478906477185 0.22509882687651794 -0.18669075202356661 0.23402417574209594 -0.23860106207493337 0.44949360313841735 -0.79626757371833989 -1.0427316858428151 -0.47811734363717806 0.35297620863659773 -0.8150897592104982 -0.039746082989712592;0.2892543505934132 -0.33848079226803851 -0.074390508348683881 0.19174807017774223 0.31240259757045791 0.7691564257645217 -0.076552529358712817 -0.52017444764595966 0.41530300190463104 -0.27811076331766282 1.1146119146931517 -0.54993912817686552 -0.93903222223916949;-2.7439471598969023 0.8695287433270803 -1.1060611142268824 3.7552411657723672 -1.7670374128786588 0.72203282538145364 -0.30254733084070456 -0.81402940830577131 -0.22885494200756487 -1.6796196400344898 1.7819897686818273 4.5636406730331043 1.7478965564632638;-0.29761770162093742 0.85123740749401666 -0.65157022870978898 0.10541381639069065 0.73668280596970459 0.15423051052252154 -0.56645833833742953 1.0554212197877362 -0.36274810085573272 0.60116595876679968 0.018915666587847105 -0.35301591380164316 -0.77120869780869206;-0.69909820060229733 -0.59885431878703899 0.070881283478025359 -0.59721479315009185 0.60809393802114942 -0.27551688428207516 0.28271521923420745 0.0097370960376815252 0.022504167429793165 0.66871370840248023 -0.97371202867452999 0.30251019177080407 0.067818329792569854;0.12679271756662486 0.38377913207326225 -0.36138992671675257 0.20123140492532543 -0.53204295705469373 0.54809925560827055 0.35219289915585783 -0.8433827408465786 0.020538911305785341 0.7285540571460134 0.34471000909899607 0.2470917524380758 -0.10651495647466008;-0.49421321225226605 -0.028977577212966177 0.51498055634527029 0.67339093123415694 0.12393890525281538 -0.28763791896332769 0.09371840520779029 0.037653276317184126 -1.0934540996803412 0.70562921026377967 0.62766711524556096 0.93862363605948229 0.066655636118096717;0.5695816915089863 -0.38372302805876607 -0.77410035960613266 -0.63677142668893227 -0.45268015427939257 0.74772163127112168 0.3375138165668507 -0.68654323409054607 1.3483710511846114 -0.91906230738569583 -0.84042819000952529 -1.2495891221037185 -0.58351669135400586;-0.16195050483619017 -0.14577150312739812 0.81602685403879449 0.60627016193083794 -0.97351037217052749 -0.087027230155880195 -0.35419009409698565 -0.58126501504913719 -0.80502246958673662 -0.57979019195499326 0.042576935113011569 0.29501387502517179 0.007886820391523261;-0.063998267434007189 -0.51747089852983408 -0.56345314661751489 0.40173997044905474 0.51826294728963729 -0.53951512328128448 0.34571087688198004 0.47403362356097811 0.2802352710633465 0.38376829967430659 0.398973438570282 0.19503319039843217 0.75277371373093493;0.39776821927240097 0.17294409002079167 -0.00042740749599277927 0.33270266144410987 -0.96177124504301281 0.13196781078481629 -0.013227949735785227 1.5179396974767496 0.023027072692483469 0.069830033854962267 -1.0041096254944222 0.88958877255258906 -0.62751896511187977;-0.17993453752380575 0.64455841211357123 -0.87649144493826991 0.0052349959767708874 -0.85663550032659219 -0.45104854355505997 0.37456434371552383 0.51560872346865994 -0.6535997731107458 0.035939731962719233 -0.18244320800644273 0.13134219772369646 -0.11202312613358854;-0.32127135069668755 0.18696160124092387 -0.6274481819176928 0.35117315389449311 -0.2520313178747533 0.11132890271642396 -0.37708379356424532 0.66473933401377883 -0.37247673850846735 0.88059274417083233 -0.35554856040932803 0.46244103905294731 0.061033009170667028];

% Layer 3
b3 = 0.53376377727194935;
LW3_2 = [-1.7639915600562825 0.36881939565326061 -2.63882896935494 -0.12977497218135597 0.020894641620540243 -0.17359188611191984 -0.93462017855072532 -0.87899888995409636 0.11260398584645982 -0.030479017303940027 -0.87110364627115777 0.26866336933125118 -0.5308532667137007];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
