function [Y,Xf,Af] = NOXVallarta7(X,~,~)
%NOXVALLARTA7 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:26.
% 
% [Y] = NOXVallarta7(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.3249117060149294;1.4527815537379316;-1.6622794098509925;3.1724796147484469;-0.71805279333447569;1.6135007184991914;-0.46874676916487173;-0.058082398403607259;-0.90689464969561595;-0.81497465548657788;-1.0218819407212107;2.0126059026927963;-1.3001657932312856;-1.3893224518012703];
IW1_1 = [-2.3345690037330029 1.0400266370443392 0.93277364737254786 0.09129885025248588 -1.523666167982346 -0.16555570436795902 -0.30314986535399979 1.10541927988028 1.3702095843720059;-0.60258053302091086 1.5585133355141811 0.12642527614318164 -0.078869763594438175 -0.2241983053790437 0.1927202399936114 -0.18460633164494711 -0.93026068639118409 -0.62595396455424401;1.0883509096248234 -0.29444875521129726 -0.92524804365262925 -1.0035530888258788 0.33988277642251968 -0.0058420816498433899 -1.3633250275057962 0.34231862800741253 0.66382098312649007;0.049942781855728542 4.6962313799689825 -0.17659414766868675 -0.61319394862900589 0.70020995550941978 0.32852981172464074 -0.12491345937345993 -0.58953065378616276 -0.17101196502526081;1.4564362967050368 -0.031409705834014111 0.69206985719010183 -0.64512602332493485 0.39277563939441296 0.35609077209666884 -0.90682665038876276 1.3048451350308117 -0.77343001837282865;-0.20476907684248935 1.7864314685920226 -0.96774306390975928 0.3254999432263106 2.4253800442754381 -0.95583278291663121 0.17072318149817725 -0.21147134356257802 0.59119599851803151;0.12312772514732173 -0.72502994803634901 1.4087793613955839 -1.0474123238601347 -1.0706133176399066 -0.95770012731705401 -0.35279986528870821 -1.8662028119406302 2.6301549485352465;4.8785188301808722 0.79222044510432077 -2.1359163270449204 1.3024722476393893 -0.71784719174600176 -0.45834784249228283 0.23563164592174365 -1.2818678180029832 0.1191723587194317;-1.6920170673465473 -0.65397863772947695 0.80403900578370779 -0.87976458188450668 0.25476890924307716 0.022864754412760098 -0.26897646248080925 -1.6503148335558124 -0.54757470674887809;0.02483837289648691 -5.2006782615406033 0.14946584373931793 -0.18084453935193878 -0.22194324166605031 -0.38002039859833814 -0.16027110465421054 -0.76682732380001317 0.52558818716153644;0.2439812870703687 -0.26991727616379924 -0.5449660467589279 0.66677610817047928 0.046154995458396367 -0.4317163136099218 -1.0375555860502903 -2.6597141543048468 0.43999314192252337;2.3416962855396948 -0.33336361411310445 0.60329227900798854 -0.45816672512312834 -1.0334673190859689 -1.5073117087847248 -0.65700949413563758 -0.84235144526219508 1.1225624527401907;0.52936914266938595 -0.82384745310986773 0.0058319085551809188 0.076102959593577602 0.044133672067539417 -0.20151885573012177 -0.25155819183109562 0.16843181093230547 0.46791707443808472;-0.25943009410479567 -1.359347988285506 -0.80903437458625638 -0.21316839053390171 0.15979146518112256 0.023011323458798749 -0.035094907817281154 1.0252573945347758 -0.78941784985273511];

% Layer 2
b2 = [-2.9902298501655538;-1.497140215749573;1.0957829508054129;-0.23664412545001068;1.4308330254596839;0.29494967847946607;-0.63172566803313124;-1.2357912883084032;0.48433233597011704;1.8120044718888288;-0.89708382280330268;1.873282589911726;-1.6293021378901538;1.6155684572723432];
LW2_1 = [1.2489991642084708 0.35115757488217592 -0.44439257204106597 -0.76304039671868418 0.84366969205147424 -0.43326094630286965 1.5374466701752227 -2.6457581501615612 1.2955704125625196 -1.8932350338674915 0.42524452221958242 -2.6382859256021227 0.043239275320506899 2.2596930177658305;-0.078505580335152481 -0.48196081702195842 1.2751707569969102 -1.1547431521447746 -0.97292499688429412 -0.32127166868906554 0.68868876009367674 -1.5779672262957887 0.58155018608790987 -1.3507396728122896 -0.79201921682637422 -1.2802063883947297 0.68283005863438417 0.3060073858646063;-0.043948288335912258 -0.91386266751854528 -0.042495087909349638 0.89215778557203929 0.49870183071674323 0.25674354759938928 0.19920476291014166 0.38725941275543302 0.78149558927399421 -0.65565742556812867 0.10190957839545979 0.20696742613211044 0.0089967336625657104 -0.065015270493490873;0.33753936231478726 -0.61096031336963363 0.26329437956756452 -0.052570282284960114 0.5842172864913685 0.60456003433176142 0.2084476091721465 0.32867221768404448 -1.1378079636285552 -0.82474999661964343 0.46918799284480184 -0.44743994561003742 0.65864992500017472 2.0195195538471347;0.68605694705698828 -1.6383755053337761 -1.7043151779980619 1.0698616594874302 -1.1071192048808358 -0.058724413982246072 -0.78255045042913207 2.5013877204455408 1.7735468253185369 -0.79723316809447187 -0.23735910745833233 0.86614988602002818 -1.5746731118000235 -0.58284729134402613;1.6811208848682266 0.40200628100642022 -1.4881582673537761 0.70475397425818587 -1.4694643757675492 1.5260890898271136 -0.12477807224820481 1.2014311990775253 -0.44037253453867931 1.6711457115024271 -0.66986936663768282 0.10782637889070179 -0.52706324675978866 1.6906691948614798;-1.3753326739036036 0.65004105366205622 1.4492426912114107 0.42575322306437113 1.420756235555154 -0.84796795620425591 0.52464643575186609 -0.98596014590216696 0.50604340339140708 -1.4534043473662301 0.87454640578230047 -1.4983338292851449 -0.32242917474987448 0.51128306355083497;0.49476546014332223 0.23561539449980065 0.43556007558682519 -2.6099693587964103 1.9400304453243074 0.48041467044611752 -0.38625803795190616 -0.50155580224632168 1.6964436222944974 -1.0275928618585779 0.81645620923661189 -0.63056000468808593 0.10438368286102462 -0.016251335743467016;0.018055930922755942 0.40403959802785255 -0.19701571122313496 0.20485049311384129 0.43544927068278622 -0.14525174444630598 -0.015468975437928184 0.17156336744023815 0.52391868464466118 1.2148609897289706 -0.44495812385823952 0.41507447206370002 -0.38682980987684051 0.59391159066508414;0.54560103248274128 0.46017161168176562 0.40770076912493408 1.2675471144552444 -0.71428435691127268 0.072961083479154573 -0.2516885424307313 1.0943497652893515 -1.8232267672503712 -0.20428806297440433 -0.33921113295193772 0.55244580308513669 -0.86733010254791676 -0.4649198066836342;0.24685541028072372 -0.45681093553879193 0.58797152866581615 -0.23447670457739728 2.1571528427083293 0.20643221137949491 0.63401303565119838 0.43775736211224392 -0.52229011231403999 0.30999375484425956 -0.25129963089709556 0.33415806650992885 0.67861083920296461 1.1856821236020532;0.31351783766287361 -1.8131575455687639 -1.1806455400538005 2.3002354579348938 -0.28348292112110157 0.27804837391823012 0.56609543912772253 0.35811523285442776 0.81472581996673421 -0.21265562315786946 0.71025425943545439 0.48322363539115654 -0.53819864358539515 0.84660297479944324;-1.7308319286965752 -0.24658432398674671 -0.075088193818538498 -0.88189793700274888 0.091414747221969628 -0.49281662247799241 1.3049340021450857 -2.9047678794280984 -0.45694141957060819 -0.78116474414132142 0.0029822694912683134 -1.2413300476506555 -1.1849793504336805 1.5118034664857922;-0.37177155706890602 -0.57608457294774351 -0.2162150962079088 0.53368562733885627 -0.57889627429275736 -1.2294014302571132 -0.15402954902078736 -0.19747154054384453 0.27451666516295858 0.74508631895086808 -0.094862654375325081 -0.2336789414292112 -1.5993654574749634 -0.26851736679148486];

% Layer 3
b3 = -0.72645176287677726;
LW3_2 = [1.9815171328371748 -2.2203428797831952 -0.086403345549409011 1.9912059126978012 -2.3863003110850953 1.9022264340420649 2.6337562622062336 -1.5784429618804794 -0.16859690922860049 -2.227235194805143 -2.5535877494440333 -1.9253848968533129 -3.3369842707166173 1.5644047876048777];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
