function [Y,Xf,Af] = NOXMiravalle5(X,~,~)
%NOXMIRAVALLE5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:26.
% 
% [Y] = NOXMiravalle5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;2.48447204968944;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206;5.12820512820513;4.16666666666667];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.837840974801783;0.81654138311516244;0.99278737023860719;-1.6301448703427392;0.90206945721153475;0.45239105057190626;-0.16078504422206316;1.4346212377590744;-0.26880904499259273;0.60233463964522205;-0.6212665116118915;-2.8078432192698877;1.4667976636764222;-1.8641670448686509;-1.8406972476374071];
IW1_1 = [-0.51315208134378465 1.0444857173949853 -1.176192069704892 -0.1339069494870643 1.8870952602237869 -1.0137344963477668 -0.18385520794917362 -0.23940083476530605 0.69301000936011603 0.24124867370462763;-1.9924111466057373 0.6995350367617349 0.48412904899480208 0.052566039859669129 0.09490021111170166 0.29583923131711831 0.22361522684416316 -0.56462958588625889 0.7660551640347304 -0.44140288209983958;-0.78129670915513061 0.4346644081386809 -0.5013490306218038 0.090428041126140155 2.5569505614488848 0.70735208827800455 0.55914072383923352 -0.55997897092618876 -0.71361445586504491 -0.23651764812910656;0.5314717399701967 -1.5076033078149069 0.6196752200742176 -0.35133396586497667 1.0012803747510335 -0.43397826879083612 0.48089386773811582 -0.49502281016562133 0.31786016824865282 0.26368402119793088;-1.7705336719493856 -0.5147810620234573 -0.75759222334326715 -0.58749606815837119 0.22548938342570016 0.44373544379133645 2.958374753540399 0.62418351962485996 -0.64091324400536653 -1.1638259380115621;-0.038353905822638146 -1.8050287345824514 0.52940594068801128 -0.046441438931590084 0.79846930442913089 2.7968732775604077 0.31390770035523091 -0.044107320159626137 -0.26190245907309356 0.64588759220423764;0.38268340263989115 -2.3069085466287285 -0.72475697673496131 0.16467106257123512 -0.042288829194104628 -0.78363449291965892 0.096548409528309675 0.38011851299367505 -0.21232736202920102 -0.14379469859209143;-0.22814453668455173 -3.8255327393860705 0.14052510971488766 -0.79096308772412338 0.3221471154159119 0.45383070249084145 0.14758428702672033 -0.24373826288764752 -0.24675604748648997 0.37234600098085002;-0.7005485617723034 1.1269349128877122 -0.42625941766300091 0.50083484950247603 -0.9517099761683212 -0.26277306918123994 -0.46349992207218388 0.40211278150559421 -0.35090000886952921 -0.3148618416785427;0.44832502205189262 1.4467641069849075 -0.36262966259642637 -0.16148511479362121 0.70487605013600885 0.61214816306730535 0.44044044303569019 0.13334371086226543 -0.39076773282981575 -0.015080865365916693;-0.37687709404336933 -1.4209106791012207 -0.46580474069100836 0.6461906514226442 0.21328327349122825 0.43980864077644322 0.36808135437365952 0.65841795140595849 -0.20623870328401137 -0.71011638533260246;0.25634473168155808 0.18724139156059946 -0.89786726421702412 -1.189040081571926 0.45424341068672658 0.3170740715848917 0.20593321541937751 0.36283788145093893 -0.90188054396790973 -0.4376883249622191;0.43131514474560512 1.0304790590906971 0.54854485455800894 0.033667679295757223 0.55052003241060121 0.27843760046888866 0.19278013003185721 -0.37203199067844323 0.25325468248370431 0.46598154869375424;0.10217868663667891 -3.987880541056219 -0.067207279417726445 1.0752987005465673 0.36414737642539918 0.39673706729045033 0.10341154998678084 -0.062714870381042509 0.068941881654943069 -0.2485277991996741;-1.6375159973640898 1.7168811930987318 -0.13038296084075351 0.0024671233085225598 -0.042474337840836748 0.93724631420175486 0.07205480029535058 0.41939613043009216 0.92360386160247354 -0.38831555489701836];

% Layer 2
b2 = [2.0992626232394658;1.8709486271158979;-0.76045649590874198;0.83042683648168758;-0.54679218778016103;-0.57567885199292357;-0.047394000967410643;0.31468758917645961;-0.76036142636131987;0.14805258627224863;0.66711444668729059;-0.80811894467648904;-2.7257319101121116;1.6421642559880176;-1.7629597070838716];
LW2_1 = [-0.20278607206404009 0.50271804360550143 -0.17869463190535703 0.76297872047042725 -0.66124907548199663 1.1458628335858976 0.1721921982903992 -1.1542748696905194 0.32088851951403508 0.17068829996609514 -0.1209623500460416 0.57531880177678651 1.2499388505371447 -0.43096570539009466 0.54685415980327012;-0.88390016256145687 -0.35204339677141866 0.37306387856380796 1.1701052114795247 0.63950832268980407 -1.1556971471010367 -0.31419807346991285 0.44576783394680491 0.38279338774177907 0.26324659628599906 -0.48331709690166924 0.85353618060449765 -0.11144334801153587 -0.29717533584515893 -1.589542952636178;0.67458316986538447 -0.20418550204763519 -0.98340117606033606 0.17683009757909193 0.77224562887537784 -0.6708117780176992 -0.060019809766065912 0.05472839753087038 -1.1433348210277245 0.83178344608387211 0.54338471401063515 -0.18889214111243574 -0.52809745094413441 -0.34400361606721014 0.43653534861502535;-0.85388877052147416 -0.21665263115617914 -0.033342382929722671 0.58751392644020684 0.3205267027286966 0.065427037486003481 0.87699207774534826 -0.74094715290339053 -1.8314358630803316 -1.4370703535390681 0.31353900703366638 -0.51388641569896654 -1.3287086399972394 1.0913149183053059 0.70208916710466407;0.39508915082663509 -0.016465378816231079 0.96540739318221724 0.31559455954991672 0.23454296673568928 -0.019555684933458738 -0.90873367139714012 0.4935329299291919 0.26609444762433149 0.087072404075320506 0.17748225834403583 -0.56335842514723333 -0.13114536605455285 1.5164496640386071 -0.74638361196327374;-0.36054444788745088 -0.30203012929747819 0.68094229087163982 -0.24580732756168461 -0.95175940993063923 0.62190902949592464 0.33634506302770872 -0.085927336316816233 -0.079839433464823931 -0.79105276436485406 0.7659611678916286 0.23170994725507243 -1.445535460585156 0.36023256093727174 0.39646993011743459;0.17908756449508484 0.64413418935524758 -0.33758711915840101 0.1554498587497897 -0.78215604598245758 1.2692637540531835 -0.26542002903864748 -0.77708908981579372 0.75407130578674819 -0.060536895627257295 0.2962736801575051 -0.56164822956070026 -0.75684513010484689 1.4208520008677106 1.3092176565593527;-0.1721035744061073 -0.25368063577539479 -0.15614537391897945 -0.40895855141141146 -0.02520928834727619 0.05418851017720025 0.044232660421385198 0.019708266370191643 0.25182666237620399 -0.56284746395225782 0.10647905532702853 -0.091380080658805513 0.51600606530520776 -0.20151509403518481 -0.17082373425256955;-0.61864272857930758 -0.23988184903597484 0.30421064783518487 -0.37265833321474062 0.47396516143575457 0.059073035790906968 0.37491965185917514 -0.15173155038262537 -0.18904411022527748 0.48485642417744812 0.12460614949889823 1.2600102784643941 1.1024603627113001 0.37496308369721293 0.70089902042610142;-0.54340341339749854 0.37769673489798272 0.43787359370479656 1.0882019076205232 -0.62116010200658089 0.33456458038743203 -0.10859065495637224 -0.054453474707407475 1.2738840754044254 -0.264229168706269 -0.24717656310050473 0.16459193620051943 -0.50220849841522808 0.69539361340406602 0.062004830891460271;0.45002269401799816 0.27464766527535589 -0.082300466414455098 0.53896518516570946 0.020135135290433676 0.024010704419764863 -0.36377639087981967 0.73149166751410022 0.39402854823327982 0.4619937422428686 0.022130675113536086 -0.530916404404287 0.81193154457915817 -0.78817746589335558 0.50210550127601883;0.15936448935201869 -0.58632947120981616 0.03060913941101575 -0.4078087222319951 0.62668902526762693 -0.18919489433401548 -0.55642799986995573 0.32523308052667793 0.31217093408324192 -0.51316451652031025 0.7163815185231498 -0.38302660929552229 1.4079534453972546 0.75065360706651729 -0.7043942029218383;-2.3879154544983749 -1.9288276697338695 0.78761448739684536 0.58886690452074852 0.2738091109146657 -1.0733165592999436 -2.0175892800319173 1.5502241752113373 0.8925400418371735 1.0747305253956536 0.017378520407163627 -1.2593499776613766 -0.085970485718608325 -0.26254580461037352 0.89268839301501191;0.32005103796941681 0.3715397480943739 -0.5067292276045855 0.6014921697861807 -0.210171186280869 0.81185516732303886 0.44944912947932092 0.23661202242199111 -0.58521145362760896 -0.99189935670995044 -0.68113320146924705 -0.24279470961403388 -0.28316959256268487 0.13387099632838495 -0.49381131013221802;-0.32212483333775993 0.3515181799839866 -0.49021185876466933 0.80823151209635391 -0.50442985704672638 -0.60185817056144941 -0.53436944082151461 0.27655093850104828 -0.043348702497115837 0.049002874045550641 0.44066017812856145 0.22062129546513948 -0.56072202024565554 0.34331335476889757 -0.37167791036037379];

% Layer 3
b3 = -0.59720092499065569;
LW3_2 = [0.13965921739384934 1.2520118311072663 0.47214255012120498 0.65422982813808739 0.69884633035976196 0.64835289854623301 1.1140845872677763 1.5362575520127184 0.22551828932995266 -1.4990584987354254 1.1519575477317174 -0.7961673730103449 2.4869497921867283 -0.15618093824801701 -0.5494260413552482];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
