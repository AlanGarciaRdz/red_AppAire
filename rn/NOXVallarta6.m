function [Y,Xf,Af] = NOXVallarta6(X,~,~)
%NOXVALLARTA6 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:26.
% 
% [Y] = NOXVallarta6(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [4.0877767508951237;-0.50401125628619092;-4.9632041599302985;-1.4590565078575759;-1.4503417959265894;-0.69770817081956338;-0.46480253393348536;-1.2665884626265682;-1.6898207882439931;-2.4538477220278585;-0.89342688405367454;-3.4180185246381032;1.7998215806380353];
IW1_1 = [-5.4199587740275108 0.71956686803619574 1.5514347270970532 -1.2196027668614091 -0.11831853561881539 0.015154406451424261 0.38840194959564994 -0.16124807233432314 -0.091917317370502821;-0.077961125754931984 -1.3532258733013307 -0.1098902453491451 0.11227882853713113 -0.18090783978437255 -0.043731326455869815 -0.10605639969455219 0.79706448886449122 -0.17683242056976312;-0.62619694906717138 -6.206629842591032 0.24001991340754142 0.16985604636359278 -0.35104929171978294 0.26179635666485879 0.2589598601828777 0.33111867936010692 0.047816148334990663;-1.5295964272556739 2.5669979560723375 0.79067577114821264 -0.20500626177607698 0.11701657373781815 -0.10034482595141647 -1.0784983188498471 0.290687223176748 0.42183098886248582;1.4291088895182669 1.6067991326473887 -0.16145628844859441 -0.88138895086310232 1.0838572282215548 0.94313337570876887 0.65185139722821472 0.45993848366529694 -0.54108123274363584;2.342279088010323 -2.2287071442987876 -0.67729024879450939 0.79122992127160841 0.56794614595511006 -0.63701536270746006 2.4375367665514074 -0.28633317351950693 0.40812406007578506;-0.63051466086365904 -0.75593853291402069 -0.3356061018131265 -0.0059921107867553329 0.53613864342544115 0.16346659367276631 -0.65091523571390719 -1.353816992476399 -0.25816798369009569;0.95844856509888787 0.27559650109914996 -0.4703400111017999 0.0048065258063143112 0.53528302021317686 0.08676029092588694 -0.72882880306368669 -0.99133637789915641 -0.34967013539834535;-0.48361359122950565 -3.8238296444266391 -1.5678307952473001 1.2697452825813385 -2.8192599038627266 -0.18359880198397063 -0.9608085289637609 -1.2616276069484493 -0.0082340886723532153;0.7827793127532171 -0.15930442112439522 0.23981366646559815 0.54883403280363596 -0.30435107096132369 0.83844609379637713 -2.8002529657577364 -1.1927131409147207 -0.45318323272439953;-0.28348146681669345 -0.25850606468701415 0.22090045585583223 -0.22214005894968786 0.61560952905215383 0.34961389861007536 -0.17152853956310807 -3.0034367671907907 0.27591176944087509;-1.5616523147337271 3.7582570862906532 0.232367202129656 -0.59599189297728894 0.023339109935730143 -0.021353726356429556 -0.41975028229585087 -0.20650121837702431 -0.39981221832110664;4.843382214691875 0.31643307429983547 -2.4532093013125387 -1.1569824622054963 0.44227738429289165 -0.1626085977484934 -1.1312264931820855 2.4866832852988536 0.069159987228644207];

% Layer 2
b2 = [-1.3544548593697934;-1.4854490646080205;-1.3303851516779364;-0.29288454756096138;0.46509005250805407;-1.4132752158198525;-1.525425447404922;-0.40179580453073954;0.62050978396716372;0.15345861183657145;0.87361694133850032;-1.9865292861793089;-3.3133758754626257];
LW2_1 = [0.11093338527426654 2.3062793958592391 0.37761527387493937 0.5385110839497449 -0.080224850770746398 0.97749117872265667 -0.26347030879677269 2.4765438535181614 0.47299097360643566 -1.6548098390931476 0.46838596491577833 -0.091907935721867062 -1.3933343295043696;0.70708484176652553 -1.0994917948122811 -0.29428422866959997 1.0652526185509659 0.81846949942640079 0.90703520771092494 1.7799313430624011 -1.8760566277590671 0.82380155516005682 1.352603225483056 -0.64477856773927222 -1.2885675925056028 -1.0684784525405611;0.18120933332724098 -1.3430831052924996 0.64786599247172261 0.060222920176516002 0.55550448052871815 0.9895562643715542 -0.20817042673200992 0.3830734283958751 -0.046931108015734871 0.39620837339485637 1.1033607609790554 0.37585106230549109 -0.49738942960087512;0.33224094988521219 -0.028194465111979587 -0.78028258911284465 -0.50485548556871129 0.55689052030320718 -0.64615023615629341 -0.64474936735525934 0.13255375144636719 -0.080820874278263427 -0.39003709056732505 0.18730361043247026 0.98601579050090082 0.73660473187501585;-0.054357654884152604 -0.39245833794632162 0.73276437978619846 0.83583747812526876 0.20599609484674447 0.758011560921941 1.2425810648527729 -0.91158757183478156 0.3912527904737732 0.86416685738560228 -0.39967931636046822 -1.2415305764178284 -0.86905212296438317;0.4227411767248847 0.48150873501807023 -1.020204090746847 -0.46593004760437584 0.026533410636898611 0.91128945358768676 0.90708455207106742 0.39231414647077856 -0.076769314544586659 -0.67920212003731173 -0.35412356910690129 1.4874362595058535 -1.3387016851394575;-0.38966753264596027 -0.00043119229360071877 -0.91789038487065266 0.33007211622771115 -0.68279925770826333 0.75322628056239938 0.63247519458175705 -0.27408100300175542 -0.015349373770132528 0.50564535876866057 -0.20629239872872557 -0.70532852114974254 -0.81535514346896898;0.21251944263993511 0.88211749571063525 0.21239630036747556 0.15337536943755009 -0.58545217068791999 0.28375339448849152 2.5188117940204471 -0.38677908966402769 -1.7862050257879958 -0.38323931046912368 -0.014644530426537877 -0.11921732398923623 1.3878972869538504;0.41920756827697414 -0.48091129710349861 -0.34042405011140542 0.12430594523671387 1.2412025749422286 -0.24626829090408747 0.31523348386232514 -1.2890149083574403 0.36892995951588009 0.46096573626531639 -0.14247162197780847 0.42400581325146464 0.4816802329330766;-0.34156101138293143 -0.52484366169531038 0.1530226567607392 0.054220507502189111 -0.37262783612742584 -0.85533060095157587 -0.95627356960023158 -0.22036920989196135 0.035744019851549541 0.56602836203815377 0.23010085989550486 -1.1070650952410501 1.1374186214351909;0.21077161059592522 -4.1071342602510796 -0.56377713285010045 0.073744430271149117 -1.1689134412719189 -0.093917077674078753 1.0224267155737361 1.1143807540142425 -0.0097084168488694202 0.05562232531346778 -1.7194623457088867 0.61144782300595546 0.044420481501776722;-0.88943120976659062 1.7610537178193306 -0.30458308595648065 -0.50924971143435549 -0.97745287537678305 -0.4149749216479755 -1.1868034793562858 0.67211617821284109 -1.0243955471748152 1.2300897073382482 -1.2037331104453342 -0.60819844339108675 -0.37281105673652709;-2.5713724749918834 1.2123365129615382 -0.57241803436779704 1.8272883412679566 -0.42537232557245253 -1.0759949392173751 1.6957138997041854 0.75518962676694779 -0.16881557473807768 -1.7552044430781948 -1.046943414494095 -1.5738021747438644 -0.83409176064580814];

% Layer 3
b3 = -0.91949117615880605;
LW3_2 = [-1.3671621291365703 -0.81879515055072194 -1.4845521226437546 4.3465029562897453 2.404507160384779 -1.8474734069072323 2.443147552375426 -0.096312721378194299 -1.1081261113810623 -1.9629937195893803 -1.4900729389399054 -1.3980570881820571 1.8767718321630718];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
