function [Y,Xf,Af] = O3aguilas11(X,~,~)
%O3AGUILAS11 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:33.
% 
% [Y] = O3aguilas11(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.42005420054201;35.0877192982456;0.0561797752808989;0.00588581518540318;11.7647058823529];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.3702177017586916;2.6344555508338385;2.4678248046327145;0.1407233017714665;2.4702571734441521;-1.1618654178267223;0.087009423404502503;-0.50733008886260123;-0.25212037549013244;-0.97159918294484726;4.31254999596801;1.1001941889651252;1.9882237688819542;-3.3677794387993032];
  IW1_1 = [-1.1859705092621293 0.063497294958015732 0.1732115531800113 0.068055530280706683 0.0097670825707976312 -0.018094772019068769 -0.31781463924541986;-0.023782345618270348 -3.551573672336251 1.0377725914312657 0.80808450477594485 0.52847927337399314 -0.75048107873209868 0.54997483223357291;-1.191448238219742 6.627159340901839 -0.51146476041483402 1.8504134232186817 -2.2877068581717372 -0.50082254341894716 -0.49323339553946832;-0.85752879771923152 0.85152124476587243 0.29418370874784644 0.23144281178064474 0.23606017376388067 -0.1247722654943715 -0.53024668169238454;-1.9088634412654051 -1.2542679728249435 0.78113276427347678 -1.0502905319897697 0.45727720999789795 0.20948633507000106 1.7285749790375469;-3.3765712869548699 -0.44428193566185264 -0.35710489426702352 -0.70512334352978823 -0.3908620174021008 -0.029891488376519972 0.64941062665837068;-0.2536899095008544 -0.63272469686459243 0.26037078751022341 -0.082636112822144461 0.15099621923370565 0.22203658597785098 1.5538608020358189;0.83794274657639489 -0.26879786031054864 -0.18246482290848937 0.47970523829107536 -0.085540100407136166 -0.14702184494149848 -1.5726949945262751;0.49706062104082527 -1.3665871299175509 -0.69332151797875874 -0.010331231406928321 0.39056365412249255 -0.15643075142094637 -1.8014647482607831;-1.3434260189074989 0.38946128419373482 -0.42687576429647528 0.69746765022551294 -0.43393455362631284 0.037487780422813755 -0.33163969274799954;1.8527088171372661 1.7727686613996272 1.5968852553495823 -1.3135896070930841 1.8086995324820456 -0.36927439303582743 -0.24466770943267557;0.43232452143666233 -7.7326647617053794 -0.18340062977127722 -1.4205400491878768 1.9234206904039532 0.77019149960785549 -0.2407982597335547;2.6901424213599223 0.43542422797301006 -0.39225650388654526 0.034688495239206883 -0.21789629113213232 -0.16373695913431618 0.4576770777556885;-0.49934779118285733 1.7877815530212777 -2.5759541344232733 -0.18239226154603103 0.25606847769130009 0.089459396383134396 -1.3548302373657906];
  
  % Layer 2
  b2 = [1.2253571299318373;-3.3604270458586485;-5.1994857864392721;2.8195758989553106;-2.4492568845259108;-1.8958980072135962;0.48449354975402953;-1.54864982765668;2.8414370047623336;-0.94871776610519365;1.1341352209463769;1.8032513708565527;1.6716107760449184;1.6829124103884778];
  LW2_1 = [1.9617518133623448 0.78665242102532074 0.50063323055013276 -0.64955939404924434 0.32297311671211087 -0.40008910405643766 2.4026024501570351 2.0762603180095183 -1.437398481878388 -0.96661478385351207 -0.77705967024649536 -0.18789814544854883 -1.111755286837542 0.65592293466064644;-1.5288724991858884 -0.15427659366968385 -0.54169329182541748 -4.6579955532364865 1.6695933175430393 1.2542115605553013 0.24283669717076184 0.71878458908014453 0.88887029793318739 5.2905786657882716 1.0382770290170518 0.13101413382579746 0.4460518711432806 0.12244150296420099;2.8975705902003352 -0.93377604813369641 1.4213133590512712 -2.1198250965553567 1.6108110649164542 0.994513496446218 -0.028291986085397163 0.21232842607882549 0.52198833793559352 -0.32790677081428898 -1.1409120362790603 -1.0772119716745068 -0.61268102131205093 -0.62972188885270242;-0.36234630996177314 -0.70075324346548373 -0.074751927141678776 -1.085985471435414 -1.8001921678699595 -0.039305355309903992 -0.84288658608635514 0.050848342445818179 0.60477847406468788 -1.5472892933683964 -4.9041316549294711 -0.4181764307518846 2.9384598265280215 -0.25588232078124706;1.4741267265226516 1.339989922471565 0.048632277808480111 -1.0081236751423697 0.89337888389417097 0.74459519295355747 0.59878284100443058 0.080491022240667828 -0.25423174238018553 0.16036917170787265 -0.29626617051278659 -0.72329030761389024 -0.20788619708653328 1.1387022588175062;-0.18408284692306651 0.87620346963152007 -1.7563747862143011 2.2436922364775302 -0.1785503126378879 0.30710369237303792 -1.0203655702882808 -1.2120837748807498 -0.58073124576212254 1.5709352045978167 -0.19474945191026788 0.95931157674236367 2.2282369249187375 0.28860848045093651;-0.12706838295726708 0.26460253496184094 0.71783904047655678 1.6074677834554674 -0.25319859005103268 -0.70682183422615974 1.5128759913394954 0.95939613302771865 0.02970131989436306 -0.42810327955792382 1.1447057114717505 1.5194117785525993 0.63659971009701 0.67700060467529655;0.61308169208958929 1.8987084744301166 0.079164800601897317 -2.8333620986199728 -2.8269884496304716 3.4385809484402987 -1.2644656981200617 -0.81525645840497152 0.05732654334555435 0.46560125985056716 -0.36154373461787731 -1.0672861659178756 -0.66582309525906469 1.7888913626257916;0.47464801735799494 -1.173837888855527 -0.030070269035146653 1.3371128554133385 -1.3913520144180378 -1.5280328180946416 -0.91052668575163809 -0.40439365613142958 -2.1346877252809047 -0.037315781148227596 1.2541306566790231 0.76082031202978684 -0.70071764817174331 -1.5761583729849076;-0.66572447659514467 -0.11113525335189214 -0.3453073995559976 0.93148787814752732 -0.64302721414839725 -0.50592727456855535 -0.8190862835668381 -0.63866662313398381 0.25762297048341021 -0.33674322816964103 -0.35052700807743686 0.037220241210151696 0.47655839957145396 -0.33231829746473174;1.9760854998223698 -0.10351949836952687 -0.55624181605528344 -0.1886662488007998 -0.8340713916391983 -0.72073485334501652 -0.4884799687988764 0.49688188805288197 -0.89473040990202168 -0.36963008801720298 -0.63783954805643528 0.42895671200920532 0.42966504898826208 -0.068275822833534297;-0.03338039628344909 -0.14772973889527841 -0.56263461766724965 1.1047088527170112 -0.88206546176204093 0.38617493434422845 -1.6548599203737564 -1.6533958970856473 0.71919499287722644 -0.54486444264800249 -1.3712191967277272 0.10924003673951425 -1.2915379074247249 -0.29323514690136521;2.4316162366370238 0.80307589077095409 0.41490563828101878 -0.62464261278623223 0.31596250829555816 0.57256630799324248 1.7035534871766513 1.2334293800302849 -0.98952617913473928 -0.94916861511587158 -1.1083916136937393 -0.17162841532397308 -0.81885890546506646 0.73915300623041469;0.11718083075604127 -0.73556395578993206 1.6660177563359413 -2.2487549424690076 0.21759125372023347 -0.47723345845118531 0.77040761978124317 1.2237688139331802 -0.18967344106333964 -1.0239020595780914 -0.71464156853416738 -0.67773993509620023 -0.54526821813774817 -0.17631032752573994];
  
  % Layer 3
  b3 = 1.9400155564445272;
  LW3_2 = [-1.3994743208141882 2.4641953195436033 2.1419594593081204 -0.39587718915243608 2.7624961918090305 -1.0785759168867586 0.84991700182863517 -0.99847820276756472 1.3692385854995626 1.6818651218279717 1.7779320977808577 -1.4460173565816219 1.4509486371708398 -1.2731653942105861];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 11.7647058823529;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
