function [Y,Xf,Af] = COSantaFe17(X,~,~)
%COSANTAFE17 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:09.
% 
% [Y] = COSantaFe17(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;10.752688172043;0.00341273633199099;27.7777777777778;0.00632111251580278;0.294117647058824;0.448430493273543;166.666666666667;95.2380952380952];
x1_step1_ymin = -1;

% Layer 1
b1 = [-6.0662322863473843;-0.37149883501176079;-1.1545503893398592;0.76127648569210327;1.7046183709365468;-0.036840870193448547;-0.025788387144717206;-0.95360748334516066;-0.10074247889846655;0.51377265405217143;0.075610764471098282;1.5380652382945115;0.30631164523181448;1.4057240789090568];
IW1_1 = [0.89124978848035963 0.77936943843627371 0.76140328736489382 0.13185347112714385 0.28754567448844859 -1.2279132553023162 0.45647526023354273 -0.33427189647959976 1.0589016108385296 -7.1415813562209447 0.11718319097690885 0.22967474159720119;0.97182938699849919 -1.4666321370865003 -0.24627661190960029 0.013294092594867225 0.43970090799735928 -0.0063992921973094335 -0.9882125607076464 -0.026613937879414799 -0.38101411226359544 -0.12791713703949559 0.031728444366133174 -0.22949719776215885;0.95394781766230707 1.9815747657593707 0.29048684362794364 -0.53866122375605063 0.40734324008739986 -0.24682967817231807 -0.5703022206892816 0.16833311805111312 -0.14660081341363265 -0.044692805473787213 0.30352357277496506 0.11390604841214265;-2.07364306662845 -1.4727883147576939 -0.26354300592521046 0.060092038711756626 -1.0989430722892255 1.6301749629055591 0.89609578562810865 0.60007974173477407 -0.73517374754767273 -0.52320695513866189 -0.090794969998561667 0.36584339757991996;0.20047030493982629 -0.1479040878084294 0.66111889873340068 0.47281013874044986 0.17878560737304139 -0.72191373201479125 1.0861744817333423 -0.23544203297363014 0.86651888218895856 0.56592243409732612 0.37703346023233836 -0.66063251284234947;-1.1134455066676237 0.62617044709746916 0.50006017980119277 -0.2454295193911929 -0.081846193221222219 0.42628862653504818 -0.45504267778209923 0.078659079639262844 -0.25819260692473761 -0.49798946926786786 0.24931609962166415 0.3565908071391593;1.4443883843152219 -0.54933949290538098 0.77427687993378214 0.11873920333858881 1.1585940303531581 0.0036097741403049791 -1.1623506042050333 0.26839834588934186 -0.56571579352443624 -0.62904732372165273 0.75072979198000567 -0.43993144076564383;0.3189281827756496 -2.3242918377026118 1.0642019801143681 -0.71525222994296689 -0.56595287917496673 -0.28077410449510704 1.1161232358100701 -0.14759041260610489 0.18512636007380734 0.28701504605991729 -0.082564312171974422 -0.34879759156442602;0.19750732257176243 5.4204896173901318 1.0560288363119033 0.13230059435693728 0.00057261033407871205 0.41653213084456492 0.22571033923467876 -0.061590094665830653 -0.29484645331435638 0.017967611652675925 -0.29383755363478686 -0.10063767340203784;0.55559348927733698 -3.0847520312294847 0.12924468772945361 0.09470138694385144 -0.51260027768189087 -0.19786137291356065 -0.40271925753305737 0.069390517496616053 -0.33355526063517121 -0.15620889376662561 -0.089112986435451819 -0.076297783375481973;-0.79773306463255611 0.1693185071384245 2.1132724697955632 -1.2609515200444232 -1.4580677482239737 -0.09558552163506899 2.0576076698451882 -0.2067711494197299 -0.71207285377823215 -0.17340002008828836 -1.4187802804543581 -0.0484224771207966;0.72977618067138239 -0.33756133175122399 -0.11523235421551242 1.3296715970923407 -1.2742437976636705 -0.59257185644687871 1.1138592598202255 -0.51865308276214306 -0.56878545181189311 0.56023571989695486 -0.43496815637169006 -0.052921396629257288;0.64564981551258727 1.4983262177628929 0.6662843265478029 0.0097955825276455077 -0.69122872344551611 1.0091361388011526 -0.1080287890740714 0.16002919045178893 -1.1047084893091661 1.0214402567679914 -0.35860439049918269 0.15079932920803918;0.21900298559413461 1.2831202005317757 -0.058345991647319378 -0.43788929887064088 -0.051912158355667183 0.43541922026395885 -0.41056440024931445 0.26162848902478081 -1.2947206949298207 -1.1986186164474977 -0.65104026751106148 0.92849856513071882];

% Layer 2
b2 = [-1.7331093419419801;-2.1785508018425914;2.367555281279544;1.2086689567896116;1.2502592224003639;0.51623256101662651;-0.5844458834213303;-0.19738368870343756;-0.25209553652680361;-0.24826213358603133;3.6615186605482637;-0.95691767347375256;-1.3820644118050232;-2.4266241435186879];
LW2_1 = [0.46639209530875025 -0.089147150328913308 0.18827311246883005 0.23307773139963192 -0.56648062190720272 -0.41180306111036802 0.52171493266175251 -0.39958031836350399 0.92011702322265032 -0.19343128520200581 -1.0861677916539594 0.97839587359740188 -0.24553757521820002 -0.23857909490367923;-1.0734034681477358 -0.6830812437233823 -1.8341999059674263 -0.59082039110009499 -0.31508309071676416 -1.0622414063690793 1.7875986210522326 -0.46707851314727455 -0.29193768878107185 -0.4333728805196278 -0.31578035397859355 -1.16918638949707 1.2106845499823546 -1.5324819574215258;-0.061265362535315435 3.2320234304758499 1.0998707322019141 1.5919621713969145 1.5048345617444421 -0.03284873866752714 -0.85664291962640626 0.32679831137426535 -1.182599747449159 -2.5058553003884891 0.72867031587582931 -1.3792494273759435 1.020636639938703 1.7744118802322153;-0.56511506005860646 -0.68362519986746573 0.15468126075546895 -0.69481248353448388 -0.043518508890253257 -0.94912290666101418 0.18172885568321206 0.21082793557914856 0.45297537487364237 0.76909196671448388 -0.47509551303190961 0.3561237029329406 0.14923389954711119 -0.46937710871865168;1.3169314726590218 -0.10686693091198388 -1.0706896675377795 0.70949873083762705 -0.41479970914899278 0.25760917530945143 1.3202388575014048 -0.37393362826138488 -0.21520200630227987 -1.073983980376719 1.0730964180772939 0.89279331692019348 -0.31272315860015226 -0.29138463951770055;0.15068831474256161 0.84658435925655295 0.67743395865065581 0.20120747090507829 0.12169887048458607 -0.067917197617514219 -0.66159963168169911 -0.21557039937827019 0.52341079469538843 0.016392771087258447 0.13035762888978711 0.37111049371158444 -0.40315170092617136 0.5223615068504518;-0.59990607064957302 1.5363053967452713 1.6910628276057029 -0.098112234217771682 0.46037265773301322 -0.48228090892678704 -0.72504583943571843 -0.071365858876361932 0.62886849308914217 -0.23954723655325644 -0.92441391600611755 0.98823536307598681 0.3344254339788566 0.92422762780157053;-1.2559131956283391 0.43236132712297615 -0.091714972677714002 -0.43979874027223592 -0.031426341045766526 0.6051875974895371 -0.68468080606635051 1.4536514584744484 0.16075523880714276 0.66512698979392482 -0.98904623040592099 -0.44764819651827603 0.53841584571052414 0.0023841178942295271;2.3308801043326675 0.18967766717267978 -2.1750817400490843 1.0625367896538076 -0.21472295667802777 0.18407324963868749 0.017683259390112675 1.3096183531695937 1.7690710250548969 0.71338853952641845 -0.060047302769568864 -0.55154397944139755 -0.43297819915449809 0.19016013892223402;-1.2301429842705829 -0.94573027135768584 -0.26873113473664823 0.27608307868303816 0.0076259184331599894 0.28773772581799428 -1.169177645136029 -0.19858697219051216 0.37624899919727223 -0.16432211883018319 0.97819046430054291 1.0718713289892117 -1.3639776192299069 -1.1012386254874722;1.9885369290018282 -1.5365743676429029 0.47558649589495783 -0.19931359857406611 -0.14887489905434334 -1.3547283462735551 1.3212012351748832 0.047950723342358045 -2.2544457953168937 -1.6512737601938126 0.11624108515570304 1.234410835473853 1.3844427814739715 2.2089008211600571;0.27256344802534066 -0.8738921559079933 -0.084968529799653053 1.6261271487098861 -0.63334937964408344 0.58441590417031297 0.40411185537296535 0.5290266626377117 -0.41564673585691436 0.16121672473032556 0.33304315281996955 0.42348284638865585 0.58399125626691728 -0.26241680831112252;-0.31994658776695539 1.0244249369328526 0.0055576424209329844 -0.91787750539402857 -0.12521429664305334 1.0044963386929002 -0.10947218871073573 -0.60989085489643025 -1.2863185213919646 0.36787126140165244 1.2619839474465504 0.032907444605061557 -0.10387109353228913 0.33544760441904514;-0.31557369686010434 0.81168108706084752 -0.62380565715930492 -0.35292379918712313 -1.2495650980333859 -1.3878225325693598 -0.39734530653789035 -0.35923521226266586 1.1702130023237984 -0.43414614470616497 1.3647136278149192 -0.60730853420075248 -0.66198678574258885 -1.4273712172926523];

% Layer 3
b3 = 1.6560129935954779;
LW3_2 = [-0.35042868887921397 0.51448199084841362 -1.3957104147784534 0.58555674140079672 0.17174284381034413 1.485733078597544 -0.47361799024641921 0.28878853544260219 -0.41681681795859998 -0.1384103779951931 -1.0353898539108295 0.094148820544877804 -0.28222173620713475 1.3874014365228613];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
