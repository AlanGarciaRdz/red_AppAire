function [Y,Xf,Af] = COSantaFe15(X,~,~)
%COSANTAFE15 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:09.
% 
% [Y] = COSantaFe15(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;10.752688172043;0.00341273633199099;27.7777777777778;0.00632111251580278;0.294117647058824;0.448430493273543;166.666666666667;95.2380952380952];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.0890377502073552;-1.4851311468302522;1.6191522907809701;-1.6458261547561264;0.33934797536443279;1.4996747256719769;-1.1381906621229614;3.6687309236239387;-1.5669790759240252;2.9470840666589293;-0.49090654093574593;3.1906083362166293;-0.35825756393435276;-1.6038414063088628;2.7034758235881204];
IW1_1 = [-2.5521953973349434 2.4980840693624842 -0.47214777468492286 0.44517515877320224 -0.33104535134511087 -0.47630771131754313 -1.5507401992242706 0.46342032620218537 1.0747835491683873 0.17635406567300649 0.42140145854525507 0.73628408311429405;1.94604041994406 0.46826653046770655 1.0385248181276312 -1.4005489417888799 -0.030661400258945773 -0.65147743566976379 -1.1034753168835305 0.33291986166180837 0.30378039778150334 -1.038511517191814 0.079969537250586697 -0.29625511989985093;-0.12733883629109094 -0.22402340853361896 -0.70659457888478339 -0.059231948925146417 -0.69479594400317934 -0.41363888171668267 -0.84997510786478436 -0.27707310075253838 -0.7366767178012279 -0.77149355650372109 0.15211458650043935 -0.69509382072429171;0.10098183135941476 -0.60378869373848432 0.94345971724795219 0.66756093549343876 0.91979243702647862 -0.093190763636422133 1.0137261685755892 -0.32147035789573319 0.83464325532680439 0.23089022905833187 -0.27206870593756149 -0.19421812938444741;-0.15319758913503506 1.5612993559487445 2.0968661704087697 -0.16410570767787719 -0.74188988157675984 0.92472895280035827 -1.0298578444653346 -0.83698301882919313 0.16687410130456082 -0.75796593762314701 0.50509314687714879 1.1923858603782256;-0.70050696220218722 0.60223921660173763 0.28980592678579947 0.28649983772431808 0.1897818178650918 0.26488296510295595 0.39379287968832782 0.46855593118371319 0.28004929068943613 1.0491085425210631 -0.041327744708672794 -0.488765073002705;0.37882582710587104 2.4049567843929402 -0.50293339293110007 1.2571028235773234 0.058991342902397922 -0.27086994753297672 0.3227979947522564 0.47418055256261538 -0.43554246835449034 -0.66414233330040018 0.16318843583861065 -0.59352686181885117;-0.12022032769979839 -5.3890934925847116 -0.86003249085839462 1.5602088694113909 -0.012308706789508961 -0.24905103986083968 0.053144091718013195 -0.068066770419258502 0.16768887883374831 0.23369216699681408 0.094362493210496334 0.22125738337204448;0.89705389285957249 -1.3168014129920327 -0.25792731223865267 0.57424604603389862 0.83767194472268525 -0.14648392549008055 -2.2302063328306283 -0.5224669564895178 -0.030475128850378355 -0.61094848405145163 -0.042931748869667129 0.60835105553791269;0.7629856565888411 0.66371092569396339 -0.79288058948526352 0.27243921087004674 -0.39939049034453256 -0.47847201631452474 0.084432458520458928 0.62232526913861386 -0.0021867261962691883 3.9757669683146935 -0.13551516961238894 -0.80327009748539757;2.7404750868298966 -0.57049590287898411 -0.23968713483089096 0.54020346990513635 0.50717930997493466 -0.39742906271095302 -0.22826064113807065 -0.54659408150609989 1.0918903566138976 0.15994910576609961 0.43913568910271639 1.1686220595024157;1.4689910905953898 0.043178688171685915 -0.28180902652093731 -0.81601071421335658 -0.44359908658744235 -0.54808421662784501 0.082140847229800154 -0.99530885221951815 0.13410083629774402 3.8322286524247859 0.29783676498107553 0.65970481587715268;0.26940794242485566 -1.09464572981793 0.62436581737519736 0.27491805031747751 0.40004428707910233 0.034269340893873554 0.32110086267517712 -0.54810544827472663 -0.51541909948646858 -0.26513209696560747 -0.22940043298679663 0.029829844932905865;0.027850448718282746 -0.907878236230382 0.89855706160321025 -1.0357964050974184 -0.70283790874734986 0.12421681745690651 0.50209646966685906 0.96127691454491437 -0.43829448378348007 0.56679423977540289 -0.082050422302807735 -1.0076640140176825;-0.074235453471341042 -0.2567068918391916 1.0610458306568749 -0.84005375126435855 0.60882978901312257 0.41543920547123481 0.099568183949252737 -0.84636078877693277 0.24174272439317218 -0.07224302737219572 -0.15229856842994921 0.58172192629695596];

% Layer 2
b2 = [1.1646808856120658;-1.7533982720865608;1.8243165887760615;-1.239576713686106;-1.1548011610069053;0.28182712593166781;-0.34210042722636219;-0.21682709775236017;-0.83441563886140457;0.84767077544712777;-0.70398496163529367;0.69779961642267108;-1.179726932624741;-1.1902871369426924;2.7678699240584255];
LW2_1 = [-1.1450025669636785 -0.48941449007333798 -0.99379003684013789 1.0560367025053976 0.067707521711373439 1.2730609136367352 0.24913888945171134 -0.024775180281948923 1.0481760765608956 1.0452787504868826 0.082406956797338768 0.18258261922799876 -1.0888940362368225 -0.68761063126165678 -0.15556162363722159;1.2633416033048299 2.5773713691344384 0.11887209780545271 -0.080310551738875136 0.45214164666130263 0.87855937218861646 0.57246901621844393 -0.9628997823053459 0.52129940939571684 -0.17520407813074132 -0.91977740775272676 0.46969158417289103 1.3981622258862463 -0.17149069564973141 -0.1415652072227371;-0.88620408005625995 -1.4064586843851741 0.45755825050185095 -1.4156539718071568 -0.2597524091741642 -0.28108922306556494 -1.8946177717872053 -1.5402199707291371 -0.45306055629948216 0.093776009020737072 -0.19421958072094403 -0.47637065354147767 -0.49251791297341874 -1.3412847497413856 -2.4674713892921494;0.24670074136172865 0.078816518817227552 -0.95318820409524951 0.30928327044830339 -0.22656792112549323 -0.58668685152089228 -0.50866973654404712 -0.33921244263829425 0.39487659008205284 0.12916342770968181 0.65427822461359919 0.34075991303557895 0.22432770148210965 -0.12512504472057256 -0.49816494015108881;1.1045143077487274 -0.33365225881060967 -1.0460033430531728 0.55346106610604417 0.022001658974920815 0.18733549575176417 -0.39231438090869081 -0.70021014953718985 0.22452899499378171 -0.14837081000609634 -0.9550536050812789 0.10892036804918165 -0.30436680599583976 -0.41326188734756131 -0.67233116348929867;-0.51068036195902389 0.037302353332824029 -0.71700198937136972 -0.39337571369956115 0.26515120414127669 0.58338474630833381 0.10861930328963276 -0.98195165146082852 0.73816776783963745 0.59155890375127362 -0.57406097718156301 0.27137179829715291 -0.56500065910342967 -0.70483856086254548 -0.91974768468924983;-0.0065953614800187237 0.43075744719224501 -0.75236626987677191 0.42368314242345678 0.23444799047334688 -0.44939923734320431 1.1108930563726864 -0.53811926242373553 -0.087705648976121861 -0.74877083312395942 0.2795993404307473 -0.037525202236234921 -1.1277844930391727 0.18306546539512955 -0.98525319215173845;0.31753567496574969 1.3486399284864734 0.4267147473633221 0.3962308380961061 -0.67296850712443279 1.1240049988458858 2.6377835359636332 1.0772094373714458 1.2539472748125764 -0.21001742025191472 -1.5421805343131298 0.31534847637450902 -0.52671707094130549 0.63246096570863808 1.3530176597110635;1.3233833333716429 1.7863278004889926 -0.52562629295577035 1.0280480643080363 -1.3887510830116907 0.78257021518747438 0.87709568904630597 -0.79077884075627303 0.73371452558252126 -0.85506204880060288 1.3289623209939254 1.8828506429140306 0.51156752548915574 2.1943321657791031 1.0225211432427623;-0.12006897352569204 -0.36962938669746437 0.93907894906391198 -0.73558690519526349 0.63335596650014159 2.5419728484041548 -1.2507767896086772 0.60686063250101119 1.2097434663639064 1.7085154731554812 0.21954722402036492 0.39095315098298306 0.52016155384228058 -0.42383598164575859 -0.41145527913147695;-0.79931634348658842 -0.26064689649824763 0.075370210836579299 -0.27477736453422358 0.35555764748325069 0.92951869238302254 0.29809436707629544 -0.20257771681729803 0.89084340199227974 1.18111062658057 0.083758288888919202 0.2719010071401049 -0.64416990319188949 -0.57795385140961775 -0.43524284127138424;0.33524145844736636 0.44279781804412749 -0.95528656352577357 0.0154801650421642 0.57214956411979578 0.45243989723305156 -0.5216947274872511 -0.86054960442875728 0.27293232330385869 1.9423487386417364 0.88072886752112822 0.53105753461188177 0.87115918462831965 0.026381982116761637 -0.79801066298375312;-1.7356965905027573 0.78959940212393087 0.29114132287216554 0.096964756671510777 0.33399937468205426 0.16123731355161194 1.756574012966547 -0.5106624638762518 -0.96465919131494793 0.38380502996304017 0.89812038908658642 -0.25479135866352842 0.11656619789455437 0.3573259620507005 -0.79396150966634849;-1.1176423543036933 -0.52506882802069299 0.088618456177732341 -0.79667758282446366 0.3117656065215223 0.49373041401100698 0.71364658494386257 -1.7989587443224064 0.63579217038978708 0.25946025392291361 2.1768486824894526 0.56773775759145895 0.54048247256110427 -2.2332873477180932 -0.88380989923189923;-1.8495428635290692 0.98440914545516423 1.5831447083742201 -1.464265450880003 0.82285415003047402 2.4010626927828254 -1.2102994237533033 0.43895669151005423 0.45953483313128685 0.27526408488869519 0.46595546382703523 0.093532454056214034 0.7739905000965458 0.98900409203027484 -0.15990780468065641];

% Layer 3
b3 = -0.23399737697045314;
LW3_2 = [1.5167985759742153 -0.32969928323907993 -0.44891963393810569 0.43311768678789758 -1.279340533207225 1.4609651967982873 1.7330472360384088 -0.37129703335376363 -0.16931867999203115 1.7650060124467011 -2.481445845378961 0.63549825712513264 -1.1556773021772699 -0.3265233465548808 -1.594679550786974];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
