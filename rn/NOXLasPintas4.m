function [Y,Xf,Af] = NOXLasPintas4(X,~,~)
%NOXLASPINTAS4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:47.
% 
% [Y] = NOXLasPintas4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;3.96825396825397;18.6915887850467;0.0175284837861525;0.0546448087431694;0.00640204865556978;0.138888888888889];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.3108729255795613;2.1080867589496055;2.4517630037588432;-0.15261190480663228;-2.7054171919953092;0.34028270323564686;0.0015758837118466998;-1.0839166610686108;-0.26090256983540028;1.5580087439730088;1.8131999686954758;0.30528615092598982;3.9270284366381509;-1.9610401192015201;1.0463147289915451];
IW1_1 = [1.9594295102898118 0.2747858394557991 -0.56024711846377084 -0.19292789689410789 -0.30751544670165465 1.3667307664099768 0.73159678917242044 -0.71245502093257107;-0.32628687572568776 0.49534311821591515 1.0829945587562309 0.19761096739611378 -0.85818722837113448 0.72245598909902675 0.18307207158729522 -0.27362329585721745;-0.69612621110842188 0.16730790045137628 -0.81836439683071727 0.082326625619919144 -0.094253961563231292 1.2516731767940874 0.36192072045516815 1.2921716206397309;1.1435618440629893 0.43997218661920395 0.38053930970202909 0.86287412531396879 -0.51552492854891219 0.25439637417370103 -0.34721730247074184 0.25695816073682382;-0.17067512936098669 -6.3097003363832878 0.56149847051832569 0.055409436886784007 -0.36915241552576294 0.34422717223010568 -0.17339673606189127 -0.23867797985846237;0.30726452779839641 0.041628436140048235 -0.17623281197709731 1.5222148408447764 -1.0012216719460991 -0.43620013364665056 0.44247694814431843 -0.53208611647691928;-0.81576512095257903 0.82535310707970322 0.8346028498146536 1.4427607437016381 0.071689540542947683 1.4065090200952985 -0.036746329469615487 -0.82890280897080171;1.2107882600912692 -1.45241531280463 0.19976665520878534 -0.40992546602384156 1.2793857041024244 0.14430310963483459 -0.71092052899205249 0.56199570680406996;0.18491613872200571 1.9023379062207821 -1.1349945585931138 -0.40390352457757639 0.27197245770768846 -1.7220492840797241 -0.15561039040097674 0.14239604777522036;0.11158134953150747 4.5439350398478418 0.20469914831102737 -1.8091893209981764 -1.0357369161691858 -1.2264865707055084 -0.3496573889610598 0.71616687277734825;0.95340479566384462 0.20464469612037864 -0.35276195900135793 0.90318704832946839 -0.32197767910107583 -2.9441154862742018 -2.333751325118425 3.1099341684679871;1.8674320235499329 -0.64128497462313905 -0.69053302226343782 -1.0177431982039005 1.009014772107317 2.4324049531610443 0.71113807059032841 -0.37527162422271321;1.6161987306872669 0.71121646379171077 0.91134309307659367 -0.023137175987148192 2.4111817415344512 -1.6638811260018975 -1.1119111064464564 1.2733761031421762;0.67156089303462185 0.12029829144137839 -2.0531093854176907 -0.16259833368221616 0.68230518874242663 0.67132597141949202 0.50476401236867408 -0.013301957081180198;-0.17543402945724934 -1.1486170640736026 0.24837555487371221 1.1639565636056717 0.88965939144610262 3.2742891663599494 0.40552440188915806 -1.1621811288241128];

% Layer 2
b2 = [-3.8353056431130295;0.63218649018952588;2.301310937522913;-3.3386041290820376;-0.14483889469335623;0.50791227170707742;0.47095124896655544;-1.0742224937550049;2.0568040655894024;0.10159617634652923;-0.30599112668643086;1.5030045627846809;-2.0332954378404384;2.1525294763609479;-4.9237946271060045];
LW2_1 = [0.027785684587843903 0.80321839378096238 -0.083784899198708324 -0.068364294541630191 2.900359227377201 1.2390249109032019 0.11981103300053876 0.38741447067236184 1.3101473861932786 1.0994453261035046 -0.23491500427051695 -0.23372208228830454 -0.015014671069580571 -0.28672669983175564 1.5024482575292752;-0.89207891705888531 -0.71886303753804159 -0.38582253968552177 0.3973132666523711 -1.9372157500927487 0.44821096723588782 -0.69772612327604255 -0.68397517552313913 -1.0446971685649151 -1.2687566883162469 0.92076806379135068 0.14628871722868592 0.56822071439062705 0.84189322360148533 -0.067308075331991457;-0.27408281041693772 -0.59826619502028655 1.1972748479570843 0.7119277412352869 -1.4148134690515557 -0.59442713552839421 0.73914222069708702 0.31231794817925596 -1.9654566587089854 -0.26178619638124284 0.22920088771296007 0.13058492165445068 -0.1363528379595457 0.17164616978219199 -1.4246641358964338;1.5217254680573442 0.050708301088333019 -1.2011808562168755 1.1147093071703329 -0.54687822413984888 -0.5539496065243662 -0.23668533017732066 -1.0095834732355482 2.0528002765886488 -1.6228038178310111 -0.059896831821648483 2.7756824640062026 -1.2779540459670256 -0.15086816373884221 0.24244951431900638;-0.77127354772461054 0.75968094716915746 -0.31461937077781871 0.064160648986268567 -0.089426732497123906 0.56948452564022245 -0.044571394222569602 -1.0333595003670311 0.58971139815096363 -0.86336952226791408 1.14020608439878 -0.55392801382626877 1.4120682741770387 1.2617286447932778 0.053168659690628776;-0.44515353824310294 0.21550716485168292 -0.49821500407719393 0.42648620489659816 1.7260767529168553 -0.90267109872354334 0.84612588110100029 0.83596167481961581 1.4666043827707793 0.86981179977182588 -1.1031022853122849 -0.76124773185020289 -1.2387205839279076 -0.98147600017317183 -0.0099785722688959244;-1.207410218937464 -0.21047878865798786 1.3871950754535876 -1.3628479669960947 -2.3493998599254384 0.67342839133666665 -0.28327937223322419 1.3243070838827196 -1.385754114614127 -0.3612143857766239 0.21669444214635461 -0.34588655910536464 0.34000409871555587 -0.14493866764276173 -0.26861009327392504;0.66661015291032266 -0.10699774815568022 -0.041710582397682452 1.5637130754823518 1.188855170117493 -0.38251188052649254 0.54467770776767699 -0.62693056797885938 0.65485011163883866 -0.28341810339432477 -0.27591889870477104 -0.023937257309557466 -1.5865105813072646 0.93006656869884419 1.784390746988777;1.0333570109449628 -0.074508968471031681 3.0591787669651027 -0.90584031052808311 -0.066317373693252551 0.84810110663510618 -0.21917164496847685 1.1480166362834014 -2.1250877454884276 0.45736166704751258 -0.33208697142923793 0.97076421497027099 1.3459693728645499 0.92320239096354806 -0.96007191470982156;-0.21199205143508254 -1.5214456776581833 -1.1275656972336816 1.4059091397682002 0.70701368605646286 0.66954185732028948 -1.2594215506168025 -0.68804337682074146 0.8187407324964161 0.25818774977017211 -0.29959142171982223 -1.2855369758459252 -0.62617235336357036 0.43478178667517509 1.1173805665723335;-0.52819226679390829 0.52103555153311865 -0.71928273387821595 -0.30124735113305351 1.7522985931739916 -1.416665332283759 0.62103906396347108 1.295906468490934 1.4468424327242517 -0.64255755998225972 -0.5430057827562329 -0.49867931442299429 0.73896315437643434 -0.31193026840449167 -0.39102134287643991;0.17259317371667676 -0.47415967796127551 1.4275321881634357 -0.1896316284783891 -1.3877721292569707 -0.39492350239177476 0.85687247985910375 0.37631898790219165 -1.8612223295544734 -0.23144581846433529 0.29357170291256252 0.36852781235700671 0.093507394863597465 -0.22184151535360247 -1.1622276534541431;1.7122844455435711 0.25083376848236216 2.1746870096445483 -0.49278809970833037 1.9628808826844943 -0.64656037835973468 1.4082180079248847 -0.10955239966275214 0.023680495433857515 1.0783217985811786 -0.14587808226981627 0.77346560162010436 0.38516068199585174 -0.20115282845933627 -0.2973685846793942;1.4602666647343463 -0.42035303050907813 0.10368694936933774 -1.5161243289563289 -1.3799467487086512 -0.40728855208579745 -0.97221353392027499 -0.33735249205614803 -0.86407181546986755 0.4777442987468572 0.95612382941315555 -0.9660906746358271 0.88587896328215576 -0.43077848919708861 0.11629546101321175;0.35284261420811874 -0.5134863160075015 -1.6234690916770527 1.3236464503393448 0.52945388514975966 -0.17393908913132761 -0.83874956511651999 -3.6604177110785492 0.39021177081694702 -0.76368118048128286 0.07988223362129479 1.5759846395644095 0.6529936007849505 -0.38928443005854607 0.96457321088786341];

% Layer 3
b3 = 2.3006673320856188;
LW3_2 = [2.3530995499556551 -0.43611604703256901 1.316915467223936 1.6722333835094418 0.070306262663017191 -0.27576559335219963 2.8467896309413869 1.5112533207272931 -1.1931259472197289 -3.1062842153281394 0.047752997819778153 -2.5651752856467063 -0.17676151294236594 2.0268287919834012 3.282315278410008];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
