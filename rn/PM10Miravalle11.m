function [Y,Xf,Af] = PM10Miravalle11(X,~,~)
%PM10MIRAVALLE11 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:16.
% 
% [Y] = PM10Miravalle11(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [3.0920145223231779;-2.1134847465364439;-1.7954427119838154;1.3636598458104858;1.8274536034472102;1.1825416879986372;0.97868317430029905;-0.37861361617926809;-0.68779267984297632;-0.21005721299692021;-1.3917746978263057;2.4388142186688513;-1.6226152407826409;-1.6944101504238693];
IW1_1 = [-0.7750219279247853 -3.2356716390243108 0.20916705270183705 0.18035569796748716 -0.09578386249401212 -0.33810429863603148;1.6722004134629276 0.53056633906717487 -0.12218895738631742 0.893606081329824 -0.52460553502071761 0.49510470257197992;0.47747569443327725 -0.030997508426883098 0.018044574310516988 -1.6193096683834489 0.78422372968313947 0.036958360338757011;-1.2946431786695141 0.28769188101212129 0.66484717785652814 0.42853661159303996 0.6733224033582077 -1.2423193176340397;0.12420235453790776 1.34439563225579 -0.32922971182944649 -0.37647121513463722 -0.17567715107379656 0.8207877534967557;-0.97869210033871357 1.666979886812727 -0.15916168614590048 -0.68273630953246212 0.46018894447495828 0.0011320243807018196;-0.56524817616684997 -0.23975294008346326 -0.56356842955216879 1.395614255474336 2.153325796242112 1.428256610901703;-0.40452062355584434 0.27497106430277779 -0.51927497255958521 0.044880950617866691 -2.1582327908127845 -1.1185168870499884;0.96850073513906021 -0.26691378433242274 -1.0626113795425067 0.62277249841476912 0.10826272220695721 0.26123747717428292;0.2006286985028802 -0.79058034078400052 -0.39884364532131833 -0.11433302877142247 -0.44703877343114706 -0.057277991190385402;-0.85016959353016341 -0.83952864710713504 -0.98093686690753712 -0.34124778816394241 -1.3268271747064677 0.26719874521472697;1.4874766377025663 0.26881114733958456 0.17623112524508969 0.84666394721216043 -1.3587177769684577 1.3414108788574357;0.69881571180933844 0.011543984505475981 0.94567832552399689 -1.7564398358185385 -0.38800252867365848 0.73404188529437031;0.076890080600170246 -0.20573765384122189 -0.50800958655592854 -1.8764701865228479 -0.7745646206540987 1.353436789781822];

% Layer 2
b2 = [-1.4711422168330099;-1.2577237308320361;-2.0318806541238978;-0.41470430736781311;0.14546834933520603;0.76818467414147873;0.034055681651505271;-1.5561780391562523;-0.36837529342123354;1.0364240871660775;1.4448238301637528;1.4348196499067223;0.55260811326618764;1.9618479452023958];
LW2_1 = [1.0378554270053417 0.23571861005356073 1.2276160684198278 0.1115221529950029 -1.1623191378851379 0.336876368871589 0.28778915350699397 0.24877233268853535 0.8397061309680538 1.4495469077864451 -0.64550333155070239 0.22876581999797885 -1.0607460517615452 -1.1734568727718409;-0.35650977713761195 0.94411125719546507 1.8043287731669513 -0.81797087153693648 -0.24934461652889933 1.4047963441133451 0.40000140185997701 -1.1068656552584994 -0.072751817133842878 0.49991369412033082 -0.89156476638839754 -1.7648761931005483 0.47487443473043806 0.068172807728651558;-0.3231795574045076 -0.55983090106311717 0.35688407454600668 -0.57277034599631782 0.45017941049477761 0.075769468759072464 -0.76553595958179843 -0.75742290207701624 1.0109661502405083 -0.068162327031110886 -0.20847641018618762 0.67246150891316492 0.48451659721081103 -0.32171700482923443;0.4564313289297926 0.48415356658788222 -1.261198547797862 0.85856499144239729 0.52761327444878547 -0.35725056192889865 -0.054259152156403201 0.59083684761903432 0.77051902148124918 -1.6907796404721795 0.96879616115755729 -0.6874067372791931 -0.50341665567859806 -0.33563447318801165;0.79301651173580945 -0.10346206201071903 -0.80915552393363355 -0.73994203419567972 -1.462148224770679 1.0318344102243613 -0.34026278027926304 0.73373352857680119 0.27404067737975801 -0.89132704628491299 -0.18585314406606079 -1.2421893852297436 -0.92561047937714369 0.081257828352357508;-0.16545663143828887 -1.6686997631214604 0.80686813868232932 -0.60225513920028217 -0.71645764778369603 -0.11462319558028039 0.088913659349563606 0.4184178219015412 -0.50199071731325406 0.32088397415367509 1.6315795621562015 -0.39801070021309498 -1.0645805087854692 -0.9984413470499357;0.15058217217006248 -0.85723964609332814 0.41582675012039683 0.28623279812147012 1.0445531515021884 0.3608761886037698 -0.18053863819106136 -0.08653727185969369 2.7101394363606421 1.1443177870139472 -1.7487365699348534 -0.0010781563417430889 -0.025993241943006066 -0.22050477002132518;-0.85005145849263297 -0.38433823984812548 0.62768162854431764 0.30390242163899545 1.7233988499130206 -1.1198676371266179 -0.33037913427574939 -0.65286484166510916 -0.52744392082197622 1.6215607300851738 -0.28617248401899459 0.97595552343238179 -0.53514709651530368 -0.50384948970169552;-0.66947438030327255 -0.65807965818533243 -0.061421775934672601 1.2412367798749036 0.89803507193881882 -0.021875570141069334 1.6889647740504656 -1.1483503570210707 -0.65791863668957196 -1.4827754504372386 0.16061408141804803 -0.0084494460837335559 1.0314221244869599 0.61498170866651514;0.54127455194935781 0.60256890248346795 0.26679745227893337 0.098940175825759591 -0.053249742848451825 -0.52433620948381032 0.42256731275097081 1.1714973204060433 0.56709084073678206 0.83511184192335641 -1.0863034743887137 0.41161963983318745 -0.20876543982716048 1.5316292133601377;0.73252427259754549 -0.045558578615395806 -0.15078391359892346 -0.33094521344459665 0.12676639383127081 0.53799340211815816 0.31046604308977088 0.6393193534985081 -1.4130065354120349 1.2348202059373428 -0.14234795924810822 -0.63279978803458781 0.45378366152995381 -0.26091900824388758;-0.85588404423568332 -1.5243794645100321 -0.014291695786733057 -1.1085048648785925 -1.3580410644842815 -0.54817760767140833 -1.0821405122971031 0.057988642678385563 0.3163039237482812 0.58303062108481418 0.74462209372007404 1.4414307707862082 0.21848451935213609 -1.0779130191515731;0.95188235941197619 0.8277652411799874 -1.1575384789798058 0.020392814798718011 -0.44385239233014467 0.46403387082205921 -0.95870393145652788 0.17246774187812297 -0.75032999174784432 0.43918596512785624 -0.80840410197296853 -0.93251356866972035 0.83549635968462288 -0.50928936431989291;0.62815663908586483 0.51192042290194006 -0.097121892475999644 -0.77368086322008456 0.12717713789010476 -0.51086919736744429 -0.40926872667029507 0.85043296991596018 -1.9280164857325686 0.55282520203235141 1.0018278012040527 0.85946524886922515 0.22130566165831472 -0.52334238971157621];

% Layer 3
b3 = 0.14727632109908234;
LW3_2 = [0.1426688478465917 1.001698037410709 -0.60783909247583534 -0.33203150383947128 0.9860447699951389 -0.20732124229721716 -0.17572654183069752 0.8671705486194442 0.12871362531974445 -0.14820456637637136 -0.37967824870817951 -0.13998171303336196 -0.40213585923900408 0.29678892810879243];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
