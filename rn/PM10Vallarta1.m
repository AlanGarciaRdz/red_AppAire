function [Y,Xf,Af] = PM10Vallarta1(X,~,~)
%PM10VALLARTA1 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:43.
% 
% [Y] = PM10Vallarta1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.12820512820513;0.00782778864970646;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.7494067326164242;2.5199975198624904;-2.5444142134238543;0.26741749437119078;1.7206552375547186;-0.10447066762036258;-0.74886017436047669;-0.5564589613683254;-0.53541051735425582;-0.98339071722148275;0.0067095175653434109;-1.2217717695909456;2.660109985333508;-1.7250198350044119;1.5297213084739147];
IW1_1 = [-0.10340450182854946 -0.77913756365406084 -0.55429290889432614 -0.59046822291049328 0.9469386972267867 -0.14873204641282528 0.082052511058504973 -0.25782763035196876;-0.814741851354294 0.22084694890306836 0.15345518462285304 0.22848258870036087 1.6169189596629465 -0.25979201795737461 0.027148649657409357 0.11141741037297512;1.9569662519298223 -0.50286774556583635 -0.12784807534989465 0.67034034702148615 1.6527371682050955 -1.1496533901703103 -1.0862814113186914 0.40142176431710347;-0.88171675811645955 0.0068945825087932816 -0.8264381525892267 0.64695744756990348 0.74184523097144384 2.1073565187817391 0.21541985413409201 0.10582595259576831;0.02608713794849973 0.45685160778561795 0.70533495886947151 0.82586640288373403 -1.1675295235743941 0.51713672287589874 -1.0253040708396255 0.44359510776250644;0.18375260803796498 0.051800300758113295 -0.18348005667883505 -1.2595430414990978 1.1807732337174064 0.61536188451352203 0.72586120777839336 0.013667712016472527;1.1513577921872475 0.068740829365437794 0.32516363037299856 -2.2163664863079382 -0.093498632575607019 0.72902874401651341 0.080506939114180817 0.37106533608168818;-0.45912912591382904 1.2767724177280373 -0.55367838824293469 0.24093488635734636 -0.27492471007383179 -0.7213225407484265 -0.77694335158633554 0.20138740493805934;-2.0148681675806355 0.084169551060804482 0.11583158075377552 -0.89164954992767009 -0.36328368356720137 0.16044945618726641 -0.18086009138043174 0.37160430293570601;-2.5727574027986249 0.15257792842387949 0.51655984897419382 -1.2479746678077486 -1.4407231704964567 -1.2210428967348768 -0.38146765744312144 -0.70933550570060522;-0.85135119850386443 1.4204518065995249 0.92978122886903125 -0.53231233516867771 -0.32368775830154006 0.63311704818203607 -0.30070245132234052 -0.49712294814729047;-0.37331729127587443 -0.66170479098890622 -0.9979960065277681 0.34080661139000268 0.64066281305869854 1.6201358908436021 0.065137008268073227 -0.089787606704168882;3.2450046494270923 -0.13285261805263238 -0.7010959079608341 -0.51900686559738163 -0.82705453171650811 2.1059030843422115 -0.011703216274812678 -0.039062200468020454;-0.15279422233368264 0.040402437084429366 -0.77629174911881182 -0.91107523324791329 0.67411565456324207 -1.7561395548829968 -0.0072864639004773888 -0.10125253761423768;0.27162097081397091 1.9020169089935264 -0.74022227774068894 -0.1428857957930488 0.19812432070274044 0.0029971173638602033 0.5876255129554887 1.0591134821447079];

% Layer 2
b2 = [-1.7900882344854507;-2.2148079140741666;1.330820414490913;-1.5161241718626475;0.28269768922859345;0.82528293088727878;-0.25417294958340303;0.35949842613125538;-0.34361251393849446;-0.32567815129116573;0.49041535152445814;-1.0941519765591743;-1.4238829910750381;-0.96573842223880757;1.7724646834998374];
LW2_1 = [0.53772501879458268 -0.22826579889321788 -0.15654000287916672 0.084338270881875566 -0.45063547420769634 -0.72866745557774759 1.7071229545632913 0.56310819061315409 -1.0360894374106864 -1.4051671623203437 0.33568211672326276 0.27322082274728682 0.11346377369071932 -0.99475056852620236 -0.7319789291071418;1.0295116549063767 -1.0584722756884717 0.45625104129819199 -1.0474728109301565 0.62395202342456968 0.4930623818004729 0.92980219876785064 -0.59224073015181156 1.8453190962897379 0.94788052903358944 0.82754091218587955 0.67713998002324083 0.54570305443782907 0.10787153732999183 -0.27871786461900405;0.53464897970334102 -0.32876746986227456 0.23408023105401948 -0.18961131173139875 0.33828025408103674 -0.78575215589102554 0.051242097779620188 -0.77030996914965488 -1.7443021296398933 0.80289509166444128 0.92341376849341428 -0.064766217279766614 0.35531690469527616 0.5733164405099701 0.19461601137270604;0.60769849537002207 0.53872556358557622 -0.081303175403682454 -0.61400026970849886 0.050353326385998411 1.2652220140443782 0.1713228393410029 1.5404270410991816 -0.72082662746263793 -0.024047812644110138 1.0148372541116153 0.92026311457350662 -0.87400170350476625 -1.1126295555112564 -0.40037531658323683;0.24391528700218795 -0.31666944324692531 -0.11918190230772883 -0.33120850289957121 -0.08523690537954344 0.27305446868461308 -0.072013694866231964 -0.048145715835193385 0.15652608610734361 -0.61110520058815487 0.57016706578849963 0.36461623563989781 1.0391924626087921 -1.0589450140033603 0.37826849219781561;-0.85793117354863579 -0.91045056871912744 0.2633258782653653 0.49913248152745299 -0.27023960512379391 -0.50547174662819139 0.54626648220686569 -0.3184750206889746 0.3540856092334046 -0.83131786421245479 0.64469554422074493 -0.2059243333820428 -0.26307891231850233 0.00024874662551242419 0.33831339073244882;-0.12363265070128818 1.2402392212430482 -2.0143333363324523 0.38240884235344552 0.11781777530405554 -0.96999975826876317 0.038859811045883208 -1.1977857635016635 -0.028127898720786838 -0.43539344139342145 -0.17976742356374717 0.49391490912498548 0.18283123468416879 1.4724906108382931 0.53405690527717475;0.069099586812442299 -0.85999722129153233 0.67420123072115501 -1.1051322103821208 -0.23762621798990285 -0.46949095073090041 -0.49426522533839184 0.10247045407683034 -1.0323877506487649 0.17333598959448843 0.084992646614842349 0.17377782756480259 -0.41589810031618729 0.46818556810786693 0.1285276749623904;-0.59656226218246089 -0.3277162999377588 0.31168998517424085 -1.3142053310712005 0.18589415482344068 -0.037370521203960824 -0.73222799511091852 -0.035296462413486884 -0.53147155288340742 0.44856649200462784 -0.30033639998977441 1.1658685903686659 -0.42834959342019663 0.45350854535442814 0.0024994239943796925;-0.076303460478304649 0.18869209679165186 0.20553966442145941 0.84518381122116693 -0.46045351181672622 0.18819990808541093 0.3772520476178492 0.65798940333895184 -0.86636890021239688 -0.71424081709215959 1.6541275627963496 -0.73121148141632075 -0.18485226133330662 0.30180949193267437 -1.0271060360601398;0.58199338866825856 -0.08599924791572533 -0.95184472369683315 -0.58139715072751996 -0.21383608713248248 -0.6403324046287171 0.30122498373614598 -0.33578818879385397 -0.52536022817866501 -0.0017813288975210423 1.3593285499974384 1.036447065284229 0.1578189620279134 0.19129106709827184 0.53629792993831393;-0.0069715063462558163 -0.78701681207482121 -0.01894312561493787 -0.8861300858801735 -0.97707531694432537 -0.9481676864287506 0.92851968780847804 0.27160567897372778 -0.82788677811987343 -0.42493431049109393 0.74500482788379574 0.31258497483035991 1.1227632973417114 1.3215007293047458 -0.54509833448880485;-1.3602497512187661 -0.52321543752350474 0.077583752497593292 0.27638734973348644 -0.277812497795622 -0.13837389592251145 0.40466837743424433 0.1785018569765226 0.20083357226754375 -0.21327792502940124 0.46329242873694387 -0.25305863203895129 0.053609126121153539 -0.014870118176705072 -0.41619055572228819;-0.58196417499537711 0.71850245512456046 0.53764641826714921 0.45008255657864282 -0.057139849965733638 0.13504093961570474 -0.19292846864116703 0.38856559755831666 -0.1912458578067715 0.54920958014601173 -0.95219793903545402 -0.53584943914397021 0.09241674062369204 0.029145317778399533 -0.67252810076647473;0.36426697624631399 -0.047251656359741677 -0.48205754836996639 0.83888040560879928 0.38125874866244808 1.0823946120170951 -0.34903449894011207 -0.41319082278070357 0.0068245829768031063 -0.4374743745693131 -1.3100983099628385 -0.49237294848489271 -0.15799775869276531 -0.053025531328080515 0.05017415305515343];

% Layer 3
b3 = -0.22576307886792968;
LW3_2 = [0.28495263403363597 0.80892607328767085 -0.45902831720315945 -1.5209090204408771 0.48951906460763506 0.81073839679468196 -1.9850915801118991 -0.99574692214213079 1.0373084480686343 0.77274614229477379 0.85800839347798608 0.44349403323542524 -2.7978269546773085 1.0902530866192073 -0.22799981086771284];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
