function [Y,Xf,Af] = PM10Vallarta23(X,~,~)
%PM10VALLARTA23 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:49.
% 
% [Y] = PM10Vallarta23(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.12820512820513;0.00782778864970646;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.5932835626943727;4.4624488189177542;3.3618325773896776;1.960867139097535;0.33656126118363783;-1.2902154587251058;-1.4393080153346445;-2.0386997960399005;3.1616574276956797;-4.0214487703120154;13.962033165311084];
IW1_1 = [1.1443765900680491 -2.5488941664427189 -0.13383892949900439 0.072111740304857341 -1.7317353360726717 1.4504446884425077 -0.06361954018941042 0.10935233858099284;-0.98595977676020974 2.2796982029068014 0.3460975357205443 0.60754636522394401 1.9027084721948542 -1.3478021101923736 0.23546342050004529 -0.14321177679276617;-0.80438665558102396 0.12157690681806563 -0.88773418817896177 -0.37373618675613157 -0.3126216270508379 2.3729046045907265 1.6049958998013536 -0.34156922417868807;5.6285563562335987 0.16418483924446781 1.2105015157392953 -2.4421358335061507 -0.33145126235387112 -1.9153600471925063 -0.51353132293214421 2.3982148619966699;-0.96669358944232542 -1.8557971271784888 0.17624858591373802 0.31452019429982153 0.55858783295529024 0.38020473125185239 0.070195774144961282 -0.094857028559925352;-2.3767283458837052 -0.43394229437020115 -0.066029759417326195 0.16653772173086157 -0.63461277447479703 0.78357329998164627 0.20705336730547283 0.30561082198364437;-0.84853139849170911 0.97301197199343825 -0.0034328819031329821 -0.24784882841165104 -0.065170814149050682 -1.3270999553718941 -0.025091122794802585 -0.035234902265365693;-1.3036795991845511 -0.9725426244954104 -0.028794913953398504 0.27629083242829483 -3.1225928728566226 2.0848499873025559 0.1319596681425029 0.37557102167114104;-0.92144742517588718 -0.24510545286245788 1.7405967156361979 -0.29117678517426271 -0.54665503638770419 0.39723502116729975 0.014157920292166247 -0.462449582040598;2.1964600483410082 0.7235894860238139 -3.1281260066703767 0.64325335592105481 1.2387582848188394 -0.60046684799933903 -0.072474020690767874 0.94550105039670151;-11.731812931852041 0.79882019766956969 2.3955856868588805 -1.4376314704185456 -1.826588480813726 2.7881033582462167 0.39374573327269885 -0.44629299575965797];

% Layer 2
b2 = [-0.34715747696392807;0.91437961247322308;-4.2963155929201973;-3.6224178895182662;0.86750999821078678;-3.0297621993542116;3.4260694825592548;1.9262891884132929;-4.8137127386266041;-6.3889163679559866;-8.0944097299446565];
LW2_1 = [-0.10360654553131721 -1.0999133053464518 1.3220443579194725 -0.036230328134771214 -0.051797843763917925 -0.2053499599689273 -0.62270881762246344 0.35869715832993171 1.6611732580146399 -0.13883000192356168 -2.4580408100464717;0.13060511644634515 -0.47602478894385403 1.6638272845003941 0.19468836385457394 -0.82597974829538201 0.2956311732872034 -1.3518795596532596 -0.22007871078313532 -2.0810972388931699 -0.91353515112006034 -0.10896545976801716;0.36457222195811312 -1.5247228912239381 1.6351386625006035 -0.70433584454299181 -1.4228064753925795 1.1445373745131304 -1.9824326561088599 -2.2639344005439215 -3.2700237426388861 0.053336457919967842 3.5573067376608747;4.4213763529474273 -1.0777397908324249 0.52381842944841106 -0.2183392279386237 0.07745685108007376 0.16566366015800407 -1.7486384899945944 -0.039084192539981438 1.3399637068584396 0.75617722199623327 -2.055254264540566;-0.7306367798717136 0.27949993974194687 3.2028133654807505 0.34264350272664063 2.1250242756582196 -0.45528564396781879 -1.5063470979553963 -0.80826669692534492 -1.1534629095895135 1.9355960275696422 0.8829542866388862;2.0849474302632722 -1.6300633141110075 1.6557471054142994 -0.50085059784680874 -3.7014436705789504 0.16167796344349364 0.26779367209102628 1.1714536968101001 1.2240727607450339 -2.3509686272715973 -2.8296630978720438;-0.065641623775751626 0.11621165412208619 -4.2449946314838574 0.2054950682244028 -0.047553671648476799 0.55349350119008622 0.37691798751940092 0.36046410706115567 0.89663381090193084 -0.16389350998900659 0.49670333768875985;0.47682342216833384 -0.4082151435947729 -0.2057279838982673 0.20569154322340943 -0.47761123724498761 0.096234879243392649 0.15884893535017483 0.29702503706781969 -0.23615881932413871 -1.3881706704979657 -2.4257073214930354;0.85612803922999003 -0.87081894063760723 2.4243006040288155 -0.09102654778556446 0.1718770109456981 -0.84448673792732587 2.0691088010216183 0.43179678471510524 1.7576925360583544 -0.39111482821678201 -0.15776243177685961;0.089703273217770205 -0.029577945001897553 5.2249838973502829 -0.27331045324951697 -0.016098654732875833 -0.67347118345956603 -0.70774877261831171 -0.51818549174847883 -2.1242409565486371 -0.29499927142484006 1.8417435067421386;0.39483070279278409 -1.357948157625003 1.3164375326675064 0.78823502620139707 -1.2407628453800201 -4.1141937288961081 -2.0589596538510464 -2.1131739635578213 -4.1991836459058307 -0.12828030794679038 1.6440302595978087];

% Layer 3
b3 = -0.30108097178363208;
LW3_2 = [1.9870013455488609 2.0218133196283139 -7.5815506519603275 -1.2966948735041617 0.34881597054344016 0.16743559704112823 7.2350303085251007 -2.7067950491427935 1.2678083847569788 5.5939132037160064 8.00821819833177];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
