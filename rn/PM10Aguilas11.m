function [Y,Xf,Af] = PM10Aguilas11(X,~,~)
%PM10AGUILAS11 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:19:49.
% 
% [Y] = PM10Aguilas11(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.4747176094816057;2.5791688154934547;0.073571476964800347;-3.0764575961768674;0.62240462559775844;2.8145149272192711;-0.44315325700575187;0.058105623816233326;0.5663032340139933;-1.0355422672469434;2.5342244706622026;1.8695967374546032];
IW1_1 = [0.58383306614712038 0.27274004964044385 0.15843651946083148 -3.4346329173760743 0.76131974738869479 3.9702702046405314 0.086317696082322926 -0.1798477409933312 -0.0045996481600474671;-1.8145224647046103 0.084884987870602252 0.046795368071222518 -1.0188736558015048 -0.30219355079313714 1.5938187038575298 1.3586414692547328 0.11830959514092568 1.1369339771773834;0.34929311734957574 -2.3272875217215412 1.0766767580634446 -0.25546227146393607 -1.6113044507420407 -0.91156816500530624 -0.072332968256422533 -0.51416063838283799 -0.011754997188147561;0.35793924657279291 3.1847987701682108 -0.024444533303557902 0.47270369979017679 -0.62283287793295294 0.28600451020438994 0.15153673204419277 0.3311736722359459 -0.086552914011340451;-2.0034465155537209 -2.5276055249791742 -0.19756020755045434 -1.4488469543249447 1.3367950015160459 -0.49018964247455865 -1.2754545448451031 1.691080498391063 -1.6324142903305328;-0.7203978730582119 -0.10171977021990029 1.0153092502576677 1.8958502010982796 -0.0030264289787063151 0.3193043112195636 1.3685316653056572 0.0045140213959771591 0.0073234540238711144;0.11973380742176923 -0.021931584061909509 1.9695463962301389 -1.0468204184105017 -0.43050268224965349 -1.4449580763166459 0.68313441876478453 -0.095849878862135279 0.30439851297601306;-2.4338601444756689 2.5018223683336371 0.36002921577941566 -0.0095981783654759643 0.9575767262913083 0.60886161699791796 0.083481333802177107 -0.13242331424447126 0.10367375060679658;1.0492791736172935 -0.46636357517405724 -0.39882724465772795 1.6831804243142865 1.739979556352762 1.2368713700389797 1.129060945686337 -0.15023727920995747 -0.63233070074633968;-1.7691611434163941 -0.74666709461159475 0.78187358764274106 -0.22482854919827552 -1.9603842754067731 -0.38944588913729383 -0.75813484293323408 1.9539561060030615 -0.83300349576273525;-0.31386419994668469 0.43877131373792966 0.36352321205507526 -0.82225017549238955 -0.47857892534158836 0.94263525944464199 -0.37860147832614288 0.87223893973574196 0.94728595901973389;1.6386985148206463 0.22127891537841513 -0.91224644116633968 1.8016938019594615 0.10903362880991488 -0.19414672232539343 -2.0861109241746112 -0.06765672528827571 0.11722871459705547];

% Layer 2
b2 = [1.2250037501301059;0.73792665701369264;0.3701129973464623;-1.235448426985311;-0.19091613062847373;-1.3014684816502942;-0.027984820210838569;-0.0099820680238339159;-1.4965850123778108;1.8167188895399642;1.6652444740734682;-1.0389582233018888];
LW2_1 = [-0.36143785349961161 1.2232626571341696 -0.21517416295948399 -0.20876348197077946 0.41129578538419703 2.2740273492590317 0.19780711481220586 1.2750015660438985 -0.029995742633270383 -0.89937498484930978 0.21224774819783543 3.3121394505277344;-0.44685423894198778 0.35806238610542929 0.35715934868269095 1.4732593246404038 0.090750340153757228 0.19601832512889619 -0.3308430306610653 -0.10773155394305509 0.71094173930490268 -0.53513682611032631 0.94640999893397548 0.30244629186615851;0.32936870635564369 0.62588167910443149 -0.93772620353355063 -0.095894992737950532 0.33928656670371737 2.3377736910252955 0.067565939340010817 -0.76590017090765228 1.0395510944958886 0.44309487839235162 -0.070509631535365699 1.5027242909212115;0.07085964407263777 -2.2463511545273769 1.0185642134735196 -0.82739502992888614 -1.9295340989743397 -1.5012604287099609 -0.63058178097656292 -1.1697534899058419 -0.73895049937597301 0.58397472785295834 0.13796996501221478 -3.2436550952743204;1.5644994059693047 2.1799798969792783 -1.3492373361927357 -0.73761281537295886 0.11317180556184883 2.1155435618792309 0.288283552107861 -1.6587312659915148 1.3995546721285013 0.97608245471886135 -1.0164607891195199 0.85985059388796614;-0.24457684321690257 -0.13079241460958849 0.34809598777438211 -0.9105117190011679 -0.030953029651058835 0.98302384033298074 -0.27043455314189013 0.25040035257987892 -1.5761147251323675 -2.8961642796744742e-05 -0.69015021664721488 0.50483721963460937;-0.37576630534269989 0.29355278009402286 0.25722469018192484 0.97041270613883013 0.61223347130652428 -0.23772201086767367 -0.26334692102351542 0.1921477497449903 0.799742722831703 -0.38508649294857411 0.56829173680279732 -0.85823702537962698;-1.2237299048048143 1.3630451381914597 -0.035684287072389714 0.90733855774672756 0.93004999133164223 0.38376711080168502 -0.42102947810815966 0.12318782209559026 0.49895696028226139 -0.12903823997920705 -1.5515749961714684 -0.7949771804958119;-0.50140689603541366 0.57421081552299036 0.18574037863492326 -0.37076704102027946 0.021151167201447604 1.1632963728091634 -0.24071966857651503 -0.0064536912845164158 -1.2923606200848941 -0.21276175823133489 -1.3089470789470963 1.1622520085444958;2.3054423444276044 -0.27016696863139084 1.4458498880309616 0.38841619117987713 -0.95701378079890531 1.5168825971388715 -1.6899732096643383 1.9028526126492273 -1.0979740113358907 0.014565854323569145 0.51143180090655527 1.1764621791050132;1.6010360219184512 0.87837025576879335 0.64436164170356014 1.8631240840545016 -0.21337387686763445 -0.46868646100913314 0.34199866054340017 -0.15340953941281116 0.24677684868537009 0.23609540375561938 0.73595355392538242 0.56965100131002544;-0.647263139155282 -1.5419150564842254 0.21375324531219358 1.3159241609813923 0.48425230319197676 -0.96836688158239759 0.18875722877181397 -0.52759441330872803 -0.23687938237918699 0.33360055044138759 0.86062762726148134 -1.5705374722679213];

% Layer 3
b3 = -2.0671122353033722;
LW3_2 = [1.343855978596797 0.34942170096581004 0.32736203076429271 1.1333142783004615 -0.18245905851534538 0.34920337099971932 -0.24917083527358816 0.24644338664566839 -0.34724434279708732 -0.25824127951791631 0.18038736001836347 -0.83787382327509963];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
