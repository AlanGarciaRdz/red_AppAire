function [Y,Xf,Af] = SOXSantaFe20(X,~,~)
%SOXSANTAFE20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:52.
% 
% [Y] = SOXSantaFe20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;10.752688172043;0.00341273633199099;27.7777777777778;0.00632111251580278;0.294117647058824;35.0877192982456;166.666666666667;95.2380952380952;62.5;117.647058823529;24.390243902439];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.7269319510364733;2.355192508361811;-1.8401237319162929;-0.29609060001495219;0.38715479218585941;1.5912824401072905;1.8572510149524841;-0.35774712585183277;-3.18876718886695;-0.44390080596517151;-0.52732380829848879;1.0279073815925901;-1.4373530553694354;-2.1538971551352208];
IW1_1 = [-0.92514305499990879 -0.64900589816328091 0.22538007020118883 -0.40879603686040727 -0.44537376293206066 0.11040088458962438 0.17270614540669979 -0.33532678006316352 -0.23932665875785747 0.23012564744769293 -0.809090244399854 0.92463333204798004 0.13396286000021457 0.56163097899892556 0.44823752794570876;-0.62852884164065792 2.1858519530830152 0.49673216229164846 -0.052299812046821173 0.51534897884672737 0.4928087648030457 -0.50776186050014105 -2.0400923984100579 -1.8045255600932377 -1.3984627738921098 1.0785070137737633 -0.20750699908142428 0.15279921974551114 -1.1628445249178201 -0.4867691367150393;-0.71870441716563616 -0.32809285937250832 -0.0018763364646932302 -0.26385731236471643 -0.074679232679513097 0.69808613254610985 -0.10722298975396893 -0.09351248954562319 0.1050058575487846 -1.1666152499820668 -0.74355036186376233 0.055496288124251489 0.10217682072099683 0.12278268639327938 -0.81558683140989707;-1.4587513321295424 0.17857160595629448 -1.0607662638766779 0.064114637156743093 0.36971214671903718 0.37301663549636499 0.54148237300746715 0.16066130714053228 -0.085868394849314966 0.70839706266085278 -1.0270377400485824 1.6030616258818369 -1.2495033925756855 -0.063216989999127907 -0.63756219362161781;-2.1233118434637683 -0.18195089570388895 -0.70325457455209883 -0.17868101304118206 1.2831029883836491 0.74123298156577355 0.29590575489421855 -0.04274312881507205 0.66322203027576032 -1.3095098827686378 -0.64980453845626518 -0.2866933655435317 0.35680018966013888 0.018855793293685114 -0.86460645660626811;0.092841086280621127 0.07697344784422841 -0.98751573386860014 0.73161261408430711 1.1771960711499532 0.73705350931673752 0.82218118854535671 0.063185472570380458 -2.2565304905625521 1.1915201170548586 0.35743617304457753 1.0924476112146542 -0.49232670240428761 0.29412219703429748 -0.3114674227377297;0.047857800726314757 -0.043004215233755819 0.26793632523515998 -0.47128871591231675 -0.77730112991879252 -0.14827514302394518 -0.70820113312393618 -0.020113825777765191 1.4136985423023587 4.323688038009557 -0.24896141356037593 -0.84055878460174327 0.54891238809747422 -0.14686726803350619 -1.9310073352935295;0.11970641042988903 -0.48165912227898844 -0.47287311223344203 0.9289487485165433 0.58546630390141741 0.54212376752812197 0.64138084850327826 0.35468785721610008 0.16888349535652636 0.023688010239908353 0.26403762018686422 -0.38812513608442822 0.50918639241252672 0.14704618702853658 0.38831377577053616;2.2579478827298654 0.26776366218047942 -1.7100916678854614 1.1395634420100982 -0.67232404110620125 0.17089237532033213 0.09944221877741985 -0.54357649467050118 0.45340974476745183 -1.6673374474661411 1.4329894817689761 3.7387998857678371 -1.0783549192384729 -1.084265400024526 -1.9958551089669612;4.1143516631748387 -0.089825257135528747 -0.06132860713092847 -0.10674199305017334 1.1221878045245266 -0.61721891384514749 0.09273411444004058 -0.16428449502392051 0.0034674526164067965 -0.36355220544272115 0.76175792940576559 1.6423027517152806 -0.51410855721800297 -0.57015265313906205 1.2601570338356971;-1.439662182915165 0.22223944119556971 1.3434708084492597 0.76404600028701752 -1.4799169669541621 -0.72870559436526916 -0.7066831566351367 -0.91510333340147276 0.44828973068844136 -0.65856128371326106 -0.41708502180232976 2.1573745523339518 -1.1184582262192235 0.36372800659065191 1.0938268829438034;1.1005084288445459 -1.1041179278444135 0.6046088182400472 -0.59986259654628382 0.28639569739513687 -0.56620555767006531 1.0565014477290811 -0.11713795039103542 0.16204932912183317 0.45512705960966349 -0.093054460102318243 -2.0603391339475623 -0.14810140634564584 0.22306107230932137 -0.64287958689201363;0.43518882712419815 -2.0180401445703917 -0.033168641222292891 -0.17755527622523387 -0.63674902729478833 -0.37736418071870004 0.74753374914894455 1.3413210209923652 1.6801352819530804 0.90154718424932823 -0.091404067739802725 0.097966900617981301 -0.10065054362359126 0.51590079537140265 0.54680068739220644;0.12359994512759884 1.46651112857734 1.0733611625292419 -0.14141342490376596 0.487937777665441 -0.054619416970842813 1.6918918104387901 2.0792554119089282 -0.31997359704329342 0.41868465499406216 -0.2701988791007055 0.62828487991814419 -1.4828456620617698 -1.1622743539789215 0.06889506808292363];

% Layer 2
b2 = [3.3226832810463827;-1.6253510134720468;-0.67119198039162231;1.1832264172787648;0.35449477636284593;-0.67796738573539228;-0.21209361048981851;-0.22640758259877591;0.77011259772532803;-1.0148021338301223;-1.0732059633051907;0.48330233244575183;1.0526176444281949;-1.6875510443742561];
LW2_1 = [-1.7098075844819332 1.575828672621578 -1.0920495237658172 -1.8867142721824579 -1.9153823542730568 -2.6276769916453007 -1.005264430635499 -2.1606748571348646 -4.6521277309965692 0.60632241324707248 2.3621817294611369 -2.5002962256219945 -1.7586357020264487 -3.4095717612186522;0.38856838498202717 -0.30179789297861093 -0.18221541717708337 -0.28384413433694106 0.50504908235445711 -0.15349639982437036 -0.56182575560696746 -0.13266512270625674 0.62570047016021868 0.1994431483999346 -0.15141188618067014 0.061372516801845245 1.1287709293178219 0.39198414026773809;-0.23051773116949931 -0.066083978769884422 0.6871862225611034 0.16775762831933744 0.59625811323627032 -0.89190036344022849 -1.3664762818341603 -0.54727523371001763 0.85700434329460029 -0.41404882165043938 0.89499142335832971 -0.41119779634056058 -0.83679687537781633 -0.3073344877446802;0.6952444420724071 0.85000989909708469 0.15847254165268704 -1.0451503098429409 0.38206927029847521 0.94042858593597112 -0.058134435964986131 -0.50442989269817262 -0.62376573066460139 -0.04121723645951398 0.18644412679755401 -0.52720442210420126 -0.8513392659628316 -0.78264907837758924;-0.5168715333854218 -1.1341413590278249 -0.33832117592427402 -0.74755928345875144 0.79500044318768226 -0.098079405192462277 0.92486300534466281 0.93686895891536337 0.40186171840820117 -0.042935921884201103 0.62609715704263913 -0.27945433927208485 0.42627804433166538 -0.15533520351541072;-0.26004958265873213 -1.1855684182023114 0.27508989481769641 -0.72472733696591751 -0.7000664171548483 -1.8277797810543057 -0.6173939867984708 0.63776133395300094 1.5370425880272425 -2.0300855460404397 -1.5528529744724322 0.15132191103550055 2.3685338369944287 0.080987595746999291;-0.967416841153656 -1.1134679831683889 0.14620407363719082 0.24115280846561679 -0.46306232801174008 0.30734487408177424 0.85084098302582389 0.85133764045650062 -0.49326495788118468 -0.21293188476707184 0.69558847466015827 -0.18847163913827608 -0.14870734269505725 -0.36282137880622645;-1.6748861322990587 -0.57068788644616519 1.8086201754068409 0.29493002461876061 -2.1832058158255725 -0.12348831125053222 1.2402227177123604 0.28298269263548936 -0.16512644216186861 -0.90144443121444751 1.3180924695341363 -0.39054698297525969 1.0111674800844028 -0.61723741928323905;-0.03070745916874552 -0.35320925842361844 0.29394631278306393 -0.24775025643401674 -0.051831921881117377 0.91012973865410129 0.0098161297972065298 -0.56322663383550309 -0.8331086006958095 0.66833570380999419 0.012958949141323034 -0.084122760831405269 0.75253517725100538 0.050185198847100612;-0.44716927709353688 -0.27351277668375457 0.22950725005149375 -0.67704541967221032 -0.183455891621776 -0.31178124542929359 1.7650219059666064 0.7282957195560531 0.94645052718946421 -0.96273064300981348 0.066861785903866322 -0.10872647967228576 1.3638845679976503 0.15252238431964557;-0.60477921431678638 -0.14527936808586539 0.32798814676407323 0.41183447013972468 -0.014166806096424275 0.38213845723906803 -0.24667364771749453 0.62587701391544825 0.18727418566670964 -0.53450002937741792 -0.3293351534519342 -0.55925796462663435 0.5317429404057018 0.7560739996300101;0.68992900623798514 2.166793089497224 -0.39878195893996493 0.66661916585787873 0.057827436233211363 1.6486463362545076 1.2277920977352852 0.52745961748195891 -0.58630418341126933 0.8002123163743482 0.79220429470900333 0.25223859658787989 -1.2956378587372392 0.5358976950619404;0.48554028891840961 -0.070197678203890806 -0.42070577876253845 1.0639427620950264 0.17812920572447993 -0.25246839283654865 1.3129167614580741 0.041240963001244302 0.99343821218204886 -0.59807727452487225 0.5489718951292436 -0.31285065138003343 0.76987979282355878 -0.066009221389537465;-0.62095688267891502 -0.56400886899558411 -0.15457889217297108 0.66829795090273114 -0.64027213641964009 -0.025732323231297094 0.53900339466444536 0.55107035807323923 -0.052764074360166287 -0.64317189020866117 -0.021726455014599785 -0.48541630031413024 -0.13912557206918849 0.14554457049167557];

% Layer 3
b3 = -0.20591439097804137;
LW3_2 = [-2.9681606595944316 -1.3562124925766144 -0.069744615649536643 1.4574280923254068 1.4495686085908734 1.9115479854229116 -0.59468953988955353 1.3949842964619334 0.048065318641839591 -1.5269137017533296 -0.072778367464668814 1.8927745770310893 0.045251518277770873 -0.056765530518528846];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
