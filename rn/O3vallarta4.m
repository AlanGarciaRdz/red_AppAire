function [Y,Xf,Af] = O3vallarta4(X,~,~)
%O3VALLARTA4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:53.
% 
% [Y] = O3vallarta4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.12820512820513;24.390243902439;0.02710027100271;0.141843971631206;10.4712041884817];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.5678443850397348;-2.8121521221525083;-0.79761392439165069;0.45774699547385783;0.95205361830043578;1.4772147852441402;0.84113156053649873;0.21851457852984049;-1.0415284539411318;1.4151068705973247;1.0999688337604296;-1.4532879363329767;-1.9479126278130308;-2.5993616961420347];
  IW1_1 = [1.3636893821013405 1.6200660233468112 -1.4805679442002007 -0.97415971057838879 -0.30945710675969706 0.69836267272367758 0.02590161134239986;-0.14151807178749631 -0.68777341368900091 -0.77503162493243705 0.10805641225939051 0.46951387700614933 0.10343422098564596 -2.5139945266187329;0.86317715794251471 -2.0431269637811211 1.3570855016221324 0.040512382861158241 0.69268345292700317 0.1116432083523347 0.11259995662561999;-1.4969196427361142 0.026840173307883929 0.36799571006733695 -0.38826419336196821 0.73310250798471532 1.0287795811290821 -0.96549804227400771;-2.1446513633568363 -0.073185761503393537 -0.92496921694178935 0.9725474399512426 0.085942934152401049 -0.13518499951322754 -1.813379021205294;-0.91640088221347948 -0.51986082858813198 -0.48358479456315728 -0.50892944885330482 0.76803431890099461 0.41615685948320125 1.8824336019073529;-0.21919651282533659 -0.20635332056306083 1.3140461092932825 -0.096443478452390555 -0.28664171448485981 0.67418206548887094 2.0956630865696293;0.60006661782006487 -0.89250200623285281 -0.56986064242356682 -0.86071255938460178 1.159611815694132 0.015362210167645817 -0.77482183179400943;-1.2752840625586779 0.4814505550762323 -0.29896584747261107 0.4625369472441983 -1.1845272836302767 -0.51428127488714193 0.19255673557799219;2.5944986001150236 -0.16675498887234216 0.033822353563957928 1.1910519831417863 0.78177280209423838 0.11066165617405369 -0.14891591061014328;-0.23431567467335318 0.70427078523462938 -0.1982984229604938 0.63796072141751792 -0.69039674267309481 0.082047109978634486 -0.41598675312023631;-1.9603438003033085 -0.13594783822918438 -0.0051558438635691678 0.088255676730813443 0.097094731939857182 -0.034221493151143909 1.2294021180237531;-0.79322903597550887 -0.31031706066231729 0.87303672342009397 0.60860991631962258 0.82304404945152387 1.0279965904899406 -0.36575268864326299;-1.3584547438485937 0.78041535109410631 -1.436917065420241 -0.15763649828438664 -0.55030266004871231 0.45202199168157231 0.2697046783101969];
  
  % Layer 2
  b2 = [-1.6333136048336176;1.3823860478595491;-0.90852718174219915;-0.53895289077743236;0.94565875293226054;0.23410631438449578;0.24107856052710094;-0.48406781304198093;-0.19026574164759627;0.64560737743330632;0.90982838672668487;-1.8036715574273166;-2.6834334263855815;-1.6344175955983737];
  LW2_1 = [1.7627787822903833 -0.1528433758633938 -0.079524910291633014 0.1490381886365694 1.0054296377241763 -0.7529553603498701 -0.48849460793269672 0.861046627732028 2.4267743559695862 -0.77328153866028437 0.048506335215260293 -0.25571742175133472 -0.16972076742300718 -0.56494257989480934;-0.22768192115932531 -0.38301363952706086 -0.20226010990576582 0.33865816140938909 -0.86124469069410026 0.9193226902203554 -0.050414477539691471 -0.60084173658011675 -0.011183516092260527 1.6950025866220828 0.4859549306658657 -0.3864834100270555 0.50334766591694202 -0.21835452742375464;0.23837691873655473 0.083032238445960291 -0.15133169878116254 -0.75569774637255882 0.70499292534869662 -0.68765585797218165 -0.33695599390135139 0.68252030862196233 -0.76627930286279855 0.61265139722581752 0.11504393842021718 0.059710731659137803 -0.45909867852716779 0.80149203395726354;0.19027171808609128 -0.1376354024579331 0.25857044954704334 -0.67101190637914687 0.68383825548882748 -0.24875708373131197 0.32492349058510839 0.96309169441173303 0.088392500655404008 0.53882351983865417 0.47234508558282851 -0.031811252821524104 -0.081566431649579232 0.23325073696673784;-0.0078877762716611944 1.1810049577464086 -0.038902189808754067 -1.8979708750813971 0.2278117243399719 -0.57267277057982147 0.45699615964149115 -0.36788312398738826 1.3722885079684775 0.054724923801062406 0.33004570001387273 -0.28949185057179339 -0.23262161516039803 0.61563905830872279;0.78663575353083171 -0.53119746366260989 0.082943306080425008 -1.7912692396579895 0.15714071849890773 -0.24592968270292018 -0.51340270506431585 0.020347232035988552 -1.2288900878667011 -0.79806771266900756 0.31904477646148693 -1.4878190606035784 0.63489115584156219 -0.63348222114164121;-0.7363093158421502 0.40009872867709839 -0.020502811888469696 0.86787510280518432 -1.0282205495241479 -0.32996524007951039 -0.4934752494282803 0.92289548595653115 0.15179520728278204 -0.077197008165454273 1.2672288624127037 -0.97935511465175773 -0.3155736997582862 0.71532378835180954;0.66371943982876047 0.51195562626336022 -0.19352321574270112 -0.49385940065229184 -0.30111864488362766 -0.018755827454543711 0.54243825461305628 -0.61784227561643423 0.23520466400521256 -0.29180818748149423 -0.76408163283331543 1.1646658351916892 0.16969296103552545 0.24475605013614771;-0.23280951745359038 -0.65007568847649555 -0.61785091967552852 0.38348974127353569 0.48540755271623021 0.44103582548728226 -0.097325208069097668 0.8996002756671051 0.48380303115809337 -0.82334569728585727 -0.80956490893067157 -0.39316428042152707 0.41334260448674204 0.577585647656226;-0.034085882036920215 0.73744062837670077 0.49006112325195372 0.1390801708029776 -1.2407294872554713 -0.77509022234643499 -0.85680348754107005 -0.2895762257186611 0.31500288108209562 1.1358200296517846 0.43809044806435504 0.17994893184754959 0.24072815394163791 -0.11308233395883435;0.39498316442810316 0.13580654771191628 -0.17973393270631979 -0.41701382366090289 -0.0043691066335299119 -0.97719526228079534 -0.64633078781491182 -0.34672383076543084 -1.2798660595537297 0.12772690355158914 -0.0055149181705410194 -0.0098814042394645071 0.21328924574116456 0.60957492997321072;-1.6379904822084668 0.36582196570328457 -0.7287133027047733 -0.18121379767320731 -1.3418652163584541 -0.62329279428045481 0.30493139536242841 -0.041314931551557833 -0.3440874831024614 -1.0693104303112182 -0.60435597168921718 -0.48884673378761834 0.95137647624481081 -0.62063048296071488;-0.58220947665334288 2.7273823890341964 -0.24827179119827167 2.0990725047145791 0.42558232486755676 -4.4521661541984976 -0.47313041992120553 0.90385265292044636 -0.92772610307724224 -1.0386891009095323 -0.28104535724840846 1.1361512217625922 1.4292100446430682 0.11004645933889178;-0.72746114046146204 -0.70738825480107115 0.83284814047367983 -0.8302428845390728 -0.64675218471946183 0.20893924064343092 0.61134330124294689 -0.55749234635857825 0.82113833480800857 0.26286074552494942 0.50578357766566029 -0.35191295275768764 -0.028542442298552941 0.28038332215312295];
  
  % Layer 3
  b3 = 0.024924324405803853;
  LW3_2 = [-0.16145901870371085 0.43940688682801038 -2.118384735333104 1.9551730694944154 -0.16986987901700665 -0.39147527995752529 -1.8102691079630242 1.1645792850967669 1.5191855629134525 1.0992198497568586 1.1211575023977416 1.7762577618890967 -2.242980133619326 -1.0582553543044051];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.4712041884817;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
