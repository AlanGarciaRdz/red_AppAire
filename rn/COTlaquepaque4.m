function [Y,Xf,Af] = COTlaquepaque4(X,~,~)
%COTLAQUEPAQUE4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:12.
% 
% [Y] = COTlaquepaque4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.171659085057077;14.7058823529412;0.0212539851222104;29.8507462686567;0.0523560209424084;0.00624804748516089;0.185185185185185;0.448430493273543];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.4881766537065233;1.8791705301851014;0.23467612664065654;0.56881101568280323;-0.76785682476339767;0.34534891291227376;-0.22354140991778437;-2.7454291979202359;0.41083606042051257;0.60202647482694793;-1.5263250805633488;-1.6041656725243694;-5.7668325463432693;-3.8146641679229711];
IW1_1 = [0.13248082943713974 2.9940054623360055 0.057101565375644557 0.049579474612196146 -0.085534392483083393 0.034691638398829203 -0.44051634820464097 0.035551764663600403 0.024337099343905516 -0.073452145994993306;-0.15287669733039702 -1.3731728049655894 1.1870260156606918 -0.46774159068545335 0.99335588316557744 -0.30893194099577537 1.3814600209285279 0.87779270871569481 0.08262843143909479 0.099172723396625223;-2.3462891822511498 3.163790623986507 0.98309040862357711 -0.37552940325608747 0.89088854330504164 -0.84357436483366799 -0.3608559923908588 -0.67427932173304417 0.20423535543304633 0.109485449054436;-1.2155001265758976 -1.0117454364676368 0.24308860569020577 -0.045108638780448303 -0.26823252370212958 -0.48744734957027053 0.28073854660015851 -0.10561571158776824 0.21034239858820353 -0.0038412027644162215;0.29373677411971322 -0.98018378136559225 -0.58002954554522745 0.18005673942520906 0.16274442289930924 -0.19750836968461127 -0.2970208689474742 -0.15055419589456662 -0.031721143172619627 -0.026766689887378896;-0.9573628508446993 0.16505085314667858 0.13829739386331058 -0.088091322385187104 -0.64025786369068771 0.79148207644714919 -0.90459194088247641 0.21157965362775 0.27614951112070013 -0.9322757447545319;-0.96571776499503381 -3.0224979149644011 -0.80122066743870013 0.17188016020633612 -0.15798055617902931 -0.098225722594635148 1.3230324305647529 -0.14236612371370111 -0.14096215641932552 0.41496799183028155;-0.15791428158899681 -5.1717498758381542 0.09553989353635714 -0.28950735985915921 -0.19414728857605942 0.073304321741761963 0.12451416297991003 -0.0061019060149676693 -0.52459954804778919 1.035610109800273;0.18039367172197951 -0.25159692549836837 -0.10813842977351316 0.21974629849054164 -0.026746518726817079 -0.40413186372073717 -0.97253310903900692 0.10750770433926879 0.58739362471425061 -0.65148366319188655;0.31933882759718518 -0.96096835990236706 -0.44211860731407526 -0.051491496896429748 -0.3069791151805446 1.7754879851531806 0.78346479887023845 0.077912740780556294 -0.16336068349945407 -1.2976514349791295;-1.6930458288045998 -0.56987092569811326 0.6992334352096623 0.37789397387460999 0.63511047060266623 -2.2262511324537519 -0.5040816739377082 -0.24865522812755642 1.5225686863789472 -0.64615538464841649;1.3340492580928411 0.38340837990172927 0.37887752967029847 -0.33827152587203169 -0.10925376122045109 0.37468660217237809 -0.00081220537613749255 -0.150521293310593 -0.59100709177226596 0.48609868896212022;-0.48611253277090621 -0.29069599886200564 -0.11930099496238741 0.091197128405148042 0.0048638517106357479 -0.42717872847674476 -0.11903707451983329 -0.099032987471994058 -0.37746845253334183 -4.0504932075627043;-0.35498481517207592 -0.15439719462313231 0.61073432903981895 2.3262075660257242 -0.1841835406326503 0.017312143861355558 -2.7857093845271335 0.09849064994069355 -1.4549038736158313 -1.5320848299133272];

% Layer 2
b2 = [-0.62067561663427773;-0.42231029184907964;-1.90338672059995;-1.4492938602044549;-0.15208596762200871;-0.70729252230179773;0.77826072859057782;1.4343079199976978;-1.3823666712838096;-0.65752563167714417;-0.73443444673089586;1.8288543601688219;-0.90819857480425192;-2.0328343821894062];
LW2_1 = [-0.15084514982399283 -0.15173534763610716 0.043537111752678263 -0.37083626716205337 -0.70725534886620578 -0.34379714496588348 0.53600644930064356 -0.14812436273911109 0.47958205951042054 -0.18580402511607921 0.034484506429570974 0.15377888205875462 -0.18396274175584557 -0.041180780562807696;0.9568907148294733 -0.17639497529548373 0.027537128043457728 0.064897589310654813 0.36151065278583766 -0.30487824847934397 0.30557732055117059 1.7917008954071918 0.85156401639447443 -0.20109676032348006 -0.14454995733065962 -0.20541735895220753 -1.7947752238097283 0.54271372857023303;-2.2725424264643648 -0.89771041892469539 -0.5398363891046386 -0.22072989738532522 -1.2738906318770937 0.12232989403330836 0.042039698540543888 0.097522134624863699 0.083143747436721094 -0.56301473327996943 -0.34683588134692039 0.62581645296664346 -1.1829828307053738 -0.56115843519721242;1.721873292412611 0.59353055133079591 -1.1647117214932239 2.0682229855041339 0.087007974725826484 -1.9939182792616499 1.1104074387129366 0.68670597870804784 -0.24162447810664742 0.074841895514542803 1.1880292254165203 0.35433650268729322 0.25666541029365508 0.49448679411171187;0.52906745116057896 0.68349143295858028 -0.28238538817865955 0.74898045635758315 -0.39429771956398474 0.064653901642310233 0.49294960824187384 -1.1876182494683669 0.046473561916862006 -1.598701735303883 0.87973981994313899 -1.3982462620111022 0.18228604358983569 0.33286878121507008;0.75509043375215401 -0.23647201357516479 0.22791855735152874 -1.1474804191013015 0.24644710175597206 -0.20600866785712182 0.55392018348947281 -0.12317202430783146 0.89835499401723795 0.97097623963894653 0.64366867371669401 1.8820667657311829 -0.34367638168020392 -0.42783356552696722;3.1763341877768227 0.68458411679144249 -0.74846042799376933 0.32953035124269275 1.6480446460541751 0.64984656250830253 0.82745113083750921 0.21019516019001017 -0.59672253852702206 -0.01614563769431324 -0.10494690199249045 0.72752024834574469 0.99388589423502971 -0.19976188361542629;1.474831435358422 0.49820869423975411 -0.10607940333722272 -0.040213516520457099 1.7593309448571814 0.49679005053344916 -0.082503378382893192 1.6881738256611811 -0.6938221513255971 0.32951988637035434 0.070085313271808364 -0.41007422886554851 0.6172142487167892 -0.21120532378212778;-1.1680085862926426 0.0069706460951703148 0.69731618148082641 -0.51241528940439907 0.75269183681234553 -0.24011231790492499 -1.2412089945477343 -0.77814094974920489 1.5236423824200001 0.11539440631238176 0.16312876956620742 -1.0627832951958747 -0.96182983728514848 2.0871107591283846;0.27977996252952214 0.10181476693968108 0.070384866677409424 -0.058543022474429968 -0.032616130847722191 0.16684979605564068 0.74735483369429623 0.4023904810094851 -0.16230657623723163 -0.68875433592978463 -0.1106531195392831 -0.545742245571322 -2.2047822939432407 1.836378527429833;-0.34302775590356799 -0.21671524935578154 -0.096840462144167305 0.90628980548088267 -0.035269171768402087 -0.43826030366651825 -1.0644454248101667 -0.28658455924587356 0.74596109121929766 0.65506875859498148 -0.11276707559039739 0.78002231952495027 1.1462180857941353 -1.7800078890042639;1.5923069481921974 -0.0054868686610810707 -2.2834618308902632 -0.41073023508418088 -0.41060383268764988 -2.9560180095451623 -0.62784061359764842 -0.88032425495788524 3.0588953722081822 -0.1270444685838838 -0.53058177542921414 -0.76474427249944832 0.49602394066897715 -0.19985423096943497;3.1555765590985607 0.62249719018107674 -0.078883858075004323 0.3723037263717674 -0.95040692601981569 -0.55770775586240517 1.0044278995962035 0.13748767715703089 0.038681043842214588 0.10593752429126382 0.3712109778726615 -1.1217357898100788 -1.0749241769552065 0.6056197165897409;-1.8147541958905928 -0.0604148877628468 0.6063945922278402 0.15741217477667374 -0.076294091662415936 -0.71162385492300295 -1.1762939894319766 -0.22092529690370372 1.4521999930947838 0.17759976830480842 0.059459141308379031 0.20931263454294158 -1.2164797751952614 0.039309355030188335];

% Layer 3
b3 = -0.96255207203082371;
LW3_2 = [-2.3582967003378124 1.3216224142182718 1.3264612521973125 0.24405646541118414 -0.42851721008034116 -0.43294356262419464 0.94253627406694718 -1.5779602641303407 -0.7226589357422164 -1.9036587920433885 -1.891025749217379 -0.40003383916779278 1.3903141376072805 1.4317879304165109];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
