function [Y,Xf,Af] = COSantaFe21(X,~,~)
%COSANTAFE21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:10.
% 
% [Y] = COSantaFe21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;10.752688172043;0.00341273633199099;27.7777777777778;0.00632111251580278;0.294117647058824;0.448430493273543;166.666666666667;95.2380952380952];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.0509809348754446;-0.60735389025769759;1.3002398333144896;0.43285807414100735;-0.96774164884677771;0.26678448252766318;1.6116143605754403;-0.81061977408971453;-1.0543596209543606;0.3428048670113481;0.4130725511452642;0.99945995471206206;-1.1795511948525148;1.9431153117111311];
IW1_1 = [0.91545134173611975 0.091437495772839703 0.30377938602632126 0.19514797871761386 0.23329420315372232 0.013802039646626275 0.14175384861902429 -0.20171006703761774 -0.20626287429377513 -2.1156367109206973 -0.58518135949493455 -0.07926263058035192;-1.8960617237098727 -0.072013320932151612 1.3386094980516412 -0.68581989725687853 -1.2757006523567851 0.42031019010828408 0.18153213863171599 0.4091680754825035 -0.06110853613938131 -1.5490644313157766 0.50736377380930298 0.075958611082736674;0.75018312291677869 0.48122599833189167 0.8408684756799869 0.35518180717163805 -0.90379949806731164 1.30324205014793 -1.2771894960847381 0.011618947614869838 -0.40596524662637512 1.8986539126817108 -0.59372713256251175 -0.71537883579853967;-0.26279723403294658 -0.25265147466828536 0.3453888447847081 0.047123959386800071 -0.55248581873745273 0.44254852643310771 -1.3193974383409917 0.10783092273331363 -0.17319507426003158 2.481219424525297 -0.080481431395938025 -0.17113066024350848;0.96710388061685071 0.27575532556374083 -0.24257885442364133 0.012266146356910337 0.30733325787371019 0.45996545066397182 -1.0068599280552524 0.44420645874716302 0.24568334402629932 0.15579630144143833 0.13656653367825988 0.14150580895277348;-0.34383325501599182 2.2915118187754433 -0.12053768351525988 0.13141355457521778 0.077815247329925175 0.38362484215870452 -0.17860421349432654 0.22127942123762898 0.06107653750127616 -0.24310891980780022 -0.096316314317035939 -0.10360946093985351;-2.5069067164214238 0.56277096391648507 -0.33297725455538185 0.81413515397825431 0.19831714648921334 0.60477455799195579 -1.3331229378014982 0.19733808558978011 -0.52696618267220585 -0.61811492704072879 -0.61142987201981069 -0.22581738106515412;0.080824962760772334 3.4637089119205959 0.10241959613840293 -0.27883546173158341 0.22563765423826462 0.17202622180335905 -0.24207974417528599 0.016725369878661342 -0.032202767902003673 -0.13592973602180639 -0.098576018557351375 -0.073539203098273817;0.085340905292564717 -1.2908034715506522 1.3307889482715918 -1.0543678627617326 -0.72411637622995295 -0.90249446423913682 0.48170681456611153 -0.61793913725184635 -0.094559390324893008 0.38189624240714937 0.049576766127613241 0.052882602370188124;-0.35763316542315093 -1.7969771871384503 1.2243784312570958 -0.51846319500984406 -1.2122541411798828 0.77260970072652801 0.12964159621400395 0.68887687366900563 0.16344211118134511 -1.3270030321164841 0.21337762218652331 -0.35023405838040261;3.065270267299872 -0.39385441978192859 1.1644630280495898 -0.87369402935896823 -0.73190331573746803 -0.67054236858937977 -0.53209102904293926 0.048399232646475242 0.34398289487851391 -0.39654941992549425 0.44810848684962268 -0.73513099244047242;-0.44118249161055345 -0.083273368677182519 0.71563470582472644 -0.18944874612928755 -0.75077177627553604 0.24334313070634789 -0.057644811467067562 0.071120557074424093 0.14435507173255865 -0.046641507148964853 0.37431693714191905 0.064917989667165318;-0.60763374749026522 2.0076563226796966 -0.32397606966421627 0.38388679973620615 0.19115316591332523 -0.0091641294545272735 0.4802188390428358 -0.35817436582364603 -0.25127692441769212 0.071258031896425919 -0.12118370712635983 0.072115658484773082;0.1896798941107608 0.36874224085351692 -0.81127098471426329 -0.96554865080196239 -0.057307007825200672 -0.23904511250193849 0.068807565715608268 -0.024086507924308671 -0.83259207415730052 -0.017680491904127984 0.8219608673864417 -0.79692114993553509];

% Layer 2
b2 = [-1.6478423314907487;-1.5039584020290109;0.50252551677408874;-0.22945667779197626;-0.77874361009644466;0.10575762903140759;1.0187201027964239;-0.18570794176092276;0.31878315067540519;-0.46064523107496375;1.1050792507569795;0.62731700759364306;1.2372541317579859;-2.0633551612926473];
LW2_1 = [1.1217056774002025 0.50219316099827604 -1.1467039319848178 0.6523342277687878 0.39488027707457385 1.1972075331224519 -1.0136088023149823 0.011399691277018745 -2.0428972002300663 -0.57519021260170411 0.096784334745788542 0.085994226946683475 -1.0777395973275634 -0.77436469369467054;1.5410896938316176 1.4513823215437378 -0.50714569226336881 -1.34852106406251 0.34213748556873025 1.2882895018814842 0.22219780658071447 -1.3480639127595622 0.55667476728923948 -0.19172494925847683 -0.11629525829185877 -0.085702438317516366 -0.10598282841039121 -0.5662931177976761;-0.48496039855591222 0.21247442909624031 0.60124677349153399 -0.30037343317105503 1.5753163575493845 -0.86526948344593402 -0.43907452219401805 -0.046008192525923766 0.46212385426708796 -0.42768824669094441 1.0838667136376712 -0.42285257033505991 -0.84231332600125108 -0.99166506336242277;1.2612869512782383 0.33544682581980129 -0.42999159169877599 0.7028237121708818 -0.49977498104638951 0.21295591932096181 -1.0369645620538697 -1.1967421513459287 0.25656808278276533 -0.59337883179771367 -0.073201528726746665 0.87181507164663485 -0.44902014258508904 0.59404577665335079;0.093716457493222174 0.98745603664768145 0.19941739764792746 -1.9490407384561439 0.41193694758384969 1.4389370330745133 -0.29703986042856662 -1.3430261870648725 0.54974369186438132 -0.36993933044825356 -0.3800369193442551 -1.1491603647734923 -0.64492759431515412 -0.70806652391481517;0.19651308878018112 0.36231323664350368 -0.89202537183641317 0.31854538718200776 -0.29358611800508116 -0.74928007419228237 0.054232387011475786 1.7866202796116561 1.1786369327878865 0.071514676007440811 0.057485109551204776 0.48568172096896528 -0.7967224198217272 -0.41319674430759834;1.5065226521993895 -0.43173771880851042 0.21077729455468042 -0.25685890809122902 0.57459939992589237 -1.3831116080734707 1.6804125630896412 0.47771658144504858 -0.10169829261040857 0.81747212463166818 0.13544033561274926 0.80516766821005048 1.7797531075877606 1.5922347480601473;-0.13574444014205966 -0.33915949337825319 -0.017964863138242457 -0.10212590985472703 -1.3252543074192864 -0.5925872297956688 0.089944473916855588 0.77312310964370357 -0.80372818734452678 0.32136683322630766 -0.76147610048391379 0.52676616931100739 0.40181748765287129 -0.10205177275764651;0.82016785215658616 0.16192988817670731 -0.25319984430809034 0.54276222458121426 -0.95188948263519757 -0.96370914367350324 -0.57798412423935508 1.9322284709507827 -0.42414971614614461 -0.50650817087046884 -0.093885730766049558 0.99895704119125295 -1.1243161468001244 0.72431056783784797;-0.83035975032296183 -0.33765733630815403 1.0528838588620064 -0.79203411318520167 -0.1421682623396619 -1.0036250299286007 0.038753542986667139 0.36612655549696216 -0.46193238689289118 -0.58198378469837242 0.69554623855651421 -1.0975293171710765 -0.34554016198498444 -0.32192324497163533;0.89798391618687479 -0.37714140148619479 0.95618821110551178 -1.1809470648454987 0.68660210938062149 -0.99838851783727633 1.641392608192596 0.56522946396586904 0.057264672195133016 1.0676200704887906 -0.36031669039343583 0.83484604768180815 1.6123535599867906 0.36925975582636278;0.28806068253654127 -0.050979110266559872 -0.57210124442007571 0.39552993802195702 -0.85500199454367709 0.30208960462552187 -0.53439048405372913 1.7381348387456317 -0.25856816247499487 0.3179222861256466 0.34328804415517195 -0.82956093310670731 -0.60321656869778195 -0.20808524675170303;-0.80086227295873258 0.093993820851630439 1.1285763435242822 -1.1066441133031701 0.37520119341247277 -0.7172629749369126 -0.49421594050216 0.1445848018957816 0.25066005872089581 -1.00710248526597 0.59162837408828972 -0.80824126352464343 -0.8497831691682638 -0.80673451651410111;0.21961904969453658 -1.9340005217097251 -1.6672682217882666 0.03405307713145516 -0.41399772863933115 -0.81756936604376262 -0.30782792462059133 0.23517620778421167 -0.15500131478685647 1.5623354505883724 0.69382064739728 0.12845137980146082 1.1437547788044979 -0.73658788651775986];

% Layer 3
b3 = 0.42425299061366861;
LW3_2 = [-1.3457638437423816 -1.3412196069435898 -0.86495784067898684 -1.1930350889051422 1.3772304216021438 0.21539800449700083 -2.9931844066782061 -1.4010606246532855 2.0002933830001708 0.57201510694621849 0.74945945622987586 -1.3217123764478584 -0.47769522472812415 1.6645384954717461];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
