function [Y,Xf,Af] = O3santafe8(X,~,~)
%O3SANTAFE8 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:49.
% 
% [Y] = O3santafe8(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.172786177105832;4.16666666666667;10.752688172043];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.0381399085317824;-2.602560546616131;12.063052137127842;-0.14924967578387535;2.2147351867544054;2.1711041287753869;-0.30351340536818433;1.3114591337322417;-0.41306630202041633;-0.63866499019429668;-0.33521440326307494;0.43646843121374207;-2.1489226141646358;11.395981989279372;3.4183904811863899];
  IW1_1 = [1.4786637899393196 -1.3536833890955977 -0.040815301320638792 0.71545389978816487 0.78603815309988834;1.0710961503376688 0.69152946956193917 -0.93618608600806485 -0.37885965279101785 -1.8477104031031684;0.28434831373441966 -0.70210598214997177 0.11007254440662673 -0.67332033811624281 11.537539408158805;-0.83826823567020514 3.8567047860644155 2.5966068752310996 -1.3133604752295269 1.6771180542409956;0.18892224422726078 3.5297030847135225 3.1950585637841997 -3.8852507369985307 0.85719019506663385;-1.7385148377774537 2.8920584705623038 1.4211551278476136 0.18591408679993943 -0.34412016559547542;-0.4861512118026502 -4.0520046572220618 -1.660956800356465 4.901495991562915 0.19815225238484535;-3.2023848812619335 -0.8212226693323359 1.2179887372810052 -0.62719726454497648 0.68548423662829372;2.8943420830298208 -2.0063833994840983 0.41364252901237991 -0.068178725708317914 -0.22735230805095455;-0.22673302613477728 -7.4280759703418946 1.1886910495837579 -0.67313250870495334 1.5637796636176982;-0.41883927668306425 -0.088083237648627744 -0.88790270993777809 0.55147725014136184 -1.0408614068245836;0.66518557953316026 -1.0625517206476565 -0.023728792204501793 -0.47480664294049973 -0.45148259469570673;-2.7767686924508581 -0.47906765503246679 -0.026584826654564624 0.1843211784051014 -0.66772198665300408;0.068462862935536814 0.25802676301944544 3.1556974352577232 6.9390747129660646 1.093619738605613;-0.49613764921401737 -0.56587018076160966 -0.66898820176686857 0.72189146723578324 -0.83233344668860743];
  
  % Layer 2
  b2 = [-0.89262151738626661;-2.1248134438070982;1.6004521694296274;2.0677231750559488;-2.1705585523930639;1.63880418585827;2.0557822721923742;-0.44984118750842028;-1.0012942539598433;0.26099204519849067;1.7727773839198975;0.28581019478795128;1.1114279153412572;1.4692518136471131;-0.96016276114971755];
  LW2_1 = [-0.038276253229597768 0.91812768700898018 -0.30073041922749794 0.5953434709838944 0.19148769730195392 0.20997825124539651 0.11393906674464829 -0.26855732904003971 -0.21116680826122586 0.24716751952377239 -0.25485502437198893 0.38907135907563017 -0.56182537732861138 0.56847479351493357 -0.22617194719043848;0.75840365683585675 -0.72302279067653674 -0.90512460508014003 -0.16018610379624898 -5.5134938690080801 -0.68397195433710289 1.006901994884686 1.4053789886163846 6.0886159009622469 0.17317324660027264 -1.1470071914834292 -1.0280892528615737 5.6139827271500176 -7.2653999679321402 -0.92952274286904901;-0.56241073814925135 -0.3544542275149089 2.3506534890534838 0.17925419812152121 -1.5247369026888868 -0.37469730426135139 -0.72473280168851184 -1.3862210319733705 0.7573951979122977 -0.79850022620458694 0.61492213529711526 -2.0555833272619481 -0.57267303670858638 -0.27045473476034843 0.035532678025467987;-1.4272302731419617 0.53949477275978097 -3.0083322186697599 0.16168083587586032 -0.41826711405915534 -1.0666807632668729 -0.59246707066620585 -2.5680111304284559 0.9702788620857733 -0.55013834349155366 -0.30741508869999373 2.6906047589281092 0.56231881691289576 -0.75729326615041781 1.8475273605268405;0.98214681939906889 0.11789121104275099 1.3229732391632647 0.15676204107699676 -0.79015325851338436 -2.8636798824437939 -1.0392566373626462 0.55089451910139386 -0.53025425086001443 0.10055571596517666 -1.3028259054974196 -0.93926845462193886 -0.48323952737738701 -0.53021392196652994 -0.58476331077949906;-1.4531362923613731 -0.14246729627933363 1.0917219810094398 -0.14386336195578064 -0.9809252214134041 -1.866867079617428 -0.52990229755045282 -2.4651192998181317 1.0476222947447265 -1.1315936182752693 1.1592386047063581 -1.4938417296015036 0.56315057280791059 -0.82180267322086265 1.4391816566431332;-1.9423373286075336 0.49628971030226054 0.60710559555511201 -0.36954788918428894 -0.24019058740354052 -0.17451951350679953 0.15988827438791908 -1.9599944188880452 -0.79692744551152261 0.66578643165240403 -2.9628726805840482 -1.2882443773978929 0.78793104987641172 -0.038518302920013611 1.883049643888471;0.36512295272603207 -0.15897481303195471 -2.07634412121807 -3.2017310757710944 -1.8891398700390218 -0.8169384231690261 -0.77206480566829228 0.83305077558984275 -0.14798430085054051 -0.4256082663875797 -1.2608114237824739 0.67446657209431149 -0.85384905691139856 -0.39089186546290938 -0.26621110229754608;1.7099245589901739 -0.19078532012891375 2.7920873845244465 -0.60389957446839371 0.72770334602935749 1.5981975305922231 0.77556209894284744 2.0969019538176981 -0.68922438230149441 1.0336944476397429 -0.53696155117873279 -3.2027759590109044 -0.33196315556639866 1.0000051626318034 -1.3069824629045168;-0.51128354281182431 -0.94670877698845712 0.22872647819526462 -0.11840387285461965 -0.72580051162385029 -0.011847948766666944 -0.03567495010558544 0.018526305890589331 0.18187243661210614 -0.29517171589670166 0.74818926682146103 0.41297442047771599 1.0238164405028325 -0.484496457384475 0.23935937658111106;-0.077483899841397683 -0.32631160966908779 2.182732577627843 -0.14490488807978841 -0.73315005931926613 -0.3980808395833223 -0.43407113711935708 -2.373091470464431 -0.011992101325484547 -0.44248925765115654 0.13332814299476206 -1.8505627191722092 0.87862159122889172 -0.4624507226916455 1.3021130518074715;-2.0682621150878608 0.98314834193135725 -0.97155451010137817 -0.40117725234731461 -1.7733615023235498 1.1550235284132127 -0.9866980741250797 -1.5648777674667684 0.65484638426719743 0.16279679496488547 -1.6483012893148685 0.14342614222451533 -0.31872691525111452 0.29459384287629697 0.6724199341694479;-0.48160032572499589 0.26139448534343368 0.740260766297135 0.62752914603785448 0.66071332500114988 0.92018622677621598 0.47990710020923699 -0.32662121651547865 -0.95622401077028196 -0.51508605262319984 0.89752376777884391 -1.5937728296650324 -1.2513369792305691 0.55157767722397433 0.72928517394979275;0.62788146153915714 -1.9003183682821496 4.7125922767175368 -0.32596239580265579 -5.7430558546796204 0.4688775017313096 -5.0059063536010777 -1.8055915278880075 -0.62597441324098946 -8.7139217519381571 -0.1922948621609179 -0.40938025426111863 -0.24883611935307923 5.6030769479338423 0.18997479350085417;-1.4832300236011873 -0.55944910776401235 0.94388834836362623 1.9821610908115093 0.34972085755398319 0.55322587832182823 1.0292181646204579 -0.70598670763341487 -0.061306217605554117 0.043460029030664808 1.1576691019997252 1.9485948241115898 1.6796577317161772 0.14551155972090007 1.7939980502671893];
  
  % Layer 3
  b3 = -1.6711804663836611;
  LW3_2 = [-0.91513416387495738 -1.7150571404375214 0.91971578769673756 1.4800950702854738 3.4368285676560357 -0.87366365637857268 -1.0815817330645119 0.55584139405087751 1.1067618396880345 -1.2240148112051399 1.4626404765739078 -0.59009328091334279 0.99879724896449407 -1.7858429449150279 3.3613566810875897];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.752688172043;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
