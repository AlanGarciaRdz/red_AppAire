function [Y,Xf,Af] = O3tlaquepaque3(X,~,~)
%O3TLAQUEPAQUE3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:51.
% 
% [Y] = O3tlaquepaque3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 13xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.171659085057077;3.03490136570561;14.7058823529412;15.3846153846154;10.752688172043;10.4712041884817;0.0212539851222104;29.8507462686567;0.0523560209424084;0.00624804748516089;14.7058823529412];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-0.55737352178639532;1.6297130181360964;-2.5694145671310418;0.89602412364126083;-0.94349544045239686;-0.0079391458623438854;0.46637234234546909;0.31069980516691958;0.050593034466334723;0.56510102076856961;-0.95202600874425403;1.1734663495968829;1.6105511888423807;-1.4429475853179043;1.0667764129425157];
  IW1_1 = [2.6168893864175353 -0.0010680782624955826 0.18435065505171269 -0.4960395563168033 -0.31367009509496097 -0.39691320025019261 -0.010388457817386565 -0.17448100693290466 -0.071452683273155473 0.22742471779378676 -0.15689532207401449 0.029917045005885021 -0.88775946845299913;0.43877644936558169 0.24684007555920445 0.19730397085907539 0.44015949063471699 -0.30435557964324067 -1.1695418973226639 0.38974542092805653 0.97334453775339125 0.5164271816019147 -0.6147836428245852 0.94643292957054614 0.30131586261888771 -1.0526065053812492;0.18811736157001641 0.36388044297345384 -0.18523118820623333 -1.8658878823241229 -0.32664294126898286 0.17298309282719182 -0.047872821875088484 0.15798581957912716 0.080149238188745892 0.39045402176576877 0.37719246168256393 1.1850028860949933 0.73619644391039474;0.40313947045926402 1.2343135601087787 0.23907366487331758 0.061154042569151412 0.2001470585521351 0.27140795661102252 0.24681014555006914 0.054407618754993975 1.0597882913614147 -1.3728393415815723 -1.5573791101382737 0.5143861699774166 -1.8828907316993435;0.0051474755429404551 -1.8721744060019732 -0.096762841786746878 0.81087311506663118 0.80099404045577871 1.006169081072803 -1.3950907866239608 0.64175640589001948 -0.5669834206250135 -0.86138346077717043 0.50320179172672619 0.81464795447906846 -1.5095849907374053;0.21159360999278676 -0.28012227767862924 0.45854431355884279 -1.1698813534588961 -0.19547587838658637 -0.45677865231174364 -0.29790854225245184 -1.4001007798278511 -0.43899388061139161 -0.099947159399922575 -1.1579373039115184 0.71490447954010983 -1.1243068504417093;-0.10844982070940616 0.98723260289113934 0.95016257545373028 0.079455715382923259 -0.66714209099838062 -0.46206850377553377 -0.94463903205100008 0.10964741467281841 0.44254729677191412 -0.36834771389516241 0.91969698099921227 -0.2567136983995727 1.6643327915036941;2.9293066866044324 -0.41965753691593183 1.0484837317321665 0.70694829689205041 -0.153088225054199 0.079338172558691772 -0.017043863931836246 0.01751697352279926 -0.30390014773599722 0.79528436661664137 -0.16052610678342136 0.23400154706019285 -0.24632050171068759;0.31012823763969921 -0.58757772087294458 -0.74463219793173385 -0.060372536482492321 -0.27790527560909434 -0.47820327324957884 0.35650508042275092 0.53666046631642306 -0.30707835040234593 0.26109021517471476 -0.62131187563151369 -0.46038700720298914 -1.3677630284106455;-0.29788189498201811 -0.62277256967401839 0.80701526725657624 0.13878641519344498 1.5538961174276931 0.22133557893734557 -0.70252449639732528 -0.30248623619026438 -1.4345308042959106 0.43654398016954321 -2.2751462110928231 -0.79158451042932088 -0.99501729097832103;-1.3093501199385786 0.16549425718276339 -0.084221928579286759 -0.6780507290915827 0.21961565237042791 -0.21418054574779782 -0.10766096819161428 -0.14846364265651837 0.04461816952587163 -0.0071970278234359808 -0.068147494311305373 -0.33388873436869626 -0.21568954220775916;1.3037880255568526 0.19539771301578546 -0.11823238406362759 -0.30511893901438025 0.73258248037709472 0.48601084127779814 -0.81825432557056454 -0.017900602984692739 -0.42689132670738095 1.1478231630515283 -0.38488608723051099 -0.40772155685938938 -1.0011210161745074;0.55393479014286739 0.33439231660682089 -0.71102781380214586 -0.73641029177627271 -0.43703917204780035 -0.52081995350043286 -0.4537161824444359 -0.40872577577140284 0.28957951630916912 -0.83107871847562809 0.46497199550600715 0.46087510667647291 -0.21650372153817418;-0.2708661267477756 0.23961754958442572 0.12337515279319518 0.29585191245463627 -0.27667621281957405 -0.21526794337347405 -0.085849726887504266 -0.17680491435181289 0.30030522770630746 -0.44506015684516981 0.30322866003688503 0.15501470761497957 -0.55774528472559926;0.97510642817657989 1.0427651862632012 -0.5756275141942222 0.18800940738555028 0.1688548402600808 0.085389349185533384 -0.23267840748848931 -0.53389493835571322 -0.27110120284102301 0.28787796299856089 -1.4683498241404829 0.092350323517010752 -1.0851137585784336];
  
  % Layer 2
  b2 = [-1.4405880762546945;-1.0297667483870732;1.2333011154384257;-0.73431319492409119;-0.50378509173201858;0.024294009513285461;0.43346667725384536;-0.022087406191394252;-0.039427696159890849;-0.5022424174299478;0.55833274757297835;1.0416691164269367;-1.1569201803779405;1.5121285336049985;-1.6677117235487409];
  LW2_1 = [1.2618496833362247 0.13112648654220671 0.12515008242779105 0.61863750263062978 0.094618491831979429 -0.89935614050356827 -0.12822231788178956 -0.5710908532036898 0.47314391868519889 0.043891237819196453 -0.61830702653604164 0.45545456509862592 0.76387279083297965 0.6669929073037224 -1.2779240942306844;0.2751926198215171 0.066004148199213325 0.12257656460829824 0.47551381300278445 -0.18703235116526479 -0.79746941753439882 0.34839308917777312 -0.25436328028748517 -0.36389379392943011 0.62158063823871879 -0.47161014401004364 0.79282212662835383 0.82073486262075834 0.2867453171896322 -1.2243537163394498;-0.27969396641526578 -0.84106247785201182 0.41828983925856061 0.22746713294584694 -0.14987231057443592 1.1159253220331704 0.33572889412186818 -0.12283171956222762 0.13189029645248063 0.33488559308371252 0.088761460781997148 0.12714834667939398 -0.082054489893035015 -0.58184309567247638 -0.66118699718962526;0.45898088248381846 0.78704914631411027 -0.81844650768810046 -1.5959461764470095 0.11652629485688125 0.90736468942666282 -0.57066677121720755 0.63849893332197472 -0.80697092820383098 -0.36464220359270955 0.63183784604731907 -0.12130673670717028 0.08250502388722103 1.1935526182079024 0.106765429062391;1.745792826304444 -0.79221124867577952 1.2290862922561172 -0.92655393952786247 -0.1450086450400129 -0.26460286786108633 -0.7125649294074794 0.77046640230716645 0.67617886302980723 -1.0391254267714218 0.61151411875422301 1.78417446098176 0.47062216433923315 -1.5310774455806762 0.21912772843109407;-0.85518873123025385 -1.0429363593442484 -0.081681157860581749 0.23998054854813206 -0.30964989821598671 0.010618311609448178 -0.70617193520437294 -0.17826204610055768 0.92684347064722239 -0.28468328203548221 -1.3891450927106364 0.054878163729363813 -0.45126128662958614 0.28833512057000882 -0.297277510371593;-1.1196535894834594 0.57670349654084019 0.62701868330449506 -0.61020656386682426 -0.22091347830892838 0.45493656622518452 -0.36608704441641354 -0.068080678851329179 0.3500439003793463 0.023905284832638811 0.48955276875392073 -0.55256062052305199 -0.64759206807227654 0.59533170106039646 0.90726893327301084;0.11790037281484583 0.041308911074151064 0.5462147588087013 0.48809136851075047 -0.28231986846605617 -0.28410254460194545 -0.2254192089420694 -0.63940980398247382 0.90376455710448333 0.31973708450680449 -1.2469478685040325 0.37885863627036981 -0.41980515355333059 0.73889872795213107 -1.4641897272461823;-0.25076768599727939 0.20392702539417493 -0.3992992620120312 0.45544571443129123 -0.32661815136538197 0.54408947675195529 -1.0650516908979109 0.24423583481643571 0.43139657996970088 -0.34305471745734434 -0.3451078121311531 -0.81356265517875281 0.94780018328557192 -0.95542119992592622 -0.072843567781087082;-1.1014977739130134 0.71464549559805957 0.08058642109528899 0.63813477601093083 0.3790613253626276 -0.54376668836158215 0.19670428691061254 0.47046526096209512 0.16692445659095489 -0.68862516583418132 0.13591808530860766 -0.35707217034627031 0.82154225920037127 0.069166976597490742 0.50011631274442059;0.64656025296219444 0.9654719885801244 0.98303521725949783 -0.68122486164564122 0.047724368510901283 -0.96105428807692972 -0.55985781834861148 -1.3842525299454063 0.38098513612036755 -0.29728243911881091 0.69104054486731459 -0.40995292464834038 -0.5778057509480452 -0.34360420228006405 -0.31372189600816347;0.5563277516643681 0.051674555655146184 -0.57781501437873672 1.1019455236804561 0.30911303918242 -0.75959167326234278 1.0367291404884216 1.4612889718912916 0.10669912826518677 -0.49802791582703132 0.28563252032465503 0.51783673445484857 0.74374781139706481 0.78867739702175454 0.14976901192584782;-1.0238825644587406 0.3535315250995702 -0.79758159127774431 0.076047516854325745 0.14510107119964175 -0.28174053929464393 -0.06486007022791701 -0.60858217359437827 -0.01881908348006588 0.2683611542486381 -0.065153266590463443 0.07511719676958753 -0.48045440241537929 1.1467770595165303 -0.23887894376380253;0.1173393750572652 -0.979483016822568 -0.16059404447649589 0.21102541842486339 0.18700383724316305 0.052798455720391511 0.87913208266289933 0.2951184981579012 0.43484754251682656 -0.51849234476664097 -0.28406859109626015 0.5539255629086568 0.47094964344566859 0.76405531438111352 0.28178728063294095;-0.57485472072859722 0.38363921978362686 -0.2131650716696768 -0.42665634796412788 0.39305025395826237 0.15136189935679895 -0.15433652610480847 -0.69846873690715605 0.57385111890303619 0.23259402468360282 -0.22416563989457805 0.14848540406272626 0.0068958136275071372 1.566497037528654 0.17983607738600324];
  
  % Layer 3
  b3 = -0.57754466800277038;
  LW3_2 = [-1.5972396594306986 -1.6536843042379439 -2.2248088592467195 -0.80253164242618347 -0.64345190215303516 -0.79213677542084748 -1.3921466800221685 1.5790255344766579 -0.87690834609716806 -0.29713610777997868 0.45765617829467337 -0.86566206515081989 1.1125655518402642 1.2752956548305201 -0.85464960736232609];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 14.7058823529412;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
