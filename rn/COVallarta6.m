function [Y,Xf,Af] = COVallarta6(X,~,~)
%COVALLARTA6 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:20.
% 
% [Y] = COVallarta6(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206;0.201288244766506;0.281968137600451;0.290275761973875;0.304971027752364;0.100381449508131;0.172786177105832;0.171659085057077];
x1_step1_ymin = -1;

% Layer 1
b1 = [-3.4159472082400901;-2.2707450280621555;2.4944599510859549;-3.4611827751066393;1.362275178086769;-1.3313603357592232;-4.9519734767055512;-1.3143319735686125;0.50166208188053307;-0.26554295014137075;-1.0087928368347732;3.0383467751978745;0.34748654423510572;-4.29477510624847];
IW1_1 = [2.4732075901301931 -0.66341046451542729 -0.24407449410405907 0.35967360396697801 -0.62219943859360805 -1.2794289888069188 -0.19536337905505513 -0.53772952107674532 -1.2262532591798316 0.76344745223349819 -0.2848893481125509 0.2325234959045866 0.89496018201091765 0.61759180734391539 -0.6516642099029053;1.7324151647000683 0.43761623561630958 -0.052636352750683443 -0.11718189553114314 0.3964545087000419 -0.78513322950610187 -0.14898624172808778 -0.013739349768765749 -1.0732134908101707 0.57647613391658514 -0.52460965296498363 0.27607458058670253 0.2749151598384082 0.25467048445604579 -0.026122746017584512;-0.30917765997278246 -1.2963968332416376 -0.085366109594015499 0.31120117786238527 1.0136349540114429 1.0409295418538385 0.20283468831765417 -0.28350918794743618 0.037466184936073454 -0.31585779893779414 0.0193635187612116 0.14457875528785866 0.51393341079244648 -0.016827194223468709 0.078871554437839428;-12.083120901887998 -0.88805769793634015 -1.9052872442531479 1.8904008053992052 4.336845645031608 -2.1870966129622231 -0.053912842182910717 0.72710462271334497 0.14281803384318648 0.50382681636075077 -0.40659286231674752 0.56734701786875696 -0.71798509245753972 2.4585747750410887 0.30040855422356511;-0.28464390733940403 0.90531292770401539 0.034895383423166268 0.49281761549037356 0.63423019617915444 -0.63493334316159478 0.10653113608525722 -0.098523322864261201 0.43952611293747224 0.0085757994600731188 0.39784017221454132 -0.037280504151466103 0.5523588074662692 -0.3953036823245149 0.15885097787697655;1.5374877122138495 2.1364668632073096 1.0672457873257561 -0.1270107136020428 -1.3011565003726098 0.63050455023043139 -0.50073745942939374 -0.22930234741172179 -0.092133866646870011 -0.2136378991241229 -0.71165431542779234 -0.34947900289221617 -0.76278733637497387 -0.16043500401734126 0.12283124178114044;0.11051501462354256 -4.5941100911610651 -0.088494091655651808 0.51271872646730554 -0.58957519920750956 -0.4468400228181551 0.096679746938740388 -0.24568185666745462 0.17218523167547259 -0.076490004076140206 0.22484064572275145 0.063123615689030577 -0.36423998642796279 -0.45581293655155491 -0.16054667692234115;1.5241690516434641 -0.50424669799276789 -0.38763312184949089 0.11104780205394869 1.4077491582866537 -2.7223477418377509 -0.075480192797417495 0.54989183908473827 -0.10261597450294281 0.553776289241113 0.59224073479749673 0.46365392130000183 -2.1124003454532243 -0.082728402323173605 -0.43445404825481698;0.68019611487789122 -0.36945511755957783 -0.75707185159370527 0.41899675602782432 -0.54444098956924136 -0.21899456506263479 0.40924357109646914 -0.81737220540853983 0.3985941486927167 0.15031340351402528 -0.072412247923096321 -0.30139822257965049 1.3514893231850222 0.26190525409086168 0.58479844739616083;0.49766679373187933 -0.47725328512441273 -0.91176938631770355 0.4932517196457929 -1.1561148761666777 -0.66400441247053743 0.3220506319988502 -0.92187281633754081 0.23843696742874462 0.32368779410568166 -0.13351942541028913 -0.26423049448686114 1.5347235286709116 0.40774641797595584 0.46427989945603904;0.20219573459985341 0.58175990009375822 -2.9956791769519424 0.36420159423215753 2.0492404740996788 -2.8907657074852922 0.38189414756900042 -1.8791689222324206 0.24316686690120262 1.3792211542469439 1.011312111882686 -0.41275570103604453 0.23833167088168516 0.30602153796655007 0.36446552341404048;0.070338266387647078 -1.7332060964625382 2.1766626785756973 0.15127905506743641 0.84445415453499684 -1.1931496906446368 -0.19251780540042196 0.27545719421435855 0.68104488252635886 -0.47245092395620286 1.4205776804375259 -0.51109878459804503 0.73394404394243384 -0.81096163860950221 -0.74987787264499273;0.39427199395245249 -0.71335678950850401 -0.36053202222409342 0.65939172394264589 -1.3073652960260274 -1.0730563839647906 0.11195866695784749 -0.1018113278196362 -0.02370874606501594 0.47341637817113286 -0.45317327718344341 -0.28416041285756416 -0.31497868768220477 0.49232631429861529 -0.10006715077830634;-0.81433024556676181 -3.0509904945723045 0.65254719666994765 0.73075616534252619 -0.43084217259901442 1.7658992691885844 0.09009756527598306 -0.083955750150388142 0.22418449002551041 -0.34794528122661872 -0.1638242986184521 -0.058630004351622876 -1.4205373719643479 -1.3543310686118539 -0.10386675519613932];

% Layer 2
b2 = [4.7114579641565193;-1.1496312099020367;-3.1123424117980054;3.9922800587089267;-1.4037850968399319;1.0296201322539709;-2.6486771248188359;0.070330600806922106;0.30706679483013805;-0.11757648040903093;-2.0840609247978135;1.298712173445927;-0.16169929116659548;-1.8305001070894671];
LW2_1 = [0.067656855163507085 -1.7615909657537079 -0.82891015110155919 3.5504468861442016 1.0660307462643026 1.8778367405036216 -1.3280127091536704 0.27337133016387549 1.6769830173821292 -1.0128770329818459 -0.34102728976899921 -1.8573007192037325 2.1566862151208874 1.0340097983602294;0.10389667756709715 -0.29151524663707029 -0.37575417032998581 0.084029430135188043 -0.8564051019575627 -0.086387300247348073 1.0037371428677968 0.079673538768474134 -0.11217811648794972 0.050111413862061291 0.059043493559793159 0.0069220737219744428 1.1279545125381076 0.34196230975764447;1.2479911190904496 -0.51507041061710546 -0.83096484722547981 -0.12740172191159974 -0.24077633692943942 0.56523863198867519 1.3037088073153462 0.47323937587745796 0.91594811855756397 1.8003146481461365 -1.0026250184256056 0.17846195358547975 0.2361925830693308 0.65113673748463963;0.09078175337070965 -1.3342058208840837 -0.9367350809383076 4.6958634242426429 0.22046356593010724 0.11047365347678728 -0.18423160164555313 -0.066258500223901451 -1.0405635070169761 0.83671272074255409 0.1105211545971283 -0.090042256204333579 1.5866237337148905 0.23387429280078301;0.48610504362886364 -1.4263875868786584 0.028230376466390737 0.594702972154175 -1.4868632394408885 0.041984562573174365 -0.49857756388271363 -0.93081638601284911 -0.68307373028152518 0.19724636716728314 0.31544262550314411 0.012880665525423165 -1.0670676174243958 0.49649593933631425;1.8241008787472699 -1.2306724322478788 -0.25062755234838774 -0.77634808701348179 1.7762978939849681 -0.27556521751818286 0.45821443047934757 0.82425938833428614 0.98348292434018947 -0.47267867993192453 -0.41959736459110569 -0.18154218458199683 1.3948601626282324 -0.3211056258475315;-0.74987973878911862 1.3723637222687788 1.3734467273638495 -4.3653366653918617 -0.20995426993358671 0.045308893479010764 0.46137673755225106 1.3119833354480324 1.445053253820104 -1.3436427758355753 0.16689672550488674 0.52246792474059178 -3.3214164978669967 -1.8144649088276144;0.43844727783064175 -0.89351255163773036 -0.89309683942781404 -0.18678516456053529 0.87548668172072985 -0.050264618972077985 -0.95431572028600498 -0.39294373100331959 0.26880130040105038 -0.44420695669327004 -0.047679662465275129 -0.528881673676459 0.61079176174686622 -0.3737896615073843;2.5254487334023001 -1.368665921081625 -0.3044087441047334 -0.24168661677862596 -1.1634876106511483 -0.38560594838473655 -0.38590853569035882 -0.46371694537601782 0.16807496241479633 -0.26257549013446013 0.42353856997903755 0.22447136053946107 0.81974801987719648 0.32746194780444776;0.20805627805996449 -0.45781105248683757 0.42122676528708719 0.23888667256972757 -0.41124313251643568 0.53768130405035253 1.6515113084613613 0.42367051690666985 0.85123210702105723 -0.92683628778307758 0.25062076682902334 0.29704679777038168 0.41865226243169223 -0.62078394538586867;1.3234736800280968 -0.98726804798272605 0.32792534574390719 -0.18722346776954057 0.18937103879880776 0.49331830237481783 1.1449216977836045 0.25740902617276856 1.4411470570902647 1.1279222405204277 -1.2621268114434716 -1.3556920788993907 -0.51776049591837991 0.34163369666740706;1.6700877670359555 -1.668740780695575 0.40764522667387054 0.22515816248811435 -0.84785016590357776 -0.12227878631651927 0.62264222049858631 0.22277375372454356 -0.089975121622717674 0.16163458582295509 0.032659862991184042 0.31652881571122632 0.84727550258613804 0.63637189306351605;-0.41398609625955912 -1.3221915713100376 -0.29077307793580198 -0.25139990816503271 -0.28223502697402314 -0.62343259842811438 0.25715660534246432 -0.27724813150595418 -0.28203266958630585 0.87379428831741568 -0.75358831554815853 -0.15256000669876896 0.28524418384359085 1.1750363171357892;-1.0013836941636889 0.81716612095321395 0.74419919205034057 0.05544399016425048 0.5951377882432547 -0.095632477229207202 0.38934694293919841 0.18264758372413439 -1.148439436418508 0.89543223296549113 0.02149564807949892 0.10165331474543644 0.98931476394643714 -0.48242570255268302];

% Layer 3
b3 = -2.8507225815167789;
LW3_2 = [-0.33017408328862596 -2.8793696767470403 -2.2416269982246924 2.301128358679851 -2.5621978102829353 -2.3771780535646103 0.36874326569352006 -4.3705302937790016 -0.67813605669793064 -1.9312853248208814 2.2871028188984699 1.6778814788622518 -0.5451651098131074 -1.5670843826677419];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
