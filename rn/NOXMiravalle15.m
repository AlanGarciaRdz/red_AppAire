function [Y,Xf,Af] = NOXMiravalle15(X,~,~)
%NOXMIRAVALLE15 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:28.
% 
% [Y] = NOXMiravalle15(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;2.48447204968944;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206;5.12820512820513;4.16666666666667];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.3903581714171125;1.8386051051344858;-1.9990025126979014;-1.3659939739231892;-1.1366835252978631;1.8819512760234174;0.67531963420280339;-0.2511786714654376;1.2183801107440713;-0.030464152605916849;-2.1044866693281272;1.3624905805653611;-0.77775546910675908;-1.2719431689207585;2.0419846627802754];
IW1_1 = [-1.3043781758365631 0.31155969721169774 -1.0805746301471557 0.40230326079822448 1.6328196599130085 1.1379124240993406 0.69075011365094163 -1.7191630411378669 -0.46446046386685746 -0.75471827315717777;-1.0211767071992877 -2.4154538343715259 -0.29519216513718061 -0.16297730272370156 -0.14658069157344439 1.1276806487737545 0.037094038687487466 -0.2627526920529224 0.10857908455677392 0.81012120075680538;-0.1000098687595673 -0.23164998163745953 -0.28806467778346229 0.097698344437157802 0.77195744849628767 -1.0260984060691136 0.064311197887188309 -0.4660163845828289 0.25209409251065068 0.13361086821162688;-0.34504219506643358 2.7004274684243152 -1.4605047148277133 -0.21939583322811435 0.4284353789243332 -0.75941116473063919 0.34140721458331474 -0.39317125298685984 -0.33965790650853833 -0.1721447707367369;0.85197748421729014 -1.7658869887344271 -1.6535724800361555 0.17669963530477195 -1.1799421184068259 0.059122276654362461 0.076272706607289228 0.78699799453137076 -0.49308821465761699 0.38332686156755869;1.0420763279827547 0.064901768009377095 -0.25690228578746316 -1.1790608784943846 0.58380112047436272 -0.72387520924388782 -0.048747425138261351 0.27253930167014107 1.7637483757589416 -0.24960923332222501;-2.3937701182704045 -3.3332948114415624 -0.90790452845736991 0.61221774379825311 -1.0465511822628741 0.86399147250418329 -0.075384035957870535 -0.10897703520986739 0.52045072186555152 0.61788849069989193;-1.0625449614410283 -0.48129873229174464 0.5641832351449243 1.1656619647817208 -0.33116014369586544 -2.3169391446768279 -1.1187427735307687 -0.43753668172693239 -0.55831892810730732 1.0635384188315009;1.0985514443334485 -3.3840421914375973 0.72124175823778636 -0.38388111805911668 0.56020671143301748 -0.67414896298131666 0.015448507741691589 0.26534106100778759 -0.83850408705668622 -0.71893370020782843;-0.090161765089205342 -1.6475498179364307 1.0835029794718753 -0.31425631510226237 0.80276318805171087 2.7136045647950149 -0.18155812923047818 -0.04172013974601544 -0.92669580842913735 0.021739968974689969;-0.021258086207069801 5.0640991839030214 0.49664702924240495 -0.018239324314970006 0.0029743860876956761 -0.0616713325990784 -0.14029291923583645 -0.21032282150950571 -0.66082108366779013 0.024201175303301459;0.82404749038733593 2.2208135114332976 -0.12346022965704831 0.3980107149338411 0.32297802013390808 0.22154457443296435 -0.18298984960376644 0.26349074648107385 1.0214084307072342 1.0224327005576954;-1.2938339958500418 0.077950567371132803 -0.32161302013897008 1.494766936370709 -0.35931238849815422 -1.5067472729009961 0.69924246609845198 0.38342740317407775 0.11332939775722123 0.052506512615995843;-0.71107964594116968 0.5115591094744556 0.63580538745978132 0.88963419230211893 0.90181361530459769 0.86458504580524165 -0.70193100159425048 -0.28597220347600572 -0.32867320668998246 0.84901005530671569;0.5347764809592922 0.22350863215960209 -0.70703912236675348 0.029470937904423213 0.57030196484169027 -0.314235289910614 0.4321772230516337 0.094322413432595814 -1.1181341437785162 0.71343684251553863];

% Layer 2
b2 = [1.7053435852958256;-1.3311556664146675;1.3435016248518994;-1.4722068892142932;-1.1356953261390865;0.099752188002680514;0.49646944967426326;-0.53139005641197357;0.46636135155747876;0.15703980539249385;1.4140161053578282;-1.2573434255610114;1.3084676007292599;-1.4953244406989255;-1.9749524367983218];
LW2_1 = [-0.3534813242893427 -0.96246423268161052 -1.1466927882389144 -0.25516394842985179 0.1334417611867515 -0.055212221166892193 -0.98510615709869431 0.63024726099396111 -0.61324947540141606 -0.83356423840538607 0.45559197242621863 -1.3839857765190757 -0.056633336922623435 0.3226761896258879 0.37613540406729978;-0.32796382346128117 0.48849544710499609 -0.12469488223816183 -0.19899340073184951 -0.47258840513891248 -0.01816706996290076 0.41193686835782634 0.67010799952340672 -0.013174186235463552 -0.39553633561453999 -0.26155141228355577 0.69015188858707988 0.0099008686414974907 -0.75062439342475706 0.068377859140052469;-0.10217220575378555 -0.35751129855963443 -0.41388596935709987 0.3708138608371544 1.1227516882141781 0.013966204396867883 -0.37407126365027782 -0.43694862072066376 0.24791940130416648 -0.38128773726262155 0.48706221811678307 -0.95129755988139519 -0.29767758403099215 -0.38371848313365969 0.24245844199516664;0.32673876530479828 -0.39632223777643938 1.2617925535505141 -0.33444570897218995 1.4614900126492498 -0.53357947970032593 2.2093420600813971 -0.033983697110168229 -1.0732271513691176 -0.50825990449181802 1.6211327968123972 -0.7410053148056317 -0.55470603977344091 0.53260357506621958 -0.81494366527364515;0.75574773175393617 0.49478177354966524 0.16506558177923522 -0.69960570986873027 -0.076445084737260166 -0.094592242897989245 0.60281143041302643 -0.057107838958226041 0.10001296860824853 0.15975792487580082 -0.15163523860262698 0.55473559165456909 0.040768619044424401 -0.53351151939437202 -0.064806154489178494;0.58574388847123582 -0.75753076937974317 -0.44282891679483249 0.23650864084899531 0.05083680588499212 -0.10233806527593554 -0.8339942665713902 0.5382920790963216 -0.31529683423582938 -0.59227920516093502 0.36623239671402485 -0.95219488917963713 -0.1425695906654777 -0.18081981995357746 0.2840842940079269;-0.27306463306556206 -0.12712907791972586 0.71303824726839471 0.5404978496040852 -0.35311753281407759 -0.40111464812812153 -0.055476719570410782 -0.733549875549666 0.056537896383591205 0.7778219073531587 0.22193826471587841 0.26102330563449039 -0.51253834858891678 -0.017942594569231082 0.124050667867424;0.39257030301790052 0.49250934223892517 0.71154377739980657 0.12307144947691871 0.47540299198878466 0.38207613593184214 0.88570611912455421 0.41255162615396695 0.67764319163453546 0.18365627405491411 1.1222631952443631 -0.04587244931556949 0.48494376132135647 0.72838925325430859 -0.15616797263490026;0.84419669942026554 -0.024615196183718095 0.3812231223553989 0.18542453474747062 -0.24964334794418835 0.051533276394257366 0.33936749744739014 -0.19342579105235957 -0.34498814927945048 0.35918238400780816 -0.72850380491352218 -0.3081695798059037 0.66541620148603153 -0.29702573800064941 0.54276619485902111;-0.16358883136113297 -0.4052518512969227 0.40552820668153239 0.80717430394160361 1.0185455349264132 0.47232682360861289 1.3203631985626194 0.96278706126904323 -0.19629047588513557 -0.95841560594750563 0.68050326088252566 -0.87967490237122148 -0.10566702986354501 0.77882343377719887 -0.61049242153317484;0.21500295311576786 -1.7700206852004416 0.21702851052354299 0.56536971461030194 -0.74857190897690695 1.3949441889584031 0.96371752156152934 -0.27175917609768652 -2.0215843612825415 0.86617666331699628 -1.8293330625708686 -0.76418182756544262 0.015178412856570133 -0.44448166241692777 1.278973573645819;-0.84269556704224624 -0.049724956191408973 0.57197314594269322 0.72769752261613085 1.3891715669854927 0.019987373483995253 0.29665482029757906 -0.54543504105661356 -1.5489848873865044 0.88394972121278992 0.22030801109152956 0.45189979272583791 0.53458838555182142 -0.60935022008561934 -0.23680075612295437;0.17290436236452567 0.18070240913673052 0.11781589462692046 0.14401264202956834 -1.2767231307631135 -0.25448241385784476 -0.26983015990286063 -0.3313240636766811 1.3402549655328262 -0.84332806731798704 -0.047698680868485353 -0.48894759443524111 -0.34279379030502355 -0.12397060291907416 -0.22002904786608668;-0.72693865552250547 -0.86211711564285742 0.20486427416350861 -1.8081519230407463 0.9715939783295342 -0.13338035450143798 -1.0807332824360187 -0.96564217767216742 0.87915115185860526 -0.54827818217116708 0.80754598863246685 -0.15954717209440183 0.22433049626321597 0.22654427208843064 -0.31331467042093131;-0.92128446552111765 1.2760728979940721 0.18045402451116244 0.84257559864413489 0.48194808711356318 1.7193258107755049 0.65940983581683066 0.90757194974973832 -0.52458430052512039 0.61707723576078699 0.91003305633670173 -0.75380798478682542 1.4531975691294028 -0.36616492514973248 0.47089392257789658];

% Layer 3
b3 = 1.3795267789113341;
LW3_2 = [-0.9778039825966256 -0.715010173876516 -0.65094065126888312 1.5177013100328844 1.1440258485228998 1.8915901852402077 -0.58114211177704589 -1.676887944678128 -0.30377313271718936 -0.51150736129351071 -2.473063397351591 -0.65612314740944078 -1.2977938954445183 -1.9469438741273337 0.95501543258757748];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
