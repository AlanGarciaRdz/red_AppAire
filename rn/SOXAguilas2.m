function [Y,Xf,Af] = SOXAguilas2(X,~,~)
%SOXAGUILAS2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:17.
% 
% [Y] = SOXAguilas2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 13xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.448430493273543;14.4927536231884;11.7647058823529;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125;95.2380952380952;90.9090909090909];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.1999806870444809;-1.7368358188775141;-1.3224764468971928;0.97522154211003342;-1.456047891129953;-0.093459204588180037;0.55092793507606586;0.55542540493635262;-0.29256555524708411;1.1883424968073115;0.43033441698982444;-1.6093177229344797;2.0238528014351349;1.7620570225280658];
IW1_1 = [-0.017716225078825708 -0.43388724272641893 -0.22514459188525426 -0.076203658034674548 -0.33214837224644544 -0.17026653829245644 -0.39174215279742602 0.23176302265413043 -0.25856231526934365 0.24842264894808064 0.060991555563991849 0.16504251046266988 -0.82987334062756624;0.52977287146099639 0.57160957146902136 -0.37742494919476133 -0.04751625296553573 -0.11592216341544216 -0.04198758676583525 -0.069971449386386914 -0.39483776892381822 -0.61649720241806416 0.21584556501639746 -0.16161187218943743 -0.59126917812902402 -0.1414164834515387;0.31832522153580084 0.80707536027299864 0.63943840121525786 -0.30058052539035601 0.22573776784815375 0.54095597906087045 0.54397070286644478 1.6452847517956337 0.50846038882882938 0.94016942698713402 -0.28508233158780255 0.60917312497103648 -0.28137793014784329;-0.54532822552409188 -0.19825378435575031 0.11910529214638564 -0.30240249173244127 -0.18794369964935806 0.014752453226728017 0.041047770692676004 -1.2596242010390417 -0.91393314642188506 0.59902576157915122 0.002921187912411782 -0.37503035146512959 1.0117893770981252;2.6767143649326477 -1.6547677386562796 0.23893852905437662 -0.23454739610580305 -0.69300510263766812 0.60045504952656925 -0.10717427387137102 0.14412638296676925 -1.0922924889979346 -0.28860220028128264 -0.0018399983156125919 0.42556256389300173 -0.45888676644531917;-1.0484422620793772 -0.11590194136393081 -0.048528817208772841 -0.11176782966894303 -0.60447426510478808 0.89920720515392016 -0.18294025314409584 -3.2781988701654132 -0.87529864516352041 0.15437930963969537 -0.23995221070237308 0.44645792078373103 -0.94561044648861436;-0.47829655680124844 -0.4997545381135704 0.33913214278530823 0.04288832841399641 0.10088067774675252 0.056582428122854515 0.061665728971235963 -0.79410033071007957 0.54000690353714442 -0.18454731170052741 0.14107846291027054 0.52473875642301115 0.12756644880046428;-0.75898282229450664 -1.3992912091164611 0.53112947559212254 0.030184547529741881 0.85158545850667244 -1.3436792653909455 0.75061394276226356 2.161230078543916 2.5494441674416257 -0.43813137745919084 0.59286995539800813 -0.74267342880432607 0.8455570892742087;-0.08410481256861152 -1.4801495049235094 -0.17237289734947084 -0.20911749260476342 -0.42652710654596937 1.126797390252428 1.1546473366266965 2.3378295655322936 1.1104123859862027 0.69888514210637132 -0.30575978753110683 2.440698226463565 -1.1706538714001835;0.94395440905167571 -2.0589506658734877 -0.079359527007448111 0.29532764757868474 -0.054212330483848291 -0.50119082455277153 -0.10807192483822736 -1.4223350508684967 1.5677336791408876 0.63395883962211241 -0.45380672335202965 -1.0761015114223091 -0.62108654833755772;3.0572682278487857 -1.2549656669852156 0.32494458092855555 0.74210456583978268 -0.17804217326476834 -0.22852149240151295 -0.40870591243874227 1.081828100208885 -0.95873540567976978 -0.074177660309395044 0.068302125098595859 0.057934944011195276 0.34196391220571126;-1.1383013168195721 0.020414697849705281 0.45108785545530089 -0.92697606130282351 -0.20494054014749635 0.47446268547953491 -0.27067357320108271 0.79099202613207875 0.16270759148959302 0.19045852566350485 -0.15721562441065767 0.70599039971230593 0.009000779148072343;-0.22590010376401518 0.70279370468205282 -0.25008066918850075 -0.31852151012167362 -0.0088267876213205532 -0.057312295722164348 -0.49527274008849853 0.28628739731499875 -0.063509585803307927 -0.051089982664340214 -0.42930857298097647 0.65971611460162993 -0.51859233359232393;0.95843493572390481 0.12767820608399613 0.51946643737446596 0.37336118263791218 -0.83461762359096192 0.58906323302565256 0.42956272517732713 -2.0115961868890815 -0.30594914693751635 -1.1364483061229689 -1.1633790858955706 -0.28863090344264647 -0.77549972222346886];

% Layer 2
b2 = [1.6612697003546091;-1.5718333878162969;-1.0988046576778239;-0.63273346239353667;0.49569339765062898;-0.23617811750647222;0.25797724942871458;-0.1240201490104903;-0.42620944615091255;-0.53562800842678426;0.88861808784718355;-1.1635496799920342;1.5247050569324561;2.3818850852550484];
LW2_1 = [-0.50607488612454032 0.20414836892843907 0.48266322242896481 -0.29036319701339292 -0.68635743062290944 -0.49697596690361018 0.66521287850936839 0.099354205932462913 0.26400440031364969 0.16748272678177428 -0.26409662390555633 0.86178724399759532 -0.29980772452162452 0.69147391279073789;0.46819025678422388 1.4577450431512347 0.59590741184328644 -0.32207287245257216 -1.2912995472389075 -1.3518117912326224 -0.18896479618193671 -2.1107075366645924 -0.42354298669872292 0.33699634104028653 1.445735965020055 -0.32051578895669236 -0.88448759827107692 -0.48612533861809182;0.05527205584964319 -0.65712618939364975 -0.19686095469153073 -0.041736996020095701 -1.3359248045445129 -0.17695270553793851 -0.54062698075826054 0.57199746342603774 -0.34327117053152922 0.43037136482874427 0.7914432419866847 -0.42015863493972144 0.58921402492843811 0.39667325095937483;0.525812225462298 0.42755536299352564 1.1403630288592055 0.19373091894981745 0.42973177573017651 -1.1486715352661956 -0.39456783501496667 0.26470704874426543 2.0485018044468242 0.6191568224806645 0.27518513625692043 -0.66404855947581565 0.47768882082219472 -0.64472766852422059;-0.63428551328580429 -0.59955418261470206 0.67136790794051016 -0.59437652186832401 -1.3739259831568018 -0.15277863066135472 -0.57270619273709877 0.23834032834405763 -1.39880930047606 0.56080695027265892 0.91446245903282586 -0.48652318502494657 -0.20017046026803503 0.17599267132834379;0.71375010279697948 -0.85816496928624342 -0.55841062621403381 0.10853694300303551 1.3748795022212388 -0.098793229957891318 0.9230137432158253 1.0056816475897492 -0.46742546526266138 -0.051604971414441335 -1.4717606859913224 0.34539397051467302 0.63527021530724104 0.69888689516718827;-0.53768727711189623 0.53123779027802476 -0.018508098321753711 0.59843239995860198 -0.4994976442100359 -0.24411044768883083 -0.081776152998319029 -0.073120742794528681 -0.4837495832800634 0.073954884838686286 0.71024643455067726 -0.4335882609461591 0.60580961488280116 0.73587574516201915;-0.45334833058343232 0.16422038914512396 -0.34777199239121848 0.97958740096540597 0.89349768565463983 -0.69672642668161711 0.15209984754935019 -0.042700503902386611 1.0929071854203043 -0.74701248600103631 -0.34081840288789134 -0.46239954091547214 0.66833269079638957 0.043576921302562341;0.29199173830500891 0.29504912909526243 0.22038584878651496 -0.8339282154566009 -0.78184416688673342 0.10897587049962709 0.33365089609012621 -0.047956011596810295 -0.94741575365423158 0.22065535372403741 0.54719536347904407 0.49184716722908511 0.055708239559431758 -0.13019103273821284;-0.53107843191892623 1.0327612572414617 0.52036044274597937 -0.09826154015844149 0.024986929920633304 -1.0004439609690243 1.7339183295860212 -0.20816412000545809 -0.90476040770850197 0.81385465712366167 -0.14713942488591669 0.012485684240396942 -0.41004298444261794 0.62467705024149311;-0.058411373345547982 -0.68372686422152607 0.84318765615633884 -0.34760990377242845 -0.92592796567888258 0.75571171880802923 -0.6427559837063539 0.21207385382242006 0.25940627123508725 0.19229537847419276 -0.044359094792257567 1.0170229494376251 0.42578408374111287 -0.28846425613437626;-0.59410976438632734 0.32905136458465228 0.25526970063246313 0.60187631895131 0.45345988330130715 -0.21801657627606419 0.97426020249902889 -0.091338404868670092 -0.61991298004510142 0.70945677417085151 -0.59217845175672823 0.3190770418379264 0.18680642625232324 0.18919033269998398;0.5182714621448673 0.091774354708151651 0.040347355402481161 -0.092671530950451553 -0.75534941303922243 0.17263740960955551 0.38962912726619786 0.69118719412640983 0.88592512912599886 0.52816182796215005 0.13885644797632624 0.29378348629332746 -0.090752664362237626 -0.27491056472132502;0.44469265945536152 1.2240799016263946 -0.49444690837551386 -0.43730158410645775 -0.18443262001421332 0.51896899883101189 1.0894093567595147 0.12404617519929211 -0.89713456575982564 -1.5432208866704513 0.55868513482933591 0.078762428894369241 0.5579049158969126 -1.2804786763925831];

% Layer 3
b3 = -0.13047062581044278;
LW3_2 = [0.61673522306952311 -1.2093040609735668 -1.5308981190555433 -2.15321412888188 1.8365245943555109 -1.0963768291693028 -0.55221445135125535 1.2301440930047518 1.2684328874423416 -1.6485013606002301 -0.90791844813016565 1.00786992730335 0.6230393669709412 -2.8521999918243521];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
