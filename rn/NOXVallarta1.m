function [Y,Xf,Af] = NOXVallarta1(X,~,~)
%NOXVALLARTA1 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:25.
% 
% [Y] = NOXVallarta1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.4181490553566742;-1.000795103498062;3.390782396916034;-2.5141560454270553;0.010994384628858473;-2.1715750780439116;-0.6504464596497177;0.66437603404160639;0.0884937072284981;-0.018061028509927121;2.6426980057989917;0.087959272548271031;-0.34686261002608404;3.5409423061020719;-2.767679371772974];
IW1_1 = [-0.2667435452666741 0.43645599660401235 -1.4133733436630012 -0.23164400951179109 0.12205093650258755 1.1295537378353107 0.57623965856622728 2.0252611439103037 0.69823593437284537;0.84828256269120528 -0.47268062285730406 -0.80596261168389205 1.4775290861856571 -0.09292172797820146 0.41644968266427912 -0.20290081721934028 -0.48138033799037416 0.33056906185528162;-0.24363322020284009 0.20806255540019528 0.63580381701935063 3.286587029355247 0.26640490017548946 -0.97692267872114724 0.62636634861282803 1.0399240894502582 -0.42241165506279138;0.041778245150793626 -3.8006533391041812 0.073365446573179435 0.278325586090168 -0.30932316596437742 -0.032715415197300583 -0.26388910870716359 -0.64895909452250267 0.070593061305026919;-0.16390924264651366 -2.8544585296805822 0.10077682386009221 -0.17517081600069404 -0.16737462903393485 0.0685247519591166 0.11857843541261348 0.60517932417119491 0.043505743314350351;-1.8496205026036849 -0.37482985565226834 1.5089937757785694 -0.30074233127350403 0.55308455258439426 -1.0891443124096745 0.16135551241434953 -0.093646001296581918 -0.092727891525714826;-0.025716851147586949 0.021711941464879318 0.56781520151951248 0.46244896509664718 0.0044782332118412146 -0.38875754934578166 -0.73793233079702458 -1.5540556827169407 -0.39116919990592353;-1.6499034029083954 0.85882915174384633 0.53635189910918468 -2.6797278823065582 0.00095219707271298332 -0.099941419757012706 -0.31734076034770242 -0.49788166697252478 -0.14811577182518507;-0.018138304721019086 0.55200856165142065 0.76220575044185723 -1.2493267876289424 0.25149841102403797 -0.29069578453985057 0.67919702467236787 0.96237565156684857 -0.1026122712418418;2.0776751879429676 0.51642884226539187 0.16119099563927927 -0.38805861616729298 -0.49663470976252494 0.80373145475194341 -0.31415686959961331 -2.4015172079762803 8.7682807806542529e-05;2.8240060291707141 0.020734261467947986 -0.5150329421083566 0.22189073522144015 -0.0065762701045486011 0.10365193144864621 -0.79540873187825445 0.026446007658009363 -0.73961342316338607;-2.0255444355416166 0.16490040940176148 0.37711319761966045 -1.4317179187901579 0.44310057939890374 -0.41587672035017315 0.68731265590272117 -0.34179318348087817 -0.1945069770112626;0.41604507711746641 1.219343855760241 -0.36037130543250412 0.34977170775225058 0.00065154748389732395 0.33263796847812555 0.068597925864697221 0.60551907503346558 0.087374038428223277;1.1515609056215428 0.47203391157173569 -0.7918329814145707 -0.63966069095208788 -0.98185971623322676 2.9393402120056629 -0.34888587293494749 -0.98771154922208426 2.7392010949393848;0.7929160675319793 3.038676344742548 1.1505897651494177 -0.61396929109104859 0.65686287608872296 -0.30987462824300738 -2.2345562823949554 -1.3455506712495058 -0.63424244642697691];

% Layer 2
b2 = [3.3002839066640699;1.773999553922744;-0.98114138811843254;-1.1690755117902878;2.6221712975822062;1.2673868146506833;1.2474452351693943;-1.0451739603643027;-0.27993048145346972;1.0832167041125207;-1.7784698744259362;0.52399910448570564;-1.0980294140153277;-2.5385785066367363;-2.5864247035991608];
LW2_1 = [-0.31290488498647218 -0.20254682215267486 -0.2226646606478522 0.34229387360736391 -3.3357157339318908 -0.17001783359893197 -0.32939189020224741 -0.5756257095418702 0.96867911949589258 -0.42068848235361717 0.40240413983482431 0.14102375789089924 1.5990868027910066 0.23168680485253659 -1.0986617939955825;0.40497478909564294 -2.4066458949512564 -0.04077640009627094 -0.43898535346036449 1.6530604067496548 -0.67424890141284266 2.7647672904026654 -1.5789734075695119 0.57102139265212881 -0.15529663750770623 -0.045197783000306357 0.0091255229344110733 1.883475928716059 0.69527809365014992 -1.3037509753561474;1.1372754936515843 -1.1060624400796155 0.35874379708673726 0.59538633877490099 1.2168234967837865 -0.46859115517823996 1.5563524726716382 0.20097772828358673 -0.18577279704035213 0.48104047200720568 -1.1051297731431617 -0.43899558426188562 1.092325952811096 -0.28444093873810894 0.22407348105617561;0.49881351987385347 1.368529702157997 0.13424833646034448 -1.8982178180998988 0.61029071567371018 -0.033367581165845629 0.8580595117746912 1.3557233027080975 -0.59151865562404171 0.60616247225467645 -0.15956850701671701 -0.16643552270852507 0.065655515462482855 -0.18639922888456972 0.48959494143375526;0.1447979096017076 0.48226417784260378 -0.18194177115731344 0.98838916705628577 0.96316808195621706 -1.312761976703273 -0.06931842860188149 1.9760688976464569 1.4088936555194149 0.73385139672034372 0.51569659445945493 -0.82830237879686175 2.2369061140599729 -0.37835159939440627 -0.17356081408846008;-0.014528160428431407 -0.35758531705817631 1.057866178502253 0.02816264286061209 -1.0181771498053316 -1.4361228901321819 -1.0602687479069561 -3.7300974132927971 -1.6017324547949909 -0.17171082466291285 0.99925397088448475 -0.65265291384333901 -1.3363906833510089 -0.54081853346588493 -0.6736275965371693;0.22802410764032238 0.32115346126602773 -0.39197201423813793 -1.0370279814051948 3.1048417680947442 -1.0824884503520955 2.9716128568131199 1.070012294341961 1.0528021487844288 -0.20218770703207647 -0.048803572200858236 0.55130562723925158 1.0269613838771157 1.4296241228880753 -1.6955891000882317;1.531119345785849 0.16797069688181698 0.0063325582305555003 0.57762002365805376 -3.3424534639811569 -1.3576001154469646 1.9402830016796697 0.10028141193286419 1.742791924583182 0.33245685423294957 -0.33404673271121194 -0.68724492753943922 -4.0215555100382128 -0.16422929392987978 -1.4495581787825407;0.51727489274902083 1.5348447767739006 0.12953819739820543 -0.2441066533693271 0.2000125308894784 -0.11010191243388197 0.4148243711904942 0.96971754474132654 -0.56605572080132349 0.74137461115264136 0.39444456377134574 -0.17740105833575201 -0.58661398037814383 -0.40107515543705896 0.40575627970802064;-0.81307836222898233 -2.2393878462321712 2.0034128671315616 0.68310542236522565 -1.6574185466331455 -0.12160545444278871 -0.15922058908328274 0.07349270328503292 -0.32981951403882248 1.8647207202817548 -1.5750448190997344 0.41036605247734004 -2.3245082884543025 -0.23779124221912293 -0.832676758838229;-0.21148083955666502 -3.4842137842608532 0.23991258384446923 0.23331733418274717 0.35154500622777968 -0.74166777735194322 0.66625448452279223 0.70225501346953123 -0.44982130608352755 -0.93007557252783157 0.98274821488668418 -0.62390360822472646 0.50713606436738878 -1.9028361512822556 -0.52694551554589786;0.24460462234939259 0.017893472418199337 0.55499679907692068 1.0078666977671131 -1.4119955145965153 0.21020685460762534 1.2563056801353354 0.83973662411959005 -1.0664304027225209 -1.4527350982773612 -1.1623401769261206 -0.91588108179058825 -0.24398996083421248 -0.23706221640968522 0.64083162349476763;-1.5029110934036456 3.4793866620925415 -2.0204103690672781 -0.79182926994406244 1.775175261330908 0.20837124656711614 -0.028852656299298562 0.52291411111014441 3.0648158930533516 -0.91751101896008691 0.47797021135509526 -3.5355256408250422 1.5010942308872091 0.46352802210345118 0.96172558978281986;-0.75438217301294841 1.4400103540426055 0.50343920709255086 -1.832519863568626 3.559586915300768 0.94845680087297546 0.00014791479901947457 0.21804324787419693 0.9351635491326763 1.0056179345746958 0.98741636885695205 -0.76121471164910692 1.3510004393182937 0.071648609070320612 2.0037782549960763;-0.41403612818088242 -0.36169882155016181 0.2056393892793445 0.71986056022870859 -0.39118022586574586 0.77327970366791365 0.12561265225115367 -0.60857268435819656 -0.67801787200446639 -0.043901028151345133 -0.26984373214876611 0.89559837879981352 -1.4032561655112508 0.17686497988270464 0.41520110254226561];

% Layer 3
b3 = 0.85835033007355888;
LW3_2 = [-1.5752557109417016 3.4254339915481413 -1.1760523305416641 0.77461662688083799 0.87146349734711082 0.25121072793233956 -2.9507964704331608 2.1195960272132921 -0.7933500834196443 -2.4564845007786551 -0.23852984160188342 0.31245494777540422 -2.2412772621577393 2.4995465147854889 1.8933251276193701];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
