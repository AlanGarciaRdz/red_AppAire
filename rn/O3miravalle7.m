function [Y,Xf,Af] = O3miravalle7(X,~,~)
%O3MIRAVALLE7 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:42.
% 
% [Y] = O3miravalle7(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.304971027752364;2.48447204968944;0.056980056980057;0.0063552589768033;15.3846153846154];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-3.3401383201046073;-2.1259626077361182;1.5104560174894677;-1.1869081401204546;-2.2066958516441311;0.64089824663025874;-0.04362018694245149;0.2924673489934142;1.0055517024293326;-1.2262714407028141;2.147922411534593;-1.233825710814751;1.3246431796328921;-1.1446046055279897;-1.4450940179393461];
  IW1_1 = [-1.3113376001931347 -3.581175305572605 -0.70896727377240298 1.1273306837488377 -1.3563615588397011 -0.16638573043770688 0.82876986380944373;1.6050914029756722 -1.2233895591431208 0.50263650130285742 -1.6159185732240982 0.43076846915968331 0.011224533484760494 -0.75547306450444529;-0.78363856110571695 -0.073392084716380826 -1.2916583409654057 0.8915397821305554 -0.44016759188472321 0.29627592143541415 -1.7296154375637396;-0.25824407002742517 -0.55661710961839039 -0.4943379045332903 0.90934859777892962 -2.34236815326426 -0.69036875592425762 0.43035459512082497;0.7502004279949519 0.45623127432319271 -0.12457353719090507 -3.595482543097221 0.71328341638395731 -3.0818989244420134 0.56754094437226432;0.88218554198711796 0.75896497347215497 -0.52964876471518618 1.4002849409704072 0.20831042321392648 -0.47081544680634935 0.73501283271358131;2.456824037573698 -1.6545330339138353 0.42639519615390858 -1.1649300684413395 0.8083929821428214 -0.2762412408662786 -0.098640756502493307;-0.31721787073583546 -0.70026456454648156 0.36081201240797361 -0.17580705564465154 0.10700625984064516 0.0060528480635078721 0.7858961246481595;-1.3689111375668437 -3.0092152218760813 -0.22106506998384634 0.26191450329309307 -0.32750838674171856 -0.60333534877150463 -2.0821574317413987;-2.341129670091326 0.59984335934614985 -0.41988432509244422 -0.55950103169856402 0.27707846588503027 -0.083509262096622405 0.47653303578383965;2.2408511983484298 0.98691298591419885 1.0065988119405465 -1.6881008152789565 2.4606306626994288 0.039249073337576372 -1.0456128964799862;-1.4398309932315667 0.16763256961868106 -0.77647882936689017 1.0560521186931353 0.32256178843751393 -0.07576844016094797 -1.3493817177222061;-0.14742066907991352 -1.0949223544796127 0.65955914666189897 0.018757481887555348 -0.19959161892442628 -0.062566747725627467 1.1191528713687318;-2.4325783417483162 -0.78307199853954501 -0.17629728566352465 -0.29467494048376131 -0.13738173079166199 0.10743059460053958 -0.23715273965642555;-1.2468701419494732 1.1062705544209552 1.4256388570405363 -0.54811310139827785 -2.3818222963108755 -0.047496082609137381 -0.45741896508204927];
  
  % Layer 2
  b2 = [-2.0658953925115315;-2.1120219574137034;-1.8270937527653406;1.3738523120902928;0.47142950974122755;0.18604161204968778;-0.34683389235677758;0.028763884059218141;1.3300421987259525;-0.088476450228097442;0.67977338152741784;1.9998164995460577;-1.0514781255602954;0.099904448595277195;-2.595425859005883];
  LW2_1 = [0.75611043666167188 0.57094830605699165 -0.4844278726182058 0.090063515461835178 0.28528643729701708 0.1291601197041948 -1.0216303300222924 0.25300979079848668 1.1172673677794114 0.19658305871108864 -0.11981484677664786 -0.10844810328199597 -0.70511478825505325 -0.02294033070280041 1.1887043557914128;0.55891949298164889 0.74986104934788733 -1.0167034575733209 -0.095783559279261535 -0.24389863534155115 -0.43079204217889738 -0.81424870741225042 0.031198832313941383 0.16541584882002458 -0.61604163464968353 0.92864583145892621 1.2127082019062088 0.77601371787382223 1.4049407503158922 0.68139086833329643;0.054966228789529628 -0.22375856681595366 0.53178640600115168 -0.9243418654629586 -0.21109300700360051 -0.30204433587369656 0.13048123638272693 0.48455260887609569 -0.27660690400167998 -0.44362723043476537 0.030294325346895079 0.70667056607421663 1.013845870885089 -0.53906555912153598 0.47059279079370359;-0.56058561936086504 -0.0458783639032639 -0.18782139208017118 -2.0415089815110252 -0.062358191920123193 -0.71623233783521423 2.4140210151751544 0.91969880383435343 0.14590365821720819 0.39737879284461952 -1.1044344331913594 0.058920162521334411 -0.39523055252840311 -0.063661860517324309 -0.30570720010058222;-1.5104420065932895 -1.5109710539051109 0.76241506835594142 0.092202404174109312 0.064829586715253129 0.56598962533819253 0.86373976990137158 -0.23831769655354318 -1.2491139057234102 -0.57281739228499629 -1.1043174428231792 -1.000993336046573 -0.76142453570914026 0.36059407526457554 -0.24641578669031969;0.95894606130946014 -0.55095587822065328 -0.91691297741644029 0.30537455551483722 0.36807353519265562 -0.10716803588256597 -0.11777652503417028 -0.75545603137418627 0.28517389173778684 0.24260335038830044 0.08338067977573628 0.1215804712519217 -1.4176623738954683 1.0657521763937112 -0.49245025930556585;0.47854390095268423 -1.4326780868547706 -0.41359575659490011 1.7219641162574333 0.47262113550240897 0.16789814796904412 -1.0254109463581929 0.31119012295263165 -0.68050650982672822 0.011724079616509481 -0.56937246718145396 0.11603833166710251 -0.36623235781507746 -0.38231512429018394 1.0393835577766846;0.25294247245616058 -0.29881549945291624 0.45081118541553722 -0.39410375228823868 0.08592697429446465 -0.040406548911061421 0.39550701180123321 1.2484070490769223 0.18990167308962355 0.2105305967938127 -0.28735362521023211 -0.16860006385216256 -0.79048792746890939 -0.035976994403527522 -0.41965246712495713;0.68761731454912189 -0.09895196981248558 0.25845574086866052 0.045182441548454425 -0.16655782651432516 -0.58403801101604225 -0.41651498327866859 0.37537715483617501 0.43503509120466549 0.41091096918422132 -1.353095099767299 0.39640619128074828 0.83839287784613892 -0.24490171805736821 -0.047706787891861904;-0.87619754162309194 0.3940254280329073 -0.32406419645141349 0.49586117771068505 0.079800693635584549 0.43178872940568114 -1.4704065717303689 0.84407948259439602 0.2905384244002579 -0.93094590566686097 -0.33024959490423633 -1.0145580012876876 -1.2722760171294765 -0.5049470900395252 -0.36940300422538452;-0.41708249839879258 1.4230464983999371 -1.2137161270766066 -0.39277859972862067 0.006061091542317253 0.41228920345643605 0.58050197057083219 0.097295998817609364 -0.53562464839453794 0.53540754190611095 -0.19955974243840011 0.87106945731648311 0.033752034978599646 -1.5050603922122734 0.49524611864981471;1.7164887756084921 0.56666838287449917 0.21043982992186461 -0.95728801319723145 -0.023895747852323429 0.082407393935790857 -0.90900173248872895 0.65259499955892597 0.12478328751410986 -1.19227553592872 0.53895791559951556 1.5209806817263445 0.16294320969568343 -1.4835940851192257 0.49946341977407765;-0.2852514454648708 -0.76561074263535933 -0.2414200880621318 0.35319151429416856 0.056197768711184024 -1.041412742095748 0.54014592843285125 -1.534225289874926 -0.24304099614390617 0.63770206012487662 0.035066313312816941 -0.027499568197525089 0.74184805083068328 -0.60031201805168599 1.0958859972904191;1.5856050476192933 -1.1986559362497666 1.334992496192889 -0.44884882472465604 0.17147865871545762 -0.21140313414353842 1.0651017786396333 1.0037741411237575 0.574432212614714 2.5027084837956317 1.2135484384402897 0.3278750826007738 -1.0751356518586304 -0.86812767958029957 -0.44141009092855016;-1.0122144326178701 -0.65649287703254233 0.434989298870327 0.62998454157128747 -0.017391843386217132 -0.058335530381258244 -0.75840149411819879 -0.52068936653390807 0.21728248204479242 -0.3944183753828181 0.18022997837759669 -0.48191397874711533 0.14609542227170397 -0.74076945629512325 -0.1660619012506806];
  
  % Layer 3
  b3 = 0.37574943192180321;
  LW3_2 = [1.2836800217488185 1.0956400312286605 -1.3088791187856395 -1.8563517955094013 1.4148348803558848 -0.49628281323202905 -1.5056762315878689 2.8226872160929384 1.5927401278505984 -1.5181262785924559 1.2011026183067908 1.1960412144302213 0.60462608988537181 -0.86052838410072852 2.1302041272204693];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 15.3846153846154;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
