function [Y,Xf,Af] = COMiravalle16(X,~,~)
%COMIRAVALLE16 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:47.
% 
% [Y] = COMiravalle16(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.46317866345452396;-0.75308884805167309;-1.3860875902007905;0.15882454238906596;-0.68818571828974551;1.1545942440100108;2.2991792348974207;1.0205307139338198;-2.8519532687976583;-2.9514086897889231;-3.7658350343622042;-0.152600243713546;2.6612308006675054;0.44813973174802002;-0.50645241471542291];
IW1_1 = [0.43611636874727844 2.2085127360977994 -0.19552391672074204 0.14774585991918535 -0.34092477402511856 -1.0899589574882953 -0.21260946359387151 0.12735784404033651;2.5739978716033041 1.6820468979366108 -0.080948430521267351 -0.17476282259623666 1.2437939220952767 -1.332936706294346 -0.050136173728766976 -0.05008998860252168;-0.24099276531974306 -2.000963331569217 -0.60659105226433985 0.079163112522511805 -0.5339336497121403 -0.95524348376722024 0.41451574692662485 -0.096406913507809222;0.25729366233279649 -0.89108447472960839 0.90933339843869421 -1.861887498484581 0.46895532045521809 0.27422077116322752 -0.27186521251892659 -0.90099934014199845;0.20579339607207461 -1.1602860503956001 1.1172981491733465 -1.6953068302120771 2.6512668103773303 9.0024367300584842 0.47002588901628567 -0.48412764766058719;0.94151308731808159 -0.95006094203747693 -0.92951856302165548 -0.8615912319329585 0.69345242623717618 0.21715844699024381 0.12146446011773643 0.091428269700922229;-0.25198930137875108 3.1225287444847445 -0.70920955151438725 0.24425629538194085 0.28906190782441121 -0.51800683056021979 0.21161811553873272 0.47979441008108714;0.04407885832675143 -0.5334048264826774 0.38538459232308481 -0.34727451766727407 -0.16267365362709482 2.5505814946747227 1.0354787243499084 0.18845509796663984;0.16959061885032589 8.8509151951607183 -0.66195947109487308 0.33610839587810121 -0.27828403861602452 -0.4470294905681147 0.13596456483641484 -0.17094737815282168;-6.6193844095755736 -1.7095227355746405 1.6768523417478904 -0.085019165583863687 0.68689264810956763 2.5231202482481754 -0.438877283952741 -0.46223731537531421;-3.1690961591542952 1.4538387048821801 -0.58194970231230203 -2.3805808250702722 1.1908076897170266 0.36971389173467051 -0.22426421197179952 0.56066043018654743;0.36028120075007575 -0.73516748288075262 -0.0040344797551060164 -0.21922821771335696 -0.20500546230099356 0.12635739374193536 -0.25332797126247275 0.55645512108471951;3.5460842572081055 -1.0756567401899175 0.52153938450251491 0.42420092867962406 -2.3054183630109542 -1.4196704773651503 0.48051424704399381 -1.0034351794686167;0.76411390612455643 1.7248800397663508 -1.7221142521967763 -0.53171080184911879 -0.22262041091705054 -4.4287010864257974 -0.64769438094250742 1.0041134542616426;0.60102057663655206 1.6021388328215913 -0.2419708714928015 0.051332512458301061 0.45140419066125315 -0.6024107411698929 -0.29204731998950295 0.53195226068619816];

% Layer 2
b2 = [3.2348833239716406;0.67041207244194645;-0.95347647176179973;3.4393910606736684;-1.0294415688281042;2.715918742519603;0.65181454266702299;-0.93540352455407882;-1.1492230676367621;3.5532907805676492;-0.84284752718807388;-1.2471648351120703;-1.2995005661318797;-1.21068333797268;0.64047692745876073];
LW2_1 = [3.2058188396475193 -2.807792761877375 -0.69194470326905588 -3.5808219249446203 1.1811943653387433 1.4726631616590156 -2.4067887099994074 -0.12096079008090364 0.94508662592802406 -1.9025073509402428 -1.8625149039417259 -2.8795618250924448 -1.2159441906784132 1.8282813883569691 -3.9598619591602717;1.8580851897014885 -3.1866547534042082 1.0331460006785018 1.7088056099482589 -0.72590515206145123 -1.0566843193890929 0.72731485997805323 1.9105690641953428 -0.020223140696619818 1.974222244427027 2.0162618958132104 0.48023697039542418 -3.3018199300890712 -1.6328434711355913 0.042371651364734433;2.7086847280562298 0.14791923879152899 2.5219493200471752 -0.0070098003472288811 -0.14539595284869938 -0.28939360701048339 0.51078694442901262 0.22095138007564685 0.62461619411297709 -0.17673039456730219 -0.0070737309820477117 0.6728924931982504 -0.10064425766424552 -0.23165390687295118 -0.37050805799184244;3.4978035588134531 -2.0201298082806347 0.057459216141617454 1.1450504805311204 -0.59543281111268898 1.1164031301353177 -2.1288968188044382 0.91676224395336747 -3.4071279923502735 -1.0537654472347728 -0.54331570082528535 -0.17959381833139865 -0.79796355411848019 -1.5747012198430752 2.5276254939693876;-0.07452790496984299 0.50838725077915836 -0.1473967555225994 -0.30702347683304859 -0.019331882707446846 -0.34916262398798303 0.64185279000906659 -0.057892486733804781 -0.17699951172399714 -1.1076852657643075 -0.67236288956999901 0.95812991211256082 -1.4312613330525124 0.1679112240515554 -2.3505901435061132;-3.1000890371553287 -0.89700041486443838 -1.6948503019085697 0.29335664672939588 -1.3290194362555126 1.564454758706801 -1.3593952948137056 2.6384429987331597 -2.0910179557911936 0.75520312791249022 0.068809257377337313 -2.7532003727779082 -0.093194991513746425 0.013012283021898999 4.1032026466750597;2.0994970991681261 0.9290784645141128 1.3351939037781624 1.486829785093994 -1.3233905391425205 -1.3772102268492592 2.7683056292393489 1.3505025348916213 -2.9527875421794798 -3.3136384023221592 0.67747601915520295 -1.3255509228665934 -0.30363969084740261 -2.0342077478021685 -4.3261681858185153;0.86265939504485845 0.60733048618800756 -2.0789784224317409 0.63345127016818092 -0.1901992029132264 -0.98749970769317708 -1.0326349085076518 -1.8034106235333991 -0.70741504582416259 -0.25286559413710563 -0.8038670181562183 0.26402445054653745 -0.41228871340915785 -0.039869709423419622 -3.0875740347361891;-0.34222982691355686 0.8635571879253966 0.20951229901887342 -0.93762623466612549 0.072131844329932554 0.12916795631912081 1.4273336504774312 -0.78813426465593062 -0.71224068047009514 -1.6330148109108955 -0.46837349485074431 1.5914172633676358 -2.2225586625958424 0.032929121167848678 -2.5374007526856852;1.0012475865135761 -0.36837550201377639 -2.0439797461352898 -0.19143379343761208 -0.55659319363358617 2.3125433998395022 -1.9886045481456651 1.9530921917633892 1.5670950722343293 0.75054382009323128 2.0656130266111856 0.0086602647709731369 0.74092396100008295 0.23569652649088718 2.9959151599733298;0.18630461986645608 -2.0044105016949874 -0.77444108895549346 2.1607839431651441 0.18936830534553856 -2.0611141275451592 0.92131226037121805 -0.77841890859688001 -0.47116263851792062 -0.62609192993727347 1.0195257166859042 -0.2236715169711444 1.3823331833902481 -0.30420821039965951 1.4865345104648482;1.5883408014664777 0.42718799517634676 -1.4695746621868944 1.9121965864237462 -0.8813371835646554 -0.87635518697324788 1.337967569686104 0.75267125116780886 1.0048258899279998 -0.20033122525911623 0.39052108046408501 0.82155228124553481 -0.40107138978982398 -0.51620305405522282 -3.919938453489304;-1.3710602017258231 1.2067246343885087 -0.22758041568014942 -1.7622134801733211 -1.1085105740435928 -0.042368404199474047 1.8897383735420448 1.9183860374778796 -0.94977413079427753 0.66732319801333428 0.590755043253824 4.2114907691814816 0.47974233666707833 -0.6872896446061475 -0.55082532900541747;1.0953363381111099 -1.2270730340471547 0.42720432212590181 0.21139526798487288 -0.52752023216806143 -0.64719676286757799 2.0365479082680062 1.4106390609815089 0.49172681716316241 -1.9518252582199911 -0.57623958186529833 3.0506248333698727 -2.1423811984754195 -0.69782537967133773 -1.6719294815259298;0.3812695100902736 0.43575855445028933 0.11308119730462705 0.47835011784199233 -0.56139541556493355 -0.88773055422416047 0.11041357350212043 0.35111016267852757 1.447307307738896 -0.64820531477394483 0.68277859782567341 2.7854893932341693 0.25216097137416343 -0.48979379500505388 -1.7474619558795588];

% Layer 3
b3 = 2.4741481681213071;
LW3_2 = [-0.63519823184637558 -0.12159324686213564 -0.86936874892980065 -2.7201207917446757 -0.66419887459039195 -0.56573213686526236 -0.13503759787751193 0.092627168181902364 0.31989476079412449 -0.095167107923965308 -0.1594720118109817 0.20586064997480041 -0.1421039079895664 0.12606450122506227 0.18686926736578438];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
