function [Y,Xf,Af] = COVallarta5(X,~,~)
%COVALLARTA5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:19.
% 
% [Y] = COVallarta5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206;0.201288244766506;0.281968137600451;0.290275761973875;0.304971027752364;0.100381449508131;0.172786177105832;0.171659085057077];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.33534742193728473;-1.3350224497331091;2.4825161585116664;1.8063408192267127;1.9788010291326676;2.0631151014478104;-0.85658172279579115;-2.0413852992475818;0.77094894715655693;-0.81972360461159588;0.8013446495921398;-0.67245615768332145;0.046374876359442346;2.1249968619227846];
IW1_1 = [-0.43946353536560451 -0.63122493278961012 -0.4951776991268162 -0.78023815329544122 0.68226007745952477 -1.2657528614686184 0.20347867630031236 -0.56019133859562065 -0.14848421757856864 -0.10955195446943786 0.40319503972992954 0.84118479451997441 -0.22008430903224369 -0.43897000122390445 -0.6161514984295734;0.24725739772446148 -0.013931950002244724 -0.60015725462125946 -0.054896113132306142 -0.22557540001699336 -0.445082732830552 0.24319945524630304 0.1857888068657218 -0.23436255825780886 0.59650008099654228 -0.2322627605742367 0.37439972603159455 0.56367878559897011 -0.75614931858933776 -0.45222361806916556;-0.56357025778228587 -0.72820290921111663 0.34159131838734935 -0.99472757786463595 -0.37115538720597735 2.6139347662767509 0.15515276555584315 0.78244767936056325 0.98119920109980396 -0.47075302353732368 1.0718629011354399 0.91867656362248007 -1.121090314692712 -0.4978268421677759 0.085893039307995939;-1.1316784931138468 2.3011468995145283 0.2181917501634901 0.24859312895128721 -1.9616676825968442 2.5901116999602913 -0.066647427710087276 -0.20695815599553288 0.15884873120320267 0.23038651411678288 0.030473964933816676 -0.311174855175405 -0.71550190435212102 0.78703122009138682 -0.06632879962250908;0.64860808061339692 -1.1860616814089369 -0.076490711694078714 -0.34841656947759003 -0.07683830686115864 0.25581018284423002 0.32045580155273007 0.57171028711948846 -0.1437208992294727 0.19112396427608705 0.36987294299784362 0.30427852501291813 0.28053067272389892 0.15392428427306745 0.68264823793798879;-0.28797556429366744 -3.3619086430213048 0.085440937744693995 0.080175132151188072 -1.0964223568309375 0.38000473160143405 0.14090035791564576 -0.20399796446219701 0.57573845649296163 -0.25964851590240312 0.39201096924804074 -0.069154476825774469 -0.19666237701000447 1.5449486760061171 -0.46502472113201576;0.33387925364251581 0.0066909390835391946 0.82065352795866253 -1.0134452239997847 0.24782199138453978 0.89607090923805055 -0.4502952290793551 -0.30282139615536763 1.1993370605399585 -0.22419710166931703 -0.43255953840626599 1.1170690621825843 0.25709842443056075 1.2381837673809131 -0.22667131709194221;9.4002425377223631 -0.13742279732171592 1.7092075826604434 -1.497344952911102 -1.6803099755936128 -5.9497120036487479 -0.1947751924529382 -0.23440017140512151 -0.013178827327057989 -0.20356037985165298 0.54602966387012608 -0.27404315397420642 -0.33371635248992082 0.20582719362046115 -0.69454616908445299;-0.19147061730803266 3.922475980365796 -0.11632176415680334 0.024940034356503306 1.5033017531989459 0.062901948536185456 -0.14417204352618224 -0.21172873613535617 -0.27825073028605707 0.14269814897529176 -0.61197518260982553 -0.12647401450185192 -1.8190548254956171 -0.32967676143739433 0.31065921178329764;-0.50288844241936048 1.6814060984065462 -0.42174332360917216 0.93345012761818169 -1.1266748429333118 1.032183950253067 0.1916582378726327 -0.92613335021047727 0.86729624964744623 0.84935795627262589 -0.79101058200617225 -0.031373426104029892 -0.10224885553859121 -0.1691537215464215 -0.38616330217106859;-0.30436481736517429 -0.93199961793600439 0.22698780381148012 -0.51149720782783126 -2.9242755545695753 0.89605214885302087 0.14980827317516815 1.598972244532304 0.76308448436382081 0.16148955121496572 0.2708673364063961 1.1154728035855672 0.59607801365794932 -0.21538813598974141 -0.32520954336154395;0.13289927891042702 -1.4455333662522105 -0.060411125494563914 -0.076965850231936014 -0.16860260719362957 -0.30769204378327553 0.07394239343851805 0.10874749000524782 -0.083506783914686897 -0.038414022952529457 0.1525607605338595 0.073031556222704616 0.37326077698798316 -0.31206898643871828 0.10996935599907753;0.0070857599699532658 4.5133314335057326 -0.26681050879646001 -0.37481367132276427 0.65615454802984408 -1.1157839346613359 -0.18698265853095805 0.38705655907409192 -0.26830514233385072 -0.38244011362698171 0.036601903452916584 -0.11059963682024886 -1.2640863885736426 -0.6343280760519836 0.028278503727404383;0.15030589644578243 1.0495892991084674 -0.013288802154172347 0.13544288860495662 0.53137375102559703 -0.89645758781165319 -0.065061618670548022 -0.089105002968248637 0.39441430468032818 -0.10359825153606231 -0.082815482471011476 0.05458811936539399 0.8224380545287342 0.18493108489723153 -0.36586610943898001];

% Layer 2
b2 = [-1.3333079542698312;-1.0410230859529226;0.7115379509071067;0.3613511050612917;-1.0384289703055407;-0.22896581415827977;-0.62566097259196163;-0.50015857705077726;0.61844610593698146;-0.034287326929031386;0.78055847846396553;1.1610351540842856;2.6808321820935674;-1.6622670866395524];
LW2_1 = [0.30582604851172873 0.11707575003903922 0.28442404171197638 -0.028728503438945886 -0.1539514855730065 -0.17609103832131173 -0.65553173231846062 0.10368095205464815 0.60515328553176595 -0.14167922206344583 -0.46541460651299932 -0.012300543873663639 -0.63208898625544319 0.98430341348043449;0.10848660701910429 0.23776102946011166 -0.60011489249201988 -0.36976587131111233 0.60135997388085816 0.39314943528672419 -0.054811756016488085 0.99090382363624896 -0.65877927553632154 1.3199919747982614 -0.11248507711195116 1.2506431709647763 -0.59170098050083719 -0.78490102575150233;-0.14798211466514349 0.7220096754001698 0.15110322898317449 -0.0082225045306026315 -0.057038091157126783 -0.71811052593019253 -0.32067007391017233 0.50205350427083051 -0.21586696518017831 -0.011358083932434131 -0.25005652335006384 -1.3789718757966214 -1.2447741899287896 -0.33480246867981217;0.27676974873321597 -0.63585566409235417 0.42580992351137059 -0.081522414283158401 0.15772896684573973 1.0416067533969331 0.84459118355183582 0.21970264424542363 -0.46847021387000526 -0.17086245038467296 -0.56560517495290719 -1.6914685351621366 -0.40665014100985136 0.52144087387465932;-0.57379281799659931 0.30485777865201436 -0.78697189845002502 -1.4959413244957214 1.1071336091309911 1.0432236045852372 0.023306867114702846 2.4183600633754567 -0.9647529621827724 1.0396085900424186 0.1570124328624512 -0.6947586278901593 1.5721301668272798 -1.1376025847869138;0.42759873880138222 -0.30081879607033896 0.28306624044458323 0.54851728939103306 1.3979453734549885 -1.1294331363037013 -0.19222083790748393 0.71882298148428769 0.34195876551461907 0.62638387393822725 -0.4898634944268262 1.3030615893771826 0.49557628991157188 1.0735044493746115;0.81271327844796215 -0.15241569571662483 -0.10447486682302123 1.0535829847025775 0.27625586773642702 -1.1133220039146519 0.36320493022909583 0.11742866602225192 -0.30638497582944851 0.25508824312001216 0.099676917101497564 -0.56182744273547236 0.71510953685512058 -0.82884393017314451;0.9060308399058502 -0.40349862452566665 -0.89314860209108538 -0.7380864296018842 0.11336314669433165 0.13027557067851284 -1.0071125203852318 -0.48455106308153023 -0.049552756254711693 0.049362588834213503 0.66129584014513099 -0.85206884009450023 0.57133091572415584 -0.47684507374501062;0.069828241449249775 -0.4399849475644847 -0.036163664498301995 -0.46080275030401702 1.1186790079970936 0.43786124113962233 0.26917946501665063 0.57068655972502935 0.59319624624212119 0.52652483698671082 -0.12699468242181988 1.5619292039356074 -0.14349409793503226 0.7981289071949218;-0.6475888191187833 2.0556218137310363 -0.75748779300982783 0.24408029933917408 1.3647861653179014 -0.8174048489795952 0.32143063292244295 0.49382812439360368 -0.27712003421120901 -0.46467935135029503 -0.36169663486749676 -0.79170889540755918 -1.2701847204972685 0.23326603212341396;1.1878947472145533 0.13610774602933579 -0.097122933291933361 -0.0074343617040056875 -0.29960063070107995 -0.35027746470783189 0.32168043933864321 0.17674339657808219 0.4814411047252467 0.12766738954731754 -0.28016140408492507 -0.72413508780800029 0.073160840958131995 -1.2429211072894861;0.42524357323936868 -0.13914658142656386 -0.45990485628915023 0.25198429142266771 1.7324677078923369 0.2991478742829391 -0.31231750427236876 0.092948206378235254 2.3746281494630548 0.46141719555229249 -0.10378703363054946 -0.12016035811889003 0.67991199041720241 -0.33915610238979527;1.2137368811989198 -0.35785071714732125 -1.3686165968013793 -0.16982071065265886 0.42921133743046591 -1.0704963829980121 -1.112619905533347 -1.9171973929051298 1.9201255988736594 -1.344244759880423 1.5219132551309194 -1.8953310155617091 -0.55439533601975488 -0.80054656170443406;-0.94654365868356294 0.37657714837161682 0.93284430112991024 0.95295719223293296 0.55556374841017786 0.037607522377984232 0.46813781680218813 0.97159104962156839 -0.32669047994381079 0.36849562717672252 -0.79962286800259053 0.39872064874919122 0.53512774202490521 0.52925143388300544];

% Layer 3
b3 = -1.5338520604300547;
LW3_2 = [1.6855689069223534 0.70483592208756274 -1.1039545319226496 -0.85718430689353586 0.71642516906137454 -1.5585155555561914 2.2522693718731577 -2.4051251446191344 1.3776147663692933 -0.44319064194525326 -1.0682601738271587 1.0135713835500249 1.8874961804826424 -2.0100482536115734];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
