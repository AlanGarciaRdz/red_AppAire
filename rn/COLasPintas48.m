function [Y,Xf,Af] = COLasPintas48(X,~,~)
%COLASPINTAS48 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:04.
% 
% [Y] = COLasPintas48(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.241545893719807;14.7058823529412;0.0179856115107914;0.0558659217877095;0.00576368876080692;0.212765957446809];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.1686226890556921;-2.6032424744584466;-1.0540287966948103;2.8442077183111016;1.1468725993306026;-2.2567178031333297;0.29755484895560275;-0.90925343030381445;0.029134443874344173;-2.0142534397203602;-1.2312396214026897;-0.98017253010154792];
IW1_1 = [1.1037887609659862 1.3419259696261343 -0.14639162955713397 -0.21112017245829884 -2.0801642373676037 0.4937042884797947 0.38526150347758648 0.37535099752704693;2.7083915521217361 0.57353069349020891 0.24746799471670652 -0.085519761293830293 0.99334018510903865 1.4948886425752455 0.31364307001921449 0.14895600533376885;-0.062614348201782924 0.99210536087808465 0.56884588425425375 -0.12927284565389352 -0.30973339562869007 0.49110123820678292 0.010855963955991843 0.07801538328496975;-1.8329592413102769 -0.053365577112811528 -0.012078199002798752 -0.79332901756788665 1.8709832160933255 3.9814150612145194 0.46501388179849423 -0.29655901901993847;0.1534547324141097 4.6486541377384363 0.22098864565410048 -0.0023977251303801995 0.26177750446218223 -0.8300681950426172 0.050258462622019565 0.19162323122492775;-3.089956669612969 -0.22607897975059293 1.0075782700690719 0.058875815954180427 -0.81087984588836426 -0.91086105709372656 -0.18228622989476742 -0.088225142704628848;0.60024356794111156 0.84420577309499756 0.53169393986176738 -0.0750361524970444 -0.74609117949535397 -0.66224053829244056 0.038817903291150216 0.09880153768518353;0.4846855726560319 -1.3624321535268671 1.1646945388739698 -0.79488669058597539 0.85281378761291582 -0.38447331399876383 -0.078146098921181184 0.47639132577559301;0.14002686883643542 1.2675602879858263 0.69692282093434765 0.030427501601094357 0.69397098129244261 0.94829883671920079 -0.097895856074707591 -0.039718402478493314;2.6764904378970171 2.3718055907581954 0.18260829053446553 0.45173964346210088 0.091219600981352275 -0.29377985864545564 0.11082086371658523 0.20861841766767389;0.7292956822684854 1.6180892178087702 0.2469367551643451 0.33276915915517563 -0.078241271214412184 -0.87010459552046582 -0.16049226542645598 0.00019457517481289224;1.8116032155863211 -0.99882365699239084 1.1739822178726036 -1.4351344472599687 -3.2398123513345087 -1.0759144389603625 -0.033195863352771679 -0.13970197618906205];

% Layer 2
b2 = [3.1109590571949846;-2.462388375502238;-0.0066719734335828687;2.5654200610897657;1.2264950050082664;1.8480132183794109;-0.14889976599351781;0.14507600291884112;0.28578019582270497;-1.1773791252395642;2.5862713014827148;2.0553562055852401];
LW2_1 = [-0.62406886424956454 1.4783463502718532 -1.3448579303925434 -2.6431172577754674 -0.68706668627298106 -0.19631511290245182 0.34463254132967358 -1.0072957290846525 1.9295353146886649 -0.76763450706679592 -1.0579159338221409 -0.31105844393347165;0.28562933899145826 -1.1179581629682722 -0.49275742538870543 0.67978625399095216 0.9545441203458066 1.1042840662984306 -0.23928839152250803 -0.46431546455999995 -1.0921020748676913 0.56354370787877173 0.37113338270493096 0.26846655071013925;-0.032320045448768459 0.059262284529527656 -1.500504539719393 -0.63131940238889939 -0.8032167460909343 1.2404211328405179 -0.082646653617148569 -0.49123496073030726 -1.0199194696567049 -0.10015613124238151 -1.6623332144575089 0.17051623021490422;-0.044099303591054052 -1.4826944500445649 2.5364160455986617 -0.97535408046836769 1.0565249694588499 1.4151708205730102 -1.3098262062042665 -0.51849232515776256 -1.4470268634850287 1.3687521660655588 0.76701768487235478 -0.25777738158461488;-0.57860242630562042 -2.0796472431776101 0.20803104108524673 -1.8587280036639733 -0.6511932245555091 -2.1759927469541083 1.3270105331426472 0.78928287302372979 2.1473439615840149 0.7432992309300791 -1.6008785994035106 0.72115337679239511;0.57887453851842285 -1.5795577711397986 0.53717474870487436 0.38528035808582728 -0.97544904821001877 0.22405723591539217 -0.063747396328036221 0.021636802343292905 -1.3345667217959167 0.71734124804793131 -0.18676005080581534 -0.23169010470409795;-0.38649257470765758 0.032826188650642227 1.1656886725346025 -0.44282800781382969 -1.0550828895443705 0.11310781669156894 -0.65278106242137102 0.7139092395425537 -1.5108997018379691 1.8568720463553305 -1.9723487640196953 0.060736332897047399;0.4505691049462287 -0.44522328707789571 -0.55066090331104423 -0.2973558770556286 0.60808277884531003 -0.26697091647544813 -1.587459853853759 1.2985245103646132 -1.2163224096059275 0.20379365524146342 0.55026110608976697 0.4747070343269475;-0.11960831870436897 1.3324276496678513 -1.3144026015356565 -0.054629616941859402 -0.7989079425250063 -1.1678143699227621 0.57138833519215571 1.0772599751643197 0.37288366263287026 -1.066430500465017 -0.10560388926525023 0.09593058187809024;0.18297420422966365 -0.75528660357422339 -0.4304515882292087 0.40582471251530378 1.8211830390696673 -0.99889454066367556 -0.31481845946615261 0.21168504283198253 0.75730263330693504 -0.52328062025976607 0.31284196944697035 0.23335236156935921;0.39527523983813151 1.3848012898805995 0.15586310982333043 -0.62523829613251691 -0.40372140045871885 -0.53717043621381444 -1.3686272292481296 0.21941287441135088 1.6353365298753493 -0.88449421928948102 -0.45505348326088857 0.18477259514292854;0.54822753528534585 -0.25525255728907437 -0.44897610640345531 0.95363658419882336 1.2583762858126524 -1.6280795489140782 0.76482923136825542 0.75974334029191393 0.75179656250641358 -0.51761558729937529 -0.26087285658195092 -0.62572886634438363];

% Layer 3
b3 = 2.3373662104358504;
LW3_2 = [-2.4327271114135525 -2.659607887780493 0.48310867516507855 -1.1391850134717232 -0.75517212346987495 -0.46439494506313034 -1.5522837138488652 0.66446447997149105 -1.6180287744297279 -1.0155183231690821 -1.0590214810631076 -1.0104818178134045];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
