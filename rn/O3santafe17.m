function [Y,Xf,Af] = O3santafe17(X,~,~)
%O3SANTAFE17 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:50.
% 
% [Y] = O3santafe17(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.172786177105832;4.16666666666667;10.752688172043];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.6046951151118201;2.5392481711572858;5.7364102862084456;2.6917289714373269;-0.86981706221984612;0.0064276837227364991;0.35993264745407028;-1.4551941334944483;0.22373723364993658;-1.6622055965293623;-1.6427071421666486;1.7417197441155556;1.6585466695823705;-2.7946939012047194];
  IW1_1 = [-0.53074474596568921 0.16047349710296685 1.1318265644923735 -1.0178433461256153 -1.4053404872939803;0.51195759316041156 -0.19261936395933638 1.0577391625273438 2.7356777495904443 -1.6184136410738286;-0.078244940633890189 0.013760418952928299 -0.060654345018497556 0.02546213877839754 5.7822901350334863;-0.50831197771488601 -1.3983570188508485 0.84034638699707687 1.869782719895537 1.0282563219966019;-0.089193042484320945 0.86622295959247675 1.5453465472392696 2.0563399239956328 -0.89474476653076607;0.20110679508766738 5.9339356938370011 -2.9804977089030431 2.1120995378896872 -1.1726595069392467;1.4230004563507181 -0.97521016126563809 1.554609043732571 -0.2739131250674689 -0.82946359202519127;-1.1904829077579882 -0.86613457501053992 -0.892876279565058 -0.88941597865034872 -0.2773535273579178;-1.21148840324969 1.1438904386976885 -1.2650608203255733 -0.7322305065945538 -0.56122911935297015;-2.5665653762330298 0.14121101760210988 0.090049323194258735 -0.80757998715390689 0.56799500651367074;-0.17394400365980145 0.29940706395710665 -0.36067106240732638 1.5597323140028325 0.043360921342439879;1.1784598730620943 0.26042671655279259 0.11904763576952078 1.6718727853436652 0.17320569217672077;1.2501848497554926 0.76077803646288622 -1.5067547494243636 -0.33575284477795875 -0.48197281308178141;-1.5699221421189979 -1.1340293282325249 0.79880105778210353 -0.46812457612925595 -0.46648459064887837];
  
  % Layer 2
  b2 = [-1.8093262070409892;-1.5496372310190383;-1.4044981578832145;1.9558672211635475;0.84411652841164675;0.10269872542122691;-0.18719888553981173;-0.68949047891708592;0.02494516733666656;-0.73173977092056297;1.2074488061683895;-1.1529786292002087;-0.97630386989810647;-1.3822505834393251];
  LW2_1 = [0.047333055549228974 1.2330451685713688 -0.37985762962079117 -2.0648085920611385 0.4066197814421203 -0.92216668805104063 1.1667808767183128 0.42012030019169633 -0.93933277363025613 -0.45621896969408221 -0.093374395148991179 -0.013205489437876805 -0.48766100780417926 0.31098498589713119;0.55371914782488463 0.17680285962791326 0.16819977712645726 -0.13781740703037065 0.010783363361089579 0.0076132500200869844 0.10211286243942616 0.33222289046810993 0.69830064277028669 0.88239544910299095 0.18082966098651446 0.63863651438701174 0.74576814625000187 0.20345772903288911;0.44157559607891794 -0.44740715150666632 0.97065916723479173 1.0428816730659094 -0.39694953398130772 0.24076444217763629 -0.55762198215210512 -0.69003573529507034 -0.18307623335362092 -1.540015135076245 0.752500059278985 -1.8608190118942671 -0.55701423827527896 1.5137108385341635;0.42295771771156515 -0.39999162957723244 8.1247923094732677 0.078891473483212016 -0.022658374573619106 -2.6646416773200392 -0.46618641413837858 -0.97999230024713557 -0.35822240371619535 -1.2495371571229044 -1.1586723262098304 -1.0241601517006098 0.68004283352013783 -0.47075639695172133;-0.33266147959404879 0.86827406317686884 0.013901578224122878 1.2239107873552131 0.020157384707287028 1.274639114684887 -1.3897525277157325 1.401548793868586 -0.72442833403267715 -2.0562075983640296 0.53118545403953443 -0.46286792466749987 0.48381875587631085 -0.0032755746048836187;-0.48472252616108857 -0.21989965447550666 -0.42474923681597831 -0.58114556223972724 -0.1405401236441432 0.31409395412663199 0.16936203913567691 0.24813996374972522 0.76009545741045004 -0.46005196231689116 0.08621850120944749 0.078001235095799565 -0.9690380194118684 -0.21585284934416171;-1.1365234913000553 -0.84518007755482649 0.28837512663471149 -1.2178625506122709 0.12719589339133158 -0.90610987089863104 1.2468470420779714 -0.69718665178960981 -0.27591046917190915 -0.18344669020232923 0.5988719159282363 1.6002508853101087 -0.53987060079793647 -0.26468518873338376;-1.0760013288439947 -1.8903964466004666 -0.365585605731854 -2.7565017143796111 -0.013388856841053474 -3.1741960445890371 2.1111393283334747 -0.87462599918308515 -0.72268383605772912 1.8850206262066931 0.63128448891874667 -1.7998178792862702 -0.60848140294187736 -0.35035610863751443;0.28217138541951536 -0.63390572449898819 0.36637651323061382 0.022369254094202755 -0.33134429393155207 0.034329837330166632 -0.76355071816759146 -0.36567977498350607 0.8843757192476337 -0.5353506588538095 0.36176497460037599 0.21552702654053535 0.14343578876885316 -0.24631007779281847;-0.52630278888251159 -0.23053005557643605 -0.51036828832023695 -0.11941758619294321 -0.18676637893678932 0.19043260235432735 -0.041846988135808269 -0.27126210690270891 0.10470035495505658 -0.98495249893846393 0.076963027863223843 -0.8165670254801416 0.99590591687856056 0.22720471734349518;0.32378710984243447 -0.30382075397279423 0.50416941274079863 -0.030997759519699013 -0.71025534080932706 -0.14977463322879131 -1.3704276293777262 -1.5532017887771219 -0.53342975052540387 -0.50645861864677377 -0.23783679053817985 0.51540278879772405 -0.28513583731740133 -0.55530452394187191;-0.68814429175991509 1.7416706711023859 -0.17995625465215065 -1.2538495093659183 0.66734439973671877 -0.33185179554078525 0.3742156033892271 0.96373674107115115 -1.490746155196325 -0.20156116701747348 -0.47950425881939074 0.2895496675241358 0.36906224849172486 0.60717615599827968;0.28871558222807736 -0.38176480946528207 -0.74918510136769534 1.1330875362793302 -0.82778883957892713 0.14913276846318482 -0.82933505268514252 -0.71650024452049133 -1.010512340111225 1.064125368048642 -1.092091214911924 -0.81910349696016882 0.38324059195940219 -0.27344834264479639;0.17310229095631652 -0.88193795021025956 0.35070073274956576 -0.85132674406726694 -0.37487961226775174 -0.77884769486365912 0.49128908109515745 0.51464791948824251 -0.18161037598037896 1.9690429916809391 0.46935801189870319 1.4457777113553609 0.25164433717497275 -0.40968180096096007];
  
  % Layer 3
  b3 = 0.095282943099810835;
  LW3_2 = [0.73588808248345094 1.4200915195875494 1.1443458804009419 2.7542658716774016 1.4087149698667543 -0.83210942745366712 1.3854106405534716 3.0999153017209959 -1.2919385305596183 1.3673588406258157 0.90017842398997183 -2.2713042897836 -0.31419692382763137 0.58498188168763776];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.752688172043;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
