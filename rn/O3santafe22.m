function [Y,Xf,Af] = O3santafe22(X,~,~)
%O3SANTAFE22 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:50.
% 
% [Y] = O3santafe22(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.172786177105832;4.16666666666667;10.752688172043];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-0.90721990379793171;-0.40036112306907418;-6.8719593210460532;1.4537475285278949;-4.3486837736970596;1.3320268198232139;0.13880333295449182;-0.56168771273144336;0.95576043485181261;-1.8254527955233641;2.1821957525220559;4.9570130228631815];
  IW1_1 = [1.5468378972120593 -1.2321363782862895 0.40858190582319598 0.40969420784747645 0.39394703989120505;1.6296748492704698 0.64189869024369461 -0.91313525642886206 0.20451691864379903 -0.67854350371724503;0.89623123754882539 -1.0904065902229088 -2.086918255765577 -4.111869315929666 1.3481651892347668;0.10784157084365549 -0.30064412149514524 0.41191010427448821 -0.26319956206250461 1.3737892501881801;1.6219523591909619 -4.6596993122745918 1.8816276056921595 -1.5933594074295583 1.1278067124577045;-2.3531227769671994 -0.71687080218094668 0.13953717469505866 -0.19989469046144182 -0.82707740855792167;1.7573817056268048 -0.070340404147120617 0.82599443215898671 -0.4895670530988222 1.5467274990816149;0.11813763076297207 0.92013341327240805 -0.10176329879754263 -0.25532467860967539 1.6465111308650775;-1.0690820830131211 -2.606156234816682 -0.096826941452120924 0.26580382710068873 -1.5701440196240954;-0.099917352372362211 -1.0094386087175471 0.10826489987867227 -2.4568028146008203 1.783851885030288;0.8223110287990697 -1.376322707752077 0.47645285460707765 0.4625462039147053 1.8361733040724315;-0.26326987994616435 0.25056578665850948 -0.98080117047383553 0.62321070480179208 4.6540909506676549];
  
  % Layer 2
  b2 = [1.6758729729413084;-0.96717867665133084;0.15960538305055888;1.2227498489179263;0.56953750122236202;-0.25055964088601124;2.6289869973394326;1.2944384651277385;0.05983680106823816;2.3701716331975184;1.8928006391576584;0.33511154434225549];
  LW2_1 = [-0.35500768149084061 -0.59666263974641753 0.28956661980946879 -1.3272775226531097 0.17587121092077959 0.12796963888742308 -1.2064263801088098 0.31559529936647135 -0.27446140803113761 0.3463632317320382 1.5581978632032594 -0.69635695296221523;-0.16807339758973855 0.64121300483433519 -0.98140707474239552 0.81283977835189669 0.24336824337880369 1.3788496281712528 0.37017627098560407 -0.25482224309353574 -0.50039490562857658 -0.89100248402531312 -0.44244446405951121 -0.36085591552544966;0.88533539143292095 0.60105594894977321 -0.23377746163673643 -0.33201277501564619 0.040384001038668418 -1.0721608100204285 0.29181061886052739 -0.80814661145632172 0.73043506430185157 0.66758629974917694 -1.3708515891306225 -0.27471410942653268;-0.9667019409682851 0.18482773253394985 0.015706943810830223 1.9734796485857882 -0.36917094029671005 0.97055277588680788 1.3243682402247461 0.19115274486790249 0.03621428320951945 -2.0240294355473361 0.28735859998236407 -1.877051956706083;0.050064463423656468 -0.3870371897819424 1.4281298852622386 0.14437320850849975 0.78314214217135714 2.3063531715595138 -2.5107578582451135 2.3186630297905886 -0.35806624187984509 0.038624775797882746 0.7945249442266995 -1.3518796779884492;0.23082767576020183 0.5220061982937878 -1.6246380727489558 -0.43478544084488252 0.040564053438921305 0.82992698756504679 0.13287598327191025 0.65357529011999449 -0.68355997898269394 -0.37547475824000093 -0.17170434968587658 0.066711446748068379;-0.66181625239212516 0.23419498457118906 0.80038447333399743 -1.8495094806434227 -0.32149869674671311 -1.0501783481204208 -0.056241324992319618 0.72472553502991022 0.75772054873681238 0.51288300114883645 0.29222882689358959 -1.3948227287273092;1.8489269399742627 -2.2782019182741942 2.7564821649277773 -0.0037052654884347112 -2.2019748086943363 3.5594740868443875 1.3842205686034361 0.65943895730137336 0.18435784110106523 0.13099054286627523 -1.7758392336476141 -0.76967462280984611;-1.1661478110847081 1.8337510574594211 -2.2229803916193447 0.73388153717423632 1.5513943947901372 1.2098246050893895 0.46251751387041323 1.5518649439570344 -0.35247620805262436 1.1742705546213086 0.36879589503912025 -0.83951966386135246;-0.35093180486915504 -1.8753921683766661 2.4502881778651826 -0.6587197140157165 -0.35318202836204315 0.055166219273686846 1.1679164118431933 0.6755990773826559 0.60564068622390899 -1.0089063095098825 0.0091706496038314027 1.0674300789624798;0.35226275718292038 0.03296077077216087 1.4595067874234808 -1.7127515150838351 -2.7801988455031075 -0.11109340862069936 0.59842452260841816 -0.55925291048636139 -0.18080211886031819 0.35339425532379526 -1.0218364478035946 -1.4828520343359668;1.4249056999587253 2.0820764125282682 1.5630252908779003 0.0059082931070795833 -0.18291127053615022 1.22495327849292 0.10135351746800533 -0.20853065887961364 -0.074840974164602253 -0.051323661673710191 1.5945759263922303 1.4662723837132834];
  
  % Layer 3
  b3 = 0.1730303156783663;
  LW3_2 = [-1.0345429785824196 1.492731213003774 -1.1527102561827423 -1.3326516325388376 -0.69864372414645515 -1.422468899673182 0.8705117750128839 0.51207432359894778 -0.78070237017777167 -0.92711868086598237 -0.60025631076364783 0.38361141312267222];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.752688172043;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
