function [Y,Xf,Af] = SOXMiravalle18(X,~,~)
%SOXMIRAVALLE18 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:37.
% 
% [Y] = SOXMiravalle18(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.0208986415882968;90.9090909090909;0.056980056980057;0.0063552589768033;166.666666666667;45.4545454545455;117.647058823529;29.8507462686567];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.3597823674076941;2.2043783621450088;4.5833053257454406;-0.18827377318102373;-1.419535474003802;0.15308168929734178;1.0326514208174522;-1.0505086339930956;1.2550860598800064;1.8952137256212565;0.071821147895802476;-1.4345555516197162;2.701944169841799;-3.9819448990224164;1.8101393644297572];
IW1_1 = [-0.63467226183858205 -0.18497942072823112 -0.27495453140465143 -0.67118144254618195 -0.39135111313838938 -1.1992944607257208 -0.020139285918558555 -0.72826694099381872 0.085362675113886802 -0.41954543132070471;-2.0316541741729544 0.41013224366198003 -0.47216079873251449 -1.2303487992047275 0.25229443926511053 -0.31198096549751558 1.0014184776212214 -1.3696905405882864 -0.093437212806317949 0.13592971898408274;-4.1737757909418054 -1.795794302437725 2.9756213885555085 -0.23425655819500338 2.698605765759333 0.45900393042408638 0.61185813048274573 -0.26514363540631725 0.15086731313456028 -1.5731903532913716;0.067236213579075443 0.22805245759368101 -1.0068386348062142 -1.2515980393491013 -1.6183052688655277 -0.19988837481026772 0.18826582983973672 -0.68759842226063284 0.04160078282578486 -0.32474563707587195;1.7236136950696366 0.011471060909042156 -0.19709956066320183 1.5730588137078318 -0.5830807817579482 0.32930909788982043 -0.32797035735487035 0.3311750040285163 -0.20492411285032089 -0.5495658707529929;2.6571341225261262 -0.15411446445346771 -0.13964486725657468 -1.9618220980348513 0.16009941281000903 -0.16444673893616937 -0.16643235260283612 0.70107600288600347 0.83965422918878274 0.87442559456533986;-3.6776174974895413 0.12111941423932829 0.62503636505588978 -0.78272758625980621 1.5254539676738568 0.15358934343101965 0.058789992859873727 -0.11517530063645348 -0.36776331735868328 -0.71602939489384365;2.9222697444304946 -0.10680894327483112 -0.67450899980562418 2.0932062675712451 -0.17316118580050674 0.2571210006094331 -0.35572662493832047 0.32270840494013814 -0.32262213847359417 -1.8018454395218166;-5.778459441196679 0.01835279204624661 1.6161727125482745 -0.19071747689689533 1.0765704013392958 -0.27444150857298472 -4.8357402577581921 3.8499430798802625 1.8428345075142756 -2.3349282657609653;-0.0846093208031507 5.5022824644786139 0.2093102257287815 -0.37392572889034087 3.3898282237048192 0.8788136254004093 -0.85437338825919729 -1.2768648777396332 0.1407154922634293 -2.9394311362631269;-3.4761284651819393 0.18738227162536261 -0.47917063306724078 0.63195909270147421 -1.3029657238560957 0.52640096991862551 -1.7406444534105594 2.8303165902542413 0.17222864711718069 -0.39640435579923861;-0.043390222016834339 0.22626968154086879 0.90312873944423033 2.0534413057342729 0.66653540214801521 -0.17682673340634575 -0.23269811910251176 -1.4860788631368276 -0.57659198880957563 1.1071465968355549;-0.38864042456894371 0.16283065911241962 1.2609091590182107 -1.2169011354767774 1.2170608573769255 -0.42831527067712299 1.4241386508225924 0.37532995240807937 0.87272545918465005 0.74045669799002511;0.12464198052774467 0.050047507280926253 -0.02202132119272672 0.67172690297659099 -2.8330388637936004 -0.10410023528718 -3.0760162305662617 -0.37924357349826499 0.86100782642494578 0.9747948955569401;-0.82898573515791352 1.5310449910726898 -0.069980880451532029 -1.3629529569015544 0.074476128841689707 -0.3230762016512993 0.28576951681215035 -0.70153507506167856 0.32541877994028984 -0.098477951785060622];

% Layer 2
b2 = [0.35144040018192935;2.0447552895221675;1.9733167094805184;-1.0404828659112142;-0.32598555213873454;0.20150786005296764;1.0889789223695612;1.0498211483669866;-1.6911313291115655;-0.1910302554850189;-0.50729096493720294;0.37057182421235058;-1.2766700338365919;-1.6790211735975427;0.55621137707133617];
LW2_1 = [-1.7025643290258932 -1.3195549603764705 -1.9959028941863095 0.24287193607171728 -0.99193662576963704 0.2078077418388207 -1.7749291882620128 2.0020792739529276 -0.69068387720157409 -1.2544164493715035 -2.8934995088757516 0.073585394738559198 -0.66065716541816299 0.5684633356749591 -0.53584372480496689;0.14357003576968683 0.29710920420119807 -0.2094710021728276 0.69343139755224248 -0.82832143494300237 -1.1765904303620149 0.265613323212885 0.73155446136051883 -0.61643275168477529 0.015276820938108303 1.112961819289505 -0.40572471506003988 0.27267556487685152 0.65012260447953052 -1.5446229052445459;-1.869057684981813 0.78339135257164472 -2.9830643321739863 -0.78842486059218853 0.54398526908821643 2.9965570500467176 -2.32440525179336 2.0199839027410684 -0.58398540582144109 -1.9601389198410675 -1.3791636259012148 1.2125892105911686 -0.90928127301992612 0.96523894493882612 0.41449172831368819;0.4092437269961347 -0.69566217450008794 -0.73099324972630331 -0.70822904335991743 0.3447396046387971 -0.27149304519605438 -0.20268793949675526 0.19068026565299018 -0.21969984927982569 -0.31960361373719415 -0.17357710876146679 0.82274497898422461 -0.048098833470926292 0.11077907623932826 -0.45769019861386889;0.19923177857515914 0.84736928305053794 -0.71255471382995694 0.28047939760581897 0.17199985533620685 -1.0145070027167584 1.7784481258410616 0.71292259145932402 1.0427062170529402 -0.34716593694859521 2.0394885130126381 -0.96484838888687574 -0.30312847087322797 -0.5242068148710034 -0.42499263885861877;-0.010696989261928497 -0.35320731505624808 -0.17975786448569536 -0.247187075639342 0.57853161513599338 0.064988384702494642 0.077608973836026302 -0.34424934119670353 1.0517775811984105 -0.030806571352029737 -0.68832383202512137 -0.38588120591335479 -0.19670461945226664 0.35691349715414022 1.0904451048218358;0.083104828089521479 0.43651853867178048 -0.66486296043068716 0.90134788406411193 -0.24936718123437798 -1.1219168172202958 1.9111272795777472 0.99529566594262731 0.65150420638468665 -0.37141915646327422 1.6771633741290666 -0.68060756996980143 -0.045297401785069372 0.016439919319866169 -2.0210594026879152;-0.13027377128582582 0.55742924430479146 0.19211493231901916 -0.46412326023770251 -1.155733002431141 0.8422676615289646 -1.1644038190498571 0.52297973371569095 0.96960395560136925 0.12863871903122021 -0.88457618533746929 -0.19561768851101052 -0.32867330933889205 0.25854498984925278 0.37801723144732513;0.30277847775633937 -1.2627999560136138 -1.0802798187425449 1.748637972805491 0.80925629709762958 -2.7762076615696811 -1.0678761416046132 -1.0140012539357779 -1.04580580577135 -0.50654178558820229 1.5080463211117747 0.69382190896287077 0.69002487026822867 -0.33675931655719937 -1.0299174507440889;-1.8414947524938294 -0.85928064569310891 -2.7302366924664372 -0.49104726601304727 -0.67295039045685501 1.7778270978398156 -2.2088899536057207 2.0729665974908698 -0.63346538515103545 -1.7246728803686644 -3.1366869592039195 0.77140552576736232 -0.99498714251263665 -0.16480211417304882 0.2378374727666939;0.57939408206933662 0.64952898436687834 -0.54281929200375401 1.086957025479367 -0.2184662083781182 0.10661419442149131 -0.30407034114238995 0.070968457960875905 1.2357497996217635 -0.42830327839671767 -0.6915088169826773 -0.35498819566613882 0.085287602194142581 -0.64021112115195211 0.29011575903865006;0.079394044051290774 0.10783636632653572 -0.27613386595484207 -0.24328747812613316 0.25404274604082278 -0.3833904664620249 0.43803590386421409 0.044993693719594115 -0.15883756754523404 0.0019778184619561705 0.097270868300657731 -0.26142690839255239 0.070570510842234119 0.81318985255999654 0.83221250839355387;0.064063096719393697 0.04299945797812333 -0.065673536958356926 0.93545644869275724 -0.013318107989336699 0.96055304284953857 -0.074662787369458763 -0.65812563793064061 -0.68737623780343171 0.39726321171974466 -0.025808281078680859 1.1705829306653204 -0.45900511298554786 -0.57678444837896059 0.1244097838762664;-0.24925137723220644 0.15167014671020762 0.046706758486810183 -0.47693554430749269 0.89956985030443493 0.40653538542381346 0.26888434468308753 -0.19152065710141511 -0.42702698185013716 -0.20212285684249054 -0.79191823423030316 -0.12184904501833173 0.48855438371603754 0.4850780026671323 0.99945897591739663;-0.2201358868646773 -0.77455298574326092 0.29682206589692123 0.17999212742885234 1.9889407911536094 0.57744338870517964 0.12518889881964765 -2.1605797011270229 1.0995991952833097 0.30373567788142697 -0.90120614202801841 -0.68695465553427415 0.54010778882383048 -0.69278012292545854 -0.57940068819943291];

% Layer 3
b3 = 0.31854457787815915;
LW3_2 = [1.1703887777896769 -0.53695445360487404 2.310585470891152 -0.26319737488808997 -0.72486726339939389 -0.72461625036751587 0.76305362152300349 0.86839622906734393 2.4245970236014966 -3.4269969621213727 0.14341775253626723 0.65695678368031896 -0.18421775690014494 -0.47135653592204846 0.11547011479183743];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
