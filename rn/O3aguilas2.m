function [Y,Xf,Af] = O3aguilas2(X,~,~)
%O3AGUILAS2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:33.
% 
% [Y] = O3aguilas2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.42005420054201;35.0877192982456;0.0561797752808989;0.00588581518540318;11.7647058823529];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.8513911722946526;-0.51518571760613441;-1.7269924609225147;-1.5023771088017779;-0.75715691886184577;0.30159695831052269;-1.3265103290894629;-1.1997107828284992;-0.87988354589013684;-0.13392714519689616;-0.1617206605437588;-0.67406213566421935;-1.178313942216775;1.8638979771905171;-1.9940100977088167];
  IW1_1 = [-2.0298335069136528 -0.15041378889934445 -0.35419705325134948 0.55067474775069969 -1.1185259657140378 0.51847781199642606 1.3074685195389508;1.4621398796104756 -1.1872451978220195 0.68441211182773076 0.56665746160001529 -0.52771156575294409 0.71529982050396235 1.4740019196712542;1.7950479103607884 -1.5131689497056238 -0.53699180845344008 -1.4705373861073479 0.073232342911676476 0.45613936804285737 1.2689128270731105;0.74557327186066535 0.16002046855485871 1.1255336354334899 -0.016211143356416761 -0.75425041219745426 -1.0694944380844889 -0.36641515420714538;1.4320278542648599 -1.3702983834914908 -0.33224121477666102 0.55200671498688858 -1.3503797879091073 0.18328745571333227 -0.28352115864218286;-2.7789889449168172 0.67183531127367269 0.59670872138547359 0.26146211346640608 0.54383336839532981 -0.2170640225539478 1.1759999333711086;0.5316373089375771 1.1497223084452628 -1.2987603928037847 -0.45551065641651628 -0.55356723611420522 -0.13495760330713352 0.069976071724682926;-2.4361781899518706 0.40648110233923618 -1.4590663655278109 -0.62007189539225049 1.2103397028084038 -0.055491617909174396 -0.59005145725765829;-3.2494738806776011 0.0028810746444792625 -0.20762651277847294 0.12514628199094788 -0.45718629886749829 0.16531130319751861 -0.53078623821247417;1.7625429693486272 -0.16194095221496885 0.15990857988995391 0.53366467433588227 0.59735193388189889 -0.45004086680465277 -1.2757678785846474;0.53853329340436817 0.74738031932592808 -0.86999037564952231 -0.33312960784837425 -0.50215974219448356 -0.077178987891769774 0.85230874723302608;-1.005964984675479 -0.51339678787984711 -0.38276779446486525 0.10888318949645996 2.4023658354109507 -0.87401705892771431 0.68485490667334814;-0.35959124128418007 1.1783545071632215 0.95898087013849465 -0.66023056848874995 -0.12382973171151442 0.5067482366792192 0.22367650617541415;0.017350906136691883 0.43546653458049289 -0.66520062945018632 -0.77068440339061439 -0.8695357492191873 -0.63169821158907402 0.83664205960113314;-0.43401621353599362 0.15535460006849619 0.084595072164315707 1.132574970368261 1.5776542261613342 1.9346918266537358 0.012487802741797196];
  
  % Layer 2
  b2 = [-1.8718992974575783;1.5917123367835921;-0.55495113000507368;-1.1517939756351734;0.62178710380737001;-0.43366101283805192;0.19632787114802647;-0.17280362202876703;0.015038540379059294;-0.13803981383852532;0.64973275561942845;0.97493392354458208;-2.7796444195927275;1.4323378571690653;-1.3403123549823996];
  LW2_1 = [0.16594997535983214 1.0770993253760368 0.012017210199922163 -0.60665986908569303 1.1222023003630293 -0.13577783760061923 1.651108213944017 0.097651652064839417 0.14767995168269618 -0.11403133485167707 0.14215225100689274 -0.5162705373883103 0.13039965278132193 -0.54262401634113222 0.28412892092053099;-0.91261463024188472 -0.24282328130813727 -0.32333791922246757 -0.24066581013286839 0.56580967944378813 -0.083233530719217741 -0.26172152720644637 -0.50267782092520963 0.5908606949089219 0.18618014058729238 0.46308907048605957 -0.34787668005447137 -0.099689368193041861 0.89451916011366439 0.717989050396733;0.34257681429264902 -0.13395055883542253 0.35630268882358895 -0.11711154603415115 -0.24502253668984775 -0.43395961681660222 0.47434264591338876 -0.34425124761377707 -0.38127219209279223 -0.039816089386672221 0.4245892861848255 0.54768708040472525 -0.18912475033272036 0.71245908649462675 0.27119916075848577;0.05771058185955466 0.73449436459309903 0.062470913417468535 -0.061024375459838902 0.31237083859033921 -0.53984849683199965 -0.2625193989875465 -0.50575105503610573 1.2264625568128675 0.43226656478317455 1.6469828658393786 -0.59096819662031497 0.84259886474849466 -0.30618880812461641 0.49348967422723267;-0.27320305729155153 -0.13215443689979539 0.38047372771640131 -0.18744540249173178 -0.27075025679145232 -0.91342853706368887 -0.39971868454293935 -0.79276516648346351 1.335698219390651 1.1516096130622011 0.64163286477062831 -0.26616691754738531 0.48089184297717802 -0.82843304717719002 0.24622676170399765;1.0690964659048772 -1.095108518445548 0.19634984975490269 0.10197528894496445 -0.088306227439571561 0.31552791514925205 -0.1762114398772433 -0.037877433353026686 0.2452326812976367 0.11788036068399413 -0.39887996248046792 0.025745161319199208 -0.15341058463781959 -0.50755957781075289 0.6835500063415163;-0.67026257157709768 0.10500002689250237 0.077711009140187498 -0.26313681838618597 -0.097490669798803706 -0.25755555399023689 0.4436437150675433 -0.68259937978642282 -0.2344457198531941 -0.36889043040207503 0.37766284614512707 0.51506951887061059 -0.13632560346059147 -0.055944810709241823 -0.80971823382363639;0.89103964151522574 -1.3162047034153146 0.20031649953447253 -0.19846673788964747 -0.19888550114483008 -0.31846137906433614 -0.75893983545813071 -0.60869648493866535 0.49086947113207441 0.55105316714484021 1.0695390134746996 -0.045320658086688531 0.53459561601468719 0.29575787159962103 0.51619868262278856;-0.83655012410295893 1.6279633158604694 0.56048435363408111 -0.10495508564637214 0.38323143127345205 -0.44952324216920869 -0.29612838065058777 -0.46361220165797534 0.83300087594614403 1.4243313315850779 0.78362906230153573 0.074374780375647001 0.4864214625693738 0.37945183786289921 0.55256604500009909;-0.86920699782590904 1.674677832119517 0.36121037146042245 -0.04976719617839083 0.66376033496896758 0.037452176681124875 -0.82025617076075785 -0.5258280945720708 -0.57428501861768355 0.77785070634174436 1.264112761501258 0.096885228538135609 -0.50128020954529473 -0.98283575428764836 0.31887275268064796;0.28274833957675183 -0.89483413648680876 -0.56344888895867884 0.091920005026942891 0.22096760618021818 1.0801664228954464 -0.32036636753528613 0.4158507298670191 -0.67817744566194771 -1.3456744588318756 -0.2017212052987416 -0.028696009983394034 -0.27224844346126814 0.14429237004546475 -0.41733617702050196;0.20164009608708122 -0.50651827240892466 0.025848816211511767 -0.66020327673986656 -0.28044036815272649 -1.3880991132570499 0.035232941526608205 0.84111962601380108 0.029817648602866058 0.82086063479450044 0.89216329521038673 -0.46177900179660442 -0.12896427698721877 0.45269539601354164 0.32415444760551471;-0.78748680558818096 -0.44326107665252112 -0.2197720480941166 -0.15530430242472654 -0.17586796002669219 0.43247564841308711 -1.2419559021603577 0.14046748433359937 -1.004658872000521 -0.98627043567566752 1.1282935307876973 -0.16050829096089195 -0.76602729910089962 -0.83742353629927457 -0.42831459774092967;0.029107249962740375 0.58579708982957102 -0.49832364697601716 0.033402102420242497 -0.078728857858094331 -0.51446201000231184 -0.55865758995258286 1.0752614583356686 -0.44266369454614091 -0.30945872229707927 0.9602529209816415 0.78399170076230318 0.051118460457825234 0.45340067580166815 -0.92928695780586523;-0.32520497557935119 -0.21863414758099062 -0.34844719487306131 -0.10964334098517434 0.18858285318354592 0.97733617361428005 -0.29568820950721408 0.24537942646048289 0.65458588234321369 -1.118846380558298 0.033988092716671595 0.36264264012340269 -0.35003594132264954 -0.40384646187958895 -0.8186739829971601];
  
  % Layer 3
  b3 = 0.63426239304334853;
  LW3_2 = [-0.61288181690487831 1.4650206800683008 -0.9505608743337457 1.4470686317819581 -1.11360889774063 1.0322112310976443 1.3360905113114816 0.85541862548982117 -1.1936041075992396 0.74885502274245508 -1.4730709195265099 -0.86244726896247792 2.6244789213342559 1.0120516289800192 -0.79478425629201499];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 11.7647058823529;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
