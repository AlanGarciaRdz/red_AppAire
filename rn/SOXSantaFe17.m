function [Y,Xf,Af] = SOXSantaFe17(X,~,~)
%SOXSANTAFE17 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:51.
% 
% [Y] = SOXSantaFe17(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;10.752688172043;0.00341273633199099;27.7777777777778;0.00632111251580278;0.294117647058824;35.0877192982456;166.666666666667;95.2380952380952;62.5;117.647058823529;24.390243902439];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.2344470876664024;2.37309945239243;-0.5472126112644129;-1.0039512499551559;0.36073231641905712;-0.2090244227027967;-2.4493447622678701;-1.5912863846536109;-3.6367289937770697;1.0337988514806966];
IW1_1 = [-2.0873264321405207 -0.50606124006569286 0.22366135324096328 -0.18964270442331263 -1.2058490433376408 -0.5349155323638165 0.14556306584645792 0.02622980283985666 0.77192439704612903 -1.0289061297402211 -1.2917082614234785 -0.67846163716797181 0.28320684672906926 0.50221920279649335 -0.45672907743495966;3.9211346967743985 0.70193499797601799 3.2921906811013266 -0.41411898637595795 0.71183928709429511 -2.640427585074864 -1.5101717597796176 -0.74802700142467682 1.0428555738457042 2.3640267162581798 2.8503794656518759 -7.936799833486349 0.79387251823374338 0.26222068171420093 -0.19932053764099159;0.66727231087893324 0.12715249683331645 -0.36104502265206218 0.46634523600122207 2.0872017631325388 -0.79236834120952759 -0.2217880381614028 0.076958770934910908 0.87625464789819341 -1.7417193697522106 -1.0609690535032559 -0.23236323795182942 0.018699626056916177 -0.31803975607150564 0.68493522337984525;1.9733334829090454 -0.65758455322546783 1.4942551662224528 -0.87807335860809721 -1.6856630803179757 -0.77264164661063561 1.2444234773263749 0.33348251334649931 1.422660246956551 2.2939302381143341 -1.5071523100674022 -0.91260253135041824 -0.31769519717643085 -0.61413553606717608 0.42934252213182689;0.68058751936011552 -1.2216457753765335 -0.65587564256062714 -0.47474220489163282 0.19758474586806735 0.62514450414201983 -0.24179147980168017 0.10595767690468598 -0.46932962267403466 0.070746807609595438 0.031367336634720883 -0.71796510248220358 -0.54738278068339774 -0.47095098582384826 -0.47087966582857782;-4.3093057100483483 -0.22835939275581732 0.65611213069313279 -1.2840043327621724 -0.10103714859855317 0.0024011099760497187 -0.0019330242336557391 0.41780873512086142 -0.81928161012442624 -1.3839851885594714 -0.56576815578867834 -0.89235756323929905 2.2737040418421168 0.22410368807422212 0.68210344478408746;-0.41350164404763573 -0.51712820663370962 -2.3509200083346524 -3.0384749386365217 -0.90186518290565054 -0.24798429939291339 1.6663228605911315 0.05743720530281262 0.43571249866909367 0.5991199842822903 -0.38796859012515905 0.7655484055085412 0.19096631846375292 0.0073423325059268282 2.134461044301966;-1.6588226468172693 1.4593099553436346 0.19867634689983799 2.2274615308961216 -2.8084160195654122 -1.1253576655730129 0.61403348899087407 0.084363366913854598 1.985758450705478 1.3667260985085783 -0.42090681652717593 -3.0632868300524261 -0.15661565025301333 -1.2015039409529091 1.5667275703704238;-0.34106183273337792 -0.088576142113652973 0.26102259629114405 -0.2981881925200065 -1.5592569793717019 0.59960449836064211 0.12966552589085706 -0.08456949106399167 -0.68152892004891796 -3.5590457265197091 0.88247460655952814 0.21852009734872718 -0.021838163509569661 0.20784465454398976 0.073529242705394876;2.2149647219139363 0.64264534447027066 -0.85345258460585394 -0.33944363051251553 -0.47289728979884477 -0.06005672797826235 -0.19356448030851653 -0.15837078238851976 -1.3579114226857643 -0.15501844770974704 2.5661218866934279 0.99518359344660401 0.90178850698743351 -1.4456452789140117 0.64836278212312781];

% Layer 2
b2 = [-3.7509342489499535;0.079563003072616989;-0.13705190614519372;-1.0793210484003635;-0.78357827945263803;0.87825935405825051;1.2513805663764832;-1.8418643141317048;1.8425204592882689;1.9650607647117022];
LW2_1 = [1.5514469385569183 1.4526534730907268 -2.1552086396892332 2.0096483625895059 -2.7233033952439474 -1.9893527415510543 1.8009502618561934 -0.35483176225131435 1.6316747441962478 2.3180065147157873;-1.5595568922991352 -2.2162864314551234 0.55506301701366345 -0.1968920582902042 -1.8707500568178048 -4.7237267692425089 1.307164061507109 0.37813464063689395 1.9893032702852094 -0.52301424828114029;-0.23840135125210901 -0.0081432660191672092 1.9048325111952138 -0.093767957737864047 -1.5296798227358686 0.39030296293314576 -0.0079738763799660963 -0.015954497841103935 3.2071843515468985 -0.23554060607609645;-0.60302580854405863 -0.066067142027020187 -1.3606474760154557 -0.0092317108801724737 -1.6181788719878731 0.94183533572496314 0.53091126523229648 0.093494838458466262 1.1583777346455746 -0.3219644460178106;-1.4697463277666232 -3.0093843383254226 0.58420215104499229 -0.19235457898594588 -1.4934355088079627 -4.8061444604219306 1.2235868503002842 0.64309121661272606 1.9478906860035758 0.94606191833182951;1.4749250171033084 1.2146880372284081 -1.849997583964982 -0.38684778394407887 0.58706933620903656 0.71226273683946828 -1.1136037698929682 -0.82387642091851387 -0.977114955971915 -0.73029709755554695;1.027440949744054 -0.45143672577910005 -0.70722143539339111 -0.33032123739024044 1.3292207649778949 -2.080976777848869 0.54933847218176812 0.26919461251706139 -0.0038596113822567668 0.12365392410927679;-2.2169511000925661 -6.1960596437977742 2.7735995704320153 0.74051800068051121 -0.54897165043642582 -3.6463286334269105 4.5395599937602205 -0.57020712968637255 -3.2629263488136586 0.92791202326718625;-0.37749835532070242 0.32342365847865839 1.213199437611884 -1.5683959668820846 0.68583261938725137 1.3899422192139936 -2.1031711417504284 0.26564510511752992 -1.4911538540378362 -0.73792483038665146;0.32520060622264579 -0.22500553183057972 -1.7726313328650602 -0.11378379815419964 0.39249012905703978 -1.1377821629225213 0.12972028795972051 0.083779745908496961 -0.99597685170567274 0.069097968127206241];

% Layer 3
b3 = 0.47725026066332465;
LW3_2 = [2.2698332640582439 -1.7655132910494107 -0.28529765506930271 0.24038854581493496 1.8132656082977947 0.59242391978435638 -0.10175099076294195 2.1208426920988912 2.2234967749609682 0.28447236815099697];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
