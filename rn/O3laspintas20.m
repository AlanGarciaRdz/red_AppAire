function [Y,Xf,Af] = O3laspintas20(X,~,~)
%O3LASPINTAS20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:48.
% 
% [Y] = O3laspintas20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.241545893719807;4.5045045045045;0.00280033604032484;95.2380952380952;0.212765957446809;14.7058823529412];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.1005373599001569;1.5649379188990795;2.5140780547472912;-0.29749777732700911;0.60006754367585491;1.7589064106362742;-1.2792559407252593;0.28954721921192395;0.049482907992386221;0.61697067065023203;-0.37821374583436568;1.6216677817161436;1.4532355958544321;-1.4501208212233063;2.7666091497318401];
  IW1_1 = [-1.2782166526003051 0.90036186361635029 -0.31452003994659666 -0.59779082896238422 0.12569908300065968 1.0946323913477918 0.089658440711991777 -0.44822492447082973;0.23347448053318925 0.57576018125591111 -0.045531309360187261 0.68712602359940844 -0.1443191676699061 -0.65224657093030136 -0.64738348938672285 -1.356269453135029;-0.064566564228505471 -0.092889647871721714 0.1023223111891079 0.33112508280638664 1.0578890481391381 -0.17604301287885768 0.38082787737555385 1.2885385079463314;-0.7124774496617412 -2.7119056399751624 0.81146303637820982 1.74081969613993 0.09085294075259176 -0.32990065352979281 0.28205947251729846 -0.39572321799139115;-2.1923222632817851 0.98766261822143431 -0.27662566231461128 0.32683653974214955 0.31907410095948552 -1.8142103361083046 -0.63518328476686015 -0.3155973841617094;-1.9915287665460732 -0.088174942559437405 0.81062115386046041 0.058009419304674584 0.34305538970810806 -0.055165028150769742 0.18701645861860175 -0.13081783748067091;-0.32005468588730557 -0.78329973943421138 -1.1486557060816416 -0.18151575970473857 0.59677877861955198 0.39518767386570347 -1.6004901618553151 0.98712001410899974;-0.73422615973421368 0.09127853694840285 0.25370978039910858 0.66521287703195642 -0.80153466251195904 0.29818166169503124 -0.30805830795133532 0.69133579642646226;0.3911014574590217 0.53884096074406196 0.63249282063321333 0.54147921582683334 0.88771203250597386 -0.59909243735206386 -0.2836750070255849 0.51881644667721849;-0.47850407310605514 -1.096722358551302 1.0474305539250972 -0.15121993021453101 0.60737886237762351 -0.65653311530222047 -0.2663250572000358 -0.47305900851508387;-1.017144746109431 0.38278666887989743 -0.48742611481991371 0.66037785776728553 0.8751590342072465 0.83523885140036358 -0.84567318957287285 0.43417206853844154;2.3313319730026025 -0.38990323569934726 -0.38567596546903044 0.47536738247598287 1.1905382596056859 -0.29724894914473066 0.28736460616365173 1.068411718709201;0.21944798863605078 -1.2333718151338315 -0.12221806364066071 0.86205081181913146 -0.4868992584636882 -0.90613089522522572 0.11658958272746363 -1.2024712718851363;-0.3420260249458415 -0.98734455944918842 0.58146176438549091 0.80579336915781852 0.55000278349253695 -0.76992343916926187 0.10835680948055798 0.66171277191443212;-0.070051487488154082 1.8725191490614752 0.08862872585008448 0.99497548771476607 0.7369804753583814 0.005580096697158584 -0.98759764918285586 0.71300433071894553];
  
  % Layer 2
  b2 = [-1.6915347316793894;1.3289590031786169;1.4836789259696543;0.99032061310980635;0.70795174106903158;0.6121870857120163;0.17132106229343655;-0.088255089836429643;0.11194532422033135;0.85758707932810052;-0.28698699552363116;1.0791147051672396;-0.96605912732603816;-1.6238773217115499;-1.6801989965395026];
  LW2_1 = [1.3359456579492837 0.4421375728362959 -0.24260208252698884 -1.0121777544348445 -0.17421887412757509 -1.0531220202532556 -0.80869174069472627 0.33428409713643925 0.69724829355947437 0.24373460666028263 0.13085641777791449 0.082963011830765931 -0.12480505723377706 -0.089788210922760264 0.45334468268933725;0.23873045167090967 0.32517875504789512 -0.38696400536659986 -0.99778129519395897 0.75303876852688789 -0.2309503515164146 -0.4387704382682891 0.69045573312614061 0.52393685419236025 0.044466014431823034 0.50114754293786079 -0.85911073590127773 0.44188751776955848 0.431690058533584 0.72150557899648426;-0.3516944695882544 0.68684971781962301 1.092482439161605 0.31768363293680801 0.3728677036198294 -0.13038072276123439 -0.092922542408998235 -0.11989450960260689 0.62478401251905225 -0.080230160625652552 -0.14864361346581018 -0.048406962700704402 -0.51413001423201676 -0.84912782226324535 -1.1883410494205624;-0.019960363661287939 -0.69349995507519335 -1.7172695773957525 -0.45683624932663192 -1.4243341625378623 1.0060602183358867 -0.089639223605092688 0.31612281905187578 -0.99456041140775897 0.1081591732569212 0.38787638918451778 1.3125612244982767 -0.74492383873872214 -0.37323452178716571 0.13551193084703902;-1.0822498367386324 -0.44322047040285184 0.28227189925730106 0.11589820651723261 0.068297143183558784 0.96847512415887627 0.33531107959637207 0.37507488084626295 -0.12478056107418056 0.39582231983902705 0.7355443338056471 0.56416933704015571 0.014925610268540591 0.044156378292609433 0.33977093949849929;-0.72245760940017878 -0.57275402725307067 0.41908073964116332 1.0284622934741527 0.79784898870316789 -0.14187472093630807 0.50354588451546456 -0.093195256434206217 -0.36455112149709912 0.014079473335822251 -0.39039110471884086 -0.56412666801209055 0.6764601466840372 -0.1883049636685718 -0.15481843326918304;0.46833752607177337 0.74781843901831813 -0.37545555381400636 0.33954919531846828 0.56758214271797047 1.434349198200443 0.27427609719327795 -0.18431035335518692 0.8936089575898245 -0.73959982951631165 -0.43514723615311907 1.2098770411612296 0.2185043626292742 0.14423479952142421 0.25130046018997526;-0.43744600388311206 -0.36218831832828619 -0.38300685264505935 0.33194983173581033 -0.0072440763786266503 0.59335597272639184 -0.79048826784051596 -0.25650580435173781 0.40738906149801851 0.6473446889296226 1.1027231937438917 -0.68085975419076128 -0.47985199275041102 0.73326125674492315 0.42794932732741781;0.10859068807709146 0.25238663425187324 0.95349539173799214 -0.10297303609791252 0.78872546947223143 1.0078607830530788 -0.23815905004688454 1.3244255657928596 -1.8624387233231376 0.28187635100058805 -0.12979564111210593 0.97969202834649727 -0.42946775968787265 0.57882432278413209 0.32087953505577937;0.61239458409932324 0.98424099594986059 1.4220059451879066 0.66692634687019803 -1.1256414847833709 0.26531441877948009 0.96471680291099604 0.14591680779091171 0.2315379809085813 -0.54225448188506831 -0.69769943000249746 0.11826072919982825 0.16308130537990889 -0.47138318341099089 1.1008297267300753;-0.68677506626447526 1.1171754290838884 -0.61894730341959747 0.36832103639540653 0.49143091343470485 1.6885054202169243 0.93523827677235472 -0.24780760481101638 -0.036584351927591852 -0.61073408503235893 -0.51627110865337278 0.28249938195972357 -0.42067075031078155 0.15441178173298192 -0.39226122200348706;0.68739538922453958 -0.28950150356445287 -1.2470842612035706 0.011074277183050183 0.37764513928326071 -0.25392284031899165 -0.26918474817232918 -0.093992229879696632 -0.59515209678404402 -0.28787491137427063 -0.30241766638517725 0.44263788606354026 0.26803617660347195 0.0084285053189933623 -0.41788758086332406;-0.48460358699098982 0.98186777758467958 -0.21377606562984311 0.1645655141114436 1.184640911845356 1.1308320850723816 -0.43266392424197364 -0.71547320631734834 -0.35027015016871721 -1.348405836151606 0.58388523415251803 -0.25735281652458569 0.19172733829445845 0.4322000987224271 -0.19505678813463057;-0.54159008767380901 0.085332881582421777 1.1290649046657613 -0.22542365287613039 -0.4319336419912867 -0.59499989867375569 -0.24080543950786204 -0.00046861109004524368 -0.10633509274089115 0.94326640983990495 0.24729099371535784 -0.50252778415017296 0.14955181017586081 -0.20406426830266061 -0.93780821529850644;-0.3973323107687774 -0.56388434269424226 0.44442826087079312 -0.97830520455445247 -0.46842498812160327 0.7771743061034887 0.39015064547132622 -0.24238882995828215 -0.065869252756153129 0.45616916246749406 0.18618322690325065 -1.1013978951027048 -0.049364649061974644 0.40883936263047699 -0.89382376194442548];
  
  % Layer 3
  b3 = -0.5461270952817433;
  LW3_2 = [-1.1235992954760001 -0.26425383788608359 -1.2825609507934064 -0.72969893459469715 -0.39796659125726064 -0.95961842402447239 -1.0616124963426694 -0.72975623580396609 1.2619085560538208 -1.0005070365247102 -0.7298895054195349 -0.80770875284499399 -0.29886374250008219 -0.99649291136181484 -0.94987287291633882];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 14.7058823529412;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
