function [Y,Xf,Af] = O3aguilas9(X,~,~)
%O3AGUILAS9 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:33.
% 
% [Y] = O3aguilas9(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.42005420054201;35.0877192982456;0.0561797752808989;0.00588581518540318;11.7647058823529];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [0.51048875349142497;0.95271074358018226;-1.8246184659282905;-0.69518827220002011;-1.156171300203942;-0.86197164690617056;-0.10671140735245489;-1.7783270441324526;1.4977027033245003;0.45871559877054024;-0.65631752027256873;0.70985470349674651;-2.308965432091644;-1.14705531676688;3.0430505488086297];
  IW1_1 = [-0.62024083227863769 -3.047274558598374 0.64375329736589582 0.54702917648820115 -0.067504241947330623 0.096288971751281635 0.7037976532446969;0.1201785532351512 1.0147653806672634 -0.38193347569844471 -1.2032483879897813 -1.1215096157337732 0.84111100245133807 -0.57398881581367789;1.6336079211530146 -0.90460575205129912 1.3623585086605661 -0.53623063654906378 0.53292186087023941 -0.27195252983231111 -2.4067996431606806;-0.70527236482426836 -1.2140935178416548 0.51695592335781537 1.0705861019350049 2.3493379977117503 -0.81012567109727596 0.96403150760243739;-1.6436782402305465 -0.98324853699470616 -0.49295324669831997 -0.67086632923465972 -0.64311404488001633 0.20585790398367665 -0.19824776330464985;1.809119599096896 -0.085477793686287232 0.31389283314396077 0.1149942842666818 -0.23947339850472557 0.11115426204417436 0.37623808002336667;2.5932717209201632 -0.74125712882264017 -1.262919725937822 0.57832268179878599 0.15003523040516609 0.70296132898625729 -1.5429831135745533;-1.8783507586382822 0.012972663136168537 -1.7994417371418874 -0.58357434340230574 -0.057376597938343696 -0.10606359084103099 1.4044331661623515;-0.219009139795488 1.923404614976455 1.8631397687074152 -1.2022628200741103 -0.27094466785222993 0.24783361582354133 0.67403260927222508;0.78087031205212443 0.90670289535709037 -1.2559612696469435 -0.50515537647815101 0.24658683532484349 -0.19931519807454756 0.18628683295295059;-1.6471710926049288 -0.10412516441376034 -0.43317238387189649 0.10566800951663692 -0.16306842440708025 -0.069013862442895091 -0.59989243845256712;1.9749277150218887 -1.103208898748961 0.50237826953798537 0.46362329810543301 0.41973261448521837 0.90472755331196864 -1.716267198481326;-0.72766551909934785 3.8480872115762965 0.3072774182892099 -0.82632061491982045 0.28770184034073926 0.3758353954358275 -0.063633895606885787;-0.42575392271410867 -1.7573455280306454 -0.11766402601820453 -0.0073366609979214209 -0.47934724334070433 -1.5984979767403797 1.7606861888882235;1.6124511445368332 0.65509746440475403 -0.80000807927548057 -0.23136330829230034 0.62667600734746653 -0.87674082601258641 2.5687183690501381];
  
  % Layer 2
  b2 = [1.5290464974648119;0.59003772273244792;1.0333247075130683;-0.57156743204351323;1.653169674016113;-0.062266761780624846;0.2641051360549761;3.0991987125182838;1.0499752316525304;0.31615104947236278;1.3048761108764158;0.43291485904051952;2.5708971758420396;-2.7188751646883205;3.1189935221220013];
  LW2_1 = [1.095386964701647 -0.5840901424532895 0.60263472899240178 -1.0940449820063523 0.11358970205508381 -2.1167230114521538 0.0060341329317030803 0.064791710970784538 2.183370015982526 0.89126272961316289 -2.2525733864489501 -0.83393828169684026 0.562843226450923 0.44307249534014409 -0.44370758932451315;-0.33519526766438007 -0.91812969475062944 -0.032352437646446901 -0.25590148511190869 -0.53152250984712324 -0.40773888759359417 0.29837141540025669 -0.89562959799034447 -0.26222042856256256 0.66751699875953008 0.018701422589104861 -0.64170465817902866 -0.37237343474823631 -0.41525336574224608 0.099459537956514021;-1.5202815402913386 1.6328553577783982 0.27222926289846783 0.62842298618514902 1.5522127327458113 0.24194525995995486 -0.15184627943220291 0.068191772806687312 -1.7638673652214001 -1.2921418631647041 -1.1648752566013685 -0.51494115566349474 0.046954335472361296 -0.90065558730646611 0.43692363485854296;0.71514337950231732 0.23192805916581608 0.3123433084163727 -1.1580227900829954 0.11420032467605046 -0.30420563080401936 -1.3280496990287491 0.60531808758617955 -0.61322002380743179 0.59610497606903134 0.76270186792516337 0.75510878947873394 -0.029403512611499153 -0.82363443469196551 0.48437316944140052;0.2222190001960174 -0.78665653420823944 -0.94355109399194081 -0.11246737115405213 0.46322259277328104 -0.80871649384468069 0.36664961132654889 -0.5322238184636966 0.2026820618727028 -0.69169662709002788 -2.2957750466236062 -0.13870320078375101 0.16898014209298118 0.12630427083818804 0.44600418202688352;0.74046200466015855 1.9109196316173183 0.45825329397658005 -0.48614939456883521 -0.07547329035307726 -1.4774867546452954 0.0070254977821434528 -0.29803751797021211 1.0752965064393605 0.63734523405037602 -1.0375470608643276 -0.82910016169977208 1.5449256501560082 0.17175865575560703 -0.1373956154580763;0.77490399010466759 -1.0249516632948024 0.11071888289052498 -1.0541733174504082 -1.2859986226992675 -0.3980518482418085 -1.0934060075482577 0.57418978964211287 0.7771409132372481 0.53583101267895239 1.2632330712227799 0.98854708156489968 0.080057902969752973 0.34653361805440597 -0.45673175195895738;3.6164749742214362 0.90474188973095848 0.020091103932811473 -0.74749646478221354 -0.35513830978867339 0.058195774360123992 0.33248185517304113 -0.35707855636080654 -0.93250341041913176 -0.60239165702861353 -0.43565511310319244 -0.49415206273895168 0.79981756816842642 -0.41236179687859292 0.084321340200625969;-1.031892108030549 0.15344310934930744 0.21276531170970356 0.10195956554273988 -1.2041236347614064 0.22131846449827769 0.090193714830336461 -1.3086968921023732 -0.86503977572185731 0.14836002251437591 1.2593210638787617 -1.0017614755470019 -0.48244071081923023 -0.9305317954476493 0.52574886440009516;0.11014119489947614 -0.91452757430483111 0.9219380377404196 0.12200821167799047 0.21793155271745385 1.2935217268834178 -0.40426607892840916 0.81356131412372945 0.0022623106827214384 0.53962590156515622 1.7163312840788991 0.47481054920548599 0.16546482539405388 -0.052018942883657535 -0.53271943531768018;1.5606803480561413 1.0871054422247524 0.3706052687738029 -0.95468483149080263 -0.41133562543788493 0.11828952112243775 -0.099910262248786685 0.71472093989274099 -1.2158905430405476 -2.4949022614099721 0.98490040092714104 0.21710741674548839 -0.67741329590838451 -0.50449895956957214 0.15376830117792437;-0.62180497168427784 -0.13426140144394857 -0.024554542076002613 0.16942919893886593 -0.34915245430074748 1.1398476877995942 1.2505679178439337 0.436060089461969 -1.5232181094465473 -1.4384639634465255 1.6045577600063481 -0.34225554049147183 -1.9006732158567863 1.1661662694272779 0.49722907547140949;0.45179004973748083 0.034154357579532509 0.74059199181700786 -0.35620394320234905 0.045009040518193898 2.1386395785232297 0.97521657565384801 -0.15017124980802771 -1.0790270151806214 0.18890538688776112 -1.0358091332598209 -0.89559711686607979 0.61304828520716581 -0.60841156430480825 -0.11310801946170183;-0.11921889601324756 -1.1667896042098131 -0.43355456877843696 0.53610494801630026 1.0037400414567299 -0.15459780431790754 -0.52487113547798259 -0.51846012834700161 0.50648741939243203 0.72302821299629272 -1.4701923765857483 0.38145036519685582 -1.7111771293875075 -1.226299114736082 0.058293097524788201;5.4307616210764396 2.0479944834048283 0.43007294649903621 -2.6577732868757828 -0.57460758149759328 -0.28688197844169872 0.41453868748418687 -0.060372190047435853 -2.3902459580640589 -1.7020060537542099 -0.78088189642910355 -0.79762083830715902 2.1523783917925781 -0.82595371434454501 0.64171015436373613];
  
  % Layer 3
  b3 = -0.78184711510862548;
  LW3_2 = [-1.8489260638213514 2.311739275809686 0.91563899815508609 -1.1150479396460502 2.5754338962081302 2.392584354788478 1.1700241829145304 -1.5168601192808588 -0.86803402925489248 2.3841271975493408 0.63128559591595057 0.42225920376354814 -0.51002425991245193 0.58680814062260145 0.67366441836767832];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 11.7647058823529;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
