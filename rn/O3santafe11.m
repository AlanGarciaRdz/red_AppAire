function [Y,Xf,Af] = O3santafe11(X,~,~)
%O3SANTAFE11 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:49.
% 
% [Y] = O3santafe11(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.172786177105832;4.16666666666667;10.752688172043];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-1.5040213301937237;-2.5353334696472998;4.9195512619255899;2.4596280224882427;-1.4897020072947027;-1.2075394876870156;-0.95336962824579929;5.4666094394389537;-1.5218233077107506;-0.99985070893374883;-3.4998433510104361;-1.8082222187939185];
  IW1_1 = [-0.054094923903011606 1.0874685807567663 0.88328158723508654 -4.0131022664695681 3.0348548805288305;0.10693464541481516 -0.4305119822691208 2.5510040210796596 -1.2988252261520932 0.96035101559523983;1.8001572003820985 0.24101905112298858 -0.53135591461400156 6.3885513329333614 -2.1905054492380129;2.3209497283589489 -0.56426278661561091 -0.56141047376317266 0.069109244114889098 1.7216352620095199;2.0821576014836314 -0.046934615358545775 -1.12801451666747 1.0410122121511283 -2.6248755071834893;-1.1426658807638277 -2.5120201410978509 -1.9401752139463073 1.7939075365286401 -2.443173180906689;2.0953288088962405 -1.709781405637121 0.75599356928898342 -0.50773292238161793 -0.32914304631927915;-0.81416376101969212 13.518740662718965 1.1363396892732884 0.95879447513439775 -2.304574509318996;1.2893967748322217 -0.93304837774564509 1.063161215152987 -1.2985673516527911 -2.4907208945014609;1.3492862425214314 -0.3046484367896688 -3.7291754151242995 2.6575011954497954 1.2386013364974333;-2.1052361867431615 0.08926528905086982 1.116675869468976 -1.0372448884781311 -2.3097792439035056;0.41379979981445769 -1.4372950959695507 0.19542502434148296 -0.19434063858107853 -1.1073291977468227];
  
  % Layer 2
  b2 = [4.1558607965332248;-1.5956429944004469;-1.9257561027320453;0.98806828493787369;-1.4234550620865996;-6.498034825035317;2.4357811423546254;-0.57057500544757722;-2.6054150273478269;-1.9313899722313173;-0.061160788152066874;-2.539002642558938];
  LW2_1 = [1.1209009853143692 1.8923254465752792 2.3117318159806448 -3.2654861434867266 -0.77730453770326036 1.4299366107214742 -0.97029533799041245 0.16467708898008168 -0.86408990327163526 -0.96107004321428813 -4.137777149982889 -1.1960492933537084;2.9669533835312154 -0.43242056069686391 0.67475954538967142 -3.3380564431160904 0.051395391451728736 2.2402501975598712 -1.2233779049587499 0.23248136342815592 1.076282101185138 0.85540018949294505 -1.1799713643014429 2.7774166452774103;1.3349915595121575 0.40807868980745804 1.0198033256050136 -0.82874555616272361 -1.0749493992283914 1.6624100734515195 0.065446401283168115 0.094747826296072729 0.69177088996060543 0.27151356388796899 -0.70395759904904986 -1.9870080440300744;-0.17315203563053647 0.25331406441362558 -0.75623575201346416 -0.49507394102418478 2.0505060602935021 -1.6089170377606234 2.2053048365775774 -0.94199584677055459 0.1805140959797974 -1.0284042989608004 -0.44990232499077981 -3.2938209635397846;1.091354470269565 0.60752277643528807 1.1101300837826555 0.50650882323378654 -0.75361387540356128 1.8214690841147152 -0.25438952198490195 0.13752819657821139 -0.20018441157059641 0.16194044997538992 0.60003161850867726 -0.92181446382296039;-0.97806920884228843 6.6286448695870721 -8.6302134343544274 4.1485062513935942 6.5388852394048076 4.6898526199744399 -1.5015253486711873 -5.9152724531909948 0.98179297384787056 1.2548171005296596 3.0325127113190478 1.0994919036152289;-2.9821026353723732 -0.95708787697211151 0.057454030711043963 1.8688683249636047 -0.22951301811326502 -1.2889817929744936 0.22903471871404582 2.8867608237739644 -5.4537955787689931 1.1191951843859851 0.35476406777553438 7.3563709125881491;1.3108849515148846 0.99121186122135563 0.94827747399224749 -2.9691342434816215 -0.039216386773596242 0.12990518048458216 -2.0435559035180115 0.22325551921404724 1.0257487555524762 0.7453365318191526 -1.1771428849694203 2.7444303127056333;0.33927084233998395 1.7478440751075912 0.56076616475385321 -2.2383676543843727 16.854964585232736 0.64517350123836237 0.58406396482790979 -1.0797710842104482 1.6626185387099339 -0.18825208234639473 15.701468269839431 -3.3043407069634756;-0.43401856754032164 1.4854265839207581 -9.5051403071790723 3.2820909705066459 7.2299496500100267 0.32069365043568809 -1.8247800515085499 -0.7543694602807639 1.4176904322262998 1.2836423144534199 2.029876497925112 1.3716001313480715;3.484057476752112 -1.4216752706493259 1.6409039115613173 -4.4801897423662549 -3.0488334832564741 0.66064235804227356 0.23926798683352038 -0.17259486116757425 4.6517158377248764 0.82369854017422239 -1.1868006127539719 -0.39686357347527362;1.9196832559579311 0.089729908634896494 -5.0401634610751644 -0.65766584192321575 4.8179385707286189 1.7634626251146637 -0.27237995750147043 -0.97398984912616815 2.5911937485935721 -1.005450401832366 1.0331074602683674 -6.6936286303793757];
  
  % Layer 3
  b3 = -1.6865050985276719;
  LW3_2 = [-4.2486062876476627 -2.0634383784361434 0.73409238944245614 -0.30781911114418647 -0.85049872649470026 -5.1185127242865276 -0.074874219714390511 2.0724855605114429 -4.6104956650847626 4.6650256846287066 -0.10686652783788084 -0.078898692272558385];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.752688172043;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
