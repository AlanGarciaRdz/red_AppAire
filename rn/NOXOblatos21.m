function [Y,Xf,Af] = NOXOblatos21(X,~,~)
%NOXOBLATOS21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:34.
% 
% [Y] = NOXOblatos21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;-10;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.100381449508131;4.05679513184584;0.195790504160548;0.00618238021638331;117.647058823529;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [3.4598742610552833;1.0160850390482261;-0.511343737889428;-3.553272342829247;1.9063553244246523;-0.48426220212844973;-0.50226690481286884;-1.532179665190434;-1.2868844050086921;-1.5113575395673331;2.9310834424792644;0.20180374179437616;-0.32704804229550694;-3.2199157529830562;4.0606611012036611];
IW1_1 = [-0.073023747440001022 -3.5739012322765809 0.56360485006751415 -0.76734008228807893 0.079186465435496484 -0.86412759861624044 0.15270369972480247 -0.38789686785247407;-2.9701138575943404 0.31064737933927211 0.6873532834128836 -0.095761898647868757 0.95478408981688745 0.25253299327986789 -0.24167881838931371 -1.0091395353170494;-0.47977414490152354 -5.0925543157569226 -0.5799874525797073 -0.54069582026868268 -0.57954373948635329 -0.21138152529771909 0.62231172059676221 0.099408439195327158;-1.1085636598745163 -1.3641548316492698 -2.87434391285375 0.63750322182161245 0.75449618826628528 1.4218498374626218 -0.8341115703556149 -0.3184970354694911;-3.8031339041289383 0.13818510711636434 1.004301293204634 -1.0431004304242582 0.049680550342854499 -0.96411832344353643 -0.70970647622689209 -0.14033485162385542;1.012742273720707 -0.91556067266074537 -2.126567731727445 1.2584011003826545 1.3131227089626245 1.7690065843708536 1.7289751665732076 1.1312848040097723;-1.7585552434366993 -3.0736876841962371 0.68246086605849876 0.47175325899006526 1.5103223124838374 0.84961242640138412 -1.5266671362041062 -1.6589683186668045;1.5237232219515031 -3.9708404730715556 2.7557760486213692 -1.3201442593173345 -0.21841566359261672 -0.79434184372113104 -0.14244843709967175 -0.64428531700392899;2.9164497638450015 -1.2354223455344198 -4.0458265836985152 1.3737702706831458 0.57568841982828944 0.47675507791793259 -0.042328782392389477 0.43641248655504661;-1.161677313140159 0.39977584461170762 -1.3951697790090205 -0.53237025345583522 -0.49915439050855759 -1.2263048340172993 -0.67667644657000503 -1.6543113649803878;1.1106487546831252 -0.24215113558776191 0.83546829315074733 -0.35017277023431553 -2.540400172097744 -0.2703301218126708 -0.60496788611873475 -0.0076009904256200897;-0.22583298361416129 -0.067919395431826513 0.078350649544062359 2.2239842689293887 1.8924296888897543 0.98859160206512775 0.31105966343695285 1.7630102923662463;-1.4606166513989962 -0.40722190789509594 -1.2471437972109243 0.84041256066552239 -0.27690831833613178 0.61167463565847768 1.5676390108201528 1.7705492321739507;-1.1936181427901593 2.379303230684886 -0.14994823522909212 0.56967323587115404 -1.1355099257115417 -0.13739353821448269 -1.1342073592937811 0.092627479428150708;0.28583875668921699 1.0637371505012037 -1.3453907424654661 0.57944635390901489 0.45709429389589423 -0.5177580126494894 3.7604996431586479 0.74531976791409038];

% Layer 2
b2 = [2.0021968722893249;1.5399406425228519;-0.58162684488544236;1.5610797342450449;-0.24230484300793712;0.98257133361642179;-0.16668609734007847;0.048188913155138124;-0.99843350808791032;1.8046315414457781;-0.1747934776877543;-0.90614426242836787;-2.4987423902658596;1.7007719731683504;2.4766814704476636];
LW2_1 = [-0.86908738063557656 0.19405741560837905 -0.36236336182460788 0.21380171237381443 1.4377144777172672 0.61831057486494634 0.63720783191018926 0.79131606442998992 -2.0334281715946254 1.0063317018763298 -0.056077543580959802 0.81037209475700078 -0.058523768906216515 -1.1245651367187417 1.090986319754442;-0.049227634924196663 0.50858241180201325 -0.22158048932009033 -0.024808126666328353 0.74545083330000861 0.49049535784041742 -0.089710750052370877 -0.4181161948428278 -0.62539104188429995 0.34626553972386548 0.67330262417482245 -0.116445433754998 -0.2168032195734805 -0.75216491315585043 0.38352291353160745;2.0095551041890065 1.8319531771946871 0.29027503748498285 0.4445139338840845 2.1988892598022431 0.59209349309747306 -0.31951919385371164 1.0550202545892442 1.3255850898107002 -1.403027867006051 -0.18988953450547649 0.81439013268331406 0.032476388187093419 -1.1189553127729468 0.10680236922319913;1.5962335732609034 -2.6500755642398808 0.4289959769944347 -0.84565356579057016 0.83278385955247858 -0.17279476151307671 -1.8312919952240738 0.58241074031696805 -0.77707170768214562 1.0404820428527801 1.0318127821938337 0.224840289600098 -0.63119458075004142 -0.33933799642817403 -0.56801786748783589;0.72303217043590906 -1.2584853588997895 0.17527228629774677 0.72708870893644628 -0.17706132165368887 -0.01713020446863512 0.5335208820485795 -0.29891886342059254 0.29389407338702483 1.1334124666516974 0.76745509293496361 1.3537525788886646 -1.8151955956768333 1.0348575735428958 0.2563808261822535;0.7525916016749935 -1.3394186888046744 1.7228053736860767 0.066611105279913874 -1.0273536046721952 -0.72613668065830339 0.59093133195767722 1.0542845655328503 1.0104803262029007 0.7090471553191805 -0.4962437617769106 1.0815493921787536 -1.6898210819131236 -0.21302325783170939 -0.81563026024519991;-0.75977304503251797 -0.13259271623004501 1.5122289619818956 0.92290717075154938 -0.0079434466020057697 -0.2713052079459245 0.10015831954405935 1.5507769418611064 -0.15262660631890279 -0.55632093987576203 0.94050038957551951 0.094438392706354596 0.15028598057486758 -2.0814815645278726 2.0504882424102986;0.32171590733944422 -1.7862582424409799 1.973644049327963 1.8512712270698111 -0.86357661598717173 -0.26851685738764164 0.24808558406826595 -0.31420159635337042 0.55507522588888403 -0.93292252938504772 -0.42414917337343622 0.2996483557511046 1.334221762311707 -0.81143010744602317 -1.162055143614418;2.3656525321585136 1.238676200910394 0.037183966861878692 0.33481116681640904 -0.69859388028698588 -0.71826333536812603 -0.49989498455847692 0.5238073235509878 0.9873569696137332 0.57368444320971834 0.0038805667124114269 1.1092483287225849 0.19849785116558291 -1.2214645545497311 -0.57770003243451862;1.9814045851970912 0.39573997593598148 -0.35819790236022075 -0.56351950003427143 -0.25703066577492201 0.57781969959601054 -1.0213089883325797 -2.8649866169656715 0.12487123915300762 0.10582613235452804 -1.1438927926635656 0.1331219341035747 -1.071916255068784 -1.4235589032971316 0.55220144934939852;-0.53162303621017737 -1.3385214363791884 -0.73821100492799141 0.87135211117064393 -1.9772570258580833 -0.3138729432475923 -0.27037032696792768 0.03479066643476382 -0.96056032241516054 1.4319675485838603 0.68014047259840049 -0.27221059348074061 0.73792810518431939 -0.48982668651186251 -0.40739991335813358;-0.27183532263421678 -0.84241831230749498 -0.26443506160221431 0.46502613723115538 -1.8494367135087542 -1.1042977145561319 1.1064400084138397 0.15231695510208013 -0.21766669398079289 -0.32462636440399018 -1.1075293796162484 -0.58035854756177951 0.057391423821729098 0.3881716700149635 0.51235473753968874;-1.0973909662338308 -1.0603472557004461 -0.5035853934611294 0.93578326736277284 0.46997036373829587 0.86662652819844033 0.55907487026000757 -0.61146757121842088 0.23087442643784584 2.4875446909029222 0.3914396558797259 1.005188357023717 -1.0639900998870844 0.29833650778779242 1.1788173637523578;0.73310443770539979 0.95178706497033705 -0.070713824309459231 -1.3856594565951741 -0.15375647178823937 0.79036568955206021 -1.1543171860067265 -1.6985426949387363 0.1789365235129266 0.92228341590332963 -1.9723746066654058 -0.04153306110907419 -1.2866626665550878 -0.3679184288980516 1.0107560931040709;1.3070048480036716 2.9248191649014204 -0.18490295529114772 -0.49500810911731996 4.1609256323857391 2.3681449020529821 -2.82782608560384 0.83396893164865871 0.93688927967250668 0.54311545416286178 -1.2668894572155813 -0.25960436949510807 -0.94533174384971186 -1.3125285848399759 -1.8430265817174567];

% Layer 3
b3 = 0.24722678644543813;
LW3_2 = [-0.89780371933702374 0.21987645517059268 -1.2516929475817262 0.86349236688296005 -0.37606003364483309 -0.50084445726811977 0.81933996208115256 0.77911785197671246 0.91278224232804783 -1.7881877634875067 -1.713538800902485 1.3832832496683509 0.98840140716228175 1.3033423556861223 0.79720334265767701];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
