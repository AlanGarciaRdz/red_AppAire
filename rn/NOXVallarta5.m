function [Y,Xf,Af] = NOXVallarta5(X,~,~)
%NOXVALLARTA5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:26.
% 
% [Y] = NOXVallarta5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.3932458686044797;-2.1428526590251384;1.611432280000497;0.89294290438811985;-0.024991356544180637;1.022911260430609;-1.9459251364133312;-0.41877693237959973;-1.8513407386120908;2.0788380097825039;1.4748701658216201;-1.3836721722781413;0.6141008752182241;-5.7022354663620529;1.3562260968813091];
IW1_1 = [-1.0074304759775499 -0.96168829013642687 -0.15636085186559309 1.2459623812386629 -0.087786533648110107 -0.11365196550018493 1.2220386657963236 1.1163894613948542 0.0047772257857533768;0.582146060466608 -0.51847957663408784 0.23022836449605377 -0.5958261404219638 -1.3851238853669954 0.12335191049031291 -1.1671286043834308 -0.35121389788529178 0.24018514150306608;-1.2736180586067583 -0.6489923061137145 -0.3223838999163105 0.74888659424792181 -1.3752861181899196 -0.85029876203618548 -0.40544904796143116 1.4050279170393294 1.6441917835325006;3.549083020407743 1.8423009393954342 -0.6575529530013825 -0.082068868172802997 0.04601571848980051 -1.1600799876706109 1.9883768289139065 -0.66727719099497551 0.26841617929672407;-1.3441695512232845 -0.64843690364961071 -0.25974290062477179 0.63859663825603485 0.27768345613216155 0.37637346668667415 1.1605042605614273 2.5942586345470207 0.12208315171007256;-0.041982729265817226 0.40709773903571017 -0.65741115328563615 1.7001192777915359 -0.63334730527363114 0.38369772420374648 1.2629529955922731 0.43856755423822552 -0.11453955920228343;1.5423536380941669 -0.69791113805472949 0.71086263282108353 -0.10835926864846326 0.20976592441263067 -1.9830991060346346 0.76743094624103869 -1.0149466926550859 -2.4296850559857175;0.46974536232147296 0.077620761832192992 -0.44821773813583837 0.59046408892788382 -0.28087165712503093 -0.13145102662409133 -0.82913845989449131 0.20556937768866498 0.50894430639355837;-0.40449232499165971 -4.5292509693606036 0.29796313459683915 0.26438221809879736 0.28514143991681873 -0.051555340500097385 0.44063909199164375 0.65643242456242101 -0.0037760533982073644;-1.1364981824462836 1.4994792274505861 0.16184811941174468 -0.84162650410195972 -0.79359306730507895 -0.41023356784506337 0.70216090959482214 3.363745777472777 -0.51994054411469692;1.3283246448106982 -5.4661023886704667 -1.2174759329906575 1.2574456597399317 -0.041017977081651648 0.075708643426381658 0.54801554216172543 -1.5732151382788389 0.20842698097193268;0.26242679207901592 -1.0648859403544872 0.17714583374767123 1.4421313252512078 -0.08994393048483515 0.50144578010363361 -3.1883762949950021 -1.6615528149645655 0.4626314065953393;0.60519840347041653 -0.46717628025884789 0.48844552972614147 -1.9610411540750374 -0.21984428320912816 0.082954465482188919 -0.93023241990837247 2.5420413689641479 -0.135863224166134;7.2460866677016496 0.12391451996552069 0.885543242933999 -1.2980514508586858 0.95857343914871063 -0.424935269711047 0.50742137765257123 3.4032425729419109 0.41613128434923941;0.76813040929193266 -0.17768420945081792 0.25828261283898507 -0.36365059401875671 -0.94790224755723407 -0.21916333181916892 -0.16070579631717216 -0.050543252050394519 0.69037054344065285];

% Layer 2
b2 = [1.9001931458322714;1.986960617545563;1.8775470533852789;2.0353640413138558;-1.1984602306526135;0.78509567469980035;-0.9391033749483314;-0.43550474541882916;-1.2606298054306617;0.49773920242457254;1.5159167039284571;0.97087302225832928;0.066157859314715822;1.3626825181088955;1.3197466432916602];
LW2_1 = [-0.27106826898670727 -0.82624097722427192 -0.74616225539089753 0.40417280893275681 0.050011701215588358 0.2254094971122633 -0.10094376602349053 -0.013615069767731039 -1.8969164349596297 -0.010018064040156793 -0.18084703029694923 0.28217793848322537 0.32611221446972777 -1.0126417701766788 -0.54683018484339563;-1.789270133091853 -1.3460236577974001 -0.45149348424728458 -0.31662453626814108 1.4251074291020942 0.0052770364167532349 -0.88577314481606229 -1.2616285686664348 0.78188174277026778 2.7171713541277054 -1.523900957532951 0.10029754133890786 -1.2307094328183803 -1.001907349318397 0.45767195145034634;-0.15886569510816503 0.71880909862799791 -0.12569753983881349 -0.81003330659897876 -1.9379742688289889 -1.39960977721248 0.22482843172372299 0.13317207269650172 -0.26927601493202008 0.72185166607176954 -0.67232489338268087 0.8070583956192815 0.11515935364867549 0.71963396379812816 1.0936002142849763;0.57035026813615897 0.62330612564255405 -0.17189768231606059 0.27747663450782578 2.1833062385659638 -0.33864543080202625 -0.33237474966439673 -1.1326340684898639 -0.38536471549001466 0.027259901868741838 -0.17577711882528377 0.15254581287814301 -0.33954386880764914 0.082499510803688697 1.7336809442947636;1.6694370927653761 1.0165717941213857 1.6593273394996049 -0.49534361888673339 -0.29596016324443142 -0.76907006707667824 -0.16586448160982592 -0.6340757807646813 1.9801444700519797 1.3857660334373016 -1.4167770788678626 0.57550735691946475 -0.82569803885878656 2.8734051470365163 0.71198953242512719;2.0134095367550549 0.12018051270404759 -0.31184620271425717 -0.99178896487547608 1.3349259396195281 0.6945780391116062 0.090193002711240963 -0.13066778260293624 -1.4055492607439108 0.24636554623994489 -0.48883596745424435 -0.36211805802851277 0.66641729362510227 -0.47834173045000999 -0.79457234372612728;-1.7937637498709058 -1.5783393881974694 -0.47659589535279329 0.5950177859328355 0.09398661246381379 0.11088928627125395 -0.13475311040269858 0.05067796124529525 0.76738259689438415 0.79754927564227385 -0.47898331146241541 0.52926912237611601 -0.45147665954037786 -1.7738273117511503 0.40752301293125431;-0.76034618101331752 -1.7147953281286548 0.57987613739896138 -1.2844147858049735 0.96639114160039541 -0.41511300049670491 -0.1990067581289271 -0.13376448541090524 -1.2376020784506476 -1.2401934122707845 0.0050434246454515858 0.068426218676650649 -0.37844459560591304 -0.47159837553523865 0.14665589702814522;-0.47195574157509823 -0.9274777565413308 0.54522798999317323 -0.37076741953031223 0.078372581348770121 1.16479343762808 0.7610826965241162 2.0856813639826677 0.058781737625592717 -0.40656631412616084 -0.028843383174878338 0.11611101825403289 1.0489066094402175 -0.03621688729119462 -0.95339926385896723;0.88346069261618299 2.4989331260214742 -0.29509224955799723 1.3846358119062898 -0.093132555088468419 0.70470015165707112 0.33494265449769967 0.22077758459084273 0.98351541828220113 1.7402934407143362 -0.086812151129977561 -0.24909980929654296 0.53992850659198754 0.24912970666946854 -0.33330071191238331;0.48312393671699067 -0.11031411419832284 0.84730905877951701 -1.1627076371640777 -2.3626137478943363 0.03983312563745349 0.077309115900722661 -0.6687357359680377 -0.78071680885297168 -1.5858729955925639 -0.067480122576900059 -0.0061260853831244071 -0.60763761980257869 1.4285452287324016 0.38915474143038475;1.5191526609821329 1.4717928213031106 0.44087525850449272 -0.50329712444568897 0.50334395858084957 0.029910671067708828 0.069263020102459064 -0.20644130848387637 -0.7719677168832747 -0.78268962232774442 0.32255997774206835 -0.49276226719206756 0.31233507809096556 1.3022516475502754 -0.23481837897038368;-2.8046379662045409 0.22904354227568993 0.6808023435729158 -1.6983810762845666 -1.6489010688972374 0.14834199668202799 -0.37016011124847908 -1.4899064878829142 -0.8752025370163613 0.63314606879240487 -0.0032600116313427629 -0.43749796643809497 -0.60168820982149984 -0.22338484542790496 1.6991133143173098;0.45202853365994217 0.12594248364287158 0.60769679124868814 0.15435931532176694 -0.0093026224172460467 0.20615846776907013 -0.19668162459420166 0.20839644271742108 -0.47044105625585336 -0.48093889993985284 -1.0230137391127205 0.058206222943250126 0.87339877911823172 -0.95305671115116819 0.46910459344113187;2.2294392034618142 -1.3660494795162983 -1.0722589348968958 -1.0332830497982577 -0.54158829713967038 0.25178267247017938 0.32492958061041732 0.86997632449374507 -1.4413103490762331 -0.19191277313836913 -0.36941270395034892 -0.34272525011596833 0.95636545821908192 1.6836432453833381 -0.18509583797714491];

% Layer 3
b3 = 1.9073184175800739;
LW3_2 = [1.1484034833611703 0.13301016031610746 0.16032104532606317 -5.9617891924153819 0.8160795906181959 0.48028503933672456 0.93710638984200734 -0.8589600667512669 -1.5012360146901758 -0.74312093446833316 0.67551116362747576 1.1000179363433435 -0.68830387323382547 0.91256231270548105 -0.48533888371528544];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
