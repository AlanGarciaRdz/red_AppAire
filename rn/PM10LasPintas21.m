function [Y,Xf,Af] = PM10LasPintas21(X,~,~)
%PM10LASPINTAS21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:31.
% 
% [Y] = PM10LasPintas21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.0251256281407;14.7058823529412;0.0179856115107914;0.00280033604032484;0.0558659217877095;0.00576368876080692;0.00618238021638331];
x1_step1_ymin = -1;

% Layer 1
b1 = [-4.8955889777504371;-5.0606533685480626;2.8954507020319973;-1.982660228365499;-1.2635168607623883;-1.1033577725579795;-1.6986616935078656;0.81420421919330987;2.4189263199227931;0.74818557231415395;1.3188283817422299;19.556984061578909;-3.6206291228323222;1.6496825653243146];
IW1_1 = [3.6099046896593627 -3.5021290527162647 -0.52533229421841798 2.4769003246586401 1.858846958931528 -0.13984384740361558 -0.017419965574669065 -0.12961270670513772 -1.1877161185120981;1.9194829978577301 -0.44089107791165943 -0.57025549179130386 -1.7244936172080816 0.18110092177696385 -0.40360886115054384 -2.5274160284002525 -0.054132796260162638 -0.77076145425357867;-1.052602574561154 -0.13639835267725306 1.4727005157971518 -0.65962152731220136 -2.0085708832370872 -0.86099566200282984 -1.6957372038376433 -0.21861678617935809 0.90988109770168579;0.50634540955075402 1.3031710904749034 -0.15635525215660032 -0.2343221391384685 -0.092127806185612407 -0.048715961704255621 1.2983565390486345 0.08303285979006074 -1.1020481098364119;1.3930282042484843 0.15297128733400409 0.16721875277762435 -0.47304162602681565 0.44165507370888196 -0.61639857820934418 -0.25346345091642264 -0.16994526108491775 -1.101910444724195;1.8344962853760725 1.3872091936856854 0.52363811644619274 0.89438689970814467 1.5115456685722914 -1.3873176014549886 0.10767795690812181 -0.028186326209508804 0.10248748971445566;1.4906056192273793 0.42879990140328395 0.19997971876053927 -0.43453278778377297 1.2769471506216645 -1.6187716511466717 1.1835765821916671 -0.15034908332483238 0.62994117048898068;-3.5436514861671062 0.11959121416290469 -0.35075181607687261 -1.1910927821326065 2.5242088558189555 -1.3420665643156455 2.5017813281469747 -0.16573902071507837 0.036251631523598678;1.6120475992681187 -0.13049467198842335 -0.89632148760644426 2.0714162453866791 0.90354279934694426 -0.39495491980429126 0.52734250503851932 0.091967321120637019 1.1225463564583742;-0.81114696653422946 -0.61323011838046215 -0.1807491810860386 1.0306477233896212 0.50823338703652265 0.43209661335032051 -0.33376139019708678 0.10420978824130031 -0.09362656893644497;-0.17238833320507235 -0.79866665029219175 0.25768282874883885 1.0881441017218891 0.44315235195471153 0.25037495500180995 -0.27379225048495054 -0.0015370151583940772 -0.42565218724450171;1.5473742129353067 -0.0088370340463004293 17.909007947890501 -0.42479807556046839 1.1834329712283993 0.093591933120322796 0.28661228326703841 -0.12798606924749586 -0.39239527194507168;0.42130657607686489 0.18758191508244118 -1.1785362546942071 -4.0317082116943581 0.64450700510991066 -0.23945614311986685 0.59218898491123562 0.24195114734148745 1.542832701381244;1.8896707483262918 -0.54471381365469884 -0.55351124789381878 -1.815837531007308 2.1266438334636235 0.63829954095430208 0.56856908299831732 -0.038974142649940098 -0.38142396468020184];

% Layer 2
b2 = [5.9172199830660039;-4.0751729171266193;-3.8198463799214832;2.0351760838313884;4.8078643238712155;-1.5236107508969736;-1.5490134940118212;0.35828309410269904;-2.0332885331824926;1.393067896422796;2.3375473198333578;0.45349823261596267;2.410350895522785;1.2059336595767667];
LW2_1 = [-0.37971744719847977 -0.92636306130600587 -2.4373886847104345 -1.2823095360820711 1.2664871200885854 -0.85737751385407102 0.70259248657928652 1.2324204331764372 -1.4782300595879214 -1.2504518814297958 0.41329971051459558 -5.2432786478420566 -0.053374402588491215 0.52116991080854602;0.45318513228545848 -2.5680217067579871 -0.90589096122537915 -0.98624983255646581 1.9726344342455744 1.7371908154064086 -1.0321878842088401 0.046055447523932522 -2.1593721492902027 -0.49251717628517505 -1.3922683286764821 0.62309505178700819 -0.25611194790156599 0.499811526951701;-0.49121631552579242 1.6149852984868565 -2.4489146541928601 -0.28373534314846866 -1.052391442528831 -1.7956184392570733 -1.097255934409253 0.9169914364058549 0.25094545659500461 -2.2661556989444347 3.2719205464069323 0.43590498580287579 -0.98412359440400021 0.074589944412905035;-3.5691559262462018 1.0939900798183351 -0.15460138673285148 2.6647114735073898 0.31715066390493507 -4.5873272746390921 -0.054653726876510877 5.473180839479955 6.0535751997084413 8.4227942178813873 -6.5350277064476341 1.7574738992025816 -2.5296326512946208 4.4038993446516583;0.48105306554286237 -0.52338574624389367 1.4608464297511525 -0.018020184418903407 0.65969723541380143 -3.1070765471008048 3.1238649156503673 -1.0630824580941218 -1.3956254676016073 -3.2736218068163092 6.4091030574271572 -6.956967794357352 1.8288671699773733 0.79748375196193844;-0.57489976808870891 -0.34285760351118416 -0.014810543270427256 -0.41418078093924665 0.23094434032036912 -0.29509305443976402 -0.30400835089129907 0.22706283935677615 0.64477644653032617 1.1006479704113576 -0.77103109786520396 5.4172824546171459 -0.099788310855218651 -4.0963655614459622;-0.55427253925272379 -0.39206668733442351 0.0094776012756737915 -0.31683316100214265 0.29311508708247336 -0.21733853931955333 -0.38144760487538182 0.32031410411683653 0.69326695139595096 1.2404587658287083 -0.86769274834866705 4.9193844645183527 -0.12506218619423615 -3.7337041888314904;3.310824796959952 1.8841029906627285 -0.037966985932220074 1.1856928886744866 -6.7414716076381813 1.8511711590369053 -1.3719331645433455 -1.5107956152721602 1.1768582622516957 -4.4201495197445837 4.0182880248666404 -1.1648545290999022 0.29608926897738347 2.7909332535377565;0.57542348388244591 1.7385686747069635 0.48554100321532756 0.52327190234428167 0.59083859421326723 0.86034995863572894 -2.4806065987997825 0.6623880267953911 0.94665620313184173 -1.8024706280585217 2.1346657771642183 2.718695542616977 0.70658972967356859 -0.51205494333138335;-1.1238616431058583 2.6887214761500275 -0.6163580068788701 -0.32786111592632539 -0.69832488005176319 -1.0186074041174797 3.409618916050916 -1.3770868703830443 -0.92059390010550368 2.8465615859546483 -2.1551803277347616 5.57458359618286 -1.0907517375138411 -2.8005964526331271;-0.48210011054834007 1.5762059636504882 -0.071515594627889062 -1.6961434753848925 2.7782964998805579 -0.6568700193368896 -0.72832879638331016 1.051179256372585 -0.55491501742179339 -1.4895354150818645 1.3321203226524576 0.30119895355334136 0.39918032586333579 -0.42676928155048127;-0.1412932071258205 -0.99294879350507492 0.053306365905716128 0.2760253376411691 -2.0923279686675254 0.068528915222143688 -0.79772825127327007 0.57520072822207613 0.45415221521281318 0.67391757179817624 -0.50736682042415127 0.021634776109373553 -0.14685318996137017 1.0931932956099861;1.0969022668306196 -0.36119847096471058 -0.42269055228478009 -0.53319843879574325 0.58906230041885088 -0.28406769321634334 -0.084341219989435556 0.23830076994239793 -0.2862883690073218 -0.79992935446297575 0.82566308361439189 0.045022091591198229 0.17748194869508141 -0.17520551369084064;-0.03289231890982483 0.34832717960986276 -0.28907466698458567 -0.82959436984862156 0.25115537984801994 0.3777456738082266 -1.6658188342397082 1.9834530047140886 4.1083241123167769 2.5105136013291451 -3.6497765009061087 -0.47379104469011024 -1.4672119040118312 0.092679526279525096];

% Layer 3
b3 = 4.0153036754906761;
LW3_2 = [0.33036526006678762 0.56501159084796859 0.27434469574872966 -2.8572789648496202 0.073338882226897426 2.9729388816026683 -3.211752515536332 0.14024101426971083 0.30522180614724165 0.22594202402223373 0.47726174140132227 0.7179802610407876 -2.9829190148594229 0.50167665241480375];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
