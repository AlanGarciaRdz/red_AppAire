function [Y,Xf,Af] = O3santafe24(X,~,~)
%O3SANTAFE24 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:51.
% 
% [Y] = O3santafe24(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.172786177105832;4.16666666666667;10.752688172043];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.2036564093826043;0.26137942191385333;7.4243761112592201;0.70991392513388596;1.5273671521871415;-0.15546396857889;0.83067495635587174;0.30609970645747625;1.4145050766723102;-2.9673299756341653];
  IW1_1 = [1.6675401145955122 0.54614163358754231 -0.20482320503141604 -0.86520177982192659 -0.99237497505833638;-4.540078142717352 -0.41847722665366399 -0.36730951751146329 -1.1572560491851862 -0.98186914599251363;-0.32661244145096202 4.5130836580290152 0.91899266603123142 4.1344776738490001 -1.9018100113406482;1.4482414333458975 1.0733528270467301 -0.24044797638309523 -1.0757821354191781 2.2493180474428711;0.1635515941611359 3.7515486537422755 -1.3642480475849486 -0.065451730719537554 -0.31764154624382324;0.72104176180890855 -0.47009478505361352 -0.56695776916068741 1.5387251248958456 2.2330321006771965;-0.0038650241111383727 -0.5941379406364955 0.045622279482714911 0.45349208030504135 0.77578050367064688;-1.5790657564419091 -0.35856553662312229 0.164020362670006 0.048628032945606747 1.0849179820837209;2.0092619973217221 0.85257806759666155 -0.32674954696609371 -0.49065226857013855 0.56345187017044063;0.38084072349937065 0.075174546497722275 0.59792223361876906 1.4411300352231708 0.021531600097663205];
  
  % Layer 2
  b2 = [-2.6038818829446697;-2.3934741623705058;0.27477451307880424;0.28630723043677708;-0.65444972565091808;0.5746444892565945;0.045591741790971724;2.0184473690382796;-1.5152339283911402;1.7355417536693936];
  LW2_1 = [0.36896132496515227 0.23624529840387432 -2.4039019889981033 1.6026118674936776 0.099318417581530968 0.96433110723869853 0.4411102012080651 0.23957526930009551 -0.77528268528131439 0.18507187107828435;0.67456884541006068 0.21643225601752286 -2.854843442755179 0.3300450299735736 4.3464480195186903 -1.2294217303976285 0.86058734756632838 -1.2867118172724197 -0.97017935816823331 0.53242865998119149;-0.39601796464321026 0.30539281276048985 -2.0039715336735329 -0.50703242901039514 0.73434014419933225 -0.60407914310751787 -1.4492183423708052 0.37676475758911754 0.25184297688084856 0.26137154660525352;1.1902380247376916 -0.72168588385790389 0.044713101871207014 0.6662659086482241 -0.3065899563060735 -0.58919582798945802 1.2721974112098426 -1.4413075259264128 -0.27410419517600859 -1.085084887130698;-0.63481994935932506 -0.10638834358395347 -0.35773557311585014 1.0850347893049521 1.1575160802531477 0.068375707583454945 -0.80911798263834767 -0.065247674634731148 -0.3157593317473707 0.17834214365370266;1.1610564891438218 0.2749753766083769 -0.063465791167772956 -1.1515504161966588 -0.54522254465123832 0.61783853798567856 1.0933440981197409 -0.0027661143319600359 0.49782823352302868 -0.78032736853459528;-0.11643574354202631 -0.301588518525785 1.3858093390311692 0.63261737972885868 -0.74222451713515158 -1.124891951570183 0.40136860243154715 -0.6061235750276488 -0.74406931520366781 1.0993096879791779;0.63339406320155922 -0.72118728926926567 -1.4506434437956213 0.72197876306044706 -0.19493915465376457 -1.1518800993561076 1.6387067303506324 -1.0106721184467131 -0.15926353194775156 -0.98555350481165815;-0.45277671693715504 0.76069751163397148 2.1517695959387249 1.4639234971196546 -0.20387974894488778 -1.4642061870834957 2.4098623732004971 1.3952202454348956 0.90656558481529681 0.40543038062799142;0.94825636763529353 -0.90840978577044817 0.17198853069339612 0.79462095956989975 -0.033615789684026065 -0.28266566717699265 2.1979679680961479 -1.1259866226359461 0.20374573840915075 -0.065266019358871274];
  
  % Layer 3
  b3 = 0.10058728940392894;
  LW3_2 = [0.95193866040622033 0.49889762988898012 -0.58330782084566735 0.57995713911839197 -1.5977336111749751 -1.6281345030280008 -0.90422936360320538 0.5225615078396042 0.26358815283615128 -0.56946199325688762];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.752688172043;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
