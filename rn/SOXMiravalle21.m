function [Y,Xf,Af] = SOXMiravalle21(X,~,~)
%SOXMIRAVALLE21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:37.
% 
% [Y] = SOXMiravalle21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.0208986415882968;90.9090909090909;0.056980056980057;0.0063552589768033;166.666666666667;45.4545454545455;117.647058823529;29.8507462686567];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.7185167485179884;3.9930438048278081;2.6650410547508572;0.11267840665049762;-2.1441843095001132;-0.016046943539842456;1.4491722537640805;2.0338441746219473;1.3011780966426794;1.0885019505349141;-2.812347507742174;-2.1738690798905602;-3.2178935700286706;2.5942803735224582];
IW1_1 = [0.70325884811931449 -0.093494141704588002 -0.59328498435507948 1.4035238461521267 1.3850036197712066 0.30718289922990455 -0.56823772470130662 0.78579510219680238 -1.1783718547004753 1.1682883580129608;-2.4664744595031953 -2.0885085080096899 -0.81860945783998273 0.085028004722195183 -0.9168359181794371 -0.017921446990113672 0.80997486936309171 -0.27803558432297526 0.23518250847161487 -0.95219287623260007;-1.4326934666410709 -1.9869079204333573 -0.55468338678179374 -1.6360793417834498 -3.0345910058030272 -0.4557118187743206 0.11849599380565351 0.17125256454039006 0.73685230603357565 -0.81222809160036502;0.40076943583528918 0.18799438862667556 -0.061843518819483044 -1.9936558098473582 -0.65933239305850977 -1.6757856650398457 0.56826547004767092 2.6790468759155353 0.18965910739034864 0.66043921947082707;0.56649835541423044 0.20156962499221598 -0.26437739294511742 0.30336395032111751 -0.43325684238348483 0.05426946651330234 -1.8759595776159574 -0.46520764730757225 -0.79714656434333853 0.28737998109729812;0.16780824421102317 0.48987164292720425 2.0883094071187207 0.46715189185377098 1.8688350189602723 -0.62443321047671474 -0.92669667768405162 0.59149294897974602 -0.43390424792817917 1.717961157875139;-1.3100093665964558 -0.11630420226602714 0.23100505932453722 -1.3939836543242099 0.92264105655443307 0.088775816139600311 0.33921656581351545 0.75498997716833349 0.74699776883978553 0.53631772443366366;-8.895180424097159 0.6789194339450112 1.7782509462278366 -1.0102024684263411 2.0018250364371006 -0.8888423592661332 1.2066159691191527 1.6324184864622326 -0.60814742174429437 -2.6258846334029231;1.7103243207213807 0.15463601734983759 2.2319513466184855 1.1336591196748333 1.6636276552291995 1.8850513729371061 -1.6334506982726367 -0.66125575156265304 -1.4652393481542318 -1.9478163847381229;-4.0970197753465394 -0.22312256689936041 -0.4444266241696897 1.7712201157842657 -0.066376885746869854 0.12646819330445278 -2.6841841053854858 2.0724441279312527 0.82856156046158025 -1.1519075436965545;-5.3723840299349401 -0.19664593687578305 -0.65626375489873356 -1.8346112960330894 -0.83835748412056865 -0.018914863790127547 0.39104349529159621 -0.35063900334320691 -0.038808227432657195 -0.19556664423605333;-0.085490719570214604 -0.1692852145274342 -0.15189137685185572 -0.87348080524018124 -0.1831444631100011 -1.6074193856125285 0.74737038115646892 -0.62221656254010083 0.26021502611002295 0.4975112454467378;-1.7609943631648797 -0.38171444884950195 -0.39228916030808647 1.4715301168382011 1.5282957933297345 0.32575779318134368 -0.62114566916259228 -2.2974652917356511 -1.3875093578241189 -0.34106839932821714;-0.67943074604528764 0.54241539381364479 -0.058316365706889105 0.17985571716729265 0.12429522648270561 1.741142252810864 -1.2035108001121442 0.76947333312402044 -0.2018919425935963 -0.30187221472662856];

% Layer 2
b2 = [3.03542746299168;-2.2893661475414566;0.40169087674445497;0.54460185298852326;-0.050972839221920356;-1.7952109944600154;0.13033076500885624;-0.49313504010526088;-0.52152366174984199;-1.567898691529642;2.4030911013523242;1.4055972608195186;-1.5741898456481001;1.2564736508386245];
LW2_1 = [-0.89271668742120402 0.55109689532706552 -0.042475497284863301 0.5361739917874484 -0.56545125981424071 2.1670155650817602 3.0955770476725917 -0.68924466724413991 1.2432898892002622 2.9697064952142389 -0.92543714759832263 0.080949298966710256 -0.080007976532661979 -1.2541428011756039;1.3827221206503155 1.8586114210295137 -1.5793415740349879 0.55683826476966536 0.071675037187699547 1.3079351589684562 0.60995327897149265 -1.7948772264773296 -0.89377666150807167 0.059974457840244827 -0.15092710691421926 -0.66372790693526229 -0.54861857249493395 -0.26970897047329379;-0.8360221712395387 0.17032303736255147 0.47923933739864411 1.222167563373787 -0.078992881256905179 -0.53176175736510112 1.5087809596180657 0.69684211426748688 -0.30732031233565094 -1.9848404973658769 0.20396785584897884 -1.041665463847564 -2.0622690476932446 0.42479684983257554;0.012703647860480137 0.058108910182602246 -0.75697798251029424 0.83892222019012819 0.73382482430038398 -0.47482336047473811 0.010319142304464311 1.0390149301687881 0.52408882000071877 0.75176668944691805 -0.87730153336802674 -1.484484314273562 -0.7154035360022144 -0.52432277855915954;0.86771516652640546 -0.090873396181345475 -0.77551690230728054 -0.84477503206962001 0.15986859158002029 -0.18083634260121834 -1.9418435771854194 -0.028003848564601096 -4.706556376738785 2.0661523715722914 3.0177149986485294 0.59777964685598362 1.6447553548589382 0.43336824963752868;0.80759804753875053 0.10792664632115642 -0.18083971415895317 0.26539895750940529 0.3048274108398587 0.96887838343766608 1.0803658056029311 -1.0751466893688335 0.93410763541940456 -0.17347450274721463 0.026051539752713418 0.43583442427430202 1.0498451224533469 -0.08463885068495007;0.047488186274325578 -0.56361901507703949 0.052154478184017458 1.0834874622316626 0.49672964272108699 -0.049748591551967244 0.36714825531996426 -0.3590184202070108 1.6259732342601954 1.0667582217323779 -1.111809246317591 0.081568038164237272 -0.23683518126430422 0.017333154085548641;0.75066512169408739 0.26088662035608201 -0.78073990630461154 0.054109152507454364 0.17878761976878982 -0.34301105191657877 -2.0820222572051219 0.015767364005328889 -5.1471295237844155 3.1178579778545465 3.0924716194083053 0.06053936574285456 1.7244014886812491 -0.1229679026343419;-0.092204314724929473 -0.053503691055854827 0.60831203444772775 1.7838494449536479 1.4493371024548414 -0.67743228786692244 0.98540081089056342 0.58615816658971365 -0.049013743883718638 2.0440472023782732 -1.2834286856578754 0.59644982288890824 -0.90388199546088499 0.28636981628256075;-0.24134376557520693 -0.58325168611992984 -1.2810497983304525 -0.055918637062914764 1.2205760278408684 0.88473657278201179 1.0922247223318025 -4.2142062962498752 -0.52898723010936932 1.1951768865273706 4.2317233288688954 -0.33268453662273034 0.24031920347394864 -0.4485348294568629;-1.5650092997053322 0.73869149259918387 -0.17452846125071839 0.49185444839885167 -0.58245336604950337 2.2079381610748881 3.1084546518259821 -0.15623932967087437 1.3430293062293361 3.0988907208151257 -1.5700450531569006 0.36948506956553429 -0.042499918465600466 -1.1327333228577094;0.27162401731657027 0.68200431101690651 -0.35018975744498565 0.68170264809938785 0.40186169062696847 -0.13178998024556099 0.88232796463196828 1.45282875021848 0.013229651341648045 -0.024985658579302003 -0.66801088519582963 -0.036284978338414188 1.2516335696318013 0.13617731110109377;-0.3960042936593885 1.3794073705174923 0.47087973054433058 -0.9029410219452112 -0.006133049848773095 -0.44317621600345436 1.6510642499286217 0.63191349915664852 0.45740194334888656 -1.6491621474827129 0.32744112336056991 0.82339459855411379 -2.425428870715673 0.92327661571246378;0.84140871143628815 1.4865987159278609 -0.66539414436451061 0.33031675735473004 -0.79611636055676949 0.30638743628244597 -0.40499942989023668 0.2333137294586633 0.35072307354993415 0.09026775038504177 -0.65801549488550037 -0.35271467038934379 0.8709975956227084 0.0040513066355761934];

% Layer 3
b3 = 1.0634432415036732;
LW3_2 = [-2.2433282816002915 1.0316434668995569 -0.41135661306210419 -0.16241404534400658 -2.3441479466845045 -2.5990568609447688 0.12746249722182407 2.2622806469383976 -0.076362838785530893 3.4461543343925403 2.2342873645014247 0.11064020239166539 0.42051651448588001 -0.25178055844322828];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
