function [Y,Xf,Af] = COMiravalle2(X,~,~)
%COMIRAVALLE2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:42.
% 
% [Y] = COMiravalle2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [-0.62594965203717579;-0.73417188164648994;-1.173830334235002;1.3706519303306912;-5.010837563884051;-2.5181830564211669;-1.3030282488352789;-1.7398059979974487;0.35143549319245165;-0.96908496957809587;-0.72156029153826451;3.022055895296353;2.7264835814684174;1.3139871373524199];
IW1_1 = [0.060474986925742394 2.624182341764747 1.4950084680536158 -0.29667951007277482 -0.12102196470963095 1.302688657016182 0.065706379739299464 0.016051024896344218;-0.38614796999371881 0.095040128134805335 -0.43736416260499111 -0.4029796424357342 -0.1357014003282534 1.3684080746844056 0.14199087952894046 0.42756876854308024;1.2891358643350197 0.66674063332427991 -0.65004337059220429 -1.0173432949340175 0.91442288579377151 0.72212767274449308 0.28308252198532863 0.88959964130262437;1.2714050686968905 -1.4057532234807317 -0.27293977134531339 -0.032145250553259896 0.39008193952143849 0.14976709948417793 -0.76071131117479107 0.33781532500950739;4.8793208115254023 2.2342756270240582 -0.66296651203450696 0.33457641403632732 -0.051896513055154969 -0.54711768262357918 0.2559417771853944 -0.35486533479593357;-0.053114136643892383 -5.7084666009460463 0.50619150765051535 -1.0757040641826672 -0.16291776907413735 0.089400486194723905 -0.062968738247358491 0.33769199173360764;-0.28177271330152659 0.48899547837587182 -2.3383682361929194 0.38458355086244145 -0.67162886747816097 -0.46721053168557369 0.026569907460505901 -0.21840157959491752;0.057528977175299575 -4.6503305402637771 0.36805506310994018 0.007241316817587079 -0.023067305806818345 -0.054923528651481049 -0.097636341079254257 0.15943780562800697;3.2522431441738222 0.2160658647083627 -1.0407958235279229 -1.0074252999692408 -0.33793370941324619 -4.010253435326411 -0.98808530362941982 -0.77639291237633057;-0.74800992218093165 -0.059850581466480778 -0.520472604693339 0.71268610039506519 0.396612870845726 1.4026265258793591 0.54994829889756525 0.42907259248463914;-2.7397447078598791 -0.25161211017959728 0.80694567552061636 0.21847590951939752 1.0161703684946171 3.1172666447435824 0.021317447931755603 0.45887025104014173;3.3361227971800638 -0.084059150874438021 0.64970295798718769 -0.55024092498256638 1.2597280499181469 3.3725417319397812 -0.2167021711410845 0.5327682011322703;0.0066824930652617104 0.76069855509661821 -0.16893874770715245 1.1735216094754275 -1.2590451076110154 1.1496894025900268 0.033581542059376079 0.90683730376875449;0.62267592158400697 -0.71348608661751456 -0.57255501287701338 -0.43518456435726743 -0.93657025134329508 -1.3102038977604351 0.17960999311041614 0.17794622381055497];

% Layer 2
b2 = [-4.1342380428485797;-0.36811378635180492;-1.2389361976524997;-4.5122032553841764;2.8039729838880456;-4.5159795190555876;3.3999045866083959;0.2544924174528021;0.62887264191503078;-0.066816429350783191;-0.31417697619634638;1.1932346204519282;3.1083959748845857;0.32053569794177877];
LW2_1 = [2.7700143496593097 1.4949302561642943 -2.6148197470490522 1.1624940930389225 1.4473333658801375 1.8501687910909719 1.1410743985701235 -2.093396142983277 0.35136980004238921 -1.0462713374732109 2.9111506279045258 -1.6649430911005325 -1.9035457718861517 -0.29757728874878775;-0.37942374731557166 2.0190872974662013 0.55966254883817834 -0.70756286301422866 0.59434385381103183 1.4037868027815119 -0.15420106102286207 -1.3301417206998765 1.705904138222313 -1.9723905376959316 5.1074351189838305 -3.3894015436843303 0.55422423037603707 0.23319065705620257;-0.40516649832958451 1.966597440239964 0.55341848840320351 -0.77101314223752349 -0.1025610047332762 1.1075996376419968 -0.047486876311518114 -1.0068381433481659 1.6841554821269635 -2.0618614308057692 5.2529607056953171 -3.3636555081232387 0.42104594846641585 0.33936163698035154;2.2974988150891269 0.52839187830168755 -2.4882936645217373 0.9860999395296729 1.9815817049672702 1.3616898251438139 1.1496529970899414 -1.5005426416123291 0.47931721808571365 -0.92947283979761286 3.4670363830290665 -1.4848437784720299 -0.96910130100635761 0.32344965450057628;-1.214479016651693 1.0480529758723069 -0.90162217716765891 -0.64636336112567416 -0.060645813337324994 -2.6240298250862595 -0.32787993217923661 2.5263304395381403 0.19590282654359353 0.63972969835488336 -0.58952040208863643 0.46640692657444371 -0.12611289608245921 -1.1149515918471444;2.3940199833751925 -0.9786873883710997 0.74504135239329694 3.0720170600397614 -2.5774061932716141 -1.1065105981701089 -1.9664754452900695 -1.8628373110826473 -0.19933268253178493 -2.5428298455140599 1.9288145952268325 -2.0672791253807423 2.7844134153375024 0.81188023425195988;4.0515901148485352 1.9996050675937249 -1.6830033608163431 0.091657240979642396 0.82280727497060946 0.78315239338714848 -3.6698610123086235 3.8385877614325619 -4.1768854609240735 -0.54993904266687177 -4.4904286459719627 -4.4518398673016071 0.065558851323971587 4.4306351547979865;-0.99967539499346936 1.5980351028329831 -0.75152325957427313 0.69116064632510366 0.94543966515812095 1.0226416868778232 0.77321161381269521 2.1012561474317568 1.9576107078542968 0.25151678535795075 4.1376611758736157 1.1865124394622102 -0.29855989134858396 -1.5118456244347573;-1.4854509509295684 2.2069014997235721 0.078830915446396796 -0.9754857743472406 0.61482136534331744 -0.10029264200210367 -0.371812190637971 -1.6271202117718981 -1.3305008162824854 -0.1651156222391989 -1.9420961950264537 -0.42181001333569956 -2.0238244869397697 -0.19061266815068925;-0.99491192965039188 0.6715728492396652 -0.20174647647705485 -0.95427012427198032 1.2079292969235338 -0.93231548926675456 0.24146772794700377 1.8237077901972354 -0.35725652403558261 0.2229238200759274 -0.59439859738225564 0.25418940775952581 -0.57263849953872936 1.2888869856571539;0.19858625629095716 0.14283906852486683 0.24556893625071366 0.62454482677947698 -0.46336622382373394 -0.90629355417530422 -0.58421531232977175 0.33030258839379267 0.351972237290475 0.65198806327293357 0.22078814371875466 0.0050111965592714927 -0.48731072474191933 -0.71584229893821916;1.5566849539572354 -0.4794075185916144 -0.92431478799756928 1.1589095493295769 -0.81582147588710696 0.50277097969641138 -2.0714528306742412 -0.93442814623289616 -0.098932391605007719 0.51414133835851361 -0.65103426528042052 -1.4261270866027185 0.78342055282311829 0.50963363163829456;-1.1039282446907379 1.028857379396938 -0.67063388131092261 -0.5653936758282635 -0.10170695409835277 -3.1289504860233905 -0.39007029082481887 3.4433369092090271 0.18299275556324437 0.61132622716366503 -0.5387040599208216 0.21811186088835346 0.10177624384795239 -1.3525748652567755;0.71318777934081579 -0.56205470568126481 0.35885415566051881 0.60085587080987812 -0.68029542351224126 0.75553549696835842 0.044570686644892131 -1.3628472913773273 0.42160254078127862 -0.14623649023470206 0.71944726010873794 -0.095318905179400643 0.32243733992378465 -1.0096453628741295];

% Layer 3
b3 = 0.05771376278401668;
LW3_2 = [-2.2425560127009203 -2.7526610820776587 2.8403673909374687 2.534299002314401 2.824735375492474 -0.11016143130595536 0.075126684375541763 -0.090637363629770332 -0.20761152117372553 -1.3707554494044454 0.44106028937203851 -0.3835342377413532 -2.9067396037268773 -1.4009558114176581];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
