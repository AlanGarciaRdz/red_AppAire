function [Y,Xf,Af] = COLomaDorada3(X,~,~)
%COLOMADORADA3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:36.
% 
% [Y] = COLomaDorada3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.290275761973875;17.6991150442478;0.00572573718866304;0.0175284837861525;0.0546448087431694];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.7810432803262211;4.4303807639649078;-2.9009181769224459;-1.2268922384635428;0.2067669309554977;3.0641862072620452;3.2800346704786256;2.5369922039709807;0.066967635378068519;-5.039478398009531;-1.9867700144461344;2.2814837582892427];
IW1_1 = [0.049287589566352513 -0.80636980189248675 1.460244041694776 0.92632246790754091 -0.74621056737586378 0.41288810840446599 -1.6798329422735752;-1.4606843845518163 0.59453036694171513 0.09888735177834744 0.5804331215714571 3.200163784942553 0.010420341899853771 2.4348922509252242;0.079820821993386498 0.23412617770756827 -1.4898788446752724 -0.30233227768228865 -0.38233782374900582 0.31523496304658533 1.2425975670675184;-5.5956935489840438 0.64250918700587534 0.12493136408573088 0.37926617106878036 0.13238956917579062 2.9398060985308074 2.7364764819267102;-2.1562029140501666 -0.49396422290025715 -0.53589439379565385 0.050904864056886538 -0.92708722649787445 0.40752764140458436 0.98636233353734526;-6.0676212385574821 0.80694738624832851 -1.5330335065509895 -0.23891221971225993 0.11539325229214968 0.37504875912935753 -0.91805502900409552;0.33547881954528275 7.5899684131381937 -1.3381864608798189 -0.25858472572310509 -0.17731671001952248 -0.12218815831761477 -0.31981720242593459;0.49531273786450231 -3.1407402119360723 0.91637478017481022 0.54112417439053184 0.80887245964530041 -0.17157754054121807 0.039479509370857709;-1.3420764320633258 0.58097772522606761 0.48049435965652981 0.22642672875639033 0.042425629047661791 -0.23885853417334163 -0.52513227637677762;-5.0048482637787206 -0.73144945274298556 -0.090211814175200133 -0.27412617020691471 -0.031994510536818704 -1.2150699605365489 -0.78845190731540415;0.14797491670254162 -4.0162952538006325 -0.082026298262353942 -0.26058529865323943 0.082421331976372497 0.15209087393455414 -0.1282874375340099;-0.75231392134040564 -2.0100900204032794 -0.75954114140524731 -0.66387790232773369 -0.030173718398037095 2.4708673364821951 1.4691376210949165];

% Layer 2
b2 = [2.69193379974182;0.77313604665885938;-1.7201110036417175;0.67686588851037766;1.1908959554639398;1.182836424259277;-0.076644153934961323;1.4184377813795708;0.44521973836151624;-0.66166467425340869;2.0999041539850833;1.398523941047511];
LW2_1 = [-1.7209010672930611 -0.61462859271243986 2.5502934244620827 -0.59556135439133573 -1.8432947939812885 1.9122663320546738 -0.085940697824586285 2.1431934323173811 1.1711242881262334 0.40204979441588545 2.7718130799166425 1.7148713189091682;1.1612179127924755 0.47440737937550109 -0.91562147736417276 -0.85675115865081652 1.2771845219915625 0.41932916060300074 -1.4764059470452526 0.047373223644828766 -1.135371660484934 -0.27706406721942767 0.5189877523085672 0.76655438495669104;0.53458450930861334 1.5210548292064177 1.6217281324996773 3.2375137146425415 -1.3588585700034641 -2.0333782245167416 0.03716831105169012 0.39642045409213744 -2.8234908883692209 0.42639328448246194 -1.4800438898687096 1.1021796471947298;-0.58739618206799027 0.74979204916144437 0.67288802729739883 1.1160171474090885 -1.4926677364235819 0.68694587908342541 0.12874978489702665 -0.98788110497183024 1.7941000814216714 -0.042264679141365245 0.76542939573810431 0.35892074726926015;-1.1803211549363912 0.23489456413033188 -0.079627986337514167 1.0910409427594281 0.15906465234181344 -1.7551467235565941 -0.29666481257633759 0.14780768670301792 0.61296402130420358 2.1057694026486189 -0.2670571183849208 -0.49467592241858749;0.84123953160393139 -0.39973535762734091 1.6294551888094728 0.48149064384399615 -1.1338436970420451 0.50449098636181844 1.2181902320847402 0.42775244776204607 0.18918865644351365 0.63887857212833399 -0.94964144594614175 -1.0530635562615611;-0.019364858690442348 -0.5567583175801325 -0.18456980637913128 0.11019835329733098 -1.3213033242195511 0.73840413300865637 0.75938109543536403 0.51429854908490946 0.62336037887391538 0.38120214093048405 0.013588953029766718 -0.58682982137993223;0.95780458120520484 0.42221122512593812 0.71661154913183056 -0.08394063945031667 1.2479153444839282 -0.78014409838916288 -0.68826119039695322 -0.42751716424165792 -0.48973818151305359 -0.16052955147007181 -0.29321976177917525 0.38136799945782907;-0.80660388700028762 0.82848377629663661 1.1766447051703512 -0.23484824495526241 1.2717060443511872 -0.69649621685977636 -1.4595529762637982 -0.26295608767012524 0.25030322050861481 -1.5730216956993262 0.076537297738968169 0.47650927223058837;0.069055925981895444 -0.065773286994397787 -1.5526257234023941 -0.0095227946660538902 2.3009694391671536 -0.43106540031675938 -1.2431979446880872 -0.60698043097364418 -2.8850945942705581 0.89062340017547625 -1.4474322421391865 0.20942774621982901;-2.0372730268052428 -0.72873769094781604 1.3562263079330379 0.97152674827212038 -1.9249661627768655 0.1160609785570878 -0.47989975636065663 0.44050860026133992 0.87915720877600045 1.7740830054847483 0.77450630436516488 -1.3443578556023716;-1.3271404822146946 0.43262424142805461 0.0099078271082772458 1.16977771273914 0.39995142583767185 -2.3101534805318935 0.029078891418129655 0.1906101082094355 0.95238396759310362 2.4412917619841688 0.10896716026167713 -0.50444858794581182];

% Layer 3
b3 = -0.087377082607209527;
LW3_2 = [-0.30398409148409267 1.2248636257722958 -0.26101795811268763 -0.28688785989055571 4.2033236242500012 1.4105356534547204 -4.160901391839678 -2.0915952852049626 -1.6428326908801585 -1.0902309569988256 -0.68019314471226211 -3.2961408129062248];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
