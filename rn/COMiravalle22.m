function [Y,Xf,Af] = COMiravalle22(X,~,~)
%COMIRAVALLE22 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:49.
% 
% [Y] = COMiravalle22(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.7038583991905267;-0.62867700203707644;-1.5710129622220481;-1.212105499711676;0.69850127171711451;-1.2423470294973769;0.87156292520955048;-1.3032495070469334;0.65156826586503058;-0.37812684597020257;3.1266487638994627;1.4793214709421774;-0.38238837309131268;-1.153482835637464;2.6549310934223818];
IW1_1 = [0.15234760015740711 0.14372420451021051 0.94473521686726125 -1.2246753911411139 -0.93787502003253154 -0.20680579390355547 -1.1908268555942254 1.5324238153279259;0.30338512988344996 -0.76265376941942431 -0.31439644612617662 0.37605963803239745 0.68154799479659212 -0.29184859170732946 0.35238864548806242 0.097592112899810096;1.4706880259989141 0.85418435738979825 -1.4094424127862015 0.64000605432916946 1.4893447961129291 1.4147070030268589 -0.036498747421118707 0.40485555298402531;0.069009954893151926 -1.083056951564445 0.25516603818291228 -0.97185068172117695 0.54494047764791553 0.13680078212728441 -1.5510223247305341 0.59002019919863058;0.30475580869757962 -1.44345744795717 -0.41197739847480697 0.17644946698022818 -0.18053406851184922 -0.661916222758549 -0.47076606815151323 0.43485647030873964;0.89541519143106219 -0.35711136233427876 -1.2741904174492609 0.35802668633500179 0.73680631235990635 0.52145645816647079 -0.65039299572952325 0.86445181486236555;-1.5919420695569746 0.22512068852256897 0.1183614054429877 0.1671236703261656 0.49328594805224762 -0.86342177186006697 0.86792534884101813 1.2761637896957501e-05;-1.1248892170662292 0.1606753142399544 0.16695659221694792 -0.57088550832201124 0.41598243240284682 -0.0464140404091333 -0.92691325607141994 -0.080300787090013231;0.88824756522911597 2.2730152212749681 -0.15175994989537789 0.29987437376699261 -0.10266770751668669 -0.41774132844534312 0.34038674264933949 -0.28325031183985555;-0.71421545474538828 0.10779101724285703 -0.39783845986770067 -0.22501209213637616 1.7671854042148871 1.9704170840056801 -0.30933413898025724 1.449681695061571;1.6370930312652987 -1.7202882600858509 -0.071759834015411625 -0.35868525923080202 0.13236170884532727 0.88544647029696721 -0.089463484588500258 0.028245115906725515;0.95359158077372019 -0.46190444820030763 0.091804966919342132 0.23690057306848031 -0.9584759953538845 -2.5318200278834175 -0.012851969715624988 -0.53863338809278916;0.11435564632604533 -3.022106181796786 0.067410984629775003 -0.063036841976327973 0.054597210696843007 -0.22528399079094685 0.21256493942880178 -0.031141700871218453;-2.2794559141208262 -0.65660774629989949 0.97720593657758714 0.37759402102390283 -0.14568196581931178 1.0285044672452475 -0.29488872281666156 -0.28994415018575986;-0.023498369159043866 1.2690422001716288 -0.29261163407604385 -0.49739500165788342 -0.58917276109622085 -1.2683463467484746 -0.55601043471378986 0.0038744517404670359];

% Layer 2
b2 = [2.3005333175264164;-0.77038854806984658;-2.2176850155128949;-0.12265907895452413;-1.0266350624066896;-0.031255608801124241;1.2102851052030721;0.2111268770494644;1.249027483242497;1.0560652419504084;-0.82121891481392972;1.1352871740248278;0.35014896231571929;1.5888565033185182;-1.2885286001908702];
LW2_1 = [-1.1602234003552603 -0.79566781592280389 0.092027039442515085 -0.6851736553746125 0.72546087728472353 -0.48227532360672382 0.46729953524477008 3.1345525673824488 -1.1695340212982976 0.40222319435933007 0.39916931647993986 -0.84859317233268627 0.093320329886768402 0.053404647716746169 1.06192025112953;-0.657367477713521 -0.34930564904940453 0.94694537985905591 -0.92565120558467484 -0.91126783195745897 0.23609840114393629 -0.28312646964063937 0.69020828257835165 -1.3943074553245034 -0.091144610142247451 0.27217274400481001 -0.023494819921784323 0.12774055162703152 0.31272229309877064 0.68689037563800792;1.1197296725646082 0.24860142285129136 0.098798234101780957 0.29268827870632358 -0.21678949433560599 0.96922033756753456 0.067351973013438884 -1.8918017594655154 1.4406028611510222 -1.0674924760409381 -0.043722137693362861 0.89672590563194132 -0.294968886170276 -0.75070124095923896 -1.537405746375714;-0.23507089881588128 -0.41475848314727998 0.28261695014316801 0.4372607090320732 0.46217418636052299 0.16558512809326523 0.52548247526728087 -0.52298526431977865 -0.58359551418403788 -0.47416286144227876 -1.0328457504479249 -0.89856636590682881 1.6639903862217114 -0.087442317431201455 1.3218200735052221;1.414587608165859 0.26962521524408367 0.13233367499670162 0.3031739516949587 0.77673477345726327 0.13178992531784223 0.10416087549933849 -0.88347637671448798 -0.55636146973386102 -0.25602469598030037 0.2451684656957871 0.73197055386031018 0.63190719162125442 0.44183107889567058 -0.71708756258796025;0.70736508412568866 -0.65483565041139136 -0.038872879581961076 0.10985938475310059 1.4762120537189374 0.82013731532877321 0.0066802277760454574 -0.94322228374365658 -0.45034164631532858 0.00048531773140595737 -0.92457004098952389 0.97980187914796968 -0.2855042536322478 0.95864876755403006 -0.0558613754693109;-0.7225046388199573 0.99170974999111983 0.50438709293861872 0.058734188851610573 -1.2904453129150095 -1.5243842470467261 -0.24949852877024034 0.80176951591655166 0.21273307257919014 0.0015803763939586327 -1.0278090688935642 -1.0232605413119071 0.10484593949013107 -1.0392659681061136 0.67780774774536601;-1.2315463786800798 -0.2682034585742667 0.46142575960863197 -0.11659964434507383 0.02666658307130201 0.3445674368704863 -0.45695564981125486 1.1830433948408297 -0.8586236884851276 0.46108385314379002 -0.31530683693889661 0.97864396564481215 -0.70928919182189643 0.24910850819131328 -0.040439818495542179;-0.49173018187751499 0.071414701210774242 0.22979723979269898 -0.2705388523516904 -0.95000933124619258 0.44700888390726351 -1.1044433728386132 1.26856827206498 -0.79215473603436959 0.29202609149371728 0.3031804505993913 -0.17873957701326468 -0.50995628060995957 0.59732066896052771 1.2103461067255867;-0.17074046925895406 0.032274579438959887 -1.7229669568481973 -0.53403914392984864 -0.97240257066749447 0.84041959622777784 0.35943012512067252 1.2337896672279276 -0.75800895022869808 0.31745534970281775 -0.70953456982149909 -1.1230161012946318 -0.18145851763379842 1.9506055321704601 1.0534260202953207;-0.70918091909851966 0.20440081243672664 -0.44967813502066162 -0.66989342406930341 -1.0702376901258215 0.53193049582607044 -0.52545163404874051 0.15314892593612389 -1.2331067137257343 0.750157500015873 0.52030432274067961 0.94524036073649553 -1.2334256361847982 0.49478388833217368 0.25524415062306322;0.54939087039098899 -0.42059779921139534 -0.30185788887612874 0.45595251966804889 0.31175526331043213 -0.85460058051772092 -0.20926777088977352 0.51612149779799199 0.81503419708498748 -0.76108023424543569 -0.91028945254640514 -1.0234440251103443 0.48804610362317913 -0.51660730372280927 0.70283181352372925;-0.23256306425918899 0.37646635415425522 -0.6186477521118986 1.0079210053441923 0.86108052101699839 -0.043746148268258706 0.50437924187423722 -0.85145126253429293 1.467727353141689 -0.26098991139672584 -0.089834138763005333 -0.45501363546879103 0.14554989300952909 -0.33255564733885773 -0.89571079091701111;-0.32012005677389727 -0.84923399052872339 0.16961797347424346 0.4522889387363892 0.14684216234616071 0.42289013847685608 0.5406538672012372 -0.55783173862317081 -0.51687500677942 -0.37124683307917666 -0.9924578787665832 -0.59779503214919627 1.8323556313594245 0.083451302580266035 -0.34390348156822675;0.065720631036015303 -1.8552465014650601 -1.4079279709117036 -0.16687076380617921 -1.5488804659503748 0.44256569942451557 0.2931063782905865 -0.30599624076110926 -0.54083086606976316 0.35493640733654019 0.41043158671792135 1.5457093931076009 0.45513000718874685 -0.51407608207138034 0.37292332050256288];

% Layer 3
b3 = -1.2377361425129285;
LW3_2 = [2.0489445459894049 -1.7588900469313273 0.85947589479313047 -2.2261862814621796 0.83511534884462624 -1.5444337696491197 -1.2367786034178458 -0.5737956607158301 0.71235167002955058 -0.2897816994284621 -0.81504786332624679 -0.33258563315822232 -2.2653507446500236 2.0315119479160861 -0.2437627624919565];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
