function [Y,Xf,Af] = COVallarta3(X,~,~)
%COVALLARTA3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:19.
% 
% [Y] = COVallarta3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206;0.201288244766506;0.281968137600451;0.290275761973875;0.304971027752364;0.100381449508131;0.172786177105832;0.171659085057077];
x1_step1_ymin = -1;

% Layer 1
b1 = [-0.33190375994355448;-5.2604838673816081;-1.5511676921342556;0.8247559736809007;0.20887522093717178;2.001210624630672;-0.3069730798453334;2.1100094511362197;-1.9272823863532096;1.7339384117972374;0.16983885873234478];
IW1_1 = [1.8710732793045011 -0.00088418550178533117 1.1178576164574154 -0.27726426277018645 0.022807572773039575 1.8818277885369463 0.26211316800967105 0.13419488198873417 0.21456859619382673 0.14851266905697369 -0.4335595289771817 -0.10612356871687523 0.5749958442891826 -0.17197377293867996 0.57553388964055041;0.13915056417187285 -4.0458357459365315 -0.19987065691256134 -0.80913463846020761 -1.7326312910079036 0.6458233047332258 0.11054578497775656 0.16210262580768808 0.11692954612786544 -0.3870777268632099 -0.024758026947380177 -0.13366578008655078 -0.15691092763564823 0.29931294523475171 -0.74644300042604017;0.097854546995416958 -0.3656940492395846 0.080317360209285205 -0.13671919105099153 -0.88306961583977928 1.0677543551126225 0.024092278052561839 -0.2129499903821114 0.21598296436863937 -0.24499319225869082 -0.31278526628898479 -0.13857146921525937 -0.96757408197773775 0.57615766301223914 -0.7738343674275584;1.0854295824562745 -0.27855880510667286 -5.7667792005005793 -0.19729850130298493 -0.75386354444507708 4.3337743494956733 -0.29581081261347569 2.9816812556600341 -3.3259341369795945 3.3413370698689637 -0.14007912435875458 4.6091544982137727 -3.2593371076050279 -1.1902499491023684 2.9951671113810709;1.1815735286082125 0.65249599442372352 1.0753974550086558 -0.2577607812229169 -0.53765755206842725 -0.27186351394193142 -0.053834982549810326 -0.26933002517404941 0.47269249134523578 -1.2656314986247308 -0.21021014705995483 0.013016843929033281 -1.4467371682370715 0.18968844922386596 -0.046683605118208606;-0.03562950088642132 4.3009305784359739 -0.10714241925785442 0.0050510986820519882 1.0876032967319225 0.35526440620125571 -0.044774885465189047 -0.10135207608528521 -0.2810876474599498 -0.20058309848896902 -0.4142418606682079 -0.032290389982029488 -0.27672374597889987 0.12294737955368143 -0.2178602870879234;0.54643826843734111 -0.7215112860283418 0.031122796149264345 0.20641887757995206 -0.099827395212282372 -0.047481929779293441 -0.11067693629627368 -0.71599758543541747 0.2445682577603773 -0.090380741266778919 -0.15068252531479218 0.19532951357571793 0.41920136873887304 0.38427930326262671 0.35125395084229333;0.80764105925218488 1.0850498549442551 -0.41563595659449531 -0.1156613666998344 2.3563116585169235 -0.55937145439599656 0.056465480579293431 0.10612007275551132 0.027676107785690067 0.18167332385270082 0.0027640749567279591 0.024070406787967034 -0.16005847029804265 -0.13797416194096271 0.25111204213118127;0.097134937281745021 3.8648917709277346 -0.22876869343743891 0.24636000474373149 0.71099331958272882 -0.30962980932231671 -0.145899176617381 -0.097102836974535658 -0.14985134595371366 0.88846765659022053 -0.33418807290972619 0.16913406366188044 0.30997053624462012 -0.74160191516036544 -0.89179111160607283;1.0789999731190898 -2.2571747900101298 1.5914031675052505 0.15329937091725759 -0.45646892845165032 2.1469683984709236 0.10928693665677502 -0.31633399214641877 0.091041518486091877 0.0016997770889729674 -0.7767393714569365 0.84752104822725494 -0.017643892622610589 -0.19809902797441392 -0.80880167144620352;-9.5025676045486609 -0.28098346876803487 -0.56313555671003934 -0.15670164865568112 4.7875244070572371 2.4751178967728471 -0.16345131653540276 2.0741429028123735 0.15311906916507528 0.98068710588205832 -1.4314252847381022 1.1937837936764495 -3.5668079888316013 0.82509951056989284 0.32501138220381354];

% Layer 2
b2 = [-3.3017016220155617;3.3862908709108925;-1.7934082910209601;-0.98584929764924922;-3.0536153463320326;-1.0928733245826945;1.163282135599544;-3.0369187292905;-0.68203053781927248;-0.61384569923835719;8.1800415702842884];
LW2_1 = [-1.2108155014053885 2.2315498287033151 0.10740882836988233 -0.11628970240415848 -1.0340325983425935 3.204741390927599 -0.16375833905348161 0.85721625876864627 0.49325424583226785 -0.1870581677901606 0.9026774026234764;-2.5214045602560162 1.7614848045472808 -1.3513036330365849 -0.41790542574282824 0.092955696426430479 0.9894801479088261 -1.8694995795122065 5.086905450890411 -0.82596347877801701 2.1570341792705219 -3.4766610025050797;-0.54644796898623627 -1.3491416372659977 -0.020148880458756957 0.26907672920803916 0.31921018029862241 -0.37051112591076563 1.251611934685418 -4.6353623150987531 2.1036255921573819 -1.4355881157743773 -0.15518393588103835;-2.4044766410128218 1.7586209674221633 -1.4061573142664729 0.038909807008237138 0.40936593490826484 3.6405609803271561 -0.043931320160034662 0.045566776126117474 0.25693767695992342 -0.37427431835786873 -0.41239796353879365;-5.696816443838598 1.2340852222385057 -0.34376110330109533 -0.47546957872176543 -4.7732479255420186 3.9362177025820961 -0.59022311966488283 1.7308925504775194 -2.8757985289510346 0.12629974820447215 -0.26791045999208174;-0.28480075273399597 1.1033329971062895 -1.1256014808400954 -0.29042017901796047 1.9176279007692376 -1.4902428199023543 0.31107806650844116 -0.21083392879314686 1.0349661276974171 -0.35161688123378088 0.055158206380374719;3.6387679186874191 0.22130937540401091 0.22881715351607351 0.58723537064268605 2.3321659294322084 0.76505282849559153 -0.090973014121892043 -1.1687025333669687 -0.92747135311945528 -1.6300301896526728 -0.080243014910306484;0.92231454954165226 -4.8531552488803378 -0.88639750504631831 -0.68045912836517752 1.2174902068416171 -1.3212638484159978 0.92582575888203333 -0.70170602744711841 0.82739083955016068 -0.32193472365033016 -0.18770678935588267;-0.21814604371098995 -0.17829778344297914 -0.0019413694149754725 -0.12075928741499926 -0.2956108021368945 -0.40273397160696472 0.61263134428769173 0.8529548553720282 0.3376432845608523 0.0036661604442924864 0.62853252906446988;-0.44566980763812497 -0.46786695735367073 0.3052324607942542 -0.092553814920969396 -0.92507800461623857 -0.67418692513470668 0.074493276538642711 0.89001970301669364 -0.088046304652303106 0.27752720601608505 0.28004127175478988;-4.3858701058793734 2.0221864502073994 2.4162680975913773 -0.51844612631207654 -3.815599464503677 3.1208860991865164 -0.1121555754320254 -2.2064833720443739 1.4790380678970503 0.39318545137665384 9.2042231062938598];

% Layer 3
b3 = -0.88501916320588725;
LW3_2 = [-1.9582604063322648 0.83412014754835628 0.9583915489912731 -0.64103201273713784 0.22100136681603871 -0.60218468139759962 -0.31239156919858946 -0.19679612691282228 3.3929853847581315 -1.8471041528220087 -0.18222822536400046];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
