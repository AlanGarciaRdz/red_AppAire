function [Y,Xf,Af] = NOXLomaDorada21(X,~,~)
%NOXLOMADORADA21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:25.
% 
% [Y] = NOXLomaDorada21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;4.5045045045045;14.7058823529412;0.00280033604032484;0.0179856115107914;0.0558659217877095];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.88529312275201;2.43147353435364;-3.0469244491135106;-4.4412740158208859;0.844067152887369;2.9817624501575826;0.77535143507426552;1.6051482912285415;1.7846819746180451;1.967856678837125;-0.88946442980699947;2.5093800127520787;0.91366977051258857;-3.6805028648850722];
IW1_1 = [1.7205562811057509 -0.83944786162843932 0.15836150038819108 -0.28596039459563938 0.33350742855604143 0.43769844785142209 0.12335335303322102;-1.3310782071001932 -1.2208345964184044 -0.74029860606667641 -0.9490854506782368 -0.65884632507436325 -0.32952773500744476 2.1800958319305743;2.4242887562492204 -0.51512868486820607 0.2023549994786667 -0.021323217079965061 -0.13861138369641135 1.6548674435788473 1.664885245148273;1.7770066285720536 -0.15129714866987734 0.9622861711060241 -3.4274841745251399 0.51639677356419778 0.07671978013745015 0.24134060675652455;0.023273393023609569 3.811752089442165 0.49147989116887814 0.60871330678731173 -0.28968703317136435 0.10771607198545602 0.30431401946929021;-4.978399878219701 0.1604512947400292 0.43405655425208206 -1.7956631929328872 -0.26159898288839933 -0.099115616256844535 -0.64854111474287768;1.4389843633952311 0.068882962395865194 -0.7475707013445918 -0.11966164130500438 0.072611610120775286 -0.59786440481265457 0.73252194334446108;-4.7579675450794223 0.074287437306976109 -0.83143872674405328 -1.2763506019061788 -0.3393275502428082 0.30608169241291588 -0.16456600817343151;2.5663404940339838 1.8954731698663805 -0.4493381513694098 -0.74204536163500356 -0.27276983742898864 0.46713508891525241 -1.2199675243333348;0.1976842807759828 -4.1625983063882535 1.2522789355737871 0.16887095237208191 0.39629571803421204 -1.4869826316865862 -2.4556460750839961;-2.1498369342837753 3.1452116268476553 -0.57475616810144592 0.090530346118553623 1.0643018967927325 -0.37304091537280848 -0.1822880362969376;1.1220424547355374 2.190539498481979 0.92466012811893172 -0.90358273698746805 -0.22923971251835418 1.9431956941366435 0.44137546493391394;-0.69322683328321866 -0.040909089839064813 -0.070648357697472533 -0.099937416964458667 0.071594435596606498 0.36517320912203871 1.0924756193056633;-0.90673650023840613 1.3836239678548852 0.32130675898380379 -1.8570713734101847 0.53384503834292985 -0.88535160193321116 0.18884192134874295];

% Layer 2
b2 = [1.9266139031451108;1.349991880915467;1.6558038870244378;1.5820249873321028;-0.65663583241710466;-0.9919965861247052;1.9867009544842307;-1.0888225978126691;0.41213985553152971;-0.53953504311731615;0.16164467839106891;-1.6059795613531826;-1.4015172761661241;-2.3715503045384883];
LW2_1 = [-0.48173737403733491 0.35362500371258554 -0.21519288710598089 1.2378815853532019 -0.73646870792078745 -0.31770951874018732 0.52792641487242076 -0.96110419212641729 0.7423835208194598 -0.34695147919819902 1.4868436955031363 0.12369475265606247 -0.448141763984298 -0.9345447528258114;0.5544491896412882 -0.54025363676483051 -0.62500727704212733 -1.3436457240548159 0.77588164435306273 0.94889347978660021 0.34467402453323409 -0.85249458618040119 0.67431378897815386 -0.25201430024073856 0.64480054185323976 0.30028518065462517 -0.10200613974458897 2.5745583229079334;-0.98166387877583894 0.24443099370376498 0.82375518411999105 1.9998527661527581 0.69696592877621366 -1.4720831163928536 0.0083474346471766325 0.49271744570845172 -0.47992217351366162 0.84976373484319823 0.62617993535296201 0.22390083571911082 0.056686832050083839 -0.39730606650954053;-0.46516317065538099 1.3089535913639012 0.67729511769534323 -0.95727376572193379 0.70114210674536626 -0.32967951288476471 0.63237365407744994 1.1300838772197126 -0.688285288323637 0.57291200413486709 -0.42595483472960854 -2.0744170832833864 -0.46237301299831951 0.91871369738236985;-1.1303722324585606 -0.78477598020883843 0.73132896485652055 1.2133890446416715 -1.4138249096036102 -0.41955272267162241 0.367220683520872 -0.52922094943617459 1.7706302344260527 0.40874164932394247 -0.37572682409381469 0.59665976429538847 0.12022759488047656 0.6758711800594388;0.36656345133292223 -1.8654939699217055 -0.24860203281643312 0.46960303210342186 1.7447374728320872 1.8819803918876381 0.81358260873889865 -0.17152924066399483 -0.24762032101174436 1.6983588580353088 0.82479886971196681 -1.1442097346074296 0.44355609230078547 0.57880707184425162;-0.29469535650790324 0.14698858368459355 -1.1414365497919345 1.2744362758680148 -0.22109027203687354 -1.9046048679252472 -0.17188376839023731 2.0034558243729177 -1.0650792875232642 0.30302948585755479 -1.691083375969511 0.70983934533959581 0.058633381386984082 -0.46296396809095092;0.60792798928242553 0.10302257351476947 -0.37908877702403293 -1.5320703662765376 -0.24294972145706156 0.76706864796314933 0.40953891248141638 0.041768103956849975 -0.1525668731048104 -0.34501928340865723 -0.39960259950137605 0.024481788389164434 -0.48799581419020316 0.29784390721583204;-1.1170285709831977 0.59032813087166014 -1.4720384928907235 -0.46974958822606538 0.76438530793312465 1.2904010300614477 0.34738078066904965 -1.1498731516827327 0.20534704868934242 0.25872888105532643 0.48016939954958998 -2.4245247554208369 2.1238110669081043 -0.51336447289345133;0.52343798796362795 -0.67165695122339242 -0.48992874988871493 -0.26484942782633691 1.6324684280616268 0.69398940822171729 -0.88460944070200731 -0.53664585932883568 -0.94306781358123548 -0.0029332599062490581 -0.7313080237491647 -0.7278186120147947 1.7512266064153581 -0.66143546169449996;0.51126961310985941 -0.73413227712545193 -0.86538370158029876 -0.31547401872203001 -0.083639562849864138 1.0159023964793503 0.30229170350104811 -1.0170630763052431 -1.0552223185891578 1.1161953472201198 1.2746865409084021 -0.49930440757589101 0.080524485298250265 -0.37833816124301789;0.86088124080834827 0.15739144913073982 1.0262321430268109 -0.84534410837363605 0.8503501136426096 1.0327964139910193 0.054915634161620916 -1.5636260616889719 0.85910869557527847 0.46707054557926631 1.7459757588973079 -1.1956966575218746 0.9555862665684387 0.047754360914708555;-0.71925990063201872 -0.55493308935439545 -0.86597395750007466 0.20387522510292305 -0.91005860147122852 0.80447070256082787 0.15984996416662364 -0.50106301826082789 1.0302140986349004 -0.025029603692348582 0.85586523685539029 0.031626642029179051 -0.50693774087877252 0.80593673628736007;-0.72412198464709376 -1.206615232848812 -1.2441943055028817 0.40117648313952153 -1.6256911710905217 0.33614720949072108 0.19338970832569122 0.42591244488804997 1.3391415678065632 -0.49341096041844668 0.45243701020425808 0.20284027402483329 -1.2237846282030662 0.42677898884532572];

% Layer 3
b3 = 1.5402477560573016;
LW3_2 = [-0.94744444923351923 1.4251972902575631 -2.5633539602115665 1.069252914991768 0.55710584423908904 1.1312791271365947 -2.5081413677351714 -3.7341508203995359 -0.63799310012588584 -0.78517750939792774 1.0313636668028399 -2.524877626694447 -2.2982790256537999 1.6005738799270934];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
