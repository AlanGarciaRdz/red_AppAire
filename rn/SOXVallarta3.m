function [Y,Xf,Af] = SOXVallarta3(X,~,~)
%SOXVALLARTA3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:30:03.
% 
% [Y] = SOXVallarta3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;10.4712041884817;0.00782778864970646;0.0208333333333333;24.390243902439;0.02710027100271;0.00630517023959647;90.9090909090909];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.7895017037158785;-2.5029831288936575;1.5543427289357352;-1.2106918626529686;3.6959402635632479;0.82181961334620357;1.4383190855658388;1.1511003982639001;0.31514996878710005;0.59731596247011431;-0.24593727724814729;3.2040239192265041;-2.6593455102644552;2.1550872192348369;2.4214225011416204];
IW1_1 = [-0.5616742884506869 -0.021621671388788073 -0.91865236498355529 0.00094469098376563296 -0.25085491337926624 -0.28603939152575736 -1.4621012922982817 0.83558612155204381 2.0271266554224323 2.2379104562689771;1.0839189668168625 0.040082959980150205 0.51032471192500339 -0.033213181324981557 0.73895346570981246 -1.6970139403837878 0.2124716012457446 -0.36713251776330391 -1.6165354886733805 0.19577355742735386;-0.54843222644827772 -0.12930623187005647 -0.22717356895912674 -0.27820162375135532 -0.13109967216886526 -1.0490757613131001 -0.36449338660137098 0.85982065057803836 0.63466285505291209 -0.27236939216974443;0.88930098382336564 -0.32497317750990062 0.13265714956056698 -0.22821600635084321 0.23308060048694815 -0.64714170011801653 0.8804214560761856 0.6135538921400846 -0.067030750163472555 0.73766654669994025;-2.7820391887451579 -0.039879562149628137 2.797720453934081 -0.099658945050508291 -0.23705364700158651 -0.9501856385687828 -2.3088243524067593 2.6238561304459953 0.34128838174562431 1.4434135315143417;-1.8497876044879562 -2.1155423601122552 -2.0760855769012427 -0.29889218309367033 2.5378186204742295 -0.83801751009606429 1.096995211852861 -1.7924432204542231 1.1958214918489611 -0.85739432911837621;-2.9459089085552699 0.60043616743112049 -4.8915895919890611 -0.77571667451480941 4.1515451818904774 0.024567445696302835 -2.0406897953866654 1.2330045389396522 -0.9678404617890608 3.086048068660459;-2.2460899413965802 -1.1724043762036997 -0.66888579306340112 0.88213879359008829 -1.4168761008473041 -1.2473298359996712 -0.047392279188239704 -0.6478564087267662 -0.33144897283140468 0.50714782777512613;-0.53032962577421983 -0.078456205391191039 -0.050674877175650862 -1.2551502320446055 0.92937148502494704 2.0684575310733835 0.15988320799487413 -1.8826100265673982 -0.56866728954330004 0.26956671924795239;-1.8383782460113629 0.84408321134118391 -3.2034934260645254 -0.69277961041195035 2.1271204297093069 0.4712998592592178 0.047544683588221517 1.9128073081360817 -0.34473872134677241 -0.24143825196281835;3.1074633641322875 -0.098018506015790721 -1.6113197093613045 -0.10890450138521536 1.0685580330372197 0.26029100742430372 2.3435308674075133 -0.12085120004647905 0.76412856594152934 -1.3875149668076316;0.61526867033835553 -0.041238608934089829 1.8004412896596653 -0.11435406796600393 0.22798855393811421 0.30222960332826948 0.69282343981042127 -0.4690307936218881 -0.055605781918896507 -0.090298942953037434;-2.5369315411747553 0.040042693045683732 -0.12679615711487763 -0.41382283144652393 0.017865221942542458 -0.44256520204395861 0.11735275073204346 -0.3418817471827405 0.05567231628616983 -0.088702933763261299;-0.7105803672857699 -1.9178115486408012 -1.0991441881311468 0.39027413426925978 0.45815116424831126 0.19920965475385216 -0.57223228376265767 -0.32555166431818611 0.91587632109290396 -0.65039331380390208;-0.029543075332220881 0.19010524631056291 -0.60101195031087418 1.0502764849470052 -0.26588564739510528 0.45328408335129955 1.1184170875755559 0.97047274082895052 -0.17163653739534313 0.14697795283114534];

% Layer 2
b2 = [-1.7847794888782307;1.4659295587954762;-0.74794317127668752;0.97672568159998041;-0.79551845223002116;0.50557640659917924;0.82961876189305483;0.14895347320006863;-1.1624900766489357;-0.20115914077134736;0.80258336385090001;1.3789547427174038;-3.2335847350164504;2.19990540929569;-1.768278328538617];
LW2_1 = [0.65829120603793345 0.84095399086464462 0.3997008666143253 -0.64039135270956205 -0.19822421020574346 -0.2190369541924693 -0.50926224969517819 0.19402669645963555 -0.0018058938414900699 -0.26902772562025656 -0.85580220437648258 0.71502769493609974 0.24696915949983375 -0.19631918984487354 0.19792305639804453;-0.42700006056290324 -0.079267414603388667 -0.65009225676910964 -0.7243639025978944 -0.12919512821102758 0.62462160310429793 -0.30556973612173777 -0.033410742342334002 0.92382438542560896 0.12378087088796229 0.041360087414270642 0.32531232099906038 0.039879519199890634 0.63043576891855346 0.2964687222983996;0.18418512862496156 -0.14772863743305803 -0.54269394976211516 -0.34467113092707929 0.040045269577299827 -0.79919297409874401 -0.33330973435204408 0.38112840520776453 0.072894238195722147 -0.76108663818846523 -0.017331187987421011 -0.23895883160799003 -0.51932044843152025 -0.62304609018992474 -0.3550729498577328;0.0166586222344587 0.071715668912432834 -0.32317340348443985 0.39593225971880958 0.47131484804073437 -0.69516134752353742 -1.0190584280319439 0.42135027394322361 0.84945209441949487 -1.0912819605804953 -0.99842412096076494 0.24473078666983916 -0.6464058269472992 0.34136044859324016 0.14933431512563802;0.056541015584719204 0.41415578343505632 0.40817601734135317 0.48887072203103382 1.0650849722190863 0.4131473344511648 1.2764923305234204 0.50492028861694471 -0.38674140762941306 -0.014601562517318157 0.025317887140729023 -0.82014976524799799 0.93662127141576734 0.096085723298237752 -0.083098101554149997;0.11033293708927427 -1.2656713219556195 -0.28351589965091817 0.68420034322245593 -0.0499030931068008 0.31475487373844152 0.35097241906499682 -0.37691138704977101 -0.32017152407169402 0.71729424032617473 0.83855022585424821 1.1761485326232504 1.2447688351167996 -0.23176516489018548 -0.0027086564244338945;-0.25194970072363748 -0.9552976333552724 1.248099127224896 -1.1089332888635983 -1.7163702516863146 1.5326081062409369 2.4283431421711188 -2.5088655595686618 -1.3293942037767275 -2.4836690779112036 -0.74800807359904731 1.2383441250110552 -0.79746384337560827 -0.36386549267374052 1.4786109888045587;0.093192092419791955 1.072703658180207 0.46578879975740983 0.81144529318941627 0.023945028979487394 -0.30397622512903105 -0.48231696601644619 0.43392248073409678 0.19644114689483544 -0.73191283818614405 -0.96160471160670458 -0.49360396634267201 -0.77280922234674054 0.13512464841097832 0.17365422631011734;0.049898525370814475 1.1080377181523668 -1.7343380406276321 1.0565850986066629 2.2826249578866951 -1.9149467017286983 -2.397707203464079 3.0747026012911243 1.6656342319965338 2.1339149030697748 1.4997803554450835 -0.77112658390884259 0.8578023365994476 0.53456551948332276 -0.81470200997198805;-0.99188292956529012 0.14075034367005523 0.058952984296063896 -0.43320387972730456 0.95045921791946741 -0.54169637984741037 0.37372649768905097 0.73994290685647746 -0.2370954126245432 -0.65092019702402082 0.0417089530581983 0.35885176707536903 -0.031582721081684466 0.063423965957925182 0.12160722127996849;0.45883288507001319 0.64117998937034137 0.0079873686229687824 -0.40556778561480189 -0.27878657967836407 0.22960416343715689 -0.32241241479801447 0.046747838366221525 0.42347571069245898 0.83076773170442575 -1.5331706998610075 -0.30744401017431683 -0.4083440290835344 0.0093774837626408522 -0.27554286640039882;0.33394698075401014 0.34357060492698888 0.27098056497955175 -0.11711591420209051 -0.39270232632707969 0.3179225888059099 -0.15643397815534152 -0.18549575565211854 0.19297538619877153 0.51705923339795745 -0.61840287502241309 -0.84801507995157799 0.21343798690844046 0.0026194026979368124 -0.14275122085418601;0.43836712744486656 0.15171978256921842 -1.8121662222667219 1.4637120359599916 2.305573111863632 -1.9256169463380264 -1.5355029060268115 3.0044062305819912 1.5749555987034836 1.1510210213525871 2.147527005338532 0.020839763041726425 -0.13927049115129989 -0.39062469957459145 0.24927720122190236;-0.37337972995221885 -1.0314461625738571 -0.31314580084509902 -0.67488517890889954 -1.7199619593930708 1.1912344296180055 2.4738726905087143 -1.8942128582143367 -1.2273700748995067 -2.6200967521110519 0.10797916573758341 1.2622656493942956 -0.75473428848839175 0.62064684156477112 1.5848506078306637;-0.5116692988656808 0.030065560774439719 0.38194351719916791 0.45634653758807597 -0.55645678191207204 -0.067817838154557511 0.14818150131950308 -0.42333693957885415 -0.63147934676231821 0.55172343487882047 0.48535364028380423 -0.62033662629997544 0.59323032569967205 -0.076241021071039375 0.48731774351880514];

% Layer 3
b3 = 0.17211639892524919;
LW3_2 = [0.63107151569271935 0.2327140777531114 -0.373194334426385 -0.075441605415520058 0.091314582871549074 -0.88123194266242499 -5.0440759447855834 -1.0328727835131242 -2.251091181298202 -0.20766257613215194 0.33415700303911994 -0.81746341956183532 1.284667168604243 3.1038864547229714 0.049888063416262486];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
