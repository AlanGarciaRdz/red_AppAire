function [Y,Xf,Af] = SOXMiravalle2(X,~,~)
%SOXMIRAVALLE2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:29:35.
% 
% [Y] = SOXMiravalle2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.0208986415882968;90.9090909090909;0.056980056980057;0.0063552589768033;166.666666666667;45.4545454545455;117.647058823529;29.8507462686567];
x1_step1_ymin = -1;

% Layer 1
b1 = [-3.9049993861266104;6.666295002689302;5.7059183645878218;-1.3659398491687258;-1.8060630279752434;1.9087544786205037;-0.001438820443956032;-1.327613434545527;0.92773304876021823;2.5664090786262745;-5.0239576775612775;-1.9947395587907062;-1.5548118691231603;3.189196456502581;2.918656981030022];
IW1_1 = [1.7883516880183328 -0.15117234645403479 1.0535156602647884 -2.7071340637809245 1.49519439012861 -0.093602008247724258 0.24016926753893081 -0.88283826657407194 0.40610265793790506 0.041306484250415075;-3.9100941106208622 -0.055334234176427285 -2.715532435819529 1.3632023088211076 -4.2914888387387942 -0.17191268262777415 1.1751010065195255 1.2311265232200861 0.37344624730850762 -0.19754615664059061;-2.5312406003845687 -4.2491151641766836 0.092987205162442729 0.81779861573834234 -3.5409797338412274 -0.24841259966731497 -0.10199524856286094 1.5934004606243983 -1.9360812087587238 0.19057724510325141;7.7675597528982792 2.54484635605895 -1.1608289405505789 -3.4581308102138637 0.95691297509989326 -0.28289504585771086 0.24792154762573143 5.598918935886485 -0.68239406717822859 -1.3380193094630668;3.747659201353271 -0.081948496176152075 -1.6326690857298916 1.5473789475253013 -1.5702746900372422 0.40423722032972698 -0.13873511173633885 1.770068381354724 -0.73505592875230918 -1.2371813219525991;-3.0587523818887554 0.061131049063583826 -0.043783591542417337 0.20248557996038583 -0.50257054523804456 0.62859614657154073 0.092657430794953283 2.5442542366752803 -0.19849301360221511 -0.8429213141411861;1.3762864818446701 0.20072707022693789 0.63173072973832656 -0.71440002615616116 0.54102685644290749 1.1039097113017251 0.84744641149601441 -1.2413650293600726 0.36672439429148229 1.2650117862037971;2.3292838000260079 0.012252838238035543 -0.4919562386714868 -1.1133104956378663 -0.2316016694865034 -0.96703020338779633 -0.14220863905682049 -1.7744755467887816 0.85226521796201349 0.29730579493257586;0.93930626023873254 0.03984102457449739 -0.2334019622828658 0.35059467237818692 -0.19154968624590107 -0.45040411104491823 -0.52636217874751967 1.3599236622308353 -0.27955791730631896 -0.90583562758716052;6.4159124266587995 -0.30553062148120275 0.58340831585922692 4.3738986540136944 1.0419971665715624 -0.58808371881462884 1.6075230852000044 -2.7210468906377874 -0.14147188228738489 0.027647511528975773;6.7014548175858408 1.4967385494179795 1.2492746989812273 -3.0997430128353063 -2.2978789269017934 -0.46609312619115489 -0.42894878995059627 -2.4653009477475685 2.2586523853596838 1.0842425193595882;0.41892913098743406 -0.10820070313408199 -0.1509639168195373 1.7388167095714839 0.21913680563636476 0.18955557013379903 -1.1093707612163362 0.76814633500839136 -0.15935476258345277 -0.96286898167015089;0.52082108855013509 -0.15714964124644965 0.88943919206034994 1.6538776472708807 2.1258831103331772 0.3069845311783147 -0.81758054418612836 0.42733249572424198 1.0982796659151262 0.16005372746196392;0.92290944076310866 -0.091096749076622671 0.24860402690102051 0.348316042521983 0.14501110782271104 0.53505180431048227 -0.51773352930532057 0.7597094813320453 0.32225614020531623 0.81142845232792249;0.66189687824457544 -0.16563612111932155 -1.4566364856151088 0.3194384422437257 -0.92669147325541257 1.9519669772942478 0.4321519272009543 -0.31691451585514369 0.89770310011059629 -1.4075023676312728];

% Layer 2
b2 = [-3.0413867333145208;-2.1333039830308342;0.67010387032807184;-3.4341590018875081;0.92395899483576605;-0.73314655902609926;0.58669727276895678;1.5296486096167157;-0.41691896651334404;1.0272757379722928;1.8027996264256203;-0.36203765242542341;0.26119593884027237;-3.2197672394933607;4.0279470467267373];
LW2_1 = [-0.37793564330219198 0.064800704898883107 1.0750801989275254 0.90619548241302295 -1.2976475614905179 -0.75694110168761231 0.32873504689111271 -1.4424341613084266 0.44396684398386682 -1.8390026946992466 0.68767384201979898 -0.49115718477741882 0.91344959126404934 -1.4339425782241424 0.86618051439433985;-0.25613472666555781 -0.31807832851171958 1.488424815307813 1.5584567946848824 -1.4513519934078172 0.03853850656147751 0.32251098785673898 0.4202532174567184 0.7428771361476495 -2.501648792188635 0.25799484939769984 1.6667344405449933 0.93712321003690036 0.52345692030195945 0.39553612530960836;-0.2272212496723805 -0.31509088176194866 0.12202232217945508 0.18249918993692948 0.72182412615493341 0.88300393219394224 0.37117084496223052 1.221783089975224 -0.39946911439872818 0.4339214802448178 -0.33348638579103312 0.14040762545649579 -0.4900974177729322 0.24483011283051445 -0.10012959886494223;0.47031828332180481 -1.9888757319375479 3.114895878988269 3.5425582110445104 1.1506874484627259 1.1536247225804572 -0.15260015218721351 1.1042266447017159 -0.37740986021418604 -4.5956096147571204 -1.7558392291942815 -1.3906321342633485 1.4044124926139554 -0.57252344370179054 -0.011514730710802404;0.98042264911569876 0.26005302627799692 0.08713306529763222 0.56497013430898357 0.81827824586450248 -3.1823007394699259 0.25222621531762335 -2.2640906021310396 1.7697187991606675 1.1174434189988915 1.1740650529628931 -0.4994381601179041 -1.8070608841591409 0.93875636432074527 -0.68440781078656499;1.1695670879646483 -0.62063044222536712 0.33678919812280445 0.15261237816905107 0.28489063026264666 0.72755878375378613 -0.15850860946258186 -0.89326261085259884 -0.030952305161597523 -2.0306877949758615 -0.41007556232829484 0.4638942729099233 0.90005796809961769 -1.5515814412716715 0.11473539846002649;0.43464884347893629 -0.043601402838066669 -0.0239557377444999 0.076358446286815443 -1.9031199377648136 -1.6737979187142544 -0.060036223652442822 -0.77495624163411658 -1.2125541296611611 -1.0401224522581938 0.65412065880746206 0.59439619049452552 -0.021080392192152818 -2.1286090929622627 0.67148981441256239;0.93142942118429028 0.31540860953789102 0.075990005558913859 0.55421280818332108 1.4205977287672353 -3.2067712665214185 0.26911875884975867 -2.2892665165727655 1.8314425308424827 1.189092970622335 1.0397961473693293 -0.57379387556167827 -1.6241047343899355 0.92585659470047177 -0.81186436886836799;-0.038059769009949923 0.054393358917262873 -0.17912758298203263 -0.25207781951190189 1.6580020648232616 -0.58181763404352738 -0.37014852079005867 -1.0507723374032691 0.31778909610812989 -0.15867605065499893 0.71869506882597323 -0.467333853014338 -1.50541565386396 0.016000579661352182 0.13207588605396051;0.14940982572616321 0.065303191198030963 -0.31207961281616869 -0.39227282765942428 1.1989781665706911 2.0124365737851466 -2.4548964966189635 -0.20567105575381325 0.043899070278555677 1.4791171863102688 -0.031682924222982647 -0.88557750131934332 -1.7887882020559529 -0.52975403275616229 1.27158498890247;0.38330365631632002 -0.49125327021317516 0.13303329036005421 0.25563258010096707 1.4905882758152593 0.17261121678212413 0.078187114349511699 -0.061931007382614048 0.48506963480694004 0.60228778231888269 1.2677569852573318 -0.75212654338868545 -0.83910274054158041 0.17768719185748214 0.55138951867463648;-0.39187989045949467 -0.047908303824606473 -0.0057159681470161355 -0.05413796319805933 1.6253407574359948 0.17093262944889265 -0.035605682596232452 -0.38600443894842285 0.26686273215486372 0.49095671490722009 0.64503112532783724 -0.16064465222072127 -1.5880642686047419 0.35123467159316596 -0.84690092480241286;-0.11687449817565027 0.21517958997530853 0.15480156253172656 0.17506274189999629 -1.8014773344282766 0.16303707266933132 -0.033057464156102896 -0.71930172416765958 0.45241335326298965 0.61384591014169032 0.61900259331159613 0.58098511831873201 0.67389882562312253 -0.50577041258152655 -1.3491835965453394;1.1597806081542839 -0.81677235384099978 3.335556597728456 3.8364209571798695 1.3524712541688557 1.279720194950017 -0.23255601093985517 1.1073321073844233 -0.46484595593986888 -5.138903275487972 -1.7742225137561414 0.14644606954663814 0.94698921766112365 -0.82936000066924775 0.017203190853772359;0.87871272555937885 0.0077593490562307202 -1.1747269925468227 -0.95270900078414644 2.0297115155184979 0.76758933124453332 -0.45025778741382178 1.3779890952106886 -0.64818084704471135 1.6885013290965949 -1.0637047326226545 0.099271733598090509 -0.41762933014226539 0.9852792381419162 -0.71858296290961132];

% Layer 3
b3 = 0.19913593603704427;
LW3_2 = [-2.3798826185928488 -0.28295037574064846 -1.2774216608470603 3.2399784915970655 -3.3085790644395399 1.160746740866508 0.3515374442115155 3.1170862594033291 -1.3020275598860478 0.26569819559622343 0.63514795415998349 1.3073057171342564 -0.62381471335531113 -2.9593320689409124 -2.150967698994743];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
