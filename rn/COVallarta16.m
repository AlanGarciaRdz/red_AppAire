function [Y,Xf,Af] = COVallarta16(X,~,~)
%COVALLARTA16 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:22.
% 
% [Y] = COVallarta16(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206;0.201288244766506;0.281968137600451;0.290275761973875;0.304971027752364;0.100381449508131;0.172786177105832;0.171659085057077];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.2943282222333146;1.3612208136860473;-2.1519031108360114;-0.72454675989423345;-3.125660221126457;-0.20237810042250645;-0.088794084625886879;-0.91398905244225404;0.10150242216695984;1.3132832086674442;-0.4469518332918081;-0.58496290418800134;-0.64342886012942402];
IW1_1 = [-0.80498411356543864 -0.38064779338064458 0.0091149474017481469 -0.28612193247404832 1.5269347368823472 0.72819853299746606 0.21482187727539645 0.1641231769804303 -0.075160559590123008 -0.10465364173228157 -0.39518863168522006 -0.26205630360500326 -0.088661479473304966 1.0252439975515133 0.70986477585361241;-0.54746541805462801 -1.2003048916956458 0.1588821985960443 -0.089204835674723079 -0.65699109309472581 0.55324904287188481 0.18371288963448146 0.52442760640254682 0.015647470947037657 0.43217735593322021 -0.088971799353401271 -0.45028260646973467 -0.086657501073482718 0.67422259869043388 0.27793367833305982;-1.789947019116803 -0.22977955953411766 -0.56144191927354892 1.1535664733605731 -1.6683925803612083 -1.4704222461251562 -0.23282925709198476 -0.23841699624300533 0.92993251883852812 0.42529163239711426 -1.4512337171896776 -0.36067939842170516 -0.1440160994616127 -0.87785420331290143 -0.3081422132485519;3.2331788696327588 2.1393568951136501 1.2725191216904375 -1.2937201684382866 1.0804875971699612 -0.30718575581714069 0.63472439510104672 0.31183197681864983 -1.7534444242910301 0.69156941535265337 0.281583607481385 0.22385770912182903 0.89521677887429385 0.33329257518444411 -2.8268174987100898;0.41532002707227855 -0.22318955784497579 -0.30153875583153833 0.31408628565097385 -0.49840193116682341 -0.14456916613969051 -0.11229721735759335 -0.89619222314951796 0.64667449482002992 0.5032679690416203 -0.84421098295434682 -0.24269784144211809 -0.36079901569559419 -0.7132529902343715 -0.83841531796783308;0.021592392248826892 4.9603307281731785 -0.052064613860108952 -0.81624552019778795 2.3777438618977182 0.42447767825584137 -0.023065653067899219 0.078445307577863249 -0.30767043315678633 -0.29739273814435019 -0.49664524904414575 0.094228419698358407 -0.86483821971889907 -0.027729665173086782 1.3791439336367028;-0.056538009302207731 0.1064209558859972 0.47688626284972802 -0.38835181564870508 -1.4968617105904143 0.48340986523038298 0.53715819899565076 -0.78938108529046502 -0.355701885671378 -0.42804144909941277 0.094045820879214995 -0.15765913152001165 -0.45325362823230331 0.22638843761992319 1.4125528778937875;0.1420627835510769 0.61540773681596606 0.96053390366483615 -0.17278477273261719 -0.86420250204140869 -0.54173468037699191 -0.45052025656544642 -0.53496733063264923 0.027363461001113303 -0.4129224562505367 0.04776106042609346 -0.35989437807904601 -0.18736812793884078 1.2773477195341745 0.59795331773229199;-0.27776987562131522 -0.444590425160314 -2.8183230105831663 0.63383870235253637 0.24339421226611199 -1.6653132125292176 -0.46423826611416136 -0.8315757679275928 -0.38878258458288351 0.5339584330857321 0.38914627854589479 0.38411927544598823 2.050608232543921 0.29744051338161187 0.15772353698121042;-0.32745564766841889 -0.20348307819575392 -0.52329442800104908 0.8724298215592412 -1.0432027511820445 -1.7794580731079961 -0.504448695864535 0.69227676828418772 -0.11766502513141802 0.31858422537783571 0.97203747351996683 -0.064198099723814711 1.0350382998294951 0.90071365558840732 -0.16476423277491375;-8.4837876534845797 -0.013468753561021625 0.056343660775128798 -0.67291155815472725 1.4462229533973874 1.525021545554698 -0.21798673389432635 2.7223192898144291 0.64988265770756137 0.011796170101841853 -0.78198003859174503 0.93384963525343823 -1.0580147362442338 1.1128213334899353 -0.64074029969512447;-1.3084032378765929 1.1148303772018557 0.12661530151375927 -0.068089707462311189 -1.0910407318141961 -0.31047265071570113 -0.02414057388212058 -0.09895789769272513 -0.24856378768456003 -0.20286870018986364 -0.71339030223289468 -0.12748151808885505 0.4413070623965013 0.33823963006211122 1.0565933057594652;0.064661142509503652 -1.9088036686357037 1.1754255047258306 -0.17934818734226096 -0.6650207983503017 0.073839731060421993 0.342478579757171 -0.024786586797037928 -0.78741071641510885 -1.0360731016591338 0.18326199652904523 -0.0093280611354997628 -1.115174959750717 -0.087317292864124957 0.76602216240410226];

% Layer 2
b2 = [2.0813203660741002;1.1434767726222754;-0.041896501371430847;2.5399041615895874;1.5991586094462757;-1.9598562920054177;0.80529864987316568;-1.2947829867738325;-0.82998000261987492;1.7587408809294225;-0.25863287627257037;-1.0291959403935016;2.9796665978263737];
LW2_1 = [-0.35507909667153192 1.3654163276459528 0.22259982248842525 -0.67083420481089107 -0.066425493853223411 -0.17191106784524893 1.4443593856105683 -1.7384084454020345 -0.37148457766203014 1.3168779782989977 0.11491843995162829 2.0923632354782837 0.034265418131358513;-2.0556531427978566 1.4393614227809797 0.43039181687317196 -0.47406237709426985 -0.38353169818023181 -0.68752391578031247 -0.21969805265477987 1.3848414855143463 0.44502741279572561 -1.05480448556735 1.315205637562739 0.13282819923654426 -0.43768239899456873;2.0325857895998913 1.2526637036638597 0.72991057128481251 0.052969541098363548 -2.3074486323891863 0.51836832634656393 1.3846442321388917 -0.58142657272454268 -0.68652694892407795 1.3759266766414593 3.2094543846907282 -0.51198495119665699 -1.2626620772455546;0.67053613100590481 -1.3040649090204615 -0.81575768407933713 -1.3642124415667509 -1.0340330727599942 -1.8359858833894931 0.80003756881092991 -1.0816957406915511 0.25991926654582881 -0.21364242881698103 0.20673923332225946 0.96132134639276567 -1.9213260117532049;-0.44574298279174973 -0.2258746094733956 1.1916337708836164 0.63393221653340881 -1.6529305252619575 -1.7327583433500311 0.63419731918204025 0.47566790203027243 -0.71895771951266363 1.0830131645503991 -0.49718715522273066 -1.0661615270322806 -1.5012609043353662;-0.92765769299098133 0.43295288813664035 0.1786476917945356 0.32727246169253577 -0.99915317557236449 0.70754155038314481 -2.4484497201877016 1.7452027764396232 1.2338951449481337 -2.2584480985720878 -1.0037666143256079 -1.6420084831726824 0.33939658064788308;1.2571446713302155 -1.5713864102075719 0.52167966053160797 1.9264918478014719 -0.4488435672994972 0.54034095601236054 -0.55258430880179588 0.095475596798104495 0.74482915963524488 0.039536734573067805 -0.59043398615319831 0.33725801726817511 0.13148227031885246;0.44309398329715144 -0.43181041394543856 -0.12495919815538682 -0.22064464448937465 0.18178764556919888 -0.10831060355057134 0.34242687325954685 -1.4752992934718567 -0.57895803186377104 1.2437673823079258 -1.0617328093948899 0.77984439258804528 -0.17095404844139173;0.020705591832274575 -0.11118382633951376 0.33311104396109636 0.30297215576989039 0.2001336435846558 0.95294168105846211 0.67976682739251471 -0.021716907293672847 -0.22526288922198429 0.4340733868452496 0.077760995237187408 0.021609730569106436 -0.38059551499751676;0.56781395867751905 -0.65155558559052229 1.598077494515443 -1.0736367727451501 0.46755558987024404 -1.871288528165389 1.0901327342321125 0.73542101273853799 -1.0332112398071935 -0.25718497138644553 -2.8066845104989406 -1.3037580250821004 -1.1501430308037803;0.2236307897460186 -0.47639711916189292 0.19132918068131655 0.34178446423610415 0.11849368818820116 0.83347644046370362 0.13769233025546651 0.058029073826276464 -0.0068612107643313 0.14962909128955959 0.34132391892557939 -0.16728210322244358 -0.10220027205627186;-1.5551354057668603 -0.73464376888381566 1.0402447254087148 -0.39286172503723593 -1.1221553728957459 -1.7155884045424803 0.35581395354152517 0.20642280209330535 -0.19206647957442646 0.27527804196315597 0.014060833268692959 0.22912198838833314 -0.58635135664836979;0.81741374030734759 -1.4315880229557001 -0.1607501958273124 -1.0195794910317735 -1.5127826065639076 -1.2968938656833406 0.82083273826320491 -0.77154241735950502 0.54642741528225214 -0.42698814925829837 1.1160308220825421 -0.10765961150444667 -1.7366316932440822];

% Layer 3
b3 = 0.7150708195790636;
LW3_2 = [1.4293416367567142 -0.38697682534079131 -0.085851987657853124 -1.729130323357577 -1.0748058795248105 1.8299753078463228 -0.13070543518017033 -0.22716901166757589 1.6199335336413303 -0.30578094763623043 -1.7980957116408458 0.24867689948755947 1.8469719191068685];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
