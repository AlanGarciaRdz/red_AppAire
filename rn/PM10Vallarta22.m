function [Y,Xf,Af] = PM10Vallarta22(X,~,~)
%PM10VALLARTA22 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:49.
% 
% [Y] = PM10Vallarta22(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.12820512820513;0.00782778864970646;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.6957087020703607;-0.54338950836390776;-2.7004215269412382;-2.6066071347496655;-1.772755851881525;1.9546948459299882;-1.1674006795523109;-0.32561208825419785;4.5315215735803758;-6.039072697308896;-0.86172274053155606;5.5389034154890684];
IW1_1 = [-0.59797666921363546 -4.8818280977414776 -1.3383651063456921 -0.118526681017772 -1.1255919902681373 -1.4595943375000391 -0.54587963187818844 -0.28846436848682228;-0.57096591121902951 -0.12156938013074736 -0.97875287888497009 2.049380371367497 4.494533853296983 0.56947391921464674 0.53265743438198232 -5.3945188300874891;3.6404501126198761 0.4103351611983041 -3.1187848897342469 5.0093915106511773 -0.052845263427270806 1.5531358802510886 -2.6341641416113544 0.60699771392809976;8.0161265606047287 0.66290041460947746 -3.5611076420419621 3.0140827712794684 -2.7263719318603057 8.7881979871194549 4.0908809347486539 -2.6394207363600897;1.1058542917006022 0.051508266262420041 0.17739316247629916 -1.1461856277715348 0.11810718817208925 -2.1396061498006134 -0.19210958241568024 0.29245624566525447;0.6590369272255997 -2.8370351229020536 -0.15190976282287239 -0.11508218203267734 1.6521511126438664 -0.97121160065946921 1.3561663654830696 -0.55546122350307769;0.18388985641310948 2.5815846160859737 1.1890625337751928 1.0611969434546746 -0.99227748171807884 -1.1753764138558069 0.18518524908040332 0.62416186018791864;-2.287138515974962 -1.6780245741044415 -0.39605818223263917 0.029119238846997009 0.34276487453223753 1.2801565633101879 -0.31286362566986609 -0.51245757765957933;3.1965519065805745 0.11575322676919486 -1.3851591014073401 -0.71077921505583985 7.5234433876877338 -4.2372255532792735 -0.0056697289130534173 -0.17009934811678373;-2.5023332151946742 -0.1629312074571885 0.34357336887605233 1.4376234260174861 -2.6857813236356356 -1.5795198899535932 0.48264444131194723 -1.7860929281788769;-0.096785321017171994 0.027810972894107021 0.22189158937324038 -1.1447777287142182 -0.2517659506418114 -0.25314137570420137 -0.16734705461153981 0.012322842692496574;2.9146012451814145 -1.6904878969825059 -0.60904593930794582 1.5447126103178535 4.3492595507156864 -0.76143924033330257 0.080972996834851624 0.21534278202961929];

% Layer 2
b2 = [-5.6621248393135968;-1.1405438565894275;-2.689637919048689;3.0556521060278024;-0.17410136486145844;-3.7473647184142078;-2.5669737870843616;1.1791306762387184;-1.4224247146959994;-0.49715025156023485;0.60883305683954037;-0.45478541798000033];
LW2_1 = [8.6131217367847022 -1.3974848834722395 -1.4823900767848608 0.61884720866831322 2.3186564036241184 -2.6250262720564854 2.7324232485527018 -0.87431090424358315 -0.066261954200545398 2.3698794701172647 2.0188490981017768 3.3853646497690901;1.0010581142579578 -2.0015383415913295 -0.92853670886946438 -2.609998078772271 -6.6683767445896773 -0.4586484291501024 0.27513017183912286 -1.5042833773190336 0.067688170256088503 -3.5835473656509702 3.161491641318523 0.71265888449327641;2.562516328774449 -1.2025751511466598 3.0197087277753507 -0.53313670195421858 1.8808638986000872 -3.1420894456424353 -1.6144388726492771 1.1309926060736228 3.5057260676078594 8.44737360310687 1.2767343489073872 -1.2115652875639429;5.8753644454797991 1.0437858508154712 -4.258101081154634 2.0765279441893743 -0.59775097842978941 2.3947511686137259 6.3400789271569211 0.1831740918782408 -4.1746519688028298 5.4263564957139696 0.80541912883989797 2.5834014030078389;1.0003826932082198 -0.13933419443966893 -0.44021413946174798 -0.36093373957744196 -0.58754451153129339 -0.20451428126730209 0.29390108989525771 -0.49817383339853466 1.0187717669939762 0.23488879119703118 -0.26038308208268168 -0.74591785894834017;-2.1715871319803304 1.1692934371261814 0.3804228006300226 1.3245610590312091 2.9719526329454391 1.3328344631725559 -4.1205850485068556 2.2959927548916208 -5.8530283083286836 -0.13526684301309067 -0.23323695140477901 1.0695359043204324;0.087347456630116588 1.4009326548316843 -0.11212989292814848 0.17810710015855735 2.9104488991239297 -0.57025458800478346 -0.3592507690861283 2.0181123896404647 0.65589905717352803 -5.4335161546827671 -3.5754328274786551 -1.466338138181893;-1.8579642415036806 0.98087813218380238 -0.71294909219847646 -3.9924076114489933 -5.61001913690008 4.2700873320704948 -1.8077370505326564 -3.2010118603676179 1.494347974404286 2.1357355417090598 4.9029854297789521 0.16288143271796182;0.31657231215996345 0.53568232579647623 -0.21477090913388813 0.42094670313695592 1.6537066139532604 -0.21458308051177724 0.11354468378818677 0.95554145025397341 0.014620792578129392 -2.6032418903590679 -1.6453943954923596 -0.45131482768207115;-0.47353693271041519 0.20061271923630261 -0.77900949433075295 0.29039080862713745 1.6725133221754829 0.47382945619315642 1.0662187627472557 1.8402149563456347 -1.6605003249134103 -0.55936084210258463 1.5173217119357212 1.8232891803083093;2.7312777527400218 -1.4472859038508443 4.8599635166837789 -0.60460785440558107 -6.666481260478629 -0.47969197821577408 0.56125965852867987 -0.35723440939754664 2.4151945122963241 3.6548489861185214 6.3023465723048542 2.8070002647116437;-0.087871815268752207 0.57423126838027205 -1.3596593703500646 0.33321687113011533 2.3991268625195059 -1.2048533210067611 3.3059017295766955 0.53061215525937733 -1.2987369002407196 -0.73985408537529651 -0.50347939161317079 -3.760116557845675];

% Layer 3
b3 = -0.961581227051444;
LW3_2 = [0.049237870559853812 0.29540506465249888 -0.097994186403326758 0.041433194945814454 -0.4712695132180526 -0.080806216926040397 0.2827694189602098 -0.050863190519086728 -0.40852773279017301 -0.12573794618676934 -0.088790108374641408 -0.054070299076568906];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
