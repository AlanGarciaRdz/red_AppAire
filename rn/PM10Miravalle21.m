function [Y,Xf,Af] = PM10Miravalle21(X,~,~)
%PM10MIRAVALLE21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:19.
% 
% [Y] = PM10Miravalle21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [-0.62139797647607542;-1.9063580375334241;2.8368828487483304;-2.2080503993522491;1.0434672846928865;-1.6603413930012185;-0.29229157775720421;-0.2241338560088742;2.6329830188756214;-4.3487911251484892;-1.7165841222436597];
IW1_1 = [0.72748096217214331 0.69023453775883559 0.57333016090532962 -1.1047366698473127 -1.0380917633614881 0.24377563436387009;0.69430560449332757 -0.97718878233646911 -0.41531644036683496 0.87560222017569023 2.9290900843813477 0.19076872887310267;-1.7805377983370709 -0.69413328723201306 -1.5946174340671313 0.49536370306138222 2.5231060163573402 3.2690810741973575;0.58558143202682111 0.21052307485889349 0.0099585869815760533 2.4338521288223132 3.2091313201490865 -4.9436724754989694;3.192925550759397 0.019819309266337012 -0.26167193036605918 -0.72977359448853296 -0.7872835177971228 0.15417659848549631;-3.9463451981692694 0.33491146374851594 0.95054729014753836 1.8017680782937955 1.0536235637167655 -0.040760978459881164;-0.5019076972933828 5.0817996047222458 -0.091180772775921473 0.76670983569419948 1.9720768187626494 -0.29955130004216635;-0.79999729147447662 0.85326684906114703 -0.092532407356584731 0.82669745281083684 0.46718920025283661 -0.12478522807906749;0.91377147502227885 0.067767371336471857 5.2309860622079274 3.5253069330702287 3.4273584105107102 0.42019741458350462;0.80939549022284019 0.9946719758233098 -3.1308623136793376 0.89285368811878496 0.53991658203984227 0.19794312926352919;-3.5572191033586469 -0.020988753091510381 -0.4013643281394989 -1.1194945498882296 -3.2970935635371785 0.51338492289382154];

% Layer 2
b2 = [-9.1046925668940677;-2.4121271103223609;-2.308917637110437;-2.6180701234695554;-1.7712372531760436;0.43243115939436505;0.25493726218383367;-3.6904557597662153;1.5471781306207886;-4.3982169772606845;-6.4694307977559475];
LW2_1 = [1.1370646863480565 0.66481784152813583 3.9347391289516129 0.39178605068995842 -3.4266040782510503 -5.3406601568239429 -2.5311231793654509 3.9062902507362161 0.76667487641377974 -2.1851655801768306 -8.0866819477559417;-1.2205784141787885 2.3676815656858543 -0.43965979360834634 -0.23369668081352565 -7.0617009619856699 -2.1598081379583043 1.1097606794784181 0.076369147412022692 1.7105070037735171 -0.96456327795047714 1.5541571596093435;-2.1507125370030202 2.4079601003017759 0.48207733282477144 -0.19132790452448403 -0.23367949936395049 0.083602070590718419 0.38354581178599545 2.2571352363364703 -0.91502819854143702 -0.14893339764020355 -0.241048246249912;-2.2413669938123464 -0.96281491244331108 -0.30150022404195786 0.10027048985667041 0.9525740208452903 -0.050214214680134192 -0.31345905245831129 -0.15966634964283283 0.4890507304524504 -0.70388273674227697 1.2641941093698594;1.4496943193555472 1.6188911070964196 -0.047727408246731613 0.079720252027352306 -1.5821277235439284 -1.8312857476884119 0.37152513333122678 1.9895037140983578 -0.39617739800892393 -0.034396221571976533 -2.0495192036817671;-0.70388392401222244 -0.86286785668621802 -0.28213493153643648 0.38431912359844483 0.26737961574912983 -1.1264935901539126 0.1218932108482403 -2.4602247250625111 0.85566029156387502 -1.2139069980802355 0.58692624115211689;20.182484707603379 -16.775689703819353 0.18906664808987189 4.6413154733175128 -13.275002293679576 -7.6792809528591963 8.7528794432233052 -4.0091294019168355 2.9107054726115598 3.6185419117675495 -0.59742834694938241;-3.9026526593580617 -0.6706883816624708 0.55291152280686351 -0.14184258987223858 0.90263687479309906 -0.31805237882123161 -0.090583006888099671 -1.2076001846431712 0.086189508594283162 -0.94847560217430738 1.2781635296206821;-1.2993885345128939 -0.10106911059029072 -2.1805315986497904 -0.56347735464863713 -3.2481763697302459 -2.3586207841553493 0.30977990207797579 0.44238081921392403 -1.7424283072544655 2.7340183261877922 0.56631187197071697;-1.346441965463667 -0.07541231762088195 -0.73386039365968581 -0.52224272268306593 -0.064211020160107657 0.55921494119815252 0.51972081080525168 -1.1152616006402101 -0.17157722180840021 -2.2307541606704819 -0.33930872144190061;0.69077301875797648 -1.1742933948528185 -0.83881455926040438 0.23218105812429152 3.5898391878514309 -0.031134232442492485 -1.5792461966712403 4.8364681773761946 -1.5673479701847266 -1.1836264842466631 0.64113375736095368];

% Layer 3
b3 = 0.56237442692841055;
LW3_2 = [-0.078950452002183549 -0.090790127674817769 -0.16742496942271548 -0.1649177123155991 0.2001602292687962 -0.17559120132723685 0.019811998905537503 0.16681245912806353 -0.070141694056297943 1.210005015468864 0.17536276811755241];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
