function [Y,Xf,Af] = PM10Vallarta5(X,~,~)
%PM10VALLARTA5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:44.
% 
% [Y] = PM10Vallarta5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.12820512820513;0.00782778864970646;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.9817970689609732;-1.3625410539046212;4.1487048466658356;-2.2790245690730071;-2.2225182237440704;-2.4897231621696516;-3.3516980269373917;0.84261801788449719;-0.54731410618069198;0.74565498341012193;-1.2162623334219975;-2.1419627232899177];
IW1_1 = [-1.5222693962714873 -0.14954865650668614 3.0558956466022593 -0.054179416164493135 -2.5896194910158608 -0.88613612792120566 -0.24215258319893618 -0.28157772141149101;0.67835024730259008 0.15858351941519586 -0.2666786965100531 3.1762280816648039 -2.1729870510001987 -0.40075791556053553 0.15374396452857739 0.51761588156550098;-0.8139624912264366 -1.3473357435170428 2.0165479505809611 1.1599735142155954 1.3053014418529352 -2.9776871599307122 0.19090529162151723 0.67639102126700013;-0.78650897515832741 -0.27621607837044354 0.21671630594910557 -1.1450159173134757 -1.2736243920998391 -3.3300015468282851 -0.0015034011935585916 0.38268797079332401;-3.8165103126753426 -0.57685287574305211 -0.075751508539585705 0.33097771469776127 -0.86002113114807355 1.2461785430280092 -0.3431590108642682 0.78001807437112769;0.39517279667384281 1.2495222186005577 -0.13438937856154806 0.048331547705577668 -1.4683148462651581 -2.1084504742477588 0.4790252473653176 0.049014836772331656;1.8864522009608902 -0.47263661500739501 0.23569098560689089 -0.71167738104058997 -1.1698387620276263 -1.245715492665413 -1.5817758281240226 0.60366869204824691;0.70275688898574651 0.32568724550656158 0.13369059932322555 -0.16931889639684181 -0.48913333281994537 1.1323608484889227 -0.14523476529227666 0.096905275714470357;-0.86890686853316756 -1.030443279824208 -0.40005774310622277 0.66010663648525703 1.0612276947247843 -2.0654389858094588 0.09029892345055146 -0.37250256921146307;-1.1374752191415685 1.4080509377827708 -0.19770510935801433 -0.62093275638783529 1.5220490323877331 0.25422439905647454 -0.5419293632793748 0.1554703008646354;-1.0231894671296702 0.55024371060531896 -0.077805126501123895 0.2817602702399038 -1.0894712129706683 -0.52377022899185333 0.12725861698104418 -0.085986109462550947;-0.20957009059725165 -4.8538748195903869 0.16419328764813035 -0.11881308858277138 1.611350793434613 -0.82208151192627565 0.16696542755977389 0.11131307429406599];

% Layer 2
b2 = [-3.759249922173459;2.3705959297542161;2.0302674830804568;-0.94864511662244899;0.93121111452580674;1.0826436381196571;2.771487549582119;1.1476411502001516;2.1182521140190484;-0.14768947370368482;-3.0411808184768621;-1.0636659405418452];
LW2_1 = [-0.15658322697149185 0.86698946358499618 -0.75535081626584266 1.019249394741536 2.7375240255738484 1.3435015091752258 0.037360284522337139 4.5540899815703968 0.95360954247080687 0.21866743985091613 -4.8239136861534959 -0.00031419899263762045;0.64613727220479922 0.37100072794149208 -0.40948418362470135 0.67465954214035051 -0.0082748251519116495 1.0924489756089892 -1.208497814950976 -3.7069060783090424 -1.656822951499846 0.8096779002492277 -3.8072220969998845 1.1491198643428895;0.59938626944335061 1.3259819142040623 -0.68232738931229464 1.0440028340770602 -0.74875302497185336 -0.66281930072581197 -0.68471302665295763 -1.7743933608839277 -2.6886271418150072 -1.3055801912442155 2.5602960344053156 -0.0035130912272566227;-0.37966658758418559 -0.85376804390774053 0.32285425537268436 -0.32122724757540289 -0.061852611405302266 -1.3279818802916417 -0.10996331119560282 -0.65953708544665801 0.34281134760742749 -0.69757198184154667 0.98541078421306627 0.65958173217429472;-0.3299350346369066 -0.051181633130257191 -0.11983325801054265 1.4818015378846126 0.19518410377550494 1.4421902554557835 -0.035956817285593745 2.7531141335797655 1.4280302934507907 1.3946747915721844 -3.1746466820397536 0.069839232505874413;2.8482527108848732 1.2858553378875108 -1.0993396009258436 0.65789058027301128 0.020090395407881972 0.038209996767291241 -0.44342558063007359 -3.9369944837148689 -2.0593158547788861 1.0291495672489928 0.11358429136933909 -0.37804208510753878;0.086939731687184302 0.10213040091637399 -1.879561730950901 0.3354205800487452 0.21406306244041401 1.1627845558564716 0.40628496056345065 1.0913232098979826 0.051632209880887361 -0.12693122780374649 -0.9271840449580675 -0.61302167371847505;-1.941427030583335 0.11004006968288918 0.3875676205272176 -2.4107678109785775 -0.72228655706857625 -0.91424903491813414 0.96952775538161873 -3.626045305787839 -0.49616309644867324 -0.88570664337232963 -0.75326055079859122 -0.23366714431816846;0.37668575590883002 0.5667979768774557 0.90694386806371319 1.057929824576856 0.22180670786376561 0.7294393192195141 -0.43004578421830297 -2.3304372533175837 -1.6399995982039284 1.4913808020969326 -2.0287740683042177 -0.051210243520422388;2.4423485780251775 0.31731993582956824 -0.47557599479573126 0.69463224262827128 -0.061937910384157378 0.36003621229343918 -1.5494804220223615 -4.0978707042712337 -1.9427649443412911 0.42680231377050343 -3.1452108043204072 1.6305860981528881;-1.5678712672457755 -0.090926897276518717 0.10831490873778468 -0.19935113833130186 -1.1400492687760848 1.1020123607379329 0.46744871067935873 1.7028473087656748 1.1884345321988568 0.1622718795698018 -2.7808814918944318 -0.28593789749562631;-0.15185499282701717 -0.55264413345237617 0.74672202118077646 -0.41330093901751036 0.1230967485712348 -1.0006994357742713 -0.10128541576552856 -1.2448577095731415 0.19813554195002503 -0.59563248798298019 -0.10564871223256782 0.3789812280862343];

% Layer 3
b3 = -0.70095127096849363;
LW3_2 = [-0.85864917113776651 -0.45779079375240972 0.6121399539845912 -1.0573586949520284 0.2405285565981802 0.41286491919421514 0.53208300870877701 -0.28245133369639741 -0.8452228363638894 0.13130742948313198 1.2263374905507574 1.7084255720406012];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
