function [Y,Xf,Af] = COMiravalle8(X,~,~)
%COMIRAVALLE8 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:44.
% 
% [Y] = COMiravalle8(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.2345599952244781;1.1233215750434278;4.7456831857075752;-1.0870586425405906;0.08255310965495842;-0.11595712568699486;1.9986932878050025;0.34872283978155683;0.8510003086635376;2.0774846796333146;-0.81647521111111876;0.20361777053908311;-5.1593987249818314];
IW1_1 = [-0.61218998249286194 0.88853844400049364 0.10103213697101779 -0.015254015709461315 -0.21110141748575428 -1.0192656881742852 -0.00028607600082568383 -0.054545137857672892;0.040276321611888016 0.56452898234789139 0.63010490290651389 -0.33459704444450855 0.56441380795547191 0.26304782327961435 -0.24327785349407785 -0.34639803825439885;-5.1992417672986981 0.46559202699289004 -0.82152347223047772 -1.3621602386677407 -0.038088778014527466 0.78099887974865023 0.7496755903201896 1.3315846022425686;1.9730749988537974 -0.22367597398981764 -0.78192674292838238 0.20602574584150829 -0.14561683779693102 -0.05380674146114281 0.25901503732749109 -0.74583943321400592;1.8494531040121081 0.85846868164195334 -0.68335920736407663 -0.45460388227445508 0.24026373454372935 1.5603998701902102 1.047440275491669 -0.42924614869582145;1.0831581997876518 -0.93729857451481413 -0.18773774245443606 0.022402843713612161 -0.039523831910137933 0.31844330895637857 0.19022794960478867 -0.38676334372427917;-0.29840983840510232 2.3215932376353376 -0.053257793878707479 0.097232509963661604 -0.29813769226189024 0.26112845162065479 -0.064331006944629746 0.31309072642825053;-0.40762069576886678 2.2685825788071168 -0.1837874143305267 0.15595713633090907 -0.49162024152594214 -0.4918634367003889 0.14522052906846791 -0.24582180042424925;0.42479176050468143 -1.3131181931535685 -0.16415221336863745 0.013272390599192132 0.10449406117894421 0.16351705109271317 0.035807464603662603 -0.078229812530231799;2.0039612799595754 1.2632051599890088 0.074955373981940437 0.17280744609460336 -0.045072394109500404 -1.3094549101225528 -0.19521089940209668 -0.0064754486307674556;-0.041266956863709806 -0.79205651686489487 0.054926444984483611 -0.034344693566303888 -0.7551412065437777 0.48799651698495461 -0.24185139454667895 -0.15639823211640522;-0.7608611296766904 -0.87025778257197128 0.018352937660179952 -0.076772646848946843 -0.59364437286756178 -0.36756633846332115 0.090181450552562353 -0.0048234511734310467;-6.8606677602727588 -1.2441514271882719 -1.1436232106429554 0.6357214772552251 -0.3487074722650858 -1.1723931975597868 0.1645510726537886 1.2855088097390928];

% Layer 2
b2 = [-2.0749804187292558;-1.6659090177564488;0.7232368133915219;-1.1513044257342442;-1.9426708885538277;0.12139685061201425;2.4774710649946021;-0.36520719476818891;1.1885854842194647;0.63802076154020904;1.7710105059976566;-2.1975030303768657;-0.011406680002444436];
LW2_1 = [3.0378337431277305 -0.79301992658627984 1.0419860872922593 -1.0974955974000944 0.5182123596007856 1.5420375101069288 0.059223445492690693 -1.6230713300612196 -0.5183382921860854 0.51829470137077116 3.4005958345104168 -1.7295360741103945 -0.8378206588787056;1.1356319515849036 -2.9973810045163183 0.79926926867057302 -1.6025425566330527 -0.066921642139319948 2.1534269186745219 -0.1852494536608712 -0.94131471020666924 -0.35278593963311411 2.1364940112583981 -0.0061156879234800683 -0.56343103828071495 -1.2800505606299692;-0.38246304588449409 2.5860142868570151 -0.75647388719143382 1.72077081940742 0.12572750351299569 -2.4859871946136316 -0.037008369777167219 0.8764720008083331 0.82289447438625529 -2.0340643955241928 -0.29026487017094998 0.44846067082035568 0.81659692384544025;-0.25235512682793781 -0.50474591168540606 0.51601684760985889 -0.1248741223867145 0.080594697042960184 0.036042286790325048 1.2959219390105148 -0.69260258444673195 0.14218822673581838 0.84717332720018645 -1.62322039145591 1.4216662143493934 -0.5110919176491957;0.34255344031943469 0.35310929575103972 0.0046340080135779532 0.064247881235270449 0.65164561529007237 -0.3521579437440146 1.2281713981450486 -1.5212503103252659 0.76842089284038917 1.0861174837552481 -0.67814916410222803 1.8678320348853723 -0.11552120336537143;-1.3291001459498726 1.3571598208845082 -1.1882570334095894 -0.59033824270319901 -0.37255952649841467 -0.93476962742643921 -0.21443828538241483 2.1851822890186368 4.2496640596022708 1.594382083326749 -0.42431842924556418 1.0817438242841948 0.20784495164923319;-1.2867525228369883 0.72720890141878458 0.97428188530300319 0.74974957810204146 -1.4954282281686595 0.74158548667737756 1.0266513430791921 0.51174621936569897 -1.1862435341070208 0.27623238145794488 -1.5040071948670428 0.66878069361344938 0.20078196757426808;-0.90184235878303753 -1.4050911218591029 -0.66669420648647082 -1.5765679665950076 -0.27094507313814076 2.3564096063213569 1.8370571644913654 0.3783607389708733 0.67227554990450489 0.32500124023450339 -1.5037710609258732 -1.4883682875611457 -0.88440476786742417;-0.78008690634580791 1.0774781563753799 -0.11352081967292003 0.33635171515067597 0.387196036816011 -1.5647655194921386 -1.9471839179442605 -0.60706663290038965 1.4954356157668061 0.61146805328067 -0.53907232901337798 1.5452740765601498 -0.058013693010866486;-0.58074387389123605 1.3425668744475552 -0.77014592411040805 1.3656312211164856 -0.15405770738371471 -1.985008464544149 0.068860290887015799 0.9031167912889595 0.61170922843109388 -1.4435481167905309 -1.512893411502171 0.6337157350323529 0.31638277501373735;-0.2068167489805208 2.0793037196555946 0.72426077414430057 -0.27539435023699826 -2.661657440475552 -1.5810528471681411 2.5686134630859323 -2.1815070968939523 0.42254654030861866 -4.121657126361038 0.17018605581289814 -1.9589158437779799 -1.3366891356049275;-2.698539034370973 0.65836178909062104 0.096175382494567738 -0.13544448698912465 -0.94883513564107924 -0.79751685270400419 2.0167656400930372 2.3060327437700208 0.19377025232265915 -1.1488921980614535 0.49850768175169413 -1.4831609766488687 -0.10665777432695982;-3.3857923837625012 2.3372439445488502 -0.47900137442192098 -1.1034432935690102 -1.6024590719097087 -0.69837366986782778 3.4117346412399581 -0.45154503057355438 -0.84649215327319538 -2.0224924782445535 3.8698478162175687 -4.1619107813466814 0.18804258501240684];

% Layer 3
b3 = 0.26387930366824219;
LW3_2 = [-0.41876585369471098 1.9418829196481071 2.7007563246771973 -1.441989973366401 2.7398682524216285 -1.5806453263737108 2.3306710375973902 -0.19300865458548638 -2.1798779731639373 -1.3600137756988715 0.17126438752069739 2.1592201768866737 -1.1638072623666362];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
