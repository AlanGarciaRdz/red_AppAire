function [Y,Xf,Af] = PM10Aguilas12(X,~,~)
%PM10AGUILAS12 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:19:50.
% 
% [Y] = PM10Aguilas12(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.4438137980957828;1.3676336422828925;0.7180857847963672;0.088643082350650354;2.2799201491136309;2.6196121964292352;1.2892636470536256;1.4022959337741268;-4.2349355423484614;1.4014577632969007;-2.1853971367363427;1.4485879462392259;6.4774766020199204;7.8748057966941376;-4.0286335710183305];
IW1_1 = [-0.80926705010671174 -0.98194775623698538 0.32370812783087777 2.3993427207578475 0.025697483535745816 0.4410494240799368 -0.25661561777045655 0.71449947167105587 -0.047374511303088562;-0.75438993620873129 2.8166239159242497 0.19600106043064397 -0.19149557679893775 0.12681575911737386 1.6906327643959174 0.40329944981279081 -0.19186307608154587 -0.025767742581646755;-1.543780502205834 -1.3504018293995224 0.66019239659902729 -1.3525321844493763 -0.40737965905285095 -0.20601112758341453 -0.74519331965717961 -1.0380712011249935 -0.22690229595706948;1.1399245787863008 -1.5617584308061296 -0.48368359244517634 -1.2802473323014869 0.43352241232741739 2.5790918191223424 1.0059117419770878 -0.16719102081036941 -0.23488290963244379;0.064787424563027288 0.13480811503000717 0.35759146641010264 0.73686333841465357 -0.32863234447539691 2.3493357539823294 -0.35581067284746659 -0.36020464279241265 0.32079050039492862;-0.32350549052797584 -1.0549151134187378 -0.25195940852748433 0.82939116221289888 -0.46228075200159308 2.6788865109053699 0.33239394666065375 -0.01726337600189793 0.089326038318088427;-1.3459448238672194 -0.21218543405210818 -0.31463387886743832 0.37081158196280745 0.70816427387061454 0.70344255427451308 0.27012102179580944 -0.75818738960548426 0.092274859545723856;-1.0551623958833392 1.0934787715941838 0.3424030766559083 0.25900062903468707 -0.37905883643049598 1.8005422496801069 -0.21992391884891196 -0.56707848602974897 -0.51308607277881546;2.2054232376313667 -2.4597997634068722 -1.4333070489001711 -4.2434657848924919 -1.9033885951290617 -2.7106220019860219 -1.3301146366908405 2.5071187274320601 -0.95442995985614665;-0.58708767959745178 -1.2157833914061966 -0.56510414929938713 1.1455401461784551 0.03966858498805878 1.8740263883400172 1.5910711719445163 -0.18363232472047869 -0.17126941151764671;-0.94584671278915333 -0.25446790866221014 -0.8212268606705958 0.97611791404674064 -0.19994942980922548 -2.2735051213367958 -1.245687880541674 0.99820023969790683 0.4904692428698737;0.50946423838142629 -0.20937218631270413 1.109529390080596 2.7656518693318559 0.95037959482312362 1.3323380007966286 0.91250435885502801 0.86710440006431755 -1.1374825492485623;0.8385328434069852 0.57404432578163977 0.17448437534594827 6.663358344813326 0.14854492527668733 -1.2974608202002322 0.14357741581491221 -0.1607395216628924 0.13983476021931165;1.0224395288230701 1.5540945328026579 2.0194660202623251 2.4774222701335864 -1.3499278346691204 5.1006414845768955 -2.6014431750672622 -1.3328059907293375 1.5949116586019196;-0.061987698716377146 -0.36637093814690991 0.41654642086185145 -3.7673840934187508 -0.65024867906744099 -0.2998628287034229 -1.6366385436302044 0.35491395836766088 0.27264014698065603];

% Layer 2
b2 = [1.067354759153885;64.289610082059298;-2.7858234058086384;-4.5383462827550476;-9.3324653347087754;5.2299259817894379;-25.486286543325633;3.3283476880645426;-5.5516550462439413;48.6811815096506;30.656694512545524;-8.4176976947976581;-11.301482138369987;94.619732600244845;2.0581975989324954];
LW2_1 = [-2.7759730643331788 -5.4643565254565818 0.96781329456048371 -6.1393405119421827 16.63663155928738 -14.669586465155886 -5.7677114064786759 2.3041714443197208 -0.12648324200505282 9.6304777239843737 3.4304371693615927 -0.37304452830106594 0.46174621392418158 -1.5881714023775464 -4.9149981815065802;-7.5973897120638378 -14.664566915524782 -31.829925182431111 14.11317962912166 -19.711282863983676 -7.3304080284197743 -2.672680646566068 2.5852822315643578 -61.154986675164537 9.5201410598127438 -0.33382116387835409 6.8242976727288394 17.152913936685568 3.6025434490307315 11.702301819363688;4.4175872423835223 1.926209531862753 -1.5772543302921642 2.7338030814694441 -4.5925317349766388 1.6161798066601514 2.3295742116359857 -7.4424865792625194 -4.2250519301204994 -2.326070236989195 0.30743573103461841 1.9267369532396375 1.2777142262679624 0.098779570296475078 -1.2496225865034027;3.3139481079926578 0.062043621102587404 -5.6552596518259763 5.7376414547501602 -0.002097170286169717 6.0137937982285896 3.2870838054526885 2.3901709650350869 1.8008599993184637 -2.4528318642513272 1.5999400123342109 -10.324147568653387 -3.341224867962274 -1.5239772674825176 -9.8836946289622194;-2.2405517274569524 -0.4533927246926317 0.15669005364853333 -1.8958572624912675 -5.046348552749607 6.4707135315316942 -0.13454155733156373 -6.5141786743737393 -7.2309808727806892 -7.141580785536437 1.0378801563394735 0.16924355122068926 -1.989556606119798 -2.9584561022244307 -10.129457940871061;2.0213836923769577 -2.8337901238388832 6.3047193822681376 5.1250702441169516 -6.2407946968766952 2.2714130322355879 -1.9293154421686882 9.6137571023933788 -0.073713573436576849 4.4791112230431764 -0.01950921792260641 -0.79825678697130154 1.8092900401953438 5.2565258452431447 3.8549017638958993;-5.799688302469451 -0.35834946796734352 0.055773918500403877 -3.0318523940104161 7.1124784990629282 -3.1664666863243953 -3.4029809125724895 -42.862417159231654 -5.5856253556876201 6.386411396369442 2.6785727128829513 1.2705592844335891 -4.3936284580524561 0.51453972190227082 0.54047218065570768;-1.1059275443723593 0.93180148174366229 -0.059597437223386382 0.24265200879823889 2.8915021112418557 -3.1241066849695103 0.64256807013463801 -0.14568642836922027 0.71522225358482872 0.54810216339179219 -0.71815756927786512 0.22283752373729993 -6.5755261965723983 0.29506417216025926 -0.23943632396409667;0.098053067923732293 -1.1136062972100496 3.5296053818770128 -2.3379219662899353 0.33438128834323932 -1.5787581424989785 -2.791991074912429 -1.9727454029794718 -0.47465149614239344 2.9804395430560509 -0.71627814114820609 -1.6787334459383267 -0.3474588905760837 0.4179193629342623 -1.1845813466852597;-28.619878943844789 20.376946881003828 -33.244611912592774 -36.366386820139319 -26.322586044647675 83.52494792849447 32.314383558663131 -137.0170703311141 -10.474897129874964 -13.319963356722109 32.016283343485483 25.996617787917941 -46.5799477651817 4.6548450240058248 49.936307235457946;-2.0617332868280802 -15.430492484824816 -24.523578529907095 -10.066246242372932 1.4570891848561447 5.7138928865956737 6.1525933655633152 3.4200046356866594 -16.558367565467119 -18.13579391743362 -0.54751263723326227 -13.445461998671489 -31.524163435198467 -7.4513737428766911 5.1354952677997625;-0.5089679967042503 2.698409037909709 0.98444859969125265 1.3818425670324954 -5.8232497169602944 -3.7190921280061033 0.56606265765383079 -1.0759629382312519 -1.6984583456832658 5.7327206704633911 1.3241439436508617 2.4997091251637276 2.1765483445038352 -8.757340888856211 4.5636046555326706;6.4442711415576666 0.11160767843288623 -4.6349226793877421 3.5614588675488035 -5.5854351281256944 -7.5048395746747447 2.1692415998069645 -8.1854487489998533 6.3197145055413229 6.7283015802604735 -5.272778238317521 -1.7215425914922386 5.6825879292373296 2.4085306522423386 7.6033048649762831;-43.747877387386851 -22.097621892083808 -51.238975723817568 -22.921342580932784 -56.001394416510458 -15.226803850236063 -4.3288806561616981 34.364243653986044 -38.336261569871255 63.020436158345078 2.6427754132698431 -28.928894530984486 -29.366946719609665 -0.60777802506190282 33.224928596821911;1.0538500893675287 1.0581306026940029 1.4678405607285445 0.41652298348020028 -5.4519560139298155 3.5823507111309332 0.95220649151535763 9.5744659127149951 2.2880946636556696 -3.1010260136387542 1.5094599237567208 -2.5532350237620509 1.0107919069713849 2.0329562280218401 2.6600422053577808];

% Layer 3
b3 = -0.73581851732350578;
LW3_2 = [0.12651398887947227 0.015415889415098864 0.031989395513091524 0.018822919928359751 -0.038196950606029713 -0.022678282970169088 -0.084012182147102613 -0.095485999430545851 0.12230727008565609 -0.0081844153190080808 0.011117621842755037 -0.037973867395182083 0.051344997146679665 -0.030847360755905592 0.075361049917673423];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
