function [Y,Xf,Af] = PM10LomaDorada13(X,~,~)
%PM10LOMADORADA13 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:11.
% 
% [Y] = PM10LomaDorada13(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.290275761973875;3.96825396825397;0.00572573718866304;62.5;0.00462534690101758];
x1_step1_ymin = -1;

% Layer 1
b1 = [-0.76155444304461806;2.364837366212162;3.5195645193362051;1.5201893938177529;0.12100185900585457;4.7865085388570101;-0.044404184745459825;0.50501134170800888;0.09862566094481684;-0.46968398077379414;1.8031687883010119;2.9142361883875396];
IW1_1 = [-1.1703103831545199 -0.48068454706905833 1.0051036435708833 -0.70418457159187453 -1.4744685198421486 0.8967284426200417 -0.34613318868598303;-1.6271855238913089 2.3901826251799894 0.82629463025429473 -0.77492239363484283 0.32550735273832521 1.2644620516434761 -0.1251578428702875;-1.5798147636217266 -0.45543172112450464 -0.93414312578972414 -0.72066935332509008 -0.54379751332456883 1.1081928124023122 5.7248235956283233;0.25505878520674874 -3.0431153357025122 -0.9907806130428134 0.38326594720323476 0.45534228689281603 -0.18249519666366221 -0.17772415582248963;5.483960895738722 -0.1504425759326749 -0.05354673961107774 -1.4199979673227223 -1.7349229122647256 -4.2176336826189553 2.315235786329001;-7.0627606649707477 1.1086096203102187 3.4834713493938749 -3.6793861548718243 2.0191602016772059 -2.1673389430743186 -2.1996463428688338;-0.62681538634477207 0.34197417139644626 0.41375877330614419 -0.37505663027614461 -0.27070286061692245 -0.057532860881438101 -0.3235585692791158;-1.1574313936533289 -1.1583388232060021 0.039593152528600968 0.27601895968938001 0.21575573091501635 -0.65136945491274079 -0.29181497673764084;3.9769353045420806 -0.067235527136661338 -2.8271281144389464 4.5367563658345489 -0.55912419151519299 -4.6933322500912764 -0.29945898250073688;1.1283286104941781 -1.3066986193893904 0.79556717515595743 -0.22058662784496197 -1.691289150170457 1.3239923317861817 1.4669166610328814;3.2096723144572663 -0.08838482125248652 -0.21554564732213519 0.55176252700075812 -0.9320208373413954 -0.27616414024758507 -0.087104684846617389;-0.21342528345922473 1.7573156342226912 0.22358018008512306 1.1376458077938181 2.2155943920118042 2.6030160232223918 -2.350446924264217];

% Layer 2
b2 = [-1.6904854226561907;-2.4111595661988749;-4.5338362222521651;5.1788034727464005;-0.41852245523905124;-0.032821960481724574;-1.7912015862431405;-0.57508228408253603;0.16679686171164895;0.25658494506502183;-1.4429983587802944;2.864218826786832];
LW2_1 = [0.73713249268830416 -0.67405004605034491 0.16372806281460781 0.62696750286073477 0.072782548134985234 -0.74910824254319397 0.32299093896623926 -0.14694513254321581 -0.1776157738032797 -0.21769881271997335 -0.080948821888802688 0.46464057935560532;-1.1865390848922144 -1.1939649013772888 -0.21873988971865752 2.000416600673248 0.40659531281860534 1.9887506708447307 5.9553644408181778 -2.6409849176003495 0.17823088480525781 -0.32155178878870916 -3.058745269007261 0.45937119800067311;1.7857254352595049 1.0592949943184704 -1.2992953173823565 2.6082973099207853 1.108090029478338 -2.0850560605592423 -2.5649900083082815 -1.0615444463720862 -1.4021595564610474 -2.1279626458495922 0.18759569167104909 -1.2847577604008178;-0.77231710333045878 -1.1133276127953644 0.35965799143975863 0.90673342955711023 0.24631864158126215 -2.9870929509996453 3.2385193490165043 -1.3426344627847764 1.0039856788129544 1.4751782532298952 -2.1477147545035082 0.38503457540440406;1.5130943922466797 0.84893655979312932 0.17572016312832189 -1.1182430824929097 1.0622417247341698 0.043018982833987598 -1.9680728868976332 1.5934859981207659 2.0891802520992933 -0.17599212773985504 -3.6252724709091577 -0.1049530595051635;-0.22035459046399503 -0.95076601171902619 -0.83468432610249221 -0.79722508750953025 0.053314720487725259 -0.88350115668209184 -1.2307695643771035 -0.74906410093969567 -2.0737203734113043 -0.68922567324800121 0.31648353966503656 -0.73094863619590844;0.91919516782638233 0.93629054888544472 0.30753079952605866 -0.83392926186827598 0.086968503774046052 0.76698236470596681 -1.3699428329275509 0.010799322542558465 0.71082502576620532 -1.0974518714188022 -0.15204689841348989 0.09105028229870224;-0.58841685732599114 -4.641620069694218 -0.87544771298221913 0.86528152505834544 0.68144738073781197 3.1366635722724472 0.27763682917751586 0.022339614555733436 -0.79566264626644745 -2.611315185119742 -1.2849301410720488 -1.4095496411413413;0.95262688632859771 -0.065270310474412924 0.73744234887292548 -0.33615600171862481 -0.48294003640547711 -0.4894054381439556 1.687813140394899 -1.47312287923386 1.1051802224842908 1.387083714811334 2.0554614896965164 -0.89218792593605944;-1.5451544063973195 -1.0073956283501433 -0.17754106653085178 1.392768002443237 -1.1011532444289633 0.12561547855867228 2.48173052082364 -1.997679421931873 -2.2401740255965295 0.28660433692130405 3.79595582353098 0.19470458917102207;-0.12035114275293697 -1.5037616365630757 -0.66208362471847926 -1.2353726615841905 -1.604953441096983 -0.78577240795224679 -0.87675929170559264 -0.5950312591973117 -0.25448962759511351 -0.63612623540333935 1.6501282149319771 -0.44137229886890345;0.86626614165033233 2.187656076158413 1.2153722931111306 -0.11027822503750864 1.1294327754145583 -0.32660373371284601 3.8293283539435707 5.553151539062311 1.7055626430558304 -0.52379015591851341 -0.080597469001750577 0.57642355683846125];

% Layer 3
b3 = -2.7593872118346621;
LW3_2 = [1.9834847355318608 -0.13964914437149278 1.8856606372580953 0.38774635092130505 -2.3430821417233281 3.0441279388172569 0.33581664319378851 0.10869432606303095 -0.1361700916321632 -2.061556166246163 -4.9895566908460669 3.3979410227344724];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
