function [Y,Xf,Af] = COOblatos20(X,~,~)
%COOBLATOS20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:56.
% 
% [Y] = COOblatos20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.100381449508131;13.1578947368421;0.00618238021638331;0.0205761316872428;117.647058823529;0.0560224089635854;0.00600600600600601;0.158730158730159];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.4925617336082562;-0.44945186992741093;1.2135785725227455;1.0595034951006856;-0.72695514846849485;0.78724197137493934;0.50373118136350803;0.37703567710598512;0.40140968147235362;1.1627418456464467;-1.3474318308220667;-1.2486929849437718;-2.1168585749564883;-4.0635328899037164];
IW1_1 = [-0.89168006008000966 -0.18070363686434637 -1.2442200669440966 0.54653251651832901 0.025595932775239728 2.0011493466915944 -0.18802316008978914 1.2730566314633784 0.03661822626096603 -0.09424970480519429;0.36996513171316975 -2.395569504828829 -0.7406686451614739 1.1808926874913979 -0.060102914536863984 -0.13522699419738851 -0.04959059901933844 -1.0564324313690938 0.31836447388296807 1.0446492236148255;-0.8620641927739866 0.17798165935637086 0.21693766577991908 0.36462753479185772 0.62716305149386287 -0.87500954753098792 0.021514922473628097 -2.2180736211525467 -0.42960643308874985 -0.053063400646008792;2.2823032235580039 0.47255941212700686 0.61893422063903147 0.36341407704068507 -0.5248048984596333 -0.25264746485490558 0.10043623357038724 1.4847299873083342 0.31305967925538342 0.13085881474666319;0.39796749527081771 0.26200629329075198 -1.5292714256680422 0.078530029278797903 0.94235864010257431 -3.4897789949653819 1.1485381483999413 -2.4624229224515606 -0.44658465800033725 0.34609535964161608;-1.3250752515220565 -1.4372456130453857 2.2595853576537897 2.7132072085656498 -1.3710501680314602 0.73290909610216493 -0.52732295543950725 0.54922908091496503 -0.18689155129083396 0.66165557856699575;-0.21910053869492571 2.3943600183518132 0.71944565964283447 0.82609792169428342 -0.66515778119654523 0.24709706961970926 -0.28272955876583761 1.0237886475367055 0.13403543554778474 0.51345242329960872;-1.5102371453649694 0.79688574727138139 -1.1930055616950459 0.68683455654285219 -0.50893083294125385 0.0027609924539669494 -1.3300709750157873 -0.024451618376879161 0.62443351963650662 -0.098146692733748653;-0.037755431948175114 -2.9126354451929499 -0.08053882080446273 -0.057822335963119552 0.35080713558901949 0.31231314914485397 0.064449421904300822 0.078311748578321308 0.012392313168145909 -0.20146857779916158;-2.8188716571604062 -1.9870524971777597 -0.50568855206413987 0.34011695614988613 -0.13024961578437125 -0.32308745091669017 -1.4634257186599375 0.57316215384809011 0.24795860628236999 -0.80585635070364803;-0.050074856161584254 -2.7607351128072466 0.41442613100950931 -1.5851475858813999 -0.67287146988472413 -0.32333093749922737 0.34637002574526082 -1.210444625790845 -0.008986310390703512 -0.9898505911406188;1.9065481528687167 -2.1400075542264978 -0.122711509611426 -0.6469082383091882 1.6899293930518062 2.028265810549728 0.33779869685785568 3.1065777709696625 0.33768460248399479 -0.39866077126420912;-2.3091192379778787 -4.6143020504948762 -1.3237439463274558 0.98507090775789596 0.79297689324600784 -0.40494245513768462 -0.27339219713691754 0.12148288094613861 0.18719155965785358 0.0012725967461948698;-5.794696573615985 0.44816062282474473 1.5525617478489713 0.84747056081200212 -0.49520544932582855 -0.68412926600949631 -0.61099481658439547 0.81528829683316384 -0.32309921515584772 0.39010226219019878];

% Layer 2
b2 = [1.8672196762623345;0.29599539201103686;-0.28414295108677068;-1.2304023980486354;1.0330666300476135;0.60680416087072575;-0.22794906780091567;0.65050926817702126;1.1645358329273032;-1.3033615753372745;-0.42888408452164306;-1.3501407606510885;-1.4629645357521794;1.2126657916099757];
LW2_1 = [-1.0360178297354883 -0.085554954255398219 -0.73196783979341951 -1.2975369032738424 0.46275061610945145 0.3604973291678043 1.8801569886911313 -1.4889988819029887 0.065255222640232369 -0.032089905083108203 0.15401598674475631 -0.18773965967398856 -0.31596233541486096 -2.3927254237863025;0.27695592214252762 -0.89208827434668336 1.264508964526917 -0.38364489304738253 -0.13546377234307258 0.0026997167570347175 -0.22407256074707887 0.62995319457138532 0.073032715305379414 0.97617373152228826 -0.93208591284675946 1.4667253099755704 0.16224333769630758 -0.40401518851389623;0.19056774310751237 0.22389091798085892 0.90782666662095601 0.66511884777250341 -1.2039956707520478 0.64815340169049285 0.31949527243514997 -1.3060912002362888 -0.12723915651648002 0.24082457098085644 -0.51154483390808525 1.5896764660185114 -0.53077105488187926 -0.3882776099010401;0.33772678044613846 -0.46243062184376466 1.0316621587242523 -0.20282889086374281 -0.24594960867860405 -0.20984851372797297 2.2031905492706096 -0.27881066792113968 0.81311264562087582 -0.25436956077777179 0.24338169828647058 0.47714072403668034 0.61051269526136565 -1.1613554945370217;-0.088507419921650274 0.56409018920585674 -0.75710160526557935 0.42257152126934799 0.064918810365790322 -0.36326481943690558 -0.20705755536372361 0.30776813390743529 -0.52909066686838946 -0.45510729722060317 -0.95207429734067772 0.33233794232659764 0.65924564404140851 0.26731124537302337;-0.0082678244025207528 0.73172928698205397 0.44856117978022741 2.2042047303807473 0.23740937382699326 1.401877871561964 -1.3555256135062685 0.45412826435265774 0.20806815835160869 0.98592481382218278 1.3865719461387922 -0.60009101471271664 -1.3610808872794933 -2.120905190812608;0.081505540070788071 -0.62673115461930773 0.17062008555354952 -0.30999972110636775 -0.13491356737695906 0.39893259917167501 -0.19426446607137171 0.77947164141851999 1.4278730842464722 -0.34242178477992091 -1.0552822558566366 0.95705220018806214 -0.25901324610755017 -0.47814695876897262;0.46044825774765386 -0.72664825228668262 1.2974324086084374 -0.35447290585341595 -0.19099949557186779 -0.0024647454777115196 0.82146086099687499 -0.49335150442046288 -1.1542865692029076 1.2383209032228999 1.5385630952257892 -0.3115747555384073 -0.42160676712919692 0.56249822093681812;-0.26649623476360645 -0.58432372459723025 -0.91519424219745749 -0.46533429985831049 0.060635098657064436 0.19414485848408725 -1.0153568458469124 0.3370544730881842 1.1909132536622837 -1.1155257123752897 -1.7486312536688482 0.19171318359482845 -0.50247055305031818 0.24571806882478595;0.69552429075288469 0.57906188115201584 1.37398884037869 1.0089002228087247 -0.5876849610311734 -0.27473435886599645 -0.6328165001998346 0.38885498396845247 0.42052015128207382 -0.53127605475810891 0.63181236195864243 0.38851221326235319 0.24014122068535756 1.2082223163447783;-0.49816628069246133 0.067306220718993726 -0.45626119240226221 -0.24913915954583318 0.63723858495993413 0.22407198171499171 0.73146406783858975 -0.0072158256108373689 2.7922347514398975 -0.63212441570090838 0.44649787452912298 -0.643483756287072 0.072577030412794868 -0.31374243956788778;-0.80564680534888011 -0.8761800306755827 -1.0392925407656073 -2.2791163894376374 -0.19336173621022007 0.061132205890783262 1.4121993319253536 0.52446370242329621 0.94792976399650364 0.16060947693504865 -1.0664892667964185 0.98105045856423456 0.1150527991843375 1.5321880378851658;-0.26126550699990531 -0.66990730622529238 -1.2326050810987526 0.47543975302260139 -0.65332053820303071 1.1153364575310896 -0.090742816335007664 -0.27483222477653646 0.68700819984218031 0.020874261129600655 -0.033858407486327957 -0.32517764853572467 0.25881232768718371 0.56211350320224418;0.1813261794963994 0.34494736005905924 0.23200318188214492 0.54449099309044113 -0.18745504751973818 0.24639979444213114 -0.66373425907484651 0.90783377782502916 0.74409805962843212 0.26191521002145107 -0.25549263835869013 0.5276311101756751 0.82367166688751747 0.21091273629173146];

% Layer 3
b3 = -0.51012547041370293;
LW3_2 = [0.7278164801613809 0.44548305606213318 -0.29217915147758633 0.54238112963789886 -0.60206836095280614 -0.67432792688065002 -1.0138806317805429 -0.56653568664426934 0.83981720079682598 1.3295620731966 -0.77310210949877856 -0.78713637374077794 0.29208455842862563 1.0122267986415232];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
