function [Y,Xf,Af] = COAguilas5(X,~,~)
%COAGUILAS5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:18.
% 
% [Y] = COAguilas5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.448430493273543;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125;0.281968137600451;0.304971027752364];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.2337849889445049;-5.0852178520629394;-2.2886258035618625;-2.83691421552412;-0.24847695024584832;-0.93858875164796096;-0.24315024512930855;1.1688005820759906;-0.37789281395952012;-0.84267835498388499;0.74326312195995614;1.186201600341076;-0.6948122218600925;1.4404927890378985;-1.0641306672839113];
IW1_1 = [0.80623881445118761 -0.19587336284989265 0.014074732498299131 0.067466786210199081 -0.42697130382337967 -0.4046324700070163 -0.21373122806496103 -1.3605546807294921 0.99012842758269692 -0.85530862978934774 -0.059600496687506561 0.66236154806978964;0.36257635399740945 0.71227563125222604 -5.0346096543357124 -0.84586036899597905 0.081498414351888038 0.0029144232550795401 0.056080906679493503 0.18070140127227599 -0.38968581442290473 -0.14407889954676451 0.32442282192878308 -0.19910146277324853;0.2055962963783074 2.764248837497139 1.0820805761051961 -0.1880103167556503 -0.012563681817011344 -0.23422637985439165 -0.90061223345881447 0.31324111245730246 0.047592869242586648 0.022017411489092469 -0.0088937299881712284 -0.077813055168452605;0.10640160121216691 -4.5760639640517216 0.27418419785560666 -0.21893787652173796 -0.24029179244227603 -0.24765995624600926 0.5663453407941994 0.1194039272080455 0.044909409568597056 -0.31493276371963302 0.24528386230180532 0.13992539881866017;0.44598853480858286 0.092621279948474522 -1.0435299474149629 -0.0032237774154671717 -0.70386181852350926 0.2713349581048915 -0.96781476753582152 -0.88629384671427736 1.1209040016287537 0.65108632141476097 0.25762008448932433 1.9851100624945588;0.85247197485409165 -0.60580891741981047 0.10062742542150267 -1.469728950058254 -0.12314033816119062 -0.42353492648293734 1.1336637638668905 0.041837851644863082 -0.26230613328198515 -0.17349496700749129 0.65003470443256717 -0.29119095838767123;1.0342609583391746 0.7683104517114453 -0.18241025506126177 -0.23561451045424922 -0.54261955928451089 0.35950705512892139 -0.22976794701782116 1.5558290144288285 0.20797221201098631 0.22611375107008388 -0.49575459945873235 -0.54772014414426873;0.12831242521183325 0.40698804587875098 -1.2588576097050292 0.87142702327187782 -0.5578573744210269 -0.65437258927699582 1.2708624544324589 0.90416775572645625 -0.16543725179609581 -0.61460611798111597 -0.13304566084212033 -0.30021168956833755;1.0185019209544366 -1.2101870477281662 0.52445899023860776 -0.23974333460038483 0.4599233998050784 -0.45529037874179029 -0.4306755488372695 0.45923642294850608 -0.21784354574009757 -0.41557021336235805 0.1327715671995387 0.0087337412082028627;-0.44500269295495909 -0.48134451887021501 0.23116201825026059 -0.061828336522631228 0.14885111532246056 0.99387600606318116 -0.058639222515493861 -0.34163714607310308 0.18308383250869029 -0.22799158628056951 -0.045662393787114321 -0.014547799769353761;1.5366984337008274 0.23154295084186433 -1.1039523125842408 1.2520417240947488 0.78861254566563543 -1.5572611683191739 -0.21813694673366668 -0.15860764255272627 -0.49368252647125416 1.4771110294544105 -0.10131224347396095 -0.81126723410073542;1.6053451255606377 0.6361386863095766 -0.088865995762395011 -0.036550035003634788 0.75514304329168092 -0.43211717605011868 -0.85791866866243027 -0.23387771480763117 -0.36183484146063533 -0.4625194777871392 0.17235639041873302 -0.34691153196141655;0.30941380281657876 -1.2473981838619308 -0.064413247229950454 0.05402071498263062 0.28394072381723812 -0.34069812750141931 -0.36570893324773174 0.044955302433859076 -0.21022395227675372 -0.62876348115233904 0.13190584227462096 -0.19639268357639458;0.31429107084613189 -2.0570335321423259 0.80034393849140906 0.22197604132471799 0.17281697158226744 0.65181000618622065 0.86222147474442812 1.3788680791563133 0.069056471649289422 0.29560345464359516 -0.3502498953692913 -0.15661056187975114;-0.30333763443774259 0.86426566154892126 0.27202516123729314 0.24871322587001576 -0.073115086249663258 0.53205113345390698 0.38890438351777751 0.9401839339402962 0.26131312199533208 -0.27549980573827421 0.27723886798988584 0.50947483153971296];

% Layer 2
b2 = [-3.033494143604099;-0.84241409810081658;2.3601448246482049;-1.6000676130244493;0.85125637762723338;-1.8602170398050892;0.22034953260547607;-0.69265654639342245;-0.63913832865392517;0.29149474230754474;-0.97510655799128609;0.45941175594598505;-1.3120522166018396;1.3127555415524286;2.0409249436667056];
LW2_1 = [0.31719605578031479 -0.11706152395882244 0.35259061413545151 -0.7714639524569471 0.26321590256296168 0.21077745452101015 0.77316335954045368 -0.39286666615896976 0.26223825566486625 0.51566736482174391 0.073153465732044592 2.3315825417264935 0.086674938545343458 0.99481012982018835 -0.7934859177088458;0.52057666422810667 0.15599601313582262 -0.90235218502386494 0.91207484973717035 0.049657719027283831 0.24330111509953994 -0.39011154338798587 0.052575058864462149 -0.17397772509613801 0.16927891184498317 0.22319850732279653 0.68690087833256885 0.063145966348501337 1.0932602930887687 -0.31890789373595291;-0.54554546514916369 0.69759958745574702 0.90227114511203799 0.79172656811441156 0.49619758160694638 -0.44960787750611164 -0.77346495254548941 -0.60064412019316471 0.30842868537700652 -0.33555460918971225 0.2046318549314412 -0.74834942141707672 2.2844979047256757 -1.0177662304692707 0.42766477448078577;0.97482080757484235 0.26462649940053157 -1.0787311773701387 1.0391674553136316 0.073641606191503423 -0.1704326036257911 0.0003786113829146176 0.42205048052568911 0.039864115369872694 0.71658152369280825 0.26014023782356144 1.2756385263921182 -0.31721196924505413 1.2326686727450593 -0.61717957983333982;-0.47734278235685579 -0.35892969039238598 0.8833652479007823 0.34004892818255317 0.34858077688120837 -0.59765618796539288 0.24279150713596725 0.059228980587964414 0.94613282693744527 0.30003163156908075 -0.18876357284846051 0.95441313118102278 -0.19808475901226685 -0.46573378053403808 -0.33718961346386417;0.71882417856808312 -0.42326939290582322 -1.3952295558150403 0.81323366005825104 -0.58226035963747713 0.077871982014604157 0.020001895406947405 0.39752697020419475 2.2674907733911649 0.58018125245820074 -0.15951670928060552 0.97860701458699362 -3.0270261650195498 -1.2546168074487516 0.90604374790604791;-1.0119028681213635 0.23983786852178415 0.21977454839986643 0.10870121890576068 -0.19538826451567554 0.91447902615748822 0.12008187593626475 0.079587590581457493 0.017405949363163489 -0.58860998701006084 -0.014078383747522542 -0.6797193842527014 -0.016896132455769257 0.61687152358311215 0.4872087516312511;-2.450103649431183 1.6087348820151404 0.31306894726418888 -1.1624962437853867 -0.1274252670470695 0.34839172651414463 1.3661689972647453 0.49994021821747409 -0.67471638848289794 2.9794701413415257 0.93700362254343983 -1.8991509059446576 1.3643000517715667 0.19095756275152376 0.75345599460776302;-0.0017874778937503558 0.050948196050025402 -0.4428147587154615 -0.97678826605467917 0.19603504785581791 -0.50614055503611477 0.066864758793324888 0.54409736719520885 1.0901114897996589 0.92225151081908463 0.12406698233905562 1.1532004446047359 -0.58224766441836551 -0.25683310668658438 0.64435299167530902;0.68999829247978384 -0.66657344084265802 -0.56439165620646214 1.2358546182083234 -0.53037785032909168 -0.22773240953184443 0.91518125037559761 0.47824194892421301 -0.046743062407089378 0.2646463832221797 -0.25425988277963024 0.17658284374493491 -1.7213423823004614 0.57650883698789135 -0.02344417322988409;-0.42553108725776567 0.82152989133851362 0.44795822705806493 1.2213952360129341 0.27387100102063644 -0.34890575136507918 -0.80535756298548611 -0.41724354424434978 -0.12257279266074625 0.021373506235046857 0.15366048608311494 -0.019502534429396794 0.90326164238165507 0.91828368936049409 -0.98825802485896841;0.90224911885244086 -0.51261336564233884 -0.30731366185982034 0.55518486460801619 -0.15338858061831923 0.4456672180553945 0.41096559073651268 -0.080443355092614938 1.652037407641004 0.53520874031221033 0.2711346526046583 0.05458267189058303 -1.4306632766536245 -0.41324694248235561 1.4128818939038856;-0.00371137778990774 -0.095678302348803743 0.54205774685231867 1.0337216732328161 0.33030851539643441 0.1171725160763766 -0.13199730332589088 -0.52876205047324387 0.86672302752893782 0.011424697186752777 0.54671627549523594 -0.41514380810591134 -0.036344890296123422 0.51229484023344363 0.55990258014450323;-0.34568935449822458 -0.69743143424864662 -0.34233879046576826 -0.050062341590367689 0.096116650084157082 1.0402930211160646 -0.6294969661812444 0.47740532768878247 0.79851346618991004 -0.31673190373577476 -0.085894894295079433 0.74807958162614197 -0.82000771197118238 0.27246032502542672 0.33513061193391253;1.1640655107121767 -1.4281751884765801 0.66541904660678541 -0.18820891888435773 -0.0054429956655737653 0.78994633817660453 0.38471741300775536 -0.078082818596732412 -0.40314132734508573 1.0237761259995597 -0.11421708540535516 -0.60546741851890795 1.1081947452267638 0.2143542147884625 -0.95711173921689563];

% Layer 3
b3 = -0.52396845299241246;
LW3_2 = [0.53148171847563763 1.3353159619545467 0.78560395783173587 -0.9975806949345678 0.52229588073573818 2.2494088754067763 -0.40422594380891286 0.25002905702921402 -0.70263382990916035 0.82871832541160328 -1.3845327432557906 -1.1323486058513663 0.84785373473524339 1.0343869072956369 -0.21892097296599733];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
