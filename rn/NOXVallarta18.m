function [Y,Xf,Af] = NOXVallarta18(X,~,~)
%NOXVALLARTA18 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:29.
% 
% [Y] = NOXVallarta18(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.0793897192933897;2.8334866954575335;-2.458164707479765;1.3694505713988219;0.19401616635372346;-0.41798495757188486;0.80162001070442734;1.0645762665399434;0.41160230229092992;-2.9783216310109424;2.4652007825578099;1.9766329467392931;1.5273406620602219];
IW1_1 = [1.5386850332853887 -0.53744439620722506 0.78307401626279871 0.47635463122477417 0.34794939828873606 -0.71028186779997948 -1.0737110839750355 0.20577443774243764 0.25409674255614689;-0.1084922545282959 -0.6152940239434217 1.0176189655816246 0.32323156544602422 -2.2552938765557782 1.3481854943530469 1.0212306098596986 -0.54688974712344018 -0.23193237516115803;-0.86385673648192973 -1.9907133431730992 -0.30807036106077434 -0.95442023793543085 0.73845726997395988 -0.13915535760113595 -0.34478548529757663 0.13495269009115654 0.015652151923555766;-1.9142391137623347 0.25761350707333069 0.028452177616774016 -0.83566876166149884 -1.0723753699260303 0.62034344223703219 0.25255212614758216 -0.26409395531832458 -0.13101476713847029;0.14492898042643199 0.082991205386943351 -0.17448340297608736 -0.43080119363059044 0.85680998807432873 -1.3241683994913347 1.5990156505902517 1.9668337455192031 0.21295990526937328;-0.14298361275390772 -1.0271000735138469 0.15668700735350935 0.12359565659098241 -0.53957415140546228 0.21549717309376062 -0.30221488658247986 0.3114587031674842 -0.13545038883412894;0.56326589301222096 2.7097278183737976 -0.14874588515807366 0.38029271353862903 0.41705403300097044 -0.23836961323122785 0.066794162678561253 -0.35276879546138418 0.13034487805126801;-1.2846252302064163 0.68755761903429402 -0.95122863176767614 1.1774486143093537 0.046755960406844266 -0.015580231339002687 0.92532781625750216 0.1823161044658809 -0.26236551344018172;0.45147023758075649 -0.061586171607731874 0.60818851731012391 0.17632960413167159 -1.26221267233505 0.38945848289325663 -0.043844678192056855 -0.6125741492456972 -0.015624095097351852;0.49547493362928346 6.405252748532094 0.072453020567492962 -1.0260070733528768 0.14192271556372243 0.18145489810964255 -0.012381149023699816 0.067367974277581677 -0.13418445553995825;0.5733335601419578 -3.4934034711484632 -1.225468998134136 0.32557429936275778 -2.1940568103059155 1.5259801304007383 3.9598807206890618 -0.58110171430242985 -0.26078013900400432;0.97795803610202392 -0.87194288342655335 -0.089264843899909116 0.30967118186559828 0.90979949451163133 0.010884321677147393 -0.45959340976902252 0.69396663693950111 -0.20583650431257844;1.9125755966797882 1.7623523442164686 -1.3241200933812454 2.9334629958824223 -0.54193125096893957 0.022017592810077442 0.80049875457795594 -1.0859354448482714 -0.13963314424437659];

% Layer 2
b2 = [-2.3605981692918361;1.3892156018495827;2.1071791748615603;1.0597247783226806;-0.25096610971656813;0.032132554624609039;-1.175011687280141;-1.16163988462699;1.8977994136738805;1.2791637064682653;1.149522308004955;1.2143153511453104;-3.5482574007755705];
LW2_1 = [1.1044812565674764 -0.86081154654074288 0.8633790252217497 -0.87430282923355429 -0.18783663768226827 -0.50933835186432153 -1.8128974589498679 -0.41229550136824522 -1.220465751857245 -2.2547148342672658 -1.923812440123839 0.73947986706917468 -0.8480480801550716;-0.36217280260502238 0.72099234178073213 -0.9586833685536218 -0.30895733733927233 -0.24994923282475057 0.62355271328749473 0.90287342705195439 0.84093654074692614 1.0395386448406037 -0.5556592997783405 -0.39290486663258112 -0.04213809220696095 -0.14663699180411399;0.14851313161908408 2.0231938489105081 -3.3376711559555625 1.7501564899492259 1.330761136995553 3.5940277211436449 1.4532643543657102 0.47702472072821861 -2.2633091818722568 1.0250869703663965 -0.10617849679156702 -0.88924355151309831 -2.5928686155063847;1.0588159353848656 0.33002030413852962 -1.3984621289678554 1.2861216906321993 0.37184827532997217 2.5691240864957385 1.3364380495903716 1.5877156138121697 -0.91751251001440282 0.50200919248724918 -0.092629809171476382 1.172879656565359 -0.037590397284172794;-0.43344695261895871 0.83539212315368139 0.20488788932139659 -0.53152185423516474 -0.077810381559279065 -0.11125378282480186 0.89131955485601833 0.87896565674435334 -0.071125389270622369 1.1576839890896873 0.5732564227567617 -0.17505707319991079 -1.4774292169643757;-0.045080411902467171 0.3186779508577175 -0.4050948214678739 -0.48257340947980287 0.22448665300035342 -0.75764401006325544 0.3443883300056727 0.8577975679239267 1.1364559076519993 0.35822049706962783 -0.031572012071164432 1.3296280521436652 0.01191904654579035;1.284556177681963 -0.22246178444472242 0.25988433278118983 -0.64146339447260736 -0.70890465816516857 -1.2748679186189809 -0.31840072327518315 -1.7345355771272202 0.4131873942429678 -1.0393624150283189 -0.038682299146941372 0.94444515270805884 0.20773489084026658;0.64973115036445039 -0.3829681490444734 -0.34922036966392522 1.0052544365799549 0.20907955669135667 -0.31300626092260203 -0.92924208185937185 -0.32171990901208675 0.28870679999797599 -1.7301570446931647 -1.257245534135867 -0.065228527731742175 0.52772962802909851;-0.87550709153220041 0.816170088446321 -1.4216621962988716 2.6462457864718978 0.19583774108946361 -1.2588222492939785 -3.8536130423950277 -2.5188087841843685 -2.0668648295250698 0.37771661798187839 -0.017684424664992954 0.36620719187463874 3.1226151026168938;-0.88260747485500812 0.64489855821596087 -1.3169413376137711 -0.7664978182203831 0.35158856963429708 -3.4527578150867777 -4.2231605459460386 0.21970756989080825 0.31113453327802953 0.8946098603814584 0.095558369136068994 0.85441321514877011 0.77586487382124447;1.0807702012508087 -0.38592543889078224 0.71927833313629508 -0.0046060691839401938 0.091545519671115405 1.2318995536676387 0.3265032168812691 -0.47309376597558594 -0.60634462756536811 -0.12899965598453406 -0.013087604428574727 -0.61035167042568317 0.32841383604092367;0.70616515026797544 -0.59501123170119186 0.32418601337267922 1.4911674689595271 -0.33384045782583965 -0.2386681323711575 0.74307594400005328 0.258078571440368 -0.19154792612019914 0.46343176926634655 -0.030829130114650001 0.1910319434311005 -0.37122698239781848;-1.1684263257450211 -0.0022846455471433602 -0.1655063858525507 -1.7254355455972494 -0.46568946993180393 -0.47167261600833693 0.059167050213050312 -1.1528054509645278 1.2346325293202576 -0.85963390532770467 -0.46439677406546254 1.2396053896334844 -0.20250894626340765];

% Layer 3
b3 = 0.58967768967430279;
LW3_2 = [-1.4285807203318193 -1.1686749397631537 -2.4127717871719963 0.94129072191487417 -0.20606774251972754 -1.4541748623037247 1.6089363892325959 -0.67298556037115509 2.1000415730713482 -5.7285863535288106 -2.4051137655748831 -0.66556008110561748 -4.1940669291570627];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
