function [Y,Xf,Af] = PM10Oblatos2(X,~,~)
%PM10OBLATOS2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:21.
% 
% [Y] = PM10Oblatos2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.100381449508131;0.00618238021638331;117.647058823529;0.0560224089635854;0.00280033604032484;0.00462534690101758];
x1_step1_ymin = -1;

% Layer 1
b1 = [-3.897992525918232;-0.020907712072001105;1.6601764396306167;1.5533198597561448;1.0051275150417447;-0.86251225058877368;0.53675342578086094;-0.18456863430471962;1.2741178458080658;-0.11046205989062344;-0.043626367267020814;0.21829531701348115;1.493019810118553;1.3851660763403948;2.6032840804350506];
IW1_1 = [3.1629942163984976 0.041008945625780377 -2.3660400220245665 0.039148707613816384 1.5195484793341087 -0.42527089202723872 0.1579349029044918 0.36227428735393474;0.70468275173874073 0.35617321571082727 0.75419072354408034 -2.5557725960288629 0.3345930188368863 0.93231026901462677 0.95028712548174643 -0.2004467775609366;-0.47170430358529414 -0.45631205396286362 -2.303383735787297 3.0529807282251329 -0.21429036703303475 -0.92099949714527374 0.85983904415998247 -0.68359798714874598;-1.5360623435600602 1.1083125545094228 0.2237420004803779 -0.7259181423374258 1.7510286875514838 -0.34636252893869329 0.31513572374423249 0.52006725633466977;-0.78447820592421091 -2.4495876725084709 0.14178632167183328 1.0720919061080867 -1.8445203913896895 0.041507116541351773 -2.6080421025093914 0.050746906031696154;1.1095166803175402 -2.2899322402949611 -0.46254591322266114 -0.37536219471999765 -0.68816789277403945 0.1603658227472777 0.060782590037309576 0.41650083374806712;0.75301996020109907 0.30303727894177745 -0.33679846162421245 0.80791566248549163 0.1782537653073121 -1.4055596222410671 0.42906905079505653 1.7058112077617096;0.31708068183221083 -2.3958005281661992 0.79988849374701254 0.85731447701845775 -0.0015327064288081383 -1.1183004096102576 0.7097702017770231 1.9672585496467299;1.1355307868769908 -1.0636086741799513 0.097073990102917451 0.3327465028815581 0.31500873220792347 0.62621188417282958 0.93132460462864386 0.38372717500103659;-2.5551562271939883 -0.24299555581347598 -1.4401298521431871 -0.70937843591755534 4.3817934251025727 -0.32787915787847555 0.38250290247954288 0.84745322440345727;-4.6017715470164484 -0.17460225255305428 3.1318258040965836 -2.419743518818088 0.62848324835935632 1.3650503832928624 0.25873449849114527 -0.60821251383952701;-0.029547814815472691 0.35389669997966494 0.83266660398646752 -0.20454935951182457 -0.77540669598026291 2.0793166024236784 -1.1043057999329227 -2.0860446391683585;1.4329949908969153 -0.3871851758337152 -1.4155468320175899 2.5790625582874354 -0.30198178666142306 1.4971826090343132 -1.2854718528488676 0.23350748474074223;-0.10732056602740486 -1.3526992902266421 -0.64800814168383258 -0.55703641339030752 -0.32620602184265191 -2.5746031723205602 -0.70494602220461466 -0.65679214767415672;1.9496557843498701 1.5897404351359976 0.81619561231573001 0.7258594166859319 -0.70741920788540302 0.11283911179004823 0.057683243473433087 0.27204545702782085];

% Layer 2
b2 = [-2.0245598780289433;-1.7398183205557587;1.9743546753299883;1.2040206544723999;0.65635446240046402;-1.0626171426393656;-0.87375908711786598;0.71900550571154409;-0.33422457648509202;-0.32765132314692075;0.49381272533284687;-0.167738255725042;-1.6904662780918822;-0.1741915757126265;-1.678099033029598];
LW2_1 = [0.24790569782533417 0.72506800914131653 -0.1260168954540426 -0.69395335020038351 1.8066703438838292 0.29959623112251071 2.489835694973531 -0.08641595683126771 1.3746491179108797 -0.32831037833468257 -0.19879925149282848 1.2076831675104935 0.97156713198973277 -0.49773709093677332 -1.4090889824177555;0.68912464355195369 -0.32858962363341127 -0.38962227832699237 -0.76077782038400299 0.045368775200756641 0.53946915929494677 -0.3603780846971899 -0.14756294396009562 0.34357010024104268 0.4609661275373555 0.11445946379744534 0.14425189068239183 -0.47313204192944397 -0.63703967933018957 -0.75376533294337122;-0.77917759405376541 0.30758823789888573 0.53175435844702357 0.81715102482436319 -1.149105033792069 0.0015201985346164145 -0.062319067149440681 -0.27131164112488299 -0.71694065841846821 0.035530473473915171 1.6266926986011578 1.2455203765779403 -0.12194712317356202 -0.38470597802255252 -0.2497468714291505;0.61031658201877548 -1.7186815635918957 -1.1296558097114964 -0.0039352664756531278 -1.4088826107255101 -0.29179437999454499 0.81662434979787646 0.61809051500460732 1.1280128550013309 -0.40217373978963616 1.2080934461168173 0.59970055836610503 -0.91555897737646696 -0.22076694934341778 -1.1719441317340085;0.11279458900902622 -0.35191239835453847 0.76232740105145225 0.87262665791946781 -0.060455189270147008 1.2549346194429074 -0.09801482103067527 -0.97489438311040733 -2.0579678088038573 0.26574558132618131 0.074687717840735621 -2.3613196359675546 -0.66992212662915562 0.40791669001917957 1.2969083320992549;0.74876480589197381 -1.6852158253575307 0.17982540497001556 1.7788074446581401 -0.57006847675616512 -0.27499292377942119 1.1430300932001278 1.8804504563017284 0.5022392763115564 -2.2154458472985845 2.0709845678019922 0.46808937467115708 0.64645695223290289 -0.4409939229246238 -0.13911043372724141;-1.7676130063223898 -0.56223102469270791 0.36005436256475415 -0.76747135768868968 -0.95738421846564481 -0.28807591031114316 0.099493771691067046 -0.25977331561678235 0.83789251971488388 -0.66024129027754497 0.61393978548684003 -0.77183507121186112 0.49021514604678179 0.26693435540301702 0.14120759204026187;0.13631220665241617 0.19892469217510259 1.5945165436555471 -0.64373062842524265 -0.73918149089601337 -1.1530656333889175 0.16497122178278428 -0.33227937270868296 -0.54897790663600265 3.0131896497213355 0.12135517457405708 -0.39327714870018626 0.41641755486562615 2.3671923614779482 -0.80087092256283632;-0.51043576482675879 0.17178233627467271 0.13009034726920729 0.72368134962351571 0.29478734219931441 -0.30415504426331308 -0.50587636344248565 0.81104515747001327 0.90116057393888815 0.4433419713741259 -0.067142478213990095 -0.52085507845398493 -0.2632587852529617 -0.23397448676216615 0.17509971121442058;-0.32269218493584761 1.2703057647927074 -0.18665841184751647 -0.27459674772931592 -1.1964512652226358 1.3601695224561383 0.32307312553128487 1.1428362746139558 -0.74243100907722948 -1.9037451581092477 -0.44705159874607819 0.91903794665999272 0.1900638816135348 -0.77525755044964406 -1.0505044568410153;-0.52903903281096243 -0.024374898590190361 0.60771059305276987 2.0921208129074049 -0.30317598155348652 1.5659446200259752 1.9850623576854058 0.0073382871940155144 0.73710663110116514 -1.6482444548748467 1.4167524213645977 -1.1635552692455331 0.20873774655505395 -0.6958761798947426 0.73129880598713481;-2.0190197539568935 2.1252257845665632 -1.262365194889522 0.26108354680178886 1.6134899456586513 0.55332696064874443 -1.3730154416818539 -1.5137114376877976 -1.180244337073785 0.57433328875314138 -1.7672737937046918 -1.7151383813814978 1.1716374519518722 0.24781622359917047 1.2518699705242264;-1.683730443541759 1.0162516881668862 0.95140158098637817 -3.0634963207559909 0.32575855341410115 -2.8156414682207824 1.2462227868665943 1.1361659704882432 0.20880517928445025 0.14524359893498512 -0.93652348500918636 1.0202024058011259 -0.77115613832395469 1.5994702307310025 0.28740817231172983;0.34494030506199203 -0.27316537194789303 1.4836362933674112 -0.29879285641510034 0.62654458258141432 -1.1799286209893396 -1.4276320449174666 1.3242768640285381 -0.86055259622058577 0.52264514924231176 -1.0730807503388013 -0.0047218837989946374 0.038575028700692765 -0.92907064125009642 -0.49451940761950497;1.028873309373074 0.40274422403038407 -0.51044084737445661 -0.7889157260030194 -0.65397362235374634 -0.45286681928009859 0.63296954149595885 -0.11915249926076527 0.35399819820670808 0.58195826976019083 -0.12210584536931283 0.99441571750601876 0.59147961988485331 1.2549877873158044 0.52522943964689794];

% Layer 3
b3 = 0.27283368334929931;
LW3_2 = [0.24043858102182364 1.2399261440706775 0.42206293825117386 -1.4894299278955196 0.21797212139783512 -0.35189278631029286 0.29431339918345439 -0.3520771202291692 0.19715346578108364 -0.17641456558181459 0.09621846265193533 -1.288407137100636 -0.14156730116108346 0.21720623070558373 0.45988995067743155];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
