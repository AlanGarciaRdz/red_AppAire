function [Y,Xf,Af] = COMiravalle20(X,~,~)
%COMIRAVALLE20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:56:48.
% 
% [Y] = COMiravalle20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.304971027752364;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [3.0015473418857357;-0.93971879198941377;1.9236184408426067;1.0472946271476018;0.49065640951816986;0.00055566420704699498;2.6711097660190015;-1.408544782218653;-0.40567786501989778;-2.2487125298310149;-1.3257844216371975;0.75242372235882371;-1.2923519066529383;-1.2476392296503072;2.4114371475559002];
IW1_1 = [-0.81497919246106754 0.044059041456907255 2.286570263890142 -2.0431066107586719 0.99204635376025929 -0.55054031244299706 -1.107220517493188 -0.61070139329625428;0.76512923339149264 1.2953486023557874 0.15126531889560074 0.69470651501834546 -0.17753932850243848 1.7047233385360638 -0.040936217564140419 0.45665303756382991;-2.3078152309569142 1.9800396568654488 0.17375659548593109 0.38191707707780287 -0.52740883471983158 -0.75516230996564959 0.86175385702050233 0.31222110227971728;-1.8489548583707409 0.34948870140221028 -0.66136676501963088 0.54013185863724056 -0.40316741424250496 1.2462627567824207 -0.83542671144360947 0.26621912055189184;0.25106286068147393 6.41830205774726 0.6514423079416799 -0.34467934292898328 0.33575227589966583 0.92759168767939204 0.41551008260674693 0.036146509242813957;2.8313294751216223 0.91279324888412083 -2.3562439473394634 1.0771340755660914 -0.056922916321588926 -1.6666489745737993 -0.019968651588200402 0.15602847505025225;-3.2162015326153472 -0.45512066617276392 -0.34541697545086059 -0.74738458149192677 0.021088099312881324 0.5193257835798466 0.77221399743148211 -0.050129248800892576;-1.1052512560294263 1.1425495392952507 0.38667289848192099 -0.58253454208738886 0.42217776744413021 0.54073586188056 -0.4393189709334378 -0.10397200044784562;-0.59650792705468458 2.0418668827270854 -0.6018425412161359 0.87522139736780902 -0.20965368842280677 -1.3596223009536352 0.46487939217270857 0.22783646065786203;-2.3798092251017242 -1.4472627200892467 -1.0885028189690331 -0.45079483226688044 3.1420765866466223 0.64405644124580452 -0.53601777540525775 -0.41246993876288107;-0.90054450514714501 -0.15894146779619936 -0.91591799648500993 -0.82681526086589485 1.3385168623557271 0.66097822454790234 -0.46541082634554837 -0.91201175884513475;2.5406687305387599 0.4536509827129287 -2.4306996931552289 0.54987099463206224 -0.065809120843941041 -1.0643936452009921 0.26333844547333685 0.59989635922074702;-1.1025101092558369 -0.67368400973215303 -0.12563375471720856 0.28104680631394952 0.88616855655715576 -2.3921688057082893 -0.61501369684832585 0.77028947641506962;-1.8911653465216856 -1.6461760256900695 -0.63787899262667347 0.861972973731157 -1.0024324771593627 -1.3228777575955963 -0.28143600070280456 0.14908765596620896;2.0547305367448692 0.89874906176683278 0.32655737222870107 -2.3393848880733699 -1.9616226547274851 -1.0867266379678502 1.6480144150801959 -0.40641436499586125];

% Layer 2
b2 = [2.645901101389005;1.0813615269852126;1.5416198170312383;-2.5295572540227615;1.9126053868447499;0.83239326483487108;-1.1614959900198583;0.11647546564219563;0.57558856075227494;1.0740770789019536;-0.745348929706798;-2.1605351799594072;2.8822440455346134;-2.7913814117320417;1.5311211305546619];
LW2_1 = [-0.64217227142260136 0.99449969813946737 0.37881139974861588 -0.13632346940015366 -0.52791174345557323 -0.51407283035830786 -0.53977451409507737 0.40280683277425944 0.19582303399737946 0.024783354571806651 0.5800360144321407 -0.037808973399021034 1.3153868026141935 -0.74766849380695199 -0.19699022002394201;-0.53338175453411441 0.44996115972413636 0.40010967165990463 0.16628211115331021 -0.57675989782136161 -0.41743938533585345 0.50414734254889759 0.29944651364335956 0.16255566150193851 -0.013191070666227293 0.0034777243577021905 -0.17795904903658663 1.2982607436989761 -0.68146331208297128 -0.04614165277661024;-0.59762197522606786 0.21925684862475775 -0.057412566856903789 0.086642961333251667 0.28965254830535292 0.88171954633202676 0.54521544787818643 0.20066700281256661 0.90091195158426174 -0.087537383266897334 0.3076508972740658 -0.40992236709608859 0.24825090094529101 0.33039236066318944 -0.070928533509753727;-0.028224385550273665 -0.081027832245837803 -1.0864987417513092 -0.71658445608986021 0.52967213958077819 -0.27264764549336556 -0.045075865524199871 -1.0396438592747093 0.93877037239091665 -0.12265865709691201 -0.25568797375776364 2.2491105914231397 -0.3190383464913511 1.3776677560027992 -0.36744022350719469;1.3056772103965708 0.2449200526324378 1.0131727585060697 -0.18525406204211758 0.99169359973892135 1.9624758236835076 -2.0047211439834225 0.20992056269102594 1.1123639618249994 -0.45251394450631849 0.26513174601577089 -2.0189202110001241 2.1178371875260815 0.41272648467853446 -0.58442645510484692;-0.3606593819043199 0.41558029716154365 -0.086663029544286493 0.10340775502690526 -0.069716618032804101 0.89442392762317702 0.69671192158390871 0.37924718215598119 0.89507906403147697 -0.049185559297430043 0.17601445046092384 -0.32661673285493148 0.21787150951554024 0.27894454664913182 0.39281627438233918;1.3092538310108575 1.2749797452747049 0.22881018063598157 -0.74912240311448297 0.409355011951406 -0.042420575544920978 0.42418238095515881 1.7573870734659587 1.7113465348059789 -0.24478050649582861 0.93783273315680982 0.68886012005289632 -0.21242318683772823 -1.5916706300758219 0.4797694747138404;0.60974181414495154 -0.061379422354962548 -0.046601468532707774 -0.026912050882820615 -1.9815090611632056 -0.45217552441486841 -1.2588041167914585 0.89331914829274284 -0.37651997214794719 -0.91085972946907767 0.68641165316746122 -0.17463211572590454 -1.2536230011993179 -0.41310017029451196 -1.9090357730305443;0.72163824819816447 0.72151034159005745 -1.4426846303034813 1.3783561642665363 -0.68572959876539596 -0.19757208553384079 0.098292073136356545 1.2659661288473931 -2.6310802499681456 -0.40953180746944534 -0.2468427793044026 1.2518648537723451 1.5771984267417885 0.34428491895444496 -3.2276141267735019;-0.19917761367704795 0.24733617718765666 -0.20183027751385818 0.22948961125043121 1.0180242402889492 0.9779564543309055 -0.34914762677752764 0.053716251496388145 0.51445569205330199 -0.12440030193745838 -0.50131558356817263 -0.71408154366610832 0.92367538029376206 -0.077597040438874082 0.065480936162016501;0.20215545769508433 -0.21355787151371985 0.10334085849681118 -0.012326669568936192 -1.7084390034751169 -0.12635576892159506 -0.73664699660447841 1.0726333490742563 -0.31620164401219242 -0.71134781642513834 0.31874393993858896 -0.11730567579193042 -0.76121756425669029 -0.39293518858989296 -0.28738371335736401;-0.38880335032335311 0.13202277662872819 -0.35038015693332708 -0.18692056120182726 0.13630631516345471 1.3684758830745924 -0.83442131825775456 0.21897164495641999 -0.89133832110876798 -0.42829009852447514 0.073058209785125547 -1.4264467170599975 0.3198188002637149 -3.258309969381783 -0.63750811850884326;0.78063963753029164 0.76434338671749957 1.1458791148234859 0.57022308769029839 -0.28684360961477268 -0.26267811839724858 -0.32905279428457351 0.92629593717960079 -0.80151270261922825 0.36000086836903944 0.0095912420305245792 -1.9924506695765976 -0.24055035061974334 -0.34130095855332815 0.45144259002929993;1.1732068038599555 0.75684917098704962 0.14722708207785093 -0.623697070977 -0.055001024780369945 1.2118467346391806 1.5888830348758478 -0.43288302194912776 1.5084845033305907 1.5525379936330825 -1.3060206664213603 -1.0632947912337716 -0.05646502577045092 1.400623831472835 0.34145212410736137;-1.0924028713992564 0.23387462093103531 2.4118814425873012 0.59719958215429281 -3.5372686812242131 3.5051220873561277 -0.42647536606843889 -0.36360331444711869 -1.5427630585062568 -1.3178014829042337 -0.15419900245572271 -1.0684058964772694 -1.8040248145233373 -2.3925186262996183 0.24741007249224675];

% Layer 3
b3 = -0.5215018754254851;
LW3_2 = [0.57897441321554843 -0.88859121182260348 1.848228738888444 -1.4865897460231166 -0.21239398406038726 -2.0140476977247235 -0.45594208004300241 -0.89888479775456798 0.15855303446687488 0.76054891743405995 1.1654499099990485 -0.78658825040049818 -1.1750241845601748 0.73804953521220007 -0.26676733789424983];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
