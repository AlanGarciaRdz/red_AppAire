function [Y,Xf,Af] = PM10Miravalle8(X,~,~)
%PM10MIRAVALLE8 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:16.
% 
% [Y] = PM10Miravalle8(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.00382043935052531;0.0208986415882968;0.056980056980057;0.0063552589768033];
x1_step1_ymin = -1;

% Layer 1
b1 = [-0.64512672132917237;-17.26776141037481;2.3747457707655344;1.6465605913828714;-0.85875230194691354;-2.7495567270949621;1.7285458408425298;-0.59058501193145985;-0.15864054314083839;-2.4247760143754435;-0.86115572573568322;-3.3368631802064437;5.2456317112623747;-1.6931027107862509];
IW1_1 = [-2.0122465135474399 0.65840324490321389 1.1136266217914119 0.1669249881620902 1.1914880118663609 -0.35537557743296361;2.5660235339214794 -0.022618783548441299 -14.562288853051296 -1.6350446676410433 -2.0115492179325596 0.4197887427870694;-0.012444360785725687 0.52748636984840525 1.4165514322640529 0.022172178851746233 0.64647438568793369 -0.023142069141769479;-0.36253011498623922 0.55557719756197577 0.67122388743058081 -0.3984061628474842 1.057586971747084 0.12382448101375709;-0.68945143440149348 -1.0046406822852125 0.54286544682552074 0.32343718486500572 1.537451414175522 -0.25243849927959111;1.4998752840185461 -1.3861378948903051 1.54295419565603 -0.98141351886110406 -1.8007272554948091 -2.3147970075494033;1.6398441372537502 0.56876252911798475 -0.61969565862712672 1.8192756177024201 1.0447346237990338 1.1875112546960989;0.18950610848671873 -1.3830442337612923 0.21361288807365911 -0.72867546024365115 -0.054457419060667075 0.14139463617145467;0.89735196007771767 -0.39919637824468246 0.14517958228118255 -1.8180291450869757 -0.92764577573077811 0.97641156231722281;-2.917476253568315 -0.24567568042353685 0.42740792458135846 -1.3398382433108187 -0.71546910602179969 0.087800009788772587;0.93472830228914761 -2.0290818258183476 0.6142115706354474 -0.14893351875972316 -0.85095454890477185 -0.24547829366473845;1.4907199048167967 -0.96260578538076114 4.4266585928722018 4.7609100215314228 -2.3916750114895882 1.1266427850196801;0.32960198700010535 -1.2176986078192864 -5.3935417257698077 -3.9480883055233917 0.92684103653175476 -1.4455405366585936;-1.1991753329388131 0.35530444572379766 0.24083703155283637 0.83736112266228535 1.7295630089453202 -0.13434228380107277];

% Layer 2
b2 = [-6.2360573602798173;-0.309500145208781;-1.0234139891227947;-3.4464594618683972;-2.4838020825155116;8.7527634623727302;-1.6059664308906598;-0.42386380273480451;2.1219410016964142;-1.136159447802032;0.49737250606179073;-1.8056112033457996;-6.2295384479800386;5.2455830880163772];
LW2_1 = [-0.44253843566639639 0.83346741182247153 3.4698991565655324 -3.0633709048579334 1.0598712448974494 -0.14819896961434181 1.0731187024831832 0.75589211803213441 0.74031034035786836 -2.4114276848737757 -0.57804320215962868 0.15622003668233997 -0.60823206192427204 -2.3137264568634532;1.8178227652527319 -7.1218405674304508 0.24295905361676334 -2.1750253448404431 -3.2427827817902681 -6.3605193531293063 2.5264371139346786 0.32665097354511835 5.8893512073756726 0.36288804019188309 1.4896889164707099 2.4224195301106457 -3.0011937885083002 1.9507364337914821;-0.89550839484490785 -1.127330633856209 2.9221181932450682 -2.9117057785061191 1.4395085593178367 0.60746394990826125 0.68834545735331809 1.8499257109926825 -0.63508664810033344 1.0471915397829819 -1.5904712860851375 -0.65011150657764016 0.47373723305107895 3.6426600398178075;0.69193528205176935 -6.8158542553223276 0.61815776148880242 0.99573786242010676 4.8498501016234883 -5.2223279698554741 -0.082438025928842251 1.8744317518745111 0.16158756403548297 -1.8958497247905954 1.9979702057313762 3.1289941189261441 -1.0138526845073796 -1.5083696005766174;-0.63975049659378402 0.91601829861457973 -2.5921796863126363 0.4793660964875075 -0.2505686459405761 0.46215395123683001 -1.2039910919626056 -6.3761489922817978 0.71039511391857535 -0.11205298644105352 1.273134609382486 -1.0513777265387421 2.8475871767594438 1.9213254892552922;0.1239557223619086 -1.3301058723767143 -8.0041413268286234 0.66831424251792404 5.2927973271342523 2.1642985670627528 0.8506099334946805 -7.2560443356796815 2.314136898072376 0.82054366336828943 5.879976948321386 -4.0717293243287633 -0.9529646624148268 -1.4280682313789621;0.58513424595182173 -1.4515579983398086 -3.3586609031839298 3.7765906799837543 -1.8371401390421178 0.49702489721160181 -0.90214093590244981 -1.963461206875869 0.46562526522860648 -0.48842756920393215 1.0340817307060299 -0.95905050525690627 1.1694429029475923 1.170192924543584;0.59424745419202363 -5.3160334058540437 -2.4762112875775415 3.1211760706785805 -1.5940215663951633 1.7951264584566977 2.2806521927469365 9.2996466607123818 -2.983203711604709 4.9670868033940403 0.057638635764593951 0.2509536518756435 1.3186798003042417 -2.8028556290502009;-2.1503680715816542 -0.83594507275699348 1.458276353059113 0.84151452141636818 2.3696960186131255 2.1258345293025851 -2.742799321304624 -1.192844644443392 -0.22019287707087554 -1.252948670160517 -1.7832957386746697 -0.57615058124480389 -1.390579381640918 3.1367103708953579;-0.85570486666524292 -5.7658206973090582 -11.269551918958754 8.999798486094539 -0.31471637883773573 -0.28714983443187092 0.73189039551912349 -4.7338557048652854 1.5248276788595803 1.5685752696223816 4.5041338930123267 0.36271945786130932 -1.9439245136611758 -0.20775830308072193;0.64137309229469308 4.2750311794172626 1.2262611221835396 2.1227907696535131 4.8084956805313119 2.0892091966901583 2.4285973312096076 -0.015349198611229159 -1.295082588588006 -2.1528817997876413 -0.26056621341641756 3.8467956299510262 3.304887886277859 -5.1910087413533468;-0.72367135592585075 -1.5604352875337197 0.41655108390836698 -1.8940798943297206 0.19328987092913247 -2.468268055683001 -4.552928547887757 0.43916629021547904 0.78901186582410343 -3.9755427595037065 -0.86607172843003932 0.20356407724694944 2.4081207791527008 3.6721155276268527;-3.2433821273853694 -2.0846577092199663 5.5430634384355777 -1.4362331475103802 3.4682701758803454 -0.28043658609675337 -2.9832131658753043 -0.67868572496242274 -0.46391631702249242 -1.1348285249093546 -2.2017111083436753 0.23158992789903288 -3.9471254956268007 -2.8916209329251226;-0.67776902238174586 2.3352709757908947 1.0620363662278889 -2.4090677290517193 2.1233777205561615 2.0696151418179722 2.1343852708581008 -1.6223727652070661 -0.73276237765169161 4.4996515134421511 -0.35249168366043432 -1.926046982831928 0.55550285550006806 0.14629323740989114];

% Layer 3
b3 = -1.4706550021365579;
LW3_2 = [-0.47657219255761074 0.063178758647902511 -0.25396105878691261 -0.13451775601133831 -0.15985632922870829 0.15566516629638946 -0.17474542608208837 -0.072206719722375898 0.19528259312651772 -0.1690646910085441 -0.11285299451126192 -0.19311581302935282 -0.12340844535372233 -0.28684061321213306];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
