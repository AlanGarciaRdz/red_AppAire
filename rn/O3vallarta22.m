function [Y,Xf,Af] = O3vallarta22(X,~,~)
%O3VALLARTA22 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:55.
% 
% [Y] = O3vallarta22(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.12820512820513;24.390243902439;0.02710027100271;0.141843971631206;10.4712041884817];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [4.9814062593977519;2.990059879309122;1.9416821258776369;2.7749172997575489;-2.7385944148190768;-0.27240351673224111;-0.40771256413969631;1.2346788472964296;-1.0389644146208805;-0.077858465385797326;-0.07605127237589937;-2.138549711697777;0.57679662272665388;0.77559300974179002];
  IW1_1 = [-1.5073837236650416 2.2023817390129485 0.57932640643333544 1.0593693008268672 -0.39610862932822488 -2.4290370511108748 3.3039779950892583;-0.80403631756078831 -0.39973352475443619 1.3464728749855588 -0.73062488058713548 0.55061976444528493 -0.034450381185822242 1.9902956924072339;-2.3345563720921834 0.053030982643876026 0.24297748791287208 1.0078758718579415 0.090376071924363061 0.25610809443559823 0.093466690276354972;-0.23872433388424752 1.2896466298777034 1.1994245860513391 1.734312705100159 -1.2990871252000844 -0.083622853848746695 1.1900574300108231;0.28676862255789004 -3.5824367938077319 1.2412014854406481 -1.1277346002549722 -1.7235015552977555 0.9333440580961323 2.4675137552665705;0.23845984443090162 1.7029684522784061 3.298340229988276 -4.3227327334858927 -0.63422497222463337 -0.47945208066432871 -1.8750622647142297;-0.014498298290539727 -3.3897489202964088 -1.2852123663832209 2.9217795765476886 1.41510754854636 -1.6352987253109026 -0.23361344391197608;1.3779080136314077 -0.35057671341303953 -0.86614536377357809 -0.26639832513876616 0.0081719985175742402 0.8362223430883472 1.8887870050785283;1.5000952809852175 -2.0104644370036278 0.96264022124900783 -2.3279996042254183 2.2013192202069698 -0.2249083227712213 -1.0281379425482848;-3.4167683497296095 0.52846755576635596 0.83840095544312032 -1.0940868595692248 -1.0485076431512732 -0.31584503560304161 -1.6182697075437407;-0.58719729861893877 -2.2782322135246424 0.28219988967805487 -0.24883563815600418 0.85607122635277788 0.75424055577994153 0.87655885157889368;-0.85352794637714824 -1.1165351389986078 0.50130039580689445 -0.76800156576052736 0.38195705436868665 0.52303500117251756 -0.66827620820584999;-3.1552848451559998 -0.77949612041126148 -0.48307528835166019 0.38982176504535404 1.3086621328095878 -0.082596529139765062 -0.73487248923279835;-1.5958229789863485 0.17477538159239484 -1.8124014406748366 1.2833702462622494 -1.0491574541960114 0.68607336285916998 0.63883758673873214];
  
  % Layer 2
  b2 = [0.59214200470016443;0.42242432840936245;0.2949699995356902;-0.16209279226803319;-1.269686016524523;-0.20625360695074657;1.2813843514453735;1.3134742359224141;-2.2854642896448261;1.0096711747124025;1.0707264325552013;-1.6031553028216359;-4.138747733920507;-4.4142314568493406];
  LW2_1 = [1.2275694497026615 0.21951026401728951 0.46574592087954858 0.28017113870493054 0.68579186872568954 1.6235783314594072 1.441215035155978 0.42963100603865473 0.874170003830681 1.2412413028575215 0.51714314311702447 0.43607094906824539 0.86136051326562579 -0.23036470933975237;0.1269097867498955 -0.51455953259513953 1.0042068046916963 -0.37614539149905313 -0.21072881964854606 -1.3009271961318607 -0.28055395252963339 -0.030267602418541789 0.69934514781136803 0.19986970190801095 0.28156855115617818 -1.2788257754330583 -1.2766953164095898 0.39941053676910054;-3.6429681698742411 1.4722459192448778 -1.8593172533098588 -2.808223509940166 -0.46942890593503922 0.18949454664919488 0.69860685655854948 1.5927585793645382 1.7689753764092144 -1.2172292844888615 -2.3570045826623618 -1.990597872201864 1.3554420094220387 1.2728305067846175;-0.53047613995976406 0.74729880942648186 2.2428258673146657 0.17618150849156852 -0.70211478077829859 -1.2985865404942665 -2.2704030275217413 0.93166189791040277 2.9884865470866702 0.93204367469051275 0.026447012167469794 0.81070370430103678 -0.021375611975648086 0.14416051929426538;-0.11790812413868468 0.21705247864584548 -0.70604852165341758 -1.6075782070647173 0.64042318386541408 -1.2275152359804213 -0.40768477332061626 1.5430858873009965 -0.86528768083483509 -0.29540025572959527 -0.47691755468004027 0.39489961734700751 -0.53329135629302205 0.63864070133743001;0.10823991877762895 0.3030902522641345 -1.047371012536173 0.42323651171938598 -0.11730206047362533 0.44792197042613585 0.18934245854343368 0.80348421552274663 -0.11825736964926765 -0.71975843530518657 -0.25111962131717702 0.95865959866896144 1.3545335563959848 -0.62104452713030878;-0.35667472913724213 0.63510962803795201 0.62036862500770684 -1.425421329826432 0.62031321405214235 -1.1519016096880779 -0.00085107311053591803 -0.68327160462789593 -1.030295927796441 -0.14587171587744802 -0.20068320200774709 0.82124209147272687 -1.1192891110478427 0.24916006306390523;1.3662500460396028 1.0687130721742308 9.8526334036075269 -2.5704667282024798 -0.32342799109806197 1.871532340459678 -0.80469551457927591 0.1253103074014249 -0.7004391630453537 0.59543451047604179 2.1501706245761079 -2.6017288553974693 -3.7197257567130757 -0.59254269556688088;0.68868225314252263 0.030442216893145909 -3.3824798298202596 -2.1487409566431008 1.1373098318343275 1.2788850535355007 -0.3070691382669411 -0.85959357468704845 -1.1188502639676674 -1.2973549123926347 0.12688566236580326 0.16187657787293541 1.3777629223943948 0.83154833484982349;0.10738476843171231 -1.2565816838553094 0.25874480201562916 0.67737484582872654 0.1219440482069008 0.12360993419083768 0.06986092847733584 0.35508132206713006 0.38560110485052557 -0.20099153216862242 -0.018483191395496201 -0.78365144293630928 0.35932205202719658 -0.2515285628969024;0.17318035731152095 1.1097039305347187 4.0990532947269758 -1.7292826918768467 0.92106612925533615 0.20204868004501994 -0.064958922267649488 -0.92917410109565945 -1.4482307940122372 2.1082758298694704 1.8631625208134259 -2.3828801844797294 -2.268148964395841 -3.1869947013489028;0.24193591999702271 1.3989305323354684 0.66929333682961489 -1.3229546284038167 -0.9547585228178459 0.31219348930918572 0.078987833378392838 1.0662452023609028 0.0053850332365547628 0.0014481423903241475 0.4470271178998621 1.4137975323201422 -0.42589200781807413 -0.60814375895710682;3.2572545298298312 -3.2995637890565552 -0.63960720569284091 -5.2217007547086727 1.5922367046991521 -0.98858054869184464 1.0592362648695697 1.7673612837987704 -4.3350384332566776 1.0413224837690194 -2.8100121941616472 2.5831238368077707 0.70364568413739126 -1.8103830115284107;-0.73569531289328627 0.90661233579019818 0.5207716758323786 -0.61507902727185382 0.72978643748990946 1.1648634148164989 0.17027686084093416 -0.42323633677749689 -1.3059176668016268 2.3350278350000817 0.3041888509043757 -0.52385191018843902 1.34822724426558 -0.46082989199913349];
  
  % Layer 3
  b3 = 1.5804458999994804;
  LW3_2 = [0.16565122847725039 0.74216282961091351 -0.085368317905823596 -0.13167090067089343 0.86271028936120697 0.77264558942468409 -0.73058080409255344 0.31248143502464948 -0.51594368634341425 -1.2791237640385245 0.1811056333995926 -0.31114748913076029 2.0389723363621117 0.34714218283917997];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.4712041884817;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
