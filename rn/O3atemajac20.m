function [Y,Xf,Af] = O3atemajac20(X,~,~)
%O3ATEMAJAC20 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:37.
% 
% [Y] = O3atemajac20(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.201288244766506;4.04040404040404;166.666666666667;0.0561797752808989;0.00614628149969269;9.52380952380952];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.0427215336842282;-1.7641446853483864;1.0428090341443566;2.362913158904941;0.69496120356862245;-0.37483023866655651;0.3691952364432321;2.9141027067154219;-2.1465098224333286;-0.63235370073914476;-0.63448439496250386;0.63988604081671219;-3.0133258639763829;-1.625035325810867;1.4922730670024507];
  IW1_1 = [1.735220955702343 0.50294239819424602 -0.98393314797275733 0.93571258622996289 0.0070176619101974379 2.5079905148475552 0.3788342303234139 1.612279841355833;0.42057775735468544 0.10100113309471266 -1.7520232560372253 0.47042419254060486 0.23312392647842761 0.055632774988662551 0.0055370611749174748 0.12546964721242529;-1.5202358582912394 0.13976561146591354 0.39542655032790669 0.28829089274866998 0.0011433882589726848 -0.22128933609712872 0.025240344658542281 0.54453841291429994;-2.1586861285567807 -0.95678362739207723 -0.8790234793305729 0.56352556375850649 0.099034492550623784 1.1537338649991473 0.13388074479802872 0.48753213712144278;-0.63777503928632229 1.5404591583146408 0.085346468580256907 0.4372823624483887 -0.53372205039187237 1.4200965153749501 -0.32377676004551237 -0.99293808067844824;0.28444807734918581 -2.0526674690597968 -0.032688840644992723 0.4242483478710809 0.14417424951932481 0.20521790090069256 -0.061397124407993817 0.11112761421319528;-2.4834876096948513 -0.52744723717626496 -0.26844246693814189 -1.0271900524670012 0.033488426734312751 1.0246372051503385 0.039928367785555183 -0.52279348920223467;-1.4810449760983895 1.8169535283502494 0.78014110823086757 -0.51851967314225678 0.065422139620250494 -0.93707758040670575 -0.035390426195592274 0.98040690216927218;-0.40577128946494256 0.23068770332781541 -0.090218483653961873 -0.38012763502915731 -0.5055020033919051 -0.15598239994468246 0.12440461605675883 -2.708018604778113;-0.9042331263885568 -0.83857183345207287 -0.098678621637820582 1.2527387981887264 0.56263170425861619 -0.034728326680977306 0.18710117795127484 0.594315030380551;1.1406706839746807 0.88618221188374957 1.4785314225657513 -1.0664079422756934 -0.24045585846182135 1.6400243006193393 0.29474839443568274 1.3350325784305019;1.3909257564231332 0.050935057640313953 -0.56252998591836223 -0.81680101220302381 0.53643998757470124 -0.035743304968086399 -0.10241941550158686 -0.91816183816182306;-1.2607655158830786 -2.1758264625585237 -0.32873831579686541 -0.1803875275477318 0.15205694857422486 0.52985391779786184 0.050351216436283666 -1.6838682217984446;-0.86777246435218425 0.65497784085408939 -0.18090431739375035 -0.35731507542326985 1.1731608404895917 -0.1594997267697694 0.089126888896289475 -0.8647738106247328;-0.06211738130656299 -0.96836885743486567 -1.1415835582520224 0.0097005694053840311 0.11009399037252571 0.059687831878399197 -0.042003725767162312 1.0379310607884802];
  
  % Layer 2
  b2 = [-2.2361675298212242;-1.2484432133649952;-1.0893696617510469;1.1702212337059668;-0.77301757731329013;-0.13992669862594762;0.50349924061814177;0.58149220469613749;-0.097594451846156907;0.95818309749506314;-1.0145797136340249;0.22572563171225535;-0.87414820864685594;1.6839252595480212;1.7089301312215692];
  LW2_1 = [-0.66843993704702587 0.36839750416649875 -0.66190266575297807 0.12197253054459888 0.1495798789828616 0.34419923396839541 0.94557951469682333 0.88425660499840808 -0.35062468985964318 0.18051943812643118 -0.40196361849283579 -0.5331361776291017 0.25846781887509579 -0.32469114155908618 -0.595472997963158;0.4948728503035637 -0.14613426859550127 1.4008704622295554 0.62180376662205161 0.015742630650095929 0.16324327880221656 -1.6466491695382162 -0.77112583012225167 0.3972050788409906 -0.46705439406651561 -1.030797425739117 1.0237266488520826 0.62000944492439725 -0.11125612404147434 0.98500638615423908;1.2488927880256016 0.33799830121867513 -0.85620908800534123 0.12208507105207472 -0.76607932167630466 -0.90010149879611934 -1.0184009359388675 1.6593068130289528 -0.41881323281226041 -0.12099889243510568 -0.096437273210246838 -0.15057148285786578 -0.046699610416538972 -0.32642414388033814 0.78388452542643383;-0.057942189058415791 0.67938068195774604 1.4848233091328158 0.073247106632684841 0.31138935279501334 -0.47282137188564166 0.50364280877600986 -0.025664883146722575 0.61079931781033092 0.2560553911268692 -1.3846181591219728 -0.35359257100655378 -1.4535295363289342 -1.3348615644990964 -0.60873808885516867;0.77988618985833003 0.55972676016691947 -0.0077320749059629403 0.49023578274040519 -0.77477560567225556 -0.30769505119816487 0.46960464032576321 -0.38178482786015305 -0.11658819318601626 0.1478035183295297 -0.15895945672179851 -0.33644745060937659 0.36065716498975597 0.38151938265616681 -0.099106074398218474;-1.2841068952996637 0.18369125303780057 -0.13278291884166915 0.30822797415700109 -0.57593109235331741 -1.2566792199800989 -0.70291778930143556 -0.59689628000774508 -0.37864259658065208 -0.29082432514726375 -0.52145843374859302 -0.043562895455140659 -0.29733187585557114 -0.17393843320885305 -1.2229733775022604;-0.81296954102079422 0.42203252242944433 0.86484550626026402 0.044448469162742782 0.22807707666453611 0.043228921730831288 -0.92815833179125662 0.24483522974599337 0.41681156628632809 0.13844144747912165 -1.0533395106931911 0.28274260046408939 -1.6405347990915498 0.0030962762986359426 1.188414480191758;0.0072288423671890509 -0.36864566307006824 -1.8099449365077169 -0.29726607597192223 0.057459444600323213 1.0036878167463601 1.027138825705014 -0.34423292528992983 -0.18246575338755988 -0.13833011818304744 -0.026523474571854739 1.4319030207402361 -0.2648063142653172 0.25735024319322436 0.0036429635969228314;0.069550408705704017 1.8616888249430017 -1.2136220486952445 -0.73058338795332622 0.67883747561328067 1.316287683490623 -0.16511468071815988 -0.2744252999222197 0.88471074412038209 -0.16309386663382389 -0.45672062732372204 -1.1085960548765539 -1.0019752997299596 -0.20303961426629721 -0.51143867286928313;1.1478597790189611 0.19334703966301997 -0.53457103474923406 -0.10165235063004463 0.17351016902081856 0.94172304895986103 0.21523828959554459 0.37261022250652076 -0.13267469724708611 0.31550426496834066 0.0049037008325144398 1.4203856799394083 0.38256692291627964 -0.31466926760485109 -0.59600648357028618;-0.2349605193782987 1.8342646023732176 -0.25288599130584544 -0.68109059210749323 0.080533350375587051 0.36471322233461589 0.98976150504942961 -0.10387827633650003 0.17651541130491519 0.42274081474003011 1.172674244173765 -0.37187143369315323 -0.85192200184490685 -0.20766091414250526 0.61454338505694928;0.24729013824257445 0.19182857162386105 -0.7513184665896866 0.4401376860656353 -0.2320379555645356 -0.39452841545358053 -0.68042197148448302 -0.45002878327860962 -0.20451544782646494 0.065502262701698247 -0.093657093811008438 0.23282159096258448 -0.65495702928939403 -0.0052891023278853356 -0.40316742642048092;-0.38428713297386008 0.62948882319057331 -0.16154454124045164 0.82357102478337751 -0.12300582452241364 1.7479654263493138 -0.3828707188531647 0.51331304492808527 -0.077930349166954377 -0.8232875527789445 0.14216506986218566 1.1180130453314094 0.028435932616206559 0.16269129088748427 0.86240634605040256;0.27094168296861543 -1.8744451694739026 0.16279544105737587 -0.47778427019350284 -0.42392495890386483 2.0693007834995059 0.56227977138212115 -0.049597307342500278 -0.16158064646633744 -0.46438213310454374 -0.52276289562508904 0.39102672361780721 0.073541456865914595 -0.13355089874449799 -0.12845017269455486;-0.43023969165860365 -0.062171663348455808 0.0022946538937516437 -0.12800631372844401 -0.15487109006245955 1.5578355326875286 0.60552776600126867 -0.42555459591654043 -0.072896837238767567 -0.15543199263484789 0.13546605539478221 -0.60786956683791682 0.060434674531356029 -0.16842482085503088 -0.097281703743794898];
  
  % Layer 3
  b3 = 0.012258839464309843;
  LW3_2 = [0.75111425950431465 0.49094034633134531 0.42281019835600592 1.4122704633463385 0.48638826119713163 -0.97519896686281893 -1.8950373657952 1.1677742421632484 -0.72056564227423836 -1.7293487834099401 -1.7934275314687875 1.6766560914231186 -1.01249552517565 -1.3916023453318986 1.4693448514433562];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 9.52380952380952;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
