function [Y,Xf,Af] = PM10Aguilas2(X,~,~)
%PM10AGUILAS2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:19:47.
% 
% [Y] = PM10Aguilas2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.42005420054201;0.00666000666000666;0.02;35.0877192982456;0.0561797752808989;0.00588581518540318;0.125];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.8553410743919188;2.2051466874510908;-0.97001076123866325;-0.43860035730815572;-2.1440175218854827;0.21853326988731558;1.072850941804488;-0.046944711092039931;0.53409191080579288;1.5363836448198025;0.1951983451965062;0.045409061715367044;1.1278886326945579];
IW1_1 = [0.17526776103565489 -3.0310618671626735 0.5445634813800746 0.33083328607580365 -0.085578548524103459 -0.39343430358610954 1.1871406605158901 -0.084903849939602288 0.13582238806025135;0.091850123858425031 0.21328703385794129 -0.01241818197996724 1.6887870293634493 -0.027396208490518183 0.059005013856957347 0.22770878787517501 0.056407205568218911 -0.0013496798932633499;-1.6479548239032558 -1.6740746340766814 3.8017366522985898 1.4297341340089713 -3.2495203349886386 1.0171338302375443 3.2758720808238131 0.32519435046558798 -0.70058411660389142;0.4286217030396941 -0.204091258726526 0.48443303789551218 1.0312428838098571 -0.35119505839674231 0.0094359749544702561 -1.0112804588132396 0.67740973391840109 -0.18534830620364781;0.96091470403570489 -2.6208742952544144 0.67125262687734133 -2.4666947352975921 0.2588341204128865 -0.17197174342685731 2.911238269387237 -0.11975542427363181 0.47796306941268846;-0.29509272310597673 -0.73464168780793593 -0.53724801896872521 0.15692028751969261 0.16514230135911401 0.15752748233482447 -0.40333458323924515 -0.0070586013342428646 0.034056078951578098;-0.32087053543415739 0.28580803664519883 -0.16523316653341774 2.2599439144730384 1.6999117820109992 0.54386287058406368 1.6139925849857633 0.25799454657460275 0.40560467370046299;-0.19797384361404174 1.2371027913864188 -0.52481998985470824 0.36936236318154181 -0.20237589525183081 0.64810384446119973 -0.45405735871131614 0.42307821611714636 0.06268740743724488;-0.79870559361561833 -1.2902758812356179 -2.7722648364283238 -2.7228670755330664 3.643625859101439 -0.37245018678474318 -0.14886692998239137 0.16559652374173334 0.77737539506409448;0.97232847175413128 0.11327900789125259 0.73441349698049563 2.8045268553954088 -0.79713051600063201 0.82347588672248417 -1.4032332008275488 -0.86375313935802844 -0.33833639569765928;-1.2661150133016428 -0.054064657436186742 -1.4530483869470334 -1.2431023673389314 0.61138491334722278 -0.96160251604017222 2.8635758599495635 2.1293871221828922 -0.39444985888878292;3.1503297177048801 -0.26740454185419915 0.94201042502731269 -3.1641883363556236 0.29117704701350289 0.16008704085890002 1.161949466043642 -0.010962102760128496 0.546081654073998;-0.044915979005898478 0.54873338976194308 2.2132132913407427 -1.0110973566549162 -0.37999130964761085 -0.3159060104977669 1.2093527122159187 0.38010225715147405 -0.020406049699402455];

% Layer 2
b2 = [-1.4162996425110534;1.1677611798306993;-1.7465054645650793;-1.0695286885617443;-0.31143513893810459;1.5638468435699067;1.9199772649352298;-0.40199084858217615;2.9637023537815703;-3.3780730185835988;-1.6915377665479279;-2.857546325956541;2.5420025501179246];
LW2_1 = [0.75557189860931195 0.31747230411506033 -0.93206972863256499 0.2232064293881631 0.29484415237593731 -0.66353055986898091 0.24486775720078227 0.31753969708594554 0.59822216019174768 0.85920647438478981 0.97455934400452493 0.20457736245758068 -0.66824180331487004;-4.1831803055619092 -2.1800236182474464 -0.11053202473470999 3.4135069839508181 1.9306663900186152 2.5089514178518102 0.14028477291823069 -2.8290842824719831 1.1503410916381389 -1.55393777755841 0.216481306629102 -1.4592995760675658 0.52374094959120576;-0.013171531796814503 2.4395494605578918 -1.1340586145824054 1.4623773336146255 -0.70540613174898714 -1.5801122999653185 -0.37478951948087746 0.75856570305540783 -1.6198602785008593 -2.7982426212076446 -1.5674223710902273 -0.37110733690930725 -1.0835836783071582;0.52302909709804524 0.83188903878961018 -1.1447445191175809 0.85616292038335129 0.50954547584431931 -0.71448977495025079 -0.044531408709227671 1.1996785851055809 0.88210993128927362 -0.49458405562619401 -0.044503810713039674 0.32050513627143773 -1.0332882936149514;3.5789995894337094 -1.5662700659564843 -1.0571172243630935 -2.9175976012132883 -0.70949950282926233 -5.0876772943489108 0.96974551868405179 2.1607203232949237 -0.32749025234332252 -0.64798710244557611 -0.8803149975478064 0.20456565380305522 -0.93266926899407365;-2.2620886767569619 -1.9043301092454152 -1.3088326754273198 -1.600040160490134 -0.12840275272836899 -1.5528901280927074 0.20302925459799967 -0.24418445029432811 -0.9930457037153908 0.70331825442708784 -0.028555365501565025 0.095485954160640304 -0.85107737427067864;-1.5396852452412986 -2.2833102356185795 -0.0087882475771321224 0.37657080810771248 -0.37767668554039474 -0.29102043149394768 0.7876738171526152 -1.0795416472950892 1.3127540753327149 1.02419743844231 0.59170708064553312 0.66982105029246364 -0.095898709312404545;-0.72651993686833594 -0.20300648949028627 1.2361326251217684 -1.2752991722238496 -0.063813214410239572 0.025136778760522643 -0.35329551642074852 -1.0552516651008326 -2.6835929922254271 -1.6467972186389042 0.27369986847103667 -1.9660407125303088 1.4038409616225156;1.1176996859886075 -0.55791498417248298 -1.5502362632766464 -0.13347553573075105 -0.10944417270187701 1.2611958620826638 2.9079653241699019 -2.058311827803907 3.528826140280549 2.8950921006486836 1.1767884315318042 -0.79212534113337874 0.47095051176641345;1.5232133074488114 3.2039233974131633 0.85620022919673544 -1.9605083451538181 -1.6052255375711477 2.3079310742286183 0.37989497469577582 1.8222410116039054 -0.58775053879461236 3.4776712013488371 2.2302676731653452 1.0948745713905434 1.1999669801487225;1.4927087117836795 1.1719404470185177 0.6387103792057347 1.124205075427203 -9.8598546167218402 2.2546289143657448 2.6318053789091995 -7.1070448963017938 1.990466719504641 2.3311719582134449 -1.107813001390531 -0.21852325126932981 3.3637636323359392;2.2220269184718515 2.6686688934804925 -0.33692584686386789 -1.7179708562824296 0.86809045294174847 0.97287936161559818 -1.5051255547809621 2.4791050741600582 -2.2605037546041085 -0.0017351654594495031 -0.046780841591015358 -0.99289820260550432 0.25345803596904132;1.0198020635545073 -1.3073001333398324 -1.1366110661149518 -2.7891433731952411 1.2711832521839248 1.6849119402240744 -2.0146253915004473 2.3935144880708301 -0.87877548420281637 -0.12620718523491659 2.3654748082547825 4.1498220727568773 5.2674967330567908];

% Layer 3
b3 = -0.63845157447427403;
LW3_2 = [0.41242450840662359 -0.10663665422816362 0.25485440420572369 -0.37594206456482149 -0.16407241803414679 0.20254500749372412 -0.55144302859636196 -0.096586696531952287 0.1371282857105994 0.078152045855030605 -0.014484063755177445 -0.29133098547163616 0.076366111712505041];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
