function [Y,Xf,Af] = PM10SantaFe9(X,~,~)
%PM10SANTAFE9 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:34.
% 
% [Y] = PM10SantaFe9(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;0.00341273633199099;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [-11.93563700761502;0.11284309267765252;0.68482015642313743;0.2563919410487433;8.9879152689748398;0.15265742815082819;-1.4332524594219178;5.1932993712820066;0.37788558818407847;1.9393291907546373];
IW1_1 = [9.3689950891478855 1.4151882972850567 -1.1767288144188466 -0.097196587228651904 -0.56896119489920483 0.12481116060292316;0.10351457836119562 -0.96490944342839835 0.45419957967100022 -0.11747568670675922 -0.32377415138087429 0.023459466037424836;0.42591686111563903 0.2199298219736244 0.26886857282319543 -0.1824016373502102 -0.38667334738803583 -0.045703941547574511;0.78922506301812345 -2.3218393196806075 -1.7425739707720012 0.95608483928017518 0.058231147288202986 -0.23720379704970732;-0.89322482853905949 0.13893627419657931 -1.6409248660470943 4.159420274678487 1.0766428152596632 5.3854378725085548;0.8026714319103051 -0.79611872478009171 1.0364330955679306 -0.49035719598347377 -1.1148651954890416 -0.1869693247415429;0.54650195321870831 0.12356203889568627 0.15397173098170305 0.053151776121528202 0.19060971192297083 0.32706957057881614;-4.2864888863134496 0.038321630355258221 0.29588871687756668 0.012144677596774733 -0.12706454598228412 0.21359041223888803;0.42145575055999202 0.51394135073489089 -1.4933030665876059 0.75846363205485678 1.214930194664112 0.18810368978460296;4.5515531137363823 0.13972152937861557 -0.17808407287112207 0.59320841937702473 -1.5464319064112537 -0.25720064944800608];

% Layer 2
b2 = [4.1336950783121704;-1.229687181410104;-4.7337768686461601;-7.7411904590267273;-9.1391069539747107;7.6796839201368332;8.9588296347168104;5.0593274126922978;-6.0059181485630626;-0.62251224635804858];
LW2_1 = [-4.6734806627869192 -0.31445692132282727 2.4779362353482117 2.0696826619123709 5.3090859309808307 -5.7336463372344619 4.1991584618639752 -10.94102950237709 -4.8562669935534757 -0.30461124430926589;-2.1130318061634372 5.5751620022796731 13.750879568387901 2.30930975133559 -3.0349659180242452 -8.4964035052668834 7.6048297603382657 2.8401319046468356 -2.7919677105434006 -1.514157894843736;-2.3973660967362553 5.0174156065594948 -1.5473070491060883 -2.1448316306063453 4.4820497649124533 0.12353734518820646 -6.0495551699590413 -7.0123459178630592 1.8937555675264892 -0.30252759620185249;-8.0872845050938658 -5.0064101623672155 2.1745423094624594 2.3219485867028111 4.0865326231369004 3.6422662160207384 5.7712340353363611 0.24671583430447686 0.91359402448686677 -0.85436329092856089;1.0400743137294928 -0.67157638829329458 0.90212186086706148 0.57818371322029793 6.3024449570602972 -2.1536690950233153 7.5592300195846391 1.5531620328178162 -4.6610892940556798 8.8375179764565033;-3.5072838352450657 3.6002367697234843 11.111760446724032 1.9842261519134492 -2.5270781667901003 -6.2963045658140118 4.0256432288544293 -12.538349240719407 -3.1863435045347517 0.49116471666107697;11.236139229487689 -1.9345227820106754 -6.5956206801492083 -1.2807845162670297 -8.1945193957740425 2.9317185524534883 13.524037942928139 4.4279821083483313 -1.7237855796719062 24.034448855961067;2.0355632362680245 -5.3923220786199844 -0.58688009897871185 1.6816065329622427 -2.3290378322013741 0.95323675811606823 6.2852310052753175 5.5463641946152551 -2.1046731451298748 0.42164530770837816;-6.4251093006303917 1.8253111309075658 6.7556514185307108 -0.0098829962577778596 -10.685084929928786 -1.2068763445173387 -1.1694574382004819 -9.882940443191222 0.85974817697101025 13.230338164935837;6.6778679782955388 5.4332191237810692 3.811120658313794 -0.76469986480528707 -2.6474668078995971 -3.5592872141409524 -4.1612048189918589 3.632950823436738 1.5180933794279938 -0.3957814761054298];

% Layer 3
b3 = -0.55608497349174402;
LW3_2 = [-0.16053249255297181 0.16115811118108145 1.0354159389501763 0.31825514553363782 0.2351357995609839 -0.26824942992618417 -0.18574092604761749 1.2071305121906246 0.32463277055902234 0.42114069882400962];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
