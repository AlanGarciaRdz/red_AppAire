function [Y,Xf,Af] = COVallarta21(X,~,~)
%COVALLARTA21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:23.
% 
% [Y] = COVallarta21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206;0.201288244766506;0.281968137600451;0.290275761973875;0.304971027752364;0.100381449508131;0.172786177105832;0.171659085057077];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.3764220878245914;0.70724538735177656;-0.60861901481517888;3.5808874683227083;-0.49537503529919624;1.2439454345682417;1.3428556485436793;0.27258305833393709;-1.9601383457382153;0.88847682821798035;-2.7170831686993417;-1.4726140901718312];
IW1_1 = [0.054356786355477672 -3.0319224732378429 -0.35253887913170046 -0.17608704693196101 1.1115706042349616 0.50519822754422117 0.076361918197416709 -0.30675852707396373 0.6358289727919344 -0.18738050766800574 0.043783020368768084 -0.034998807237617585 -0.19005078995848812 0.090998765431104384 0.13407698041414962;-1.1825641191396192 0.14332842426762707 0.19184831668232163 0.02243943147802073 -0.80756330926790543 0.78780394175059543 -0.036843752072556711 -0.20206091462307646 -0.12873411421706957 0.24548521083528177 0.51679605214339841 -0.081255728054872717 0.45327756474037956 -0.17724193679671643 0.020389599290540447;-0.014330648630070615 4.332075800083321 -0.22583267757925921 -0.099190020053811986 0.82031530349964277 -0.07355773099035344 -0.036651855393225428 0.11556713322699363 -0.1627051270551369 0.10444318404571457 0.029366538464965227 0.049050632530954708 -0.20137665577500344 0.053635658465271102 -0.040820609614647507;-0.068466743435239077 -0.25779844268141322 -1.1283783933314659 0.47264304299435861 -0.78242327206366913 0.078640856097688852 1.0069318661471849 -0.86288833827202127 1.7285737843112665 2.2628731400474886 1.1920829589713537 -0.85723358155209106 1.3833814975972234 -0.7874152371754165 -0.20772011279248503;-0.086024221444949103 1.7910797694834901 -0.080941083739596978 0.035234053076691342 1.1631429556938044 -0.318045799888165 -0.11931236751372665 0.2720977604759563 0.23053652589361992 -0.046964695345319607 -0.048149262770919576 0.25338863124476191 0.16767292864042252 0.16913492397085828 0.12987891549570213;-0.052941824553433214 0.34203887157492263 -0.41337899196300043 -0.32533690727015485 -0.0037712419012546072 1.4984368383244917 0.32207556108770724 0.69972151326309939 -0.92611757026093922 -1.0329407203441292 0.77802263400787652 1.8003181654867071 -0.71790676112669216 -0.30953895869380638 -0.087940028005849658;-0.91528945362362413 1.4892723881642307 0.28180850274836944 -0.4678679894583222 -1.3960267107902851 0.30815101158226144 -1.7033588904646626 -0.34547757125058826 0.99547886023201204 0.08433581522222397 -0.83709366649283079 -0.73039193386733914 -0.87502351732335648 0.25126661710371195 -0.32461485978488214;0.64711827000323274 0.73930060815422072 0.7276034585218476 0.08927636412186743 -1.1037015111653155 1.0141275013783346 0.2734175061352192 -0.67145138109472402 0.11349334083735081 1.3573010348886982 1.4909091819646787 -0.88147893850879999 -0.91594438384684917 -1.0862809705651062 -0.19076862880378065;-0.51706201325251178 2.5067169116623833 -0.016947340053003093 0.49957223998478723 0.91354141201632255 -0.50086203338069135 0.44929678503638881 0.075653157314987132 -1.0487195834183494 0.83296971854179214 -0.097299546981428342 -0.72197853440362902 -0.28670013553186247 -1.6050962994368105 0.11153166266495487;1.708927749163093 0.91695354285472297 -0.42255866552885352 -0.030246846250081033 1.2418449229658932 0.042755354390599742 0.28964529523867505 -0.30422708134804788 0.040514077679810953 0.47193418022302192 0.22570558398934298 -0.64829154992213878 -0.52272854292505533 -0.31886075715601891 -0.25596308542006135;-5.4480106831543127 0.031697733843270001 0.054075676352873435 0.4135048566977132 0.47075258104928458 0.31043527010736338 -0.1129998851984467 -0.093053345647079594 0.48109325453742152 0.69172306755932322 -0.41943136550918103 -0.89669888212354165 -0.41706794654465468 1.1560415567775382 0.055799727047558992;0.77916100488037388 -0.83129322050343291 0.88923925755572553 -1.2571141248355218 -0.22363758578840609 1.3406441115262153 0.8015041581172675 0.96460244425485397 -0.38869349247281859 -0.64393449680275272 -0.08558043032325717 1.4441239425050389 -0.71471021231439058 0.62327907625050072 0.61802053834157988];

% Layer 2
b2 = [-1.3859718943853894;1.5684143072293795;-0.97348337403648166;-0.38903730022637467;-1.3638760702420365;2.3046949820049192;-1.6020298843247163;1.888767228587904;1.052383130600353;1.109860207851185;-2.0061296362369019;-2.3781877264882025];
LW2_1 = [1.4922648433604027 -0.25558604708287358 -2.5968174519273441 -0.57043931310425766 0.4772165083565359 -0.41943886077690656 0.87646412004238872 0.68888706821523749 0.36481336883110194 -1.3601207549259926 -0.37894007071659153 1.5423854528518761;-0.5769962091517602 -0.45327457449225012 0.71518727535041271 -0.7238778726366073 -0.5162181653631388 -0.21638138254808564 1.1901672460593191 0.64302447552666686 -1.4304697892436404 -0.29038227054681487 -1.6022900738550057 1.0357645726269127;-1.6662443671715577 -0.72277603586769168 -1.7008411337624276 -0.51408102688737323 1.3081314585977291 0.15300061890769689 0.33257736647423397 0.86343793221031373 0.5642835928804365 -0.014132779364321037 0.30012527918119025 -0.05045027862161286;-2.3424819928526208 -1.2066234518154981 -1.5521299682938678 1.6383219766789838 -0.49341436381831871 0.29472820512126302 -0.34220041681980784 -0.60054464449550005 0.042139885696714688 0.26070314528222155 0.78682286619907615 -0.48248572539735429;1.9778739397334828 -3.0041341646352113 0.33481528899365259 -0.64429467111416772 -0.28052301003590135 0.24868789385765874 -0.43255720267151015 0.18509218509880357 1.8779265209004787 -1.1921257273653998 0.77202410012322409 -0.69849880383740337;-0.11089902126273773 1.0290386418976682 0.34111958891766503 -0.90630748066893596 0.23916770628922177 1.6312080637892614 0.31400960233415337 -0.54583190937360304 -0.071836049014049622 -1.0790693942277856 4.6856076690881814 -1.1997971305906989;-0.14509814846453942 -1.1506056158129285 -0.77445500335076811 1.0878061198651867 -0.18471241505410979 -1.6678916059790425 -0.73727686276080306 0.47629462324983929 0.25772465597073713 1.1537272019079969 -4.4726478317510008 1.2172556257086207;-0.13868212278255776 1.0680285315082894 0.43010040314885373 0.40780851116059602 -0.96863754516275591 -0.35281959690755038 -0.8122888018611476 -0.7541577199787769 -0.54407484641174464 -0.76407448487515361 -0.13221116991212215 -0.401158525636164;-1.8706275972971842 0.3802341208250648 -0.67569742625280049 0.78601457350056869 2.3791460341908177 0.37074795246883518 -0.70573860229105034 -0.8786261559208578 -0.42113957395587809 1.5836336528389767 0.45652805978561445 -1.4153231940113349;2.0633777484082039 0.16369824473872976 1.2544691595278021 0.63360224172791924 1.092021336978537 0.20442419299513664 0.51342575781554189 -0.43107642622542625 0.062773883677651229 0.21768804509895798 -0.46919625273843635 -0.9346801471686923;0.83591858292816124 1.6397043949009982 -0.04677641837705647 0.34979236948801939 0.15030291836595278 0.16083883729920681 0.069626712556082465 -0.1819069983981039 0.63727706201122958 0.46725316574719283 1.5022868002453549 0.7573862904840799;0.57480852484633571 2.2609464523789389 0.64276284303040665 0.0057998255744665453 -0.86995441105503124 -0.077965435870693336 -2.1121605085722512 0.12674961639629193 -0.38667198115855611 0.43647728365213373 1.0283968072869325 -0.49432356390266724];

% Layer 3
b3 = -0.021243365279821042;
LW3_2 = [-1.9010014032389526 -1.2476843324410902 1.7861185345869464 0.34723546028845226 1.0259236919782286 -1.8958566275838993 -1.7711705803935385 1.6375467345639356 -2.1513035780844594 1.4095757850378512 -2.142064340922766 2.0040421305580933];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
