function [Y,Xf,Af] = SOXVallarta17(X,~,~)
%SOXVALLARTA17 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:30:07.
% 
% [Y] = SOXVallarta17(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;10.4712041884817;0.00782778864970646;0.0208333333333333;24.390243902439;0.02710027100271;0.00630517023959647;90.9090909090909];
x1_step1_ymin = -1;

% Layer 1
b1 = [-5.9157728201095701;2.1343615350957061;-1.5302408643315606;-0.39796955055053779;1.5358626120685692;3.6452139984161214;1.2880282084869137;7.0102009471247726;2.3808468100958105;3.3887874910448628;2.1668275417693916];
IW1_1 = [4.5927835381224931 -0.040709980236639673 -0.21542295078587098 0.15829457067618075 -0.057449479562784109 -1.338315033477625 -2.875289268129984 -2.7334669486674614 -0.076373587605929591 -0.77296897344851323;1.1580482692059586 -0.060775973271493464 -0.32428872721800689 0.87956661696582983 -0.31048434274359415 -0.54572066063252811 -0.012307149507622933 -0.3470375723107052 -0.287038843310784 -0.28777662718612712;-0.05126325390777671 0.72826620431679967 -1.9713593197075225 0.16590555354753472 0.57247675585819913 0.26660000052183308 -0.71698515833015963 1.035509942848496 0.86336106956082537 0.63198197139575407;0.35956416166407584 0.063696859569980932 0.29164639289562488 0.30761025471653969 -0.5545349093732973 0.69183531664014786 -2.1479733274791579 -0.12058457547929599 0.65415794520747528 0.16023949528115516;-0.096196122284225208 1.0105239754997648 -3.5940246565345326 0.40586879031140977 3.0245857867819073 1.4681383536489951 1.4025795853656786 -1.1830068231754785 0.019287170479134155 -1.550058347836561;-1.7483103592715359 0.16313450719161474 4.35717513234672 0.0062881232035783968 -2.9324384459411501 -0.20136234643128242 1.9420273118978097 -1.4153767446627941 -0.22498640005389153 1.5569357852343741;6.0864446460148676 0.30331848327533584 4.4065133637465284 0.39406086220794956 -2.3993832073329253 -0.97685095394294819 1.1888609123524123 -3.0324908126625565 0.24211025183296164 -0.95704792587442744;-0.30095370154881229 0.138522368065115 0.31868797476603483 -0.17966157394597213 1.8464602676925015 0.31061419463846562 5.5653401431247209 1.2269970176182614 0.2888390216122394 -1.120647995777303;0.58305664668829993 -0.50469185247604009 1.0444173963979768 0.64587134419406034 -2.6462167626526094 -0.63393533643467925 3.7010888011681962 -1.4801810245551787 0.035355294174212605 2.2260856698015474;0.6486529726171768 -0.012459873695768835 0.076013192821916792 0.1581220108393144 -0.53149092883684768 0.44912800395982599 0.25768541506688136 0.52176551761427847 0.11590684875679404 1.0567747921895809;8.2944018059365092 0.21231800232859918 -0.44206042217972286 0.33086016162720722 -2.1649081940538459 -1.0687213637959694 -3.1925909952806983 -5.440116035386513 -0.47263120163258387 8.2043888976459467];

% Layer 2
b2 = [-1.1724403455194117;-3.2870875874522958;1.9895321169278208;1.0643488566402106;4.2696953762908212;-0.82431239608697682;0.35255611509658591;2.1720275488549814;-0.31679903001479542;2.6396406725585937;4.4365677906423402];
LW2_1 = [-0.98477899521518186 1.2873752354012131 -0.066397030647474348 0.85586335249598022 -0.53626120822283152 0.16078732995928074 -0.45882391438770126 -0.0055731792521595477 -0.28800128178550349 1.4419425100660577 -0.37637500408416191;3.9998162113140596 -1.835836978665202 1.2920153375222505 1.0874297204085204 -1.7301845598765042 -2.6269496515584358 -7.7542110810784566 -5.576663324103305 -3.1799956223160479 -2.5205436145847 -0.53005892827586842;2.5135850061334173 3.5484752848750318 0.50341028611657346 -0.18111268991564489 -1.7572452887027341 5.8987880351890736 -8.5550927998239317 -1.4209920643489375 -3.2909716879313611 3.4434652304392452 2.1170153687416629;-1.4768555981674321 -0.19121623493988127 0.24802413414841107 0.15127519923570995 -0.041388071340962798 0.28240703355244512 -0.55817052453200744 -0.29164733468190307 -0.51841692181812948 2.0671382029007463 -1.2008192520726113;2.4922338303777214 3.3809349347778168 0.49936987282083112 -0.3037910300059975 -1.759339121840225 5.8690663687581353 -8.5018569361537999 -1.4207225196508566 -3.2670960247990828 4.040078207030354 -0.52451611407838494;0.28552235697813183 -0.28966284173470136 -0.00073816999400627692 -0.81917694974258959 0.73425675043724892 -0.3610951267443781 0.46964269690615162 -0.00082202793989078404 0.52759528847454584 -0.54594191118449553 0.69900589603928687;-1.8999737558020431 0.93833294993286487 -0.09750451929074716 -0.31466714142232649 0.19216571074533026 -0.42220468465933358 0.024243261084497397 0.044682472987604374 0.050146870325348598 0.61478387547155688 0.07392392711389513;0.04384649868497853 2.0964632667795851 3.2450889617499912 -0.33016517809912382 -1.749052690659743 1.1983490801953467 -1.4912836715244173 -2.2489123240515636 -2.0464042653298247 1.4998020365688978 -0.13860671085933327;-3.9902642762463501 1.1120114823241591 -0.048952706014748083 1.4168554296060576 -1.2844171382990386 -0.64343759779845677 1.1133449346175162 0.058161871495541972 -0.59752985413735016 1.6177983866748598 0.12872204203855567;-1.8138582979397468 0.27297135389928412 -0.45511902018602973 -0.0083097269805795342 0.24950512255622478 -0.72286283779253491 -0.16535054211130784 0.31747264532556069 0.52814180609661787 -0.27281763678088278 -1.1913710009416323;-1.7614612658485009 2.5271811158215973 0.25736826018542436 -0.36603556009618576 2.298338637312566 -2.2656136923916739 4.1571473883827537 1.0226825013888816 3.1566533267996575 3.2244587498181794 2.3159156393119531];

% Layer 3
b3 = 3.0532596497186266;
LW3_2 = [3.1509086123461785 4.036345841737198 -5.3026757022726958 -2.1953937209133927 5.3151607308661815 0.94974600171654855 3.9473074382701916 0.050545784140523159 -0.6151569288226767 -2.352266084178003 -1.0527444234595196];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 35.0877192982456;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
