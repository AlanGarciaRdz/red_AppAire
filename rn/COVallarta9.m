function [Y,Xf,Af] = COVallarta9(X,~,~)
%COVALLARTA9 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 13:57:20.
% 
% [Y] = COVallarta9(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 15xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206;0.201288244766506;0.281968137600451;0.290275761973875;0.304971027752364;0.100381449508131;0.172786177105832;0.171659085057077];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.30377914092540126;-0.38152663660456387;-1.5470328201541774;0.67612232221751145;0.3927281371069013;1.1618356372584742;-1.8614719671951498;-0.98836606234195923;-1.3302218686150775;0.54554981371674138;-0.97387474694192278;-0.52188098319501008;2.6860097359073656;-1.8997873376721124;1.7196539128051549];
IW1_1 = [-1.4144006512278837 0.26112407198080173 -1.1114243877305892 1.109799279133947 -0.92235013791141673 -0.58112208240468555 1.1134699699058532 -1.1993680815271019 -0.21256207504993541 -0.21388774283185993 0.53952245692260659 -0.74492775724460214 -0.051485789416436459 0.32727303291959098 -0.71242638904608435;1.8927148514459666 -0.70431276484374572 0.54417497828305139 0.14418641881750671 -0.22826618243239927 1.2943829963236979 -0.0064678735393605058 -0.44069238215016632 0.31278200694998054 0.3383704676769988 0.14743881420238997 0.061689145472904293 0.30588125180337794 0.19282795681226655 0.21466535456402833;0.029425370557239955 -0.46076575550531451 -0.21088841378800033 -0.50876932724031265 -0.50401100201365212 -1.5298946992960736 -0.14900150462631828 1.1832445488304926 -0.055812465759415501 -0.78433542967116088 -0.049801550715857137 0.052656132395720257 0.05358594533026944 -0.26966481228907024 -0.01071644169956976;-0.18472318837734311 -0.64313132950149443 -0.15861720988372074 0.42018026089826171 -0.65799010716089956 -0.8949780272769996 0.10019032471963031 -0.1591168477842258 0.056371741698570538 0.51558813655215796 -0.072242340475125025 -0.1736633138686452 -0.21159257168591253 -0.3579289363124194 -0.10066779333083704;-0.26543000961249552 0.98534046984250911 0.6183635607183996 -0.067495361236588072 1.2726290383903023 -2.6172885339862941 0.21118036498059234 -0.96289278229447861 -0.74480721919948656 0.31421890117149381 -0.18170529116257017 0.77718420226693308 -0.92490673955806646 -0.98279390503597575 0.45273552251967231;-1.2187509866599211 -1.1080541541706981 0.15462841831176655 0.39334386263223953 0.17845394119094921 -0.42293781509888934 -0.29160765355437257 -0.85191929095674623 0.92157997466915487 0.51149994302707802 -0.14151856683911904 -0.18123842543339921 0.55614541282338581 0.39666060914283124 0.14931395973533237;1.5737405706467 0.28509714682564657 0.32010579021271751 0.78139873287978079 -1.7098308345175079 -0.53550511678441015 -0.11437660783302574 -0.12501765200048587 0.63171132523522966 0.60385219478423191 0.11620999023115913 -0.68932024525565538 1.413632899851877 0.0048684124889343105 -0.59860125302017697;-2.1125139179994208 -0.85359355908847856 0.13013147277855733 -0.22800935978064127 0.74809052866253445 0.39959846230322182 0.05644242485897636 -0.39477051616333902 -0.030403283301362223 -0.072093172341064243 0.039198583076172841 -0.16686990970461912 0.38318119009027451 0.8851067387111039 -0.13668813377348793;-0.59596090561668968 0.11610444338767453 -0.51610360531980248 0.096331236677690169 1.1040970013342304 1.3973347169315375 0.07094117688353406 0.73938466526078295 -0.38755776990067858 -2.3351746336482329 0.58183155845722523 -0.21616544628150092 0.077563625543925652 -0.006933991277831314 0.87871123236303728;0.26679965158905528 -2.1518700015143248 -0.054446952724067563 0.11967449266245875 -1.0754545322181874 -0.16427516796402702 0.1108422254371325 -0.092736106091248965 -0.25858927492982714 -0.077055116494803774 0.029718746016028936 -0.014250914417055225 0.10705798527793459 0.12457039684596073 -0.16997190351889169;0.68901723024774675 -0.011862240803869092 0.070032780733358585 0.53046144786870841 0.28752624174042785 -0.15635110899843951 0.39527649075166377 -0.45006666673752632 -0.58299036705338281 0.3073882482419415 0.21400068376783668 -0.4107293376253186 0.021819956703370724 -0.39398593708599478 -0.30863139625761282;2.1292974247315444 0.45503257389084845 -0.93145766498281002 0.75556157307770044 0.027199592564292857 -2.9003575518130744 0.053423072867657601 0.55690241355930592 0.60100009585154268 -0.079872737529760263 0.52310804016752599 -0.24540437206673155 1.1661742030895006 -0.82622875214155256 -0.13804354341005326;4.1757384946095941 -0.15490848120893111 -0.17783879027144167 0.27533291736737231 1.1222396507464794 -0.14533315318364917 -0.035098439917566143 -0.4017015895341528 -0.13598786154821613 -0.17130210100200463 -0.27761208085957206 0.09203617882042231 -0.68734043252940269 -0.095770751953720007 0.4999084347447843;-1.0836391660858848 -1.0218223856483097 0.42465916691095557 -0.33964726617467794 -0.06585163113784559 2.1840694972371768 0.027305640722247226 0.81483672496034198 1.2887929861544074 0.90549195785267866 -0.50518331833190033 1.0445368935263679 -0.71689075568478922 -2.0805287028733348 -1.0807999115480256;0.22717699460728602 0.44749460687078757 -0.3393052712733467 -0.16305485698647715 -0.44078556904629784 -0.52848982019016943 -0.70513338887330024 0.17336282730900551 -0.037319700961890696 -0.77255658396337379 -0.31907064195607704 -0.59685378990462135 -0.46832048374940766 -0.58370391433322044 0.082026618809541985];

% Layer 2
b2 = [2.1110823150737938;1.0168551330844642;-1.628520483506781;-1.2123126894819329;0.63482589332410044;0.63449105577244613;0.85524730145642847;0.17062621695983393;-0.58069052705957469;-0.70750449746920963;-0.84151412978322582;-1.2285795923772154;-2.5280366705597697;-1.625588551077721;1.6998029628768339];
LW2_1 = [-0.12000539030467923 -0.29877390383115321 -0.98687670514465131 1.5166322050865204 1.994139298913298 -1.0151689735359741 -0.18501903475590831 -0.95660019301564847 0.32232636114953961 -1.1028715458217901 -0.20763874393181317 2.5275434669406653 2.2693667521524006 0.98095765187207595 0.77246675356442263;-1.0058448504391722 0.087296860399724716 -0.21012797113246878 -0.54219232032361164 -0.20039634465364611 -1.3680398352566867 -0.092444268638950902 0.038930088722647499 -0.29562205685737586 -2.5766962806694131 0.88855602045276283 0.083135659926318731 -0.41807898014190359 0.87967358364259463 -0.91044124206044985;0.40033755994996378 0.51246137345972576 -0.084241269613093098 0.85388743437953396 -0.31693865018708678 -1.2223678929183441 0.44129371934773509 0.0040427152816342182 0.3750106724617992 0.83853199763316455 -0.19670427459371723 0.11566862592384636 -0.40059229676889141 -0.32711759895218473 -0.7854576769638455;0.20786082216239027 0.52673720474945229 -1.0171767461688752 0.012643798350596175 -0.72477608746597566 -0.40155068077365563 0.11823634525724119 -0.74110474964916939 -0.9437377599368344 -0.18312594373073943 -0.47472310055583211 -1.4313743989404228 -2.3709746585318427 -1.1682924502741863 -0.76671025920840497;-1.0458688410515617 1.6112625197727932 -1.0878608071191447 0.13425912200943196 -0.76981873920982735 -0.36899865621326411 0.81051847334937099 -0.42446920357174417 -0.84816989428479184 -0.33801937322367615 -0.49444665190970405 -2.0082289372653048 -2.6147640501054701 -1.4859387925168956 0.18230872003023785;-1.2146294081897524 0.36837874660083048 0.78700747055755049 0.70110265354427592 -0.17279924655135706 -0.22879967382804672 1.016137036296956 0.42237384700821323 -0.55432411977646889 0.13709901579742806 -0.09517354582186642 -0.91210047767473634 1.3710480155558669 0.8801990389066412 -0.015281667697014837;-0.70607331801421902 -0.31717870205383408 0.34741561953404487 0.17752181862255992 0.076528581792248251 0.25584625952304557 0.33370127186296916 1.7656541087130957 -0.063585256040607815 0.24744870165947941 0.11862619472034897 -0.24436376900854012 0.8658594816880173 0.10172150802171094 0.020346995775196566;-0.59537187735551766 1.6152249486898853 0.36626477487553116 0.69820210641452352 0.16377268690392816 -0.22921687404162452 0.59625883167733151 0.24411501824811269 -0.19839918296067288 -0.69446688414565072 -0.91377445096493248 -0.88025296481910942 0.49836386009826034 1.188369246890951 0.31038163884935682;0.18330914659036507 0.71604519350003948 0.013252260869762014 -1.1145940341309064 -0.24057945519185422 -0.94893585413671 0.48080752581282665 -0.57927305125462791 0.07381620940458794 0.88528296339525248 -1.2653845909871055 0.11000322728843964 -0.94814929583762653 -0.1360367077831649 -1.084996670973335;-1.0131423785943217 0.58149427113361918 1.0555775774546843 0.62967823421787927 -0.11676743742364856 0.76559011691568779 -1.411136151978827 0.075843868599069608 0.9323621034004832 0.56220106664096847 1.0979239921359862 0.03412082341444668 0.39809997708890782 1.2794946939630991 0.043160266535296407;-0.30007511943631521 -0.58999528983293636 -0.073739115008888995 -0.51691708693242122 0.32331111244717925 0.42947064582787486 0.53859310231856383 2.2233602020526 -0.4243443665486219 1.2104039834042861 -0.29571876757674942 -0.31703110832745235 1.0756494019374649 -0.21640122738691556 -0.34471834686587599;-0.66123017358451153 -0.23796321638811335 -0.11278523415585437 -0.17719565605636006 -0.52799098333556993 0.38496966457337561 0.12068072415766301 0.17690626540121215 0.26253059665855361 -2.7153004862128944 -0.50157800455734836 0.73871124665425481 -1.6174531223336766 0.6686728513711393 -0.16664332794287126;-0.17951864755798894 -1.7613657145650241 -0.51925356826543212 -1.4681250306332208 0.76318945577887354 -0.98792649023666501 1.4734799142369861 0.45995764018250773 1.759671354282486 3.4954080710672404 -0.36059708854246653 0.57126291909313398 0.87469594565700304 0.42676650967680768 -0.76401658732672983;-0.50962912483438016 -0.6646573548166046 -0.92196222982990172 -0.31634803826697511 -0.062434370695602648 0.95703763856781832 -1.5434407008019828 -0.89438227778722779 1.487778201657862 -1.1960639889820517 0.90805828307824532 0.31189954609190884 0.66217190238750356 0.072791643234371359 -0.80107503997543328;0.73901222975027547 0.53395253961740596 -1.3475963391979981 -0.39439480826607576 0.87432282870005495 0.41298935009566667 -0.22374232457904022 -0.94834756491511896 0.068789832596068162 0.79010701695142971 0.61425872333859355 -0.50403693071735522 1.1921972622687145 -0.58152516650899388 -0.14470079282416148];

% Layer 3
b3 = 1.0422539357930676;
LW3_2 = [-0.45306509422685876 1.4030081157984267 -1.4509547858224738 -1.7872905763293481 1.6223575708005955 0.56528080568040528 -1.5965271407380917 -1.7960972103767239 1.1865894133809625 2.0509218290270739 0.88835152710841991 0.8472505843522149 2.8440530129379562 -2.1174540608964203 1.8533304598724356];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.448430493273543;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
