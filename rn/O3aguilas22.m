function [Y,Xf,Af] = O3aguilas22(X,~,~)
%O3AGUILAS22 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:34.
% 
% [Y] = O3aguilas22(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.42005420054201;35.0877192982456;0.0561797752808989;0.00588581518540318;11.7647058823529];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.5045425218655559;3.6269799412547306;1.7649237907204067;-0.96264818187898926;-0.73577246872257951;-0.58593548712820942;-0.085524372272909072;0.18914835567815957;-0.82896088019058634;0.78026348274376411;2.6307945199432541;0.25259745125885613;-3.1938327214963889;2.1100492749117201;-2.7732935406770527];
  IW1_1 = [-0.3985940411321871 0.60227405546598412 -1.1601543165995942 -0.27250700878088968 0.99665113785720227 -0.83087912463406677 -1.5775336676970602;0.18781890757825337 -1.8816101513769814 -0.34037491912292528 0.63308722748665014 -1.1722041121849944 -0.35575358207584434 2.9126917464615265;0.28951691924592188 0.45105936485474324 -0.69996240363436169 -1.3548331480639655 0.081220728807065545 2.4577995232424468 -0.22530075077991582;-0.89305586334199238 3.076592521887485 -0.98638606821910924 1.0062314160967276 2.3003274181619902 0.48393908515382844 0.08980439783277161;-0.16905045438698496 1.8886857069354017 1.5222157966605292 -1.0051016409859133 -0.54295588261566752 0.49483519093752787 -0.54104244912263755;-0.22624312582399733 1.5637180412710672 -1.1875620819682868 -0.06888991146707614 1.4070968751650981 -0.36010709191150436 0.13770478242882286;1.5664250466923597 -0.22545181196424241 0.073055156543682984 0.91327017916947983 -0.50493303197782502 -0.12684804724467547 -0.14410936191261681;-0.19641432938905884 -1.0607184755429639 -0.64535789656426923 1.0816413442905857 -0.95430194264508439 -0.34003853574195353 -0.27411955980777097;2.5896790319901575 -0.70911261527806724 0.25969219104899999 -0.6292586885396575 0.18333389531947353 0.041327681092978366 0.26159529374135654;-1.1784868918534328 -0.41421464089665971 0.072244578260463876 -0.76175849548996155 0.68939930625086387 -0.10232148545564701 1.0148856937088808;0.18433629647712096 3.89377203288422 -0.78247730438116447 0.19888913667257768 -1.8639574400773375 -0.64711506385303252 0.61881655298487348;1.2372673815256048 2.7771059649585625 -0.94063702325107046 -0.70517828241621494 -0.17190640564957402 -0.49937059228956365 0.29721659912129089;0.065046182811483597 -0.53324676532674742 -2.8737888979707504 0.81587276846751888 -0.5188401066562307 -0.19910091260003046 -2.609748237208716;0.12264030164565018 -2.0030636696219526 -0.54278862093956515 0.43429818827000671 -2.6745164022617094 0.71628016491005375 0.00047618619506304555;-1.3616939167383493 -0.51834290477937472 -1.6210481822722629 -0.14427597310075535 0.20775852515776991 0.16274946064687987 -0.7642307373038526];
  
  % Layer 2
  b2 = [1.3620693255959477;1.3445565064191236;1.2635310973603089;0.60253684290325271;-0.77201534484452705;0.42021298657252537;0.44344484737252898;0.067333944374889959;1.447698886461926;0.46420215643773333;2.5750195973013756;0.92552000579861837;-0.54257492246540084;-1.9624766566630467;1.7208079047368203];
  LW2_1 = [-0.46691199943633416 0.47853546225475951 1.004280473623038 0.32024840490270146 0.97085075687085931 0.1524780046760098 -0.25968840963099415 1.1183505789162986 -0.81157665753666608 -0.69011573765902745 -1.0885089456293362 0.30821116377189695 -0.35331530985826226 0.53980231589846361 -1.2118379795861873;-0.74149094698895979 -0.22704366054751576 0.18496594257627785 0.011636418628878018 0.54327782711448003 0.058130663696417798 -0.47475420518181399 -0.28172506923110208 -0.41262293873057909 0.20071852469783288 -0.11327428465342552 -0.080874243450486244 0.60852756573063094 0.46166721921681603 -0.23642059479100438;-0.064000716579591832 0.13338410183563956 0.097485914786347994 0.2866915065147036 1.0251644698746072 -0.57701480129126259 -0.37182481315572485 -1.0881392398788456 -0.51399539200181787 0.16182200516464884 -0.30532555075849038 0.27429944148766816 0.24356854806665482 1.1631880517067628 0.2217842313897494;-1.0668886766811523 0.040945192489435123 -1.0700703752954506 0.79858704791482782 -0.76366521022300871 -0.75375105242725271 -1.2121411916748421 -1.1136969552418181 1.3881751440541703 0.15625769993980893 -0.35971702739664102 0.38582380516944642 -0.055104076981955505 0.27599801787254113 1.3376874708811484;0.56982263025196234 -0.0048490210102461254 -0.90615578853460566 0.57473984309686588 -0.28404145381239687 -0.70598407284696896 0.010602060952769457 -0.42054842495481776 1.2323586709147152 -0.19920587321849126 0.023138316507897633 0.72231351867629057 0.28373622440069174 -0.36830451136979769 0.49184848717967355;-0.20062778769059098 -0.57003792035538881 -0.71343178366676618 0.21111401748088737 -1.4037464130330326 -0.45939133914208191 0.53736971148026447 -1.0341109633608185 0.27824776475480001 0.22929608146372793 -0.58521693396810737 0.44375338628327193 -0.05382587308344404 0.016007504694733041 1.1361739279648071;0.91754432152644216 -0.073162780746980322 -0.83127473698193044 -0.42099209704664342 0.20703501900470134 0.4938021321551051 0.45076557960916236 0.56131225989924816 -1.344943664044064 0.52996920498304179 -0.41928276777564261 -0.11389800036229909 0.22032285797437423 0.10114374038009583 -1.1345716185106896;0.062171341640985228 -0.26662777484941047 0.67448491512509312 0.11073086289758677 0.45124373439373888 0.58833308692683639 -0.24132558182604441 -0.2386539128256171 2.1148590923948412 0.53660506451717005 -0.14118515862460651 -1.3071966732834739 -0.37429201070375101 0.4453489668769231 0.8092357876177807;1.5795330366086822 2.4458091791902268 2.3272405889746186 -0.86034126758517837 2.6690706673612445 -0.35853786049045777 -0.37719479940193656 -0.14050466256387734 -1.466347052527383 -1.4604476764256333 -1.7910189199765696 0.2492981973392655 0.38614826567239002 -0.45940227739900141 -0.30269065160219788;0.19971745939647076 -0.69469359356861737 0.15644528430929824 -0.54760760244952378 0.026835986758336441 1.0306179377739972 0.43476199433531171 -0.74064208674966625 -1.2299860397611817 0.34754664322689705 0.36580712545395866 -1.2041816188164347 1.1317309316337774 0.37238148183442643 -0.38243512247033329;2.1086009213855581 0.1200214470906459 1.2732409499559838 0.24724561209741891 0.2977057747501608 -0.2015302658004704 0.44773667806298467 0.79525077367151331 2.4635575394600902 -1.440789576929536 -0.9203348549081366 1.0017598358582236 -0.087398437533406648 -0.43461021877106232 0.27663065693296102;-0.027560921442460654 -1.3739360833398129 0.38937409543021406 0.36085787521253343 -0.90512796241046622 -0.035101845226246355 -0.15495816147388994 0.27806553889233704 -1.3046288071544276 -0.75440592793482364 0.64633831894050986 0.12946591957190998 0.3420240451984331 -0.47715458744840833 0.021393726849464167;0.27540095705791079 0.73620738035636768 0.61976886544451515 0.12550927590833713 0.2306454841101743 1.4648475516668278 0.52910721718857578 -0.64580132997929063 2.3982337687472475 -0.6370099789255671 -0.038390007574195181 0.23219092148154952 -0.16808140248020914 -0.25928080357308775 0.34137989194734941;-0.76123933848051017 0.79433605877110613 -1.0728029611580485 -0.085554664580873185 0.58863289596811796 -0.26075764087262376 -1.1521686079105375 -1.8896789077057892 1.2198661883206063 -1.4281878624722706 2.1828502459197519 -0.44592419762030172 -0.77991302569824905 0.3794194484969734 1.4166464933913023;0.30755877005679494 0.18785848603737204 0.32917459262196108 0.064058360200221265 -0.61929376790757329 1.6904993024703294 -1.3085860409025096 -0.29592536823747068 -0.59758853810066959 -0.40622182929363815 0.32639974911910008 0.44185280879243022 0.071076320267108695 0.3404849886575399 -1.1728836328099215];
  
  % Layer 3
  b3 = 0.27655026982747333;
  LW3_2 = [1.275500210430919 1.4617948846181017 -1.427598195568017 -0.77956533944813666 -1.7714587728812214 0.7290397799588394 -2.3135637941179867 -0.29936404869813055 -3.140060233700793 -0.37842031895793476 -1.0520606298564401 -0.27933883001029142 0.14770284705127526 -0.96680077740783421 1.6198291439040884];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 11.7647058823529;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
