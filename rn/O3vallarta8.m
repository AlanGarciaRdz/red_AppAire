function [Y,Xf,Af] = O3vallarta8(X,~,~)
%O3VALLARTA8 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:54.
% 
% [Y] = O3vallarta8(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;5.12820512820513;24.390243902439;0.02710027100271;0.141843971631206;10.4712041884817];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-0.37489188166363518;-2.2121332295856062;4.9042209810933981;-0.97285947677576945;3.046015398924657;-1.2230527528935089;-3.4045120603245813;-1.0449362361145595;-0.85844649427039887;7.2479579659678137;-1.9847490950090867;1.4740423905024316;1.3987318390321726;1.0555917382496354;0.053325082065389995];
  IW1_1 = [0.9852935293493319 -1.7028607613544886 -0.29216492267501842 0.72676454223402032 0.087064530755476058 -0.076612819736426918 -0.73361417454991207;3.6678036811347292 -0.38890927181963658 0.7085903980550482 1.360504666439035 0.72890668773109613 -0.2413147827772148 0.7977721251999037;-0.60323347905721181 0.048456891009134612 -0.6294016265392065 0.81680040842951696 -1.8881230952510053 -1.6619312973936387 7.180463043886359;-2.3758902771033648 -0.018054802177629711 -1.0927658986914812 2.7172456813987331 -0.076679911943140167 0.76295385887667166 -2.6813922359884006;0.3791458606196868 -0.36006652756023533 2.3881137612873085 0.15492261733828025 1.4522091645799216 0.026927440280889899 -1.0830465450541631;-1.0573467863395134 1.1483681167595698 -0.18680492333150889 0.64337562554906935 -3.6053269302470259 -0.47292487552102275 0.95488709508486069;-0.94875948487959505 0.01753869602892253 -3.7171282089845548 0.24385213560450777 -0.65163239466836764 -0.12110493714237272 0.96002523300074161;-0.31829791367498689 -0.62416287002317672 -1.2364511332993657 2.1116950906416556 -0.90790452507960162 -0.65976705622668441 -2.0556816416488792;-0.28611708764642224 -1.2811962723369508 0.3028173187063779 -3.2446513095131362 -0.70460508164664237 3.0013367245952787 -0.21289476716089395;0.49031402571105864 -0.066624884650830996 0.76480126803694204 -1.2754204874810995 1.6110534186935872 2.1660398162090782 5.1306137246643067;-0.91652406028057398 0.13490742806639275 0.15802831963456307 -0.076016948191223677 -1.0336362042320533 -0.66518070936749141 -0.8078748229369519;2.353443501317849 -0.0071107787005796445 -0.55944846251967439 0.072645731857955892 0.068464535584520356 0.70864289698188054 -0.80540331178674163;-1.3580534033914879 -5.3404139700151934 -0.33366177000747882 0.76560549823482837 -3.0399712209697576 -0.33337054051187709 -0.010733233721892659;1.3738983269788094 2.7470240737407838 -0.77551495424170469 -1.4266812080467139 -0.69968890691662167 0.144612637840209 -0.35488772794828782;2.9806346739621525 0.33121928418970892 0.46685742412195386 0.043465998949049595 -0.49617269398844543 -0.17512612665373983 0.73291870814127114];
  
  % Layer 2
  b2 = [-5.4052003654203622;0.99959067432253501;-0.43741271572160456;3.5143729824390992;0.8748882036604626;-0.16973950968346385;-1.7542099864964904;2.1414273195595515;-0.64778495294226957;0.60320087432564962;-3.2867655159357385;-3.892296332130742;-2.5075115147659126;-3.3203562484130282;-2.9380280072734695];
  LW2_1 = [0.97321584283235596 0.27947357968504449 -11.710378145637344 1.0838367591297049 1.5082775765293264 0.46069472665789668 -0.27984169302044304 -1.4802182518165774 1.630687517685921 -9.580642132518113 4.3660350305308029 2.1930840526195516 -0.037842410004561421 0.33271786023606664 0.69855312105794209;0.042209267418351827 -0.55287124341722571 0.48514754684587563 1.3920262396559153 -0.37874843239789574 -0.41203366905924899 -0.081958854415053378 -0.60188217947340339 -0.11560292074613801 1.3347316314096132 2.1980599100332658 1.1975914458612258 -0.0084087593052462641 -2.838116354521484 -1.0481348224635505;-0.23528135419409218 1.705687107984023 -0.091394428303501071 0.2898251772192843 0.54573405575584544 -0.056477168711096842 -0.01919523457297272 0.0013399063079942075 0.22742231190697665 -0.63588470960399812 -0.38044079505017209 2.6592444629018543 0.37816666280661004 -1.0371865942777023 0.44289462815194869;-0.37364927231170492 -0.92288339238541295 0.2041649726850652 1.2305728967930194 -0.57159504887506596 -0.65794011485191617 -0.10154189053020048 -0.47477374123906918 -0.20717877045237618 1.1390179195546857 2.5126515234003142 1.2471309412031233 -0.043564529510220051 -4.3550799989275983 0.32420329415214433;0.030385746034817227 -1.317183887105325 0.051206125510102327 -0.40243609602729319 -0.16012073856593456 0.31116492386758871 0.27435733214332303 0.084605841869463932 -0.21077979972498359 0.5472812170788256 -0.18186051129347297 -2.9047857989342361 -0.16280928419698409 0.7350960463721472 -0.33497413059873737;0.7102158583051712 1.6975084439879828 -0.56316132383204598 -0.14538380390176542 0.012307712019684145 2.39423705703134 -1.1099614841549481 -1.1592826924392519 0.037238264670301897 -0.10586000641661462 -0.24336139805150209 3.2008742031215629 0.035788216920976418 -0.045859133677793831 0.2953682167376141;-1.3319230196721801 0.6871301212900266 -0.33234756167160018 -1.6250737438578369 1.3998543655730105 1.053668517174166 1.7161994185376954 0.7562587147178601 0.35333673534474463 0.41568175155516995 2.1655021683911606 6.2559807750980081 -0.17721741489434362 -3.5424248794135007 0.72724685339589556;-1.3031101798436111 -1.106415949986973 -0.49810265204588644 -0.61076658062827138 1.3374354903234256 0.61452965702807427 1.1198655342807713 -0.12629738275116797 -0.60418462812770335 0.11986323107261997 -1.2984967122635231 -2.8926958870637574 0.86842926575537804 0.20969280891765141 0.37637129736885827;0.61480123998186986 0.15802385030136884 -0.52440412362341682 -0.059300045994093636 -2.0999847269460439 0.24895335176905481 0.22322883897395548 -1.8566055226281568 0.94540978988702451 1.2600195321262755 3.3720949075366207 -0.41782491549189826 -1.6172404565044636 -1.9099012125882713 1.7706171571857021;1.4593723443014119 -0.44160400848986681 1.3109347211817752 -0.50496295055001483 -1.4026865430699607 -0.55590704796679413 -1.5348321765005974 -0.0047368735532040893 -0.34275961179043896 0.45840307455604268 0.22271458126446611 0.60686281232984984 -0.29197795615119249 2.2206336433522615 2.5784715765811366;0.55158464790352246 -1.1814403113539829 0.012706278189236633 -0.13715003086423205 -0.75120712021944769 -0.64457161808856323 -0.080776892276939127 -0.14315071907392174 -0.09246624580576783 0.027959549636226357 0.087180095890267387 0.32015829549628794 -0.58642641434617881 1.8370879203383339 -0.30787015759843894;-0.12173284580053043 -1.1122531011874146 0.085001104759573565 -0.2348967161019605 0.032843305365400942 -0.52756434008880326 0.67476149916788175 -0.25145266721148568 -0.14176790400645992 0.77325882681753666 0.79699017285995133 2.2886794191309661 -0.16633188996260312 -0.49311611108248593 0.12554642855891426;1.8906725815117971 0.74188993917052404 0.59589328157234478 0.66079220112759196 -1.5847916680358665 -0.78615237421574768 -1.210298619651565 0.14398377491511094 0.64215168986937898 -0.089786450344744653 1.4784375212188334 2.6190862425683146 -1.1941864149712136 -0.09523740704867073 -0.3632389770021337;0.35680281257340296 2.4025735100116057 1.7849668559912266 -5.7443655227986561 -2.3714281991541859 0.18417876734233418 -2.1050854183789105 -0.15901903798520078 -1.4935974840015986 0.6926307262050071 7.9568363307307832 1.0081367393455485 -1.0802459326619824 -3.8202605409230137 -2.07538044762101;-1.5286773964246032 1.1763849801107744 0.089417438763411183 0.38912794350011176 -0.29226532762767232 -0.84804537293782223 0.57424995913102228 1.3744452703457573 -0.007724592246253467 -0.37081511131967826 -1.2612616292135264 0.3779771842619285 -0.8318975397612941 0.2401890068090326 -0.51235374607727124];
  
  % Layer 3
  b3 = -0.53997192807850325;
  LW3_2 = [-4.5862932885011167 0.78150751513925631 -3.329359850183077 -0.92101374638499522 -3.2077135188434718 0.19713020839699463 -0.20101280122133477 3.550933133132089 1.9927770172163641 0.37124517694328324 -1.337919185792465 1.7396583855507421 2.8267395477471373 0.18915080891616551 2.7492498777710299];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.4712041884817;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
