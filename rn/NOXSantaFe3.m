function [Y,Xf,Af] = NOXSantaFe3(X,~,~)
%NOXSANTAFE3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:50.
% 
% [Y] = NOXSantaFe3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;22.7272727272727;0.00341273633199099;0.00632111251580278;0.294117647058824;5.42005420054201;4.04040404040404;3.03490136570561;3.96825396825397];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.3488618966992463;-1.6430889157327813;-4.4219478158734988;0.64306575412325262;-1.3364822322226;-0.79356908477368648;-1.4933904425043165;-1.0180485398151404;0.21779502221366809;0.015242253042362847;1.1019326252491362;-3.0384274982272195;1.7522318232524798;-1.9182628023610859;-2.5141806118848598];
IW1_1 = [-4.6711736530466452e-05 -1.5992538608406868 -0.57052623844389749 -0.74179041846019 0.24772300184794604 1.5668122584116921 0.018968164421444052 0.27161226204506461 0.09899071682251756 0.85408184745499371 -1.1111651410809829 -0.57573115304007116;0.30264570008043556 -0.8318379483203231 -0.14329773939908402 -0.58980638171294408 0.97930376803500385 -0.11757406505449661 -0.08954993814940948 0.73514788241629336 -0.37333543828724025 0.52725137539481448 1.0415767756358159 -0.054217134981067533;-0.33833655257527229 1.0552460640876171 0.0057587689673648801 -0.023645022575398873 0.049129693757122825 0.080690877563923055 -5.5314461570581987e-05 -0.14897904784902871 -0.13509848508772446 -3.9803387643097534 -0.061339611994033642 0.034393145526480561;-0.36205360173375262 -2.1680090423746057 -0.2521362689284723 -0.44165629863297956 0.051702669001286963 -0.08547623256362262 0.088241017484377793 0.050218665081888741 0.2458678806031204 1.1997504352790627 -0.15827169035990113 -0.62798837756460391;2.0590621841679431 -0.4207342994930332 -0.99638697527665543 -0.33771036090640855 0.17147964621906525 0.2360142911611392 0.14256422221495738 0.059182179704843789 0.42336897843410559 1.0454614035349095 0.17972332843565414 0.092556862610849222;2.0409631176028098 1.0943268350209492 1.5837448519834014 -0.62981104971031732 2.4450449336632665 -0.17443311093273919 -0.22994627467601303 0.20002417139312306 -0.45540680908148568 1.7066670130041648 -1.50796964805637 0.54385720446960273;0.42200425170066236 1.2197592266480914 0.31902735265602489 0.10095212360405681 -0.1422437181591619 -0.39455203343376932 0.89045184451736237 0.34222473809681486 -0.51045042306673427 1.6911254233677013 1.365184041726478 -0.6226645555171415;2.9214811480401108 -0.58692530139541332 0.69908182252974449 0.078666250369325078 2.7357131585759005 0.58070229688341812 -0.29395617776458383 0.71022050230058975 -1.1810103522598596 1.1787389469397587 -0.13149764031175606 -1.2660714277176206;-0.86551819586569056 -2.1441945355343246 -0.49625022784881956 -0.25871174912532408 -1.2599284431407369 0.6536749253011217 -0.082636610380489917 -0.71234603728486279 -0.52314996840746675 -0.37664751223964016 -1.3387209704065162 -0.45114200678425098;1.1086979113368898 0.2139829956653837 -0.59983683133336929 0.0591144491434311 -0.42085728548674423 0.18689342020637778 0.052675817277493597 0.14408317555228506 -0.086478958815823029 -0.90759489558353967 0.4129729044749329 -0.43044915814676876;-1.7796657855034363 1.3836700172710956 -1.9696800540945594 1.3075969651083668 -0.11426955545780548 0.33213486993485164 0.075444247012409385 -0.42653935274230198 -0.092812994403637564 0.90938312171740088 -0.17130408140590084 -0.41534695698327689;-0.14165783225384948 4.870424621658378 -0.61932195190158834 0.35178838529785217 -0.024749902880142317 -0.11536923412551509 0.08985841557136498 -0.29258725063150326 0.13945612489323603 0.78087854301169102 -0.075902976436447875 0.11072633631013222;-0.14365692762987964 -0.98183021664265957 -0.39117169777053995 0.29231312997720721 -0.35953072593622559 1.4969960464325212 -0.40686141809109611 0.63026098125537311 0.099904005487278541 -0.50176972630014816 -1.127041794900155 -0.33508658789056056;-1.9132223127096253 -3.0261751986735503 -0.02165249251317411 -0.1396916877918192 -0.80575530626434566 0.2928842637621854 0.17483059059022046 -0.23187550508774474 0.16739152618093417 0.79316006047771559 -0.58999236683533129 0.43304309065944507;0.08038248684255489 -5.8084376082747147 0.059011449820251645 -0.048176603522037342 -0.30541078487886486 -0.18875760350984172 0.016492839199111577 0.20062375608942828 0.065992616231928161 0.16503361040803841 0.22136228928499535 -0.19614635077434289];

% Layer 2
b2 = [-1.1459082336825039;-1.6093233114929621;1.4709200365479702;0.78375288519246555;1.0833166968423602;1.0712093559432667;0.60659210823277732;0.20428639882514293;0.082835670774398407;-0.27245425691820374;-1.5271401631882511;-0.79901748727375499;-1.4746555392941549;-1.3356120507576426;-1.5677180267819433];
LW2_1 = [0.89163673842899349 -0.63609693302218762 -0.19571711504170897 0.85664764300049001 -0.40135298844891659 -1.6411697152682097 0.028193259668815515 0.69518122275641858 -0.91828257326973572 -0.70684298051779093 -0.71779010270435983 -0.045059666441716037 -0.33961091421599571 0.60750903478157081 -0.91280398797214601;0.098892089407458611 -0.68211301616364661 0.13405874917793525 0.1600287432673877 0.12281478324892633 1.3894706469842304 -0.32588233060704552 -0.81317158850125759 0.99578911583530982 -0.04485900926938248 0.45112819346214439 0.077768957097286956 -0.53682414381597088 -0.27346333172121684 -0.38926946344190017;0.41052361889191552 0.15384209829417123 0.33555539047143246 0.68648939143145915 0.54711174084502034 1.0687727461515601 0.030886080069097044 -1.0632109745721874 0.34582176734962911 -0.10536877883562472 0.38582226833086181 -0.38541674528094322 0.096978739579674608 -0.13794671778000672 0.79321897744916392;-0.91820068339719874 0.75812549988872824 -0.42958701691442031 0.55919902951242129 -0.039254852471532514 1.3073567940864512 0.81174831214609311 -0.19867934567951639 -0.26392429334207945 0.22678516652587113 0.45839650843432056 -0.3769803528890443 0.3612367964413068 -1.0735983843604326 0.10247158159075424;-0.43658305371195921 -0.80232369286085492 2.3174461565110023 -0.2798476050987273 0.29312805330005287 0.29490237803000274 -0.71184009538934212 0.090629995886317538 -1.0751283799320932 -0.038594749691149934 -1.0241525366982642 -0.77771359554834896 -0.090785824729200854 0.61084555296119269 1.4192661106632056;0.37519361043982424 -1.1036251568872768 1.7449897883059025 1.1040642667566478 -0.33244484569426619 0.8706143002886072 0.055083186953731149 0.39097514081811408 0.30175630676023613 0.20458300667173462 0.13853875695798382 -0.054656504867336683 -0.8615913982927087 -0.69795741233914965 -1.3000082996006765;-0.95746955854189697 0.30045882604465218 -0.10197627525157497 -1.2455080561391512 0.65440549143491322 0.69441799057413378 0.27236459235270583 -0.203297467275035 -0.12684319702699817 -0.31466461727560158 -0.18041562388982563 -0.87546111572366914 0.55329057472403254 -0.46644543777322595 1.5308164049841508;0.02016977161641148 0.12424772263910222 -0.14739539377470004 0.72518376192184986 0.090396774199666297 0.74271190022158085 -0.29976986685210316 -0.40658549175804576 0.42561420076855594 0.1504092401552409 -0.82115624221980665 0.72121022143558644 -0.97157340657091562 -0.98289701213965974 -0.56756382662365934;0.34647439511554134 0.18015308844061212 0.54478961598145514 0.8117874718529744 -1.2563364561570742 -0.83023444570386029 0.62331847230153092 -0.39915180199199385 -0.25919476570974126 -0.1490816049492637 0.7808465658794056 0.057089383873486332 0.13971661871582897 -0.51258139664649249 -0.46488262974762296;0.045932601111998206 0.49341309835231445 1.0293095540841193 0.49875788241954522 -0.4479171837162903 1.1758405570074439 -0.38577316495600578 0.58560755432013023 -0.35729534586260819 0.019651730660184386 -0.80742645023852466 0.15676714361472766 -0.32037618431357023 0.20659143616444639 -1.1338051461840584;-0.55812963221801415 0.84778046483688274 -3.2799333537830675 0.95345483370335404 0.42051793804404053 0.024021076858171567 0.027113327074677764 -0.041321842632104137 -0.78879229377575111 -0.74178848973973577 0.083366307408332091 1.461720905409942 1.0133997090607925 -0.046214239241611763 1.5946516589736444;-0.1041771785376959 -0.6171484923218391 -0.40662445636649625 0.79108387887023646 0.6843795440527809 0.097534637737767771 1.0324792284624658 -0.059420723095631289 0.41195864940230553 -0.21471470598337983 0.035369907608725729 -0.43690278430226626 -0.24333230960717278 0.99151230955055802 -0.33677348366013587;-0.27181430843193172 0.039795918930649953 0.10227920824716276 -0.61860286146759946 -1.2198096982107087 0.31548378933424404 0.041281087904464844 0.69872906687392677 -0.36799794056104407 0.81434371972346364 0.51601814188104134 -0.78384967415622642 -0.69545633625809988 -0.062391998247163273 0.5653833422130502;0.46224211578428526 -0.40168469835022014 -0.22979988657786193 0.98575013043277704 -0.26200209511787509 -0.13564805372593289 0.7681103164590013 0.008715151965164078 -0.7945860699491919 -0.71070211543101336 0.11898473396102438 -1.015621665240692 -0.091794472192985102 0.29714700974384101 -0.99818772359253094;-0.47388179131122188 -0.71670034260610427 -0.54964162233282265 -0.48733012677125642 -1.4071356512969593 0.72363496416582973 0.11669220612265038 0.61813578511991096 -0.55165098472874541 -0.12304851736045586 0.52232646734985855 0.36486606616839928 -0.17682171322478418 0.60612552103169959 -0.7160672207120502];

% Layer 3
b3 = -0.051746902084976329;
LW3_2 = [1.6078193797951548 1.4338113255896396 -1.0432778187109415 0.97046457095025129 -1.3854523216186638 -1.3578560830544735 2.6008365401376672 -0.68747904038964214 0.69622133803715136 0.70045593085410962 -1.1805334705844013 0.40978143836296205 -1.2681024948668407 -1.6951647543394437 -0.69534045828234292];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
