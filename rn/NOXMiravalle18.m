function [Y,Xf,Af] = NOXMiravalle18(X,~,~)
%NOXMIRAVALLE18 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:29.
% 
% [Y] = NOXMiravalle18(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;2.48447204968944;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206;5.12820512820513;4.16666666666667];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.6684573717533073;-0.78255218423736927;3.8003558048825794;1.6889544757433055;0.75795768132335639;1.5667952374368626;-0.11002778794748296;0.51474514200972521;-1.1434967028452065;-0.36662449755955218;0.32457676087156762;-1.1714701103003409;1.0594363717063695;-0.2924739305183362;-2.349133962196905];
IW1_1 = [-0.70649385864169134 0.38157332074983613 1.4297289845071346 0.77840734194318095 -0.81046445215885088 -0.39383220531492757 -0.1272389693243639 0.28388512917549552 -0.85262609593185046 0.5852443946092577;-0.21922602061038152 5.1566288736253094 1.5015908345892914 -0.004282862575919125 0.2395447580811097 0.45011277501633584 0.054507958376964594 0.05387355611180554 -1.2394708152910245 -0.35741578614548275;-3.7289941929465602 0.39261265806192497 -0.020633274736262655 -0.51080974703151982 1.1741519283781614 0.45954411961602315 0.20788352230876933 -0.73608727566981802 -0.23985459570061768 0.03526012278837802;-0.35439495615031563 -1.7578783717205644 0.28015053298752124 0.46881878867341359 0.42573352734468412 -0.53763878701015022 0.32335236029291164 -0.039980741124471669 1.063901967217235 -0.23843202850870757;-0.38269780551436089 2.9218704094596548 0.52919273315761373 -1.3109763915229085 -1.1080270891228892 1.87966735328787 -0.15872482259077425 -1.2588013202987343 -0.13172429915245826 0.65725620588841804;-0.90562181597735869 0.087659031051210756 -0.73495167580483267 -1.837111916023042 2.5148303722991234 0.29171799951402233 -0.38633150277902972 -0.67335710010641081 -0.31272267532045539 1.8852157535616425;-0.18850084457560473 -0.57160149059704013 -0.66892457801365557 0.76635187465028853 -0.88180789696626272 0.30996659229742707 0.64854751007822586 -0.078130902964635096 -0.082860744543953035 0.78831122606272219;-0.25113793288944941 -1.0717358775450172 -0.1738816609416754 1.6035474596573076 -1.3561300614652843 -0.2478516623953767 0.21793951308749451 -0.12130171690799221 -0.27376297315090309 0.75085893547800253;-0.1289663539080711 2.2100832435221078 1.343860534979765 -0.077489910624060715 0.71461392678180657 0.31308237018747642 0.24667286652375986 -0.18977151518407354 -1.0310596071680873 -0.81654180622238348;0.19516220729745154 -1.9581284056720147 -0.21932423905089091 0.67483632452216835 -0.97418021322401416 -0.55051589157601688 0.12597881455662821 -0.63831076115408292 -0.33747027183015627 0.77895489082490033;-1.9309404716940952 -0.60807427613635168 -0.12264501119619652 -0.7199065952035677 -0.94250802702763892 -0.81977354060147667 0.85687708272092 -0.14086388715595483 -0.26836706998895776 1.0982318655258421;-0.99128371846868757 2.9641215827442267 -0.8508044359692134 -0.55097384783354642 -0.41085839644672989 -1.8749363868298028 -0.45946938978235335 -0.16295907388037803 0.66348731181227805 -0.54369701364834255;1.5253070702585394 -1.6595239579994749 -0.98659171135051316 0.10013509435828288 -0.54565557229142136 0.24492455703349592 0.42953440546867178 -0.096082528962040878 0.28258828143091974 0.81404236449335898;0.66809042892291837 1.0109664989120397 -0.95714768888990642 0.48305486374030965 -1.0631876850596549 -0.85053657692594797 -0.13936786536778129 0.15632960120431535 0.39644241917604905 0.45149919067909611;-1.5125884324004564 0.077871673513621051 0.08102763241356617 1.1840652042423647 0.43712062836737997 1.5758352892224137 -1.6430820006831894 0.3790526177058467 -0.39595578783959257 -0.3144976588217574];

% Layer 2
b2 = [1.5219599345072174;2.8510309567298369;-2.5566070644022356;0.61833457441378714;-1.359466418965118;-0.024721507650496313;-1.3227052623808579;0.063017277020872051;-0.29846709244677661;0.29432210841950912;-0.5671495519173323;-1.0255400912266748;1.4954809630866401;1.5397229531167451;-1.9650866291845683];
LW2_1 = [0.019520369445375187 0.42496824908661479 -0.33905554683445716 0.74739332738763975 0.53684585044588484 0.60911848526449797 -0.35954003852967142 0.073281102717185131 -0.55970728396497582 -0.42310917954837607 -0.64380743235297178 0.67658395023208318 -0.49148689874924634 1.5339164451305538 0.50513314778630081;0.36345556870968287 -2.5118812846438847 0.41654519136502072 -0.19827154632154803 0.31584584359254475 0.83770200089160052 0.24765269561997671 -0.57064892143799062 2.3511501567994246 -0.27462659391170591 -0.35342294114086537 -0.9174097475451588 -0.72701398584124211 2.2006070627472503 0.35563662569569188;0.13736994400252733 0.38156888532543215 -0.043910532686087786 0.55672392910767621 -0.73158528461422723 -0.77567522560565239 0.46272778852732882 -0.061344348321491438 -0.3675436655621544 1.2556184566832109 -0.55664636893492403 -1.4621344507445966 -0.86962193231965124 -1.0951765215879485 0.21775339149635237;-0.31665463226060248 -0.14938065514163654 -1.0202381070631943 -0.37027892608259189 -0.97763775498272754 -0.41801332630577814 -0.30669408279840299 -0.084015641805153918 -0.87429570255047351 -0.17980505158464216 0.713497309970062 -0.37327564853134648 -0.60940928176684206 -1.2848520346034733 1.6035555950958256;0.81379841998654967 0.22213166604021153 1.0070308511402497 1.1491832961121777 -0.81959599441859943 -0.37723105467636914 1.0638755052418345 -0.88467581103663684 0.31651699734692701 1.4169933729285873 -0.89362771343433411 0.026393793282226755 -1.0419384621028891 0.090621160834238768 0.31693119970282302;-0.15678744182926163 -0.34256762515728245 -0.2157014028197454 -0.26649345903623073 -1.189193930087447 -0.043397584019509716 -0.64532085919029603 0.25554435298386763 -0.69653622500900281 -0.1955767245283998 0.8197668358062925 -0.15047776530196372 -0.085919913784331559 -0.900151893154851 1.9783186969351314;-1.0489185818638971 1.6844351517426859 0.67810539390982771 -1.0177912788554486 -0.60792007024070827 -0.63308993923598189 1.3746811198063991 0.99976635858416962 -2.6207703571037433 0.35763673891631836 -0.5700981493101871 0.4043332462583128 0.63328161939273131 -0.62863096911038785 -0.11428430500760396;-0.39916208322923913 0.15035319729483668 0.11134934215411507 -0.98644615030129745 0.20984211909966605 0.25617662705429234 -0.016883332323900564 0.4049995348808198 -0.18401425048773234 0.75611697668420375 0.2296148943739211 -1.0807071536646804 0.12189654644672472 -0.1609466508810973 0.32942697989614594;0.75264431487721128 0.41479780041134734 1.0925395266415674 0.69768119725630406 -0.73913075801788208 -0.14226506327372052 0.023805136725516304 -0.60782652959475336 0.25775326664220249 -0.5598471500151313 0.4163599019762812 1.1245353941521392 0.36407763756653877 0.56712319680380241 -0.20178464125686874;0.44016300598116787 0.73165314503273493 -0.44883400857657385 1.5454684459934278 -0.58582381445907072 0.52413720501690242 0.07513565186364983 -0.57178928604090351 0.34428566880450889 0.13363847687215896 0.10660473369276405 1.5866962825837361 -0.19103437016671049 -0.074248665935614716 0.31591324152294908;0.68684240169940114 0.77221867938460953 1.6362316783212381 0.76588619872691099 -0.82008451611769062 0.12615192506845729 -0.63063819979899804 0.19058881046278942 0.19258525054542822 -0.18056631527158545 0.22725414279991621 1.0270132076681131 0.29898534225991946 0.61651243321406213 -0.38997967741214284;-1.2630398372648375 0.85961731406337027 0.6637664094288479 -1.8317177713352546 -0.63082111759037851 -0.46731193062482629 1.3535331963429409 1.2333485534183684 -2.4605944645871727 0.34387373258290138 -0.67613416225887413 0.12487878297020988 0.082042961346369195 -0.39145470251938091 -0.41611492884877638;-0.61644890363926319 -0.12681542291622033 -0.076365954473971653 0.084244047633823926 1.0749602642815017 -0.83903559395555161 -0.038026926450543376 0.31881469878552249 -0.15895502463111122 0.427359383794157 0.13371823806115751 0.84836844260045507 1.0777244407500157 0.37362508535941863 -0.64598901277603549;-0.15317925002981361 -0.86442388424937289 0.20392684366933461 0.98447907858662764 0.27437840648299849 -0.073205718587638441 0.55153493482578342 -0.36774397572648526 -0.32407050963230016 0.21708841474911636 -0.47457880984906792 0.65355753427964947 0.8255377321082974 0.72962227521740197 -1.4283335048342942;-0.53527596528599453 -0.56970634618213067 0.038796146220642494 -0.93690226845596325 0.83091235053707946 0.74167747711106591 0.99068456352183398 -0.92537790937991726 -0.2694720388809238 0.12582409628246438 -0.023996662483975209 -1.3715321060496271 -0.080762403644045661 0.07505123244459444 0.72416826752537145];

% Layer 3
b3 = 1.224506391958444;
LW3_2 = [-0.21458450425934025 -2.5904520383106631 -2.3498471110737897 1.0806517602966521 1.7679402917863918 -0.92431733383577086 -1.4647529895956874 -0.48476785825605384 -0.90133317313136818 -0.18856926703967683 1.5463681101631368 1.5576223897219368 0.40569266867856368 -0.21998638230845333 0.77340532119386496];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
