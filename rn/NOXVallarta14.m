function [Y,Xf,Af] = NOXVallarta14(X,~,~)
%NOXVALLARTA14 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:28.
% 
% [Y] = NOXVallarta14(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [3.019023693247588;3.8477363164159972;-0.56299070791259676;-3.5811098556659715;-5.9030627551405344;-2.6833545744457248;-2.4275628731956815;1.3056767573205583;1.3546276710756644;-0.76385766349958306;1.7775986552827625;-1.671886897568944;0.18734054329909153];
IW1_1 = [-0.11619545880405413 0.046798784113962481 -0.79620397738081716 0.51902547472216065 2.0414763856477505 -0.35212868291338911 -0.2885164431916602 -0.51747857873272829 0.0079654893629442277;1.4306410067597306 -1.9832816196457059 0.27829719836137523 -1.6084926693663151 -0.079884640130980678 0.41838980820347682 -0.89843042102386583 1.9773716654637692 2.0552011961822645;0.46027695029426297 0.17229385631326127 0.99642713931897453 -0.63017159876147111 0.37785642590133656 0.80572514120057104 0.26742454199323079 1.0319875545772521 -0.10993209013482411;2.7317202992288117 1.2400099717322008 -0.085922902272823246 -0.76400366300539047 -1.0252046454083066 0.2756751380089012 0.117480564565399 -0.6124730760252558 -0.130928989217653;3.8137672707720265 3.6386658415742423 -0.48659680451788828 -1.1041422224147419 0.046913877402886606 -2.0793357921799185 -0.63215164395719481 -1.8836380287789543 0.13280288415215977;0.44813028220517204 5.6887245542930218 -0.13380163537392378 0.44610101280274855 0.39832638058452191 0.29762514819727365 -0.27512658494504283 0.20848090490131091 0.085960034544607822;1.9492870095324486 2.9732921963827006 -1.2326154094381432 -0.92318903651019457 0.16369208077856517 1.4610039250914335 -1.5736079996760739 0.32102492768412355 -0.0024395049710518235;-0.91000060733436283 -4.9787827359775036 1.226977542685123 -1.116378886222382 0.82091270459752896 1.9485238523829704 -0.089429087099481164 0.19112951540892126 0.040410771233357803;0.77684291774069059 -2.6093783640889199 0.47009712969392603 -0.7584701664297111 0.21401993200581107 0.047425024439381111 -0.39733001264253676 0.49473026820612598 0.18455678020221294;-1.4323071157279297 0.5262707870743073 -0.11369313527224569 -0.75555246464569226 -1.3476592606723374 -0.13067850902877096 0.15323110695564235 -0.86146851571951932 -0.073856229706571977;1.3205969717698103 1.4043454453308652 -1.039581892203417 1.3076131525631083 1.4011369872011548 0.63513226545377099 -0.0060028767736972338 -0.61006128979112828 -0.068936749519006135;-0.91057980776947089 -2.9562895064757462 0.95540469142136608 -3.3091642530932468 -0.26753969702353292 -0.66041532917949852 -0.22362312095224057 0.036307754330952346 0.14489619829372594;-0.1660935828091919 -1.7285718596500181 0.14088516112501115 0.060722873281552264 1.4474109548080938 -0.65253806040955731 -0.78420726041691757 -1.8832093585690299 0.17634222972049371];

% Layer 2
b2 = [1.5132960840834435;1.447225633022575;-1.5258171776270062;-1.0385632277043397;-0.033954726972268132;0.11823329274507444;0.41086279853612723;1.2490503004179119;1.5959166379969121;0.44579232678581687;-0.84397775915887963;0.92147239371064782;-1.658967338054492];
LW2_1 = [0.8255611730710799 0.12686923711693093 -0.36740654191515809 -1.4781085097553686 0.93992558573148144 -0.56485704992659469 0.16434668914237865 -0.30638033117271363 -2.2529284477888671 0.59523548153653527 0.79897378498475979 -0.13911590068767751 -0.80942482836891327;0.48137485920261891 -0.41216886183210116 0.41310712731633398 -0.55383739734227988 0.40542061110548322 1.7135208912472499 -0.55098429697668727 -0.47496860874438135 0.75710876938777416 1.4605981605338227 1.6479134008677678 -0.11610314925881479 -0.19053893883911363;-0.2619196308447011 -1.1572296133966826 1.027445509342259 -0.2144912168565126 -1.203801036650215 -0.79317999291018904 0.84118116525922015 -0.66377139321078737 1.1998406648667732 0.84009989913726069 1.0061008166126093 0.28776674683395886 0.95634435305036281;-0.096730581708644528 -0.055423058896415855 -1.1375812233806639 -0.47929823409450967 0.46884899492403026 -0.8859472134422286 -0.27881860665089331 -0.23441851355598842 0.0061899183079957912 -0.059842291814648417 0.78198937539110713 0.16622883850490111 -0.19959486061504572;0.26612641385334357 0.036834073210218019 0.89268802089499555 -0.36955152721288637 -0.4435217360071354 -0.040112029465677233 0.23229757850299182 0.2021870091123481 -1.8979925690722412 1.1335584461886203 -0.37274456455792171 0.20102399251311456 1.5514221631845562;-0.56261116803675704 0.14331085956313286 0.41232495946931957 0.15514984980824134 -0.53129893297249564 0.50225430625655298 0.43098401353038512 -0.35188316054539753 -0.92394118542483039 0.17169607324134409 -1.1330488020790594 -0.39707926020012091 0.43810997104463917;0.85986410173214989 -0.66382172221751812 0.28409848812588406 -0.93734039368844035 0.82959909500112683 1.7369074974084691 -0.15581922044251914 0.31994037202186831 1.6285669078867888 0.54955137996144221 0.28420523749080417 0.10311703470848121 -0.69281270922170046;0.52226208993822443 0.42997498203277018 -0.41015600130573632 -0.96045676096538335 0.64185680913705789 -0.23631574420092871 -0.41691555696564009 -0.40684209288816864 -1.5834970595520501 -0.53635717530979909 -0.033280891396904259 -0.12575534053667062 -0.62222461539805896;1.4085964692204853 0.27281679212755339 0.057013400540329925 -0.67803393687965186 3.1969088551736387 -2.4596097892314859 -2.8519330835589609 0.25169514245056457 0.74786188097346407 1.3999921632372629 1.1683992528385982 -3.9879792247203976 -1.1311152679367611;0.69598952896745792 -0.37129894861318175 0.37095025873898246 -0.36992668285136288 0.64633507140471136 1.4901926680413256 0.16036052723719871 0.43247078085312696 1.051811811389697 1.5404505086514722 0.083478158979411993 -0.13132768393119848 0.24616858286066479;0.63112987251788377 0.097703162114975775 -0.53438071223936756 2.5003791159353908 -0.094785670425121427 -0.91491156933575968 0.85750555746475132 -0.31596287156052388 -0.57334548009398656 -0.91693348812612741 -1.105799064195248 1.2528581307958075 0.45872232307640187;-0.2778689223705314 0.013089946856113021 1.1540724463556389 -2.7656771346318529 -0.06411814190772186 0.53319254296174134 -0.94330281489759127 0.2247328656893873 0.1304297770886981 1.0057308976976733 1.0401346205241049 -1.3995683597167015 -0.64985093305402453;-0.26842506082613782 0.74584386726944296 0.32729419391314507 -1.9092260228253801 2.0774777008440828 -2.0969839680186846 -0.21928742917057892 1.3733918361386217 -1.4954130725460284 0.71854177230367033 0.44945309649970311 -0.12952176989781156 -1.1772021489440816];

% Layer 3
b3 = 1.7092082296991737;
LW3_2 = [1.8015649746321147 -1.1152345702721558 -0.23156555355910746 1.0190351159917557 -0.39811920688539243 0.80014482081394533 -0.78528269433581654 -1.8932470884516488 -2.0787607358129576 0.6872932847893376 -1.962032760291387 -1.6182436363865391 -0.16810569091191629];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
