function [Y,Xf,Af] = PM10Vallarta48(X,~,~)
%PM10VALLARTA48 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:50.
% 
% [Y] = PM10Vallarta48(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;5.12820512820513;0.00782778864970646;24.390243902439;0.02710027100271;0.00630517023959647;0.141843971631206];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.1921090279333564;4.9157139651859909;-2.179676947180802;-0.53372295398553227;0.20517172890444244;0.29169286809680955;-0.65390804550884252;0.27217017153847872;1.1683963663315475;0.3292507025149024;0.44814276392880337;0.73490418238202437;-3.6774400930991678];
IW1_1 = [-1.647054217231521 -0.07081644119360106 0.301050300052915 -0.085749018612563094 0.91464273287784703 -0.078340538720813174 0.14034897112711348 1.1062740669278968;-2.2849912710072076 -0.97912055986475099 -0.48256472687794055 -0.51795216523172616 5.3842207241387481 -0.39713160906437428 0.64972371129204232 0.29344362051054113;-0.37609356597196125 -1.307289560399276 -1.4036937657936011 0.19843015065445507 -2.1491823886632013 -4.7392088655912756 -3.34617439744226 -1.0692066102372828;5.0727768047536124 -1.1061619498995345 -2.4796121540289211 -1.4662083754146218 4.3606114113494749 0.13438336684273164 -0.92512199914290993 -1.5801093753822733;0.55716984593155583 -2.6548647826191489 0.14902621546418801 0.17192514715154755 -1.9949264656881942 1.5050617561515878 -0.11069561549141102 -0.069608480649545862;-0.045467027396429639 0.26563634821791021 -0.020641228341378853 -1.0846934641695982 -2.0999634459681147 4.8190173332723498 0.35812923159801252 -1.0597883751511936;0.90867793414245479 -0.97178511383958577 -0.026442862072892183 0.35191074144646789 -1.7546929407609351 1.5732779224921463 -0.13574742170903059 0.13152794230689083;0.90913605247117879 3.2537360373172191 -0.35269362773871238 1.5501575581815945 -0.90606212721703949 -1.686160714987992 0.067757135732484153 0.13928460256874575;-3.6208957116819902 -0.38571998923122625 0.56696822533370206 0.061701954181501081 -4.7058575663975359 7.1110468107573279 -0.091978347635601546 -0.63875337971539992;-0.94637480982734612 0.32102240287840184 0.17884958821237754 -0.43087078849920152 -0.99807444942915546 1.3915285603257912 -0.29406988550392699 0.66854015193983096;-0.57427849887901017 0.66168901973647165 0.15340306075927415 -0.47631606469686594 1.5811614060232861 -2.1703759523994952 0.15018417899795811 0.087911482945256345;-0.91245384123529605 -0.071383175356982895 0.097948162416267082 0.059141410802069021 -0.63352467849785843 1.2669300375368724 -0.086183700603128161 0.063652343984027332;-8.8200099897873443 -1.1942872285623063 5.9511279014501408 4.0582307186131832 4.1458665512401192 1.6495856872322912 -0.046850357960015125 4.2627709925479218];

% Layer 2
b2 = [-2.3841509037682789;-0.17228789204140305;-0.13701096861544923;1.9690765088572764;2.4618062786139339;-4.3551009213082432;-0.00019056586466699443;6.3807536747005713;-1.6274651015594723;0.73618683649805405;-0.29966967871129757;-0.22295378963945309;4.9826087690069665];
LW2_1 = [2.6534362019468984 -4.6526281386639612 -0.32588708273312156 2.2416600479040665 0.987138188433756 3.041451064508145 1.771069823920109 -2.8396182437734239 -2.6256262979602529 -2.9487236649595054 0.63520759167776197 4.950216825836856 0.62463465309782484;1.0462864720254188 0.58746330596758389 -1.7579551931519919 -0.22572011031213915 1.0715082494957942 1.0505518571043844 -4.0470176690687953 -0.17418946362601664 0.99099311385229161 0.10290627587005534 1.3616422261757883 -3.6253812118780124 1.204610435949834;-2.1101678988378252 1.3486591237739458 -1.1831085798275813 -0.91903002366959075 -4.1043018092143733 1.9793119498616565 -5.0086975004661749 1.1660053032314925 -0.58844947637652734 1.2433375175355945 1.087329203823743 0.26436023051950108 -0.47448942230132357;-1.5229585714526921 1.3127907313109137 -0.0014558341420448026 -0.6697418344517676 -0.55116978726518218 -1.9084938068643262 -0.51119821827998146 -0.21908964344932089 -4.7316571233195877 -2.9180345981644411 1.0153693500805918 10.343890039221479 2.0835940603218188;6.6289627992038698 2.6152333755901234 5.7835258940916052 0.16016624201014354 0.93347564868018118 -1.5143231524020977 1.6660516654462263 -2.5889931859399637 -5.1600031679955753 -5.503757923472631 -5.0743818561452434 -6.3516070078457867 -3.1076901222279787;1.0907938859563888 7.4255124169451285 0.96495959506278339 -0.93080859277383343 -2.3697332304532726 -0.79219396453575308 -2.926937368211382 -0.23736003722022014 4.3083587286679688 -0.26441264353765864 -4.430720141451685 -3.1972525315726403 4.4652449115472876;0.25279035528680927 -1.1306929451307266 0.24602897166922302 0.96290101084299018 -1.9055162421057146 0.74049873313239856 3.3514539274205655 -0.86042253237113542 0.22194283456719593 -1.4154205114895886 2.7507268132642744 4.1269424554098153 1.8000404250787778;-2.1686923231462032 4.2299592540676825 -1.0779198876103644 -2.4512917004441444 1.6722035427829989 1.162634968879575 -2.8545649062907645 1.4282390759277934 -0.20399404913695762 4.095899176126923 -5.1243655978649283 -11.005333879027534 4.0812008355584632;0.57076613397382581 -0.49244745869464784 -5.071384251298098 -4.4430207584062353 -2.21929710997814 0.9779125793581952 1.0592222449787418 2.9551315121372155 -0.061411592308843493 -2.1744617048459882 -3.2941060637420727 2.8056300506987331 -3.0074564905089152;-1.6177547698155232 0.84455118316250588 2.6530222477941288 1.5769069513186196 -2.7410502487965949 2.6612037037735479 -1.2860680375772504 -0.98142042517835526 0.73810061786893977 1.0647252695139786 7.4051072188797757 -0.10357522721899727 -1.1358912108554438;1.6300058275790341 -1.0112054424236487 0.4122058691213667 0.15661012751354042 -0.19148624636321612 -0.63618995577464921 -2.3736570829231249 -1.1345781475087175 0.42184877838090068 -1.5182161545322905 -2.7835726464052017 -0.73077014282535835 -1.8087395988907276;1.3891000470711605 -1.1299313574196079 0.50711668548520017 0.25366219425292363 -0.13711477512041884 -0.61299175919675475 -1.4212377222599228 -1.2717123249887103 0.013793585246865039 -1.5655248545800351 -1.9410646985378046 0.79706364600388968 -1.7820166581827677;1.2878519619983635 1.3606080180647337 -0.21032237123185152 -0.87835942789679078 0.51603258279766262 -1.0166948670991338 -2.129358925441204 1.1394096062513699 0.75031626310936983 -1.1267410120968302 -4.3238648894481146 -6.114413805097489 0.29418118583075625];

% Layer 3
b3 = -0.93412264248884724;
LW3_2 = [-0.074345125345734536 0.063639990131978852 0.030926336665220478 0.18838258700697949 0.020107629588665434 -0.1544343587534267 0.29762938896312874 0.1090958230583873 0.04330230607283421 -0.092698182212114705 -0.56094392871433718 0.58193705406030194 0.18755527383149567];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
