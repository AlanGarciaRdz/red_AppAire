function [Y,Xf,Af] = PM10SantaFe21(X,~,~)
%PM10SANTAFE21 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:20:36.
% 
% [Y] = PM10SantaFe21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.172786177105832;4.16666666666667;0.00341273633199099;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.58347357148292822;-8.2512330237169405;-1.8329897711998846;-0.17499591781976725;0.20791653502583415;0.29968860543459602;0.77572378494113781;-0.87106873390255823;0.0043764695688417593;-0.68299628418850744;-1.7943990025854719;-1.2272183239573182];
IW1_1 = [-0.53993514154824107 -0.01558694003184697 3.5306039519959009 -0.75886803226346544 -3.1102162961926543 -1.1190451525659271;9.831324100433978 0.017964796202103742 -1.0614927919013146 0.42860453110870389 -0.061133357448431028 0.28156448107231424;0.62490342518085196 1.3468535949962963 -0.655961047499943 -0.1850065504850677 1.2293823269713766 0.5018514983666027;-0.50660088276525961 -0.76083975331558673 -3.7614405442630732 2.4267173576530174 1.0143255826418951 -0.0051065079089617849;-1.5013998487456319 -3.1594261876057259 -0.052670742473595329 1.1178229735870371 0.13537231718143319 -0.56563505966009742;-0.73707940631001467 2.1346247672194725 0.12028711836374417 0.26198579006927497 -2.0515697957742818 -0.26013906421251332;1.7287215164153702 2.7027874484881642 2.3893382252654209 -1.6568689009747624 -0.84897120969301187 0.8069365254298051;-0.57181174168520599 0.48535565501558098 -0.46803525159551829 -0.84413748927249599 1.9356664098448171 1.4533089103775165;5.3039125016539312 0.083793242203004187 1.9330851992830385 -0.66003442175850302 -3.0993574900764176 -0.59780352640192802;-1.729031898438933 -1.5718606849943706 -0.36154805407885293 0.66903886550171121 -0.20740435071531171 -0.33796814998475749;-1.5921841763681239 0.9239547214440188 0.88136081095563423 0.46575536027480452 -1.6952758466036246 -0.93293936730849947;-0.50198318407047826 -2.0088057986545786 0.99553112812533373 0.57103172712062689 2.3251653231711584 -1.9607513877618579];

% Layer 2
b2 = [-0.68221378484635931;0.37027013825475052;-0.34021789417129311;0.53100782493602416;0.49824443073891123;-0.089301454280751424;-1.3513962016552561;2.9003618346487192;-1.331242908672212;-3.270080624125435;-1.5407898518362964;-3.5029382370873896];
LW2_1 = [-0.69768764846641917 -0.45711501900814333 -0.12196126771132362 -1.1298239210231209 -0.14041984882610947 -0.22417731030831486 -1.1690312994719818 -0.83707444740252002 -1.5713522530301793 -0.7276818014530817 0.62206249170326311 -0.068232527769884074;1.0874257899963267 1.432459769621905 1.8293153932425217 0.43558926208225462 0.5769412415278049 0.29051372490999289 0.59314695801156436 0.47896661918283029 -1.2338578244317273 0.36529002577150393 -0.29865746743125082 -0.71810958979952044;-0.38808113176365522 -0.2558586162512152 -0.27925018977701255 -1.3995471106211204 -0.48863771268640066 1.8726324554769853 -3.4759497421061085 -0.85053670177139895 -1.650879271421517 -2.8244477512915935 0.34562964136082625 1.7413611948138501;-0.34490430176682763 -1.2672700638628263 -0.41796623018625589 -0.18343361706558386 -0.72228518376994322 0.48919973037699327 -0.74421027343821544 -0.093365365224300403 2.1629730101321991 0.80707871809783605 -0.07980494542392777 1.0421449388879274;-0.3227346440607573 -1.4982907881908512 0.042414580497419238 -0.77440944208895912 0.46569752899859029 -0.86404871009289186 1.5631733857195034 0.25109908673443254 1.5475034890126944 1.9278180912260694 0.84697259912300893 -0.68608866738586771;0.35627739149971488 1.1804954783063657 0.49360005007631613 0.27518356334788269 0.34074037754908332 -0.092830356401897171 0.18490020745066943 0.050920601341177825 -1.736563702735616 -0.75345415361362078 0.12346714556374092 -0.51893892449618062;1.1815435040521955 -0.60863708587883925 3.8666740869398657 0.72891700202215071 -1.7985492633026361 2.8111324150260031 0.93380611239932432 -1.0049644882475923 -3.2805485561679784 -0.62473452124722351 -1.1270942129968986 2.6961762536175096;1.1379258950811693 -1.9089272219475384 3.7269048206207311 -2.1937630786256199 3.4439913209503521 -3.5373486198719677 1.9267172638606418 -0.86587242303878387 -0.0087277724816758884 -0.20034047566908103 -2.3389591459146635 -2.1364413618320106;0.11036495772247505 -0.11697688000358428 -0.11699403765459612 -4.1152810855802358 -2.001790647781295 -2.7678075219731881 -1.2472606906803851 -1.5720763583127608 -1.6946975504264292 -1.9207866029849867 -2.0873288852067491 0.10703475026886153;-0.089869816322440135 1.8026805075561536 -0.78899386183972708 0.21733173399579145 1.0109694531720099 0.58201735228007245 -1.7092790892148637 0.44210219901823405 -4.6127863474824551 -2.0581445748014646 0.87381993239013322 0.58694775685686651;2.627702198119402 -1.0042180002148355 1.4538552998741097 -1.0919634973419683 -1.9189379694739908 0.75214678605339758 -2.2077003667835045 0.58854608960283838 1.5879571410923861 1.1710995024314825 0.54341928895735248 2.7883415615672531;-0.19938209516721586 -1.25217101470119 -0.12143884984997597 -0.47936887498259806 0.76293083918952775 -0.49895853441212951 0.092626356772951418 0.0058239888709606669 -1.4725154750049974 0.40261975054551385 -0.31598233325487324 -0.369000760647818];

% Layer 3
b3 = 0.056127297321524092;
LW3_2 = [0.69053643258379571 0.51752276400782393 -0.26539608356959993 -1.5123609693526361 -0.4745149488302442 -2.7617266888799761 0.18525832705638076 -0.1311664416911747 0.035713682805171912 0.18513134753074545 0.7559417435357485 -0.5146137060028606];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.00666000666000666;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
