function [Y,Xf,Af] = NOXMiravalle23(X,~,~)
%NOXMIRAVALLE23 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:08:30.
% 
% [Y] = NOXMiravalle23(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 10xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;2.48447204968944;15.3846153846154;0.0208986415882968;0.056980056980057;0.0063552589768033;0.141843971631206;5.12820512820513;4.16666666666667];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.8392759321222407;1.9595705123780778;-0.078356089519198494;0.020134535786188658;-0.91886609204286684;1.293673068470595;0.91864649402276066;-0.58009453153745127;1.7378979163485222;-0.97732776930434329;1.2876109928887391;0.50156709402623234];
IW1_1 = [-1.6476469547057024 -0.081980202240109795 -0.071279262490832176 0.50657865724219597 0.46457662147743051 1.2490137589999764 0.1291678917817389 -0.63812147082477033 0.25718202993498396 -0.70720910057748188;-1.0038303590023749 0.1193791262432039 -0.085738287707790684 0.36738168238260061 0.77174710284769121 -1.0559232187677821 0.53436206982769363 0.78166825944000462 0.26552256766754312 -1.5616996342094214;-0.33643002417468854 2.374887924909117 0.92726132901636205 -1.8566608514995619 -0.17117973648656243 0.54297373409964267 0.19682007837806767 -0.23342266004170667 -0.33666293069240749 0.12750084976947865;1.7794271636338601 -0.18866548705197289 -0.73158379525959516 -0.15378324444392955 0.21181655424182749 3.3130687533546763 -0.11231025256252188 -0.21705127406307489 -0.41492316632038423 -0.10415190784978087;-1.304031237863313 0.99706641788808104 0.64805945254758024 0.1729950418212981 -0.62076102110078857 -0.69683822199523759 0.14657446468085567 -0.87312504964657545 -0.58210529310465464 0.23263569895835026;-0.23595978493170977 5.142103225885764 0.043410170214486114 0.12919135168199464 0.22732578116958618 0.14429180827293134 0.039397973031227482 0.41755701125358113 0.26372562936596555 -0.17740639755170895;1.3844252627190707 1.370999195064577 -0.11497874787836845 1.8264310192722781 -0.22843769295866678 0.34188664634719401 -0.4249289177546427 0.29333199641499846 0.11166029701083188 0.82599343074000497;0.18843683508486095 0.87162709756158496 0.77847233305809815 0.11602519899028094 -1.081018663874642 -1.8421117594315841 -0.081440222723306491 0.30664190395816737 -1.0999177200756005 1.641535456332166;-0.013841687673694376 1.4462738459950755 -1.3986467157109055 0.68879460142401261 -0.031640418599430883 -0.5253459437144552 0.11024036645386995 -0.1564919385286524 0.33030500001222435 1.0520167141457601;-0.32590651685259125 -0.35213855462745103 -0.42039703734056111 1.1535945467756292 -0.23273573842328896 0.34221374074953914 -0.42222348710238439 0.15238933767991461 -0.59728889105226535 -1.2884841858473057;1.3467226340593244 0.18494977551655101 -0.39028958605936731 -0.34279505055747056 -0.75088678176626256 -0.4984626835764473 -0.21613285402180976 -0.097775217940671233 -0.11562537477653691 -0.4457830281239536;0.0030882407065674147 0.36476659727483146 1.0520246284160237 -0.33912240865162169 1.2590994034775718 1.9233303280968581 0.4299287118014794 0.096972904581669767 0.1353247468487051 -0.81793979333924693];

% Layer 2
b2 = [-1.7341381904667652;-1.5937128516681001;1.1639319277125899;0.68741730902552611;-1.4380941208311047;0.10278973227335497;0.38179591650819061;-0.42925302048756903;-1.0331215880335451;-1.2689198570345028;-1.0266878611736237;-1.5441895312290141];
LW2_1 = [0.081683388312074084 -1.7214394102395538 -1.4334984050461768 -0.56279764637915797 1.4256106331228489 0.59319734899297816 -0.51616866063514766 -1.3830028445211571 -0.20571805135597834 -1.3140222078436745 -0.84974031623741642 -0.29569228939313236;0.0098634645118203922 0.077914993715575379 -0.54408485119778338 0.06542277934043772 0.59719002051528891 1.0948205047657542 -1.2828133849709449 -0.49116786329763096 -0.1700284288892723 -0.15009660232018404 0.57158955925646204 -0.15128584721179331;-0.53372208956481038 0.72635651956409986 0.085249915328142592 0.064766415908895605 0.62574882556550282 -0.10888978188446209 -0.93746034766471942 -0.69299117910805319 -0.19678491886272875 -0.08376772742019116 0.70779653810057597 -0.23120615467700628;-1.1187983623347504 -0.010991277372554044 -0.36327990400416993 0.58767980243078866 0.48874154771242811 0.48578580367018326 -1.2264441789139506 -0.5686940942128107 -0.038622941084027224 -0.22026973358767954 -0.63203434425383342 -0.28718868804266529;1.1641030889852564 0.80669597570189067 0.15882011567257326 -0.23980093995353172 -0.45623272743762805 0.25093623619995475 -0.43316079115356804 0.3827958067976665 -0.56329706575749872 -0.51569989932761306 -0.55567422477304562 -0.638859536350873;0.36540166045978761 0.89781721602977282 0.24730805303674414 -0.1112595102990159 -0.63711294809982255 0.21355812777598962 -0.10994404876177473 0.6169182519270433 -0.84795495784626918 -0.53764745757969368 -0.551204865146662 -0.84160670160743911;-0.098851462379895241 -0.95674711637179422 -0.14611523492489104 -0.87207713827425437 -0.84390702871341861 -0.11901070600826216 -1.1071446869229691 0.49697215542376999 -0.44431346169749725 -0.44780013202245667 -0.5706016825225142 -0.54489622799258164;-1.1460901793935869 -0.11042106451255863 -0.75450525096770937 -0.65135717458314868 1.3334580799084195 -0.072371473664608305 0.88498318590269975 0.20725420250979099 -0.46487352890696093 0.66533159512744844 0.35337834497338139 -0.5975876481093616;-0.42242890772628999 -0.22786871187703658 0.25522161225053908 -0.76776890909055884 -0.96876196469630382 -0.44141177787139829 -1.2749971128850652 0.37727786379367473 -0.94729426964641195 -0.19697621849016514 0.56059858419492536 -0.54002570890257895;-0.50108166417644262 1.2330752859693861 0.3213627142146277 -0.51832686438576836 -0.97380011158842616 0.90942307237773645 0.24079422353052082 0.75512612396444301 -0.11785803648795456 -0.24710936921493365 0.35134916689375362 -0.91240527496585644;0.036635425941690794 0.49325889047749327 -0.16754861979846389 -0.41133833298647499 0.047714621482818097 -1.2003424091423922 -0.56718974711009629 -0.31229467267125155 0.11323720157354512 -0.37230179416210185 0.48162957423462227 -0.1902817486669334;-0.66213411279083356 -0.34763100877925646 0.061185127374568923 -0.26438467767032081 0.13595616630674759 -0.050081770806024453 -0.55784548307415505 0.70635235441988675 -0.82794255401906069 0.077570171404170302 -0.4858827314326859 -0.91138700490594726];

% Layer 3
b3 = 0.11460772702042472;
LW3_2 = [1.3790328550113236 1.2837137777263317 -0.34581383241125113 -1.2726368000760326 -2.4027567280078896 2.2072402153210215 0.77116744280222504 -0.79794444720299251 -1.1285065014482392 -0.59875797007506548 0.6226379483542902 0.71118964624489089];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
