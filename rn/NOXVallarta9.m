function [Y,Xf,Af] = NOXVallarta9(X,~,~)
%NOXVALLARTA9 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-May-2016 14:16:27.
% 
% [Y] = NOXVallarta9(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1;1;0;0;0;0;0;0;0];
x1_step1_gain = [0.0384615384615385;0.0869565217391304;0.412371134020619;5.12820512820513;16.1290322580645;0.00782778864970646;0.0208333333333333;0.02710027100271;0.00632111251580278];
x1_step1_ymin = -1;

% Layer 1
b1 = [3.2342652937355214;0.9384950997174456;2.6414596232687142;1.9957474407430837;0.036929420978587313;1.011057763203242;0.53430519790508013;-0.8083004483886399;-1.3751237919957318;0.83162393612265406;1.5916188127161781;-1.7068353251813415;1.1622001563641533;2.2335821785878407;-3.423977834359631];
IW1_1 = [-2.825358806964148 -0.62808090418094575 1.3130370282413408 -0.339398624191113 -0.52002803697420097 -1.0629052073873186 -0.92719192536352701 1.111617247760267 -0.19423592014637336;-0.60157566438013366 -0.58123470746360451 -1.1075255354163818 1.1993004827760116 1.3404853362926867 -0.1549225264509895 -1.8396188525728818 0.41001326823585627 0.77361615553377716;-0.4167361747061849 -2.6783824690371989 0.30090593342989469 0.2234750021884272 -0.51044125850784838 0.79781382081525409 -0.052210708766608861 -0.97423684935176535 -1.1296628301885396;-1.4609410974376951 1.111867308690532 0.36980276742640317 1.0499490357718866 0.47157133798369849 -0.40147294425024921 0.92670427793449117 0.53332473926680735 -0.04754485949704184;0.10076529224077753 -1.1368720424468153 1.1025857944914095 0.50053748016314248 1.2293948677633459 0.55234179518572801 -0.53381802961741986 -0.57902611610504673 0.20552367007295549;-2.0180260302816335 0.5932431337434888 -0.59551917366914997 0.19096107372739313 1.0065755770734655 0.056391295765226501 0.14551979306476609 -1.6444845020859913 0.25583613854543824;-0.60559238811932525 -0.0043897232664948166 -0.36397021841151472 0.060586046924578821 0.35582872642262287 -0.49799066963435396 1.1873889397191142 -1.4032653808562299 -0.78334573094685322;2.2924405210184924 1.9289906656701263 -1.4017652162662517 1.1130122597323093 0.81175846976256028 0.051251592406175051 1.0342088579377409 -2.5023329883017951 -0.63920391062811655;-2.2440209146711636 1.5662421870641252 0.63553765858750522 -0.38873685676145464 -0.27322103400124947 0.86206097117840386 0.76534237165738139 0.84292387991444484 0.070891398407566808;1.0631985405210937 -0.94404116591533327 0.045285825556522025 0.44339621566661047 -0.15873302133606168 -0.47743796326710131 0.48044595111151284 0.54623020196192773 0.26222347131418433;0.4957427770827163 -1.2138497343943355 0.71750644297887989 -0.32243543177499989 0.30356117082064599 -0.47301270498607362 1.2692774979066141 2.631446809705059 0.95895563410009221;-0.86275852370530381 2.726142411251141 0.013061604667550859 0.49767038073723835 0.48254745570130303 -0.11459684421261075 0.016945685925167819 0.19980648883876001 0.030575714712940842;0.38347809116228188 2.3097555559865763 -0.52922778092145373 -0.072897069332395051 0.043334148952478294 1.7774149192443636 0.17222436378014183 1.4345442587904431 -0.25382450735066725;2.739268120606277 0.57841015740652424 0.49068324391461582 -0.019097919063951002 -1.5859529350898791 -2.2127561830204998 -0.4339444307321022 2.9391129684161998 -0.72159606534354381;0.091771160178282324 -3.3735929786857719 0.30564685405618564 -0.04656396598387403 -0.33598595650268825 -0.52369546086012686 -0.22515920445763241 0.55105370459949465 0.20706489754153118];

% Layer 2
b2 = [-2.3160990747707433;2.042358910623447;-0.35153955211935928;1.6054612042352325;0.3737262428740592;-0.68658491513850484;-0.45209094423203544;2.1235109470847529;0.72941970060382133;-1.2135504773262769;0.76142752757816778;-2.0222208084644593;-1.506373584839988;1.8421689226238949;1.724175494341897];
LW2_1 = [0.94301211278611341 -0.036542621261449998 -0.67776096304735356 -1.231878330377719 2.2304175412433533 0.40707131808397312 0.84165347631355059 -0.017999293968836337 0.4756255190379225 2.284862439014534 -0.74153354781366032 -1.460168882433897 2.1201016667566042 -0.47465080096133788 1.2683354738741732;0.38381536829500745 -0.11890662865032782 -1.2264368300323851 -0.84713028367824261 0.51982297170940728 0.2263557360307886 -0.36374323983952617 1.4518571651722225 -1.1302847661895814 0.81132579036191899 0.60735068089928956 0.25531012928282448 0.8806715080759141 0.099629653122032591 -3.0509319472987815;-0.0061219323670052284 0.46208960002405985 0.0010282632726404169 0.33647398195516343 0.040487195923351559 0.025325970811019543 0.7618588454675308 1.1083047748985069 0.19585271581375477 -0.59623900182605727 0.53555384780052939 -0.26709496778492031 0.7899421816788833 0.58485868840699151 -0.41014580833557729;0.014838770263342384 -2.4370228422895637 0.67460729208902415 0.60967052700098268 1.0731938209711245 0.68340896604899048 0.3936047733489737 -0.16618000276627931 -0.66827224811167552 0.082479134523942468 1.7948360998677866 0.61459301849725156 -0.049213595728346909 0.5159650192232903 -1.4540245647508354;-0.037648187769192834 0.50305542447268681 0.13435835675947611 0.27148790685249297 0.1849212839691009 -0.00060957287520000888 0.65963798565327081 1.0882506943015211 0.56346481293230566 -0.97773261983601256 0.71130306583760372 -0.19922179519094482 0.77716848738539712 0.28136288450156183 -0.80798117298121586;1.2332359900820284 -0.48361182265000507 -0.47055077901266751 -0.78653392487441709 -0.070958551243910942 0.33717304548942395 0.35602814675638167 0.096987610337326613 -0.91359930584165594 -0.019886519804613277 0.42786817642133174 1.0370822314266375 -0.68825185354116658 1.1096847669655903 0.25656530614853768;-0.36330393360897517 -0.169249329533532 -1.090509492982646 0.46905592797178286 0.76144947497367232 0.26806926614813581 0.32669326588147213 0.45598380261834287 -1.6781058614852347 0.22677746663949305 -0.34013086972815165 0.52572066491011404 -0.74850406918371593 0.72483503896069557 0.39340372408555063;-0.88156681454126973 0.081900430050716316 0.35177522182364312 1.6625894951538371 -2.7468293370220511 -1.0580523959717505 -0.16330475259768673 -0.68245020085719066 0.30347563119329501 -2.5462893082898739 0.78539450622005835 -0.78488257274785345 -1.1245324033716475 -0.077146795711783137 -0.005784312940063277;0.79628062496331986 0.42793777285393475 0.62858423313258505 0.53515232388622946 -0.079346201643916425 0.13111992236658637 0.47288460258547971 0.7106438189821519 0.89078146665161229 -1.5720597961415481 0.78080328955298828 0.63285126413481585 0.70084595215304091 0.62757230472740622 0.46885886460607323;0.7537088543920657 0.48399303871930627 -0.033798809910044074 -1.4315650387174419 1.1819704649980716 -1.2769191063622218 0.16655998061267652 0.91179806368982086 0.69961375951821414 0.25360444945700578 -0.99557490483040145 0.29668464825049157 0.28716534155605311 -0.15649029030985889 2.0976387525630455;0.51842895644881826 0.34752289674600029 0.57205729796290428 0.62322458752062526 -0.17655453733087137 0.15992126843960114 0.54406478911807699 0.7261081891920409 0.39843060025005123 -0.97854660787460046 0.50532937550577817 1.0023308020424933 0.76372748519395206 0.84330387426672959 1.0077575596952804;-1.0615460343670415 0.11184614832237706 0.051957239774736583 0.66674544991066897 -0.69956435946439022 -0.055172376378747383 0.43146926859151047 -0.71929784276191056 0.09660700985474488 0.32429914353467304 -0.022957691825287084 -0.01870699021502828 0.41912460987729822 1.1165960766460075 1.6843468375497963;-0.39457578175549363 -0.5742396611498376 -0.47112084042989411 -0.46316220166768568 0.67370847355301844 -1.4397699443826637 -1.5013510503559699 0.066301836883434453 -0.36222741757129523 -2.33441733961374 -0.87058045325091427 2.3830232336479509 0.33404612047190074 1.1424299689392643 0.43387018242348763;0.57508386481868501 -1.062837879547363 0.85526644616785497 0.37006795845238039 -0.069591937039238772 0.54868815224620815 -0.90974949801380089 -0.5255196242176422 -1.4427288563087051 0.11493680915011101 1.8792663275192227 0.95688912305089757 -0.56443343551750236 1.3439014788223151 0.11233770449407922;1.0097548000352408 -3.0503091535863875 0.65232610276719738 0.49108726059813718 0.04052485077540946 -0.58519268395723334 -0.0016115730854955879 -0.084895187136916711 -0.70168344236032365 -0.011056968358674944 2.0905226736624138 0.87608781910234368 -0.23985566463703212 0.12004330351635326 -1.8755920197947371];

% Layer 3
b3 = 1.2037353477383335;
LW3_2 = [-2.6896713412545035 -0.44549465858740189 -1.3164964830200478 1.334484204159454 1.2285675451671014 0.16386547637482499 -0.090143575178548818 -2.5123797239478156 -1.0879571683747746 1.6071424001922481 1.2050809835573562 -1.0897743643053819 1.3918354151828902 -0.46232149566495651 -0.95676668514222185];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 4.04040404040404;
y1_step1_xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
