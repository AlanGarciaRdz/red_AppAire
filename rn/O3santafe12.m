function [Y,Xf,Af] = O3santafe12(X,~,~)
%O3SANTAFE12 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-May-2016 13:05:49.
% 
% [Y] = O3santafe12(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [1;1;0;0;0];
  x1_step1_gain = [0.0869565217391304;0.0384615384615385;0.172786177105832;4.16666666666667;10.752688172043];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [4.7903749560591509;-0.16299728265193908;-0.53910558291197819;0.51213703009732359;17.810904370625877;-0.10206475677190142;-9.335994915533993;3.8570041703777198;0.57538493225570431;1.8228087735559311];
  IW1_1 = [-1.3203267464331723 6.3155545421970318 -3.2949978820629644 5.2501073206150579 -0.75842104428417079;-0.62011820981604937 0.162920623011341 -1.6897926521173401 1.6954158471021654 0.17377831045145015;1.802198442923179 -0.28710188658526919 0.24096076899954064 0.87683120456716368 0.094215435786540708;0.53422846266712953 0.18828283422674039 -1.6368059480692883 0.98572062346682687 0.95382724196559132;0.71624855149862299 0.15509815632504631 -1.1744678984279606 0.79709149069857776 17.859691294305808;-1.429015207352399 -2.5723981666868649 -1.6823222366878445 1.4567245151360739 1.2732459945991805;0.51786280701144582 -3.8657808161163416 -0.35321492722586068 -7.4849939591862942 0.6009056430254992;3.6327761448399545 0.61588027914553833 2.384376417927871 -4.2637222084196793 2.3059151146011136;3.1815677405341312 0.24275310132765582 -0.57141852247681324 -0.0043241853662540422 0.35280595758166566;1.2598351406558632 -0.065146042593647494 -1.7334103801386991 1.8854562377350244 1.5834771457392891];
  
  % Layer 2
  b2 = [4.8228858800824312;-0.56482461095296932;1.4338277683357985;4.7027679307752637;2.1683062646668545;-5.0961735717460304;-0.92858962445503324;-3.1530985147940291;-9.8853496387141213;-1.8407392822787012];
  LW2_1 = [-3.4127297782590738 6.0675326200250952 1.9049969012834305 -1.4813022290119984 0.11508664449951539 -1.8417404529821355 -2.7381018139079236 1.0018585987003827 0.75756489935272742 0.71406515203489118;-0.012251194328236778 -1.478589969990689 1.7856377186825263 3.8706007622797145 -0.7176070759509493 -0.22927032127303723 0.10063551017298616 -0.75958854875877979 0.17716322216815433 -3.8857413700614347;4.0962688139186998 -1.4722662038165457 1.5742266967704535 8.0167859178821583 -11.349743236785828 -1.8826494881695703 4.4081541218633049 -0.4185230823002285 -0.86183874375231406 1.0116138970525324;-0.48860100039474685 1.8572917191473632 3.4503122732339286 -1.3193254105423333 -0.022915355215946703 0.17472351628419169 -0.55755379486173218 0.59561983082191827 1.0019312462175727 0.4549290031277412;-0.95077677433856611 3.0017362214665582 1.7636325091830312 0.52456128602746011 0.40001266278337549 -1.170963359106201 -0.5473168011229107 1.1136000800244317 1.0557317360167524 -2.8964371841462615;2.9425851459091419 -5.3378158506014302 -2.3480062222454241 2.7264216799617351 -0.11700015606342669 1.5353107139368134 2.6448971763090885 -1.0230015174533953 -0.41137752916224657 -1.85341997012622;0.91128946818394851 -1.500122643183629 -0.26507346885980032 -1.7893154102574966 -0.081900446038337349 1.9526278566743487 0.96263284404464533 -1.1855159242489721 0.20347966300643891 1.1532271410871211;1.0235550567156964 -2.0927053015237727 -1.4710307897510702 2.4367833117822935 -0.096970232860382408 -0.20860159258783725 1.5707129802538795 -0.80787062390929831 -0.54081957807978664 -1.9391642955160793;-11.107869383144759 5.6505840431864307 1.8499394095725676 -2.3822384941899353 -0.416928708786383 -0.026330545239401038 5.0032318183422104 -1.157049260414954 0.14069525994048154 0.11461533584843933;0.84498163955487882 -0.21364226547981202 0.30812406153494154 -0.94725240475988737 -0.12919261638816301 0.54046664308340175 2.1570873965209385 -0.60081651416185555 -0.4223026364463478 0.37359303720257797];
  
  % Layer 3
  b3 = -0.12952390885534698;
  LW3_2 = [2.8054008376740542 1.467542402276266 -0.20558678596488097 -3.2774208111571665 -0.18075329361031559 4.9261268993629317 -0.20452494645944908 -9.3430142954591435 -0.5677782778049757 4.1567250366882638];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 10.752688172043;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
